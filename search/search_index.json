{"config":{"lang":["en"],"separator":"[\\s\\u200b\\u3000\\-\u3001\u3002\uff0c\uff0e\uff1f\uff01\uff1b]+","pipeline":["stemmer"]},"docs":[{"location":"","title":"Welcome to MkDocs","text":"<p>For full documentation visit mkdocs.org.</p>"},{"location":"#commands","title":"Commands","text":"<ul> <li><code>mkdocs new [dir-name]</code> - Create a new project.</li> <li><code>mkdocs serve</code> - Start the live-reloading docs server.</li> <li><code>mkdocs build</code> - Build the documentation site.</li> <li><code>mkdocs -h</code> - Print help message and exit.</li> <li><code>mkdocs gh-deploy</code> - Github Pages.</li> </ul>"},{"location":"#project-layout","title":"Project layout","text":"<pre><code>mkdocs.yml    # The configuration file.\ndocs/\n    index.md  # The documentation homepage.\n    ...       # Other markdown pages, images and other files.\n</code></pre>"},{"location":"#_1","title":"\u4f7f\u7528\u865a\u62df\u73af\u5883","text":"<ol> <li>\u521b\u5efa\u4e00\u4e2a\u865a\u62df\u73af\u5883\uff1a    <pre><code>python3 -m venv .env\n</code></pre></li> <li>\u6fc0\u6d3b\u865a\u62df\u73af\u5883\uff1a    <pre><code>source .env/bin/activate\n</code></pre></li> <li>\u7136\u540e\u5728\u865a\u62df\u73af\u5883\u4e2d\u5b89\u88c5 <code>mkdocs-material</code>\uff1a    <pre><code>pip install mkdocs\npip install mkdocs-material\n</code></pre></li> </ol>"},{"location":"#git-ignore","title":"git ignore","text":"<pre><code>.env/\n</code></pre>"},{"location":"010Java/010Basic/","title":"Java\u6838\u5fc3\u77e5\u8bc6\u70b9","text":""},{"location":"010Java/010Basic/#intcharlong","title":"int\u3001char\u3001long \u5404\u5360\u591a\u5c11\u5b57\u8282\u6570","text":"\u7b54\u6848 \u7c7b\u578b \u4f4d\u6570 \u5b57\u8282\u6570 boolen 8 1 int 32 4 float 32 4 double 64 8 char 16 2 byte 8 1 short 16 2 long 64 8"},{"location":"010Java/010Basic/#int-integer","title":"int \u548c Integer \u7684\u533a\u522b","text":"\u7b54\u6848 <p>Java \u4e3a\u6bcf\u4e00\u4e2a\u57fa\u672c\u6570\u636e\u7c7b\u578b\u90fd\u5f15\u5165\u4e86\u5bf9\u5e94\u7684\u5305\u88c5\u7c7b\uff0c\u4eceJava 5 \u5f00\u59cb\u5f15\u5165\u4e86\u81ea\u52a8\u88c5\u7bb1 / \u62c6\u7bb1\u673a\u5236\uff0c\u4f7f\u5f97\u4e24\u8005\u53ef\u4ee5\u76f8\u4e92\u8f6c\u5316\u3002\u6240\u4ee5\u6700\u57fa\u672c\u7684\u4e00\u70b9\u533a\u522b\u5c31\u662f\uff1aInteger \u662fint\u7684\u5305\u88c5\u7c7b\uff0cint\u7684\u521d\u59cb\u503c\u4e3a\u96f6\uff0c\u800cInteger\u7684\u521d\u503c\u4e3anull\u3002int\u4e0eInteger\u76f8\u6bd4\uff0c\u4f1a\u628aInteger\u81ea\u52a8\u62c6\u7bb1\u4e3aint\u518d\u53bb\u6bd4\u3002</p> <p>\u53c2\u8003\u81ea\uff1ahttp://blog.csdn.net/login_sonata/article/details/71001851</p>"},{"location":"010Java/010Basic/#_1","title":"\u4ec0\u4e48\u662f\u5185\u90e8\u7c7b\uff1f\u5185\u90e8\u7c7b\u7684\u4f5c\u7528","text":"\u7b54\u6848 <p>Java \u5e38\u89c1\u7684\u5185\u90e8\u7c7b\u6709\u56db\u79cd\uff1a\u6210\u5458\u5185\u90e8\u7c7b\u3001\u9759\u6001\u5185\u90e8\u7c7b\u3001\u65b9\u6cd5\u5185\u90e8\u7c7b\u548c\u533f\u540d\u5185\u90e8\u7c7b\u3002</p> <p>\u5185\u90e8\u7c7b\u53ef\u4ee5\u5f88\u597d\u7684\u5b9e\u73b0\u9690\u853d\uff0c\u4e00\u822c\u7684\u975e\u5185\u90e8\u7c7b\uff0c\u662f\u4e0d\u5141\u8bb8\u6709private\u548cprotectd\u7b49\u6743\u9650\u7684\uff0c\u4f46\u5185\u90e8\u7c7b\uff08\u9664\u65b9\u6cd5\u5185\u90e8\u7c7b\uff09\u53ef\u4ee5\u901a\u8fc7\u8fd9\u4e9b\u4fee\u9970\u7b26\u6765\u5b9e\u73b0\u9690\u853d\u3002</p> <p>\u5185\u90e8\u7c7b\u62e5\u6709\u5916\u90e8\u7c7b\u7684\u8bbf\u95ee\u6743\u9650\uff08\u5206\u9759\u6001\u4e0e\u975e\u9759\u6001\u60c5\u51b5\uff09\uff0c\u901a\u8fc7\u8fd9\u4e00\u7279\u6027\u53ef\u4ee5\u6bd4\u8f83\u597d\u7684\u5904\u7406\u7c7b\u4e4b\u95f4\u7684\u5173\u8054\u6027\uff0c\u5c06\u4e00\u7c7b\u4e8b\u7269\u7684\u6d41\u7a0b\u653e\u5728\u4e00\u8d77\u5185\u90e8\u5904\u7406\u3002</p> <p>\u901a\u8fc7\u5185\u90e8\u7c7b\u53ef\u4ee5\u5b9e\u73b0\u591a\u91cd\u7ee7\u627f\uff0cJava\u9ed8\u8ba4\u662f\u5355\u7ee7\u627f\u7684\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u591a\u4e2a\u5185\u90e8\u7c7b\u7ee7\u627f\u5b9e\u73b0\u591a\u4e2a\u7236\u7c7b\uff0c\u63a5\u7740\u7531\u4e8e\u5916\u90e8\u7c7b\u5b8c\u5168\u53ef\u8bbf\u95ee\u5185\u90e8\u7c7b\uff0c\u6240\u4ee5\u5c31\u5b9e\u73b0\u4e86\u7c7b\u4f3c\u591a\u7ee7\u627f\u7684\u6548\u679c\u3002</p> <p>\u53c2\u8003\u81ea\uff1ahttps://www.jianshu.com/p/7fe3af7f0f2d</p>"},{"location":"010Java/010Basic/#serializable-parcelable","title":"Serializable \u548c Parcelable \u7684\u533a\u522b","text":"\u7b54\u6848 <p>Serializable \u662f Java\u7684\u5e8f\u5217\u5316\u63a5\u53e3\u3002\u7279\u70b9\u662f\u7b80\u5355\uff0c\u76f4\u63a5\u5b9e\u73b0\u8be5\u63a5\u53e3\u5c31\u884c\u4e86\uff0c\u5176\u4ed6\u5de5\u4f5c\u90fd\u88ab\u7cfb\u7edf\u5b8c\u6210\u4e86\uff0c\u4f46\u662f\u5bf9\u4e8e\u5185\u5b58\u5f00\u9500\u5927\uff0c\u5e8f\u5217\u5316\u548c\u53cd\u5e8f\u5217\u5316\u9700\u8981\u5f88\u591a\u7684 I/O \u6d41\u64cd\u4f5c\u3002</p> <p>Parcelable \u662fAndroid\u7684\u5e8f\u5217\u5316\u65b9\u5f0f\uff0c\u4e3b\u8981\u7528\u4e8e\u5728\u5185\u5b58\u5e8f\u5217\u5316\u4e0a\uff0c\u91c7\u7528\u8be5\u65b9\u6cd5\u9700\u8981\u5b9e\u73b0\u8be5\u63a5\u53e3\u5e76\u4e14\u624b\u52a8\u5b9e\u73b0\u5e8f\u5217\u5316\u8fc7\u7a0b\uff0c\u76f8\u5bf9\u590d\u6742\u70b9\u3002\u5982\u679c\u5e8f\u5217\u5316\u5230\u5b58\u50a8\u8bbe\u5907\uff08\u6587\u4ef6\u7b49\uff09\u6216\u8005\u7f51\u7edc\u4f20\u8f93\uff0c\u6bd4\u8f83\u590d\u6742\uff0c\u5efa\u8bae\u7528Serializable \u65b9\u5f0f\u3002</p> <p>\u6700\u5927\u7684\u533a\u522b\u5c31\u662f\u5b58\u50a8\u5a92\u4ecb\u7684\u4e0d\u540c\uff1aSerializable \u4f7f\u7528IO\u8bfb\u5199\u5b58\u50a8\u5728\u786c\u76d8\u4e0a\uff0cParcelable \u662f\u76f4\u63a5\u5728\u5185\u5b58\u4e2d\u8bfb\u5199\uff0c\u5185\u5b58\u8bfb\u5199\u901f\u5ea6\u8fdc\u5927\u4e8eIO\u8bfb\u5199\uff0c\u6240\u4ee5Parcelable \u66f4\u52a0\u9ad8\u6548\u3002Serializable\u5728\u5e8f\u5217\u5316\u8fc7\u7a0b\u4e2d\u4f1a\u4ea7\u751f\u5927\u91cf\u7684\u4e34\u65f6\u53d8\u91cf\uff0c\u4f1a\u5f15\u8d77\u9891\u7e41\u7684GC\uff0c\u6548\u7387\u4f4e\u4e0b\u3002</p>"},{"location":"010Java/010Basic/#finalfinallyfinalize","title":"final\u3001finally\u3001finalize\u7684\u533a\u522b","text":"\u7b54\u6848 <p>final\u7528\u4e8e\u58f0\u660e\u5c5e\u6027\u3001\u65b9\u6cd5\u548c\u7c7b\uff0c\u5206\u522b\u8868\u793a\u5c5e\u6027\u4e0d\u53ef\u53d8\uff0c\u65b9\u6cd5\u4e0d\u53ef\u8986\u76d6\uff0c\u7c7b\u4e0d\u53ef\u7ee7\u627f\u3002</p> <p>finally\u662f\u5f02\u5e38\u5904\u7406\u8bed\u53e5\u7ed3\u6784\u7684\u4e00\u90e8\u5206\uff0c\u8868\u793a\u603b\u662f\u6267\u884c\u3002</p> <p>finalize\u662fObject\u7c7b\u7684\u4e00\u4e2a\u65b9\u6cd5\uff0c\u5728\u5783\u573e\u6536\u96c6\u5668\u6267\u884c\u7684\u65f6\u5019\u4f1a\u56de\u8c03\u88ab\u56de\u6536\u5bf9\u8c61\u7684finalize()\u65b9\u6cd5\uff0c\u53ef\u4ee5\u8986\u76d6\u6b64\u65b9\u6cd5\u63d0\u4f9b\u5783\u573e\u6536\u96c6\u65f6\u5176\u4ed6\u8d44\u6e90\u7684\u56de\u6536\uff0c\u4f8b\u5982\u5173\u95ed\u6587\u4ef6\u3002</p>"},{"location":"010Java/010Basic/#stringstringbuilderstringbuffer","title":"String\uff0cStringBuilder\uff0cStringBuffer\u7684\u533a\u522b\uff1f","text":"\u7b54\u6848 <p>\u4ece\u6e90\u7801\u5c42\u9762\u5206\u6790 <code>String</code>\u3001<code>StringBuilder</code> \u548c <code>StringBuffer</code> \u7684\u7279\u6027\u3002\u4ee5\u4e0b\u662f\u57fa\u4e8e JDK \u6e90\u7801\u7684\u8be6\u7ec6\u5206\u6790\uff1a</p>"},{"location":"010Java/010Basic/#1-string","title":"1. String \u7684\u4e0d\u53ef\u53d8\u6027","text":"<p><code>String</code> \u7684\u4e0d\u53ef\u53d8\u6027\u662f\u901a\u8fc7\u4ee5\u4e0b\u65b9\u5f0f\u5b9e\u73b0\u7684\uff1a - <code>final</code> \u4fee\u9970\u7684\u5b57\u7b26\u6570\u7ec4\uff1a<code>String</code> \u5185\u90e8\u4f7f\u7528 <code>final</code> \u4fee\u9970\u7684 <code>char[]</code> \u6765\u5b58\u50a8\u5b57\u7b26\u4e32\u5185\u5bb9\uff0c\u786e\u4fdd\u5b57\u7b26\u6570\u7ec4\u5f15\u7528\u4e0d\u53ef\u53d8\u3002 - <code>final</code> \u4fee\u9970\u7684\u7c7b\uff1a<code>String</code> \u7c7b\u672c\u8eab\u662f <code>final</code> \u7684\uff0c\u9632\u6b62\u88ab\u7ee7\u627f\u548c\u4fee\u6539\u3002</p>"},{"location":"010Java/010Basic/#_2","title":"\u6e90\u7801\u7247\u6bb5","text":"<pre><code>// \u7c7b\u4e5f\u662ffinal\uff0c\u8fd9\u6837\u786e\u4fddString\u4e0d\u4f1a\u88ab\u7ee7\u627f\u3002\npublic final class String implements java.io.Serializable, Comparable&lt;String&gt;, CharSequence {\n    // \u4f7f\u7528 final \u4fee\u9970\u7684\u5b57\u7b26\u6570\u7ec4\n    private final char value[];\n\n    // \u6784\u9020\u51fd\u6570\n    public String(String original) {\n        this.value = original.value; // \u76f4\u63a5\u5f15\u7528\u539f\u5b57\u7b26\u6570\u7ec4\n        this.hash = original.hash;\n    }\n\n    // \u5176\u4ed6\u65b9\u6cd5...\n}\n</code></pre> <p>\u5173\u952e\u70b9\uff1a - <code>private final char value[]</code>\uff1a\u5b57\u7b26\u6570\u7ec4\u88ab <code>final</code> \u4fee\u9970\uff0c\u4e00\u65e6\u521d\u59cb\u5316\u540e\uff0c\u5f15\u7528\u4e0d\u53ef\u53d8\u3002 - <code>String</code> \u7c7b\u7684\u6240\u6709\u4fee\u6539\u64cd\u4f5c\uff08\u5982 <code>concat</code>\u3001<code>substring</code> \u7b49\uff09\u90fd\u4f1a\u8fd4\u56de\u4e00\u4e2a\u65b0\u7684 <code>String</code> \u5bf9\u8c61\uff0c\u800c\u4e0d\u662f\u4fee\u6539\u539f\u5bf9\u8c61\u3002</p>"},{"location":"010Java/010Basic/#2-stringbuffer","title":"2. StringBuffer \u7684\u7ebf\u7a0b\u5b89\u5168","text":"<p><code>StringBuffer</code> \u7684\u7ebf\u7a0b\u5b89\u5168\u662f\u901a\u8fc7\u4ee5\u4e0b\u65b9\u5f0f\u5b9e\u73b0\u7684\uff1a - <code>synchronized</code> \u5173\u952e\u5b57\uff1a<code>StringBuffer</code> \u7684\u6240\u6709\u5173\u952e\u65b9\u6cd5\u90fd\u4f7f\u7528 <code>synchronized</code> \u4fee\u9970\uff0c\u786e\u4fdd\u591a\u7ebf\u7a0b\u73af\u5883\u4e0b\u7684\u7ebf\u7a0b\u5b89\u5168\u3002</p>"},{"location":"010Java/010Basic/#_3","title":"\u6e90\u7801\u7247\u6bb5","text":"<pre><code>public final class StringBuffer extends AbstractStringBuilder implements java.io.Serializable, CharSequence {\n    // \u5173\u952e\u65b9\u6cd5\u4f7f\u7528 synchronized \u4fee\u9970\n    @Override\n    public synchronized StringBuffer append(String str) {\n        toStringCache = null;\n        super.append(str);\n        return this;\n    }\n\n    @Override\n    public synchronized StringBuffer insert(int offset, String str) {\n        toStringCache = null;\n        super.insert(offset, str);\n        return this;\n    }\n\n    @Override\n    public synchronized StringBuffer reverse() {\n        toStringCache = null;\n        super.reverse();\n        return this;\n    }\n\n    // \u5176\u4ed6\u65b9\u6cd5...\n}\n</code></pre> <p>\u5173\u952e\u70b9\uff1a - <code>synchronized</code> \u4fee\u9970\u7684\u65b9\u6cd5\uff08\u5982 <code>append</code>\u3001<code>insert</code>\u3001<code>reverse</code> \u7b49\uff09\u786e\u4fdd\u591a\u7ebf\u7a0b\u73af\u5883\u4e0b\u64cd\u4f5c\u662f\u7ebf\u7a0b\u5b89\u5168\u7684\u3002 - <code>toStringCache</code> \u662f\u4e00\u4e2a\u7f13\u5b58\u5b57\u6bb5\uff0c\u7528\u4e8e\u4f18\u5316 <code>toString()</code> \u65b9\u6cd5\u7684\u6027\u80fd\u3002</p>"},{"location":"010Java/010Basic/#3-stringbuilder","title":"3. StringBuilder \u7684\u975e\u7ebf\u7a0b\u5b89\u5168","text":"<p><code>StringBuilder</code> \u662f\u975e\u7ebf\u7a0b\u5b89\u5168\u7684\uff0c\u5b83\u7684\u65b9\u6cd5\u4e0e <code>StringBuffer</code> \u7c7b\u4f3c\uff0c\u4f46\u6ca1\u6709\u4f7f\u7528 <code>synchronized</code> \u5173\u952e\u5b57\u3002</p>"},{"location":"010Java/010Basic/#_4","title":"\u6e90\u7801\u7247\u6bb5","text":"<pre><code>public final class StringBuilder extends AbstractStringBuilder implements java.io.Serializable, CharSequence {\n    // \u5173\u952e\u65b9\u6cd5\u6ca1\u6709 synchronized \u4fee\u9970\n    @Override\n    public StringBuilder append(String str) {\n        super.append(str);\n        return this;\n    }\n\n    @Override\n    public StringBuilder insert(int offset, String str) {\n        super.insert(offset, str);\n        return this;\n    }\n\n    @Override\n    public StringBuilder reverse() {\n        super.reverse();\n        return this;\n    }\n\n    // \u5176\u4ed6\u65b9\u6cd5...\n}\n</code></pre> <p>\u5173\u952e\u70b9\uff1a - <code>StringBuilder</code> \u7684\u65b9\u6cd5\u6ca1\u6709 <code>synchronized</code> \u4fee\u9970\uff0c\u56e0\u6b64\u662f\u975e\u7ebf\u7a0b\u5b89\u5168\u7684\u3002 - \u7531\u4e8e\u6ca1\u6709\u540c\u6b65\u5f00\u9500\uff0c<code>StringBuilder</code> \u7684\u6027\u80fd\u6bd4 <code>StringBuffer</code> \u66f4\u9ad8\u3002</p>"},{"location":"010Java/010Basic/#4-abstractstringbuilder","title":"4. AbstractStringBuilder","text":"<p><code>StringBuilder</code> \u548c <code>StringBuffer</code> \u90fd\u7ee7\u627f\u81ea <code>AbstractStringBuilder</code>\uff0c\u5b83\u662f\u4e00\u4e2a\u62bd\u8c61\u7c7b\uff0c\u5c01\u88c5\u4e86\u5927\u90e8\u5206\u5b57\u7b26\u4e32\u64cd\u4f5c\u7684\u903b\u8f91\u3002</p>"},{"location":"010Java/010Basic/#_5","title":"\u6e90\u7801\u7247\u6bb5","text":"<pre><code>abstract class AbstractStringBuilder implements Appendable, CharSequence {\n    // \u5b57\u7b26\u6570\u7ec4\uff0c\u7528\u4e8e\u5b58\u50a8\u5b57\u7b26\u4e32\u5185\u5bb9\n    char[] value;\n\n    // \u5f53\u524d\u5b57\u7b26\u6570\u7ec4\u7684\u957f\u5ea6\n    int count;\n\n    // \u6269\u5bb9\u65b9\u6cd5\n    private void ensureCapacityInternal(int minimumCapacity) {\n        if (minimumCapacity - value.length &gt; 0) {\n            value = Arrays.copyOf(value, newCapacity(minimumCapacity));\n        }\n    }\n\n    // \u5176\u4ed6\u65b9\u6cd5...\n}\n</code></pre> <p>\u5173\u952e\u70b9\uff1a - <code>AbstractStringBuilder</code> \u4f7f\u7528 <code>char[] value</code> \u5b58\u50a8\u5b57\u7b26\u4e32\u5185\u5bb9\uff0c<code>StringBuilder</code> \u548c <code>StringBuffer</code> \u90fd\u76f4\u63a5\u7ee7\u627f\u4e86\u8fd9\u4e2a\u5b9e\u73b0\u3002 - <code>ensureCapacityInternal</code> \u65b9\u6cd5\u7528\u4e8e\u52a8\u6001\u6269\u5bb9\u5b57\u7b26\u6570\u7ec4\u3002</p> <p>\u53e6\u5916StringBuilder\u548cStringBuffer\u521d\u59cb\u5316\u5bb9\u91cf\u90fd\u662f16.</p> <p>@IntrinsicCandidate public StringBuilder() {     super(16); }</p> <p>@IntrinsicCandidate public StringBuffer() {     super(16); }</p>"},{"location":"010Java/010Basic/#_6","title":"\u603b\u7ed3","text":"<ul> <li><code>String</code> \u7684\u4e0d\u53ef\u53d8\u6027\uff1a\u901a\u8fc7 <code>final char[] value</code> \u548c <code>final</code> \u7c7b\u5b9e\u73b0\u3002</li> <li><code>StringBuffer</code> \u7684\u7ebf\u7a0b\u5b89\u5168\uff1a\u901a\u8fc7 <code>synchronized</code> \u5173\u952e\u5b57\u4fee\u9970\u65b9\u6cd5\u5b9e\u73b0\u3002</li> <li><code>StringBuilder</code> \u7684\u975e\u7ebf\u7a0b\u5b89\u5168\uff1a\u6ca1\u6709\u4f7f\u7528 <code>synchronized</code>\uff0c\u6027\u80fd\u66f4\u9ad8\u3002</li> </ul>"},{"location":"010Java/010Basic/#new-string","title":"new String\u521b\u5efa\u4e86\u51e0\u4e2a\u5bf9\u8c61","text":"\u7b54\u6848 <p>\u5728Java\u4e2d\uff0c\u4f7f\u7528 <code>new String()</code> \u521b\u5efa\u5b57\u7b26\u4e32\u5bf9\u8c61\u65f6\uff0c\u4f1a\u6d89\u53ca\u5230\u4ee5\u4e0b\u51e0\u4e2a\u6b65\u9aa4\uff1a</p> <ol> <li> <p>\u5b57\u7b26\u4e32\u5e38\u91cf\u6c60\uff1a\u5982\u679c\u5b57\u7b26\u4e32\u5b57\u9762\u91cf\uff08\u4f8b\u5982 <code>\"example\"</code>\uff09\u5df2\u7ecf\u5728\u5e38\u91cf\u6c60\u4e2d\u5b58\u5728\uff0c\u5219\u4e0d\u4f1a\u5728\u5e38\u91cf\u6c60\u4e2d\u521b\u5efa\u65b0\u7684\u5bf9\u8c61\u3002\u5982\u679c\u4e0d\u5b58\u5728\uff0c\u5219\u4f1a\u5728\u5e38\u91cf\u6c60\u4e2d\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u5b57\u7b26\u4e32\u5bf9\u8c61\u3002</p> </li> <li> <p>\u5806\u5185\u5b58\uff1a\u4f7f\u7528 <code>new String()</code> \u4f1a\u5728\u5806\u5185\u5b58\u4e2d\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u5b57\u7b26\u4e32\u5bf9\u8c61\uff0c\u5373\u4f7f\u5b57\u7b26\u4e32\u5e38\u91cf\u6c60\u4e2d\u5df2\u7ecf\u5b58\u5728\u76f8\u540c\u7684\u5b57\u7b26\u4e32\u3002</p> </li> </ol> <p>\u56e0\u6b64\uff0c\u4f7f\u7528 <code>new String(\"example\")</code> \u65f6\uff0c\u901a\u5e38\u4f1a\u521b\u5efa \u4e24\u4e2a\u5bf9\u8c61\uff1a - \u4e00\u4e2a\u5728\u5b57\u7b26\u4e32\u5e38\u91cf\u6c60\u4e2d\uff08\u5982\u679c\u5e38\u91cf\u6c60\u4e2d\u8fd8\u6ca1\u6709\u8be5\u5b57\u7b26\u4e32\uff09\u3002 - \u4e00\u4e2a\u5728\u5806\u5185\u5b58\u4e2d\u3002</p>"},{"location":"010Java/010Basic/#_7","title":"\u793a\u4f8b\u4ee3\u7801","text":"<pre><code>String s1 = \"example\"; // \u53ea\u5728\u5e38\u91cf\u6c60\u4e2d\u521b\u5efa\u5bf9\u8c61\nString s2 = new String(\"example\"); // \u5728\u5806\u5185\u5b58\u4e2d\u521b\u5efa\u5bf9\u8c61\uff0c\u5e38\u91cf\u6c60\u4e2d\u53ef\u80fd\u5df2\u5b58\u5728\n</code></pre>"},{"location":"010Java/010Basic/#_8","title":"\u603b\u7ed3","text":"<ul> <li>\u5982\u679c\u5b57\u7b26\u4e32\u5e38\u91cf\u6c60\u4e2d\u4e0d\u5b58\u5728\u8be5\u5b57\u7b26\u4e32\uff0c<code>new String(\"example\")</code> \u4f1a\u521b\u5efa \u4e24\u4e2a\u5bf9\u8c61\uff08\u5e38\u91cf\u6c60\u548c\u5806\u5185\u5b58\u5404\u4e00\u4e2a\uff09\u3002</li> <li>\u5982\u679c\u5b57\u7b26\u4e32\u5e38\u91cf\u6c60\u4e2d\u5df2\u5b58\u5728\u8be5\u5b57\u7b26\u4e32\uff0c<code>new String(\"example\")</code> \u53ea\u4f1a\u521b\u5efa \u4e00\u4e2a\u5bf9\u8c61\uff08\u5806\u5185\u5b58\u4e2d\uff09\u3002</li> </ul> <p>\u6ce8\u610f\uff1a\u5b57\u7b26\u4e32\u5e38\u91cf\u6c60\u662fJVM\u4f18\u5316\u5b57\u7b26\u4e32\u5b58\u50a8\u7684\u4e00\u79cd\u673a\u5236\uff0c\u76ee\u7684\u662f\u51cf\u5c11\u91cd\u590d\u5b57\u7b26\u4e32\u7684\u5185\u5b58\u5360\u7528\u3002</p>"},{"location":"010Java/010Basic/#stringfinal","title":"String\u4e3a\u4ec0\u4e48\u8981\u8bbe\u8ba1\u6210final\uff1f","text":"\u7b54\u6848 <p><code>String</code> \u7c7b\u88ab\u8bbe\u8ba1\u4e3a <code>final</code> \u7684\u4e3b\u8981\u539f\u56e0\u662f\u4e3a\u4e86\u786e\u4fdd \u4e0d\u53ef\u53d8\u6027\u3001\u5b89\u5168\u6027 \u548c \u6027\u80fd\u4f18\u5316\u3002\u4ee5\u4e0b\u662f\u8be6\u7ec6\u7684\u539f\u56e0\u5206\u6790\uff1a</p>"},{"location":"010Java/010Basic/#1","title":"1. \u786e\u4fdd\u4e0d\u53ef\u53d8\u6027","text":"<p><code>String</code> \u7684\u6838\u5fc3\u7279\u6027\u662f\u4e0d\u53ef\u53d8\u6027\uff0c\u5373\u4e00\u65e6\u521b\u5efa\uff0c\u5176\u5185\u5bb9\u5c31\u4e0d\u80fd\u88ab\u4fee\u6539\u3002\u5c06 <code>String</code> \u7c7b\u8bbe\u8ba1\u4e3a <code>final</code> \u53ef\u4ee5\u9632\u6b62\u5b50\u7c7b\u7ee7\u627f\u5e76\u91cd\u5199\u5176\u65b9\u6cd5\uff0c\u4ece\u800c\u7834\u574f\u4e0d\u53ef\u53d8\u6027\u3002</p>"},{"location":"010Java/010Basic/#_9","title":"\u793a\u4f8b","text":"<p>\u5982\u679c <code>String</code> \u4e0d\u662f <code>final</code>\uff0c\u53ef\u80fd\u4f1a\u6709\u4eba\u901a\u8fc7\u7ee7\u627f <code>String</code> \u5e76\u91cd\u5199\u5176\u65b9\u6cd5\u6765\u4fee\u6539\u5176\u5185\u90e8\u72b6\u6001\uff1a <pre><code>public class MutableString extends String {\n    private char[] value;\n\n    public MutableString(String original) {\n        super(original);\n        this.value = original.toCharArray();\n    }\n\n    @Override\n    public String concat(String str) {\n        // \u4fee\u6539\u5185\u90e8\u72b6\u6001\n        this.value = (new String(this.value) + str).toCharArray();\n        return new String(this.value);\n    }\n}\n</code></pre> \u5982\u679c\u5141\u8bb8\u8fd9\u79cd\u884c\u4e3a\uff0c<code>String</code> \u7684\u4e0d\u53ef\u53d8\u6027\u5c31\u4f1a\u88ab\u7834\u574f\uff0c\u5bfc\u81f4\u7a0b\u5e8f\u884c\u4e3a\u4e0d\u53ef\u9884\u6d4b\u3002</p>"},{"location":"010Java/010Basic/#2","title":"2. \u5b89\u5168\u6027","text":"<p><code>String</code> \u5728 Java \u4e2d\u88ab\u5e7f\u6cdb\u4f7f\u7528\uff0c\u5c24\u5176\u662f\u5728\u4ee5\u4e0b\u573a\u666f\uff1a - \u7c7b\u52a0\u8f7d\u673a\u5236\uff1a\u7c7b\u540d\u3001\u65b9\u6cd5\u540d\u7b49\u90fd\u662f <code>String</code> \u7c7b\u578b\u3002 - \u7f51\u7edc\u901a\u4fe1\uff1aURL\u3001\u53c2\u6570\u7b49\u901a\u5e38\u662f <code>String</code> \u7c7b\u578b\u3002 - \u6587\u4ef6\u8def\u5f84\uff1a\u6587\u4ef6\u8def\u5f84\u662f <code>String</code> \u7c7b\u578b\u3002</p> <p>\u5982\u679c <code>String</code> \u4e0d\u662f <code>final</code>\uff0c\u6076\u610f\u4ee3\u7801\u53ef\u4ee5\u901a\u8fc7\u7ee7\u627f <code>String</code> \u5e76\u91cd\u5199\u5176\u65b9\u6cd5\u6765\u7be1\u6539\u8fd9\u4e9b\u5173\u952e\u6570\u636e\uff0c\u4ece\u800c\u5bfc\u81f4\u5b89\u5168\u95ee\u9898\u3002</p>"},{"location":"010Java/010Basic/#_10","title":"\u793a\u4f8b","text":"<p>\u5047\u8bbe <code>String</code> \u4e0d\u662f <code>final</code>\uff0c\u653b\u51fb\u8005\u53ef\u4ee5\u521b\u5efa\u4e00\u4e2a\u6076\u610f\u5b50\u7c7b\uff1a <pre><code>public class MaliciousString extends String {\n    public MaliciousString(String original) {\n        super(original);\n    }\n\n    @Override\n    public boolean equals(Object obj) {\n        // \u7be1\u6539 equals \u65b9\u6cd5\uff0c\u7834\u574f\u7a0b\u5e8f\u7684\u903b\u8f91\n        return true;\n    }\n}\n</code></pre> \u5982\u679c\u5141\u8bb8\u8fd9\u79cd\u884c\u4e3a\uff0c\u7a0b\u5e8f\u7684\u5b89\u5168\u6027\u5c06\u65e0\u6cd5\u4fdd\u8bc1\u3002</p>"},{"location":"010Java/010Basic/#3","title":"3. \u6027\u80fd\u4f18\u5316","text":"<p><code>String</code> \u7684\u4e0d\u53ef\u53d8\u6027\u4f7f\u5f97 JVM \u53ef\u4ee5\u8fdb\u884c\u591a\u79cd\u6027\u80fd\u4f18\u5316\uff1a - \u5b57\u7b26\u4e32\u5e38\u91cf\u6c60\uff1a<code>String</code> \u662f\u4e0d\u53ef\u53d8\u7684\uff0c\u56e0\u6b64\u53ef\u4ee5\u88ab\u7f13\u5b58\u548c\u91cd\u7528\u3002\u4f8b\u5982\uff0c\u5b57\u7b26\u4e32\u5b57\u9762\u91cf\u4f1a\u88ab\u653e\u5165\u5b57\u7b26\u4e32\u5e38\u91cf\u6c60\uff0c\u591a\u4e2a\u76f8\u540c\u7684\u5b57\u9762\u91cf\u4f1a\u5171\u4eab\u540c\u4e00\u4e2a\u5bf9\u8c61\u3002 - \u54c8\u5e0c\u503c\u7f13\u5b58\uff1a<code>String</code> \u7684 <code>hashCode()</code> \u65b9\u6cd5\u4f1a\u7f13\u5b58\u54c8\u5e0c\u503c\uff0c\u56e0\u4e3a <code>String</code> \u4e0d\u53ef\u53d8\uff0c\u54c8\u5e0c\u503c\u53ea\u9700\u8981\u8ba1\u7b97\u4e00\u6b21\u3002 - \u7ebf\u7a0b\u5b89\u5168\uff1a<code>String</code> \u7684\u4e0d\u53ef\u53d8\u6027\u5929\u7136\u652f\u6301\u7ebf\u7a0b\u5b89\u5168\uff0c\u65e0\u9700\u989d\u5916\u7684\u540c\u6b65\u5f00\u9500\u3002</p> <p>\u5982\u679c <code>String</code> \u4e0d\u662f <code>final</code>\uff0c\u8fd9\u4e9b\u4f18\u5316\u5c06\u65e0\u6cd5\u5b9e\u73b0\uff0c\u56e0\u4e3a\u5b50\u7c7b\u53ef\u80fd\u4f1a\u4fee\u6539 <code>String</code> \u7684\u72b6\u6001\u3002</p>"},{"location":"010Java/010Basic/#_11","title":"\u793a\u4f8b","text":"<p><pre><code>String s1 = \"Hello\";\nString s2 = \"Hello\";\nSystem.out.println(s1 == s2); // \u8f93\u51fa true\uff0c\u56e0\u4e3a s1 \u548c s2 \u6307\u5411\u5e38\u91cf\u6c60\u4e2d\u7684\u540c\u4e00\u4e2a\u5bf9\u8c61\n</code></pre> \u5982\u679c <code>String</code> \u4e0d\u662f <code>final</code>\uff0c\u8fd9\u79cd\u4f18\u5316\u5c06\u65e0\u6cd5\u4fdd\u8bc1\u3002</p>"},{"location":"010Java/010Basic/#4","title":"4. \u8bbe\u8ba1\u4e00\u81f4\u6027","text":"<p><code>String</code> \u662f Java \u4e2d\u6700\u57fa\u7840\u7684\u7c7b\u4e4b\u4e00\uff0c\u5b83\u7684\u884c\u4e3a\u5fc5\u987b\u4fdd\u6301\u4e00\u81f4\u6027\u548c\u53ef\u9884\u6d4b\u6027\u3002\u5c06 <code>String</code> \u8bbe\u8ba1\u4e3a <code>final</code> \u53ef\u4ee5\u786e\u4fdd\u6240\u6709 <code>String</code> \u5bf9\u8c61\u90fd\u9075\u5faa\u76f8\u540c\u7684\u89c4\u5219\uff0c\u907f\u514d\u56e0\u7ee7\u627f\u548c\u591a\u6001\u5bfc\u81f4\u7684\u610f\u5916\u884c\u4e3a\u3002</p>"},{"location":"010Java/010Basic/#5","title":"5. \u9632\u6b62\u65b9\u6cd5\u91cd\u5199","text":"<p><code>String</code> \u7c7b\u4e2d\u6709\u4e00\u4e9b\u5173\u952e\u65b9\u6cd5\uff08\u5982 <code>equals</code>\u3001<code>hashCode</code>\u3001<code>compareTo</code> \u7b49\uff09\uff0c\u8fd9\u4e9b\u65b9\u6cd5\u7684\u884c\u4e3a\u5fc5\u987b\u4e25\u683c\u9075\u5faa\u89c4\u8303\u3002\u5982\u679c <code>String</code> \u4e0d\u662f <code>final</code>\uff0c\u5b50\u7c7b\u53ef\u80fd\u4f1a\u91cd\u5199\u8fd9\u4e9b\u65b9\u6cd5\uff0c\u5bfc\u81f4\u7a0b\u5e8f\u884c\u4e3a\u5f02\u5e38\u3002</p>"},{"location":"010Java/010Basic/#_12","title":"\u793a\u4f8b","text":"<p><pre><code>public class BadString extends String {\n    @Override\n    public boolean equals(Object obj) {\n        // \u91cd\u5199 equals \u65b9\u6cd5\uff0c\u7834\u574f\u5176\u5951\u7ea6\n        return false;\n    }\n}\n</code></pre> \u5982\u679c\u5141\u8bb8\u8fd9\u79cd\u884c\u4e3a\uff0c<code>String</code> \u7684 <code>equals</code> \u65b9\u6cd5\u5c06\u5931\u53bb\u5176\u610f\u4e49\u3002</p>"},{"location":"010Java/010Basic/#_13","title":"\u603b\u7ed3","text":"<p><code>String</code> \u7c7b\u88ab\u8bbe\u8ba1\u4e3a <code>final</code> \u7684\u4e3b\u8981\u539f\u56e0\u5305\u62ec\uff1a 1. \u786e\u4fdd\u4e0d\u53ef\u53d8\u6027\uff1a\u9632\u6b62\u5b50\u7c7b\u7834\u574f <code>String</code> \u7684\u4e0d\u53ef\u53d8\u6027\u3002 2. \u5b89\u5168\u6027\uff1a\u9632\u6b62\u6076\u610f\u4ee3\u7801\u901a\u8fc7\u7ee7\u627f <code>String</code> \u7be1\u6539\u5173\u952e\u6570\u636e\u3002 3. \u6027\u80fd\u4f18\u5316\uff1a\u652f\u6301\u5b57\u7b26\u4e32\u5e38\u91cf\u6c60\u3001\u54c8\u5e0c\u503c\u7f13\u5b58\u7b49\u4f18\u5316\u3002 4. \u8bbe\u8ba1\u4e00\u81f4\u6027\uff1a\u786e\u4fdd <code>String</code> \u7684\u884c\u4e3a\u4e00\u81f4\u4e14\u53ef\u9884\u6d4b\u3002 5. \u9632\u6b62\u65b9\u6cd5\u91cd\u5199\uff1a\u907f\u514d\u5b50\u7c7b\u91cd\u5199\u5173\u952e\u65b9\u6cd5\u5bfc\u81f4\u7a0b\u5e8f\u884c\u4e3a\u5f02\u5e38\u3002</p> <p>\u901a\u8fc7\u5c06 <code>String</code> \u8bbe\u8ba1\u4e3a <code>final</code>\uff0cJava \u786e\u4fdd\u4e86 <code>String</code> \u7684\u7a33\u5b9a\u6027\u3001\u5b89\u5168\u6027\u548c\u9ad8\u6027\u80fd\uff0c\u4f7f\u5176\u6210\u4e3a Java \u4e2d\u6700\u91cd\u8981\u548c\u6700\u5e38\u7528\u7684\u7c7b\u4e4b\u4e00\u3002</p>"},{"location":"010Java/010Basic/#string-a-hello-string-b-new-stringhello","title":"String a = \"Hello\", String b = new String(\"Hello\") \u4f7f\u7528 \"==\" \u65f6\uff0c\u5b83\u4eec\u76f8\u7b49\u5417\uff1f\u4e3a\u4ec0\u4e48\uff1f\u4ec0\u4e48\u539f\u7406\uff1f","text":"\u7b54\u6848 <p>\u4e0d\u76f8\u7b49\uff0c\u4e00\u4e2a\u5728\u5e38\u91cf\u6c60\uff0c\u4e00\u4e2a\u5728\u5806\u91cc\u3002\u5185\u5b58\u5730\u5740\u4e0d\u4e00\u81f4\u3002</p>"},{"location":"010Java/010Basic/#jvm","title":"JVM\u5e38\u91cf\u6c60\uff0c\u5806\uff0c\u6808","text":"\u7b54\u6848 <p>\u5728Java\u4e2d\uff0c\u5185\u5b58\u7ba1\u7406\u4e3b\u8981\u7531JVM\uff08Java\u865a\u62df\u673a\uff09\u8d1f\u8d23\u3002JVM\u5c06\u5185\u5b58\u5212\u5206\u4e3a\u4e0d\u540c\u7684\u533a\u57df\uff0c\u4e3b\u8981\u5305\u62ec\u5e38\u91cf\u6c60\u3001\u5806\u3001\u6808\u7b49\u3002\u8fd9\u4e9b\u5185\u5b58\u533a\u57df\u5404\u6709\u4e0d\u540c\u7684\u4f5c\u7528\uff0c\u4e0b\u9762\u8be6\u7ec6\u89e3\u91ca\u5b83\u4eec\u7684\u529f\u80fd\uff0c\u5e76\u901a\u8fc7\u6848\u4f8b\u8bf4\u660e\u3002</p>"},{"location":"010Java/010Basic/#1-constant-pool","title":"1. \u5e38\u91cf\u6c60\uff08Constant Pool\uff09","text":"<p>\u4f5c\u7528\uff1a - \u5e38\u91cf\u6c60\u662fJVM\u4e2d\u7684\u4e00\u5757\u7279\u6b8a\u5185\u5b58\u533a\u57df\uff0c\u7528\u4e8e\u5b58\u50a8\u7f16\u8bd1\u671f\u751f\u6210\u7684\u5404\u79cd\u5b57\u9762\u91cf\u548c\u7b26\u53f7\u5f15\u7528\u3002 - \u5b57\u9762\u91cf\u5305\u62ec\u5b57\u7b26\u4e32\u3001final\u5e38\u91cf\u3001\u7c7b\u548c\u63a5\u53e3\u7684\u5168\u9650\u5b9a\u540d\u3001\u5b57\u6bb5\u548c\u65b9\u6cd5\u7684\u540d\u79f0\u548c\u63cf\u8ff0\u7b26\u7b49\u3002 - \u5e38\u91cf\u6c60\u662f\u65b9\u6cd5\u533a\u7684\u4e00\u90e8\u5206\uff0c\u5728Java 8\u4e4b\u524d\uff0c\u65b9\u6cd5\u533a\u662f\u6c38\u4e45\u4ee3\uff08PermGen\uff09\u7684\u4e00\u90e8\u5206\uff0c\u800c\u5728Java 8\u53ca\u4e4b\u540e\uff0c\u65b9\u6cd5\u533a\u88ab\u5143\u7a7a\u95f4\uff08Metaspace\uff09\u53d6\u4ee3\u3002</p> <p>\u6848\u4f8b\uff1a <pre><code>String str1 = \"Hello\";\nString str2 = \"Hello\";\nSystem.out.println(str1 == str2); // true\n</code></pre> - \u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0c\u5b57\u7b26\u4e32<code>\"Hello\"</code>\u4f1a\u88ab\u5b58\u50a8\u5728\u5e38\u91cf\u6c60\u4e2d\u3002<code>str1</code>\u548c<code>str2</code>\u90fd\u6307\u5411\u5e38\u91cf\u6c60\u4e2d\u7684\u540c\u4e00\u4e2a\u5b57\u7b26\u4e32\u5bf9\u8c61\uff0c\u56e0\u6b64<code>str1 == str2</code>\u4e3a<code>true</code>\u3002</p>"},{"location":"010Java/010Basic/#2-heap","title":"2. \u5806\uff08Heap\uff09","text":"<p>\u4f5c\u7528\uff1a - \u5806\u662fJVM\u4e2d\u6700\u5927\u7684\u4e00\u5757\u5185\u5b58\u533a\u57df\uff0c\u7528\u4e8e\u5b58\u50a8\u5bf9\u8c61\u5b9e\u4f8b\u548c\u6570\u7ec4\u3002 - \u6240\u6709\u901a\u8fc7<code>new</code>\u5173\u952e\u5b57\u521b\u5efa\u7684\u5bf9\u8c61\u90fd\u4f1a\u5206\u914d\u5728\u5806\u4e2d\u3002 - \u5806\u662f\u7ebf\u7a0b\u5171\u4eab\u7684\uff0c\u56e0\u6b64\u9700\u8981\u8003\u8651\u7ebf\u7a0b\u5b89\u5168\u95ee\u9898\u3002 - \u5806\u5185\u5b58\u5206\u4e3a\u65b0\u751f\u4ee3\uff08Young Generation\uff09\u548c\u8001\u5e74\u4ee3\uff08Old Generation\uff09\uff0c\u65b0\u751f\u4ee3\u53c8\u5206\u4e3aEden\u533a\u3001Survivor\u533a\uff08From\u548cTo\uff09\u3002</p> <p>\u6848\u4f8b\uff1a <pre><code>Object obj = new Object();\n</code></pre> - \u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0c<code>new Object()</code>\u4f1a\u5728\u5806\u4e2d\u521b\u5efa\u4e00\u4e2a\u5bf9\u8c61\u5b9e\u4f8b\uff0c<code>obj</code>\u53d8\u91cf\u5b58\u50a8\u7684\u662f\u8be5\u5bf9\u8c61\u5728\u5806\u4e2d\u7684\u5f15\u7528\u3002</p>"},{"location":"010Java/010Basic/#3-stack","title":"3. \u6808\uff08Stack\uff09","text":"<p>\u4f5c\u7528\uff1a - \u6808\u662f\u7ebf\u7a0b\u79c1\u6709\u7684\u5185\u5b58\u533a\u57df\uff0c\u6bcf\u4e2a\u7ebf\u7a0b\u90fd\u6709\u81ea\u5df1\u7684\u6808\u3002 - \u6808\u7528\u4e8e\u5b58\u50a8\u5c40\u90e8\u53d8\u91cf\u3001\u65b9\u6cd5\u8c03\u7528\u548c\u90e8\u5206\u7ed3\u679c\u3002 - \u6808\u4e2d\u7684\u6bcf\u4e2a\u65b9\u6cd5\u8c03\u7528\u4f1a\u521b\u5efa\u4e00\u4e2a\u6808\u5e27\uff08Stack Frame\uff09\uff0c\u6808\u5e27\u4e2d\u5b58\u50a8\u5c40\u90e8\u53d8\u91cf\u8868\u3001\u64cd\u4f5c\u6570\u6808\u3001\u52a8\u6001\u94fe\u63a5\u548c\u65b9\u6cd5\u8fd4\u56de\u5730\u5740\u7b49\u4fe1\u606f\u3002 - \u6808\u7684\u5185\u5b58\u5206\u914d\u548c\u56de\u6536\u662f\u81ea\u52a8\u7684\uff0c\u65b9\u6cd5\u8c03\u7528\u7ed3\u675f\u65f6\uff0c\u6808\u5e27\u4f1a\u81ea\u52a8\u5f39\u51fa\u3002</p> <p>\u6848\u4f8b\uff1a <pre><code>public void method() {\n    int a = 10;\n    int b = 20;\n    int c = a + b;\n    System.out.println(c);\n}\n</code></pre> - \u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0c<code>method</code>\u65b9\u6cd5\u88ab\u8c03\u7528\u65f6\uff0cJVM\u4f1a\u4e3a\u8be5\u65b9\u6cd5\u521b\u5efa\u4e00\u4e2a\u6808\u5e27\uff0c\u6808\u5e27\u4e2d\u5b58\u50a8\u5c40\u90e8\u53d8\u91cf<code>a</code>\u3001<code>b</code>\u548c<code>c</code>\u3002\u65b9\u6cd5\u6267\u884c\u5b8c\u6bd5\u540e\uff0c\u6808\u5e27\u4f1a\u88ab\u5f39\u51fa\uff0c\u5c40\u90e8\u53d8\u91cf\u4e5f\u968f\u4e4b\u9500\u6bc1\u3002</p>"},{"location":"010Java/010Basic/#4-method-area","title":"4. \u65b9\u6cd5\u533a\uff08Method Area\uff09","text":"<p>\u4f5c\u7528\uff1a - \u65b9\u6cd5\u533a\u662f\u7ebf\u7a0b\u5171\u4eab\u7684\u5185\u5b58\u533a\u57df\uff0c\u7528\u4e8e\u5b58\u50a8\u7c7b\u7684\u5143\u6570\u636e\uff08\u5982\u7c7b\u4fe1\u606f\u3001\u5e38\u91cf\u3001\u9759\u6001\u53d8\u91cf\u3001\u5373\u65f6\u7f16\u8bd1\u5668\u7f16\u8bd1\u540e\u7684\u4ee3\u7801\u7b49\uff09\u3002 - \u5728Java 8\u4e4b\u524d\uff0c\u65b9\u6cd5\u533a\u662f\u6c38\u4e45\u4ee3\uff08PermGen\uff09\u7684\u4e00\u90e8\u5206\uff0c\u800c\u5728Java 8\u53ca\u4e4b\u540e\uff0c\u65b9\u6cd5\u533a\u88ab\u5143\u7a7a\u95f4\uff08Metaspace\uff09\u53d6\u4ee3\uff0c\u5143\u7a7a\u95f4\u4f7f\u7528\u672c\u5730\u5185\u5b58\u3002</p> <p>\u6848\u4f8b\uff1a <pre><code>public class MyClass {\n    public static final int CONSTANT = 100;\n    public static void main(String[] args) {\n        System.out.println(CONSTANT);\n    }\n}\n</code></pre> - \u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0c<code>CONSTANT</code>\u662f\u4e00\u4e2a\u9759\u6001\u5e38\u91cf\uff0c\u5b83\u4f1a\u88ab\u5b58\u50a8\u5728\u65b9\u6cd5\u533a\u4e2d\u3002<code>MyClass</code>\u7c7b\u7684\u5143\u6570\u636e\uff08\u5982\u7c7b\u540d\u3001\u65b9\u6cd5\u4fe1\u606f\u7b49\uff09\u4e5f\u4f1a\u5b58\u50a8\u5728\u65b9\u6cd5\u533a\u3002</p>"},{"location":"010Java/010Basic/#5-native-method-stack","title":"5. \u672c\u5730\u65b9\u6cd5\u6808\uff08Native Method Stack\uff09","text":"<p>\u4f5c\u7528\uff1a - \u672c\u5730\u65b9\u6cd5\u6808\u4e0e\u6808\u7c7b\u4f3c\uff0c\u4f46\u5b83\u662f\u4e3aJVM\u8c03\u7528\u672c\u5730\u65b9\u6cd5\uff08Native Method\uff09\u670d\u52a1\u7684\u3002 - \u672c\u5730\u65b9\u6cd5\u6808\u5b58\u50a8\u7684\u662f\u672c\u5730\u65b9\u6cd5\u7684\u8c03\u7528\u4fe1\u606f\u3002</p> <p>\u6848\u4f8b\uff1a - \u5f53\u4f60\u8c03\u7528\u4e00\u4e2a\u7528C/C++\u7f16\u5199\u7684\u672c\u5730\u65b9\u6cd5\u65f6\uff0cJVM\u4f1a\u4f7f\u7528\u672c\u5730\u65b9\u6cd5\u6808\u6765\u7ba1\u7406\u8fd9\u4e9b\u65b9\u6cd5\u7684\u8c03\u7528\u3002</p>"},{"location":"010Java/010Basic/#_14","title":"\u603b\u7ed3","text":"<ul> <li>\u5e38\u91cf\u6c60\uff1a\u5b58\u50a8\u7f16\u8bd1\u671f\u751f\u6210\u7684\u5b57\u9762\u91cf\u548c\u7b26\u53f7\u5f15\u7528\u3002</li> <li>\u5806\uff1a\u5b58\u50a8\u5bf9\u8c61\u5b9e\u4f8b\u548c\u6570\u7ec4\uff0c\u662f\u7ebf\u7a0b\u5171\u4eab\u7684\u3002</li> <li>\u6808\uff1a\u5b58\u50a8\u5c40\u90e8\u53d8\u91cf\u548c\u65b9\u6cd5\u8c03\u7528\uff0c\u662f\u7ebf\u7a0b\u79c1\u6709\u7684\u3002</li> <li>\u65b9\u6cd5\u533a\uff1a\u5b58\u50a8\u7c7b\u7684\u5143\u6570\u636e\u548c\u9759\u6001\u53d8\u91cf\uff0c\u662f\u7ebf\u7a0b\u5171\u4eab\u7684\u3002</li> <li>\u672c\u5730\u65b9\u6cd5\u6808\uff1a\u7528\u4e8e\u652f\u6301\u672c\u5730\u65b9\u6cd5\u7684\u8c03\u7528\u3002</li> </ul> <p>\u8fd9\u4e9b\u5185\u5b58\u533a\u57df\u5171\u540c\u534f\u4f5c\uff0c\u786e\u4fddJava\u7a0b\u5e8f\u80fd\u591f\u9ad8\u6548\u8fd0\u884c\u3002\u7406\u89e3\u5b83\u4eec\u7684\u4f5c\u7528\u6709\u52a9\u4e8e\u66f4\u597d\u5730\u8fdb\u884c\u5185\u5b58\u7ba1\u7406\u548c\u6027\u80fd\u4f18\u5316\u3002</p>"},{"location":"010Java/010Basic/#_15","title":"\u5e38\u91cf\u6c60","text":"\u7b54\u6848 <p>https://blog.csdn.net/qq_41376740/article/details/80338158</p>"},{"location":"010Java/010Basic/#java_1","title":"Java\u57fa\u7840\u7c7b\u578b\u6709\u54ea\u4e9b\uff1f","text":"\u7b54\u6848 <pre><code>Java\u67098\u79cd\u57fa\u672c\u6570\u636e\u7c7b\u578b\uff1a\n- byte\uff1a8\u4f4d\uff0c-128\u5230127\n- short\uff1a16\u4f4d\uff0c-32,768\u523032,767\n- int\uff1a32\u4f4d\uff0c-2^31\u52302^31-1\n- long\uff1a64\u4f4d\uff0c-2^63\u52302^63-1\n- float\uff1a32\u4f4d\uff0c\u5355\u7cbe\u5ea6\u6d6e\u70b9\n- double\uff1a64\u4f4d\uff0c\u53cc\u7cbe\u5ea6\u6d6e\u70b9\n- char\uff1a16\u4f4d\uff0c\u8868\u793a\u4e00\u4e2aUnicode\u5b57\u7b26\n- boolean\uff1a\u8868\u793atrue/false\n\n\u57fa\u672c\u7c7b\u578b\u7684\u5305\u88c5\u7c7b\u5206\u522b\u662f\uff1aByte, Short, Integer, Long, Float, Double, Character\u548cBoolean\n</code></pre>"},{"location":"010Java/010Basic/#javaequals","title":"Java\u4e2dequals\u548c \"==\" \u7684\u533a\u522b\uff1f","text":"\u7b54\u6848 <p>\u6765\u6e90\u94fe\u63a5 https://www.cnblogs.com/smyhvae/p/3929585.html</p> <p>\u3010\u6b63\u6587\u3011 \u5e73\u65f6\u5728\u5b66Android\u548cJava\u8bed\u8a00\u7684\u65f6\u5019\uff0c\u603b\u662f\u78b0\u5230\u201cequals\u201d\u548c\u201c==\u201d\u8fd9\u4e24\u4e2a\u5b57\u7b26\uff0c\u8001\u611f\u89c9\u5dee\u4e0d\u591a\uff1b\u5176\u5b9e\u8fd8\u662f\u6709\u4e00\u4e9b\u533a\u522b\u7684\uff0c\u4eca\u5929\u5e72\u8106\u628a\u5b83\u4eec\u5f7b\u5e95\u5f04\u6e05\u695a\u3002</p> <p>\u4e00\u3001java\u5f53\u4e2d\u7684\u6570\u636e\u7c7b\u578b\u548c\u201c==\u201d\u7684\u542b\u4e49\uff1a - \u57fa\u672c\u6570\u636e\u7c7b\u578b\uff08\u4e5f\u79f0\u539f\u59cb\u6570\u636e\u7c7b\u578b\uff09 \uff1abyte,short,char,int,long,float,double,boolean\u3002\u4ed6\u4eec\u4e4b\u95f4\u7684\u6bd4\u8f83\uff0c\u5e94\u7528\u53cc\u7b49\u53f7\uff08==\uff09,\u6bd4\u8f83\u7684\u662f\u4ed6\u4eec\u7684\u503c\u3002</p> <ul> <li>\u5f15\u7528\u6570\u636e\u7c7b\u578b\uff1a\u5f53\u4ed6\u4eec\u7528\uff08==\uff09\u8fdb\u884c\u6bd4\u8f83\u7684\u65f6\u5019\uff0c\u6bd4\u8f83\u7684\u662f\u4ed6\u4eec\u5728\u5185\u5b58\u4e2d\u7684\u5b58\u653e\u5730\u5740\uff08\u786e\u5207\u7684\u8bf4\uff0c\u662f\u5806\u5185\u5b58\u5730\u5740\uff09\u3002</li> </ul> <p>\u6ce8\uff1a\u5bf9\u4e8e\u7b2c\u4e8c\u79cd\u7c7b\u578b\uff0c\u9664\u975e\u662f\u540c\u4e00\u4e2anew\u51fa\u6765\u7684\u5bf9\u8c61\uff0c\u4ed6\u4eec\u7684\u6bd4\u8f83\u540e\u7684\u7ed3\u679c\u4e3atrue\uff0c\u5426\u5219\u6bd4\u8f83\u540e\u7ed3\u679c\u4e3afalse\u3002\u56e0\u4e3a\u6bcfnew\u4e00\u6b21\uff0c\u90fd\u4f1a\u91cd\u65b0\u5f00\u8f9f\u5806\u5185\u5b58\u7a7a\u95f4\u3002</p> <p>\u4e8c\u3001equals()\u65b9\u6cd5\u4ecb\u7ecd\uff1a</p> <p>JAVA\u5f53\u4e2d\u6240\u6709\u7684\u7c7b\u90fd\u662f\u7ee7\u627f\u4e8eObject\u8fd9\u4e2a\u8d85\u7c7b\u7684\uff0c\u5728Object\u7c7b\u4e2d\u5b9a\u4e49\u4e86\u4e00\u4e2aequals\u7684\u65b9\u6cd5\uff0cequals\u7684\u6e90\u7801\u662f\u8fd9\u6837\u5199\u7684\uff1a public boolean equals(Object obj) {     //this - s1     //obj - s2     return (this == obj); }</p> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u8fd9\u4e2a\u65b9\u6cd5\u7684\u521d\u59cb\u9ed8\u8ba4\u884c\u4e3a\u662f\u6bd4\u8f83\u5bf9\u8c61\u7684\u5185\u5b58\u5730\u5740\u503c\uff0c\u4e00\u822c\u6765\u8bf4\uff0c\u610f\u4e49\u4e0d\u5927\u3002\u6240\u4ee5\uff0c\u5728\u4e00\u4e9b\u7c7b\u5e93\u5f53\u4e2d\u8fd9\u4e2a\u65b9\u6cd5\u88ab\u91cd\u5199\u4e86\uff0c\u5982String\u3001Integer\u3001Date\u3002\u5728\u8fd9\u4e9b\u7c7b\u5f53\u4e2dequals\u6709\u5176\u81ea\u8eab\u7684\u5b9e\u73b0\uff08\u4e00\u822c\u90fd\u662f\u7528\u6765\u6bd4\u8f83\u5bf9\u8c61\u7684\u6210\u5458\u53d8\u91cf\u503c\u662f\u5426\u76f8\u540c\uff09\uff0c\u800c\u4e0d\u518d\u662f\u6bd4\u8f83\u7c7b\u5728\u5806\u5185\u5b58\u4e2d\u7684\u5b58\u653e\u5730\u5740\u4e86\u3002\u00a0</p> <p>\u6240\u4ee5\u8bf4\uff0c\u5bf9\u4e8e\u590d\u5408\u6570\u636e\u7c7b\u578b\u4e4b\u95f4\u8fdb\u884cequals\u6bd4\u8f83\uff0c\u5728\u6ca1\u6709\u8986\u5199equals\u65b9\u6cd5\u7684\u60c5\u51b5\u4e0b\uff0c\u4ed6\u4eec\u4e4b\u95f4\u7684\u6bd4\u8f83\u8fd8\u662f\u5185\u5b58\u4e2d\u7684\u5b58\u653e\u4f4d\u7f6e\u7684\u5730\u5740\u503c\uff0c\u8ddf\u53cc\u7b49\u53f7\uff08==\uff09\u7684\u7ed3\u679c\u76f8\u540c\uff1b\u5982\u679c\u88ab\u590d\u5199\uff0c\u6309\u7167\u590d\u5199\u7684\u8981\u6c42\u6765\u3002</p> <p>\u6211\u4eec\u5bf9\u4e0a\u9762\u7684\u4e24\u6bb5\u5185\u5bb9\u505a\u4e2a\u603b\u7ed3\u5427\uff1a</p> <p>== \u7684\u4f5c\u7528\uff1a</p> <p>\u57fa\u672c\u7c7b\u578b\uff1a\u6bd4\u8f83\u7684\u5c31\u662f\u503c\u662f\u5426\u76f8\u540c</p> <p>\u5f15\u7528\u7c7b\u578b\uff1a\u6bd4\u8f83\u7684\u5c31\u662f\u5730\u5740\u503c\u662f\u5426\u76f8\u540c</p> <p>equals \u7684\u4f5c\u7528:</p> <p>\u5f15\u7528\u7c7b\u578b\uff1a\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u6bd4\u8f83\u7684\u662f\u5730\u5740\u503c\u3002</p> <p>\u6ce8\uff1a\u4e0d\u8fc7\uff0c\u6211\u4eec\u53ef\u4ee5\u6839\u636e\u60c5\u51b5\u81ea\u5df1\u91cd\u5199\u8be5\u65b9\u6cd5\u3002\u4e00\u822c\u91cd\u5199\u90fd\u662f\u81ea\u52a8\u751f\u6210\uff0c\u6bd4\u8f83\u5bf9\u8c61\u7684\u6210\u5458\u53d8\u91cf\u503c\u662f\u5426\u76f8\u540c</p> <p>\u5173\u4e8eString\u4e2d\u7684equals\u65b9\u6cd5\u3002</p>"},{"location":"010Java/010Basic/#java-equals-hashcode","title":"Java\u4e2d == equals hashCode\u533a\u522b\u548c\u5173\u8054","text":"\u7b54\u6848 <p>Java\u4e2d\u7684\u6570\u636e\u7c7b\u578b\u53ef\u5206\u4e3a\u4e24\u7c7b\uff0c\u57fa\u672c\u6570\u636e\u7c7b\u578b\u548c\u5f15\u7528\u7c7b\u578b\u3002\u57fa\u672c\u6570\u636e\u7c7b\u578b\uff1abyte\u3001short\u3001char\u3001int\u3001long\u3001float\u3001double\u3001boolean\u3002\u4ed6\u4eec\u4e4b\u95f4\u7684\u6bd4\u8f83\u7528\u53cc\u7b49\u53f7\uff08==\uff09\uff0c\u6bd4\u8f83\u7684\u662f\u503c\u3002\u5f15\u7528\u7c7b\u578b\uff1a\u7c7b\u3001\u63a5\u53e3\u3001\u6570\u7ec4\u3002\u5f53\u4ed6\u4eec\u7528\u53cc\u7b49\u53f7\uff08==\uff09\u8fdb\u884c\u6bd4\u8f83\u7684\u65f6\u5019\uff0c\u6bd4\u8f83\u7684\u662f\u4ed6\u4eec\u5728\u5185\u5b58\u4e2d\u7684\u5b58\u653e\u5730\u5740\u3002\u5bf9\u8c61\u662f\u653e\u5728\u5806\u4e2d\u7684\uff0c\u6808\u4e2d\u5b58\u653e\u7684\u662f\u5bf9\u8c61\u7684\u5f15\u7528\uff08\u5730\u5740\uff09\u3002\u7531\u6b64\u53ef\u89c1\uff0c\u53cc\u7b49\u53f7\u662f\u5bf9\u6808\u4e2d\u7684\u503c\u8fdb\u884c\u6bd4\u8f83\u7684\u3002\u5982\u679c\u8981\u6bd4\u8f83\u5806\u4e2d\u5bf9\u8c61\u662f\u5426\u76f8\u540c\uff0c\u90a3\u4e48\u5c31\u8981\u91cd\u5199equals\u65b9\u6cd5\u4e86\u3002</p> <p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff08\u6ca1\u6709\u8986\u76d6equals\u65b9\u6cd5\uff09\u4e0b\u7684equals\u65b9\u6cd5\u90fd\u662f\u8c03\u7528Object\u7c7b\u7684equals\u65b9\u6cd5\uff0c\u800cObject\u7684equals\u65b9\u6cd5\u4e3b\u8981\u662f\u7528\u4e8e\u5224\u65ad\u5bf9\u8c61\u7684\u5185\u5b58\u5730\u5740\u5f15\u7528\u662f\u4e0d\u662f\u540c\u4e00\u4e2a\u5730\u5740\uff08\u662f\u4e0d\u662f\u540c\u4e00\u4e2a\u5bf9\u8c61\uff09\u3002\u4e0b\u9762\u662fObject\u7c7b\u4e2d\u7684equals\u65b9\u6cd5\uff1a</p> <p>public boolean equals(Object obj) {     return (this == obj); }  \u5b9a\u4e49\u7684equals\u65b9\u6cd5\u4e0e==\u662f\u7b49\u6548\u7684\u3002</p> <p>\u4f46\u662f\uff0c\u8981\u662f\u7c7b\u4e2d\u8986\u76d6\u4e86equals\u65b9\u6cd5\uff0c\u90a3\u4e48\u5c31\u8981\u6839\u636e\u5177\u4f53\u4ee3\u7801\u6765\u786e\u5b9aequals\u65b9\u6cd5\u7684\u4f5c\u7528\u4e86\u3002\u8986\u76d6\u540e\u7684\u4e00\u822c\u90fd\u662f\u901a\u8fc7\u5bf9\u8c61\u7684\u5185\u5bb9\u662f\u5426\u76f8\u7b49\u6765\u5224\u65ad\u5bf9\u8c61\u662f\u5426\u76f8\u7b49\u3002\u4e0b\u9762\u662fString\u7c7b\u5bf9equals\u65b9\u6cd5\u8fdb\u884c\u4e86\u91cd\u5199\uff1a</p> <p>public boolean equals(Object anObject) {     if (this == anObject) {         return true;     }     if (anObject instanceof String) {         String anotherString = (String)anObject;         int n = count;         if (n == anotherString.count) {         char v1[] = value;         char v2[] = anotherString.value;         int i = offset;         int j = anotherString.offset;         while (n-- != 0) {             if (v1[i++] != v2[j++])             return false;         }         return true;         }     }     return false; } \u5728 Object#equals \u65b9\u6cd5\u6ce8\u91ca\u4e0a\uff0c\u4e5f\u7ed9\u51fa\u4e86\u91cd\u5199 equals \u51fd\u6570\u8981\u9075\u5b88\u7684\u89c4\u5219\uff1a\u81ea\u53cd\u6027\u3001\u5bf9\u79f0\u6027\u3001\u4f20\u9012\u6027\u548c\u4e00\u81f4\u6027\uff0c\u5e76\u4e14\u7ed9\u51fa\u4e86\u5177\u4f53\u793a\u4f8b\u3002\u6ce8\u91ca\u4e2d\u8fd8\u7ed9\u51fa\u4e86\uff0c\u91cd\u5199 equals \u65b9\u6cd5\u65f6\u4e5f\u8981\u91cd\u5199 hashCode \u65b9\u6cd5\uff0c\u4ece\u800c\u7ef4\u6301 hashCode \u7684\u8bed\u4e49\uff0c\u5373\u5982\u679c\u5bf9\u8c61\u76f8\u7b49\uff0c\u90a3\u4e48\u4ed6\u4eec\u7684\u54c8\u5e0c\u503c\u5fc5\u987b\u76f8\u540c\u3002</p> <p>hashCode()\u65b9\u6cd5\u8fd4\u56de\u7684\u5c31\u662f\u4e00\u4e2a\u6570\u503c\uff0c\u4ece\u65b9\u6cd5\u540d\u4e0a\u6765\u770b\uff0c\u5176\u76ee\u7684\u5c31\u662f\u751f\u6210\u4e00\u4e2ahash\u7801\uff0chash\u7801\u7684\u4e3b\u8981\u7528\u9014\u5c31\u662f\u5728\u5bf9\u5bf9\u8c61\u8fdb\u884c\u6563\u5217\u7684\u65f6\u5019\u4f5c\u4e3akey\u8f93\u5165\u3002</p> <p>\u53c2\u8003\u81ea\uff1ahttp://blog.csdn.net/hla199106/article/details/46907725</p>"},{"location":"010Java/010Basic/#java_2","title":"Java\u6cdb\u578b\u7684\u4f5c\u7528\u53ca\u4f7f\u7528\u573a\u666f","text":"\u7b54\u6848 <p>Java\u6cdb\u578b\uff08Generics\uff09\u662fJava 5\u5f15\u5165\u7684\u4e00\u9879\u91cd\u8981\u7279\u6027\uff0c\u5b83\u5141\u8bb8\u5728\u5b9a\u4e49\u7c7b\u3001\u63a5\u53e3\u548c\u65b9\u6cd5\u65f6\u4f7f\u7528\u7c7b\u578b\u53c2\u6570\uff0c\u4ece\u800c\u4f7f\u4ee3\u7801\u66f4\u52a0\u901a\u7528\u3001\u7c7b\u578b\u5b89\u5168\uff0c\u5e76\u51cf\u5c11\u7c7b\u578b\u8f6c\u6362\u7684\u9700\u6c42\u3002\u6cdb\u578b\u7684\u4e3b\u8981\u4f5c\u7528\u662f\u589e\u5f3a\u4ee3\u7801\u7684\u53ef\u91cd\u7528\u6027\u548c\u7c7b\u578b\u5b89\u5168\u6027\u3002</p>"},{"location":"010Java/010Basic/#_16","title":"\u6cdb\u578b\u7684\u4f5c\u7528","text":"<ol> <li>\u7c7b\u578b\u5b89\u5168\uff1a</li> <li>\u6cdb\u578b\u5728\u7f16\u8bd1\u65f6\u8fdb\u884c\u7c7b\u578b\u68c0\u67e5\uff0c\u786e\u4fdd\u53ea\u6709\u6307\u5b9a\u7c7b\u578b\u7684\u5bf9\u8c61\u53ef\u4ee5\u88ab\u4f7f\u7528\uff0c\u4ece\u800c\u907f\u514d\u8fd0\u884c\u65f6\u7684<code>ClassCastException</code>\u3002</li> <li> <p>\u4f8b\u5982\uff0c\u4f7f\u7528<code>List&lt;String&gt;</code>\u53ef\u4ee5\u786e\u4fdd\u5217\u8868\u4e2d\u53ea\u80fd\u5b58\u50a8<code>String</code>\u7c7b\u578b\u7684\u5bf9\u8c61\u3002</p> </li> <li> <p>\u4ee3\u7801\u590d\u7528\uff1a</p> </li> <li>\u6cdb\u578b\u5141\u8bb8\u7f16\u5199\u901a\u7528\u7684\u4ee3\u7801\uff0c\u9002\u7528\u4e8e\u591a\u79cd\u7c7b\u578b\uff0c\u800c\u4e0d\u9700\u8981\u4e3a\u6bcf\u79cd\u7c7b\u578b\u7f16\u5199\u91cd\u590d\u7684\u4ee3\u7801\u3002</li> <li> <p>\u4f8b\u5982\uff0c\u53ef\u4ee5\u7f16\u5199\u4e00\u4e2a\u901a\u7528\u7684<code>Box&lt;T&gt;</code>\u7c7b\uff0c\u7528\u4e8e\u5b58\u50a8\u4efb\u4f55\u7c7b\u578b\u7684\u5bf9\u8c61\u3002</p> </li> <li> <p>\u51cf\u5c11\u7c7b\u578b\u8f6c\u6362\uff1a</p> </li> <li>\u4f7f\u7528\u6cdb\u578b\u540e\uff0c\u7f16\u8bd1\u5668\u4f1a\u81ea\u52a8\u63d2\u5165\u7c7b\u578b\u8f6c\u6362\u4ee3\u7801\uff0c\u51cf\u5c11\u4e86\u624b\u52a8\u7c7b\u578b\u8f6c\u6362\u7684\u9700\u6c42\u3002</li> <li> <p>\u4f8b\u5982\uff0c\u4ece<code>List&lt;String&gt;</code>\u4e2d\u83b7\u53d6\u5143\u7d20\u65f6\uff0c\u4e0d\u9700\u8981\u624b\u52a8\u5c06<code>Object</code>\u8f6c\u6362\u4e3a<code>String</code>\u3002</p> </li> <li> <p>\u589e\u5f3a\u4ee3\u7801\u53ef\u8bfb\u6027\uff1a</p> </li> <li>\u6cdb\u578b\u4f7f\u4ee3\u7801\u66f4\u52a0\u6e05\u6670\uff0c\u7c7b\u578b\u4fe1\u606f\u4e00\u76ee\u4e86\u7136\uff0c\u63d0\u9ad8\u4e86\u4ee3\u7801\u7684\u53ef\u8bfb\u6027\u548c\u53ef\u7ef4\u62a4\u6027\u3002</li> </ol>"},{"location":"010Java/010Basic/#_17","title":"\u6cdb\u578b\u7684\u4f7f\u7528\u573a\u666f","text":"<ol> <li>\u96c6\u5408\u7c7b\uff08Collections\uff09\uff1a</li> <li>Java\u96c6\u5408\u6846\u67b6\u4e2d\u7684\u7c7b\uff08\u5982<code>List</code>\u3001<code>Set</code>\u3001<code>Map</code>\u7b49\uff09\u90fd\u4f7f\u7528\u4e86\u6cdb\u578b\u3002\u901a\u8fc7\u6cdb\u578b\uff0c\u53ef\u4ee5\u6307\u5b9a\u96c6\u5408\u4e2d\u5b58\u50a8\u7684\u5143\u7d20\u7c7b\u578b\u3002</li> <li> <p>\u4f8b\u5982\uff1a     <pre><code>List&lt;String&gt; list = new ArrayList&lt;&gt;();\nlist.add(\"Hello\");\nString str = list.get(0); // \u4e0d\u9700\u8981\u7c7b\u578b\u8f6c\u6362\n</code></pre></p> </li> <li> <p>\u81ea\u5b9a\u4e49\u6cdb\u578b\u7c7b\u548c\u63a5\u53e3\uff1a</p> </li> <li>\u53ef\u4ee5\u5b9a\u4e49\u81ea\u5df1\u7684\u6cdb\u578b\u7c7b\u6216\u63a5\u53e3\uff0c\u4ee5\u9002\u5e94\u4e0d\u540c\u7684\u7c7b\u578b\u9700\u6c42\u3002</li> <li> <p>\u4f8b\u5982\uff1a     <pre><code>public class Box&lt;T&gt; {\n    private T item;\n\n    public void setItem(T item) {\n        this.item = item;\n    }\n\n    public T getItem() {\n        return item;\n    }\n}\n\nBox&lt;String&gt; stringBox = new Box&lt;&gt;();\nstringBox.setItem(\"Generic Box\");\nString item = stringBox.getItem();\n</code></pre></p> </li> <li> <p>\u6cdb\u578b\u65b9\u6cd5\uff1a</p> </li> <li>\u53ef\u4ee5\u5728\u65b9\u6cd5\u4e2d\u4f7f\u7528\u6cdb\u578b\uff0c\u4f7f\u65b9\u6cd5\u80fd\u591f\u5904\u7406\u4e0d\u540c\u7c7b\u578b\u7684\u53c2\u6570\u3002</li> <li> <p>\u4f8b\u5982\uff1a     <pre><code>public &lt;T&gt; void printArray(T[] array) {\n    for (T element : array) {\n        System.out.println(element);\n    }\n}\n\nInteger[] intArray = {1, 2, 3};\nString[] strArray = {\"A\", \"B\", \"C\"};\nprintArray(intArray);\nprintArray(strArray);\n</code></pre></p> </li> <li> <p>\u6cdb\u578b\u4e0e\u7ee7\u627f\uff1a</p> </li> <li>\u6cdb\u578b\u53ef\u4ee5\u4e0e\u7ee7\u627f\u7ed3\u5408\u4f7f\u7528\uff0c\u521b\u5efa\u66f4\u52a0\u7075\u6d3b\u7684\u7c7b\u5c42\u6b21\u7ed3\u6784\u3002</li> <li> <p>\u4f8b\u5982\uff1a     <pre><code>public class Animal {}\npublic class Dog extends Animal {}\n\npublic class Cage&lt;T extends Animal&gt; {\n    private T animal;\n\n    public void setAnimal(T animal) {\n        this.animal = animal;\n    }\n\n    public T getAnimal() {\n        return animal;\n    }\n}\n\nCage&lt;Dog&gt; dogCage = new Cage&lt;&gt;();\ndogCage.setAnimal(new Dog());\n</code></pre></p> </li> <li> <p>\u901a\u914d\u7b26\uff08Wildcards\uff09\uff1a</p> </li> <li>\u6cdb\u578b\u901a\u914d\u7b26\uff08<code>?</code>\uff09\u7528\u4e8e\u8868\u793a\u672a\u77e5\u7c7b\u578b\uff0c\u901a\u5e38\u7528\u4e8e\u65b9\u6cd5\u53c2\u6570\u4e2d\uff0c\u4ee5\u589e\u52a0\u7075\u6d3b\u6027\u3002</li> <li> <p>\u4f8b\u5982\uff1a     <pre><code>public void printList(List&lt;?&gt; list) {\n    for (Object elem : list) {\n        System.out.println(elem);\n    }\n}\n\nList&lt;Integer&gt; intList = Arrays.asList(1, 2, 3);\nList&lt;String&gt; strList = Arrays.asList(\"A\", \"B\", \"C\");\nprintList(intList);\nprintList(strList);\n</code></pre></p> </li> <li> <p>\u8fb9\u754c\u901a\u914d\u7b26\uff08Bounded Wildcards\uff09\uff1a</p> </li> <li>\u901a\u8fc7<code>&lt;? extends T&gt;</code>\u548c<code>&lt;? super T&gt;</code>\u53ef\u4ee5\u9650\u5236\u901a\u914d\u7b26\u7684\u8303\u56f4\uff0c\u589e\u52a0\u7c7b\u578b\u5b89\u5168\u6027\u3002</li> <li>\u4f8b\u5982\uff1a     <pre><code>public void processNumbers(List&lt;? extends Number&gt; numbers) {\n    for (Number number : numbers) {\n        System.out.println(number);\n    }\n}\n\nList&lt;Integer&gt; intList = Arrays.asList(1, 2, 3);\nList&lt;Double&gt; doubleList = Arrays.asList(1.1, 2.2, 3.3);\nprocessNumbers(intList);\nprocessNumbers(doubleList);\n</code></pre></li> </ol>"},{"location":"010Java/010Basic/#_18","title":"\u603b\u7ed3","text":"<p>Java\u6cdb\u578b\u901a\u8fc7\u7c7b\u578b\u53c2\u6570\u5316\u63d0\u9ad8\u4e86\u4ee3\u7801\u7684\u901a\u7528\u6027\u548c\u7c7b\u578b\u5b89\u5168\u6027\uff0c\u5e7f\u6cdb\u5e94\u7528\u4e8e\u96c6\u5408\u7c7b\u3001\u81ea\u5b9a\u4e49\u7c7b\u3001\u65b9\u6cd5\u7b49\u573a\u666f\u3002\u6cdb\u578b\u4e0d\u4ec5\u51cf\u5c11\u4e86\u7c7b\u578b\u8f6c\u6362\u7684\u9700\u6c42\uff0c\u8fd8\u589e\u5f3a\u4e86\u4ee3\u7801\u7684\u53ef\u8bfb\u6027\u548c\u53ef\u7ef4\u62a4\u6027\u3002\u5408\u7406\u4f7f\u7528\u6cdb\u578b\u53ef\u4ee5\u663e\u8457\u63d0\u5347Java\u7a0b\u5e8f\u7684\u5065\u58ee\u6027\u548c\u7075\u6d3b\u6027\u3002</p>"},{"location":"010Java/010Basic/#java_3","title":"Java\u679a\u4e3e\u7684\u7279\u70b9\u53ca\u4f7f\u7528\u573a\u666f","text":"\u7b54\u6848 <p>Java \u679a\u4e3e\uff08<code>enum</code>\uff09\u662f\u4e00\u79cd\u7279\u6b8a\u7684\u7c7b\uff0c\u7528\u4e8e\u5b9a\u4e49\u4e00\u7ec4\u56fa\u5b9a\u7684\u5e38\u91cf\u3002\u679a\u4e3e\u7c7b\u578b\u5728 Java 5 \u4e2d\u5f15\u5165\uff0c\u63d0\u4f9b\u4e86\u66f4\u5b89\u5168\u3001\u66f4\u53ef\u8bfb\u7684\u65b9\u5f0f\u6765\u5904\u7406\u5e38\u91cf\u3002\u4ee5\u4e0b\u662f Java \u679a\u4e3e\u7684\u7279\u70b9\u53ca\u4f7f\u7528\u573a\u666f\uff1a</p>"},{"location":"010Java/010Basic/#_19","title":"\u7279\u70b9","text":"<ol> <li>\u7c7b\u578b\u5b89\u5168\uff1a</li> <li> <p>\u679a\u4e3e\u63d0\u4f9b\u4e86\u4e00\u79cd\u7c7b\u578b\u5b89\u5168\u7684\u65b9\u5f0f\u6765\u5b9a\u4e49\u5e38\u91cf\u3002\u4e0e\u4f7f\u7528\u6574\u6570\u6216\u5b57\u7b26\u4e32\u5e38\u91cf\u76f8\u6bd4\uff0c\u679a\u4e3e\u53ef\u4ee5\u907f\u514d\u4f20\u5165\u65e0\u6548\u7684\u503c\u3002</p> </li> <li> <p>\u56fa\u5b9a\u7684\u5e38\u91cf\u96c6\u5408\uff1a</p> </li> <li> <p>\u679a\u4e3e\u5b9a\u4e49\u4e86\u4e00\u7ec4\u56fa\u5b9a\u7684\u5e38\u91cf\uff0c\u8fd9\u4e9b\u5e38\u91cf\u5728\u7f16\u8bd1\u65f6\u5c31\u5df2\u7ecf\u786e\u5b9a\uff0c\u4e0d\u80fd\u5728\u8fd0\u884c\u65f6\u4fee\u6539\u3002</p> </li> <li> <p>\u53ef\u6dfb\u52a0\u65b9\u6cd5\u548c\u5b57\u6bb5\uff1a</p> </li> <li> <p>\u679a\u4e3e\u53ef\u4ee5\u50cf\u666e\u901a\u7c7b\u4e00\u6837\u62e5\u6709\u5b57\u6bb5\u3001\u65b9\u6cd5\u548c\u6784\u9020\u51fd\u6570\u3002\u8fd9\u4f7f\u5f97\u679a\u4e3e\u4e0d\u4ec5\u53ef\u4ee5\u8868\u793a\u5e38\u91cf\uff0c\u8fd8\u53ef\u4ee5\u5c01\u88c5\u76f8\u5173\u7684\u884c\u4e3a\u3002</p> </li> <li> <p>\u5b9e\u73b0\u63a5\u53e3\uff1a</p> </li> <li> <p>\u679a\u4e3e\u53ef\u4ee5\u5b9e\u73b0\u63a5\u53e3\uff0c\u4ece\u800c\u63d0\u4f9b\u66f4\u591a\u7684\u7075\u6d3b\u6027\u548c\u529f\u80fd\u3002</p> </li> <li> <p>\u652f\u6301 switch \u8bed\u53e5\uff1a</p> </li> <li> <p>\u679a\u4e3e\u53ef\u4ee5\u4e0e <code>switch</code> \u8bed\u53e5\u4e00\u8d77\u4f7f\u7528\uff0c\u4f7f\u4ee3\u7801\u66f4\u7b80\u6d01\u548c\u6613\u8bfb\u3002</p> </li> <li> <p>\u5185\u7f6e\u65b9\u6cd5\uff1a</p> </li> <li> <p>\u679a\u4e3e\u63d0\u4f9b\u4e86\u5185\u7f6e\u65b9\u6cd5\uff0c\u5982 <code>values()</code> \u548c <code>valueOf()</code>\uff0c\u7528\u4e8e\u904d\u5386\u679a\u4e3e\u5e38\u91cf\u6216\u6839\u636e\u540d\u79f0\u83b7\u53d6\u679a\u4e3e\u5e38\u91cf\u3002</p> </li> <li> <p>\u5355\u4f8b\u6a21\u5f0f\uff1a</p> </li> <li>\u679a\u4e3e\u5e38\u91cf\u662f\u5355\u4f8b\u7684\uff0c\u6bcf\u4e2a\u679a\u4e3e\u5e38\u91cf\u5728 JVM \u4e2d\u53ea\u6709\u4e00\u4e2a\u5b9e\u4f8b\u3002\u8fd9\u4f7f\u5f97\u679a\u4e3e\u975e\u5e38\u9002\u5408\u5b9e\u73b0\u5355\u4f8b\u6a21\u5f0f\u3002</li> </ol>"},{"location":"010Java/010Basic/#_20","title":"\u4f7f\u7528\u573a\u666f","text":"<ol> <li>\u5b9a\u4e49\u5e38\u91cf\uff1a</li> <li>\u5f53\u9700\u8981\u5b9a\u4e49\u4e00\u7ec4\u76f8\u5173\u7684\u5e38\u91cf\u65f6\uff0c\u679a\u4e3e\u662f\u4e00\u4e2a\u7406\u60f3\u7684\u9009\u62e9\u3002\u4f8b\u5982\uff0c\u5b9a\u4e49\u661f\u671f\u51e0\u3001\u989c\u8272\u3001\u72b6\u6001\u7b49\u3002</li> </ol> <pre><code>public enum Day {\n    MONDAY, TUESDAY, WEDNESDAY, THURSDAY, FRIDAY, SATURDAY, SUNDAY\n}\n</code></pre> <ol> <li>\u72b6\u6001\u673a\uff1a</li> <li>\u679a\u4e3e\u53ef\u4ee5\u7528\u4e8e\u8868\u793a\u5bf9\u8c61\u7684\u72b6\u6001\uff0c\u5e76\u4e14\u53ef\u4ee5\u5728\u679a\u4e3e\u4e2d\u5b9a\u4e49\u72b6\u6001\u8f6c\u6362\u7684\u903b\u8f91\u3002</li> </ol> <pre><code>public enum State {\n    ON {\n        @Override\n        public State next() {\n            return OFF;\n        }\n    },\n    OFF {\n        @Override\n        public State next() {\n            return ON;\n        }\n    };\n\n    public abstract State next();\n}\n</code></pre> <ol> <li>\u7b56\u7565\u6a21\u5f0f\uff1a</li> <li>\u679a\u4e3e\u53ef\u4ee5\u7528\u4e8e\u5b9e\u73b0\u7b56\u7565\u6a21\u5f0f\uff0c\u6bcf\u4e2a\u679a\u4e3e\u5e38\u91cf\u4ee3\u8868\u4e00\u79cd\u7b56\u7565\uff0c\u5e76\u4e14\u53ef\u4ee5\u5c01\u88c5\u76f8\u5e94\u7684\u884c\u4e3a\u3002</li> </ol> <pre><code>public enum Operation {\n    PLUS {\n        public int apply(int a, int b) {\n            return a + b;\n        }\n    },\n    MINUS {\n        public int apply(int a, int b) {\n            return a - b;\n        }\n    };\n\n    public abstract int apply(int a, int b);\n}\n</code></pre> <ol> <li>\u5355\u4f8b\u6a21\u5f0f\uff1a</li> <li>\u679a\u4e3e\u662f\u5b9e\u73b0\u5355\u4f8b\u6a21\u5f0f\u7684\u6700\u4f73\u65b9\u5f0f\u4e4b\u4e00\uff0c\u56e0\u4e3a\u679a\u4e3e\u5e38\u91cf\u662f\u5355\u4f8b\u7684\uff0c\u5e76\u4e14\u7ebf\u7a0b\u5b89\u5168\u3002</li> </ol> <pre><code>public enum Singleton {\n    INSTANCE;\n\n    public void doSomething() {\n        // \u5355\u4f8b\u65b9\u6cd5\n    }\n}\n</code></pre> <ol> <li>\u547d\u4ee4\u6a21\u5f0f\uff1a</li> <li>\u679a\u4e3e\u53ef\u4ee5\u7528\u4e8e\u5b9e\u73b0\u547d\u4ee4\u6a21\u5f0f\uff0c\u6bcf\u4e2a\u679a\u4e3e\u5e38\u91cf\u4ee3\u8868\u4e00\u4e2a\u547d\u4ee4\uff0c\u5e76\u4e14\u53ef\u4ee5\u5c01\u88c5\u76f8\u5e94\u7684\u64cd\u4f5c\u3002</li> </ol> <pre><code>public enum Command {\n    START {\n        public void execute() {\n            System.out.println(\"Starting...\");\n        }\n    },\n    STOP {\n        public void execute() {\n            System.out.println(\"Stopping...\");\n        }\n    };\n\n    public abstract void execute();\n}\n</code></pre>"},{"location":"010Java/010Basic/#_21","title":"\u793a\u4f8b","text":"<pre><code>public enum Planet {\n    MERCURY(3.303e+23, 2.4397e6),\n    VENUS(4.869e+24, 6.0518e6),\n    EARTH(5.976e+24, 6.37814e6);\n\n    private final double mass;   // in kilograms\n    private final double radius; // in meters\n\n    Planet(double mass, double radius) {\n        this.mass = mass;\n        this.radius = radius;\n    }\n\n    public double getMass() {\n        return mass;\n    }\n\n    public double getRadius() {\n        return radius;\n    }\n\n    public double surfaceGravity() {\n        return G * mass / (radius * radius);\n    }\n\n    private static final double G = 6.67300E-11;\n\n    public double surfaceWeight(double otherMass) {\n        return otherMass * surfaceGravity();\n    }\n}\n</code></pre> <p>\u5728\u8fd9\u4e2a\u793a\u4f8b\u4e2d\uff0c<code>Planet</code> \u679a\u4e3e\u5b9a\u4e49\u4e86\u884c\u661f\u7684\u8d28\u91cf\u548c\u534a\u5f84\uff0c\u5e76\u63d0\u4f9b\u4e86\u8ba1\u7b97\u8868\u9762\u91cd\u529b\u7684\u65b9\u6cd5\u3002</p>"},{"location":"010Java/010Basic/#_22","title":"\u603b\u7ed3","text":"<p>Java \u679a\u4e3e\u662f\u4e00\u79cd\u5f3a\u5927\u7684\u5de5\u5177\uff0c\u9002\u7528\u4e8e\u5b9a\u4e49\u5e38\u91cf\u3001\u72b6\u6001\u673a\u3001\u7b56\u7565\u6a21\u5f0f\u3001\u5355\u4f8b\u6a21\u5f0f\u7b49\u591a\u79cd\u573a\u666f\u3002\u679a\u4e3e\u7684\u7c7b\u578b\u5b89\u5168\u6027\u548c\u7075\u6d3b\u6027\u4f7f\u5176\u6210\u4e3a\u5904\u7406\u56fa\u5b9a\u5e38\u91cf\u96c6\u5408\u7684\u7406\u60f3\u9009\u62e9\u3002</p>"},{"location":"010Java/010Basic/#_23","title":"\u679a\u4e3e\u7684\u591a\u79cd\u4f7f\u7528\u6848\u4f8b","text":"\u7b54\u6848"},{"location":"010Java/010Basic/#1_1","title":"1. \u5b9a\u4e49\u5e38\u91cf\uff08\u661f\u671f\u51e0\uff09","text":""},{"location":"010Java/010Basic/#_24","title":"\u679a\u4e3e\u5b9a\u4e49\uff1a","text":"<pre><code>public enum Day {\n    MONDAY, TUESDAY, WEDNESDAY, THURSDAY, FRIDAY, SATURDAY, SUNDAY\n}\n</code></pre>"},{"location":"010Java/010Basic/#_25","title":"\u4f7f\u7528\u65b9\u5f0f\uff1a","text":"<pre><code>public class Main {\n    public static void main(String[] args) {\n        Day today = Day.WEDNESDAY;\n\n        // \u4f7f\u7528 switch \u8bed\u53e5\n        switch (today) {\n            case MONDAY:\n                System.out.println(\"\u4eca\u5929\u662f\u661f\u671f\u4e00\uff0c\u52aa\u529b\u5de5\u4f5c\uff01\");\n                break;\n            case WEDNESDAY:\n                System.out.println(\"\u4eca\u5929\u662f\u661f\u671f\u4e09\uff0c\u52a0\u6cb9\uff01\");\n                break;\n            case FRIDAY:\n                System.out.println(\"\u4eca\u5929\u662f\u661f\u671f\u4e94\uff0c\u5468\u672b\u5feb\u5230\u4e86\uff01\");\n                break;\n            default:\n                System.out.println(\"\u4eca\u5929\u662f\" + today + \"\uff0c\u7ee7\u7eed\u52aa\u529b\uff01\");\n        }\n\n        // \u904d\u5386\u6240\u6709\u679a\u4e3e\u503c\n        System.out.println(\"\u4e00\u5468\u7684\u6bcf\u4e00\u5929\uff1a\");\n        for (Day day : Day.values()) {\n            System.out.println(day);\n        }\n    }\n}\n</code></pre>"},{"location":"010Java/010Basic/#2_1","title":"2. \u72b6\u6001\u673a\uff08\u5f00\u5173\u72b6\u6001\uff09","text":""},{"location":"010Java/010Basic/#_26","title":"\u679a\u4e3e\u5b9a\u4e49\uff1a","text":"<pre><code>public enum State {\n    ON {\n        @Override\n        public State next() {\n            return OFF;\n        }\n    },\n    OFF {\n        @Override\n        public State next() {\n            return ON;\n        }\n    };\n\n    public abstract State next();\n}\n</code></pre>"},{"location":"010Java/010Basic/#_27","title":"\u4f7f\u7528\u65b9\u5f0f\uff1a","text":"<pre><code>public class Main {\n    public static void main(String[] args) {\n        State currentState = State.OFF;\n        System.out.println(\"\u5f53\u524d\u72b6\u6001: \" + currentState);\n\n        // \u5207\u6362\u5230\u4e0b\u4e00\u4e2a\u72b6\u6001\n        currentState = currentState.next();\n        System.out.println(\"\u5207\u6362\u540e\u72b6\u6001: \" + currentState);\n\n        // \u518d\u6b21\u5207\u6362\n        currentState = currentState.next();\n        System.out.println(\"\u5207\u6362\u540e\u72b6\u6001: \" + currentState);\n    }\n}\n</code></pre>"},{"location":"010Java/010Basic/#3_1","title":"3. \u7b56\u7565\u6a21\u5f0f\uff08\u52a0\u51cf\u64cd\u4f5c\uff09","text":""},{"location":"010Java/010Basic/#_28","title":"\u679a\u4e3e\u5b9a\u4e49\uff1a","text":"<pre><code>public enum Operation {\n    PLUS {\n        public int apply(int a, int b) {\n            return a + b;\n        }\n    },\n    MINUS {\n        public int apply(int a, int b) {\n            return a - b;\n        }\n    };\n\n    public abstract int apply(int a, int b);\n}\n</code></pre>"},{"location":"010Java/010Basic/#_29","title":"\u4f7f\u7528\u65b9\u5f0f\uff1a","text":"<pre><code>public class Main {\n    public static void main(String[] args) {\n        int a = 10;\n        int b = 5;\n\n        // \u4f7f\u7528\u52a0\u6cd5\n        int result = Operation.PLUS.apply(a, b);\n        System.out.println(\"\u52a0\u6cd5\u7ed3\u679c: \" + result);\n\n        // \u4f7f\u7528\u51cf\u6cd5\n        result = Operation.MINUS.apply(a, b);\n        System.out.println(\"\u51cf\u6cd5\u7ed3\u679c: \" + result);\n    }\n}\n</code></pre>"},{"location":"010Java/010Basic/#4_1","title":"4. \u5355\u4f8b\u6a21\u5f0f","text":""},{"location":"010Java/010Basic/#_30","title":"\u679a\u4e3e\u5b9a\u4e49\uff1a","text":"<pre><code>public enum Singleton {\n    INSTANCE;\n\n    public void doSomething() {\n        System.out.println(\"\u5355\u4f8b\u6a21\u5f0f\u6b63\u5728\u6267\u884c\u64cd\u4f5c...\");\n    }\n}\n</code></pre>"},{"location":"010Java/010Basic/#_31","title":"\u4f7f\u7528\u65b9\u5f0f\uff1a","text":"<pre><code>public class Main {\n    public static void main(String[] args) {\n        // \u83b7\u53d6\u5355\u4f8b\u5b9e\u4f8b\n        Singleton instance = Singleton.INSTANCE;\n\n        // \u8c03\u7528\u65b9\u6cd5\n        instance.doSomething();\n    }\n}\n</code></pre>"},{"location":"010Java/010Basic/#5_1","title":"5. \u547d\u4ee4\u6a21\u5f0f\uff08\u542f\u52a8\u548c\u505c\u6b62\u547d\u4ee4\uff09","text":""},{"location":"010Java/010Basic/#_32","title":"\u679a\u4e3e\u5b9a\u4e49\uff1a","text":"<pre><code>public enum Command {\n    START {\n        public void execute() {\n            System.out.println(\"\u7cfb\u7edf\u6b63\u5728\u542f\u52a8...\");\n        }\n    },\n    STOP {\n        public void execute() {\n            System.out.println(\"\u7cfb\u7edf\u6b63\u5728\u505c\u6b62...\");\n        }\n    };\n\n    public abstract void execute();\n}\n</code></pre>"},{"location":"010Java/010Basic/#_33","title":"\u4f7f\u7528\u65b9\u5f0f\uff1a","text":"<pre><code>public class Main {\n    public static void main(String[] args) {\n        // \u6267\u884c\u542f\u52a8\u547d\u4ee4\n        Command startCommand = Command.START;\n        startCommand.execute();\n\n        // \u6267\u884c\u505c\u6b62\u547d\u4ee4\n        Command stopCommand = Command.STOP;\n        stopCommand.execute();\n    }\n}\n</code></pre>"},{"location":"010Java/010Basic/#6","title":"6. \u884c\u661f\u8ba1\u7b97\uff08\u8d28\u91cf\u548c\u534a\u5f84\uff09","text":""},{"location":"010Java/010Basic/#_34","title":"\u679a\u4e3e\u5b9a\u4e49\uff1a","text":"<pre><code>public enum Planet {\n    MERCURY(3.303e+23, 2.4397e6),\n    VENUS(4.869e+24, 6.0518e6),\n    EARTH(5.976e+24, 6.37814e6);\n\n    private final double mass;   // \u8d28\u91cf\uff08\u5343\u514b\uff09\n    private final double radius; // \u534a\u5f84\uff08\u7c73\uff09\n\n    Planet(double mass, double radius) {\n        this.mass = mass;\n        this.radius = radius;\n    }\n\n    public double getMass() {\n        return mass;\n    }\n\n    public double getRadius() {\n        return radius;\n    }\n\n    public double surfaceGravity() {\n        return G * mass / (radius * radius);\n    }\n\n    private static final double G = 6.67300E-11; // \u4e07\u6709\u5f15\u529b\u5e38\u6570\n\n    public double surfaceWeight(double otherMass) {\n        return otherMass * surfaceGravity();\n    }\n}\n</code></pre>"},{"location":"010Java/010Basic/#_35","title":"\u4f7f\u7528\u65b9\u5f0f\uff1a","text":"<pre><code>public class Main {\n    public static void main(String[] args) {\n        double earthWeight = 70; // \u5047\u8bbe\u4e00\u4e2a\u4eba\u5728\u5730\u7403\u4e0a\u7684\u91cd\u91cf\u662f 70 kg\n        double mass = earthWeight / Planet.EARTH.surfaceGravity();\n\n        // \u8ba1\u7b97\u5728\u4e0d\u540c\u884c\u661f\u4e0a\u7684\u91cd\u91cf\n        System.out.println(\"\u5728\u5730\u7403\u4e0a\u7684\u91cd\u91cf: \" + earthWeight + \" kg\");\n        System.out.println(\"\u5728\u706b\u661f\u4e0a\u7684\u91cd\u91cf: \" + Planet.MERCURY.surfaceWeight(mass) + \" kg\");\n        System.out.println(\"\u5728\u91d1\u661f\u4e0a\u7684\u91cd\u91cf: \" + Planet.VENUS.surfaceWeight(mass) + \" kg\");\n    }\n}\n</code></pre>"},{"location":"010Java/010Basic/#_36","title":"\u603b\u7ed3","text":"<p>\u901a\u8fc7\u8fd9\u4e9b\u793a\u4f8b\uff0c\u4f60\u53ef\u4ee5\u770b\u5230\u679a\u4e3e\u5728\u5b9e\u9645\u5f00\u53d1\u4e2d\u7684\u7075\u6d3b\u6027\u548c\u5f3a\u5927\u529f\u80fd\u3002\u65e0\u8bba\u662f\u5b9a\u4e49\u5e38\u91cf\u3001\u5b9e\u73b0\u72b6\u6001\u673a\u3001\u7b56\u7565\u6a21\u5f0f\uff0c\u8fd8\u662f\u5355\u4f8b\u6a21\u5f0f\uff0c\u679a\u4e3e\u90fd\u80fd\u63d0\u4f9b\u7b80\u6d01\u3001\u5b89\u5168\u4e14\u6613\u4e8e\u7ef4\u62a4\u7684\u89e3\u51b3\u65b9\u6848\u3002\u5e0c\u671b\u8fd9\u4e9b\u793a\u4f8b\u80fd\u5e2e\u52a9\u4f60\u66f4\u597d\u5730\u7406\u89e3\u548c\u4f7f\u7528 Java \u679a\u4e3e\uff01</p>"},{"location":"010Java/010Basic/#_37","title":"\u9759\u6001\u5c5e\u6027\u548c\u9759\u6001\u65b9\u6cd5\u662f\u5426\u53ef\u4ee5\u88ab\u7ee7\u627f\uff1f\u662f\u5426\u53ef\u4ee5\u88ab\u91cd\u5199\uff1f\u4ee5\u53ca\u539f\u56e0\u3002","text":"\u7b54\u6848 <p>\u9759\u6001\u5c5e\u6027\u548c\u9759\u6001\u65b9\u6cd5\u53ef\u4ee5\u88ab\u7ee7\u627f\uff0c\u4f46\u662f\u6ca1\u6709\u88ab\u91cd\u5199\u800c\u662f\u88ab\u9690\u85cf\u3002</p> <p>\u9759\u6001\u65b9\u6cd5\u548c\u5c5e\u6027\u662f\u5c5e\u4e8e\u7c7b\u7684\uff0c\u8c03\u7528\u7684\u65f6\u5019\u76f4\u63a5\u901a\u8fc7 \u7c7b\u540d.\u65b9\u6cd5\u540d \u5b8c\u6210\uff0c\u4e0d\u9700\u8981\u7ee7\u627f\u673a\u5236\u5c31\u53ef\u4ee5\u8c03\u7528\u3002\u5982\u679c\u5b50\u7c7b\u91cc\u9762\u5b9a\u4e49\u4e86\u9759\u6001\u65b9\u6cd5\u548c\u5c5e\u6027\uff0c\u90a3\u4e48\u8fd9\u65f6\u5019\u7236\u7c7b\u7684\u9759\u6001\u65b9\u6cd5\u6216\u5c5e\u6027\u79f0\u4e4b\u4e3a\u201c\u9690\u85cf\u201d\u3002\u81f3\u4e8e\u662f\u5426\u7ee7\u627f\u4e00\u8bf4\uff0c\u5b50\u7c7b\u662f\u6709\u7ee7\u627f\u9759\u6001\u65b9\u6cd5\u548c\u5c5e\u6027\uff0c\u4f46\u662f\u8ddf\u5b9e\u4f8b\u65b9\u6cd5\u548c\u5c5e\u6027\u4e0d\u592a\u4e00\u6837\uff0c\u5b58\u5728\u9690\u85cf\u8fd9\u79cd\u60c5\u51b5\u3002</p> <p>\u591a\u6001\u4e4b\u6240\u4ee5\u80fd\u591f\u5b9e\u73b0\u4f9d\u8d56\u4e8e\u7ee7\u627f\u3001\u63a5\u53e3\u548c\u91cd\u5199\u3001\u91cd\u8f7d\uff08\u7ee7\u627f\u548c\u91cd\u5199\u6700\u4e3a\u5173\u952e\uff09\u3002\u6709\u4e86\u7ee7\u627f\u548c\u91cd\u5199\u5c31\u53ef\u4ee5\u5b9e\u73b0\u7236\u7c7b\u7684\u5f15\u7528\u6307\u5411\u4e0d\u540c\u5b50\u7c7b\u7684\u5bf9\u8c61\u3002 \u91cd\u5199\u7684\u529f\u80fd\u662f\uff1a\u91cd\u5199\u540e\u5b50\u7c7b\u7684\u4f18\u5148\u7ea7\u9ad8\u4e8e\u7236\u7c7b\u7684\u4f18\u5148\u7ea7\uff0c\u4f46\u662f\u9690\u85cf\u662f\u6ca1\u6709\u8fd9\u4e2a\u4f18\u5148\u7ea7\u4e4b\u5206\u7684\u3002</p> <p>\u9759\u6001\u5c5e\u6027\u3001\u9759\u6001\u65b9\u6cd5\u548c\u975e\u9759\u6001\u7684\u5c5e\u6027\u90fd\u53ef\u4ee5\u88ab\u7ee7\u627f\u548c\u9690\u85cf\u800c\u4e0d\u80fd\u88ab\u91cd\u5199\uff0c\u56e0\u6b64\u4e0d\u80fd\u5b9e\u73b0\u591a\u6001\uff0c\u4e0d\u80fd\u5b9e\u73b0\u7236\u7c7b\u7684\u5f15\u7528\u53ef\u4ee5\u6307\u5411\u4e0d\u540c\u5b50\u7c7b\u7684\u5bf9\u8c61\u3002</p> <p>\u975e\u9759\u6001\u65b9\u6cd5\u53ef\u4ee5\u88ab\u7ee7\u627f\u548c\u91cd\u5199\uff0c\u56e0\u6b64\u53ef\u4ee5\u5b9e\u73b0\u591a\u6001\u3002</p>"},{"location":"010Java/010Basic/#_38","title":"\u9759\u6001\u5185\u90e8\u7c7b\u7684\u8bbe\u8ba1\u610f\u56fe","text":"\u7b54\u6848 <p>\u53ea\u662f\u4e3a\u4e86\u964d\u4f4e\u5305\u7684\u6df1\u5ea6\uff0c\u65b9\u4fbf\u7c7b\u7684\u4f7f\u7528\uff0c\u9759\u6001\u5185\u90e8\u7c7b\u9002\u7528\u4e8e\u5305\u542b\u7c7b\u5f53\u4e2d\uff0c\u4f46\u53c8\u4e0d\u4f9d\u8d56\u4e8e\u5916\u5728\u7684\u7c7b\uff0c\u4e0d\u7528\u4f7f\u7528\u5916\u5728\u7c7b\u7684\u975e\u9759\u6001\u5c5e\u6027\u548c\u65b9\u6cd5\uff0c\u53ea\u662f\u4e3a\u4e86\u65b9\u4fbf\u7ba1\u7406\u7c7b\u7ed3\u6784\u800c\u5b9a\u4e49\u3002\u5728\u521b\u5efa\u9759\u6001\u5185\u90e8\u7c7b\u7684\u65f6\u5019\uff0c\u4e0d\u9700\u8981\u5916\u90e8\u7c7b\u5bf9\u8c61\u7684\u5f15\u7528\u3002</p> <p>\u975e\u9759\u6001\u5185\u90e8\u7c7b\u6709\u4e00\u4e2a\u5f88\u5927\u7684\u4f18\u70b9\uff1a\u53ef\u4ee5\u81ea\u7531\u4f7f\u7528\u5916\u90e8\u7c7b\u4e2d\u7684\u53d8\u91cf\u548c\u65b9\u6cd5\u3002</p> <p>static class Outer {     class Inner {}     static class StaticInner {} }</p> <p>Outer outer = new Outer(); Outer.Inner inner = outer.new Inner(); Outer.StaticInner inner0 = new Outer.StaticInner(); \u53c2\u8003\u81ea\uff1ahttps://www.zhihu.com/question/28197253</p>"},{"location":"010Java/010Basic/#_39","title":"\u6210\u5458\u5185\u90e8\u7c7b\u3001\u9759\u6001\u5185\u90e8\u7c7b\u3001\u65b9\u6cd5\u5185\u90e8\u7c7b\uff08\u5c40\u90e8\u5185\u90e8\u7c7b\uff09\u548c\u533f\u540d\u5185\u90e8\u7c7b\u7684\u7406\u89e3\uff0c\u4ee5\u53ca\u9879\u76ee\u4e2d\u7684\u5e94\u7528","text":"\u7b54\u6848 <p>\u6210\u5458\u5185\u90e8\u7c7b\uff1a</p> <pre><code>\u6700\u666e\u901a\u7684\u5185\u90e8\u7c7b\uff0c\u5b83\u7684\u5b9a\u4e49\u4f4d\u4e8e\u4e00\u4e2a\u7c7b\u7684\u5185\u90e8\uff0c\u8fd9\u6837\u770b\u8d77\u6765\uff0c\u6210\u5458\u5185\u90e8\u7c7b\u76f8\u5f53\u4e8e\u5916\u90e8\u7c7b\u7684\u4e00\u4e2a\u6210\u5458\uff0c\u6210\u5458\u5185\u90e8\u7c7b\u53ef\u4ee5\u65e0\u6761\u4ef6\u8bbf\u95ee\u5916\u90e8\u7c7b\u7684\u6240\u6709\u6210\u5458\u5c5e\u6027\u548c\u6210\u5458\u65b9\u6cd5\uff08\u5305\u62ecprivate\u6210\u5458\u548c\u9759\u6001\u6210\u5458\uff09\u3002\u4e0d\u8fc7\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u5f53\u6210\u5458\u5185\u90e8\u7c7b\u62e5\u6709\u548c\u5916\u90e8\u7c7b\u540c\u540d\u7684\u6210\u5458\u53d8\u91cf\u6216\u8005\u65b9\u6cd5\u65f6\uff0c\u4f1a\u53d1\u751f\u9690\u85cf\u73b0\u8c61\uff0c\u5373\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u8bbf\u95ee\u7684\u662f\u6210\u5458\u5185\u90e8\u7c7b\u7684\u6210\u5458\u3002\u5982\u679c\u8981\u8bbf\u95ee\u5916\u90e8\u7c7b\u7684\u540c\u540d\u6210\u5458\uff0c\u5f62\u5f0f\u5982\u4e0b\uff1a\n</code></pre> <pre><code>\u5916\u90e8\u7c7b.this.\u6210\u5458\u53d8\u91cf\n\u5916\u90e8\u7c7b.this.\u6210\u5458\u65b9\u6cd5\n</code></pre> <p>\u867d\u7136\u6210\u5458\u5185\u90e8\u7c7b\u53ef\u4ee5\u65e0\u6761\u4ef6\u7684\u8bbf\u95ee\u5916\u90e8\u7c7b\u7684\u6210\u5458\uff0c\u800c\u5916\u90e8\u7c7b\u60f3\u8bbf\u95ee\u6210\u5458\u5185\u90e8\u7c7b\u7684\u6210\u5458\u5374\u4e0d\u662f\u90a3\u4e48\u968f\u5fc3\u6240\u6b32\u4e86\u3002\u6210\u5458\u5185\u90e8\u7c7b\u662f\u4f9d\u9644\u5916\u90e8\u7c7b\u800c\u5b58\u5728\u7684\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u5982\u679c\u8981\u521b\u5efa\u6210\u5458\u5185\u90e8\u7c7b\u7684\u5bf9\u8c61\uff0c\u524d\u63d0\u5fc5\u987b\u5b58\u5728\u4e00\u4e2a\u5916\u90e8\u7c7b\u5bf9\u8c61\u3002\u521b\u5efa\u6210\u5458\u5185\u90e8\u7c7b\u5bf9\u8c61\u7684\u4e00\u822c\u65b9\u5f0f\u5982\u4e0b\uff1a</p> <pre><code>public class Test {\n    public static void main(String[] args)  {\n        //\u7b2c\u4e00\u79cd\u65b9\u5f0f\uff1a\n        Outter outter = new Outter();\n        Outter.Inner inner = outter.new Inner();  //\u5fc5\u987b\u901a\u8fc7Outter\u5bf9\u8c61\u6765\u521b\u5efa\n\n        //\u7b2c\u4e8c\u79cd\u65b9\u5f0f\uff1a\n        Outter.Inner inner1 = outter.getInnerInstance();\n    }\n}\n\nclass Outter {\n    private Inner inner = null;\n    public Outter() {\n\n    }\n\n    public Inner getInnerInstance() {\n        if(inner == null)\n            inner = new Inner();\n        return inner;\n    }\n\n    class Inner {\n        public Inner() {\n\n        }\n    }\n}\n</code></pre> <p>\u5185\u90e8\u7c7b\u53ef\u4ee5\u62e5\u6709private\u3001protected\u3001public\u4ee5\u53ca\u5305\u8bbf\u95ee\u6743\u9650\u3002\u5982\u679c\u6210\u5458\u5185\u90e8\u7c7b\u7528private\u4fee\u9970\uff0c\u5219\u53ea\u80fd\u5728\u5916\u90e8\u7c7b\u7684\u5185\u90e8\u8bbf\u95ee\uff0c\u5982\u679c\u7528public\u4fee\u9970\uff0c\u5219\u4efb\u4f55\u5730\u65b9\u90fd\u80fd\u8bbf\u95ee\uff0c\u5982\u679c\u7528protected\u4fee\u9970\uff0c\u5219\u53ea\u80fd\u5728\u540c\u4e00\u4e2a\u5305\u4e0b\u6216\u8005\u7ee7\u627f\u5916\u90e8\u7c7b\u7684\u60c5\u51b5\u4e0b\u8bbf\u95ee\uff0c\u5982\u679c\u662f\u9ed8\u8ba4\u8bbf\u95ee\u6743\u9650\uff0c\u5219\u53ea\u80fd\u662f\u540c\u4e00\u4e2a\u5305\u4e0b\u8bbf\u95ee\u3002\u8fd9\u4e00\u70b9\u548c\u5916\u90e8\u7c7b\u6709\u4e00\u70b9\u4e0d\u4e00\u6837\uff0c\u5916\u90e8\u7c7b\u53ea\u80fd\u88abpublic\u548c\u5305\u8bbf\u95ee\u4e24\u79cd\u6743\u9650\u4fee\u9970\u3002\u7531\u4e8e\u6210\u5458\u5185\u90e8\u7c7b\u770b\u8d77\u6765\u50cf\u5916\u90e8\u7c7b\u7684\u4e00\u4e2a\u6210\u5458\uff0c\u6240\u4ee5\u53ef\u4ee5\u50cf\u7c7b\u7684\u6210\u5458\u4e00\u6837\u62e5\u6709\u591a\u79cd\u4fee\u9970\u6743\u9650\u3002</p> <p>\u9759\u6001\u5185\u90e8\u7c7b\uff1a</p> <pre><code>\u9759\u6001\u5185\u90e8\u7c7b\u4e5f\u662f\u5b9a\u4e49\u5728\u53e6\u4e00\u4e2a\u7c7b\u91cc\u9762\u7684\u7c7b\uff0c\u53ea\u4e0d\u8fc7\u5728\u7c7b\u7684\u524d\u9762\u591a\u4e86\u4e00\u4e2a\u5173\u952e\u5b57static\u3002\u9759\u6001\u5185\u90e8\u7c7b\u662f\u4e0d\u9700\u8981\u4f9d\u8d56\u5916\u90e8\u7c7b\u7684\uff0c\u8fd9\u70b9\u548c\u7c7b\u7684\u9759\u6001\u6210\u5458\u5c5e\u6027\u6709\u70b9\u76f8\u4f3c\uff0c\u5e76\u4e14\u5b83\u4e0d\u80fd\u4f7f\u7528\u5916\u90e8\u7c7b\u7684\u975estatic\u6210\u5458\u53d8\u91cf\u6216\u8005\u65b9\u6cd5\u3002\u8fd9\u70b9\u5f88\u597d\u7406\u89e3\uff0c\u56e0\u4e3a\u5728\u6ca1\u6709\u5916\u90e8\u7c7b\u7684\u5bf9\u8c61\u7684\u60c5\u51b5\u4e0b\uff0c\u53ef\u4ee5\u521b\u5efa\u9759\u6001\u5185\u90e8\u7c7b\u7684\u5bf9\u8c61\uff0c\u5982\u679c\u5141\u8bb8\u8bbf\u95ee\u5916\u90e8\u7c7b\u7684\u975estatic\u6210\u5458\u5c31\u4f1a\u4ea7\u751f\u77db\u76fe\uff0c\u56e0\u4e3a\u5916\u90e8\u7c7b\u7684\u975estatic\u6210\u5458\u5fc5\u987b\u4f9d\u8d56\u4e8e\u5177\u4f53\u7684\u5bf9\u8c61\u3002\n</code></pre> <p>\u5c40\u90e8\u5185\u90e8\u7c7b\uff1a</p> <pre><code>\u5c40\u90e8\u5185\u90e8\u7c7b\u662f\u5b9a\u4e49\u5728\u4e00\u4e2a\u65b9\u6cd5\u6216\u8005\u4e00\u4e2a\u4f5c\u7528\u57df\u91cc\u9762\u7684\u7684\u7c7b\uff0c\u5b83\u548c\u6210\u5458\u5185\u90e8\u7c7b\u7684\u533a\u522b\u5728\u4e8e\u5c40\u90e8\u5185\u90e8\u7c7b\u7684\u8bbf\u95ee\u6743\u9650\u4ec5\u9650\u4e8e\u65b9\u6cd5\u5185\u6216\u8005\u8be5\u4f5c\u7528\u57df\u5185\u3002\u6ce8\u610f\uff0c\u5c40\u90e8\u5185\u90e8\u7c7b\u5c31\u50cf\u662f\u65b9\u6cd5\u91cc\u9762\u7684\u4e00\u4e2a\u5c40\u90e8\u53d8\u91cf\u4e00\u6837\uff0c\u662f\u4e0d\u80fd\u6709public\u3001protected\u3001private\u4ee5\u53castatic\u4fee\u9970\u7b26\u7684\u3002\n</code></pre> <p>\u533f\u540d\u5185\u90e8\u7c7b\uff1a</p> <pre><code>\u533f\u540d\u5185\u90e8\u7c7b\u4e0d\u80fd\u6709\u8bbf\u95ee\u4fee\u9970\u7b26\u548cstatic\u4fee\u9970\u7b26\u7684\uff0c\u4e00\u822c\u7528\u4e8e\u7f16\u5199\u76d1\u542c\u4ee3\u7801\u3002\u533f\u540d\u5185\u90e8\u7c7b\u662f\u552f\u4e00\u4e00\u4e2a\u6ca1\u6709\u6784\u9020\u5668\u7684\u7c7b\u3002\u6b63\u56e0\u4e3a\u6ca1\u6709\u6784\u9020\u5668\uff0c\u6240\u4ee5\u533f\u540d\u5185\u90e8\u7c7b\u7684\u9002\u7528\u8303\u56f4\u975e\u5e38\u6709\u9650\uff0c\u5927\u90e8\u5206\u533f\u540d\u5185\u90e8\u7c7b\u7528\u4e8e\u63a5\u53e3\u56de\u8c03\u3002\u4e00\u822c\u6765\u8bf4\uff0c\u533f\u540d\u5185\u90e8\u7c7b\u7528\u4e8e\u7ee7\u627f\u5176\u4ed6\u7c7b\u6216\u8005\u5b9e\u73b0\u63a5\u53e3\uff0c\u5e76\u4e0d\u9700\u8981\u589e\u52a0\u989d\u5916\u7684\u65b9\u6cd5\uff0c\u53ea\u662f\u5bf9\u7ee7\u627f\u65b9\u6cd5\u7684\u5b9e\u73b0\u6216\u8005\u662f\u91cd\u5199\u3002\n</code></pre> <p>\u5e94\u7528\u573a\u666f\uff1a</p> <ol> <li> <p>\u6700\u91cd\u8981\u7684\u4e00\u70b9\uff0c\u6bcf\u4e2a\u5185\u90e8\u7c7b\u90fd\u80fd\u72ec\u7acb\u7684\u7ee7\u627f\u4e00\u4e2a\u63a5\u53e3\u7684\u5b9e\u73b0\uff0c\u65e0\u8bba\u5916\u90e8\u7c7b\u662f\u5426\u5df2\u7ecf\u7ee7\u627f\u4e86\u67d0\u4e2a\u63a5\u53e3\u7684\u5b9e\u73b0\uff0c\u5bf9\u4e8e\u5185\u90e8\u7c7b\u90fd\u6ca1\u6709\u5f71\u54cd\u3002\u5185\u90e8\u7c7b\u4f7f\u5f97\u591a\u7ee7\u627f\u7684\u89e3\u51b3\u65b9\u6848\u53d8\u5f97\u5b8c\u6574\u3002</p> <ol> <li>\u65b9\u4fbf\u5c06\u5b58\u5728\u4e00\u5b9a\u903b\u8f91\u5173\u7cfb\u7684\u7c7b\u7ec4\u7ec7\u5728\u4e00\u8d77\uff0c\u53c8\u53ef\u4ee5\u5bf9\u5916\u754c\u9690\u853d\u3002</li> <li>\u65b9\u4fbf\u7f16\u5199\u4e8b\u4ef6\u9a71\u52a8\u7a0b\u5e8f</li> <li>\u65b9\u4fbf\u7f16\u5199\u7ebf\u7a0b\u4ee3\u7801</li> </ol> </li> </ol> <p>\u603b\u7ed3\uff1a</p> <pre><code>\u5bf9\u4e8e\u6210\u5458\u5185\u90e8\u7c7b\uff0c\u5fc5\u987b\u5148\u4ea7\u751f\u5916\u90e8\u7c7b\u7684\u5b9e\u4f8b\u5316\u5bf9\u8c61\uff0c\u624d\u80fd\u4ea7\u751f\u5185\u90e8\u7c7b\u7684\u5b9e\u4f8b\u5316\u5bf9\u8c61\u3002\u800c\u975e\u9759\u6001\u5185\u90e8\u7c7b\u4e0d\u7528\u4ea7\u751f\u5916\u90e8\u7c7b\u7684\u5b9e\u4f8b\u5316\u5bf9\u8c61\u5373\u53ef\u4ea7\u751f\u5185\u90e8\u7c7b\u7684\u5b9e\u4f8b\u5316\u5bf9\u8c61\u3002\n</code></pre> <pre><code>\u521b\u5efa\u9759\u6001\u5185\u90e8\u7c7b\u5bf9\u8c61\u7684\u4e00\u822c\u5f62\u5f0f\uff1a\n\u5916\u90e8\u7c7b\u7c7b\u540d.\u5185\u90e8\u7c7b\u7c7b\u540d xxx = new \u5916\u90e8\u7c7b\u7c7b\u540d.\u5185\u90e8\u7c7b\u7c7b\u540d()\n\u521b\u5efa\u6210\u5458\u5185\u90e8\u7c7b\u5bf9\u8c61\u7684\u4e00\u822c\u5f62\u5f0f\uff1a\n\u5916\u90e8\u7c7b\u7c7b\u540d.\u5185\u90e8\u7c7b\u7c7b\u540d xxx = new \u5916\u90e8\u7c7b\u5bf9\u8c61\u540d.new \u5185\u90e8\u7c7b\u7c7b\u540d()\n</code></pre> <p>\u53c2\u8003\u81ea\uff1ahttp://www.cnblogs.com/latter/p/5665015.html</p>"},{"location":"010Java/010Basic/#_40","title":"\u5bf9\u8c61\u62f7\u8d1d\u7406\u89e3\uff1f\u6df1\u62f7\u8d1d\u3001\u6d45\u62f7\u8d1d\u7684\u533a\u522b\uff1f","text":"\u7b54\u6848 <p>\u9996\u5148\u8981\u5148\u660e\u767d\u4e3a\u4ec0\u4e48\u9700\u8981\u4f7f\u7528\u514b\u9686\u5462\uff1f</p> <p>\u514b\u9686\u7684\u5bf9\u8c61\u53ef\u80fd\u5305\u542b\u4e00\u4e9b\u5df2\u7ecf\u4fee\u6539\u8fc7\u7684\u5c5e\u6027\uff0c\u800c new \u51fa\u6765\u7684\u5bf9\u8c61\u7684\u5c5e\u6027\u90fd\u8fd8\u662f\u521d\u59cb\u5316\u65f6\u5019\u7684\u503c\uff0c\u6240\u4ee5\u5f53\u9700\u8981\u4e00\u4e2a\u65b0\u7684\u5bf9\u8c61\u6765\u4fdd\u5b58\u5f53\u524d\u5bf9\u8c61\u7684 \"\u72b6\u6001\" \u5c31\u9700\u8981\u514b\u9686\u4e86\u3002</p> <p>\u90a3\u5982\u4f55\u5b9e\u73b0\u5bf9\u8c61\u514b\u9686\u5462\uff1f\u6709\u4e24\u79cd\u529e\u6cd5\uff1a</p> <p>\u5b9e\u73b0 Cloneable \u63a5\u53e3\u5e76\u91cd\u5199 Object \u7c7b\u4e2d\u7684 clone() \u65b9\u6cd5 \u5b9e\u73b0 Serialiable \u63a5\u53e3\uff0c\u901a\u8fc7\u5bf9\u8c61\u7684\u5e8f\u5217\u5316\u548c\u53cd\u5e8f\u5217\u5316\u5b9e\u73b0\u514b\u9686\uff0c\u53ef\u4ee5\u5b9e\u73b0\u771f\u6b63\u7684\u6df1\u5ea6\u514b\u9686 \u6df1\u62f7\u8d1d\u548c\u6d45\u62f7\u8d1d\u7684\u533a\u522b\u662f\u4ec0\u4e48\uff1f</p> <p>\u6d45\u62f7\u8d1d</p> <p>\u5f53\u5bf9\u8c61\u88ab\u590d\u5236\u7684\u65f6\u5019\u53ea\u590d\u5236\u5b83\u672c\u8eab\u548c\u5176\u4e2d\u5305\u542b\u7684\u503c\u7c7b\u578b\u7684\u6210\u5458\u53d8\u91cf\uff0c\u800c\u5f15\u7528\u7c7b\u578b\u7684\u6210\u5458\u53d8\u91cf\u5e76\u6ca1\u6709\u590d\u5236\u3002</p> <p>\u6df1\u62f7\u8d1d</p> <p>\u9664\u4e86\u5bf9\u8c61\u672c\u8eab\u88ab\u590d\u5236\u5916\uff0c\u5bf9\u8c61\u6240\u5305\u542b\u7684\u6240\u6709\u6210\u5458\u53d8\u91cf\u4e5f\u5c06\u88ab\u590d\u5236\u3002</p> <p>Java \u9ed8\u8ba4\u7684\u662f\u6d45\u62f7\u8d1d\uff0c\u5982\u679c\u60f3\u5b9e\u73b0\u6df1\u62f7\u8d1d\uff0c\u5c31\u9700\u8981\u5bf9\u8c61\u6240\u5305\u542b\u7684\u5f15\u7528\u7c7b\u578b\u7684\u6210\u5458\u53d8\u91cf\u4e5f\u9700\u8981\u5b9e\u73b0 Cloneable \u63a5\u53e3\uff0c\u6216\u8005\u5b9e\u73b0 Serialiable \u63a5\u53e3\u3002</p>"},{"location":"010Java/010Basic/#java_4","title":"Java\u7684\u5f02\u5e38\u4f53\u7cfb","text":"\u7b54\u6848 <p>\u5f02\u5e38\u7b80\u4ecb\uff1a\u5f02\u5e38\u662f\u963b\u6b62\u5f53\u524d\u65b9\u6cd5\u7ee7\u7eed\u6267\u884c\u7684\u95ee\u9898\uff0c\u5982\uff1a\u6587\u4ef6\u627e\u4e0d\u5230\u3001\u7f51\u7edc\u8fde\u63a5\u5931\u8d25\u3001\u975e\u6cd5\u53c2\u6570\u7b49\u7b49\u3002\u53d1\u73b0\u5f02\u5e38\u7684\u7406\u60f3\u65f6\u671f\u662f\u7f16\u8bd1\u9636\u6bb5\uff0c\u7136\u800c\u7f16\u8bd1\u9636\u6bb5\u4e0d\u80fd\u627e\u51fa\u6240\u6709\u7684\u5f02\u5e38\uff0c\u4f59\u4e0b\u7684\u95ee\u9898\u5fc5\u987b\u5728\u8fd0\u884c\u671f\u95f4\u3002</p> <p>Java\u4e2d\u7684\u5f02\u5e38\u5206\u4e3a\u53ef\u67e5\u5f02\u5e38\u548c\u4e0d\u53ef\u67e5\u5f02\u5e38\u3002</p> <p>\u53ef\u67e5\u5f02\u5e38\uff1a</p> <p>\u5373\u7f16\u8bd1\u65f6\u5f02\u5e38\uff0c\u53ea\u7f16\u8bd1\u5668\u5728\u7f16\u8bd1\u65f6\u53ef\u4ee5\u53d1\u73b0\u7684\u9519\u8bef\uff0c\u7a0b\u5e8f\u5728\u8fd0\u884c\u65f6\u5f88\u5bb9\u6613\u51fa\u73b0\u7684\u5f02\u5e38\u72b6\u51b5\uff0c\u8fd9\u4e9b\u5f02\u5e38\u53ef\u4ee5\u9884\u8ba1\uff0c\u6240\u4ee5\u5728\u7f16\u8bd1\u9636\u6bb5\u5c31\u5fc5\u987b\u624b\u52a8\u8fdb\u884c\u6355\u6349\u5904\u7406\uff0c\u5373\u8981\u7528try-catch\u8bed\u53e5\u6355\u83b7\u5b83\uff0c\u8981\u4e48\u7528throws\u5b50\u53e5\u58f0\u660e\u629b\u51fa\uff0c\u5426\u8005\u7f16\u8bd1\u65e0\u6cd5\u901a\u8fc7\uff0c\u5982\uff1aIOException\u3001SQLException\u4ee5\u53ca\u7528\u6237\u81ea\u5b9a\u4e49Exception\u5f02\u5e38\u3002 \u4e0d\u53ef\u67e5\u5f02\u5e38\uff1a</p> <p>\u4e0d\u53ef\u67e5\u5f02\u5e38\u5305\u62ec\u8fd0\u884c\u65f6\u5f02\u5e38\u548c\u9519\u8bef\uff0c\u4ed6\u4eec\u90fd\u662f\u5728\u7a0b\u5e8f\u8fd0\u884c\u65f6\u51fa\u73b0\u7684\u3002\u5f02\u5e38\u548c\u9519\u8bef\u7684\u533a\u522b\uff1a\u5f02\u5e38\u80fd\u88ab\u7a0b\u5e8f\u672c\u8eab\u5904\u7406\uff0c\u9519\u8bef\u662f\u65e0\u6cd5\u5904\u7406\u7684\u3002\u8fd0\u884c\u65f6\u5f02\u5e38\u6307\u7684\u662f\u7a0b\u5e8f\u5728\u8fd0\u884c\u65f6\u624d\u4f1a\u51fa\u73b0\u7684\u9519\u8bef\uff0c\u7531\u7a0b\u5e8f\u5458\u81ea\u5df1\u5206\u6790\u4ee3\u7801\u51b3\u5b9a\u662f\u5426\u7528try...catch\u8fdb\u884c\u6355\u83b7\u5904\u7406\u3002\u5982\u7a7a\u6307\u9488\u5f02\u5e38\u3001\u7c7b\u8f6c\u6362\u5f02\u5e38\u3001\u6570\u7ec4\u4e0b\u6807\u8d8a\u754c\u5f02\u5e38\u7b49\u7b49\u3002\u9519\u8bef\u662f\u6307\u7a0b\u5e8f\u65e0\u6cd5\u5904\u7406\u7684\u9519\u8bef\uff0c\u8868\u793a\u8fd0\u884c\u5e94\u7528\u7a0b\u5e8f\u4e2d\u8f83\u4e25\u91cd\u7684\u95ee\u9898\uff0c\u5982\u7cfb\u7edf\u5d29\u6e83\u3001\u865a\u62df\u673a\u9519\u8bef\u3001\u52a8\u6001\u8fde\u63a5\u5931\u8d25\u7b49\u7b49\u3002\u5927\u591a\u6570\u9519\u8bef\u4e0e\u4ee3\u7801\u7f16\u5199\u8005\u6267\u884c\u7684\u64cd\u4f5c\u65e0\u5173\uff0c\u800c\u8868\u793a\u4ee3\u7801\u8fd0\u884c\u65f6JVM\u51fa\u73b0\u7684\u95ee\u9898\u3002 Java\u5f02\u5e38\u7c7b\u5c42\u6b21\u7ed3\u6784\u56fe\uff1a</p> <p></p> <p>\u4ece\u4e0a\u56fe\u53ef\u4ee5\u770b\u51faJava\u901a\u8fc7API\u4e2dThrowable\u7c7b\u7684\u4f17\u591a\u5b50\u7c7b\u63cf\u8ff0\u5404\u79cd\u4e0d\u540c\u7684\u5f02\u5e38\u3002\u56e0\u800c\uff0cJava\u5f02\u5e38\u90fd\u662f\u5bf9\u8c61\uff0c\u662fThrowable\u5b50\u7c7b\u7684\u5b9e\u4f8b\u3002</p> <p>\u5f02\u5e38\u5904\u7406\u673a\u5236\uff1a</p> <p>\u5f53\u5f02\u5e38\u53d1\u751f\u65f6\uff0c\u5c06\u4f7f\u7528new\u5728\u5806\u4e0a\u521b\u5efa\u4e00\u4e2a\u5f02\u5e38\u5bf9\u8c61\uff0c\u5bf9\u4e8e\u8fd9\u4e2a\u5f02\u5e38\u5bf9\u8c61\uff0c\u6709\u4e24\u79cd\u5904\u7406\u65b9\u5f0f\uff1a</p> <p>\u4f7f\u7528throw\u5173\u952e\u5b57\u5c06\u5f02\u5e38\u5bf9\u8c61\u629b\u51fa\uff0c\u5219\u5f53\u524d\u6267\u884c\u8def\u5f84\u88ab\u7ec8\u6b62\uff0c\u5f02\u5e38\u5904\u7406\u673a\u5236\u5c06\u5728\u5176\u4ed6\u5730\u65b9\u5bfb\u627ecatch\u5feb\u5bf9\u5f02\u5e38\u8fdb\u884c\u5904\u7406 \u4f7f\u7528try...catch\u5728\u5f53\u524d\u903b\u8f91\u4e2d\u8fdb\u884c\u6355\u83b7\u5904\u7406 throws \u548c throw\uff1a</p> <p>throws\uff1a\u4e00\u4e2a\u65b9\u6cd5\u5728\u58f0\u660e\u65f6\u53ef\u4ee5\u4f7f\u7528throws\u5173\u952e\u5b57\u58f0\u660e\u53ef\u80fd\u4f1a\u4ea7\u751f\u7684\u82e5\u5e72\u5f02\u5e38</p> <p>throw\uff1a\u629b\u51fa\u5f02\u5e38\uff0c\u5e76\u9000\u51fa\u5f53\u524d\u65b9\u6cd5\u6216\u4f5c\u7528\u57df</p> <p>\u4f7f\u7528 finally \u6e05\u7406\uff1a</p> <p>\u5728 Java \u4e2d\u7684 finally \u7684\u5b58\u5728\u5e76\u4e0d\u662f\u4e3a\u4e86\u91ca\u653e\u5185\u5b58\u8d44\u6e90\uff0c\u56e0\u4e3a Java \u6709\u5783\u573e\u56de\u6536\u673a\u5236\uff0c\u56e0\u6b64\u9700\u8981 Java \u91ca\u653e\u7684\u8d44\u6e90\u4e3b\u8981\u662f\uff1a\u5df2\u7ecf\u6253\u5f00\u7684\u6587\u4ef6\u6216\u8005\u7f51\u7edc\u8fde\u63a5\u7b49\u3002</p> <p>\u5728 try \u4e2d\u65e0\u8bba\u6709\u6ca1\u6709\u6355\u83b7\u5f02\u5e38\uff0cfinally \u90fd\u4f1a\u88ab\u6267\u884c\u3002</p> <p>\u53c2\u8003\u81ea\uff1ahttps://www.jianshu.com/p/ffca876ce719</p>"},{"location":"010Java/010Basic/#_41","title":"\u7c7b\u52a0\u8f7d\u6d41\u7a0b\u53cc\u4eb2\u59d4\u6258\u673a\u5236","text":"\u7b54\u6848"},{"location":"010Java/010Basic/#_42","title":"\u7c7b\u52a0\u8f7d\u6d41\u7a0b","text":"<p>\u88c5\u8f7d \u94fe\u63a5 \u9a8c\u8bc1 \u51c6\u5907 \u89e3\u6790 \u521d\u59cb\u5316 \u53cc\u4eb2\u59d4\u6258\u673a\u5236</p> <p>\u67d0\u4e2a\u7279\u5b9a\u7684\u7c7b\u52a0\u8f7d\u5668\u5728\u63a5\u5230\u52a0\u8f7d\u7c7b\u7684\u8bf7\u6c42\u65f6\uff0c\u9996\u5148\u5c06\u52a0\u8f7d\u4efb\u52a1\u59d4\u6258\u7ed9\u7236\u7c7b\u52a0\u8f7d\u5668\uff0c\u4f9d\u6b21\u9012\u5f52\uff0c\u5982\u679c\u7236\u7c7b\u52a0\u8f7d\u5668\u53ef\u4ee5\u5b8c\u6210\u7c7b\u52a0\u8f7d\u4efb\u52a1\uff0c\u5c31\u6210\u529f\u8fd4\u56de\uff1b\u53ea\u6709\u7236\u7c7b\u52a0\u8f7d\u5668\u65e0\u6cd5\u5b8c\u6210\u6b64\u52a0\u8f7d\u4efb\u52a1\u65f6\uff0c\u624d\u4f1a\u81ea\u5df1\u53bb\u52a0\u8f7d\u3002</p> <p>\u4f7f\u7528\u53cc\u4eb2\u59d4\u6258\u6a21\u578b\u7684\u597d\u5904\u5728\u4e8eJava\u7c7b\u968f\u7740\u5b83\u7684\u7c7b\u52a0\u8f7d\u5668\u4e00\u8d77\u5177\u5907\u7c7b\u4e00\u79cd\u5e26\u6709\u4f18\u5148\u7ea7\u7684\u5c42\u6b21\u5173\u7cfb\u3002\u4f8b\u5982\u7c7bjava.lang.Object\uff0c\u5b83\u5b58\u5728rt.jar\u4e2d\uff0c\u65e0\u8bba\u54ea\u4e00\u4e2a\u7c7b\u52a0\u8f7d\u5668\u8981\u52a0\u8f7d\u8fd9\u4e2a\u7c7b\uff0c\u6700\u7ec8\u90fd\u4f1a\u59d4\u6258\u5904\u4e8e\u6a21\u578b\u6700\u9876\u7aef\u7684Bootstrap ClassLoader\u8fdb\u884c\u52a0\u8f7d\uff0c\u56e0\u6b64Object\u7c7b\u5728\u7a0b\u5e8f\u7684\u5404\u7c7b\u52a0\u8f7d\u5668\u73af\u5883\u4e2d\u90fd\u662f\u540c\u4e00\u4e2a\u7c7b\u3002\u76f8\u53cd\uff0c\u5982\u679c\u6ca1\u6709\u53cc\u4eb2\u59d4\u6d3e\u6a21\u578b\uff0c\u800c\u662f\u7531\u5404\u4e2a\u7c7b\u52a0\u8f7d\u5668\u81ea\u884c\u52a0\u8f7d\u7684\u8bdd\uff0c\u5982\u679c\u7528\u6237\u7f16\u5199\u4e86\u4e00\u4e2ajava.lang.Object\u7684\u540c\u540d\u7c7b\u5e76\u653e\u5728ClassPath\u4e2d\uff0c\u90a3\u4e48\u7cfb\u7edf\u4e2d\u5c06\u4f1a\u51fa\u73b0\u591a\u4e2a\u4e0d\u540c\u7684Object\u7c7b\uff0c\u7a0b\u5e8f\u5c06\u53d8\u5f97\u6df7\u4e71\u3002\u56e0\u6b64\uff0c\u5982\u679c\u5f00\u53d1\u8005\u5c1d\u8bd5\u7f16\u5199\u4e00\u4e2a\u4e0ert.jar\u7c7b\u5e93\u4e2d\u91cd\u540d\u7684Java\u7c7b\uff0c\u53ef\u4ee5\u6b63\u5e38\u7f16\u8bd1\uff0c\u4f46\u662f\u6c38\u8fdc\u65e0\u6cd5\u88ab\u52a0\u8f7d\u8fd0\u884c\u3002</p> <p>\u5f53\u524dClassLoader\u9996\u5148\u4ece\u81ea\u5df1\u5df2\u7ecf\u52a0\u8f7d\u7684\u7c7b\u4e2d\u67e5\u8be2\u662f\u5426\u6b64\u7c7b\u5df2\u7ecf\u8bb0\u8f7d\uff0c\u5982\u679c\u5df2\u7ecf\u52a0\u8f7d\u5219\u53ef\u4ee5\u76f4\u63a5\u8fd4\u56de\u5df2\u7ecf\u52a0\u8f7d\u7684\u7c7b\u3002</p> <p>\u6bcf\u4e2a\u7c7b\u52a0\u8f7d\u5668\u90fd\u6709\u81ea\u5df1\u7684\u52a0\u8f7d\u7f13\u5b58\uff0c\u5f53\u4e00\u4e2a\u7c7b\u88ab\u52a0\u8f7d\u4e86\u4ee5\u540e\u5c31\u4f1a\u653e\u5165\u7f13\u5b58\uff0c\u7b49\u4e0b\u6b21\u52a0\u8f7d\u7684\u65f6\u5019\u5c31\u53ef\u4ee5\u76f4\u63a5\u8fd4\u56de\u4e86\u3002</p> <p>\u5f53\u524dClassLoader\u7684\u7f13\u5b58\u4e2d\u6ca1\u6709\u627e\u5230\u88ab\u52a0\u8f7d\u7684\u7c7b\u7684\u65f6\u5019\uff0c\u4f1a\u59d4\u6258\u7236\u7c7b\u52a0\u8f7d\u5668\u53bb\u52a0\u8f7d\uff0c\u7236\u7c7b\u52a0\u8f7d\u5668\u91c7\u7528\u540c\u6837\u7684\u7b56\u7565\uff0c\u9996\u5148\u67e5\u770b\u81ea\u5df1\u7684\u7f13\u5b58\uff0c\u7136\u540e\u59d4\u6258\u7236\u7c7b\u7684\u7236\u7c7b\u53bb\u52a0\u8f7d\uff0c\u4e00\u76f4\u5230BootStrap ClassLoader\u3002</p> <p>\u5f53\u6240\u6709\u7684\u7236\u7c7b\u52a0\u8f7d\u5668\u90fd\u6ca1\u6709\u52a0\u8f7d\u7684\u65f6\u5019\uff0c\u518d\u6709\u5f53\u524d\u7684\u7c7b\u52a0\u8f7d\u5668\u52a0\u8f7d\uff0c\u5e76\u5c06\u5176\u653e\u5165\u5b83\u81ea\u5df1\u7684\u7f13\u5b58\u4e2d\uff0c\u4ee5\u4fbf\u4e0b\u6b21\u52a0\u8f7d\u8bf7\u6c42\u65f6\u76f4\u63a5\u8fd4\u56de\u3002</p> <p>\u4e3a\u4ec0\u4e48\u9700\u8981\u8fd9\u6837\u7684\u59d4\u6258\u673a\u5236\u5462\uff1f\u7406\u89e3\u8fd9\u4e2a\u95ee\u9898\uff0c\u6211\u4eec\u8981\u5f15\u5165\u53e6\u5916\u4e00\u4e2a\u5173\u4e8eClassLoader\u7684\u6982\u5ff5\u201c\u547d\u540d\u7a7a\u95f4\u201d\uff0c\u5b83\u662f\u6307\u8981\u786e\u5b9a\u67d0\u4e00\u4e2a\u7c7b\uff0c\u9700\u8981\u7c7b\u7684\u5168\u9650\u5b9a\u540d\u4ee5\u53ca\u52a0\u8f7d\u6b64\u7c7b\u7684ClassLoader\u6765\u5171\u540c\u786e\u5b9a\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u5373\u4f7f\u4e24\u4e2a\u7c7b\u7684\u5168\u9650\u5b9a\u540d\u76f8\u540c\uff0c\u4f46\u662f\u56e0\u4e3a\u4e0d\u540c\u7684ClassLoader\u52a0\u8f7d\u4e86\u6b64\u7c7b\uff0c\u90a3\u4e48\u5728JVM\u4e2d\u5b83\u662f\u4e0d\u540c\u7684\u7c7b\u3002\u660e\u767d\u4e86\u547d\u540d\u7a7a\u95f4\u4ee5\u540e\uff0c\u6211\u4eec\u518d\u6765\u770b\u770b\u59d4\u6258\u6a21\u578b\u3002\u91c7\u7528\u4e86\u59d4\u6258\u6a21\u578b\u4ee5\u540e\u52a0\u5927\u4e86\u4e0d\u540c\u7684ClassLoader\u7684\u4ea4\u4e92\u80fd\u529b\uff0c\u6bd4\u5982\u4e0a\u9762\u8bf4\u7684\uff0c\u6211\u4eecJDK\u672c\u8eab\u63d0\u4f9b\u7684\u7c7b\u5e93\uff0c\u6bd4\u5982HashMap\u3001LinkedList\u7b49\u7b49\uff0c\u8fd9\u4e9b\u7c7b\u7531bootstrap\u7c7b\u52a0\u8f7d\u5668\u52a0\u8f7d\u4ee5\u540e\uff0c\u65e0\u8bba\u4f60\u7a0b\u5e8f\u4e2d\u6709\u591a\u5c11\u4e2a\u7c7b\u52a0\u8f7d\u5668\uff0c\u90a3\u4e48\u8fd9\u4e9b\u7c7b\u5176\u5b9e\u90fd\u662f\u53ef\u4ee5\u5171\u4eab\u7684\uff0c\u8fd9\u6837\u5c31\u907f\u514d\u4e86\u4e0d\u540c\u7684\u7c7b\u52a0\u8f7d\u5668\u52a0\u8f7d\u4e86\u540c\u6837\u540d\u5b57\u7684\u4e0d\u540c\u7c7b\u4ee5\u540e\u9020\u6210\u6df7\u4e71\u3002</p>"},{"location":"010Java/010Basic/#_43","title":"\u4e3a\u4ec0\u4e48\u9700\u8981\u7c7b\u52a0\u8f7d\u6d41\u7a0b\u53cc\u4eb2\u59d4\u6258\u673a\u5236\uff1f\u5b83\u89e3\u51b3\u4e86\u4ec0\u4e48\u95ee\u9898\uff1f","text":"\u7b54\u6848 <p>Java \u7684\u7c7b\u52a0\u8f7d\u6d41\u7a0b\u91c7\u7528\u53cc\u4eb2\u59d4\u6258\u673a\u5236\uff0c\u4e3b\u8981\u662f\u4e3a\u4e86\u89e3\u51b3\u4ee5\u4e0b\u95ee\u9898\uff1a</p>"},{"location":"010Java/010Basic/#1_2","title":"1. \u907f\u514d\u91cd\u590d\u52a0\u8f7d","text":"<ul> <li>\u95ee\u9898\uff1a\u5982\u679c\u4e00\u4e2a\u7c7b\u88ab\u591a\u4e2a\u7c7b\u52a0\u8f7d\u5668\u52a0\u8f7d\uff0c\u53ef\u80fd\u4f1a\u5bfc\u81f4\u540c\u4e00\u4e2a\u7c7b\u5728\u5185\u5b58\u4e2d\u5b58\u5728\u591a\u4e2a\u7248\u672c\uff0c\u5f15\u53d1\u51b2\u7a81\u3002</li> <li>\u89e3\u51b3\uff1a\u53cc\u4eb2\u59d4\u6258\u673a\u5236\u786e\u4fdd\u7c7b\u52a0\u8f7d\u8bf7\u6c42\u5148\u4ea4\u7ed9\u7236\u7c7b\u52a0\u8f7d\u5668\u5904\u7406\uff0c\u7236\u7c7b\u52a0\u8f7d\u5668\u5df2\u52a0\u8f7d\u7684\u7c7b\uff0c\u5b50\u7c7b\u52a0\u8f7d\u5668\u4e0d\u4f1a\u91cd\u590d\u52a0\u8f7d\uff0c\u4ece\u800c\u907f\u514d\u7c7b\u7684\u91cd\u590d\u52a0\u8f7d\u3002</li> </ul>"},{"location":"010Java/010Basic/#2_2","title":"2. \u4fdd\u8bc1\u6838\u5fc3\u7c7b\u5e93\u7684\u5b89\u5168\u6027","text":"<ul> <li>\u95ee\u9898\uff1a\u7528\u6237\u81ea\u5b9a\u4e49\u7684\u7c7b\u52a0\u8f7d\u5668\u53ef\u80fd\u52a0\u8f7d\u6076\u610f\u4ee3\u7801\uff0c\u66ff\u6362\u6838\u5fc3\u7c7b\u5e93\uff08\u5982 <code>java.lang.String</code>\uff09\uff0c\u7834\u574f\u7cfb\u7edf\u5b89\u5168\u3002</li> <li>\u89e3\u51b3\uff1a\u53cc\u4eb2\u59d4\u6258\u673a\u5236\u4f18\u5148\u7531\u542f\u52a8\u7c7b\u52a0\u8f7d\u5668\u52a0\u8f7d\u6838\u5fc3\u7c7b\u5e93\uff0c\u9632\u6b62\u7528\u6237\u81ea\u5b9a\u4e49\u7c7b\u66ff\u6362\u6838\u5fc3\u7c7b\uff0c\u786e\u4fdd\u6838\u5fc3\u7c7b\u5e93\u7684\u5b89\u5168\u6027\u3002</li> </ul>"},{"location":"010Java/010Basic/#3_2","title":"3. \u786e\u4fdd\u7c7b\u7684\u552f\u4e00\u6027","text":"<ul> <li>\u95ee\u9898\uff1a\u4e0d\u540c\u7c7b\u52a0\u8f7d\u5668\u52a0\u8f7d\u540c\u4e00\u4e2a\u7c7b\uff0c\u53ef\u80fd\u5bfc\u81f4\u7c7b\u7684\u884c\u4e3a\u4e0d\u4e00\u81f4\u3002</li> <li>\u89e3\u51b3\uff1a\u53cc\u4eb2\u59d4\u6258\u673a\u5236\u786e\u4fdd\u7c7b\u7531\u540c\u4e00\u4e2a\u52a0\u8f7d\u5668\u52a0\u8f7d\uff0c\u4fdd\u8bc1\u7c7b\u7684\u552f\u4e00\u6027\uff0c\u907f\u514d\u56e0\u4e0d\u540c\u52a0\u8f7d\u5668\u5bfc\u81f4\u7684\u7c7b\u884c\u4e3a\u5dee\u5f02\u3002</li> </ul>"},{"location":"010Java/010Basic/#4_2","title":"4. \u7b80\u5316\u7c7b\u52a0\u8f7d\u5668\u7684\u5b9e\u73b0","text":"<ul> <li>\u95ee\u9898\uff1a\u7c7b\u52a0\u8f7d\u5668\u9700\u8981\u5904\u7406\u590d\u6742\u7684\u7c7b\u52a0\u8f7d\u903b\u8f91\uff0c\u5b9e\u73b0\u96be\u5ea6\u5927\u3002</li> <li>\u89e3\u51b3\uff1a\u53cc\u4eb2\u59d4\u6258\u673a\u5236\u5c06\u7c7b\u52a0\u8f7d\u8bf7\u6c42\u9010\u7ea7\u59d4\u6258\uff0c\u7b80\u5316\u4e86\u7c7b\u52a0\u8f7d\u5668\u7684\u5b9e\u73b0\uff0c\u53ea\u9700\u5173\u6ce8\u7279\u5b9a\u8def\u5f84\u7684\u7c7b\u52a0\u8f7d\u3002</li> </ul>"},{"location":"010Java/010Basic/#_44","title":"\u53cc\u4eb2\u59d4\u6258\u673a\u5236\u7684\u5de5\u4f5c\u6d41\u7a0b","text":"<ol> <li>\u68c0\u67e5\u7c7b\u662f\u5426\u5df2\u52a0\u8f7d\uff1a\u7c7b\u52a0\u8f7d\u5668\u5148\u68c0\u67e5\u7c7b\u662f\u5426\u5df2\u88ab\u52a0\u8f7d\u3002</li> <li>\u59d4\u6258\u7236\u7c7b\u52a0\u8f7d\u5668\uff1a\u82e5\u672a\u52a0\u8f7d\uff0c\u5c06\u8bf7\u6c42\u59d4\u6258\u7ed9\u7236\u7c7b\u52a0\u8f7d\u5668\u3002</li> <li>\u7236\u7c7b\u52a0\u8f7d\u5668\u5904\u7406\uff1a\u7236\u7c7b\u52a0\u8f7d\u5668\u91cd\u590d\u6b64\u8fc7\u7a0b\uff0c\u76f4\u5230\u542f\u52a8\u7c7b\u52a0\u8f7d\u5668\u3002</li> <li>\u81ea\u884c\u52a0\u8f7d\uff1a\u82e5\u7236\u7c7b\u52a0\u8f7d\u5668\u65e0\u6cd5\u52a0\u8f7d\uff0c\u5b50\u7c7b\u52a0\u8f7d\u5668\u624d\u5c1d\u8bd5\u52a0\u8f7d\u3002</li> </ol>"},{"location":"010Java/010Basic/#_45","title":"\u793a\u4f8b","text":"<p><pre><code>public class Main {\n    public static void main(String[] args) {\n        ClassLoader classLoader = Main.class.getClassLoader();\n        while (classLoader != null) {\n            System.out.println(classLoader);\n            classLoader = classLoader.getParent();\n        }\n    }\n}\n</code></pre> \u8f93\u51fa\u53ef\u80fd\u4e3a\uff1a <pre><code>sun.misc.Launcher$AppClassLoader@18b4aac2\nsun.misc.Launcher$ExtClassLoader@6d06d69c\n</code></pre> \u663e\u793a\u7c7b\u52a0\u8f7d\u5668\u7684\u5c42\u6b21\u7ed3\u6784\u3002</p>"},{"location":"010Java/010Basic/#_46","title":"\u603b\u7ed3","text":"<p>\u53cc\u4eb2\u59d4\u6258\u673a\u5236\u901a\u8fc7\u907f\u514d\u91cd\u590d\u52a0\u8f7d\u3001\u786e\u4fdd\u6838\u5fc3\u7c7b\u5e93\u5b89\u5168\u3001\u4fdd\u8bc1\u7c7b\u7684\u552f\u4e00\u6027\u548c\u7b80\u5316\u7c7b\u52a0\u8f7d\u5668\u5b9e\u73b0\uff0c\u89e3\u51b3\u4e86\u7c7b\u52a0\u8f7d\u8fc7\u7a0b\u4e2d\u7684\u591a\u4e2a\u95ee\u9898\u3002</p>"},{"location":"010Java/010Basic/#_47","title":"\u53cc\u4eb2\u59d4\u6d3e\u6a21\u578b","text":"\u7b54\u6848 <p>\u7c7b\u52a0\u8f7d\u5668\u5927\u81f4\u5206\u4e3a3\u7c7b\uff1a\u542f\u52a8\u7c7b\u52a0\u8f7d\u5668\u3001\u6269\u5c55\u7c7b\u52a0\u8f7d\u5668\u3001\u5e94\u7528\u7a0b\u5e8f\u7c7b\u52a0\u8f7d\u5668\u3002</p> <p>\u542f\u52a8\u7c7b\u52a0\u8f7d\u5668\u4e3b\u8981\u52a0\u8f7d jre/lib\u4e0b\u7684jar\u6587\u4ef6\u3002</p> <p>\u6269\u5c55\u7c7b\u52a0\u8f7d\u5668\u4e3b\u8981\u52a0\u8f7d jre/lib/ext \u4e0b\u7684jar\u6587\u4ef6\u3002</p> <p>\u5e94\u7528\u7a0b\u5e8f\u7c7b\u52a0\u8f7d\u5668\u4e3b\u8981\u52a0\u8f7d classpath \u4e0b\u7684\u6587\u4ef6\u3002</p> <p>\u6240\u8c13\u7684\u53cc\u4eb2\u59d4\u6d3e\u6a21\u578b\u5c31\u662f\u5f53\u52a0\u8f7d\u4e00\u4e2a\u7c7b\u65f6\uff0c\u4f1a\u4f18\u5148\u4f7f\u7528\u7236\u7c7b\u52a0\u8f7d\u5668\u52a0\u8f7d\uff0c\u5f53\u7236\u7c7b\u52a0\u8f7d\u5668\u65e0\u6cd5\u52a0\u8f7d\u65f6\u624d\u4f1a\u4f7f\u7528\u5b50\u7c7b\u52a0\u8f7d\u5668\u53bb\u52a0\u8f7d\u3002\u8fd9\u4e48\u505a\u7684\u76ee\u7684\u662f\u4e3a\u4e86\u907f\u514d\u7c7b\u7684\u91cd\u590d\u52a0\u8f7d\u3002</p>"},{"location":"010Java/010Basic/#_48","title":"Java\u57fa\u7840","text":"\u7b54\u6848"},{"location":"010Java/020DataStructure/","title":"\u6570\u636e\u7ed3\u6784","text":""},{"location":"010Java/020DataStructure/#java","title":"JAVA\u5e38\u7528\u96c6\u5408\u7c7b\u529f\u80fd\u3001\u533a\u522b\u548c\u6027\u80fd","text":"\u7b54\u6848 <p>\u5728Java\u4e2d\uff0c\u96c6\u5408\u7c7b\u662f\u7528\u6765\u5b58\u50a8\u548c\u64cd\u4f5c\u4e00\u7ec4\u5bf9\u8c61\u7684\u5bb9\u5668\u3002\u5e38\u7528\u7684\u96c6\u5408\u7c7b\u4e3b\u8981\u5206\u4e3a\u4e24\u5927\u7c7b\uff1aCollection \u548c Map\u3002\u4ee5\u4e0b\u662f\u5e38\u89c1\u7684\u96c6\u5408\u7c7b\u53ca\u5176\u529f\u80fd\u3001\u533a\u522b\u548c\u6027\u80fd\u5206\u6790\u3002</p>"},{"location":"010Java/020DataStructure/#collection","title":"\u4e00\u3001Collection \u63a5\u53e3","text":"<p>Collection \u63a5\u53e3\u662f\u5355\u5217\u96c6\u5408\u7684\u6839\u63a5\u53e3\uff0c\u4e3b\u8981\u5206\u4e3a\u4ee5\u4e0b\u4e09\u7c7b\uff1a 1. List\uff1a\u6709\u5e8f\u3001\u53ef\u91cd\u590d\u7684\u96c6\u5408\u3002 2. Set\uff1a\u65e0\u5e8f\u3001\u4e0d\u53ef\u91cd\u590d\u7684\u96c6\u5408\u3002 3. Queue\uff1a\u961f\u5217\uff0c\u652f\u6301\u5148\u8fdb\u5148\u51fa\uff08FIFO\uff09\u6216\u4f18\u5148\u7ea7\u6392\u5e8f\u3002</p>"},{"location":"010Java/020DataStructure/#1-list","title":"1. List \u63a5\u53e3","text":""},{"location":"010Java/020DataStructure/#_2","title":"\u5e38\u7528\u5b9e\u73b0\u7c7b\uff1a","text":"<ul> <li>ArrayList</li> <li>LinkedList</li> <li>Vector\uff08\u5df2\u8fc7\u65f6\uff0c\u4e0d\u63a8\u8350\u4f7f\u7528\uff09</li> </ul>"},{"location":"010Java/020DataStructure/#_3","title":"\u529f\u80fd\uff1a","text":"<ul> <li>\u6709\u5e8f\u96c6\u5408\uff0c\u5141\u8bb8\u91cd\u590d\u5143\u7d20\u3002</li> <li>\u652f\u6301\u901a\u8fc7\u7d22\u5f15\u8bbf\u95ee\u5143\u7d20\u3002</li> </ul>"},{"location":"010Java/020DataStructure/#_4","title":"\u533a\u522b\uff1a","text":"<ul> <li>ArrayList\uff1a</li> <li>\u57fa\u4e8e\u52a8\u6001\u6570\u7ec4\u5b9e\u73b0\u3002</li> <li>\u67e5\u8be2\u5feb\uff08O(1)\uff09\uff0c\u589e\u5220\u6162\uff08O(n)\uff09\u3002</li> <li>\u7ebf\u7a0b\u4e0d\u5b89\u5168\u3002</li> <li>LinkedList\uff1a</li> <li>\u57fa\u4e8e\u53cc\u5411\u94fe\u8868\u5b9e\u73b0\u3002</li> <li>\u589e\u5220\u5feb\uff08O(1)\uff09\uff0c\u67e5\u8be2\u6162\uff08O(n)\uff09\u3002</li> <li>\u652f\u6301\u961f\u5217\u548c\u6808\u64cd\u4f5c\u3002</li> <li>Vector\uff1a</li> <li>\u7c7b\u4f3c\u4e8e ArrayList\uff0c\u4f46\u7ebf\u7a0b\u5b89\u5168\uff08\u6027\u80fd\u8f83\u5dee\uff09\u3002</li> <li>\u5df2\u8fc7\u65f6\uff0c\u63a8\u8350\u4f7f\u7528 <code>Collections.synchronizedList</code> \u6216 <code>CopyOnWriteArrayList</code>\u3002</li> </ul>"},{"location":"010Java/020DataStructure/#_5","title":"\u6027\u80fd\uff1a","text":"<ul> <li>ArrayList\uff1a\u9002\u5408\u9891\u7e41\u67e5\u8be2\u7684\u573a\u666f\u3002</li> <li>LinkedList\uff1a\u9002\u5408\u9891\u7e41\u589e\u5220\u7684\u573a\u666f\u3002</li> </ul>"},{"location":"010Java/020DataStructure/#2-set","title":"2. Set \u63a5\u53e3","text":""},{"location":"010Java/020DataStructure/#_6","title":"\u5e38\u7528\u5b9e\u73b0\u7c7b\uff1a","text":"<ul> <li>HashSet</li> <li>LinkedHashSet</li> <li>TreeSet</li> </ul>"},{"location":"010Java/020DataStructure/#_7","title":"\u529f\u80fd\uff1a","text":"<ul> <li>\u65e0\u5e8f\u96c6\u5408\uff0c\u4e0d\u5141\u8bb8\u91cd\u590d\u5143\u7d20\u3002</li> </ul>"},{"location":"010Java/020DataStructure/#_8","title":"\u533a\u522b\uff1a","text":"<ul> <li>HashSet\uff1a</li> <li>\u57fa\u4e8e\u54c8\u5e0c\u8868\u5b9e\u73b0\u3002</li> <li>\u63d2\u5165\u3001\u5220\u9664\u3001\u67e5\u8be2\u6027\u80fd\u63a5\u8fd1 O(1)\u3002</li> <li>\u65e0\u5e8f\u3002</li> <li>LinkedHashSet\uff1a</li> <li>\u57fa\u4e8e\u54c8\u5e0c\u8868\u548c\u94fe\u8868\u5b9e\u73b0\u3002</li> <li>\u4fdd\u7559\u63d2\u5165\u987a\u5e8f\u3002</li> <li>\u6027\u80fd\u7565\u4f4e\u4e8e HashSet\u3002</li> <li>TreeSet\uff1a</li> <li>\u57fa\u4e8e\u7ea2\u9ed1\u6811\u5b9e\u73b0\u3002</li> <li>\u5143\u7d20\u6309\u81ea\u7136\u987a\u5e8f\u6216\u81ea\u5b9a\u4e49\u987a\u5e8f\u6392\u5e8f\u3002</li> <li>\u63d2\u5165\u3001\u5220\u9664\u3001\u67e5\u8be2\u6027\u80fd\u4e3a O(log n)\u3002</li> </ul>"},{"location":"010Java/020DataStructure/#_9","title":"\u6027\u80fd\uff1a","text":"<ul> <li>HashSet\uff1a\u9002\u5408\u9700\u8981\u5feb\u901f\u67e5\u627e\u7684\u573a\u666f\u3002</li> <li>TreeSet\uff1a\u9002\u5408\u9700\u8981\u6392\u5e8f\u7684\u573a\u666f\u3002</li> </ul>"},{"location":"010Java/020DataStructure/#3-queue","title":"3. Queue \u63a5\u53e3","text":""},{"location":"010Java/020DataStructure/#_10","title":"\u5e38\u7528\u5b9e\u73b0\u7c7b\uff1a","text":"<ul> <li>LinkedList\uff08\u5b9e\u73b0\u4e86 Queue \u63a5\u53e3\uff09</li> <li>PriorityQueue</li> <li>ArrayDeque</li> </ul>"},{"location":"010Java/020DataStructure/#_11","title":"\u529f\u80fd\uff1a","text":"<ul> <li>\u961f\u5217\uff0c\u652f\u6301 FIFO \u6216\u4f18\u5148\u7ea7\u6392\u5e8f\u3002</li> </ul>"},{"location":"010Java/020DataStructure/#_12","title":"\u533a\u522b\uff1a","text":"<ul> <li>LinkedList\uff1a</li> <li>\u652f\u6301 FIFO \u961f\u5217\u64cd\u4f5c\u3002</li> <li>\u6027\u80fd\u4e0e LinkedList \u4e00\u81f4\u3002</li> <li>PriorityQueue\uff1a</li> <li>\u57fa\u4e8e\u5806\u5b9e\u73b0\u3002</li> <li>\u5143\u7d20\u6309\u4f18\u5148\u7ea7\u6392\u5e8f\u3002</li> <li>ArrayDeque\uff1a</li> <li>\u57fa\u4e8e\u52a8\u6001\u6570\u7ec4\u5b9e\u73b0\u3002</li> <li>\u652f\u6301\u53cc\u7aef\u961f\u5217\u64cd\u4f5c\u3002</li> </ul>"},{"location":"010Java/020DataStructure/#_13","title":"\u6027\u80fd\uff1a","text":"<ul> <li>PriorityQueue\uff1a\u9002\u5408\u9700\u8981\u4f18\u5148\u7ea7\u6392\u5e8f\u7684\u573a\u666f\u3002</li> <li>ArrayDeque\uff1a\u9002\u5408\u9700\u8981\u9ad8\u6548\u961f\u5217\u64cd\u4f5c\u7684\u573a\u666f\u3002</li> </ul>"},{"location":"010Java/020DataStructure/#map","title":"\u4e8c\u3001Map \u63a5\u53e3","text":"<p>Map \u662f\u952e\u503c\u5bf9\uff08Key-Value\uff09\u96c6\u5408\uff0c\u952e\u4e0d\u5141\u8bb8\u91cd\u590d\u3002</p>"},{"location":"010Java/020DataStructure/#_14","title":"\u5e38\u7528\u5b9e\u73b0\u7c7b\uff1a","text":"<ul> <li>HashMap</li> <li>LinkedHashMap</li> <li>TreeMap</li> <li>Hashtable\uff08\u5df2\u8fc7\u65f6\uff0c\u4e0d\u63a8\u8350\u4f7f\u7528\uff09</li> </ul>"},{"location":"010Java/020DataStructure/#_15","title":"\u529f\u80fd\uff1a","text":"<ul> <li>\u5b58\u50a8\u952e\u503c\u5bf9\uff0c\u952e\u4e0d\u5141\u8bb8\u91cd\u590d\u3002</li> </ul>"},{"location":"010Java/020DataStructure/#_16","title":"\u533a\u522b\uff1a","text":"<ul> <li>HashMap\uff1a</li> <li>\u57fa\u4e8e\u54c8\u5e0c\u8868\u5b9e\u73b0\u3002</li> <li>\u63d2\u5165\u3001\u5220\u9664\u3001\u67e5\u8be2\u6027\u80fd\u63a5\u8fd1 O(1)\u3002</li> <li>\u65e0\u5e8f\u3002</li> <li>LinkedHashMap\uff1a</li> <li>\u57fa\u4e8e\u54c8\u5e0c\u8868\u548c\u94fe\u8868\u5b9e\u73b0\u3002</li> <li>\u4fdd\u7559\u63d2\u5165\u987a\u5e8f\u6216\u8bbf\u95ee\u987a\u5e8f\u3002</li> <li>\u6027\u80fd\u7565\u4f4e\u4e8e HashMap\u3002</li> <li>TreeMap\uff1a</li> <li>\u57fa\u4e8e\u7ea2\u9ed1\u6811\u5b9e\u73b0\u3002</li> <li>\u952e\u6309\u81ea\u7136\u987a\u5e8f\u6216\u81ea\u5b9a\u4e49\u987a\u5e8f\u6392\u5e8f\u3002</li> <li>\u63d2\u5165\u3001\u5220\u9664\u3001\u67e5\u8be2\u6027\u80fd\u4e3a O(log n)\u3002</li> <li>Hashtable\uff1a</li> <li>\u7c7b\u4f3c\u4e8e HashMap\uff0c\u4f46\u7ebf\u7a0b\u5b89\u5168\uff08\u6027\u80fd\u8f83\u5dee\uff09\u3002</li> <li>\u5df2\u8fc7\u65f6\uff0c\u63a8\u8350\u4f7f\u7528 <code>ConcurrentHashMap</code>\u3002</li> </ul>"},{"location":"010Java/020DataStructure/#_17","title":"\u6027\u80fd\uff1a","text":"<ul> <li>HashMap\uff1a\u9002\u5408\u9700\u8981\u5feb\u901f\u67e5\u627e\u7684\u573a\u666f\u3002</li> <li>TreeMap\uff1a\u9002\u5408\u9700\u8981\u6392\u5e8f\u7684\u573a\u666f\u3002</li> </ul>"},{"location":"010Java/020DataStructure/#_18","title":"\u4e09\u3001\u7ebf\u7a0b\u5b89\u5168\u7684\u96c6\u5408\u7c7b","text":"<ul> <li>Vector\u3001Hashtable\uff1a\u5df2\u8fc7\u65f6\uff0c\u4e0d\u63a8\u8350\u4f7f\u7528\u3002</li> <li>Collections.synchronizedXXX\uff1a\u901a\u8fc7\u5de5\u5177\u7c7b\u5305\u88c5\u975e\u7ebf\u7a0b\u5b89\u5168\u96c6\u5408\u3002</li> <li>CopyOnWriteArrayList\uff1a\u9002\u5408\u8bfb\u591a\u5199\u5c11\u7684\u573a\u666f\u3002</li> <li>CopyOnWriteArraySet\uff1a\u57fa\u4e8e CopyOnWriteArrayList \u5b9e\u73b0\u3002</li> <li>ConcurrentHashMap\uff1a\u9ad8\u5e76\u53d1\u573a\u666f\u4e0b\u7684 HashMap \u66ff\u4ee3\u65b9\u6848\u3002</li> </ul>"},{"location":"010Java/020DataStructure/#_19","title":"\u56db\u3001\u603b\u7ed3","text":"\u96c6\u5408\u7c7b \u7279\u70b9 \u9002\u7528\u573a\u666f \u6027\u80fd\uff08\u5e73\u5747\uff09 ArrayList \u52a8\u6001\u6570\u7ec4\uff0c\u67e5\u8be2\u5feb \u9891\u7e41\u67e5\u8be2 \u67e5\u8be2 O(1)\uff0c\u589e\u5220 O(n) LinkedList \u53cc\u5411\u94fe\u8868\uff0c\u589e\u5220\u5feb \u9891\u7e41\u589e\u5220 \u67e5\u8be2 O(n)\uff0c\u589e\u5220 O(1) HashSet \u54c8\u5e0c\u8868\uff0c\u65e0\u5e8f \u5feb\u901f\u67e5\u627e\u3001\u53bb\u91cd \u63d2\u5165\u3001\u5220\u9664\u3001\u67e5\u8be2 O(1) LinkedHashSet \u54c8\u5e0c\u8868 + \u94fe\u8868\uff0c\u4fdd\u7559\u63d2\u5165\u987a\u5e8f \u9700\u8981\u4fdd\u7559\u63d2\u5165\u987a\u5e8f\u7684\u53bb\u91cd \u6027\u80fd\u7565\u4f4e\u4e8e HashSet TreeSet \u7ea2\u9ed1\u6811\uff0c\u6392\u5e8f \u9700\u8981\u6392\u5e8f\u7684\u53bb\u91cd \u63d2\u5165\u3001\u5220\u9664\u3001\u67e5\u8be2 O(log n) HashMap \u54c8\u5e0c\u8868\uff0c\u65e0\u5e8f \u5feb\u901f\u67e5\u627e\u952e\u503c\u5bf9 \u63d2\u5165\u3001\u5220\u9664\u3001\u67e5\u8be2 O(1) LinkedHashMap \u54c8\u5e0c\u8868 + \u94fe\u8868\uff0c\u4fdd\u7559\u63d2\u5165\u987a\u5e8f \u9700\u8981\u4fdd\u7559\u63d2\u5165\u987a\u5e8f\u7684\u952e\u503c\u5bf9 \u6027\u80fd\u7565\u4f4e\u4e8e HashMap TreeMap \u7ea2\u9ed1\u6811\uff0c\u952e\u6392\u5e8f \u9700\u8981\u6392\u5e8f\u7684\u952e\u503c\u5bf9 \u63d2\u5165\u3001\u5220\u9664\u3001\u67e5\u8be2 O(log n) ConcurrentHashMap \u9ad8\u5e76\u53d1\u54c8\u5e0c\u8868 \u9ad8\u5e76\u53d1\u573a\u666f\u4e0b\u7684\u952e\u503c\u5bf9\u5b58\u50a8 \u63d2\u5165\u3001\u5220\u9664\u3001\u67e5\u8be2 O(1) <p>\u6839\u636e\u5177\u4f53\u9700\u6c42\u9009\u62e9\u5408\u9002\u7684\u96c6\u5408\u7c7b\uff0c\u53ef\u4ee5\u663e\u8457\u63d0\u9ad8\u7a0b\u5e8f\u6027\u80fd\u3002</p>"},{"location":"010Java/020DataStructure/#_20","title":"\u5e76\u53d1\u76f8\u5173\u7684\u96c6\u5408\u7c7b","text":"\u7b54\u6848 <p>\u5728Java\u4e2d\uff0c\u5904\u7406\u5e76\u53d1\u573a\u666f\u65f6\uff0c\u9700\u8981\u4f7f\u7528\u7ebf\u7a0b\u5b89\u5168\u7684\u96c6\u5408\u7c7b\u3002Java\u63d0\u4f9b\u4e86\u591a\u79cd\u5e76\u53d1\u96c6\u5408\u7c7b\uff0c\u8fd9\u4e9b\u7c7b\u5728\u591a\u7ebf\u7a0b\u73af\u5883\u4e0b\u80fd\u591f\u4fdd\u8bc1\u6570\u636e\u7684\u4e00\u81f4\u6027\u548c\u6027\u80fd\u3002\u4ee5\u4e0b\u662f\u5e38\u89c1\u7684\u5e76\u53d1\u96c6\u5408\u7c7b\u53ca\u5176\u7279\u70b9\uff1a</p>"},{"location":"010Java/020DataStructure/#_21","title":"\u4e00\u3001\u5e76\u53d1\u96c6\u5408\u7c7b\u5206\u7c7b","text":"<p>Java\u4e2d\u7684\u5e76\u53d1\u96c6\u5408\u7c7b\u4e3b\u8981\u5206\u4e3a\u4ee5\u4e0b\u51e0\u7c7b\uff1a 1. \u5e76\u53d1 List 2. \u5e76\u53d1 Set 3. \u5e76\u53d1 Map 4. \u5e76\u53d1 Queue</p>"},{"location":"010Java/020DataStructure/#list","title":"\u4e8c\u3001\u5e76\u53d1 List","text":""},{"location":"010Java/020DataStructure/#1-copyonwritearraylist","title":"1. CopyOnWriteArrayList","text":"<ul> <li>\u7279\u70b9\uff1a</li> <li>\u57fa\u4e8e\u5199\u65f6\u590d\u5236\uff08Copy-On-Write\uff09\u673a\u5236\u3002</li> <li>\u6bcf\u6b21\u4fee\u6539\u64cd\u4f5c\uff08\u5982\u6dfb\u52a0\u3001\u5220\u9664\uff09\u90fd\u4f1a\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u6570\u7ec4\u526f\u672c\u3002</li> <li>\u8bfb\u64cd\u4f5c\u4e0d\u9700\u8981\u52a0\u9501\uff0c\u6027\u80fd\u9ad8\u3002</li> <li>\u9002\u7528\u573a\u666f\uff1a</li> <li>\u8bfb\u591a\u5199\u5c11\u7684\u573a\u666f\u3002</li> <li>\u4f8b\u5982\uff1a\u76d1\u542c\u5668\u5217\u8868\u3001\u7f13\u5b58\u3002</li> <li>\u6027\u80fd\uff1a</li> <li>\u8bfb\u64cd\u4f5c\uff1aO(1)\u3002</li> <li>\u5199\u64cd\u4f5c\uff1aO(n)\uff0c\u56e0\u4e3a\u9700\u8981\u590d\u5236\u6570\u7ec4\u3002</li> </ul>"},{"location":"010Java/020DataStructure/#set","title":"\u4e09\u3001\u5e76\u53d1 Set","text":""},{"location":"010Java/020DataStructure/#1-copyonwritearrayset","title":"1. CopyOnWriteArraySet","text":"<ul> <li>\u7279\u70b9\uff1a</li> <li>\u57fa\u4e8e <code>CopyOnWriteArrayList</code> \u5b9e\u73b0\u3002</li> <li>\u540c\u6837\u91c7\u7528\u5199\u65f6\u590d\u5236\u673a\u5236\u3002</li> <li>\u4e0d\u5141\u8bb8\u91cd\u590d\u5143\u7d20\u3002</li> <li>\u9002\u7528\u573a\u666f\uff1a</li> <li>\u8bfb\u591a\u5199\u5c11\u7684\u573a\u666f\u3002</li> <li>\u4f8b\u5982\uff1a\u53bb\u91cd\u7684\u76d1\u542c\u5668\u96c6\u5408\u3002</li> <li>\u6027\u80fd\uff1a</li> <li>\u8bfb\u64cd\u4f5c\uff1aO(1)\u3002</li> <li>\u5199\u64cd\u4f5c\uff1aO(n)\u3002</li> </ul>"},{"location":"010Java/020DataStructure/#2-concurrentskiplistset","title":"2. ConcurrentSkipListSet","text":"<ul> <li>\u7279\u70b9\uff1a</li> <li>\u57fa\u4e8e\u8df3\u8868\uff08SkipList\uff09\u5b9e\u73b0\u3002</li> <li>\u5143\u7d20\u6309\u81ea\u7136\u987a\u5e8f\u6216\u81ea\u5b9a\u4e49\u987a\u5e8f\u6392\u5e8f\u3002</li> <li>\u652f\u6301\u9ad8\u5e76\u53d1\u7684\u63d2\u5165\u3001\u5220\u9664\u548c\u67e5\u8be2\u64cd\u4f5c\u3002</li> <li>\u9002\u7528\u573a\u666f\uff1a</li> <li>\u9700\u8981\u6392\u5e8f\u7684\u5e76\u53d1\u96c6\u5408\u3002</li> <li>\u6027\u80fd\uff1a</li> <li>\u63d2\u5165\u3001\u5220\u9664\u3001\u67e5\u8be2\u64cd\u4f5c\uff1aO(log n)\u3002</li> </ul>"},{"location":"010Java/020DataStructure/#map_1","title":"\u56db\u3001\u5e76\u53d1 Map","text":""},{"location":"010Java/020DataStructure/#1-concurrenthashmap","title":"1. ConcurrentHashMap","text":"<ul> <li>\u7279\u70b9\uff1a</li> <li>\u9ad8\u5e76\u53d1\u573a\u666f\u4e0b\u7684 HashMap \u66ff\u4ee3\u65b9\u6848\u3002</li> <li>\u91c7\u7528\u5206\u6bb5\u9501\uff08JDK 7\uff09\u6216 CAS + synchronized\uff08JDK 8\uff09\u5b9e\u73b0\u3002</li> <li>\u652f\u6301\u9ad8\u5e76\u53d1\u7684\u63d2\u5165\u3001\u5220\u9664\u548c\u67e5\u8be2\u64cd\u4f5c\u3002</li> <li>\u9002\u7528\u573a\u666f\uff1a</li> <li>\u9ad8\u5e76\u53d1\u952e\u503c\u5bf9\u5b58\u50a8\u3002</li> <li>\u4f8b\u5982\uff1a\u7f13\u5b58\u3001\u8ba1\u6570\u5668\u3002</li> <li>\u6027\u80fd\uff1a</li> <li>\u63d2\u5165\u3001\u5220\u9664\u3001\u67e5\u8be2\u64cd\u4f5c\uff1a\u63a5\u8fd1 O(1)\u3002</li> </ul>"},{"location":"010Java/020DataStructure/#2-concurrentskiplistmap","title":"2. ConcurrentSkipListMap","text":"<ul> <li>\u7279\u70b9\uff1a</li> <li>\u57fa\u4e8e\u8df3\u8868\uff08SkipList\uff09\u5b9e\u73b0\u3002</li> <li>\u952e\u6309\u81ea\u7136\u987a\u5e8f\u6216\u81ea\u5b9a\u4e49\u987a\u5e8f\u6392\u5e8f\u3002</li> <li>\u652f\u6301\u9ad8\u5e76\u53d1\u7684\u63d2\u5165\u3001\u5220\u9664\u548c\u67e5\u8be2\u64cd\u4f5c\u3002</li> <li>\u9002\u7528\u573a\u666f\uff1a</li> <li>\u9700\u8981\u6392\u5e8f\u7684\u5e76\u53d1\u952e\u503c\u5bf9\u5b58\u50a8\u3002</li> <li>\u6027\u80fd\uff1a</li> <li>\u63d2\u5165\u3001\u5220\u9664\u3001\u67e5\u8be2\u64cd\u4f5c\uff1aO(log n)\u3002</li> </ul>"},{"location":"010Java/020DataStructure/#queue","title":"\u4e94\u3001\u5e76\u53d1 Queue","text":""},{"location":"010Java/020DataStructure/#1-blockingqueue","title":"1. BlockingQueue \u63a5\u53e3","text":"<ul> <li>\u7279\u70b9\uff1a</li> <li>\u652f\u6301\u963b\u585e\u64cd\u4f5c\u7684\u961f\u5217\u3002</li> <li>\u5f53\u961f\u5217\u4e3a\u7a7a\u65f6\uff0c\u83b7\u53d6\u64cd\u4f5c\u4f1a\u88ab\u963b\u585e\uff1b\u5f53\u961f\u5217\u6ee1\u65f6\uff0c\u63d2\u5165\u64cd\u4f5c\u4f1a\u88ab\u963b\u585e\u3002</li> <li>\u5e38\u7528\u5b9e\u73b0\u7c7b\uff1a</li> <li>ArrayBlockingQueue\uff1a<ul> <li>\u57fa\u4e8e\u6570\u7ec4\u5b9e\u73b0\u7684\u6709\u754c\u963b\u585e\u961f\u5217\u3002</li> </ul> </li> <li>LinkedBlockingQueue\uff1a<ul> <li>\u57fa\u4e8e\u94fe\u8868\u5b9e\u73b0\u7684\u53ef\u9009\u6709\u754c\u963b\u585e\u961f\u5217\u3002</li> </ul> </li> <li>PriorityBlockingQueue\uff1a<ul> <li>\u652f\u6301\u4f18\u5148\u7ea7\u6392\u5e8f\u7684\u65e0\u754c\u963b\u585e\u961f\u5217\u3002</li> </ul> </li> <li>SynchronousQueue\uff1a<ul> <li>\u4e0d\u5b58\u50a8\u5143\u7d20\u7684\u963b\u585e\u961f\u5217\uff0c\u6bcf\u4e2a\u63d2\u5165\u64cd\u4f5c\u5fc5\u987b\u7b49\u5f85\u4e00\u4e2a\u5bf9\u5e94\u7684\u5220\u9664\u64cd\u4f5c\u3002</li> </ul> </li> <li>\u9002\u7528\u573a\u666f\uff1a</li> <li>\u751f\u4ea7\u8005-\u6d88\u8d39\u8005\u6a21\u578b\u3002</li> <li>\u6027\u80fd\uff1a</li> <li>\u63d2\u5165\u3001\u5220\u9664\u64cd\u4f5c\uff1aO(1)\uff08\u53d6\u51b3\u4e8e\u5177\u4f53\u5b9e\u73b0\uff09\u3002</li> </ul>"},{"location":"010Java/020DataStructure/#2-concurrentlinkedqueue","title":"2. ConcurrentLinkedQueue","text":"<ul> <li>\u7279\u70b9\uff1a</li> <li>\u57fa\u4e8e\u94fe\u8868\u5b9e\u73b0\u7684\u65e0\u754c\u975e\u963b\u585e\u961f\u5217\u3002</li> <li>\u4f7f\u7528 CAS \u64cd\u4f5c\u4fdd\u8bc1\u7ebf\u7a0b\u5b89\u5168\u3002</li> <li>\u9002\u7528\u573a\u666f\uff1a</li> <li>\u9ad8\u5e76\u53d1\u961f\u5217\u64cd\u4f5c\u3002</li> <li>\u6027\u80fd\uff1a</li> <li>\u63d2\u5165\u3001\u5220\u9664\u64cd\u4f5c\uff1aO(1)\u3002</li> </ul>"},{"location":"010Java/020DataStructure/#3-concurrentlinkeddeque","title":"3. ConcurrentLinkedDeque","text":"<ul> <li>\u7279\u70b9\uff1a</li> <li>\u57fa\u4e8e\u94fe\u8868\u5b9e\u73b0\u7684\u65e0\u754c\u975e\u963b\u585e\u53cc\u7aef\u961f\u5217\u3002</li> <li>\u652f\u6301\u4ece\u961f\u5217\u4e24\u7aef\u63d2\u5165\u548c\u5220\u9664\u5143\u7d20\u3002</li> <li>\u9002\u7528\u573a\u666f\uff1a</li> <li>\u9ad8\u5e76\u53d1\u53cc\u7aef\u961f\u5217\u64cd\u4f5c\u3002</li> <li>\u6027\u80fd\uff1a</li> <li>\u63d2\u5165\u3001\u5220\u9664\u64cd\u4f5c\uff1aO(1)\u3002</li> </ul>"},{"location":"010Java/020DataStructure/#_22","title":"\u516d\u3001\u5176\u4ed6\u5e76\u53d1\u5de5\u5177\u7c7b","text":""},{"location":"010Java/020DataStructure/#1-concurrentnavigablemap","title":"1. ConcurrentNavigableMap","text":"<ul> <li>\u7279\u70b9\uff1a</li> <li>\u652f\u6301\u5e76\u53d1\u64cd\u4f5c\u7684\u5bfc\u822a Map\u3002</li> <li>\u5b9e\u73b0\u7c7b\uff1a<code>ConcurrentSkipListMap</code>\u3002</li> </ul>"},{"location":"010Java/020DataStructure/#2-concurrentskiplistset_1","title":"2. ConcurrentSkipListSet","text":"<ul> <li>\u7279\u70b9\uff1a</li> <li>\u57fa\u4e8e <code>ConcurrentSkipListMap</code> \u5b9e\u73b0\u7684\u5e76\u53d1 Set\u3002</li> </ul>"},{"location":"010Java/020DataStructure/#_23","title":"\u4e03\u3001\u603b\u7ed3","text":"\u96c6\u5408\u7c7b \u7279\u70b9 \u9002\u7528\u573a\u666f \u6027\u80fd\uff08\u5e73\u5747\uff09 CopyOnWriteArrayList \u5199\u65f6\u590d\u5236\uff0c\u8bfb\u591a\u5199\u5c11 \u76d1\u542c\u5668\u5217\u8868\u3001\u7f13\u5b58 \u8bfb O(1)\uff0c\u5199 O(n) CopyOnWriteArraySet \u57fa\u4e8e CopyOnWriteArrayList\uff0c\u53bb\u91cd \u53bb\u91cd\u7684\u76d1\u542c\u5668\u96c6\u5408 \u8bfb O(1)\uff0c\u5199 O(n) ConcurrentHashMap \u9ad8\u5e76\u53d1\u952e\u503c\u5bf9\u5b58\u50a8 \u7f13\u5b58\u3001\u8ba1\u6570\u5668 \u63a5\u8fd1 O(1) ConcurrentSkipListMap \u57fa\u4e8e\u8df3\u8868\uff0c\u652f\u6301\u6392\u5e8f \u9700\u8981\u6392\u5e8f\u7684\u5e76\u53d1\u952e\u503c\u5bf9 O(log n) ConcurrentSkipListSet \u57fa\u4e8e ConcurrentSkipListMap\uff0c\u53bb\u91cd \u9700\u8981\u6392\u5e8f\u7684\u5e76\u53d1\u96c6\u5408 O(log n) ArrayBlockingQueue \u57fa\u4e8e\u6570\u7ec4\u7684\u6709\u754c\u963b\u585e\u961f\u5217 \u751f\u4ea7\u8005-\u6d88\u8d39\u8005\u6a21\u578b O(1) LinkedBlockingQueue \u57fa\u4e8e\u94fe\u8868\u7684\u53ef\u9009\u6709\u754c\u963b\u585e\u961f\u5217 \u751f\u4ea7\u8005-\u6d88\u8d39\u8005\u6a21\u578b O(1) PriorityBlockingQueue \u652f\u6301\u4f18\u5148\u7ea7\u7684\u65e0\u754c\u963b\u585e\u961f\u5217 \u9700\u8981\u4f18\u5148\u7ea7\u7684\u4efb\u52a1\u8c03\u5ea6 O(log n) ConcurrentLinkedQueue \u57fa\u4e8e\u94fe\u8868\u7684\u65e0\u754c\u975e\u963b\u585e\u961f\u5217 \u9ad8\u5e76\u53d1\u961f\u5217\u64cd\u4f5c O(1) ConcurrentLinkedDeque \u57fa\u4e8e\u94fe\u8868\u7684\u65e0\u754c\u975e\u963b\u585e\u53cc\u7aef\u961f\u5217 \u9ad8\u5e76\u53d1\u53cc\u7aef\u961f\u5217\u64cd\u4f5c O(1)"},{"location":"010Java/020DataStructure/#_24","title":"\u516b\u3001\u9009\u62e9\u5efa\u8bae","text":"<ol> <li>\u8bfb\u591a\u5199\u5c11\uff1a\u4f7f\u7528 <code>CopyOnWriteArrayList</code> \u6216 <code>CopyOnWriteArraySet</code>\u3002</li> <li>\u9ad8\u5e76\u53d1\u952e\u503c\u5bf9\u5b58\u50a8\uff1a\u4f7f\u7528 <code>ConcurrentHashMap</code>\u3002</li> <li>\u9700\u8981\u6392\u5e8f\u7684\u5e76\u53d1\u96c6\u5408\uff1a\u4f7f\u7528 <code>ConcurrentSkipListMap</code> \u6216 <code>ConcurrentSkipListSet</code>\u3002</li> <li>\u751f\u4ea7\u8005-\u6d88\u8d39\u8005\u6a21\u578b\uff1a\u4f7f\u7528 <code>BlockingQueue</code> \u7684\u5b9e\u73b0\u7c7b\uff08\u5982 <code>ArrayBlockingQueue</code> \u6216 <code>LinkedBlockingQueue</code>\uff09\u3002</li> <li>\u9ad8\u5e76\u53d1\u961f\u5217\u64cd\u4f5c\uff1a\u4f7f\u7528 <code>ConcurrentLinkedQueue</code> \u6216 <code>ConcurrentLinkedDeque</code>\u3002</li> </ol> <p>\u6839\u636e\u5177\u4f53\u9700\u6c42\u9009\u62e9\u5408\u9002\u7684\u5e76\u53d1\u96c6\u5408\u7c7b\uff0c\u53ef\u4ee5\u663e\u8457\u63d0\u9ad8\u591a\u7ebf\u7a0b\u7a0b\u5e8f\u7684\u6027\u80fd\u548c\u53ef\u9760\u6027\u3002</p>"},{"location":"010Java/020DataStructure/#hashmap","title":"HashMap\u5185\u90e8\u7684\u5177\u4f53\u5b9e\u73b0","text":"\u7b54\u6848 <p>\u7b80\u4ecb</p> <pre><code>HashMap \u662f\u4e00\u6563\u5217\u8868\uff0c\u5b83\u5b58\u50a8\u7684\u5185\u5bb9\u662f\u952e\u503c\u5bf9\u7684\u6620\u5c04\u3002\u5b83\u6839\u636e\u952e\u7684hashCode\u503c\u5b58\u50a8\u6570\u636e\uff0c\u5927\u591a\u6570\u60c5\u51b5\u4e0b\u53ef\u4ee5\u76f4\u63a5\u5b9a\u4f4d\u5230\u5b83\u7684\u503c\uff0c\u56e0\u800c\u5177\u6709\u5f88\u5feb\u7684\u8bbf\u95ee\u901f\u5ea6\uff0c\u4f46\u904d\u5386\u987a\u5e8f\u786e\u662f\u4e0d\u786e\u5b9a\u7684\u3002\n</code></pre> <p>HashMap\u6700\u591a\u53ea\u5141\u8bb8\u4e00\u6761\u8bb0\u5f55\u7684\u952e\u4e3anull\uff0c\u5141\u8bb8\u591a\u6761\u8bb0\u5f55\u7684\u503c\u4e3anull\u3002</p> <p>HashMap\u4f7f\u7528hash\u7b97\u6cd5\u8fdb\u884c\u6570\u636e\u7684\u5b58\u50a8\u548c\u67e5\u8be2\uff0c\u5185\u90e8\u4f7f\u7528\u4e00\u4e2aEntry\u8868\u793a\u952e\u503c\u5bf9key-value\u3002\u7528Entry\u7684\u6570\u7ec4\u4fdd\u5b58\u6240\u6709\u952e\u503c\u5bf9\uff0cEntry\u901a\u8fc7\u94fe\u8868\u7684\u65b9\u5f0f\u94fe\u63a5\u540e\u7eed\u7684\u8282\u70b9\uff081.8\u540e\u4f1a\u6839\u636e\u94fe\u8868\u957f\u5ea6\u51b3\u5b9a\u662f\u5426\u8f6c\u6362\u6210\u7ea2\u9ed1\u6811\uff09\uff0cEntry\u901a\u8fc7\u8ba1\u7b97key\u7684hash\u503c\u6765\u51b3\u5b9a\u6620\u5c04\u5230\u5177\u4f53\u7684\u54ea\u4e2a\u6570\u7ec4\uff08\u4e5f\u53ebBucket\uff09\u4e2d\u3002</p> <p>HashMap\u975e\u7ebf\u7a0b\u5b89\u5168\uff0c\u5373\u4efb\u4e00\u65f6\u523b\u53ef\u4ee5\u6709\u591a\u4e2a\u7ebf\u7a0b\u540c\u65f6\u5199HashMap\uff0c\u53ef\u80fd\u4f1a\u5bfc\u81f4\u6570\u636e\u7684\u4e0d\u4e00\u81f4\uff0c\u5982\u679c\u9700\u8981\u6ee1\u8db3\u7ebf\u7a0b\u5b89\u5168\uff0c\u53ef\u4ee5\u7528Collections\u7684synchronizedMap\u65b9\u6cd5\u4f7f\u5f97HashMap\u5177\u6709\u7ebf\u7a0b\u5b89\u5168\u7684\u80fd\u529b\uff0c\u6216\u8005\u4f7f\u7528ConcurrentHaspMap\u3002</p> <p>\u5b58\u50a8\u7ed3\u6784 HashMap\u662f\u6570\u7ec4+\u94fe\u8868+\u7ea2\u9ed1\u6811\u5b9e\u73b0\u7684\u3002</p> <pre><code>public class HashMap&lt;K,V&gt; extends AbstractMap&lt;K,V&gt; implements Map&lt;K,V&gt;, Cloneable, Serializable {\n    private static final long serialVersionUID = 362498820763181265L;\n    /**\n     * HashMap \u7684\u9ed8\u8ba4\u521d\u59cb\u5bb9\u91cf\u4e3a 16\uff0c\u5fc5\u987b\u4e3a 2 \u7684 n \u6b21\u65b9 (\u4e00\u5b9a\u662f\u5408\u6570)\n     */\n    static final int DEFAULT_INITIAL_CAPACITY = 1 &lt;&lt; 4;\n\n    /**\n     * HashMap \u7684\u6700\u5927\u5bb9\u91cf\u4e3a 2 \u7684 30 \u6b21\u5e42\n     */\n    static final int MAXIMUM_CAPACITY = 1 &lt;&lt; 30;        \n\n    /**\n     *  HashMap \u7684\u9ed8\u8ba4\u8d1f\u8f7d\u56e0\u5b50\n     */\n    static final float DEFAULT_LOAD_FACTOR = 0.75f;\n\n    /**\n     * \u94fe\u8868\u8f6c\u6210\u7ea2\u9ed1\u6811\u7684\u9608\u503c\u3002\u5373\u5728\u54c8\u5e0c\u8868\u6269\u5bb9\u65f6\uff0c\u5f53\u94fe\u8868\u7684\u957f\u5ea6(\u6876\u4e2d\u5143\u7d20\u4e2a\u6570)\u8d85\u8fc7\u8fd9\u4e2a\u503c\u7684\u65f6\u5019\uff0c\u8fdb\u884c\u94fe\u8868\u5230\u7ea2\u9ed1\u6811\u7684\u8f6c\u53d8\n     */\n    static final int TREEIFY_THRESHOLD = 8;\n\n    /**\n     * \u7ea2\u9ed1\u6811\u8f6c\u4e3a\u94fe\u8868\u7684\u9608\u503c\u3002\u5373\u5728\u54c8\u5e0c\u8868\u6269\u5bb9\u65f6\uff0c\u5982\u679c\u53d1\u73b0\u94fe\u8868\u957f\u5ea6(\u6876\u4e2d\u5143\u7d20\u4e2a\u6570)\u5c0f\u4e8e 6\uff0c\u5219\u4f1a\u7531\u7ea2\u9ed1\u6811\u91cd\u65b0\u9000\u5316\u4e3a\u94fe\u8868\n     */\n    static final int UNTREEIFY_THRESHOLD = 6;\n\n    /**\n     * HashMap \u7684\u6700\u5c0f\u6811\u5f62\u5316\u5bb9\u91cf\u3002\u8fd9\u4e2a\u503c\u7684\u610f\u4e49\u662f\uff1a\u4f4d\u6876\uff08bin\uff09\u5904\u7684\u6570\u636e\u8981\u91c7\u7528\u7ea2\u9ed1\u6811\u7ed3\u6784\u8fdb\u884c\u5b58\u50a8\u65f6\uff0c\u6574\u4e2aTable\u7684\u6700\u5c0f\u5bb9\u91cf\uff08\u5b58\u50a8\u65b9\u5f0f\u7531\u94fe\u8868\u8f6c\u6210\u7ea2\u9ed1\u6811\u7684\u5bb9\u91cf\u7684\u6700\u5c0f\u9608\u503c\uff09\n     * \u5f53\u54c8\u5e0c\u8868\u4e2d\u7684\u5bb9\u91cf\u5927\u4e8e\u8fd9\u4e2a\u503c\u65f6\uff0c\u8868\u4e2d\u7684\u6876\u624d\u80fd\u8fdb\u884c\u6811\u5f62\u5316\uff0c\u5426\u5219\u6876\u5185\u5143\u7d20\u592a\u591a\u65f6\u4f1a\u6269\u5bb9\uff0c\u800c\u4e0d\u662f\u6811\u5f62\u5316\n     * \u4e3a\u4e86\u907f\u514d\u8fdb\u884c\u6269\u5bb9\u3001\u6811\u5f62\u5316\u9009\u62e9\u7684\u51b2\u7a81\uff0c\u8fd9\u4e2a\u503c\u4e0d\u80fd\u5c0f\u4e8e 4 * TREEIFY_THRESHOLD\n     */\n    static final int MIN_TREEIFY_CAPACITY = 64;\n\n    /**\n     * Node \u662f HashMap \u7684\u4e00\u4e2a\u5185\u90e8\u7c7b\uff0c\u5b9e\u73b0\u4e86 Map.Entry \u63a5\u53e3\uff0c\u672c\u8d28\u662f\u5c31\u662f\u4e00\u4e2a\u6620\u5c04 (\u952e\u503c\u5bf9)\n     * Basic hash bin node, used for most entries.\n     */\n    static class Node&lt;K,V&gt; implements Map.Entry&lt;K,V&gt; {\n        final int hash; // \u7528\u6765\u5b9a\u4f4d\u6570\u7ec4\u7d22\u5f15\u4f4d\u7f6e\n        final K key;\n        V value;\n        Node&lt;K,V&gt; next; // \u94fe\u8868\u7684\u4e0b\u4e00\u4e2anode\n\n        Node(int hash, K key, V value, Node&lt;K,V&gt; next) { ... }\n\n        public final K getKey()        { ... }\n        public final V getValue()      { ... }\n        public final String toString() { ... }\n        public final int hashCode() { ... }\n        public final V setValue(V newValue) { ... }\n        public final boolean equals(Object o) { ... }\n    }\n\n    /**\n     * \u54c8\u5e0c\u6876\u6570\u7ec4\uff0c\u5206\u914d\u7684\u65f6\u5019\uff0ctable\u7684\u957f\u5ea6\u603b\u662f2\u7684\u5e42\n     */\n    transient Node&lt;K,V&gt;[] table;\n\n    /**\n     * Holds cached entrySet(). Note that AbstractMap fields are used\n     * for keySet() and values().\n     */\n    transient Set&lt;Map.Entry&lt;K,V&gt;&gt; entrySet;\n\n    /**\n     * HashMap \u4e2d\u5b9e\u9645\u5b58\u50a8\u7684 key-value \u952e\u503c\u5bf9\u6570\u91cf\n     */\n    transient int size;\n\n    /**\n     * \u7528\u6765\u8bb0\u5f55 HashMap \u5185\u90e8\u7ed3\u6784\u53d1\u751f\u53d8\u5316\u7684\u6b21\u6570\uff0c\u4e3b\u8981\u7528\u4e8e\u8fed\u4ee3\u7684\u5feb\u901f\u5931\u8d25\u673a\u5236\n     */\n    transient int modCount;\n\n    /**\n     * HashMap \u7684\u95e8\u9650\u9600\u503c/\u6269\u5bb9\u9608\u503c\uff0c\u6240\u80fd\u5bb9\u7eb3\u7684 key-value \u952e\u503c\u5bf9\u6781\u9650\uff0c\u5f53size&gt;=threshold\u65f6\uff0c\u5c31\u4f1a\u6269\u5bb9\n     * \u8ba1\u7b97\u65b9\u6cd5\uff1a\u5bb9\u91cfcapacity * \u8d1f\u8f7d\u56e0\u5b50load factor    \n     */\n    int threshold;\n\n    /**\n     * HashMap \u7684\u8d1f\u8f7d\u56e0\u5b50\n     */\n    final float loadFactor;\n}\n\n\u4f5c\u8005\uff1a\u91ce\u72d7\u5b50\u55f7\u55f7\u55f7\n\u94fe\u63a5\uff1ahttps://www.jianshu.com/p/b40fd341711e\n\u4f86\u6e90\uff1a\u7b80\u4e66\n\u7b80\u4e66\u8457\u4f5c\u6743\u5f52\u4f5c\u8005\u6240\u6709\uff0c\u4efb\u4f55\u5f62\u5f0f\u7684\u8f6c\u8f7d\u90fd\u8bf7\u8054\u7cfb\u4f5c\u8005\u83b7\u5f97\u6388\u6743\u5e76\u6ce8\u660e\u51fa\u5904\u3002\n</code></pre> <p>Node[] table\u7684\u521d\u59cb\u5316\u957f\u5ea6\u662f16\uff0c\u8d1f\u8f7d\u56e0\u5b50\u9ed8\u8ba4\u662f0.75\uff0cthreshold\u662fHashMap\u6240\u80fd\u5bb9\u7eb3\u7684\u6700\u5927\u952e\u503c\u5bf9\u3002threshold=length*loadFactor\uff0c\u4e5f\u5c31\u662f\u8bf4\u5f53HashMap\u5b58\u50a8\u7684\u5143\u7d20\u6570\u91cf\u5927\u4e8ethreshold\u65f6\uff0cHashMap\u5c31\u4f1a\u8fdb\u884c\u6269\u5bb9\u7684\u64cd\u4f5c\u3002</p> <p>size\u8fd9\u4e2a\u5b57\u6bb5\u5176\u5b9e\u5f88\u597d\u7406\u89e3\uff0c\u5c31\u662fHashMap\u4e2d\u5b9e\u9645\u5b58\u5728\u7684\u952e\u503c\u5bf9\u6570\u91cf\u3002\u800cmodCount\u5b57\u6bb5\u4e3b\u8981\u7528\u6765\u8bb0\u5f55HashMap\u5185\u90e8\u7ed3\u6784\u53d1\u751f\u53d8\u5316\u7684\u6b21\u6570\uff0c\u4e3b\u8981\u7528\u4e8e\u8fed\u4ee3\u7684\u5feb\u901f\u5931\u8d25\u3002</p> <p>\u5728HashMap\u4e2d\uff0c\u54c8\u5e0c\u6876\u6570\u7ec4table\u7684\u957f\u5ea6length\u5927\u5c0f\u5fc5\u987b\u4e3a2\u7684n\u6b21\u65b9\uff0c\u8fd9\u662f\u4e00\u79cd\u975e\u5e38\u89c4\u7684\u8bbe\u8ba1\uff0c\u5e38\u89c4\u7684\u8bbe\u8ba1\u662f\u628a\u6876\u7684\u5927\u5c0f\u8bbe\u8ba1\u4e3a\u7d20\u6570\uff0c\u76f8\u5bf9\u6765\u8bf4\uff0c\u7d20\u6570\u5bfc\u81f4\u51b2\u7a81\u7684\u6982\u7387\u8981\u5c0f\u3002HashTable\u521d\u59cb\u5316\u6876\u5927\u5c0f\u4e3a11\uff0c\u8fd9\u5c31\u662f\u6876\u5927\u5c0f\u8bbe\u8ba1\u4e3a\u7d20\u6570\u7684\u5e94\u7528\uff08HashTable\u6269\u5bb9\u540e\u4e0d\u80fd\u4fdd\u8bc1\u8fd8\u662f\u7d20\u6570\uff09\u3002HashMap\u91c7\u7528\u8fd9\u79cd\u975e\u5e38\u89c4\u7684\u8bbe\u8ba1\uff0c\u4e3b\u8981\u662f\u4e3a\u4e86\u5728\u53d6\u6a21\u548c\u6269\u5bb9\u65f6\u505a\u4f18\u5316\uff0c\u540c\u65f6\u4e3a\u4e86\u51cf\u5c11\u51b2\u7a81\uff0cHashMap\u5b9a\u4f4d\u54c8\u5e0c\u6876\u7d22\u5f15\u4f4d\u7f6e\u65f6\uff0c\u4e5f\u52a0\u5165\u4e86\u9ad8\u4f4d\u53c2\u4e0e\u8fd0\u7b97\u7684\u8fc7\u7a0b\u3002</p> <p>\u529f\u80fd\u5b9e\u73b0</p> <p>\u89e3\u51b3Hash\u51b2\u7a81\u7684hash()\u65b9\u6cd5\uff1a</p> <p>HashMap\u7684hash\u8ba1\u7b97\u65f6\u5148\u8ba1\u7b97hashCode()\uff0c\u7136\u540e\u8fdb\u884c\u4e8c\u6b21hash\u3002</p> <pre><code>// \u8ba1\u7b97\u4e8c\u6b21Hash\nint hash = hash(key.hashCode());\n\n// \u901a\u8fc7Hash\u627e\u6570\u7ec4\u7d22\u5f15\nint i = hash &amp; (tab.length-1);\n\nstatic final int hash(Object key) {\n    int h;\n    return (key == null) ? 0 : (h = key.hashCode()) ^ (h &gt;&gt;&gt; 16);\n}\n</code></pre> <p>\u5b83\u603b\u662f\u901a\u8fc7h&amp;(table.length-1)\u6765\u5f97\u5230\u8be5\u5bf9\u8c61\u7684\u4fdd\u5b58\u4f4d\u7f6e\uff0c\u800cHashMap\u5e95\u5c42\u6570\u7ec4\u7684\u957f\u5ea6\u603b\u662f2\u7684n\u6b21\u65b9\uff0c\u8fd9\u6837\u4fdd\u8bc1\u4e86\u8ba1\u7b97\u5f97\u5230\u7684\u7d22\u5f15\u503c\u603b\u662f\u4f4d\u4e8etable\u6570\u7ec4\u7684\u7d22\u5f15\u4e4b\u5185\u3002</p> <p>put\u65b9\u6cd5</p> <ol> <li>\u5bf9key\u7684hashCode\u505ahash\uff0c\u7136\u540e\u8ba1\u7b97index</li> <li>\u5982\u679c\u6ca1\u78b0\u649e\uff0c\u5c31\u76f4\u63a5\u653e\u5230bucket\u91cc\uff0c\u5982\u679c\u78b0\u649e\u4e86\uff0c\u4ee5\u94fe\u8868\u7684\u5f62\u5f0f\u5b58\u5728buckets\u540e</li> <li>\u5982\u679c\u78b0\u649e\u5bfc\u81f4\u94fe\u8868\u8fc7\u957f\uff08\u5927\u4e8e\u7b49\u4e8eTREEIFY_THRESHOLD=8\uff09\uff0c\u5c31\u628a\u94fe\u8868\u8f6c\u6362\u4e3a\u7ea2\u9ed1\u6811</li> <li>\u5982\u679c\u8282\u70b9\u5df2\u7ecf\u5b58\u5728\uff0c\u5c31\u66ff\u6362\uff0c\u4fdd\u8bc1key\u7684\u552f\u4e00\u6027</li> <li>\u5982\u679cbucket\u6ee1\u4e86\uff08\u8d85\u8fc7loadFactor*currentCapacity\uff09\uff0c\u5c31\u8981resize</li> </ol> <p>\u5177\u4f53\u6b65\u9aa4\uff1a</p> <ol> <li>\u5982\u679ctable\u6ca1\u6709\u4f7f\u7528\u8fc7\u7684\u60c5\u51b5\uff0c\uff08tab=table\uff09==null||(n=length)==0\uff0c\u5219\u4ee5\u9ed8\u8ba4\u5927\u5c0f\u8fdb\u884c\u4e00\u6b21resize</li> <li>\u8ba1\u7b97key\u7684hash\u503c\uff0c\u7136\u540e\u83b7\u53d6\u5e95\u5c42table\u6570\u7ec4\u7684\u7b2c\uff08n-1\uff09&amp;hash\u7684\u4f4d\u7f6e\u7684\u6570\u7ec4\u7d22\u5f15tab[i]\u5904\u7684\u6570\u636e\uff0c\u5373hash\u5bf9n\u53d6\u6a21\u7684\u4f4d\u7f6e\uff0c\u4f9d\u8d56\u7684\u662fn\u4e3a2\u7684\u6b21\u65b9\u7684\u8fd9\u4e00\u6761\u4ef6</li> <li>\u5148\u68c0\u67e5\u8be5bucket\u7b2c\u4e00\u4e2a\u5143\u7d20\u662f\u5426\u662f\u548c\u63d2\u5165\u7684key\u76f8\u7b49\uff08\u5982\u679c\u662f\u540c\u4e00\u4e2a\u5bf9\u8c61\u5219\u80af\u5b9aequals\uff09</li> <li>\u5982\u679c\u4e0d\u76f8\u7b49\u5e76\u4e14\u662fTreeNode\u7684\u60c5\u51b5\uff0c\u8c03\u7528TreeNode\u7684put\u65b9\u6cd5</li> <li>\u5426\u5219\u5faa\u73af\u904d\u5386\u94fe\u8868\uff0c\u5982\u679c\u627e\u5230\u76f8\u7b49\u7684key\u8df3\u51fa\u5faa\u73af\u5426\u5219\u8fbe\u5230\u6700\u540e\u4e00\u4e2a\u8282\u70b9\u65f6\u5c06\u65b0\u7684\u8282\u70b9\u6dfb\u52a0\u5230\u94fe\u8868\u6700\u540e\uff0c\u5f53\u524d\u9762\u627e\u5230\u4e86\u76f8\u540c\u7684key\u7684\u60c5\u51b5\u4e0b\u66ff\u6362\u8fd9\u4e2a\u8282\u70b9\u7684value\u4e3a\u65b0\u7684value</li> <li>\u5982\u679c\u65b0\u589e\u4e86key-value\u5bf9\uff0c\u5219\u589e\u52a0size\u5e76\u4e14\u5224\u65ad\u662f\u5426\u8d85\u8fc7\u4e86threshold\uff0c\u5982\u679c\u8d85\u8fc7\u4e86\u5219\u9700\u8981\u8fdb\u884cresize\u6269\u5bb9</li> </ol> <pre><code>public V put(K key, V value) {\n    // \u5bf9key\u7684hashCode()\u505ahash\n    return putVal(hash(key), key, value, false, true);\n}\n\n/**\n * Implements Map.put and related methods\n *\n * @param hash hash for key\n * @param key the key\n * @param value the value to put\n * @param onlyIfAbsent if true, don't change existing value\n * @param evict if false, the table is in creation mode.\n * @return previous value, or null if none\n */\nfinal V putVal(int hash, K key, V value, boolean onlyIfAbsent,\n                boolean evict) {\n    Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; p; int n, i;\n    // table\u4e3a\u7a7a\u6216\u8005length=0\u65f6\uff0c\u4ee5\u9ed8\u8ba4\u5927\u5c0f\u6269\u5bb9\uff0cn\u4e3atable\u7684\u957f\u5ea6    \n    if ((tab = table) == null || (n = tab.length) == 0)\n        n = (tab = resize()).length;\n    // \u8ba1\u7b97index\uff0c\u5e76\u5bf9null\u505a\u5904\u7406\uff0ctable[i]==null\n    if ((p = tab[i = (n - 1) &amp; hash]) == null)\n        // (n-1)&amp;hash \u4e0eJava7\u4e2dindexFor\u65b9\u6cd5\u7684\u5b9e\u73b0\u76f8\u540c\uff0c\u82e5i\u4f4d\u7f6e\u4e0a\u7684\u503c\u4e3a\u7a7a\uff0c\u5219\u65b0\u5efa\u4e00\u4e2aNode\uff0ctable[i]\u6307\u5411\u8be5Node\u3002\n        // \u76f4\u63a5\u63d2\u5165\n        tab[i] = newNode(hash, key, value, null);\n    else {\n        // \u82e5i\u4f4d\u7f6e\u4e0a\u7684\u503c\u4e0d\u4e3a\u7a7a\uff0c\u5224\u65ad\u5f53\u524d\u4f4d\u7f6e\u4e0a\u7684Node p \u662f\u5426\u4e0e\u8981\u63d2\u5165\u7684key\u7684hash\u548ckey\u76f8\u540c\n        Node&lt;K,V&gt; e; K k;\n        // \u82e5\u8282\u70b9key\u5b58\u5728\uff0c\u76f4\u63a5\u8986\u76d6value\n        if (p.hash == hash &amp;&amp;\n            ((k = p.key) == key || (key != null &amp;&amp; key.equals(k))))\n            e = p;\n        // \u5224\u65adtable[i]\u8be5\u94fe\u662f\u5426\u662f\u7ea2\u9ed1\u6811\uff0c\u5982\u679c\u662f\u7ea2\u9ed1\u6811\uff0c\u5219\u76f4\u63a5\u5728\u6811\u4e2d\u63d2\u5165\u952e\u503c\u5bf9\n        else if (p instanceof TreeNode)\n            // \u4e0d\u540c\uff0c\u4e14\u5f53\u524d\u4f4d\u7f6e\u4e0a\u7684\u7684node p\u5df2\u7ecf\u662fTreeNode\u7684\u5b9e\u4f8b\uff0c\u5219\u518d\u8be5\u6811\u4e0a\u63d2\u5165\u65b0\u7684node\n            e = ((TreeNode&lt;K,V&gt;)p).putTreeVal(this, tab, hash, key, value);\n        // table[i]\u8be5\u94fe\u662f\u666e\u901a\u94fe\u8868\uff0c\u8fdb\u884c\u94fe\u8868\u7684\u63d2\u5165\u64cd\u4f5c\n        else {\n            // \u5728i\u4f4d\u7f6e\u4e0a\u7684\u94fe\u8868\u4e2d\u627e\u5230p.next\u4e3anull\u7684\u4f4d\u7f6e\uff0cbinCount\u8ba1\u7b97\u51fa\u5f53\u524d\u94fe\u8868\u7684\u957f\u5ea6\uff0c\u5982\u679c\u7ee7\u7eed\u5c06\u51b2\u7a81\u7684\u8282\u70b9\u63d2\u5165\u5230\u8be5\u94fe\u8868\u4e2d\uff0c\u4f1a\u4f7f\u94fe\u8868\u7684\u957f\u5ea6\u5927\u4e8etree\u5316\u7684\u9608\u503c\uff0c\u5219\u5c06\u94fe\u8868\u8f6c\u6362\u6210tree\u3002\n            for (int binCount = 0; ; ++binCount) {\n                // \u5982\u679c\u904d\u5386\u5230\u4e86\u6700\u540e\u4e00\u4e2a\u8282\u70b9\uff0c\u8bf4\u660e\u6ca1\u6709\u5339\u914d\u7684key\uff0c\u5219\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u8282\u70b9\u5e76\u6dfb\u52a0\u5230\u6700\u540e\n                if ((e = p.next) == null) {\n                    p.next = newNode(hash, key, value, null);\n                    // \u94fe\u8868\u957f\u5ea6\u5927\u4e8e8\u8f6c\u6362\u4e3a\u7ea2\u9ed1\u6811\u8fdb\u884c\u5904\u7406\n                    if (binCount &gt;= TREEIFY_THRESHOLD - 1) // -1 for 1st\n                        treeifyBin(tab, hash);\n                    break;\n                }\n                // \u904d\u5386\u8fc7\u7a0b\u4e2d\u82e5\u53d1\u73b0 key \u5df2\u7ecf\u5b58\u5728\u76f4\u63a5\u8986\u76d6 value \u5e76\u8df3\u51fa\u5faa\u73af\u5373\u53ef\n                if (e.hash == hash &amp;&amp;\n                    ((k = e.key) == key || (key != null &amp;&amp; key.equals(k))))\n                    break;\n                p = e;\n            }\n        }\n        // \u5df2\u7ecf\u5b58\u5728\u8be5key\u7684\u60c5\u51b5\u65f6\uff0c\u5c06\u5bf9\u5e94\u7684\u8282\u70b9\u7684value\u8bbe\u7f6e\u4e3a\u65b0\u7684value\n        if (e != null) { // existing mapping for key\n            V oldValue = e.value;\n            if (!onlyIfAbsent || oldValue == null)\n                e.value = value;\n            afterNodeAccess(e);\n            return oldValue;\n        }\n    }\n    ++modCount;\n    // \u63d2\u5165\u6210\u529f\u540e\uff0c\u5224\u65ad\u5b9e\u9645\u5b58\u5728\u7684\u952e\u503c\u5bf9\u6570\u91cf size \u662f\u5426\u8d85\u591a\u4e86\u6700\u5927\u5bb9\u91cf threshold\uff0c\u5982\u679c\u8d85\u8fc7\uff0c\u8fdb\u884c\u6269\u5bb9\n    if (++size &gt; threshold)\n        resize();\n    afterNodeInsertion(evict);\n    return null;\n}\n</code></pre> <p>get\u65b9\u6cd5 get(key)\u65b9\u6cd5\u65f6\u83b7\u53d6key\u7684hash\u503c\uff0c\u8ba1\u7b97hash&amp;(n-1)\u5f97\u5230\u5728\u94fe\u8868\u6570\u7ec4\u4e2d\u7684\u4f4d\u7f6efirst=tab[hash&amp;(n-1)]\uff0c\u5148\u5224\u65adfirst\u7684key\u662f\u5426\u662f\u53c2\u6570key\u76f8\u7b49\uff0c\u4e0d\u7b49\u5c31\u904d\u5386\u540e\u9762\u7684\u94fe\u8868\u627e\u5230\u76f8\u540c\u7684key\u503c\u8fd4\u56de\u5bf9\u5e94\u7684value\u503c\u5373\u53ef\u3002</p> <pre><code>public V get(Object key) {\n    Node&lt;K,V&gt; e;\n    return (e = getNode(hash(key), key)) == null ? null : e.value;\n}\n\n// \u6839\u636e\u54c8\u5e0c\u8868\u5143\u7d20\u4e2a\u6570\u4e0e\u54c8\u5e0c\u503c\u6c42\u6a21\uff08\u4f7f\u7528\u7684\u516c\u5f0f\u662f (n - 1) &amp;hash\uff09\u5f97\u5230 key \u6240\u5728\u7684\u6876\u7684\u5934\u7ed3\u70b9\uff0c\u5982\u679c\u5934\u8282\u70b9\u6070\u597d\u662f\u7ea2\u9ed1\u6811\u8282\u70b9\uff0c\u5c31\u8c03\u7528\u7ea2\u9ed1\u6811\u8282\u70b9\u7684 getTreeNode() \u65b9\u6cd5\uff0c\u5426\u5219\u5c31\u904d\u5386\u94fe\u8868\u8282\u70b9\nfinal Node&lt;K,V&gt; getNode(int hash, Object key) {\n    Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; first, e; int n; K k;\n    if ((tab = table) != null &amp;&amp; (n = tab.length) &gt; 0 &amp;&amp;\n        (first = tab[(n - 1) &amp; hash]) != null) {\n        if (first.hash == hash &amp;&amp; // always check first node\n            ((k = first.key) == key || (key != null &amp;&amp; key.equals(k))))\n            return first;\n        if ((e = first.next) != null) {\n            if (first instanceof TreeNode)\n                return ((TreeNode&lt;K,V&gt;)first).getTreeNode(hash, key);\n            do {\n                if (e.hash == hash &amp;&amp;\n                    ((k = e.key) == key || (key != null &amp;&amp; key.equals(k))))\n                    return e;\n            } while ((e = e.next) != null);\n        }\n    }\n    return null;\n}\n</code></pre> <p>resize\u65b9\u6cd5 \u6269\u5bb9\u5c31\u662f\u91cd\u65b0\u8ba1\u7b97\u5bb9\u91cf\uff0c\u5411HashMap\u5bf9\u8c61\u91cc\u4e0d\u505c\u7684\u6dfb\u52a0\u5143\u7d20\uff0c\u800cHashMap\u5bf9\u8c61\u5185\u90e8\u7684\u6570\u7ec4\u65e0\u6cd5\u88c5\u8f7d\u66f4\u591a\u7684\u5143\u7d20\u65f6\uff0c\u5bf9\u8c61\u5c31\u9700\u8981\u6269\u5927\u6570\u7ec4\u7684\u957f\u5ea6\uff0c\u4ee5\u4fbf\u80fd\u88c5\u5165\u66f4\u591a\u7684\u5143\u7d20\u3002\u5f53\u7136Java\u91cc\u7684\u6570\u7ec4\u662f\u65e0\u6cd5\u81ea\u52a8\u6269\u5bb9\u7684\uff0c\u65b9\u6cd5\u662f\u4f7f\u7528\u4e00\u4e2a\u65b0\u7684\u6570\u7ec4\u4ee3\u66ff\u5df2\u6709\u7684\u5bb9\u91cf\u5c0f\u7684\u6570\u7ec4\u3002</p> <p>\u5177\u4f53\u6b65\u9aa4\uff1a</p> <ol> <li>\u9996\u5148\u8ba1\u7b97resize()\u540e\u7684\u65b0\u7684capacity\u548cthreshold\uff0c\u5982\u679c\u539f\u6709\u7684capacity\u5927\u4e8e\u96f6\uff0c\u5219\u5c06capacity\u589e\u52a0\u4e00\u500d\uff0c\u5426\u5219\u8bbe\u7f6e\u6210\u9ed8\u8ba4\u7684capacity</li> <li>\u521b\u5efa\u65b0\u7684\u6570\u7ec4\uff0c\u5927\u5c0f\u662f\u65b0\u7684capacity</li> <li>\u5c06\u65e7\u7684\u6570\u7ec4\u5143\u7d20\u653e\u7f6e\u5230\u65b0\u6570\u7ec4\u4e2d</li> </ol> <pre><code>final Node&lt;K,V&gt;[] resize() {\n    // \u5c06\u5b57\u6bb5\u5f15\u7528copy\u5230\u5c40\u90e8\u53d8\u91cf\u8868\uff0c\u8fd9\u6837\u5728\u4e4b\u540e\u7684\u4f7f\u7528\u65f6\u53ef\u4ee5\u51cf\u5c11getField\u6307\u4ee4\u7684\u8c03\u7528\n    Node&lt;K,V&gt;[] oldTab = table;\n    // oldCap\u4e3a\u539f\u6570\u7ec4\u7684\u5927\u5c0f\u6216\u5f53\u7a7a\u65f6\u4e3a0\n    int oldCap = (oldTab == null) ? 0 : oldTab.length;\n    int oldThr = threshold;\n    int newCap, newThr = 0;\n    if (oldCap &gt; 0) {\n        if (oldCap &gt;= MAXIMUM_CAPACITY) {\n            // \u5982\u679c\u8d85\u8fc7\u6700\u5927\u5bb9\u91cf1&gt;&gt;30\uff0c\u65e0\u6cd5\u518d\u6269\u5145table\uff0c\u53ea\u80fd\u6539\u53d8\u9608\u503c\n            threshold = Integer.MAX_VALUE;\n            return oldTab;\n        }\n        // \u65b0\u7684\u6570\u7ec4\u7684\u5927\u5c0f\u662f\u65e7\u6570\u7ec4\u7684\u4e24\u500d\n        else if ((newCap = oldCap &lt;&lt; 1) &lt; MAXIMUM_CAPACITY &amp;&amp;\n                    oldCap &gt;= DEFAULT_INITIAL_CAPACITY)\n            // \u5f53\u65e7\u7684\u7684\u6570\u7ec4\u5927\u5c0f\u5927\u4e8e\u7b49\u4e8e\u9ed8\u8ba4\u5927\u5c0f\u65f6\uff0cthreshold\u4e5f\u6269\u5927\u4e00\u500d\n            newThr = oldThr &lt;&lt; 1;\n    }\n    else if (oldThr &gt; 0) // initial capacity was placed in threshold\n        newCap = oldThr;\n    else {               // zero initial threshold signifies using defaults\n        // \u521d\u59cb\u5316\u64cd\u4f5c\n        newCap = DEFAULT_INITIAL_CAPACITY;\n        newThr = (int)(DEFAULT_LOAD_FACTOR * DEFAULT_INITIAL_CAPACITY);\n    }\n    if (newThr == 0) {\n        float ft = (float)newCap * loadFactor;\n        newThr = (newCap &lt; MAXIMUM_CAPACITY &amp;&amp; ft &lt; (float)MAXIMUM_CAPACITY ?\n                    (int)ft : Integer.MAX_VALUE);\n    }\n    threshold = newThr;\n    @SuppressWarnings({\"rawtypes\",\"unchecked\"})\n    // \u521b\u5efa\u5bb9\u91cf\u4e3anewCap\u7684newTab\uff0c\u5e76\u5c06oldTab\u4e2d\u7684Node\u8fc1\u79fb\u8fc7\u6765\uff0c\u8fd9\u91cc\u9700\u8981\u8003\u8651\u94fe\u8868\u548ctree\u4e24\u79cd\u60c5\u51b5\u3002\n    Node&lt;K,V&gt;[] newTab = (Node&lt;K,V&gt;[])new Node[newCap];\n    table = newTab;\n    // \u5c06\u539f\u6570\u7ec4\u4e2d\u7684\u6570\u7ec4\u590d\u5236\u5230\u65b0\u6570\u7ec4\u4e2d\n    if (oldTab != null) {\n        for (int j = 0; j &lt; oldCap; ++j) {\n            Node&lt;K,V&gt; e;\n            if ((e = oldTab[j]) != null) {\n                oldTab[j] = null;\n                if (e.next == null)\n                    // \u5982\u679ce\u662f\u8be5bucket\u552f\u4e00\u7684\u4e00\u4e2a\u5143\u7d20\uff0c\u5219\u76f4\u63a5\u8d4b\u503c\u5230\u65b0\u6570\u7ec4\u4e2d\n                    newTab[e.hash &amp; (newCap - 1)] = e;\n                else if (e instanceof TreeNode)\n                    // split\u65b9\u6cd5\u4f1a\u5c06\u6811\u5206\u5272\u4e3alower \u548cupper tree\u4e24\u4e2a\u6811\uff0c\u5982\u679c\u5b50\u6811\u7684\u8282\u70b9\u6570\u5c0f\u4e8e\u4e86UNTREEIFY_THRESHOLD\u9608\u503c\uff0c\u5219\u5c06\u6811untreeify\uff0c\u5c06\u8282\u70b9\u90fd\u5b58\u653e\u5728newTab\u4e2d\u3002\n                    // TreeNode\u7684\u60c5\u51b5\u5219\u4f7f\u7528TreeNode\u4e2d\u7684split\u65b9\u6cd5\u5c06\u8fd9\u4e2a\u6811\u5206\u6210\u4e24\u4e2a\u5c0f\u6811\n                    ((TreeNode&lt;K,V&gt;)e).split(this, newTab, j, oldCap);\n                else { // preserve order \u4fdd\u6301\u987a\u5e8f\n                    // \u5426\u5219\u5219\u521b\u5efa\u4e24\u4e2a\u94fe\u8868\u7528\u6765\u5b58\u653e\u8981\u653e\u7684\u6570\u636e\uff0chash\u503c&amp;oldCap\u4e3a0\u7684(\u5373oldCap\u76841\u7684\u4f4d\u7f6e\u7684\u548chash\u503c\u7684\u540c\u6837\u7684\u4f4d\u7f6e\u90fd\u662f1\uff0c\u540c\u6837\u662f\u57fa\u4e8ecapacity\u662f2\u7684\u6b21\u65b9\u8fd9\u4e00\u524d\u63d0)\u4e3alow\u94fe\u8868\uff0c\u53cd\u4e4b\u4e3ahigh\u94fe\u8868, \u901a\u8fc7\u8fd9\u79cd\u65b9\u5f0f\u5c06\u65e7\u7684\u6570\u636e\u5206\u5230\u4e24\u4e2a\u94fe\u8868\u4e2d\u518d\u653e\u5230\u5404\u81ea\u5bf9\u5e94\u4f59\u6570\u7684\u4f4d\u7f6e\n                    Node&lt;K,V&gt; loHead = null, loTail = null;\n                    Node&lt;K,V&gt; hiHead = null, hiTail = null;\n                    Node&lt;K,V&gt; next;\n                    do {\n                        next = e.next;\n                        // \u6309\u7167e.hash\u503c\u533a\u5206\u653e\u5728loTail\u540e\u8fd8\u662fhiTail\u540e\n                        if ((e.hash &amp; oldCap) == 0) {\n                            // \u8fd0\u7b97\u7ed3\u679c\u4e3a0\u7684\u5143\u7d20\uff0c\u7528lo\u8bb0\u5f55\u5e76\u8fde\u63a5\u6210\u65b0\u7684\u94fe\u8868\n                            if (loTail == null)\n                                loHead = e;\n                            else\n                                loTail.next = e;\n                            loTail = e;\n                        }\n                        else {\n                            // \u8fd0\u7b97\u7ed3\u679c\u4e0d\u4e3a0\u7684\u6570\u636e\uff0c\u7528li\u8bb0\u5f55\n                            if (hiTail == null)\n                                hiHead = e;\n                            else\n                                hiTail.next = e;\n                            hiTail = e;\n                        }\n                    } while ((e = next) != null);\n                    // \u5904\u7406\u5b8c\u4e4b\u540e\u653e\u5230\u65b0\u6570\u7ec4\u4e2d\n                    if (loTail != null) {\n                        loTail.next = null;\n                        // lo\u4ecd\u7136\u653e\u5728\u201c\u539f\u5904\u201d\uff0c\u8fd9\u4e2a\u201c\u539f\u5904\u201d\u662f\u6839\u636e\u65b0\u7684hash\u503c\u7b97\u51fa\u6765\u7684\n                        newTab[j] = loHead;\n                    }\n                    if (hiTail != null) {\n                        hiTail.next = null;\n                        // li\u653e\u5728j+oldCap\u4f4d\u7f6e\n                        newTab[j + oldCap] = hiHead;\n                    }\n                }\n            }\n        }\n    }\n    return newTab;\n}\n</code></pre> <p>size\u65b9\u6cd5 HashMap\u7684\u5927\u5c0f\u5f88\u7b80\u5355\uff0c\u4e0d\u662f\u5b9e\u65f6\u8ba1\u7b97\u7684\uff0c\u800c\u662f\u6bcf\u6b21\u65b0\u589e\u52a0Entry\u7684\u65f6\u5019\uff0csize\u5c31\u9012\u589e\u3002\u5220\u9664\u7684\u65f6\u5019\u5c31\u9012\u51cf\uff0c\u7a7a\u95f4\u6362\u65f6\u95f4\u7684\u505a\u6cd5\uff0c\u56e0\u4e3a\u5b83\u4e0d\u662f\u7ebf\u7a0b\u5b89\u5168\u7684\uff0c\u5b8c\u5168\u53ef\u4ee5\u8fd9\u4e48\u505a\uff0c\u6548\u7387\u9ad8\u3002</p> <p>\u9762\u8bd5\u95ee\u9898</p> <p>1. \u6784\u9020\u51fd\u6570\u4e2dinitialCapacity\u4e0eloadFactor\u4e24\u4e2a\u53c2\u6570 \u200b   HashMap(int initialCapacity,float loadFactor)\uff1a\u6784\u9020\u4e00\u4e2a\u6307\u5b9a\u5bb9\u91cf\u548c\u8d1f\u8f7d\u56e0\u5b50\u7684\u7a7aHashMap\u3002</p> <p>\u8fd9\u4e24\u4e2a\u53c2\u6570\u662f\u5f71\u54cdHashMap\u6027\u80fd\u7684\u91cd\u8981\u53c2\u6570\uff0c\u5176\u4e2d\u5bb9\u91cf\u8868\u793a\u54c8\u5e0c\u8868\u4e2d\u6876\u7684\u6570\u91cf\uff0c\u521d\u59cb\u5bb9\u91cf\u662f\u521b\u5efa\u54c8\u5e0c\u8868\u65f6\u7684\u5bb9\u91cf\uff0c\u8d1f\u8f7d\u56e0\u5b50\u662f\u54c8\u5e0c\u8868\u5728\u5176\u5bb9\u91cf\u589e\u52a0\u4e4b\u524d\u53ef\u4ee5\u8fbe\u5230\u591a\u6ee1\u7684\u4e00\u79cd\u5c3a\u5ea6\uff0c\u5b83\u8861\u91cf\u7684\u662f\u4e00\u4e2a\u6563\u5217\u8868\u7684\u7a7a\u95f4\u7684\u4f7f\u7528\u7a0b\u5ea6\uff0c\u8d1f\u8f7d\u56e0\u5b50\u8d8a\u5927\u8868\u793a\u6563\u5217\u8868\u7684\u586b\u5145\u7a0b\u5ea6\u8d8a\u9ad8\uff0c\u53cd\u4e4b\u8d8a\u5c0f\u3002</p> <p>2. size\u4e3a\u4ec0\u4e48\u5fc5\u987b\u662f2\u7684\u6574\u6570\u6b21\u5e42 \u200b   \u8fd9\u662f\u4e3a\u4e86\u670d\u52a1key\u6620\u5c04\u5230index\u7684hash\u7b97\u6cd5\u7684\uff0c\u516c\u5f0f index=hashcode(key)&amp;(length-1)\u3002HashMap\u4e2d\u6570\u7ec4\u7684size\u5fc5\u987b\u662f2\u7684\u5e42\uff0c\u662f\u4e3a\u4e86\u5c06key\u7684hash\u503c\u5747\u5300\u7684\u5206\u5e03\u5728\u6570\u7ec4\u7684\u7d22\u5f15\u4e0a\u3002HashMap\u4e2d\u4f7f\u7528indexFor\u65b9\u6cd5\u6765\u8ba1\u7b97key\u6240\u5728\u7684\u6570\u7ec4\u7684\u7d22\u5f15\uff0c\u5b9e\u73b0\u903b\u8f91\u4e3akey\u7684hash\u503c\u4e0e\u6570\u7ec4\u957f\u5ea6\u503c\u51cf\u4e00\u8fdb\u884c\u4e0e\u8fd0\u7b97\uff0c\u4ee3\u7801\u5982\u4e0b\uff1a</p> <pre><code>    static int indexFor(int h, int length) {\n        return h &amp; (length - 1);\n    }\n</code></pre> <p>3. HashMap\u7684key\u4e3a\u4ec0\u4e48\u4e00\u822c\u7528\u5b57\u7b26\u4e32\u6bd4\u8f83\u591a\uff0c\u80fd\u7528\u5176\u4ed6\u5bf9\u8c61\uff0c\u6216\u8005\u81ea\u5b9a\u4e49\u7684\u5bf9\u8c61\u561b\uff1f \u200b   \u80fd\u7528\u5176\u4ed6\u5bf9\u8c61\uff0c\u5fc5\u987b\u662f\u4e0d\u53ef\u53d8\u7684\uff0c\u4f46\u662f\u81ea\u5b9e\u73b0\u7684\u7c7b\u5fc5\u987b\u91cd\u5199equals()\u548chashCode()\u65b9\u6cd5\uff0c\u5426\u5219\u4f1a\u8c03\u7528\u9ed8\u8ba4\u7684Object\u7c7b\u7684\u5bf9\u5e94\u65b9\u6cd5\u3002</p> <p>4. HashMap\u7684key\u548cvalue\u90fd\u80fd\u4e3anull\u561b\uff1f\u5982\u679ckey\u4e3anull\uff0c\u90a3\u4e48\u5b83\u662f\u600e\u4e48\u6837\u67e5\u627e\u503c\u7684\uff1f \u200b   \u5982\u679ckey\u4e3anull\uff0c\u5219\u76f4\u63a5\u4ece\u54c8\u5e0c\u8868\u7684\u7b2c\u4e00\u4e2a\u4f4d\u7f6etable[0]\u5bf9\u5e94\u7684\u94fe\u8868\u4e0a\u67e5\u627e\uff0c\u7531putForNullKey()\u5b9e\u73b0\uff0c\u8bb0\u4f4f\uff0ckey\u4e3anull\u7684\u952e\u503c\u5bf9\u6c38\u8fdc\u90fd\u653e\u5728\u4ee5table[0]\u4e3a\u5934\u8282\u70b9\u7684\u94fe\u8868\u4e2d\u3002</p> <p>5. \u4f7f\u7528HashMap\u65f6\u4e00\u822c\u4f7f\u7528\u4ec0\u4e48\u7c7b\u578b\u7684\u5143\u7d20\u4f5c\u4e3aKey\uff1f \u200b   \u4e00\u822c\u662fString\u3001Integer\uff0c\u8fd9\u4e9b\u7c7b\u662f\u4e0d\u53ef\u53d8\u7684\uff0c\u5e76\u4e14\u8fd9\u4e9b\u7c7b\u5df2\u7ecf\u89c4\u8303\u7684\u590d\u5199\u4e86hashCode\u4ee5\u53caequals\u65b9\u6cd5\uff0c\u4f5c\u4e3a\u4e0d\u53ef\u53d8\u7c7b\u5929\u751f\u662f\u7ebf\u7a0b\u5b89\u5168\u7684\uff0c\u800c\u4e14\u53ef\u4ee5\u5f88\u597d\u7684\u4f18\u5316\u6bd4\u5982\u53ef\u4ee5\u7f13\u5b58hash\u503c\uff0c\u907f\u514d\u91cd\u590d\u8ba1\u7b97\u7b49\u7b49\u3002</p> <p>6. HashTable\u548cHashMap\u7684\u533a\u522b\u6709\u54ea\u4e9b\uff1f \u200b   \u90fd\u5b9e\u73b0\u4e86Map\u63a5\u53e3\uff0c\u4e3b\u8981\u533a\u522b\u5728\u4e8e\uff1a\u7ebf\u7a0b\u5b89\u5168\u6027\uff0c\u540c\u6b65\u4ee5\u53ca\u6027\u80fd\u3002</p> <ul> <li>HashMap\u662f\u975e\u7ebf\u7a0b\u5b89\u5168\u7684\uff0c\u6548\u7387\u80af\u5b9a\u9ad8\u4e8e\u7ebf\u7a0b\u5b89\u5168\u7684HashTable</li> <li>HashMap\u5141\u8bb8null\u4f5c\u4e3a\u4e00\u4e2aentry\u7684key\u6216\u8005value\uff0c\u800cHashTable\u4e0d\u5141\u8bb8</li> <li>HashMap\u628aHashTable\u7684contains\u65b9\u6cd5\u53bb\u6389\u4e86\uff0c\u6539\u6210\u4e86containsVaule\u548ccontainsKey</li> <li>HashTable\u548cHashMap\u6269\u5bb9\u7684\u65b9\u6cd5\u4e0d\u4e00\u6837\uff0cHashTable\u4e2d\u7684hash\u6570\u7ec4\u9ed8\u8ba4\u5927\u5c0f\u662f11\uff0c\u6269\u5bb9\u65b9\u5f0f\u662fold x 2+1\uff0c\u800cHashMap\u4e2dhash\u6570\u7ec4\u7684\u9ed8\u8ba4\u5927\u5c0f\u662f16\uff0c\u800c\u4e14\u4e00\u5b9a\u662f2\u7684\u6307\u6570\uff0c\u6269\u5bb9\u65f6old x 2</li> </ul>"},{"location":"010Java/020DataStructure/#hashmaphashtable","title":"hashmap\u548chashtable\u7684\u533a\u522b","text":"\u7b54\u6848 <p>\u5728Java\u4e2d\uff0c<code>HashMap</code>\u548c<code>Hashtable</code>\u90fd\u662f\u7528\u4e8e\u5b58\u50a8\u952e\u503c\u5bf9\u7684\u96c6\u5408\u7c7b\uff0c\u4f46\u5b83\u4eec\u5728\u5b9e\u73b0\u548c\u7279\u6027\u4e0a\u6709\u663e\u8457\u533a\u522b\u3002\u4ee5\u4e0b\u662f\u5b83\u4eec\u7684\u4e3b\u8981\u5dee\u5f02\u53ca\u6e90\u7801\u5c42\u9762\u7684\u89e3\u91ca\uff1a</p>"},{"location":"010Java/020DataStructure/#1","title":"1. \u7ebf\u7a0b\u5b89\u5168\u6027","text":"<ul> <li>Hashtable\uff1a\u662f\u7ebf\u7a0b\u5b89\u5168\u7684\uff0c\u6240\u6709\u65b9\u6cd5\u90fd\u4f7f\u7528<code>synchronized</code>\u5173\u952e\u5b57\u4fee\u9970\uff0c\u786e\u4fdd\u591a\u7ebf\u7a0b\u73af\u5883\u4e0b\u7684\u5b89\u5168\u6027\u3002</li> <li>HashMap\uff1a\u4e0d\u662f\u7ebf\u7a0b\u5b89\u5168\u7684\uff0c\u6ca1\u6709\u4f7f\u7528<code>synchronized</code>\u4fee\u9970\uff0c\u56e0\u6b64\u5728\u591a\u7ebf\u7a0b\u73af\u5883\u4e0b\u9700\u8981\u989d\u5916\u540c\u6b65\u3002</li> </ul>"},{"location":"010Java/020DataStructure/#_25","title":"\u6e90\u7801\u793a\u4f8b","text":"<ul> <li> <p>Hashtable\uff1a <pre><code>public synchronized V put(K key, V value) {\n    // \u5177\u4f53\u5b9e\u73b0\n}\n</code></pre> <code>put</code>\u65b9\u6cd5\u4f7f\u7528<code>synchronized</code>\u4fee\u9970\uff0c\u786e\u4fdd\u7ebf\u7a0b\u5b89\u5168\u3002</p> </li> <li> <p>HashMap\uff1a <pre><code>public V put(K key, V value) {\n    // \u5177\u4f53\u5b9e\u73b0\n}\n</code></pre> <code>put</code>\u65b9\u6cd5\u6ca1\u6709<code>synchronized</code>\u4fee\u9970\uff0c\u4e0d\u4fdd\u8bc1\u7ebf\u7a0b\u5b89\u5168\u3002</p> </li> </ul>"},{"location":"010Java/020DataStructure/#2-nullnull","title":"2. \u5141\u8bb8null\u952e\u548cnull\u503c","text":"<ul> <li>Hashtable\uff1a\u4e0d\u5141\u8bb8<code>null</code>\u952e\u6216<code>null</code>\u503c\uff0c\u5426\u5219\u4f1a\u629b\u51fa<code>NullPointerException</code>\u3002</li> <li>HashMap\uff1a\u5141\u8bb8\u4e00\u4e2a<code>null</code>\u952e\u548c\u591a\u4e2a<code>null</code>\u503c\u3002</li> </ul>"},{"location":"010Java/020DataStructure/#_26","title":"\u6e90\u7801\u793a\u4f8b","text":"<ul> <li> <p>Hashtable\uff1a <pre><code>public synchronized V put(K key, V value) {\n    if (value == null) {\n        throw new NullPointerException();\n    }\n    // \u5177\u4f53\u5b9e\u73b0\n}\n</code></pre> \u5728<code>put</code>\u65b9\u6cd5\u4e2d\uff0c\u5982\u679c<code>value</code>\u4e3a<code>null</code>\uff0c\u76f4\u63a5\u629b\u51fa\u5f02\u5e38\u3002</p> </li> <li> <p>HashMap\uff1a <pre><code>public V put(K key, V value) {\n    // \u5141\u8bb8null\u952e\u548cnull\u503c\n    return putVal(hash(key), key, value, false, true);\n}\n</code></pre> <code>HashMap</code>\u6ca1\u6709\u5bf9<code>null</code>\u952e\u6216\u503c\u7684\u9650\u5236\u3002</p> </li> </ul>"},{"location":"010Java/020DataStructure/#3","title":"3. \u6027\u80fd","text":"<ul> <li>Hashtable\uff1a\u7531\u4e8e\u65b9\u6cd5\u540c\u6b65\uff0c\u6027\u80fd\u8f83\u4f4e\u3002</li> <li>HashMap\uff1a\u6ca1\u6709\u540c\u6b65\u5f00\u9500\uff0c\u6027\u80fd\u8f83\u9ad8\u3002</li> </ul>"},{"location":"010Java/020DataStructure/#4","title":"4. \u7ee7\u627f\u4e0e\u5b9e\u73b0","text":"<ul> <li>Hashtable\uff1a\u7ee7\u627f\u81ea<code>Dictionary</code>\u7c7b\u3002</li> <li>HashMap\uff1a\u7ee7\u627f\u81ea<code>AbstractMap</code>\u7c7b\u3002</li> </ul>"},{"location":"010Java/020DataStructure/#_27","title":"\u6e90\u7801\u793a\u4f8b","text":"<ul> <li> <p>Hashtable\uff1a <pre><code>public class Hashtable&lt;K,V&gt; extends Dictionary&lt;K,V&gt; implements Map&lt;K,V&gt;, Cloneable, Serializable {\n    // \u5177\u4f53\u5b9e\u73b0\n}\n</code></pre></p> </li> <li> <p>HashMap\uff1a <pre><code>public class HashMap&lt;K,V&gt; extends AbstractMap&lt;K,V&gt; implements Map&lt;K,V&gt;, Cloneable, Serializable {\n    // \u5177\u4f53\u5b9e\u73b0\n}\n</code></pre></p> </li> </ul>"},{"location":"010Java/020DataStructure/#5","title":"5. \u8fed\u4ee3\u5668","text":"<ul> <li>Hashtable\uff1a\u4f7f\u7528<code>Enumeration</code>\u8fdb\u884c\u904d\u5386\u3002</li> <li>HashMap\uff1a\u4f7f\u7528<code>Iterator</code>\u8fdb\u884c\u904d\u5386\u3002</li> </ul>"},{"location":"010Java/020DataStructure/#_28","title":"\u6e90\u7801\u793a\u4f8b","text":"<ul> <li> <p>Hashtable\uff1a <pre><code>public Enumeration&lt;K&gt; keys() {\n    return this.&lt;K&gt;getEnumeration(KEYS);\n}\n</code></pre></p> </li> <li> <p>HashMap\uff1a <pre><code>public Set&lt;K&gt; keySet() {\n    Set&lt;K&gt; ks = keySet;\n    if (ks == null) {\n        ks = new KeySet();\n        keySet = ks;\n    }\n    return ks;\n}\n</code></pre></p> </li> </ul>"},{"location":"010Java/020DataStructure/#_29","title":"\u603b\u7ed3","text":"<ul> <li>Hashtable\uff1a\u7ebf\u7a0b\u5b89\u5168\uff0c\u4e0d\u5141\u8bb8<code>null</code>\u952e\u503c\uff0c\u6027\u80fd\u8f83\u4f4e\uff0c\u4f7f\u7528<code>Enumeration</code>\u904d\u5386\u3002</li> <li>HashMap\uff1a\u975e\u7ebf\u7a0b\u5b89\u5168\uff0c\u5141\u8bb8<code>null</code>\u952e\u503c\uff0c\u6027\u80fd\u8f83\u9ad8\uff0c\u4f7f\u7528<code>Iterator</code>\u904d\u5386\u3002</li> </ul> <p>\u8fd9\u4e9b\u5dee\u5f02\u4f7f\u5f97<code>HashMap</code>\u5728\u5355\u7ebf\u7a0b\u73af\u5883\u4e0b\u66f4\u9ad8\u6548\uff0c\u800c<code>Hashtable</code>\u5728\u591a\u7ebf\u7a0b\u73af\u5883\u4e0b\u66f4\u5b89\u5168\u3002</p>"},{"location":"010Java/020DataStructure/#hashmaphashtable_1","title":"hashmap\u548chashtable\u5b58\u50a8\u7ec6\u8282\u533a\u522b","text":"\u7b54\u6848 <p>\u800c <code>Hashtable</code> \u7531\u4e8e\u5176\u7ebf\u7a0b\u5b89\u5168\u6027\u548c\u6027\u80fd\u95ee\u9898\uff0c\u9010\u6e10\u88ab <code>ConcurrentHashMap</code> \u53d6\u4ee3\u3002 <code>HashMap</code> \u548c <code>Hashtable</code> \u7684\u5185\u90e8\u6570\u636e\u5b58\u50a8\u7ed3\u6784\u5728\u6838\u5fc3\u601d\u60f3\u4e0a\u662f\u76f8\u4f3c\u7684\uff0c\u90fd\u662f\u57fa\u4e8e \u54c8\u5e0c\u8868\uff08Hash Table\uff09 \u5b9e\u73b0\u7684\uff0c\u4f7f\u7528\u4e86 Bucket\uff08\u6876\uff09 \u7684\u6982\u5ff5\u6765\u5b58\u50a8\u6570\u636e\u3002\u7136\u800c\uff0c\u5b83\u4eec\u7684\u5b9e\u73b0\u7ec6\u8282\u548c\u4f18\u5316\u65b9\u5f0f\u6709\u6240\u4e0d\u540c\uff0c\u5c24\u5176\u662f\u5728 Java 8 \u4e4b\u540e\uff0c<code>HashMap</code> \u5f15\u5165\u4e86 \u7ea2\u9ed1\u6811 \u6765\u4f18\u5316\u6027\u80fd\uff0c\u800c <code>Hashtable</code> \u5219\u6ca1\u6709\u8fd9\u6837\u7684\u6539\u8fdb\u3002</p> <p>\u4ee5\u4e0b\u662f\u5bf9\u5b83\u4eec\u5185\u90e8\u6570\u636e\u5b58\u50a8\u7ed3\u6784\u7684\u8be6\u7ec6\u5206\u6790\uff1a</p>"},{"location":"010Java/020DataStructure/#1-bucket","title":"1. \u5171\u540c\u70b9\uff1aBucket \u548c\u94fe\u8868","text":"<ul> <li>Bucket\uff08\u6876\uff09\uff1a</li> <li>\u4e24\u8005\u90fd\u4f7f\u7528\u4e00\u4e2a\u6570\u7ec4\uff08<code>table</code>\uff09\u6765\u5b58\u50a8\u6570\u636e\uff0c\u6570\u7ec4\u7684\u6bcf\u4e2a\u5143\u7d20\u79f0\u4e3a\u4e00\u4e2a Bucket\u3002</li> <li> <p>\u6bcf\u4e2a Bucket \u5b58\u50a8\u7684\u662f\u4e00\u4e2a\u94fe\u8868\uff08\u6216\u7ea2\u9ed1\u6811\uff09\u7684\u5934\u8282\u70b9\uff0c\u7528\u4e8e\u89e3\u51b3\u54c8\u5e0c\u51b2\u7a81\uff08\u5373\u591a\u4e2a\u952e\u6620\u5c04\u5230\u540c\u4e00\u4e2a Bucket \u7684\u60c5\u51b5\uff09\u3002</p> </li> <li> <p>\u94fe\u8868\uff1a</p> </li> <li>\u5f53\u53d1\u751f\u54c8\u5e0c\u51b2\u7a81\u65f6\uff0c\u952e\u503c\u5bf9\u4f1a\u4ee5\u94fe\u8868\u7684\u5f62\u5f0f\u5b58\u50a8\u5728\u540c\u4e00\u4e2a Bucket \u4e2d\u3002</li> <li>\u94fe\u8868\u4e2d\u7684\u6bcf\u4e2a\u8282\u70b9\u662f\u4e00\u4e2a <code>Entry</code>\uff08\u5728 <code>Hashtable</code> \u4e2d\uff09\u6216 <code>Node</code>\uff08\u5728 <code>HashMap</code> \u4e2d\uff09\uff0c\u5b58\u50a8\u952e\u3001\u503c\u4ee5\u53ca\u4e0b\u4e00\u4e2a\u8282\u70b9\u7684\u5f15\u7528\u3002</li> </ul>"},{"location":"010Java/020DataStructure/#_30","title":"\u6e90\u7801\u793a\u4f8b","text":"<ul> <li> <p>Hashtable\uff1a <pre><code>private static class Entry&lt;K,V&gt; implements Map.Entry&lt;K,V&gt; {\n    final int hash;\n    final K key;\n    V value;\n    Entry&lt;K,V&gt; next; // \u94fe\u8868\u7684\u4e0b\u4e00\u4e2a\u8282\u70b9\n}\n</code></pre></p> </li> <li> <p>HashMap\uff1a <pre><code>static class Node&lt;K,V&gt; implements Map.Entry&lt;K,V&gt; {\n    final int hash;\n    final K key;\n    V value;\n    Node&lt;K,V&gt; next; // \u94fe\u8868\u7684\u4e0b\u4e00\u4e2a\u8282\u70b9\n}\n</code></pre></p> </li> </ul>"},{"location":"010Java/020DataStructure/#2","title":"2. \u4e0d\u540c\u70b9\uff1a\u7ea2\u9ed1\u6811\u7684\u5f15\u5165","text":"<ul> <li>HashMap\uff08Java 8 \u53ca\u4e4b\u540e\uff09\uff1a</li> <li>\u5728 Java 8 \u4e2d\uff0c<code>HashMap</code> \u5f15\u5165\u4e86 \u7ea2\u9ed1\u6811 \u6765\u4f18\u5316\u6027\u80fd\u3002</li> <li>\u5f53\u94fe\u8868\u7684\u957f\u5ea6\u8d85\u8fc7\u4e00\u5b9a\u9608\u503c\uff08\u9ed8\u8ba4\u662f 8\uff09\uff0c\u94fe\u8868\u4f1a\u8f6c\u6362\u4e3a\u7ea2\u9ed1\u6811\uff0c\u4ece\u800c\u5c06\u67e5\u627e\u65f6\u95f4\u590d\u6742\u5ea6\u4ece <code>O(n)</code> \u964d\u4f4e\u5230 <code>O(log n)</code>\u3002</li> <li>\u5f53\u7ea2\u9ed1\u6811\u7684\u8282\u70b9\u6570\u51cf\u5c11\u5230\u4e00\u5b9a\u9608\u503c\uff08\u9ed8\u8ba4\u662f 6\uff09\uff0c\u7ea2\u9ed1\u6811\u4f1a\u9000\u5316\u4e3a\u94fe\u8868\u3002</li> </ul>"},{"location":"010Java/020DataStructure/#_31","title":"\u6e90\u7801\u793a\u4f8b","text":"<pre><code>static final class TreeNode&lt;K,V&gt; extends LinkedHashMap.Entry&lt;K,V&gt; {\n    TreeNode&lt;K,V&gt; parent;  // \u7ea2\u9ed1\u6811\u7684\u7236\u8282\u70b9\n    TreeNode&lt;K,V&gt; left;    // \u5de6\u5b50\u8282\u70b9\n    TreeNode&lt;K,V&gt; right;   // \u53f3\u5b50\u8282\u70b9\n    TreeNode&lt;K,V&gt; prev;    // \u524d\u9a71\u8282\u70b9\n    boolean red;           // \u8282\u70b9\u989c\u8272\n}\n</code></pre> <ul> <li>Hashtable\uff1a</li> <li><code>Hashtable</code> \u6ca1\u6709\u5f15\u5165\u7ea2\u9ed1\u6811\u7684\u4f18\u5316\uff0c\u4ecd\u7136\u53ea\u4f7f\u7528\u94fe\u8868\u6765\u5904\u7406\u54c8\u5e0c\u51b2\u7a81\u3002</li> <li>\u56e0\u6b64\uff0c\u5728\u6781\u7aef\u60c5\u51b5\u4e0b\uff08\u5982\u5927\u91cf\u54c8\u5e0c\u51b2\u7a81\uff09\uff0c<code>Hashtable</code> \u7684\u6027\u80fd\u4f1a\u663e\u8457\u4e0b\u964d\u3002</li> </ul>"},{"location":"010Java/020DataStructure/#3_1","title":"3. \u6269\u5bb9\u673a\u5236","text":"<ul> <li>HashMap\uff1a</li> <li>\u9ed8\u8ba4\u521d\u59cb\u5bb9\u91cf\u662f 16\uff0c\u8d1f\u8f7d\u56e0\u5b50\u662f 0.75\u3002</li> <li>\u5f53\u5143\u7d20\u6570\u91cf\u8d85\u8fc7 <code>\u5bb9\u91cf * \u8d1f\u8f7d\u56e0\u5b50</code> \u65f6\uff0c<code>HashMap</code> \u4f1a\u8fdb\u884c\u6269\u5bb9\uff08\u5bb9\u91cf\u7ffb\u500d\uff09\u3002</li> <li>\u6269\u5bb9\u65f6\uff0c\u4f1a\u91cd\u65b0\u8ba1\u7b97\u6bcf\u4e2a\u952e\u503c\u5bf9\u7684\u54c8\u5e0c\u503c\uff0c\u5e76\u91cd\u65b0\u5206\u914d\u5230\u65b0\u7684 Bucket \u4e2d\u3002</li> </ul>"},{"location":"010Java/020DataStructure/#_32","title":"\u6e90\u7801\u793a\u4f8b","text":"<pre><code>final Node&lt;K,V&gt;[] resize() {\n    // \u6269\u5bb9\u903b\u8f91\n}\n</code></pre> <ul> <li>Hashtable\uff1a</li> <li>\u9ed8\u8ba4\u521d\u59cb\u5bb9\u91cf\u662f 11\uff0c\u8d1f\u8f7d\u56e0\u5b50\u662f 0.75\u3002</li> <li>\u6269\u5bb9\u65f6\uff0c\u5bb9\u91cf\u53d8\u4e3a <code>\u65e7\u5bb9\u91cf * 2 + 1</code>\u3002</li> <li>\u6269\u5bb9\u673a\u5236\u4e0e <code>HashMap</code> \u7c7b\u4f3c\uff0c\u4f46\u8ba1\u7b97\u65b0\u5bb9\u91cf\u7684\u65b9\u5f0f\u4e0d\u540c\u3002</li> </ul>"},{"location":"010Java/020DataStructure/#_33","title":"\u6e90\u7801\u793a\u4f8b","text":"<pre><code>protected void rehash() {\n    // \u6269\u5bb9\u903b\u8f91\n}\n</code></pre>"},{"location":"010Java/020DataStructure/#4_1","title":"4. \u54c8\u5e0c\u51fd\u6570","text":"<ul> <li>HashMap\uff1a</li> <li>\u4f7f\u7528\u66f4\u590d\u6742\u7684\u54c8\u5e0c\u51fd\u6570\u6765\u51cf\u5c11\u54c8\u5e0c\u51b2\u7a81\u3002</li> <li>\u5728 Java 8 \u4e2d\uff0c<code>HashMap</code> \u5bf9\u952e\u7684\u54c8\u5e0c\u503c\u8fdb\u884c\u4e86\u4e8c\u6b21\u5904\u7406\uff08\u6270\u52a8\u51fd\u6570\uff09\uff0c\u4ee5\u8fdb\u4e00\u6b65\u5206\u6563\u54c8\u5e0c\u503c\u3002</li> </ul>"},{"location":"010Java/020DataStructure/#_34","title":"\u6e90\u7801\u793a\u4f8b","text":"<pre><code>static final int hash(Object key) {\n    int h;\n    return (key == null) ? 0 : (h = key.hashCode()) ^ (h &gt;&gt;&gt; 16);\n}\n</code></pre> <ul> <li>Hashtable\uff1a</li> <li>\u76f4\u63a5\u4f7f\u7528\u952e\u7684 <code>hashCode()</code>\uff0c\u6ca1\u6709\u989d\u5916\u7684\u6270\u52a8\u5904\u7406\u3002</li> <li>\u56e0\u6b64\uff0c<code>Hashtable</code> \u7684\u54c8\u5e0c\u51b2\u7a81\u6982\u7387\u53ef\u80fd\u66f4\u9ad8\u3002</li> </ul>"},{"location":"010Java/020DataStructure/#_35","title":"\u6e90\u7801\u793a\u4f8b","text":"<pre><code>int hash = key.hashCode();\n</code></pre>"},{"location":"010Java/020DataStructure/#5_1","title":"5. \u603b\u7ed3\uff1a\u5185\u90e8\u6570\u636e\u5b58\u50a8\u7684\u5f02\u540c","text":"\u7279\u6027 HashMap Hashtable Bucket \u7ed3\u6784 \u6570\u7ec4 + \u94fe\u8868/\u7ea2\u9ed1\u6811 \u6570\u7ec4 + \u94fe\u8868 \u7ea2\u9ed1\u6811\u4f18\u5316 \u652f\u6301\uff08\u94fe\u8868\u957f\u5ea6 &gt; 8 \u65f6\u8f6c\u6362\uff09 \u4e0d\u652f\u6301 \u54c8\u5e0c\u51fd\u6570 \u4e8c\u6b21\u54c8\u5e0c\uff08\u6270\u52a8\u51fd\u6570\uff09 \u76f4\u63a5\u4f7f\u7528 <code>hashCode()</code> \u6269\u5bb9\u673a\u5236 \u5bb9\u91cf\u7ffb\u500d \u5bb9\u91cf\u53d8\u4e3a <code>\u65e7\u5bb9\u91cf * 2 + 1</code> \u521d\u59cb\u5bb9\u91cf 16 11 \u8d1f\u8f7d\u56e0\u5b50 0.75 0.75"},{"location":"010Java/020DataStructure/#_36","title":"\u7ed3\u8bba","text":"<ul> <li>\u76f8\u540c\u70b9\uff1a</li> <li>\u4e24\u8005\u90fd\u4f7f\u7528 Bucket\uff08\u6570\u7ec4\uff09\u548c\u94fe\u8868\u6765\u5b58\u50a8\u6570\u636e\u3002</li> <li>\u90fd\u901a\u8fc7\u94fe\u8868\u89e3\u51b3\u54c8\u5e0c\u51b2\u7a81\u3002</li> <li>\u4e0d\u540c\u70b9\uff1a</li> <li><code>HashMap</code> \u5728 Java 8 \u5f15\u5165\u4e86\u7ea2\u9ed1\u6811\u4f18\u5316\uff0c\u800c <code>Hashtable</code> \u6ca1\u6709\u3002</li> <li><code>HashMap</code> \u7684\u54c8\u5e0c\u51fd\u6570\u66f4\u590d\u6742\uff0c\u51cf\u5c11\u4e86\u54c8\u5e0c\u51b2\u7a81\u7684\u6982\u7387\u3002</li> <li><code>HashMap</code> \u7684\u6269\u5bb9\u673a\u5236\u66f4\u9ad8\u6548\uff08\u5bb9\u91cf\u7ffb\u500d\uff09\uff0c\u800c <code>Hashtable</code> \u7684\u6269\u5bb9\u673a\u5236\u8f83\u7b80\u5355\u3002</li> </ul> <p>\u56e0\u6b64\uff0c<code>HashMap</code> \u5728\u73b0\u4ee3 Java \u5f00\u53d1\u4e2d\u66f4\u5e38\u7528\uff0c\u800c <code>Hashtable</code> \u7531\u4e8e\u5176\u7ebf\u7a0b\u5b89\u5168\u6027\u548c\u6027\u80fd\u95ee\u9898\uff0c\u9010\u6e10\u88ab <code>ConcurrentHashMap</code> \u53d6\u4ee3\u3002</p>"},{"location":"010Java/020DataStructure/#equals-hashcodehashmap","title":"\u4e00\u4e2a\u7c7b\u7684equals hashCode\u4f1a\u5982\u4f55\u5f71\u54cd\u5230HashMap\u7684\u5b58\u50a8\uff1f","text":"\u7b54\u6848 <p>\u662f\u7684\uff0c\u4e00\u4e2a\u7c7b\u7684 <code>equals</code> \u548c <code>hashCode</code> \u65b9\u6cd5\u4f1a\u76f4\u63a5\u5f71\u54cd <code>HashMap</code> \u7684\u5b58\u50a8\u548c\u6027\u80fd\u3002\u8fd9\u662f\u56e0\u4e3a <code>HashMap</code> \u4f9d\u8d56\u4e8e\u8fd9\u4e24\u4e2a\u65b9\u6cd5\u6765\u5b9a\u4f4d\u952e\u503c\u5bf9\u3001\u89e3\u51b3\u54c8\u5e0c\u51b2\u7a81\u4ee5\u53ca\u786e\u4fdd\u952e\u7684\u552f\u4e00\u6027\u3002</p>"},{"location":"010Java/020DataStructure/#1-hashcode","title":"1. <code>hashCode</code> \u65b9\u6cd5\u7684\u5f71\u54cd","text":"<p><code>hashCode</code> \u65b9\u6cd5\u7528\u4e8e\u8ba1\u7b97\u952e\u7684\u54c8\u5e0c\u503c\uff0c<code>HashMap</code> \u4f7f\u7528\u8fd9\u4e2a\u54c8\u5e0c\u503c\u6765\u786e\u5b9a\u952e\u503c\u5bf9\u5b58\u50a8\u5728\u54ea\u4e2a Bucket\uff08\u6876\uff09\u4e2d\u3002</p>"},{"location":"010Java/020DataStructure/#_37","title":"\u5f71\u54cd\uff1a","text":"<ul> <li>\u54c8\u5e0c\u51b2\u7a81\uff1a</li> <li>\u5982\u679c <code>hashCode</code> \u5b9e\u73b0\u4e0d\u597d\uff08\u4f8b\u5982\uff0c\u603b\u662f\u8fd4\u56de\u76f8\u540c\u7684\u503c\uff09\uff0c\u4f1a\u5bfc\u81f4\u6240\u6709\u952e\u503c\u5bf9\u90fd\u5b58\u50a8\u5728\u540c\u4e00\u4e2a Bucket \u4e2d\uff0c\u5f62\u6210\u4e00\u6761\u957f\u94fe\u8868\u6216\u7ea2\u9ed1\u6811\u3002</li> <li> <p>\u8fd9\u4f1a\u663e\u8457\u964d\u4f4e <code>HashMap</code> \u7684\u6027\u80fd\uff0c\u56e0\u4e3a\u67e5\u627e\u3001\u63d2\u5165\u548c\u5220\u9664\u64cd\u4f5c\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u4f1a\u4ece <code>O(1)</code> \u9000\u5316\u4e3a <code>O(n)</code> \u6216 <code>O(log n)</code>\u3002</p> </li> <li> <p>\u5206\u5e03\u5747\u5300\u6027\uff1a</p> </li> <li>\u4e00\u4e2a\u597d\u7684 <code>hashCode</code> \u5b9e\u73b0\u5e94\u8be5\u5c3d\u53ef\u80fd\u5747\u5300\u5730\u5206\u5e03\u952e\u7684\u54c8\u5e0c\u503c\uff0c\u4ee5\u51cf\u5c11\u54c8\u5e0c\u51b2\u7a81\u3002</li> <li>\u4f8b\u5982\uff0c<code>String</code> \u7c7b\u7684 <code>hashCode</code> \u5b9e\u73b0\u5c31\u975e\u5e38\u4f18\u79c0\uff0c\u80fd\u591f\u5f88\u597d\u5730\u5206\u6563\u54c8\u5e0c\u503c\u3002</li> </ul>"},{"location":"010Java/020DataStructure/#_38","title":"\u793a\u4f8b\uff1a","text":"<pre><code>class BadKey {\n    private int id;\n\n    public BadKey(int id) {\n        this.id = id;\n    }\n\n    @Override\n    public int hashCode() {\n        return 1; // \u603b\u662f\u8fd4\u56de\u76f8\u540c\u7684\u54c8\u5e0c\u503c\n    }\n}\n\npublic class Main {\n    public static void main(String[] args) {\n        Map&lt;BadKey, String&gt; map = new HashMap&lt;&gt;();\n        for (int i = 0; i &lt; 100; i++) {\n            map.put(new BadKey(i), \"Value\" + i);\n        }\n        // \u6240\u6709\u952e\u503c\u5bf9\u90fd\u4f1a\u5b58\u50a8\u5728\u540c\u4e00\u4e2a Bucket \u4e2d\uff0c\u5f62\u6210\u4e00\u6761\u957f\u94fe\u8868\n    }\n}\n</code></pre>"},{"location":"010Java/020DataStructure/#2-equals","title":"2. <code>equals</code> \u65b9\u6cd5\u7684\u5f71\u54cd","text":"<p><code>equals</code> \u65b9\u6cd5\u7528\u4e8e\u6bd4\u8f83\u4e24\u4e2a\u952e\u662f\u5426\u76f8\u7b49\u3002<code>HashMap</code> \u4f7f\u7528 <code>equals</code> \u65b9\u6cd5\u6765\u786e\u4fdd\u952e\u7684\u552f\u4e00\u6027\uff0c\u5e76\u5728\u54c8\u5e0c\u51b2\u7a81\u65f6\u627e\u5230\u6b63\u786e\u7684\u952e\u503c\u5bf9\u3002</p>"},{"location":"010Java/020DataStructure/#_39","title":"\u5f71\u54cd\uff1a","text":"<ul> <li>\u952e\u7684\u552f\u4e00\u6027\uff1a</li> <li>\u5982\u679c <code>equals</code> \u5b9e\u73b0\u4e0d\u6b63\u786e\uff0c\u53ef\u80fd\u4f1a\u5bfc\u81f4 <code>HashMap</code> \u65e0\u6cd5\u6b63\u786e\u8bc6\u522b\u91cd\u590d\u7684\u952e\u3002</li> <li> <p>\u4f8b\u5982\uff0c\u5982\u679c <code>equals</code> \u603b\u662f\u8fd4\u56de <code>false</code>\uff0c<code>HashMap</code> \u4f1a\u8ba4\u4e3a\u6bcf\u4e2a\u952e\u90fd\u662f\u552f\u4e00\u7684\uff0c\u5373\u4f7f\u5b83\u4eec\u7684\u5b9e\u9645\u5185\u5bb9\u76f8\u540c\u3002</p> </li> <li> <p>\u67e5\u627e\u6027\u80fd\uff1a</p> </li> <li>\u5728\u54c8\u5e0c\u51b2\u7a81\u7684\u60c5\u51b5\u4e0b\uff0c<code>HashMap</code> \u9700\u8981\u904d\u5386\u94fe\u8868\u6216\u7ea2\u9ed1\u6811\uff0c\u5e76\u4f7f\u7528 <code>equals</code> \u65b9\u6cd5\u9010\u4e2a\u6bd4\u8f83\u952e\u3002</li> <li>\u5982\u679c <code>equals</code> \u5b9e\u73b0\u4e0d\u597d\uff08\u4f8b\u5982\uff0c\u603b\u662f\u8fd4\u56de <code>false</code>\uff09\uff0c\u4f1a\u5bfc\u81f4\u67e5\u627e\u6027\u80fd\u4e0b\u964d\u3002</li> </ul>"},{"location":"010Java/020DataStructure/#_40","title":"\u793a\u4f8b\uff1a","text":"<pre><code>class BadKey {\n    private int id;\n\n    public BadKey(int id) {\n        this.id = id;\n    }\n\n    @Override\n    public boolean equals(Object obj) {\n        return false; // \u603b\u662f\u8fd4\u56de false\n    }\n\n    @Override\n    public int hashCode() {\n        return id;\n    }\n}\n\npublic class Main {\n    public static void main(String[] args) {\n        Map&lt;BadKey, String&gt; map = new HashMap&lt;&gt;();\n        BadKey key1 = new BadKey(1);\n        BadKey key2 = new BadKey(1);\n\n        map.put(key1, \"Value1\");\n        map.put(key2, \"Value2\");\n\n        System.out.println(map.size()); // \u8f93\u51fa 2\uff0c\u56e0\u4e3a equals \u603b\u662f\u8fd4\u56de false\n    }\n}\n</code></pre>"},{"location":"010Java/020DataStructure/#3-equals-hashcode","title":"3. <code>equals</code> \u548c <code>hashCode</code> \u7684\u534f\u4f5c","text":"<p><code>HashMap</code> \u8981\u6c42 <code>equals</code> \u548c <code>hashCode</code> \u65b9\u6cd5\u5fc5\u987b\u9075\u5faa\u4ee5\u4e0b\u89c4\u5219\uff1a 1. \u4e00\u81f4\u6027\uff1a - \u5982\u679c\u4e24\u4e2a\u5bf9\u8c61\u901a\u8fc7 <code>equals</code> \u6bd4\u8f83\u76f8\u7b49\uff0c\u90a3\u4e48\u5b83\u4eec\u7684 <code>hashCode</code> \u5fc5\u987b\u76f8\u7b49\u3002 - \u5982\u679c\u4e24\u4e2a\u5bf9\u8c61\u7684 <code>hashCode</code> \u76f8\u7b49\uff0c\u5b83\u4eec\u4e0d\u4e00\u5b9a\u9700\u8981\u901a\u8fc7 <code>equals</code> \u6bd4\u8f83\u76f8\u7b49\uff08\u54c8\u5e0c\u51b2\u7a81\uff09\u3002</p> <ol> <li>\u5fc5\u8981\u6027\uff1a</li> <li>\u5982\u679c <code>equals</code> \u548c <code>hashCode</code> \u4e0d\u6ee1\u8db3\u4e0a\u8ff0\u89c4\u5219\uff0c<code>HashMap</code> \u7684\u884c\u4e3a\u5c06\u4e0d\u53ef\u9884\u6d4b\u3002</li> </ol>"},{"location":"010Java/020DataStructure/#_41","title":"\u793a\u4f8b\uff1a","text":"<pre><code>class GoodKey {\n    private int id;\n\n    public GoodKey(int id) {\n        this.id = id;\n    }\n\n    @Override\n    public boolean equals(Object obj) {\n        if (this == obj) return true;\n        if (obj == null || getClass() != obj.getClass()) return false;\n        GoodKey goodKey = (GoodKey) obj;\n        return id == goodKey.id;\n    }\n\n    @Override\n    public int hashCode() {\n        return id; // \u7b80\u5355\u4f46\u6709\u6548\u7684\u54c8\u5e0c\u7801\u5b9e\u73b0\n    }\n}\n\npublic class Main {\n    public static void main(String[] args) {\n        Map&lt;GoodKey, String&gt; map = new HashMap&lt;&gt;();\n        GoodKey key1 = new GoodKey(1);\n        GoodKey key2 = new GoodKey(1);\n\n        map.put(key1, \"Value1\");\n        map.put(key2, \"Value2\");\n\n        System.out.println(map.size()); // \u8f93\u51fa 1\uff0c\u56e0\u4e3a key1 \u548c key2 \u662f\u76f8\u7b49\u7684\n    }\n}\n</code></pre>"},{"location":"010Java/020DataStructure/#4-equals-hashcode-hashmap","title":"4. \u603b\u7ed3\uff1a<code>equals</code> \u548c <code>hashCode</code> \u5bf9 <code>HashMap</code> \u7684\u5f71\u54cd","text":"\u95ee\u9898 \u5f71\u54cd <code>hashCode</code> \u5b9e\u73b0\u4e0d\u597d \u54c8\u5e0c\u51b2\u7a81\u589e\u52a0\uff0c\u6027\u80fd\u4e0b\u964d\uff08\u94fe\u8868\u6216\u7ea2\u9ed1\u6811\u8fc7\u957f\uff09\u3002 <code>equals</code> \u5b9e\u73b0\u4e0d\u597d \u65e0\u6cd5\u6b63\u786e\u8bc6\u522b\u91cd\u590d\u952e\uff0c\u5bfc\u81f4\u952e\u503c\u5bf9\u91cd\u590d\u5b58\u50a8\u3002 <code>equals</code> \u548c <code>hashCode</code> \u4e0d\u4e00\u81f4 <code>HashMap</code> \u884c\u4e3a\u4e0d\u53ef\u9884\u6d4b\uff0c\u53ef\u80fd\u65e0\u6cd5\u6b63\u786e\u67e5\u627e\u6216\u5b58\u50a8\u952e\u503c\u5bf9\u3002"},{"location":"010Java/020DataStructure/#5_2","title":"5. \u6700\u4f73\u5b9e\u8df5","text":"<ul> <li>\u59cb\u7ec8\u91cd\u5199 <code>equals</code> \u548c <code>hashCode</code> \u65b9\u6cd5\uff0c\u5e76\u786e\u4fdd\u5b83\u4eec\u6ee1\u8db3\u4e00\u81f4\u6027\u89c4\u5219\u3002</li> <li>\u4f7f\u7528 IDE\uff08\u5982 IntelliJ IDEA \u6216 Eclipse\uff09\u81ea\u52a8\u751f\u6210 <code>equals</code> \u548c <code>hashCode</code> \u65b9\u6cd5\uff0c\u907f\u514d\u624b\u52a8\u5b9e\u73b0\u9519\u8bef\u3002</li> <li>\u5728 <code>hashCode</code> \u5b9e\u73b0\u4e2d\uff0c\u5c3d\u91cf\u4f7f\u7528\u6240\u6709\u5173\u952e\u5b57\u6bb5\u6765\u8ba1\u7b97\u54c8\u5e0c\u503c\uff0c\u4ee5\u51cf\u5c11\u51b2\u7a81\u3002</li> </ul> <p>\u901a\u8fc7\u6b63\u786e\u5b9e\u73b0 <code>equals</code> \u548c <code>hashCode</code> \u65b9\u6cd5\uff0c\u53ef\u4ee5\u786e\u4fdd <code>HashMap</code> \u7684\u9ad8\u6548\u6027\u548c\u6b63\u786e\u6027\u3002</p>"},{"location":"010Java/020DataStructure/#hashmapkeyvalue","title":"HashMap\u5177\u4f53\u5bf9Key\u548cValue\u505a\u4e86\u4ec0\u4e48\uff1f","text":"\u7b54\u6848 <p>\u5728Java\u4e2d\uff0c<code>HashMap</code> \u662f\u4e00\u79cd\u57fa\u4e8e\u54c8\u5e0c\u8868\u7684 <code>Map</code> \u5b9e\u73b0\u3002\u5f53\u4f60\u5411 <code>HashMap</code> \u5b58\u5165\u6570\u636e\u65f6\uff0c<code>HashMap</code> \u4f1a\u5bf9 <code>Key</code> \u548c <code>Value</code> \u8fdb\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff1a</p>"},{"location":"010Java/020DataStructure/#1-key","title":"1. \u5bf9 <code>Key</code> \u7684\u5904\u7406\uff1a","text":"<ul> <li> <p>\u8ba1\u7b97\u54c8\u5e0c\u503c\uff1a<code>HashMap</code> \u9996\u5148\u4f1a\u8c03\u7528 <code>Key</code> \u7684 <code>hashCode()</code> \u65b9\u6cd5\uff0c\u8ba1\u7b97\u5176\u54c8\u5e0c\u503c\u3002\u8fd9\u4e2a\u54c8\u5e0c\u503c\u7528\u4e8e\u786e\u5b9a <code>Key</code> \u5728\u54c8\u5e0c\u8868\u4e2d\u7684\u5b58\u50a8\u4f4d\u7f6e\u3002</p> </li> <li> <p>\u5904\u7406\u54c8\u5e0c\u51b2\u7a81\uff1a\u5982\u679c\u4e24\u4e2a\u4e0d\u540c\u7684 <code>Key</code> \u8ba1\u7b97\u51fa\u7684\u54c8\u5e0c\u503c\u76f8\u540c\uff08\u5373\u54c8\u5e0c\u51b2\u7a81\uff09\uff0c<code>HashMap</code> \u4f1a\u4f7f\u7528\u94fe\u8868\u6216\u7ea2\u9ed1\u6811\uff08\u5728Java 8\u53ca\u4ee5\u540e\uff09\u6765\u5904\u7406\u51b2\u7a81\u3002\u5177\u4f53\u6765\u8bf4\uff0c<code>HashMap</code> \u4f1a\u5c06\u5177\u6709\u76f8\u540c\u54c8\u5e0c\u503c\u7684 <code>Key</code> \u5b58\u50a8\u5728\u540c\u4e00\u4e2a\u6876\uff08bucket\uff09\u4e2d\uff0c\u5f62\u6210\u4e00\u4e2a\u94fe\u8868\u6216\u7ea2\u9ed1\u6811\u3002</p> </li> <li> <p>\u68c0\u67e5\u662f\u5426\u5df2\u5b58\u5728\uff1a\u5728\u63d2\u5165\u4e4b\u524d\uff0c<code>HashMap</code> \u4f1a\u68c0\u67e5\u662f\u5426\u5df2\u7ecf\u5b58\u5728\u76f8\u540c\u7684 <code>Key</code>\u3002\u5b83\u4f1a\u8c03\u7528 <code>Key</code> \u7684 <code>equals()</code> \u65b9\u6cd5\u6765\u6bd4\u8f83 <code>Key</code> \u662f\u5426\u76f8\u7b49\u3002\u5982\u679c <code>Key</code> \u5df2\u7ecf\u5b58\u5728\uff0c<code>HashMap</code> \u4f1a\u66f4\u65b0\u5bf9\u5e94\u7684 <code>Value</code>\u3002</p> </li> </ul>"},{"location":"010Java/020DataStructure/#2-value","title":"2. \u5bf9 <code>Value</code> \u7684\u5904\u7406\uff1a","text":"<ul> <li> <p>\u5b58\u50a8 <code>Value</code>\uff1a<code>Value</code> \u4f1a\u88ab\u76f4\u63a5\u5b58\u50a8\u5728\u54c8\u5e0c\u8868\u4e2d\u4e0e <code>Key</code> \u5bf9\u5e94\u7684\u4f4d\u7f6e\u3002<code>Value</code> \u672c\u8eab\u4e0d\u9700\u8981\u8fdb\u884c\u54c8\u5e0c\u8ba1\u7b97\u6216\u4efb\u4f55\u7279\u6b8a\u5904\u7406\u3002</p> </li> <li> <p>\u66f4\u65b0 <code>Value</code>\uff1a\u5982\u679c <code>Key</code> \u5df2\u7ecf\u5b58\u5728\uff0c<code>HashMap</code> \u4f1a\u7528\u65b0\u7684 <code>Value</code> \u66ff\u6362\u65e7\u7684 <code>Value</code>\u3002</p> </li> </ul>"},{"location":"010Java/020DataStructure/#_42","title":"\u603b\u7ed3\uff1a","text":"<ul> <li><code>Key</code>\uff1a<code>HashMap</code> \u4f1a\u5bf9 <code>Key</code> \u8fdb\u884c\u54c8\u5e0c\u8ba1\u7b97\uff0c\u5904\u7406\u54c8\u5e0c\u51b2\u7a81\uff0c\u5e76\u4f7f\u7528 <code>equals()</code> \u65b9\u6cd5\u68c0\u67e5 <code>Key</code> \u662f\u5426\u5df2\u5b58\u5728\u3002</li> <li><code>Value</code>\uff1a<code>Value</code> \u4f1a\u88ab\u76f4\u63a5\u5b58\u50a8\u6216\u66f4\u65b0\uff0c\u4e0d\u9700\u8981\u8fdb\u884c\u989d\u5916\u7684\u5904\u7406\u3002</li> </ul>"},{"location":"010Java/020DataStructure/#_43","title":"\u793a\u4f8b\u4ee3\u7801\uff1a","text":"<pre><code>HashMap&lt;String, Integer&gt; map = new HashMap&lt;&gt;();\nmap.put(\"apple\", 10);  // Key: \"apple\", Value: 10\nmap.put(\"banana\", 20); // Key: \"banana\", Value: 20\nmap.put(\"apple\", 30);  // Key: \"apple\" \u5df2\u5b58\u5728\uff0c\u66f4\u65b0 Value \u4e3a 30\n</code></pre> <p>\u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff1a - \u7b2c\u4e00\u6b21\u63d2\u5165 <code>\"apple\"</code> \u65f6\uff0c<code>HashMap</code> \u4f1a\u8ba1\u7b97 <code>\"apple\"</code> \u7684\u54c8\u5e0c\u503c\uff0c\u5e76\u5c06\u5176\u5b58\u50a8\u5728\u54c8\u5e0c\u8868\u4e2d\u3002 - \u7b2c\u4e8c\u6b21\u63d2\u5165 <code>\"banana\"</code> \u65f6\uff0c<code>HashMap</code> \u4f1a\u8ba1\u7b97 <code>\"banana\"</code> \u7684\u54c8\u5e0c\u503c\uff0c\u5e76\u5c06\u5176\u5b58\u50a8\u5728\u54c8\u5e0c\u8868\u4e2d\u3002 - \u7b2c\u4e09\u6b21\u63d2\u5165 <code>\"apple\"</code> \u65f6\uff0c<code>HashMap</code> \u4f1a\u53d1\u73b0 <code>\"apple\"</code> \u5df2\u7ecf\u5b58\u5728\uff0c\u56e0\u6b64\u4f1a\u66f4\u65b0\u5bf9\u5e94\u7684 <code>Value</code> \u4e3a <code>30</code>\u3002</p> <p>\u901a\u8fc7\u8fd9\u79cd\u65b9\u5f0f\uff0c<code>HashMap</code> \u80fd\u591f\u9ad8\u6548\u5730\u5b58\u50a8\u548c\u68c0\u7d22\u952e\u503c\u5bf9\u3002</p>"},{"location":"010Java/020DataStructure/#hashmapandroidhashmap","title":"HashMap\u5728Android\u4e0a\u6709\u6ca1\u6709\u66ff\u6362\u7684\u7c7b\uff1f\u76f8\u6bd4HashMap\u6709\u54ea\u4e9b\u4f18\u52bf\uff1f","text":"\u7b54\u6848 <p>\u5728 Android \u5f00\u53d1\u4e2d\uff0c\u5982\u679c\u9700\u8981\u66ff\u6362 <code>HashMap</code>\uff0c\u901a\u5e38\u4f1a\u4f7f\u7528 <code>ArrayMap</code> \u6216 <code>SparseArray</code> \u7cfb\u5217\u7c7b\u3002\u8fd9\u4e9b\u7c7b\u662f Android \u4e13\u95e8\u4e3a\u79fb\u52a8\u8bbe\u5907\u4f18\u5316\u8fc7\u7684\u6570\u636e\u7ed3\u6784\uff0c\u65e8\u5728\u51cf\u5c11\u5185\u5b58\u5360\u7528\u5e76\u63d0\u9ad8\u6027\u80fd\uff0c\u7279\u522b\u662f\u5728\u5904\u7406\u5c0f\u89c4\u6a21\u6570\u636e\u65f6\u3002</p>"},{"location":"010Java/020DataStructure/#hashmap_1","title":"\u4e00\u3001HashMap \u7684\u95ee\u9898","text":"<p>\u5728 Android \u4e0a\uff0c<code>HashMap</code> \u867d\u7136\u529f\u80fd\u5f3a\u5927\uff0c\u4f46\u5728\u67d0\u4e9b\u573a\u666f\u4e0b\u53ef\u80fd\u5b58\u5728\u4ee5\u4e0b\u95ee\u9898\uff1a 1. \u5185\u5b58\u5360\u7528\u9ad8\uff1a - <code>HashMap</code> \u4f7f\u7528\u6570\u7ec4 + \u94fe\u8868/\u7ea2\u9ed1\u6811\u7684\u7ed3\u6784\uff0c\u9700\u8981\u989d\u5916\u7684\u5185\u5b58\u5b58\u50a8 Entry \u5bf9\u8c61\u548c\u94fe\u8868\u8282\u70b9\u3002 - \u6bcf\u4e2a\u952e\u503c\u5bf9\u90fd\u9700\u8981\u4e00\u4e2a <code>Entry</code> \u5bf9\u8c61\uff0c\u589e\u52a0\u4e86\u5185\u5b58\u5f00\u9500\u3002 2. \u6027\u80fd\u5f00\u9500\uff1a - \u5bf9\u4e8e\u5c0f\u89c4\u6a21\u6570\u636e\uff0c<code>HashMap</code> \u7684\u6027\u80fd\u4f18\u52bf\u4e0d\u660e\u663e\uff0c\u53cd\u800c\u53ef\u80fd\u56e0\u4e3a\u54c8\u5e0c\u51b2\u7a81\u548c\u5bf9\u8c61\u521b\u5efa\u5e26\u6765\u989d\u5916\u5f00\u9500\u3002 3. \u81ea\u52a8\u88c5\u7bb1\u95ee\u9898\uff1a - \u5982\u679c\u4f7f\u7528\u57fa\u672c\u6570\u636e\u7c7b\u578b\uff08\u5982 <code>int</code>\u3001<code>long</code>\uff09\u4f5c\u4e3a\u952e\uff0c<code>HashMap</code> \u4f1a\u5c06\u5176\u81ea\u52a8\u88c5\u7bb1\u4e3a <code>Integer</code>\u3001<code>Long</code> \u7b49\u5bf9\u8c61\uff0c\u589e\u52a0\u4e86\u5185\u5b58\u548c\u6027\u80fd\u5f00\u9500\u3002</p>"},{"location":"010Java/020DataStructure/#android","title":"\u4e8c\u3001Android \u4e0a\u7684\u66ff\u4ee3\u7c7b","text":""},{"location":"010Java/020DataStructure/#1-arraymap","title":"1. ArrayMap","text":"<ul> <li>\u7279\u70b9\uff1a</li> <li>\u57fa\u4e8e\u4e24\u4e2a\u6570\u7ec4\u5b9e\u73b0\uff1a\u4e00\u4e2a\u6570\u7ec4\u5b58\u50a8\u952e\u7684\u54c8\u5e0c\u503c\uff0c\u53e6\u4e00\u4e2a\u6570\u7ec4\u5b58\u50a8\u952e\u503c\u5bf9\u3002</li> <li>\u5185\u5b58\u5360\u7528\u6bd4 <code>HashMap</code> \u66f4\u5c0f\u3002</li> <li>\u9002\u5408\u5c0f\u89c4\u6a21\u6570\u636e\uff08\u901a\u5e38\u5c11\u4e8e 1000 \u4e2a\u5143\u7d20\uff09\u3002</li> <li>\u4f18\u52bf\uff1a</li> <li>\u5185\u5b58\u6548\u7387\u9ad8\uff1a\u4e0d\u9700\u8981\u989d\u5916\u7684 <code>Entry</code> \u5bf9\u8c61\u3002</li> <li>\u907f\u514d\u4e86\u81ea\u52a8\u88c5\u7bb1\u95ee\u9898\u3002</li> <li>\u5728\u5c0f\u6570\u636e\u91cf\u4e0b\uff0c\u6027\u80fd\u4f18\u4e8e <code>HashMap</code>\u3002</li> <li>\u52a3\u52bf\uff1a</li> <li>\u6570\u636e\u91cf\u8f83\u5927\u65f6\uff0c\u6027\u80fd\u4e0d\u5982 <code>HashMap</code>\uff08\u67e5\u627e\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a O(log n)\uff09\u3002</li> <li>\u4e0d\u9002\u5408\u5b58\u50a8\u5927\u91cf\u6570\u636e\u3002</li> <li>\u9002\u7528\u573a\u666f\uff1a</li> <li>\u5c0f\u89c4\u6a21\u952e\u503c\u5bf9\u5b58\u50a8\u3002</li> <li>\u4f8b\u5982\uff1aBundle\u3001SharedPreferences \u7b49\u3002</li> </ul>"},{"location":"010Java/020DataStructure/#_44","title":"\u793a\u4f8b\u4ee3\u7801\uff1a","text":"<pre><code>ArrayMap&lt;String, String&gt; arrayMap = new ArrayMap&lt;&gt;();\narrayMap.put(\"key1\", \"value1\");\narrayMap.put(\"key2\", \"value2\");\nString value = arrayMap.get(\"key1\");\n</code></pre>"},{"location":"010Java/020DataStructure/#2-sparsearray","title":"2. SparseArray","text":"<ul> <li>\u7279\u70b9\uff1a</li> <li>\u4e13\u95e8\u9488\u5bf9\u952e\u4e3a <code>int</code> \u7c7b\u578b\u7684\u573a\u666f\u4f18\u5316\u3002</li> <li>\u4f7f\u7528\u4e24\u4e2a\u6570\u7ec4\uff1a\u4e00\u4e2a\u5b58\u50a8\u952e\uff08<code>int</code>\uff09\uff0c\u53e6\u4e00\u4e2a\u5b58\u50a8\u503c\u3002</li> <li>\u907f\u514d\u4e86\u81ea\u52a8\u88c5\u7bb1\u95ee\u9898\u3002</li> <li>\u4f18\u52bf\uff1a</li> <li>\u5185\u5b58\u6548\u7387\u9ad8\uff1a\u952e\u4e3a\u57fa\u672c\u6570\u636e\u7c7b\u578b\uff0c\u4e0d\u9700\u8981\u989d\u5916\u7684\u5bf9\u8c61\u3002</li> <li>\u5728\u5c0f\u6570\u636e\u91cf\u4e0b\uff0c\u6027\u80fd\u4f18\u4e8e <code>HashMap</code>\u3002</li> <li>\u52a3\u52bf\uff1a</li> <li>\u952e\u53ea\u80fd\u662f <code>int</code> \u7c7b\u578b\u3002</li> <li>\u6570\u636e\u91cf\u8f83\u5927\u65f6\uff0c\u6027\u80fd\u4e0d\u5982 <code>HashMap</code>\uff08\u67e5\u627e\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a O(log n)\uff09\u3002</li> <li>\u9002\u7528\u573a\u666f\uff1a</li> <li>\u952e\u4e3a <code>int</code> \u7c7b\u578b\u7684\u5c0f\u89c4\u6a21\u952e\u503c\u5bf9\u5b58\u50a8\u3002</li> <li>\u4f8b\u5982\uff1aView \u7684 ID \u6620\u5c04\u3002</li> </ul>"},{"location":"010Java/020DataStructure/#_45","title":"\u793a\u4f8b\u4ee3\u7801\uff1a","text":"<pre><code>SparseArray&lt;String&gt; sparseArray = new SparseArray&lt;&gt;();\nsparseArray.put(1, \"value1\");\nsparseArray.put(2, \"value2\");\nString value = sparseArray.get(1);\n</code></pre>"},{"location":"010Java/020DataStructure/#3-sparsearray","title":"3. SparseArray \u7684\u53d8\u79cd","text":"<ul> <li>SparseIntArray\uff1a</li> <li>\u952e\u4e3a <code>int</code>\uff0c\u503c\u4e3a <code>int</code>\u3002</li> <li>SparseLongArray\uff1a</li> <li>\u952e\u4e3a <code>int</code>\uff0c\u503c\u4e3a <code>long</code>\u3002</li> <li>SparseBooleanArray\uff1a</li> <li>\u952e\u4e3a <code>int</code>\uff0c\u503c\u4e3a <code>boolean</code>\u3002</li> </ul>"},{"location":"010Java/020DataStructure/#_46","title":"\u793a\u4f8b\u4ee3\u7801\uff1a","text":"<pre><code>SparseIntArray sparseIntArray = new SparseIntArray();\nsparseIntArray.put(1, 100);\nsparseIntArray.put(2, 200);\nint value = sparseIntArray.get(1);\n</code></pre>"},{"location":"010Java/020DataStructure/#4-longsparsearray","title":"4. LongSparseArray","text":"<ul> <li>\u7279\u70b9\uff1a</li> <li>\u952e\u4e3a <code>long</code> \u7c7b\u578b\u7684\u4f18\u5316\u7248\u672c\u3002</li> <li>\u7c7b\u4f3c\u4e8e <code>SparseArray</code>\uff0c\u4f46\u652f\u6301 <code>long</code> \u7c7b\u578b\u7684\u952e\u3002</li> <li>\u9002\u7528\u573a\u666f\uff1a</li> <li>\u952e\u4e3a <code>long</code> \u7c7b\u578b\u7684\u5c0f\u89c4\u6a21\u952e\u503c\u5bf9\u5b58\u50a8\u3002</li> </ul>"},{"location":"010Java/020DataStructure/#_47","title":"\u793a\u4f8b\u4ee3\u7801\uff1a","text":"<pre><code>LongSparseArray&lt;String&gt; longSparseArray = new LongSparseArray&lt;&gt;();\nlongSparseArray.put(1L, \"value1\");\nlongSparseArray.put(2L, \"value2\");\nString value = longSparseArray.get(1L);\n</code></pre>"},{"location":"010Java/020DataStructure/#hashmap_2","title":"\u4e09\u3001HashMap \u4e0e\u66ff\u4ee3\u7c7b\u7684\u5bf9\u6bd4","text":"\u7279\u6027 HashMap ArrayMap SparseArray \u952e\u7c7b\u578b \u4efb\u610f\u5bf9\u8c61 \u4efb\u610f\u5bf9\u8c61 <code>int</code> \u503c\u7c7b\u578b \u4efb\u610f\u5bf9\u8c61 \u4efb\u610f\u5bf9\u8c61 \u4efb\u610f\u5bf9\u8c61 \u5185\u5b58\u5360\u7528 \u8f83\u9ad8 \u8f83\u4f4e \u6700\u4f4e \u67e5\u627e\u6027\u80fd O(1) O(log n) O(log n) \u63d2\u5165\u6027\u80fd O(1) O(n) O(n) \u5220\u9664\u6027\u80fd O(1) O(n) O(n) \u9002\u7528\u573a\u666f \u5927\u89c4\u6a21\u6570\u636e \u5c0f\u89c4\u6a21\u6570\u636e \u5c0f\u89c4\u6a21\u6570\u636e\uff0c\u952e\u4e3a <code>int</code>"},{"location":"010Java/020DataStructure/#_48","title":"\u56db\u3001\u9009\u62e9\u5efa\u8bae","text":"<ol> <li>\u952e\u4e3a <code>int</code> \u7c7b\u578b\uff1a</li> <li>\u4f7f\u7528 <code>SparseArray</code> \u6216\u5176\u53d8\u79cd\uff08\u5982 <code>SparseIntArray</code>\u3001<code>SparseLongArray</code>\uff09\u3002</li> <li>\u952e\u4e3a <code>long</code> \u7c7b\u578b\uff1a</li> <li>\u4f7f\u7528 <code>LongSparseArray</code>\u3002</li> <li>\u952e\u4e3a\u5176\u4ed6\u7c7b\u578b\uff1a</li> <li>\u5982\u679c\u6570\u636e\u91cf\u8f83\u5c0f\uff0c\u4f7f\u7528 <code>ArrayMap</code>\u3002</li> <li>\u5982\u679c\u6570\u636e\u91cf\u8f83\u5927\uff0c\u4f7f\u7528 <code>HashMap</code>\u3002</li> <li>\u9700\u8981\u9ad8\u6027\u80fd\u548c\u5927\u89c4\u6a21\u6570\u636e\u5b58\u50a8\uff1a</li> <li>\u4f7f\u7528 <code>HashMap</code>\u3002</li> </ol>"},{"location":"010Java/020DataStructure/#_49","title":"\u4e94\u3001\u603b\u7ed3","text":"<p>\u5728 Android \u5f00\u53d1\u4e2d\uff0c<code>ArrayMap</code> \u548c <code>SparseArray</code> \u662f <code>HashMap</code> \u7684\u8f7b\u91cf\u7ea7\u66ff\u4ee3\u65b9\u6848\uff0c\u7279\u522b\u9002\u5408\u5c0f\u89c4\u6a21\u6570\u636e\u5b58\u50a8\u548c\u952e\u4e3a\u57fa\u672c\u6570\u636e\u7c7b\u578b\u7684\u573a\u666f\u3002\u5b83\u4eec\u901a\u8fc7\u51cf\u5c11\u5185\u5b58\u5360\u7528\u548c\u907f\u514d\u81ea\u52a8\u88c5\u7bb1\u95ee\u9898\uff0c\u63d0\u5347\u4e86\u6027\u80fd\u548c\u6548\u7387\u3002\u4f46\u5728\u5904\u7406\u5927\u89c4\u6a21\u6570\u636e\u65f6\uff0c<code>HashMap</code> \u4ecd\u7136\u662f\u66f4\u5408\u9002\u7684\u9009\u62e9\u3002\u6839\u636e\u5177\u4f53\u9700\u6c42\u9009\u62e9\u5408\u9002\u7684\u6570\u636e\u7ed3\u6784\uff0c\u53ef\u4ee5\u663e\u8457\u4f18\u5316\u5e94\u7528\u7684\u6027\u80fd\u548c\u5185\u5b58\u4f7f\u7528\u3002</p>"},{"location":"010Java/020DataStructure/#javalru","title":"\u8bf7\u4f60\u7528Java\u5b9e\u73b0\u4e00\u4e2a\u7b80\u6613LRU\u7b97\u6cd5","text":"\u7b54\u6848 <p>LRU\uff08Least Recently Used\uff09\u7b97\u6cd5\u662f\u4e00\u79cd\u5e38\u7528\u7684\u7f13\u5b58\u6dd8\u6c70\u7b56\u7565\uff0c\u5b83\u4f1a\u4f18\u5148\u6dd8\u6c70\u6700\u8fd1\u6700\u5c11\u4f7f\u7528\u7684\u6570\u636e\u3002\u4e0b\u9762\u662f\u4e00\u4e2a\u4f7f\u7528Java\u5b9e\u73b0\u7684\u7b80\u6613LRU\u7b97\u6cd5\uff0c\u57fa\u4e8e<code>LinkedHashMap</code>\u6765\u5b9e\u73b0\u3002</p> <pre><code>import java.util.LinkedHashMap;\nimport java.util.Map;\n\npublic class LRUCache&lt;K, V&gt; extends LinkedHashMap&lt;K, V&gt; {\n    private final int capacity;\n\n    public LRUCache(int capacity) {\n        // \u8bbe\u7f6eaccessOrder\u4e3atrue\uff0c\u4f7f\u5f97LinkedHashMap\u6309\u7167\u8bbf\u95ee\u987a\u5e8f\u6392\u5e8f\n        super(capacity, 0.75f, true);\n        this.capacity = capacity;\n    }\n\n    @Override\n    protected boolean removeEldestEntry(Map.Entry&lt;K, V&gt; eldest) {\n        // \u5f53\u7f13\u5b58\u5927\u5c0f\u8d85\u8fc7\u5bb9\u91cf\u65f6\uff0c\u79fb\u9664\u6700\u4e45\u672a\u4f7f\u7528\u7684\u5143\u7d20\n        return size() &gt; capacity;\n    }\n\n    public static void main(String[] args) {\n        LRUCache&lt;Integer, String&gt; cache = new LRUCache&lt;&gt;(3);\n\n        cache.put(1, \"One\");\n        cache.put(2, \"Two\");\n        cache.put(3, \"Three\");\n\n        // \u8bbf\u95ee\u5143\u7d201\uff0c\u4f7f\u5176\u6210\u4e3a\u6700\u8fd1\u4f7f\u7528\u7684\u5143\u7d20\n        System.out.println(cache.get(1)); // \u8f93\u51fa: One\n\n        // \u63d2\u5165\u65b0\u5143\u7d20\uff0c\u5bfc\u81f4\u5143\u7d202\u88ab\u6dd8\u6c70\n        cache.put(4, \"Four\");\n\n        // \u8f93\u51fa\u7f13\u5b58\u5185\u5bb9\n        cache.forEach((key, value) -&gt; System.out.println(key + \" -&gt; \" + value));\n        // \u8f93\u51fa:\n        // 3 -&gt; Three\n        // 1 -&gt; One\n        // 4 -&gt; Four\n    }\n}\n</code></pre>"},{"location":"010Java/020DataStructure/#_50","title":"\u4ee3\u7801\u8bf4\u660e\uff1a","text":"<ol> <li> <p>LinkedHashMap\uff1a<code>LinkedHashMap</code>\u662f<code>HashMap</code>\u7684\u4e00\u4e2a\u5b50\u7c7b\uff0c\u5b83\u7ef4\u62a4\u4e86\u4e00\u4e2a\u53cc\u5411\u94fe\u8868\u6765\u8bb0\u5f55\u63d2\u5165\u987a\u5e8f\u6216\u8bbf\u95ee\u987a\u5e8f\u3002\u901a\u8fc7\u8bbe\u7f6e<code>accessOrder</code>\u4e3a<code>true</code>\uff0c<code>LinkedHashMap</code>\u4f1a\u6309\u7167\u8bbf\u95ee\u987a\u5e8f\u6392\u5e8f\uff0c\u6700\u8fd1\u8bbf\u95ee\u7684\u5143\u7d20\u4f1a\u88ab\u79fb\u52a8\u5230\u94fe\u8868\u7684\u5c3e\u90e8\u3002</p> </li> <li> <p>removeEldestEntry\uff1a\u91cd\u5199<code>removeEldestEntry</code>\u65b9\u6cd5\uff0c\u5f53\u7f13\u5b58\u5927\u5c0f\u8d85\u8fc7\u5bb9\u91cf\u65f6\uff0c\u79fb\u9664\u6700\u4e45\u672a\u4f7f\u7528\u7684\u5143\u7d20\uff08\u5373\u94fe\u8868\u7684\u5934\u90e8\u5143\u7d20\uff09\u3002</p> </li> <li> <p>\u5bb9\u91cf\uff1a<code>capacity</code>\u8868\u793a\u7f13\u5b58\u7684\u6700\u5927\u5bb9\u91cf\uff0c\u5f53\u7f13\u5b58\u4e2d\u7684\u5143\u7d20\u6570\u91cf\u8d85\u8fc7\u8fd9\u4e2a\u5bb9\u91cf\u65f6\uff0c\u6700\u4e45\u672a\u4f7f\u7528\u7684\u5143\u7d20\u4f1a\u88ab\u79fb\u9664\u3002</p> </li> </ol>"},{"location":"010Java/020DataStructure/#_51","title":"\u793a\u4f8b\u8fd0\u884c\uff1a","text":"<p>\u5728<code>main</code>\u65b9\u6cd5\u4e2d\uff0c\u6211\u4eec\u521b\u5efa\u4e86\u4e00\u4e2a\u5bb9\u91cf\u4e3a3\u7684LRU\u7f13\u5b58\uff0c\u5e76\u8fdb\u884c\u4e86\u63d2\u5165\u548c\u8bbf\u95ee\u64cd\u4f5c\u3002\u6700\u540e\uff0c\u7f13\u5b58\u4e2d\u7684\u5143\u7d20\u6309\u7167\u8bbf\u95ee\u987a\u5e8f\u6392\u5217\uff0c\u6700\u4e45\u672a\u4f7f\u7528\u7684\u5143\u7d20\u4f1a\u88ab\u6dd8\u6c70\u3002</p>"},{"location":"010Java/020DataStructure/#_52","title":"\u8f93\u51fa\u7ed3\u679c\uff1a","text":"<pre><code>One\n3 -&gt; Three\n1 -&gt; One\n4 -&gt; Four\n</code></pre> <p>\u8fd9\u4e2a\u7b80\u6613\u7684LRU\u5b9e\u73b0\u9002\u7528\u4e8e\u5c0f\u89c4\u6a21\u7684\u7f13\u5b58\u573a\u666f\u3002\u5bf9\u4e8e\u5927\u89c4\u6a21\u5e76\u53d1\u573a\u666f\uff0c\u53ef\u80fd\u9700\u8981\u8003\u8651\u66f4\u590d\u6742\u7684\u5b9e\u73b0\uff0c\u5982\u4f7f\u7528<code>ConcurrentHashMap</code>\u548c\u81ea\u5b9a\u4e49\u7684\u53cc\u5411\u94fe\u8868\u6765\u5b9e\u73b0\u7ebf\u7a0b\u5b89\u5168\u7684LRU\u7f13\u5b58\u3002</p>"},{"location":"010Java/020DataStructure/#linkedhashmapandroid","title":"\u8bb2\u4e00\u4e0bLinkedHashMap\u8fd9\u4e2a\u6570\u636e\u7ed3\u6784\uff0c\u4ee5\u53ca\u5b83\u5728Android\u4e2d\u7684\u4f7f\u7528\u573a\u666f","text":"\u7b54\u6848"},{"location":"010Java/020DataStructure/#linkedhashmap","title":"LinkedHashMap \u6570\u636e\u7ed3\u6784","text":"<p><code>LinkedHashMap</code> \u662f Java \u4e2d\u7684\u4e00\u4e2a\u7c7b\uff0c\u7ee7\u627f\u81ea <code>HashMap</code>\uff0c\u5e76\u5728\u5176\u57fa\u7840\u4e0a\u7ef4\u62a4\u4e86\u4e00\u4e2a\u53cc\u5411\u94fe\u8868\u6765\u8bb0\u5f55\u63d2\u5165\u987a\u5e8f\u6216\u8bbf\u95ee\u987a\u5e8f\u3002\u8fd9\u4f7f\u5f97 <code>LinkedHashMap</code> \u65e2\u80fd\u50cf <code>HashMap</code> \u4e00\u6837\u9ad8\u6548\u5730\u8fdb\u884c\u67e5\u627e\u3001\u63d2\u5165\u548c\u5220\u9664\u64cd\u4f5c\uff0c\u53c8\u80fd\u4fdd\u6301\u5143\u7d20\u7684\u987a\u5e8f\u3002</p>"},{"location":"010Java/020DataStructure/#_53","title":"\u4e3b\u8981\u7279\u6027\uff1a","text":"<ol> <li>\u987a\u5e8f\u6027\uff1a</li> <li>\u63d2\u5165\u987a\u5e8f\uff1a\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c<code>LinkedHashMap</code> \u6309\u7167\u5143\u7d20\u63d2\u5165\u7684\u987a\u5e8f\u8fdb\u884c\u8fed\u4ee3\u3002</li> <li> <p>\u8bbf\u95ee\u987a\u5e8f\uff1a\u901a\u8fc7\u6784\u9020\u51fd\u6570\u8bbe\u7f6e <code>accessOrder</code> \u4e3a <code>true</code>\uff0c<code>LinkedHashMap</code> \u4f1a\u6309\u7167\u5143\u7d20\u7684\u8bbf\u95ee\u987a\u5e8f\uff08\u6700\u8fd1\u6700\u5c11\u4f7f\u7528\u7684\u987a\u5e8f\uff09\u8fdb\u884c\u8fed\u4ee3\u3002</p> </li> <li> <p>\u6027\u80fd\uff1a</p> </li> <li>\u67e5\u627e\u3001\u63d2\u5165\u548c\u5220\u9664\u64cd\u4f5c\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a O(1)\uff0c\u4e0e <code>HashMap</code> \u76f8\u540c\u3002</li> <li> <p>\u7531\u4e8e\u7ef4\u62a4\u4e86\u53cc\u5411\u94fe\u8868\uff0c<code>LinkedHashMap</code> \u7684\u7a7a\u95f4\u5f00\u9500\u7565\u9ad8\u4e8e <code>HashMap</code>\u3002</p> </li> <li> <p>\u7ebf\u7a0b\u4e0d\u5b89\u5168\uff1a</p> </li> <li>\u4e0e <code>HashMap</code> \u4e00\u6837\uff0c<code>LinkedHashMap</code> \u4e0d\u662f\u7ebf\u7a0b\u5b89\u5168\u7684\u3002\u5982\u679c\u9700\u8981\u5728\u591a\u7ebf\u7a0b\u73af\u5883\u4e2d\u4f7f\u7528\uff0c\u53ef\u4ee5\u901a\u8fc7 <code>Collections.synchronizedMap</code> \u8fdb\u884c\u5305\u88c5\u3002</li> </ol>"},{"location":"010Java/020DataStructure/#_54","title":"\u6784\u9020\u65b9\u6cd5\uff1a","text":"<ul> <li><code>LinkedHashMap()</code>\uff1a\u521b\u5efa\u4e00\u4e2a\u7a7a\u7684 <code>LinkedHashMap</code>\uff0c\u9ed8\u8ba4\u6309\u63d2\u5165\u987a\u5e8f\u6392\u5e8f\u3002</li> <li><code>LinkedHashMap(int initialCapacity)</code>\uff1a\u6307\u5b9a\u521d\u59cb\u5bb9\u91cf\u3002</li> <li><code>LinkedHashMap(int initialCapacity, float loadFactor)</code>\uff1a\u6307\u5b9a\u521d\u59cb\u5bb9\u91cf\u548c\u8d1f\u8f7d\u56e0\u5b50\u3002</li> <li><code>LinkedHashMap(int initialCapacity, float loadFactor, boolean accessOrder)</code>\uff1a\u6307\u5b9a\u521d\u59cb\u5bb9\u91cf\u3001\u8d1f\u8f7d\u56e0\u5b50\u548c\u6392\u5e8f\u65b9\u5f0f\uff08\u63d2\u5165\u987a\u5e8f\u6216\u8bbf\u95ee\u987a\u5e8f\uff09\u3002</li> </ul>"},{"location":"010Java/020DataStructure/#android_1","title":"\u5728 Android \u4e2d\u7684\u4f7f\u7528\u573a\u666f","text":"<ol> <li>\u7f13\u5b58\u5b9e\u73b0\uff1a</li> <li><code>LinkedHashMap</code> \u53ef\u4ee5\u7528\u4e8e\u5b9e\u73b0 LRU\uff08Least Recently Used\uff09\u7f13\u5b58\u3002\u901a\u8fc7\u8bbe\u7f6e <code>accessOrder</code> \u4e3a <code>true</code>\uff0c<code>LinkedHashMap</code> \u4f1a\u81ea\u52a8\u5c06\u6700\u8fd1\u8bbf\u95ee\u7684\u5143\u7d20\u79fb\u52a8\u5230\u94fe\u8868\u7684\u672b\u5c3e\uff0c\u800c\u6700\u4e45\u672a\u4f7f\u7528\u7684\u5143\u7d20\u4f1a\u4f4d\u4e8e\u94fe\u8868\u7684\u5934\u90e8\u3002\u7ed3\u5408 <code>removeEldestEntry</code> \u65b9\u6cd5\uff0c\u53ef\u4ee5\u8f7b\u677e\u5b9e\u73b0\u4e00\u4e2a\u56fa\u5b9a\u5927\u5c0f\u7684 LRU \u7f13\u5b58\u3002</li> </ol> <pre><code>public class LRUCache&lt;K, V&gt; extends LinkedHashMap&lt;K, V&gt; {\n    private final int capacity;\n\n    public LRUCache(int capacity) {\n        super(capacity, 0.75f, true);\n        this.capacity = capacity;\n    }\n\n    @Override\n    protected boolean removeEldestEntry(Map.Entry&lt;K, V&gt; eldest) {\n        return size() &gt; capacity;\n    }\n}\n</code></pre> <ol> <li>\u4fdd\u6301\u63d2\u5165\u987a\u5e8f\uff1a</li> <li> <p>\u5728\u9700\u8981\u4fdd\u6301\u5143\u7d20\u63d2\u5165\u987a\u5e8f\u7684\u573a\u666f\u4e2d\uff0c<code>LinkedHashMap</code> \u662f\u4e00\u4e2a\u7406\u60f3\u7684\u9009\u62e9\u3002\u4f8b\u5982\uff0c\u5728 Android \u5f00\u53d1\u4e2d\uff0c\u5982\u679c\u9700\u8981\u5c06\u6570\u636e\u6309\u63d2\u5165\u987a\u5e8f\u5c55\u793a\u5728 <code>RecyclerView</code> \u6216 <code>ListView</code> \u4e2d\uff0c\u53ef\u4ee5\u4f7f\u7528 <code>LinkedHashMap</code> \u6765\u5b58\u50a8\u6570\u636e\u3002</p> </li> <li> <p>\u6570\u636e\u53bb\u91cd\uff1a</p> </li> <li> <p>\u5982\u679c\u9700\u8981\u53bb\u91cd\u5e76\u4fdd\u6301\u987a\u5e8f\uff0c<code>LinkedHashMap</code> \u53ef\u4ee5\u66ff\u4ee3 <code>HashSet</code>\u3002\u4f8b\u5982\uff0c\u4ece\u7f51\u7edc\u6216\u6570\u636e\u5e93\u4e2d\u83b7\u53d6\u6570\u636e\u65f6\uff0c\u53ef\u4ee5\u4f7f\u7528 <code>LinkedHashMap</code> \u6765\u5b58\u50a8\u53bb\u91cd\u540e\u7684\u6570\u636e\uff0c\u5e76\u4fdd\u6301\u63d2\u5165\u987a\u5e8f\u3002</p> </li> <li> <p>\u81ea\u5b9a\u4e49\u7f13\u5b58\u7b56\u7565\uff1a</p> </li> <li>\u9664\u4e86 LRU \u7f13\u5b58\uff0c<code>LinkedHashMap</code> \u8fd8\u53ef\u4ee5\u7528\u4e8e\u5b9e\u73b0\u5176\u4ed6\u81ea\u5b9a\u4e49\u7684\u7f13\u5b58\u7b56\u7565\u3002\u901a\u8fc7\u91cd\u5199 <code>removeEldestEntry</code> \u65b9\u6cd5\uff0c\u53ef\u4ee5\u6839\u636e\u4e1a\u52a1\u9700\u6c42\u5b9a\u4e49\u7f13\u5b58\u6dd8\u6c70\u89c4\u5219\u3002</li> </ol>"},{"location":"010Java/020DataStructure/#_55","title":"\u603b\u7ed3","text":"<p><code>LinkedHashMap</code> \u662f\u4e00\u4e2a\u529f\u80fd\u5f3a\u5927\u7684\u6570\u636e\u7ed3\u6784\uff0c\u7ed3\u5408\u4e86 <code>HashMap</code> \u7684\u9ad8\u6548\u6027\u548c\u94fe\u8868\u7684\u987a\u5e8f\u6027\u3002\u5728 Android \u5f00\u53d1\u4e2d\uff0c\u5b83\u5e38\u7528\u4e8e\u5b9e\u73b0\u7f13\u5b58\u3001\u4fdd\u6301\u6570\u636e\u987a\u5e8f\u4ee5\u53ca\u53bb\u91cd\u7b49\u573a\u666f\u3002\u901a\u8fc7\u7075\u6d3b\u4f7f\u7528 <code>LinkedHashMap</code>\uff0c\u53ef\u4ee5\u7b80\u5316\u4ee3\u7801\u5e76\u63d0\u9ad8\u5e94\u7528\u7684\u6027\u80fd\u3002</p>"},{"location":"010Java/020DataStructure/#_56","title":"Java\u6570\u636e\u7ed3\u6784","text":""},{"location":"010Java/030Algorithm/","title":"\u7b97\u6cd5","text":""},{"location":"010Java/030Algorithm/#_2","title":"\u5feb\u901f\u6392\u5e8f\u6709\u4ec0\u4e48\u7279\u70b9\uff1f","text":"\u7b54\u6848 <p>\u5feb\u901f\u6392\u5e8f\uff08Quick Sort\uff09\u662f\u4e00\u79cd\u9ad8\u6548\u7684\u6392\u5e8f\u7b97\u6cd5\uff0c\u5177\u6709\u4ee5\u4e0b\u7279\u70b9\uff1a</p>"},{"location":"010Java/030Algorithm/#_3","title":"\u7279\u70b9\uff1a","text":"<ol> <li>\u65f6\u95f4\u590d\u6742\u5ea6\uff1a</li> <li>\u5e73\u5747\u60c5\u51b5\uff1aO(n log n)</li> <li>\u6700\u574f\u60c5\u51b5\uff1aO(n\u00b2)\uff08\u5f53\u6bcf\u6b21\u9009\u62e9\u7684\u57fa\u51c6\u5143\u7d20\u5bfc\u81f4\u6781\u5ea6\u4e0d\u5e73\u8861\u7684\u5206\u5272\u65f6\uff09</li> <li> <p>\u6700\u597d\u60c5\u51b5\uff1aO(n log n)</p> </li> <li> <p>\u7a7a\u95f4\u590d\u6742\u5ea6\uff1a</p> </li> <li>\u5e73\u5747\u60c5\u51b5\uff1aO(log n)\uff08\u9012\u5f52\u6808\u7684\u6df1\u5ea6\uff09</li> <li> <p>\u6700\u574f\u60c5\u51b5\uff1aO(n)\uff08\u9012\u5f52\u6808\u7684\u6df1\u5ea6\uff09</p> </li> <li> <p>\u7a33\u5b9a\u6027\uff1a</p> </li> <li> <p>\u5feb\u901f\u6392\u5e8f\u662f\u4e0d\u7a33\u5b9a\u7684\u6392\u5e8f\u7b97\u6cd5\uff0c\u56e0\u4e3a\u76f8\u7b49\u7684\u5143\u7d20\u53ef\u80fd\u4f1a\u56e0\u4e3a\u4ea4\u6362\u800c\u6539\u53d8\u76f8\u5bf9\u987a\u5e8f\u3002</p> </li> <li> <p>\u5206\u6cbb\u6cd5\uff1a</p> </li> <li> <p>\u5feb\u901f\u6392\u5e8f\u91c7\u7528\u5206\u6cbb\u6cd5\uff08Divide and Conquer\uff09\u7b56\u7565\uff0c\u5c06\u95ee\u9898\u5206\u89e3\u4e3a\u8f83\u5c0f\u7684\u5b50\u95ee\u9898\u6765\u89e3\u51b3\u3002</p> </li> <li> <p>\u539f\u5730\u6392\u5e8f\uff1a</p> </li> <li> <p>\u5feb\u901f\u6392\u5e8f\u662f\u539f\u5730\u6392\u5e8f\u7b97\u6cd5\uff0c\u4e0d\u9700\u8981\u989d\u5916\u7684\u5b58\u50a8\u7a7a\u95f4\uff08\u9664\u4e86\u9012\u5f52\u6808\uff09\u3002</p> </li> <li> <p>\u57fa\u51c6\u5143\u7d20\u9009\u62e9\uff1a</p> </li> <li>\u5feb\u901f\u6392\u5e8f\u7684\u6027\u80fd\u9ad8\u5ea6\u4f9d\u8d56\u4e8e\u57fa\u51c6\u5143\u7d20\u7684\u9009\u62e9\u3002\u5e38\u89c1\u7684\u7b56\u7565\u5305\u62ec\u9009\u62e9\u7b2c\u4e00\u4e2a\u5143\u7d20\u3001\u6700\u540e\u4e00\u4e2a\u5143\u7d20\u3001\u4e2d\u95f4\u5143\u7d20\u6216\u968f\u673a\u5143\u7d20\u4f5c\u4e3a\u57fa\u51c6\u3002</li> </ol>"},{"location":"010Java/030Algorithm/#java","title":"Java \u5b9e\u73b0\uff1a","text":"<pre><code>public class QuickSort {\n\n    public static void quickSort(int[] arr, int low, int high) {\n        if (low &lt; high) {\n            // \u627e\u5230\u5206\u533a\u70b9\n            int pi = partition(arr, low, high);\n\n            // \u9012\u5f52\u6392\u5e8f\u5de6\u534a\u90e8\u5206\n            quickSort(arr, low, pi - 1);\n\n            // \u9012\u5f52\u6392\u5e8f\u53f3\u534a\u90e8\u5206\n            quickSort(arr, pi + 1, high);\n        }\n    }\n\n    private static int partition(int[] arr, int low, int high) {\n        int pivot = arr[high]; // \u9009\u62e9\u6700\u540e\u4e00\u4e2a\u5143\u7d20\u4f5c\u4e3a\u57fa\u51c6\n        int i = (low - 1); // \u8f83\u5c0f\u5143\u7d20\u7684\u7d22\u5f15\n\n        for (int j = low; j &lt; high; j++) {\n            // \u5982\u679c\u5f53\u524d\u5143\u7d20\u5c0f\u4e8e\u6216\u7b49\u4e8e\u57fa\u51c6\n            if (arr[j] &lt;= pivot) {\n                i++;\n\n                // \u4ea4\u6362 arr[i] \u548c arr[j]\n                int temp = arr[i];\n                arr[i] = arr[j];\n                arr[j] = temp;\n            }\n        }\n\n        // \u4ea4\u6362 arr[i+1] \u548c\u57fa\u51c6\u5143\u7d20 arr[high]\n        int temp = arr[i + 1];\n        arr[i + 1] = arr[high];\n        arr[high] = temp;\n\n        return i + 1;\n    }\n\n    public static void main(String[] args) {\n        int[] arr = {10, 7, 8, 9, 1, 5};\n        int n = arr.length;\n\n        quickSort(arr, 0, n - 1);\n\n        System.out.println(\"\u6392\u5e8f\u540e\u7684\u6570\u7ec4:\");\n        for (int i : arr) {\n            System.out.print(i + \" \");\n        }\n    }\n}\n</code></pre>"},{"location":"010Java/030Algorithm/#_4","title":"\u4ee3\u7801\u8bf4\u660e\uff1a","text":"<ol> <li>quickSort \u65b9\u6cd5\uff1a</li> <li>\u8fd9\u662f\u9012\u5f52\u5b9e\u73b0\u7684\u6838\u5fc3\u65b9\u6cd5\uff0c\u8d1f\u8d23\u5bf9\u6570\u7ec4\u8fdb\u884c\u6392\u5e8f\u3002</li> <li> <p><code>low</code> \u548c <code>high</code> \u5206\u522b\u8868\u793a\u5f53\u524d\u5b50\u6570\u7ec4\u7684\u8d77\u59cb\u548c\u7ed3\u675f\u7d22\u5f15\u3002</p> </li> <li> <p>partition \u65b9\u6cd5\uff1a</p> </li> <li>\u8be5\u65b9\u6cd5\u8d1f\u8d23\u5c06\u6570\u7ec4\u5206\u4e3a\u4e24\u90e8\u5206\uff0c\u5e76\u8fd4\u56de\u57fa\u51c6\u5143\u7d20\u7684\u6b63\u786e\u4f4d\u7f6e\u3002</li> <li> <p>\u9009\u62e9\u6700\u540e\u4e00\u4e2a\u5143\u7d20\u4f5c\u4e3a\u57fa\u51c6\uff08<code>pivot</code>\uff09\uff0c\u7136\u540e\u5c06\u5c0f\u4e8e\u7b49\u4e8e\u57fa\u51c6\u7684\u5143\u7d20\u653e\u5728\u5de6\u8fb9\uff0c\u5927\u4e8e\u57fa\u51c6\u7684\u5143\u7d20\u653e\u5728\u53f3\u8fb9\u3002</p> </li> <li> <p>main \u65b9\u6cd5\uff1a</p> </li> <li>\u8fd9\u662f\u7a0b\u5e8f\u7684\u5165\u53e3\uff0c\u521d\u59cb\u5316\u4e00\u4e2a\u6570\u7ec4\u5e76\u8c03\u7528 <code>quickSort</code> \u65b9\u6cd5\u8fdb\u884c\u6392\u5e8f\u3002</li> </ol>"},{"location":"010Java/030Algorithm/#_5","title":"\u603b\u7ed3\uff1a","text":"<p>\u5feb\u901f\u6392\u5e8f\u662f\u4e00\u79cd\u9ad8\u6548\u7684\u6392\u5e8f\u7b97\u6cd5\uff0c\u5c24\u5176\u9002\u7528\u4e8e\u5927\u89c4\u6a21\u6570\u636e\u96c6\u3002\u5b83\u7684\u5e73\u5747\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a O(n log n)\uff0c\u4f46\u5728\u6700\u574f\u60c5\u51b5\u4e0b\u4f1a\u9000\u5316\u4e3a O(n\u00b2)\u3002\u901a\u8fc7\u5408\u7406\u9009\u62e9\u57fa\u51c6\u5143\u7d20\uff0c\u53ef\u4ee5\u663e\u8457\u63d0\u9ad8\u7b97\u6cd5\u7684\u6027\u80fd\u3002</p>"},{"location":"010Java/030Algorithm/#_6","title":"\u5982\u4f55\u6df1\u523b\u8bb0\u4f4f\u5feb\u901f\u6392\u5e8f\u4ee3\u7801\uff0c\u4ee5\u53ca\u53ef\u80fd\u5b58\u5728\u7684\u53d8\u79cd\u7b97\u6cd5\u9898\uff1f","text":"\u7b54\u6848 <p>\u8981\u6df1\u523b\u8bb0\u4f4f\u5feb\u901f\u6392\u5e8f\u7684\u4ee3\u7801\u5e76\u638c\u63e1\u5176\u53d8\u79cd\u7b97\u6cd5\u9898\uff0c\u53ef\u4ee5\u4ece\u4ee5\u4e0b\u51e0\u4e2a\u65b9\u9762\u5165\u624b\uff1a</p>"},{"location":"010Java/030Algorithm/#1","title":"1. \u7406\u89e3\u6838\u5fc3\u601d\u60f3","text":"<p>\u5feb\u901f\u6392\u5e8f\u7684\u6838\u5fc3\u601d\u60f3\u662f \u5206\u6cbb\u6cd5 \u548c \u5206\u533a\u64cd\u4f5c\uff1a - \u5206\u6cbb\u6cd5\uff1a\u5c06\u95ee\u9898\u5206\u89e3\u4e3a\u66f4\u5c0f\u7684\u5b50\u95ee\u9898\uff0c\u9012\u5f52\u89e3\u51b3\u3002 - \u5206\u533a\u64cd\u4f5c\uff1a\u9009\u62e9\u4e00\u4e2a\u57fa\u51c6\u5143\u7d20\uff08pivot\uff09\uff0c\u5c06\u6570\u7ec4\u5206\u4e3a\u4e24\u90e8\u5206\uff0c\u5de6\u8fb9\u5c0f\u4e8e\u7b49\u4e8e\u57fa\u51c6\uff0c\u53f3\u8fb9\u5927\u4e8e\u57fa\u51c6\u3002</p> <p>\u5173\u952e\u70b9\uff1a - \u5206\u533a\u64cd\u4f5c\u662f\u5feb\u901f\u6392\u5e8f\u7684\u6838\u5fc3\u3002 - \u9012\u5f52\u5730\u5bf9\u5de6\u53f3\u4e24\u90e8\u5206\u8fdb\u884c\u6392\u5e8f\u3002</p>"},{"location":"010Java/030Algorithm/#2","title":"2. \u8bb0\u4f4f\u4ee3\u7801\u6a21\u677f","text":"<p>\u901a\u8fc7\u53cd\u590d\u7ec3\u4e60\u548c\u8bb0\u5fc6\u4ee3\u7801\u6a21\u677f\uff0c\u53ef\u4ee5\u52a0\u6df1\u5bf9\u5feb\u901f\u6392\u5e8f\u7684\u7406\u89e3\u3002\u4ee5\u4e0b\u662f Java \u7684\u7ecf\u5178\u5b9e\u73b0\uff1a</p> <pre><code>public class QuickSort {\n\n    public static void quickSort(int[] arr, int low, int high) {\n        if (low &lt; high) {\n            int pi = partition(arr, low, high); // \u5206\u533a\u64cd\u4f5c\n            quickSort(arr, low, pi - 1);  // \u9012\u5f52\u6392\u5e8f\u5de6\u534a\u90e8\u5206\n            quickSort(arr, pi + 1, high); // \u9012\u5f52\u6392\u5e8f\u53f3\u534a\u90e8\u5206\n        }\n    }\n\n    private static int partition(int[] arr, int low, int high) {\n        int pivot = arr[high]; // \u9009\u62e9\u6700\u540e\u4e00\u4e2a\u5143\u7d20\u4f5c\u4e3a\u57fa\u51c6\n        int i = low - 1; // \u8f83\u5c0f\u5143\u7d20\u7684\u7d22\u5f15\n\n        for (int j = low; j &lt; high; j++) {\n            if (arr[j] &lt;= pivot) {\n                i++;\n                swap(arr, i, j); // \u4ea4\u6362 arr[i] \u548c arr[j]\n            }\n        }\n        swap(arr, i + 1, high); // \u5c06\u57fa\u51c6\u5143\u7d20\u653e\u5230\u6b63\u786e\u4f4d\u7f6e\n        return i + 1;\n    }\n\n    private static void swap(int[] arr, int i, int j) {\n        int temp = arr[i];\n        arr[i] = arr[j];\n        arr[j] = temp;\n    }\n\n    public static void main(String[] args) {\n        int[] arr = {10, 7, 8, 9, 1, 5};\n        quickSort(arr, 0, arr.length - 1);\n        System.out.println(\"\u6392\u5e8f\u540e\u7684\u6570\u7ec4:\");\n        for (int num : arr) {\n            System.out.print(num + \" \");\n        }\n    }\n}\n</code></pre> <p>\u8bb0\u5fc6\u6280\u5de7\uff1a - \u5206\u533a\u64cd\u4f5c\uff1a\u8bb0\u4f4f <code>partition</code> \u65b9\u6cd5\u7684\u903b\u8f91\uff0c\u5c24\u5176\u662f <code>i</code> \u548c <code>j</code> \u7684\u4f5c\u7528\u3002 - \u9012\u5f52\u8c03\u7528\uff1a\u8bb0\u4f4f <code>quickSort</code> \u65b9\u6cd5\u7684\u9012\u5f52\u7ec8\u6b62\u6761\u4ef6\uff08<code>low &lt; high</code>\uff09\u3002 - \u57fa\u51c6\u9009\u62e9\uff1a\u901a\u5e38\u9009\u62e9\u6700\u540e\u4e00\u4e2a\u5143\u7d20\u4f5c\u4e3a\u57fa\u51c6\uff0c\u4f46\u53ef\u4ee5\u7075\u6d3b\u9009\u62e9\u5176\u4ed6\u5143\u7d20\u3002</p>"},{"location":"010Java/030Algorithm/#3","title":"3. \u638c\u63e1\u53d8\u79cd\u548c\u5e38\u89c1\u95ee\u9898","text":"<p>\u5feb\u901f\u6392\u5e8f\u7684\u53d8\u79cd\u548c\u884d\u751f\u95ee\u9898\u5f88\u591a\uff0c\u638c\u63e1\u8fd9\u4e9b\u53d8\u79cd\u53ef\u4ee5\u52a0\u6df1\u5bf9\u7b97\u6cd5\u7684\u7406\u89e3\u3002</p>"},{"location":"010Java/030Algorithm/#1_1","title":"\uff081\uff09\u968f\u673a\u5316\u5feb\u901f\u6392\u5e8f","text":"<ul> <li>\u95ee\u9898\uff1a\u5982\u679c\u6570\u7ec4\u5df2\u7ecf\u6709\u5e8f\uff0c\u9009\u62e9\u6700\u540e\u4e00\u4e2a\u5143\u7d20\u4f5c\u4e3a\u57fa\u51c6\u4f1a\u5bfc\u81f4\u6700\u574f\u60c5\u51b5\uff08O(n\u00b2)\uff09\u3002</li> <li>\u89e3\u51b3\u65b9\u6848\uff1a\u968f\u673a\u9009\u62e9\u57fa\u51c6\u5143\u7d20\u3002</li> <li>\u4ee3\u7801\u4fee\u6539\uff1a <pre><code>private static int partition(int[] arr, int low, int high) {\n    int randomIndex = low + (int) (Math.random() * (high - low + 1));\n    swap(arr, randomIndex, high); // \u5c06\u968f\u673a\u9009\u62e9\u7684\u5143\u7d20\u653e\u5230\u6700\u540e\n    int pivot = arr[high];\n    int i = low - 1;\n    for (int j = low; j &lt; high; j++) {\n        if (arr[j] &lt;= pivot) {\n            i++;\n            swap(arr, i, j);\n        }\n    }\n    swap(arr, i + 1, high);\n    return i + 1;\n}\n</code></pre></li> </ul>"},{"location":"010Java/030Algorithm/#2_1","title":"\uff082\uff09\u4e09\u8def\u5feb\u901f\u6392\u5e8f","text":"<ul> <li>\u95ee\u9898\uff1a\u5982\u679c\u6570\u7ec4\u4e2d\u6709\u5927\u91cf\u91cd\u590d\u5143\u7d20\uff0c\u666e\u901a\u5feb\u901f\u6392\u5e8f\u6548\u7387\u8f83\u4f4e\u3002</li> <li>\u89e3\u51b3\u65b9\u6848\uff1a\u5c06\u6570\u7ec4\u5206\u4e3a\u4e09\u90e8\u5206\uff08\u5c0f\u4e8e\u3001\u7b49\u4e8e\u3001\u5927\u4e8e\u57fa\u51c6\uff09\u3002</li> <li>\u4ee3\u7801\u5b9e\u73b0\uff1a <pre><code>public static void quickSort3Way(int[] arr, int low, int high) {\n    if (low &gt;= high) return;\n    int lt = low, gt = high;\n    int pivot = arr[low];\n    int i = low;\n    while (i &lt;= gt) {\n        if (arr[i] &lt; pivot) {\n            swap(arr, lt++, i++);\n        } else if (arr[i] &gt; pivot) {\n            swap(arr, i, gt--);\n        } else {\n            i++;\n        }\n    }\n    quickSort3Way(arr, low, lt - 1);\n    quickSort3Way(arr, gt + 1, high);\n}\n</code></pre></li> </ul>"},{"location":"010Java/030Algorithm/#3quickselect","title":"\uff083\uff09\u5feb\u901f\u9009\u62e9\u7b97\u6cd5\uff08Quickselect\uff09","text":"<ul> <li>\u95ee\u9898\uff1a\u627e\u5230\u6570\u7ec4\u4e2d\u7b2c k \u5c0f\u7684\u5143\u7d20\u3002</li> <li>\u89e3\u51b3\u65b9\u6848\uff1a\u57fa\u4e8e\u5feb\u901f\u6392\u5e8f\u7684\u5206\u533a\u64cd\u4f5c\uff0c\u53ea\u9012\u5f52\u5904\u7406\u5305\u542b\u7b2c k \u5143\u7d20\u7684\u90a3\u4e00\u90e8\u5206\u3002</li> <li>\u4ee3\u7801\u5b9e\u73b0\uff1a <pre><code>public static int quickSelect(int[] arr, int low, int high, int k) {\n    if (low == high) return arr[low];\n    int pi = partition(arr, low, high);\n    if (pi == k) {\n        return arr[pi];\n    } else if (pi &lt; k) {\n        return quickSelect(arr, pi + 1, high, k);\n    } else {\n        return quickSelect(arr, low, pi - 1, k);\n    }\n}\n</code></pre></li> </ul>"},{"location":"010Java/030Algorithm/#4","title":"4. \u591a\u7ec3\u4e60\u548c\u603b\u7ed3","text":"<ul> <li>\u624b\u5199\u4ee3\u7801\uff1a\u53cd\u590d\u624b\u5199\u5feb\u901f\u6392\u5e8f\u4ee3\u7801\uff0c\u76f4\u5230\u80fd\u591f\u719f\u7ec3\u5199\u51fa\u3002</li> <li>\u8c03\u8bd5\u4ee3\u7801\uff1a\u901a\u8fc7\u8c03\u8bd5\u5de5\u5177\u89c2\u5bdf\u5206\u533a\u64cd\u4f5c\u7684\u8fc7\u7a0b\uff0c\u52a0\u6df1\u7406\u89e3\u3002</li> <li>\u89e3\u51b3\u53d8\u79cd\u95ee\u9898\uff1a\u591a\u505a\u4e00\u4e9b\u4e0e\u5feb\u901f\u6392\u5e8f\u76f8\u5173\u7684\u7b97\u6cd5\u9898\uff0c\u4f8b\u5982\uff1a</li> <li>\u627e\u5230\u6570\u7ec4\u4e2d\u7b2c k \u5927\u7684\u5143\u7d20\u3002</li> <li>\u5bf9\u94fe\u8868\u8fdb\u884c\u5feb\u901f\u6392\u5e8f\u3002</li> <li>\u5904\u7406\u5305\u542b\u5927\u91cf\u91cd\u590d\u5143\u7d20\u7684\u6570\u7ec4\u3002</li> </ul>"},{"location":"010Java/030Algorithm/#5","title":"5. \u5e38\u89c1\u9762\u8bd5\u9898","text":"<p>\u4ee5\u4e0b\u662f\u4e00\u4e9b\u5e38\u89c1\u7684\u5feb\u901f\u6392\u5e8f\u53d8\u79cd\u95ee\u9898\uff1a 1. \u627e\u5230\u6570\u7ec4\u4e2d\u7b2c k \u5927\u7684\u5143\u7d20\u3002 2. \u5bf9\u94fe\u8868\u8fdb\u884c\u5feb\u901f\u6392\u5e8f\u3002 3. \u4e09\u8def\u5feb\u901f\u6392\u5e8f\u7684\u5b9e\u73b0\u3002 4. \u5feb\u901f\u6392\u5e8f\u7684\u975e\u9012\u5f52\u5b9e\u73b0\u3002 5. \u5feb\u901f\u6392\u5e8f\u7684\u7a33\u5b9a\u6027\u95ee\u9898\u3002</p>"},{"location":"010Java/030Algorithm/#_7","title":"\u603b\u7ed3","text":"<p>\u8981\u6df1\u523b\u8bb0\u4f4f\u5feb\u901f\u6392\u5e8f\u4ee3\u7801\u5e76\u638c\u63e1\u5176\u53d8\u79cd\uff0c\u9700\u8981\uff1a 1. \u7406\u89e3\u6838\u5fc3\u601d\u60f3\uff08\u5206\u6cbb\u6cd5\u548c\u5206\u533a\u64cd\u4f5c\uff09\u3002 2. \u8bb0\u4f4f\u4ee3\u7801\u6a21\u677f\uff0c\u5e76\u901a\u8fc7\u53cd\u590d\u7ec3\u4e60\u5de9\u56fa\u3002 3. \u638c\u63e1\u5e38\u89c1\u53d8\u79cd\uff08\u5982\u968f\u673a\u5316\u5feb\u901f\u6392\u5e8f\u3001\u4e09\u8def\u5feb\u901f\u6392\u5e8f\u3001\u5feb\u901f\u9009\u62e9\u7b97\u6cd5\uff09\u3002 4. \u591a\u7ec3\u4e60\u76f8\u5173\u7b97\u6cd5\u9898\uff0c\u603b\u7ed3\u89c4\u5f8b\u3002</p> <p>\u901a\u8fc7\u4ee5\u4e0a\u65b9\u6cd5\uff0c\u4f60\u53ef\u4ee5\u9010\u6b65\u638c\u63e1\u5feb\u901f\u6392\u5e8f\u53ca\u5176\u53d8\u79cd\uff0c\u5e76\u5728\u9762\u8bd5\u4e2d\u6e38\u5203\u6709\u4f59\uff01</p>"},{"location":"010Java/030Algorithm/#_8","title":"\u4e8c\u5206\u7b97\u6cd5\u5bf9\u6570\u636e\u6709\u4ec0\u4e48\u6761\u4ef6\uff1f","text":"\u7b54\u6848 <p>\u4e8c\u5206\u7b97\u6cd5\uff08\u4e8c\u5206\u67e5\u627e\uff09\u662f\u4e00\u79cd\u9ad8\u6548\u7684\u67e5\u627e\u7b97\u6cd5\uff0c\u9002\u7528\u4e8e\u6709\u5e8f\u6570\u7ec4\u6216\u5217\u8868\u3002\u5b83\u7684\u57fa\u672c\u601d\u60f3\u662f\u901a\u8fc7\u4e0d\u65ad\u5c06\u641c\u7d22\u8303\u56f4\u7f29\u5c0f\u4e00\u534a\u6765\u5feb\u901f\u5b9a\u4f4d\u76ee\u6807\u503c\u3002</p>"},{"location":"010Java/030Algorithm/#_9","title":"\u4e8c\u5206\u7b97\u6cd5\u7684\u6761\u4ef6","text":"<ol> <li>\u6570\u636e\u5fc5\u987b\u6709\u5e8f\uff1a\u4e8c\u5206\u67e5\u627e\u8981\u6c42\u6570\u636e\u662f\u6709\u5e8f\u7684\uff08\u5347\u5e8f\u6216\u964d\u5e8f\uff09\uff0c\u56e0\u4e3a\u7b97\u6cd5\u4f9d\u8d56\u4e8e\u4e2d\u95f4\u503c\u7684\u6bd4\u8f83\u6765\u7f29\u5c0f\u641c\u7d22\u8303\u56f4\u3002</li> <li>\u652f\u6301\u968f\u673a\u8bbf\u95ee\uff1a\u4e8c\u5206\u67e5\u627e\u9700\u8981\u80fd\u591f\u5feb\u901f\u8bbf\u95ee\u4efb\u610f\u4f4d\u7f6e\u7684\u5143\u7d20\uff0c\u56e0\u6b64\u9002\u7528\u4e8e\u6570\u7ec4\u6216\u7c7b\u4f3c\u6570\u636e\u7ed3\u6784\uff08\u5982 <code>ArrayList</code>\uff09\uff0c\u800c\u4e0d\u9002\u7528\u4e8e\u94fe\u8868\uff08\u5982 <code>LinkedList</code>\uff09\u3002</li> </ol>"},{"location":"010Java/030Algorithm/#java_1","title":"Java \u5b9e\u73b0\u4e8c\u5206\u67e5\u627e","text":"<p>\u4ee5\u4e0b\u662f\u4e00\u4e2a\u4f7f\u7528 Java \u5b9e\u73b0\u7684\u4e8c\u5206\u67e5\u627e\u4ee3\u7801\u793a\u4f8b\uff1a</p> <pre><code>public class BinarySearch {\n\n    /**\n     * \u4e8c\u5206\u67e5\u627e\u7b97\u6cd5\u5b9e\u73b0\n     *\n     * @param arr    \u6709\u5e8f\u6570\u7ec4\uff08\u5347\u5e8f\uff09\n     * @param target \u76ee\u6807\u503c\n     * @return \u76ee\u6807\u503c\u5728\u6570\u7ec4\u4e2d\u7684\u7d22\u5f15\uff0c\u5982\u679c\u672a\u627e\u5230\u5219\u8fd4\u56de -1\n     */\n    public static int binarySearch(int[] arr, int target) {\n        int left = 0;                  // \u5de6\u8fb9\u754c\n        int right = arr.length - 1;   // \u53f3\u8fb9\u754c\n\n        while (left &lt;= right) {\n            int mid = left + (right - left) / 2; // \u8ba1\u7b97\u4e2d\u95f4\u4f4d\u7f6e\uff0c\u907f\u514d\u6ea2\u51fa\n\n            if (arr[mid] == target) {\n                return mid; // \u627e\u5230\u76ee\u6807\u503c\uff0c\u8fd4\u56de\u7d22\u5f15\n            } else if (arr[mid] &lt; target) {\n                left = mid + 1; // \u76ee\u6807\u503c\u5728\u53f3\u534a\u90e8\u5206\uff0c\u8c03\u6574\u5de6\u8fb9\u754c\n            } else {\n                right = mid - 1; // \u76ee\u6807\u503c\u5728\u5de6\u534a\u90e8\u5206\uff0c\u8c03\u6574\u53f3\u8fb9\u754c\n            }\n        }\n\n        return -1; // \u672a\u627e\u5230\u76ee\u6807\u503c\n    }\n\n    public static void main(String[] args) {\n        int[] arr = {1, 3, 5, 7, 9, 11, 13, 15}; // \u6709\u5e8f\u6570\u7ec4\n        int target = 7; // \u76ee\u6807\u503c\n\n        int result = binarySearch(arr, target);\n\n        if (result != -1) {\n            System.out.println(\"\u76ee\u6807\u503c \" + target + \" \u5728\u6570\u7ec4\u4e2d\u7684\u7d22\u5f15\u4e3a: \" + result);\n        } else {\n            System.out.println(\"\u76ee\u6807\u503c \" + target + \" \u672a\u627e\u5230\");\n        }\n    }\n}\n</code></pre>"},{"location":"010Java/030Algorithm/#_10","title":"\u4ee3\u7801\u8bf4\u660e","text":"<ol> <li><code>binarySearch</code> \u65b9\u6cd5\uff1a</li> <li>\u53c2\u6570 <code>arr</code> \u662f\u4e00\u4e2a\u6709\u5e8f\u6570\u7ec4\uff08\u5347\u5e8f\uff09\u3002</li> <li>\u53c2\u6570 <code>target</code> \u662f\u8981\u67e5\u627e\u7684\u76ee\u6807\u503c\u3002</li> <li> <p>\u8fd4\u56de\u503c\u662f\u76ee\u6807\u503c\u5728\u6570\u7ec4\u4e2d\u7684\u7d22\u5f15\uff0c\u5982\u679c\u672a\u627e\u5230\u5219\u8fd4\u56de <code>-1</code>\u3002</p> </li> <li> <p><code>mid</code> \u7684\u8ba1\u7b97\uff1a</p> </li> <li> <p>\u4f7f\u7528 <code>left + (right - left) / 2</code> \u8ba1\u7b97\u4e2d\u95f4\u4f4d\u7f6e\uff0c\u907f\u514d\u76f4\u63a5\u4f7f\u7528 <code>(left + right) / 2</code> \u53ef\u80fd\u5bfc\u81f4\u7684\u6574\u6570\u6ea2\u51fa\u95ee\u9898\u3002</p> </li> <li> <p>\u5faa\u73af\u6761\u4ef6\uff1a</p> </li> <li><code>left &lt;= right</code> \u786e\u4fdd\u641c\u7d22\u8303\u56f4\u6709\u6548\u3002</li> <li>\u5982\u679c <code>arr[mid] == target</code>\uff0c\u5219\u627e\u5230\u76ee\u6807\u503c\u3002</li> <li>\u5982\u679c <code>arr[mid] &lt; target</code>\uff0c\u8bf4\u660e\u76ee\u6807\u503c\u5728\u53f3\u534a\u90e8\u5206\uff0c\u8c03\u6574\u5de6\u8fb9\u754c <code>left = mid + 1</code>\u3002</li> <li> <p>\u5982\u679c <code>arr[mid] &gt; target</code>\uff0c\u8bf4\u660e\u76ee\u6807\u503c\u5728\u5de6\u534a\u90e8\u5206\uff0c\u8c03\u6574\u53f3\u8fb9\u754c <code>right = mid - 1</code>\u3002</p> </li> <li> <p>\u672a\u627e\u5230\u76ee\u6807\u503c\uff1a</p> </li> <li>\u5982\u679c\u5faa\u73af\u7ed3\u675f\u4ecd\u672a\u627e\u5230\u76ee\u6807\u503c\uff0c\u8fd4\u56de <code>-1</code>\u3002</li> </ol>"},{"location":"010Java/030Algorithm/#_11","title":"\u793a\u4f8b\u8f93\u51fa","text":"<p>\u5bf9\u4e8e\u4e0a\u8ff0\u4ee3\u7801\uff0c\u8f93\u51fa\u7ed3\u679c\u4e3a\uff1a <pre><code>\u76ee\u6807\u503c 7 \u5728\u6570\u7ec4\u4e2d\u7684\u7d22\u5f15\u4e3a: 3\n</code></pre></p>"},{"location":"010Java/030Algorithm/#_12","title":"\u65f6\u95f4\u590d\u6742\u5ea6","text":"<ul> <li>\u4e8c\u5206\u67e5\u627e\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a O(log n)\uff0c\u5176\u4e2d <code>n</code> \u662f\u6570\u7ec4\u7684\u957f\u5ea6\u3002\u8fd9\u662f\u56e0\u4e3a\u6bcf\u6b21\u67e5\u627e\u90fd\u5c06\u641c\u7d22\u8303\u56f4\u7f29\u5c0f\u4e00\u534a\u3002</li> </ul>"},{"location":"010Java/030Algorithm/#_13","title":"\u6ce8\u610f\u4e8b\u9879","text":"<ol> <li>\u5982\u679c\u6570\u7ec4\u662f\u964d\u5e8f\u6392\u5217\u7684\uff0c\u9700\u8981\u8c03\u6574\u6bd4\u8f83\u903b\u8f91\u3002</li> <li>\u5982\u679c\u6570\u7ec4\u4e2d\u6709\u91cd\u590d\u5143\u7d20\uff0c\u4e8c\u5206\u67e5\u627e\u53ef\u80fd\u8fd4\u56de\u4efb\u610f\u4e00\u4e2a\u5339\u914d\u5143\u7d20\u7684\u7d22\u5f15\u3002\u5982\u679c\u9700\u8981\u67e5\u627e\u7b2c\u4e00\u4e2a\u6216\u6700\u540e\u4e00\u4e2a\u5339\u914d\u5143\u7d20\uff0c\u53ef\u4ee5\u8fdb\u4e00\u6b65\u4f18\u5316\u7b97\u6cd5\u3002</li> </ol>"},{"location":"010Java/030Algorithm/#_14","title":"\u5982\u4f55\u6df1\u523b\u8bb0\u4f4f\u4e8c\u5206\u7b97\u6cd5\u7684\u4ee3\u7801\uff0c\u4ee5\u53ca\u53ef\u80fd\u5b58\u5728\u7684\u53d8\u79cd\u7b97\u6cd5\u9898\uff1f","text":"\u7b54\u6848 <p>\u8981\u6df1\u523b\u8bb0\u4f4f\u4e8c\u5206\u7b97\u6cd5\u7684\u4ee3\u7801\u5e76\u638c\u63e1\u5176\u53d8\u79cd\uff0c\u5173\u952e\u5728\u4e8e\u7406\u89e3\u5176\u6838\u5fc3\u601d\u60f3\u3001\u638c\u63e1\u5e38\u89c1\u53d8\u79cd\u573a\u666f\uff0c\u5e76\u901a\u8fc7\u5927\u91cf\u7ec3\u4e60\u5de9\u56fa\u8bb0\u5fc6\u3002\u4ee5\u4e0b\u662f\u5177\u4f53\u7684\u5b66\u4e60\u65b9\u6cd5\u548c\u6280\u5de7\uff1a</p>"},{"location":"010Java/030Algorithm/#_15","title":"\u4e00\u3001\u7406\u89e3\u4e8c\u5206\u7b97\u6cd5\u7684\u6838\u5fc3\u601d\u60f3","text":"<ol> <li>\u6838\u5fc3\u601d\u60f3\uff1a</li> <li>\u4e8c\u5206\u7b97\u6cd5\u901a\u8fc7\u4e0d\u65ad\u5c06\u641c\u7d22\u8303\u56f4\u7f29\u5c0f\u4e00\u534a\u6765\u5feb\u901f\u5b9a\u4f4d\u76ee\u6807\u503c\u3002</li> <li> <p>\u5b83\u4f9d\u8d56\u4e8e\u6570\u636e\u7684\u6709\u5e8f\u6027\u548c\u4e2d\u95f4\u503c\u7684\u6bd4\u8f83\u3002</p> </li> <li> <p>\u5173\u952e\u70b9\uff1a</p> </li> <li>\u6709\u5e8f\u6027\uff1a\u6570\u636e\u5fc5\u987b\u6709\u5e8f\uff08\u5347\u5e8f\u6216\u964d\u5e8f\uff09\u3002</li> <li>\u4e2d\u95f4\u503c\uff1a\u901a\u8fc7\u4e2d\u95f4\u503c\u5c06\u641c\u7d22\u8303\u56f4\u5206\u4e3a\u4e24\u90e8\u5206\u3002</li> <li> <p>\u8fb9\u754c\u8c03\u6574\uff1a\u6839\u636e\u6bd4\u8f83\u7ed3\u679c\u8c03\u6574\u5de6\u8fb9\u754c\u6216\u53f3\u8fb9\u754c\u3002</p> </li> <li> <p>\u4ee3\u7801\u6a21\u677f\uff1a <pre><code>int left = 0, right = arr.length - 1;\nwhile (left &lt;= right) {\n    int mid = left + (right - left) / 2;\n    if (arr[mid] == target) {\n        return mid; // \u627e\u5230\u76ee\u6807\u503c\n    } else if (arr[mid] &lt; target) {\n        left = mid + 1; // \u76ee\u6807\u503c\u5728\u53f3\u534a\u90e8\u5206\n    } else {\n        right = mid - 1; // \u76ee\u6807\u503c\u5728\u5de6\u534a\u90e8\u5206\n    }\n}\nreturn -1; // \u672a\u627e\u5230\u76ee\u6807\u503c\n</code></pre></p> </li> </ol>"},{"location":"010Java/030Algorithm/#_16","title":"\u4e8c\u3001\u8bb0\u5fc6\u4ee3\u7801\u7684\u6280\u5de7","text":"<ol> <li>\u7406\u89e3\u6bcf\u4e00\u884c\u4ee3\u7801\u7684\u4f5c\u7528\uff1a</li> <li><code>left</code> \u548c <code>right</code> \u8868\u793a\u5f53\u524d\u641c\u7d22\u8303\u56f4\u7684\u5de6\u53f3\u8fb9\u754c\u3002</li> <li><code>mid</code> \u662f\u4e2d\u95f4\u4f4d\u7f6e\uff0c\u901a\u8fc7 <code>left + (right - left) / 2</code> \u8ba1\u7b97\uff0c\u907f\u514d\u6ea2\u51fa\u3002</li> <li> <p><code>arr[mid]</code> \u4e0e <code>target</code> \u7684\u6bd4\u8f83\u51b3\u5b9a\u5982\u4f55\u8c03\u6574\u8fb9\u754c\u3002</p> </li> <li> <p>\u753b\u56fe\u8f85\u52a9\u7406\u89e3\uff1a</p> </li> <li>\u753b\u4e00\u4e2a\u6709\u5e8f\u6570\u7ec4\uff0c\u6807\u6ce8 <code>left</code>\u3001<code>right</code> \u548c <code>mid</code> \u7684\u4f4d\u7f6e\u3002</li> <li> <p>\u6a21\u62df\u4e8c\u5206\u67e5\u627e\u7684\u8fc7\u7a0b\uff0c\u7406\u89e3\u6bcf\u4e00\u6b65\u7684\u53d8\u5316\u3002</p> </li> <li> <p>\u53cd\u590d\u7ec3\u4e60\uff1a</p> </li> <li>\u624b\u5199\u4ee3\u7801\u591a\u6b21\uff0c\u76f4\u5230\u80fd\u591f\u4e0d\u4f9d\u8d56\u53c2\u8003\u5199\u51fa\u5b8c\u6574\u4ee3\u7801\u3002</li> <li>\u5728 LeetCode \u6216\u7c7b\u4f3c\u5e73\u53f0\u4e0a\u7ec3\u4e60\u4e8c\u5206\u67e5\u627e\u7684\u57fa\u7840\u9898\u76ee\u3002</li> </ol>"},{"location":"010Java/030Algorithm/#_17","title":"\u4e09\u3001\u4e8c\u5206\u7b97\u6cd5\u7684\u5e38\u89c1\u53d8\u79cd","text":"<p>\u4e8c\u5206\u7b97\u6cd5\u7684\u53d8\u79cd\u901a\u5e38\u56f4\u7ed5\u4ee5\u4e0b\u573a\u666f\u5c55\u5f00\uff1a</p>"},{"location":"010Java/030Algorithm/#1_2","title":"1. \u67e5\u627e\u7b2c\u4e00\u4e2a\u7b49\u4e8e\u76ee\u6807\u503c\u7684\u5143\u7d20","text":"<ul> <li>\u573a\u666f\uff1a\u6570\u7ec4\u4e2d\u6709\u91cd\u590d\u5143\u7d20\uff0c\u627e\u5230\u7b2c\u4e00\u4e2a\u7b49\u4e8e\u76ee\u6807\u503c\u7684\u7d22\u5f15\u3002</li> <li>\u4ee3\u7801\uff1a     <pre><code>public int findFirst(int[] arr, int target) {\n    int left = 0, right = arr.length - 1;\n    while (left &lt;= right) {\n        int mid = left + (right - left) / 2;\n        if (arr[mid] &gt;= target) {\n            right = mid - 1;\n        } else {\n            left = mid + 1;\n        }\n    }\n    if (left &lt; arr.length &amp;&amp; arr[left] == target) {\n        return left;\n    }\n    return -1;\n}\n</code></pre></li> </ul>"},{"location":"010Java/030Algorithm/#2_2","title":"2. \u67e5\u627e\u6700\u540e\u4e00\u4e2a\u7b49\u4e8e\u76ee\u6807\u503c\u7684\u5143\u7d20","text":"<ul> <li>\u573a\u666f\uff1a\u6570\u7ec4\u4e2d\u6709\u91cd\u590d\u5143\u7d20\uff0c\u627e\u5230\u6700\u540e\u4e00\u4e2a\u7b49\u4e8e\u76ee\u6807\u503c\u7684\u7d22\u5f15\u3002</li> <li>\u4ee3\u7801\uff1a     <pre><code>public int findLast(int[] arr, int target) {\n    int left = 0, right = arr.length - 1;\n    while (left &lt;= right) {\n        int mid = left + (right - left) / 2;\n        if (arr[mid] &lt;= target) {\n            left = mid + 1;\n        } else {\n            right = mid - 1;\n        }\n    }\n    if (right &gt;= 0 &amp;&amp; arr[right] == target) {\n        return right;\n    }\n    return -1;\n}\n</code></pre></li> </ul>"},{"location":"010Java/030Algorithm/#3_1","title":"3. \u67e5\u627e\u7b2c\u4e00\u4e2a\u5927\u4e8e\u7b49\u4e8e\u76ee\u6807\u503c\u7684\u5143\u7d20","text":"<ul> <li>\u573a\u666f\uff1a\u627e\u5230\u7b2c\u4e00\u4e2a\u5927\u4e8e\u6216\u7b49\u4e8e\u76ee\u6807\u503c\u7684\u5143\u7d20\uff08\u53ef\u7528\u4e8e\u63d2\u5165\u4f4d\u7f6e\uff09\u3002</li> <li>\u4ee3\u7801\uff1a     <pre><code>public int findFirstGreaterOrEqual(int[] arr, int target) {\n    int left = 0, right = arr.length - 1;\n    while (left &lt;= right) {\n        int mid = left + (right - left) / 2;\n        if (arr[mid] &gt;= target) {\n            right = mid - 1;\n        } else {\n            left = mid + 1;\n        }\n    }\n    return left;\n}\n</code></pre></li> </ul>"},{"location":"010Java/030Algorithm/#4_1","title":"4. \u67e5\u627e\u6700\u540e\u4e00\u4e2a\u5c0f\u4e8e\u7b49\u4e8e\u76ee\u6807\u503c\u7684\u5143\u7d20","text":"<ul> <li>\u573a\u666f\uff1a\u627e\u5230\u6700\u540e\u4e00\u4e2a\u5c0f\u4e8e\u6216\u7b49\u4e8e\u76ee\u6807\u503c\u7684\u5143\u7d20\u3002</li> <li>\u4ee3\u7801\uff1a     <pre><code>public int findLastLessOrEqual(int[] arr, int target) {\n    int left = 0, right = arr.length - 1;\n    while (left &lt;= right) {\n        int mid = left + (right - left) / 2;\n        if (arr[mid] &lt;= target) {\n            left = mid + 1;\n        } else {\n            right = mid - 1;\n        }\n    }\n    return right;\n}\n</code></pre></li> </ul>"},{"location":"010Java/030Algorithm/#_18","title":"\u56db\u3001\u7ec3\u4e60\u53d8\u79cd\u9898\u76ee","text":"<p>\u901a\u8fc7\u4ee5\u4e0b\u9898\u76ee\u5de9\u56fa\u4e8c\u5206\u7b97\u6cd5\u7684\u53d8\u79cd\uff1a 1. LeetCode 34. \u5728\u6392\u5e8f\u6570\u7ec4\u4e2d\u67e5\u627e\u5143\u7d20\u7684\u7b2c\u4e00\u4e2a\u548c\u6700\u540e\u4e00\u4e2a\u4f4d\u7f6e - \u9898\u76ee\u94fe\u63a5\uff1aLeetCode 34 - \u89e3\u6cd5\uff1a\u7ed3\u5408 <code>findFirst</code> \u548c <code>findLast</code>\u3002</p> <ol> <li>LeetCode 35. \u641c\u7d22\u63d2\u5165\u4f4d\u7f6e</li> <li>\u9898\u76ee\u94fe\u63a5\uff1aLeetCode 35</li> <li> <p>\u89e3\u6cd5\uff1a\u4f7f\u7528 <code>findFirstGreaterOrEqual</code>\u3002</p> </li> <li> <p>LeetCode 704. \u4e8c\u5206\u67e5\u627e</p> </li> <li>\u9898\u76ee\u94fe\u63a5\uff1aLeetCode 704</li> <li> <p>\u89e3\u6cd5\uff1a\u6807\u51c6\u4e8c\u5206\u67e5\u627e\u3002</p> </li> <li> <p>LeetCode 278. \u7b2c\u4e00\u4e2a\u9519\u8bef\u7684\u7248\u672c</p> </li> <li>\u9898\u76ee\u94fe\u63a5\uff1aLeetCode 278</li> <li>\u89e3\u6cd5\uff1a\u67e5\u627e\u7b2c\u4e00\u4e2a\u6ee1\u8db3\u6761\u4ef6\u7684\u5143\u7d20\u3002</li> </ol>"},{"location":"010Java/030Algorithm/#_19","title":"\u4e94\u3001\u603b\u7ed3","text":"<ol> <li>\u7406\u89e3\u6838\u5fc3\u601d\u60f3\uff1a\u4e8c\u5206\u7b97\u6cd5\u7684\u6838\u5fc3\u662f\u901a\u8fc7\u4e2d\u95f4\u503c\u6bd4\u8f83\u7f29\u5c0f\u641c\u7d22\u8303\u56f4\u3002</li> <li>\u8bb0\u5fc6\u4ee3\u7801\u6a21\u677f\uff1a\u638c\u63e1\u6807\u51c6\u4e8c\u5206\u67e5\u627e\u7684\u4ee3\u7801\u6a21\u677f\uff0c\u7406\u89e3\u6bcf\u4e00\u884c\u4ee3\u7801\u7684\u4f5c\u7528\u3002</li> <li>\u638c\u63e1\u53d8\u79cd\u573a\u666f\uff1a\u901a\u8fc7\u7ec3\u4e60\u5e38\u89c1\u53d8\u79cd\u9898\u76ee\uff0c\u719f\u6089\u4e0d\u540c\u573a\u666f\u4e0b\u7684\u8fb9\u754c\u8c03\u6574\u3002</li> <li>\u591a\u7ec3\u4e60\uff1a\u5728 LeetCode \u6216\u5176\u4ed6\u5e73\u53f0\u4e0a\u5927\u91cf\u7ec3\u4e60\u4e8c\u5206\u67e5\u627e\u76f8\u5173\u9898\u76ee\uff0c\u5de9\u56fa\u8bb0\u5fc6\u3002</li> </ol> <p>\u901a\u8fc7\u4ee5\u4e0a\u65b9\u6cd5\uff0c\u4f60\u53ef\u4ee5\u6df1\u523b\u8bb0\u4f4f\u4e8c\u5206\u7b97\u6cd5\u7684\u4ee3\u7801\uff0c\u5e76\u80fd\u591f\u7075\u6d3b\u5e94\u5bf9\u5404\u79cd\u53d8\u79cd\u9898\u76ee\uff01</p>"},{"location":"010Java/030Algorithm/#_20","title":"\u53cd\u8f6c\u94fe\u8868","text":"\u7b54\u6848"},{"location":"010Java/030Algorithm/#java_2","title":"\u53cd\u8f6c\u94fe\u8868\u7684Java\u5b9e\u73b0","text":"<p>\u5728Java\u4e2d\uff0c\u53cd\u8f6c\u94fe\u8868\u53ef\u4ee5\u901a\u8fc7\u8fed\u4ee3\u6216\u9012\u5f52\u7684\u65b9\u5f0f\u5b9e\u73b0\u3002\u4ee5\u4e0b\u662f\u4e24\u79cd\u65b9\u6cd5\u7684\u793a\u4f8b\u4ee3\u7801\uff1a</p>"},{"location":"010Java/030Algorithm/#1_3","title":"1. \u8fed\u4ee3\u6cd5","text":"<pre><code>class ListNode {\n    int val;\n    ListNode next;\n    ListNode(int x) { val = x; }\n}\n\npublic class Solution {\n    public ListNode reverseList(ListNode head) {\n        ListNode prev = null;\n        ListNode curr = head;\n        while (curr != null) {\n            ListNode nextTemp = curr.next;\n            curr.next = prev;\n            prev = curr;\n            curr = nextTemp;\n        }\n        return prev;\n    }\n}\n</code></pre>"},{"location":"010Java/030Algorithm/#2_3","title":"2. \u9012\u5f52\u6cd5","text":"<pre><code>class ListNode {\n    int val;\n    ListNode next;\n    ListNode(int x) { val = x; }\n}\n\npublic class Solution {\n    public ListNode reverseList(ListNode head) {\n        if (head == null || head.next == null) {\n            return head;\n        }\n        ListNode p = reverseList(head.next);\n        head.next.next = head;\n        head.next = null;\n        return p;\n    }\n}\n</code></pre>"},{"location":"010Java/030Algorithm/#_21","title":"\u5982\u4f55\u6df1\u523b\u8bb0\u4f4f\u53cd\u8f6c\u94fe\u8868\u7684\u5b9e\u73b0","text":"<ol> <li> <p>\u7406\u89e3\u94fe\u8868\u7ed3\u6784\uff1a\u94fe\u8868\u7531\u8282\u70b9\u7ec4\u6210\uff0c\u6bcf\u4e2a\u8282\u70b9\u5305\u542b\u6570\u636e\u548c\u6307\u5411\u4e0b\u4e00\u4e2a\u8282\u70b9\u7684\u6307\u9488\u3002\u53cd\u8f6c\u94fe\u8868\u7684\u6838\u5fc3\u662f\u6539\u53d8\u6307\u9488\u7684\u65b9\u5411\u3002</p> </li> <li> <p>\u8fed\u4ee3\u6cd5\u7684\u6b65\u9aa4\uff1a</p> </li> <li>\u521d\u59cb\u5316\u4e24\u4e2a\u6307\u9488\uff1a<code>prev</code>\uff08\u524d\u4e00\u4e2a\u8282\u70b9\uff09\u548c<code>curr</code>\uff08\u5f53\u524d\u8282\u70b9\uff09\u3002</li> <li>\u904d\u5386\u94fe\u8868\uff0c\u6bcf\u6b21\u5c06\u5f53\u524d\u8282\u70b9\u7684<code>next</code>\u6307\u9488\u6307\u5411<code>prev</code>\u3002</li> <li>\u66f4\u65b0<code>prev</code>\u548c<code>curr</code>\uff0c\u76f4\u5230\u904d\u5386\u5b8c\u6574\u4e2a\u94fe\u8868\u3002</li> <li> <p>\u6700\u540e\uff0c<code>prev</code>\u5c31\u662f\u53cd\u8f6c\u540e\u7684\u94fe\u8868\u5934\u3002</p> </li> <li> <p>\u9012\u5f52\u6cd5\u7684\u6b65\u9aa4\uff1a</p> </li> <li>\u9012\u5f52\u5230\u94fe\u8868\u7684\u6700\u540e\u4e00\u4e2a\u8282\u70b9\uff0c\u7136\u540e\u5f00\u59cb\u53cd\u8f6c\u3002</li> <li>\u6bcf\u6b21\u9012\u5f52\u8fd4\u56de\u65f6\uff0c\u5c06\u5f53\u524d\u8282\u70b9\u7684<code>next</code>\u8282\u70b9\u7684<code>next</code>\u6307\u9488\u6307\u5411\u5f53\u524d\u8282\u70b9\u3002</li> <li>\u5c06\u5f53\u524d\u8282\u70b9\u7684<code>next</code>\u6307\u9488\u7f6e\u4e3a<code>null</code>\uff0c\u907f\u514d\u5faa\u73af\u3002</li> <li> <p>\u9012\u5f52\u7ed3\u675f\u540e\uff0c\u8fd4\u56de\u65b0\u7684\u94fe\u8868\u5934\u3002</p> </li> <li> <p>\u591a\u7ec3\u4e60\uff1a\u901a\u8fc7\u591a\u6b21\u7f16\u5199\u548c\u8c03\u8bd5\u4ee3\u7801\uff0c\u52a0\u6df1\u5bf9\u53cd\u8f6c\u94fe\u8868\u8fc7\u7a0b\u7684\u7406\u89e3\u3002</p> </li> <li> <p>\u753b\u56fe\u8f85\u52a9\uff1a\u5728\u7eb8\u4e0a\u753b\u51fa\u94fe\u8868\u7684\u7ed3\u6784\uff0c\u6a21\u62df\u53cd\u8f6c\u8fc7\u7a0b\uff0c\u5e2e\u52a9\u7406\u89e3\u6307\u9488\u7684\u53d8\u5316\u3002</p> </li> <li> <p>\u603b\u7ed3\u89c4\u5f8b\uff1a\u65e0\u8bba\u662f\u8fed\u4ee3\u8fd8\u662f\u9012\u5f52\uff0c\u53cd\u8f6c\u94fe\u8868\u7684\u6838\u5fc3\u90fd\u662f\u6539\u53d8\u6307\u9488\u7684\u65b9\u5411\u3002\u638c\u63e1\u8fd9\u4e00\u70b9\uff0c\u5c31\u80fd\u8f7b\u677e\u5e94\u5bf9\u7c7b\u4f3c\u95ee\u9898\u3002</p> </li> </ol> <p>\u901a\u8fc7\u4ee5\u4e0a\u65b9\u6cd5\uff0c\u4f60\u53ef\u4ee5\u6df1\u523b\u8bb0\u4f4f\u5e76\u638c\u63e1\u53cd\u8f6c\u94fe\u8868\u7684\u5b9e\u73b0\u3002</p>"},{"location":"010Java/030Algorithm/#_22","title":"\u9012\u5f52\u8fc7\u7a0b\u53ef\u89c6\u5316","text":"<p>\u5047\u8bbe\u94fe\u8868\u4e3a\uff1a1 \u2192 2 \u2192 3 \u2192 4 \u2192 5 \u2192 null</p> <p>\u9012\u5f52\u8c03\u7528\u6808\uff1a <pre><code>- reverseList(1)\n   - reverseList(2)\n     - reverseList(3)\n       - reverseList(4)\n         - reverseList(5) \u2192 \u76f4\u63a5\u8fd4\u56de5 (\u56e0\u4e3a5.next == null)\n       - \u73b0\u5728head=4, p=5\n       - 4.next.next=4 (\u53735.next=4)\n       - 4.next=null\n       - \u8fd4\u56dep=5 (\u94fe\u8868\uff1a5\u21924\u2192null)\n     - head=3, p=5\n     - 3.next.next=3 (\u53734.next=3)\n     - 3.next=null\n     - \u8fd4\u56dep=5 (\u94fe\u8868\uff1a5\u21924\u21923\u2192null)\n   - head=2, p=5\n   - 2.next.next=2 (\u53733.next=2)\n   - 2.next=null\n   - \u8fd4\u56dep=5 (\u94fe\u8868\uff1a5\u21924\u21923\u21922\u2192null)\n - head=1, p=5\n - 1.next.next=1 (\u53732.next=1)\n - 1.next=null\n - \u8fd4\u56dep=5 (\u94fe\u8868\uff1a5\u21924\u21923\u21922\u21921\u2192null)\n</code></pre></p>"},{"location":"010Java/030Algorithm/#_23","title":"\u5173\u952e\u70b9\u8bf4\u660e","text":"<ol> <li>\u9012\u5f52\u7ec8\u6b62\u6761\u4ef6\uff1a\u5f53\u94fe\u8868\u4e3a\u7a7a\u6216\u53ea\u6709\u4e00\u4e2a\u8282\u70b9\u65f6\uff0c\u4e0d\u9700\u8981\u53cd\u8f6c\uff0c\u76f4\u63a5\u8fd4\u56de</li> <li>\u9012\u5f52\u6b65\u9aa4\uff1a\u5148\u53cd\u8f6c\u5269\u4f59\u94fe\u8868\uff08head.next\u4e4b\u540e\u7684\u90e8\u5206\uff09</li> <li>\u53cd\u8f6c\u64cd\u4f5c\uff1a</li> <li><code>head.next.next = head</code>\uff1a\u8ba9\u4e0b\u4e00\u4e2a\u8282\u70b9\u6307\u5411\u5f53\u524d\u8282\u70b9</li> <li><code>head.next = null</code>\uff1a\u65ad\u5f00\u5f53\u524d\u8282\u70b9\u539f\u6765\u7684\u6307\u5411</li> <li>\u8fd4\u56de\u503c\uff1a\u59cb\u7ec8\u8fd4\u56de\u65b0\u7684\u5934\u8282\u70b9\uff08\u539f\u94fe\u8868\u7684\u5c3e\u8282\u70b9\uff09</li> </ol>"},{"location":"010Java/030Algorithm/#_24","title":"\u65f6\u95f4\u590d\u6742\u5ea6\u5206\u6790","text":"<ul> <li>\u65f6\u95f4\u590d\u6742\u5ea6\uff1aO(n)\uff0c\u9700\u8981\u904d\u5386\u6bcf\u4e2a\u8282\u70b9\u4e00\u6b21</li> <li>\u7a7a\u95f4\u590d\u6742\u5ea6\uff1aO(n)\uff0c\u9012\u5f52\u8c03\u7528\u6808\u7684\u6df1\u5ea6\u7b49\u4e8e\u94fe\u8868\u957f\u5ea6</li> </ul> <p>\u8fd9\u79cd\u9012\u5f52\u65b9\u6cd5\u867d\u7136\u7b80\u6d01\uff0c\u4f46\u5bf9\u4e8e\u957f\u94fe\u8868\u53ef\u80fd\u4f1a\u5bfc\u81f4\u6808\u6ea2\u51fa\u3002\u5728\u5b9e\u9645\u5e94\u7528\u4e2d\uff0c\u8fed\u4ee3\u6cd5\u53ef\u80fd\u662f\u66f4\u597d\u7684\u9009\u62e9\u3002</p>"},{"location":"010Java/030Algorithm/#_25","title":"\u5c06\u4e24\u4e2a\u6709\u5e8f\u7684\u94fe\u8868\u5408\u5e76\u6210\u4e00\u4e2a\u6709\u5e8f\u7684\u94fe\u8868\uff0c\u9012\u5f52\u548c\u5faa\u73af\u4e24\u4e2d\u65b9\u5f0f","text":"\u7b54\u6848"},{"location":"010Java/030Algorithm/#_26","title":"\u5408\u5e76\u4e24\u4e2a\u6709\u5e8f\u94fe\u8868","text":"<p>\u4e0b\u9762\u6211\u5c06\u7528Java\u5b9e\u73b0\u5408\u5e76\u4e24\u4e2a\u6709\u5e8f\u94fe\u8868\u7684\u9012\u5f52\u548c\u5faa\u73af\u4e24\u79cd\u65b9\u5f0f\u3002</p>"},{"location":"010Java/030Algorithm/#_27","title":"\u94fe\u8868\u8282\u70b9\u5b9a\u4e49","text":"<p>\u9996\u5148\u5b9a\u4e49\u94fe\u8868\u8282\u70b9\u7c7b\uff1a</p> <pre><code>class ListNode {\n    int val;\n    ListNode next;\n\n    ListNode(int val) {\n        this.val = val;\n    }\n\n    ListNode(int val, ListNode next) {\n        this.val = val;\n        this.next = next;\n    }\n}\n</code></pre>"},{"location":"010Java/030Algorithm/#1_4","title":"1. \u9012\u5f52\u65b9\u5f0f","text":"<pre><code>public ListNode mergeTwoListsRecursive(ListNode l1, ListNode l2) {\n    if (l1 == null) {\n        return l2;\n    }\n    if (l2 == null) {\n        return l1;\n    }\n\n    if (l1.val &lt; l2.val) {\n        l1.next = mergeTwoListsRecursive(l1.next, l2);\n        return l1;\n    } else {\n        l2.next = mergeTwoListsRecursive(l1, l2.next);\n        return l2;\n    }\n}\n</code></pre>"},{"location":"010Java/030Algorithm/#2_4","title":"2. \u5faa\u73af\u65b9\u5f0f","text":"<pre><code>public ListNode mergeTwoListsIterative(ListNode l1, ListNode l2) {\n    // \u521b\u5efa\u4e00\u4e2a\u54d1\u8282\u70b9\u4f5c\u4e3a\u7ed3\u679c\u94fe\u8868\u7684\u8d77\u59cb\u70b9\n    ListNode dummy = new ListNode(-1);\n    ListNode current = dummy;\n\n    while (l1 != null &amp;&amp; l2 != null) {\n        if (l1.val &lt; l2.val) {\n            current.next = l1;\n            l1 = l1.next;\n        } else {\n            current.next = l2;\n            l2 = l2.next;\n        }\n        current = current.next;\n    }\n\n    // \u5904\u7406\u5269\u4f59\u8282\u70b9\n    current.next = (l1 != null) ? l1 : l2;\n\n    return dummy.next;\n}\n</code></pre>"},{"location":"010Java/030Algorithm/#_28","title":"\u6d4b\u8bd5\u4ee3\u7801","text":"<pre><code>public class Main {\n    public static void main(String[] args) {\n        // \u521b\u5efa\u94fe\u88681: 1-&gt;3-&gt;5\n        ListNode l1 = new ListNode(1);\n        l1.next = new ListNode(3);\n        l1.next.next = new ListNode(5);\n\n        // \u521b\u5efa\u94fe\u88682: 2-&gt;4-&gt;6\n        ListNode l2 = new ListNode(2);\n        l2.next = new ListNode(4);\n        l2.next.next = new ListNode(6);\n\n        Solution solution = new Solution();\n\n        // \u6d4b\u8bd5\u9012\u5f52\u65b9\u5f0f\n        ListNode mergedRecursive = solution.mergeTwoListsRecursive(l1, l2);\n        printList(mergedRecursive);\n\n        // \u91cd\u65b0\u521b\u5efa\u94fe\u8868\u7528\u4e8e\u6d4b\u8bd5\u5faa\u73af\u65b9\u5f0f\n        l1 = new ListNode(1, new ListNode(3, new ListNode(5)));\n        l2 = new ListNode(2, new ListNode(4, new ListNode(6)));\n\n        // \u6d4b\u8bd5\u5faa\u73af\u65b9\u5f0f\n        ListNode mergedIterative = solution.mergeTwoListsIterative(l1, l2);\n        printList(mergedIterative);\n    }\n\n    private static void printList(ListNode head) {\n        while (head != null) {\n            System.out.print(head.val + \" \");\n            head = head.next;\n        }\n        System.out.println();\n    }\n}\n</code></pre>"},{"location":"010Java/030Algorithm/#_29","title":"\u590d\u6742\u5ea6\u5206\u6790","text":"<ul> <li>\u9012\u5f52\u65b9\u5f0f:</li> <li>\u65f6\u95f4\u590d\u6742\u5ea6: O(n+m)\uff0c\u5176\u4e2dn\u548cm\u5206\u522b\u662f\u4e24\u4e2a\u94fe\u8868\u7684\u957f\u5ea6</li> <li> <p>\u7a7a\u95f4\u590d\u6742\u5ea6: O(n+m)\uff0c\u9012\u5f52\u8c03\u7528\u6808\u7684\u6df1\u5ea6</p> </li> <li> <p>\u5faa\u73af\u65b9\u5f0f:</p> </li> <li>\u65f6\u95f4\u590d\u6742\u5ea6: O(n+m)</li> <li>\u7a7a\u95f4\u590d\u6742\u5ea6: O(1)\uff0c\u53ea\u4f7f\u7528\u4e86\u5e38\u6570\u7ea7\u522b\u7684\u989d\u5916\u7a7a\u95f4</li> </ul> <p>\u4e24\u79cd\u65b9\u6cd5\u90fd\u80fd\u6709\u6548\u5730\u5408\u5e76\u4e24\u4e2a\u6709\u5e8f\u94fe\u8868\uff0c\u9012\u5f52\u65b9\u6cd5\u4ee3\u7801\u66f4\u7b80\u6d01\u4f46\u7a7a\u95f4\u590d\u6742\u5ea6\u8f83\u9ad8\uff0c\u5faa\u73af\u65b9\u6cd5\u7a7a\u95f4\u6548\u7387\u66f4\u4f18\u3002</p>"},{"location":"010Java/030Algorithm/#_30","title":"\u5982\u4f55\u5224\u65ad\u4e00\u4e2a\u94fe\u662f\u5426\u5b58\u5728\u56de\u73af\uff1f","text":"\u7b54\u6848"},{"location":"010Java/030Algorithm/#java_3","title":"Java\u4e2d\u5224\u65ad\u94fe\u8868\u662f\u5426\u5b58\u5728\u56de\u73af\u7684\u65b9\u6cd5","text":"<p>\u5224\u65ad\u94fe\u8868\u662f\u5426\u5b58\u5728\u56de\u73af\uff08\u5faa\u73af\uff09\u662f\u5e38\u89c1\u7684\u94fe\u8868\u64cd\u4f5c\u95ee\u9898\uff0c\u4ee5\u4e0b\u662f\u51e0\u79cd\u5e38\u7528\u7684Java\u5b9e\u73b0\u65b9\u6cd5\uff1a</p>"},{"location":"010Java/030Algorithm/#1-floyd","title":"1. \u5feb\u6162\u6307\u9488\u6cd5\uff08Floyd\u5224\u5708\u7b97\u6cd5\uff09","text":"<p>\u8fd9\u662f\u6700\u7ecf\u5178\u4e14\u9ad8\u6548\u7684\u65b9\u6cd5\uff0c\u65f6\u95f4\u590d\u6742\u5ea6O(n)\uff0c\u7a7a\u95f4\u590d\u6742\u5ea6O(1)\u3002</p> <pre><code>public boolean hasCycle(ListNode head) {\n    if (head == null || head.next == null) {\n        return false;\n    }\n\n    ListNode slow = head;\n    ListNode fast = head.next;\n\n    while (slow != fast) {\n        if (fast == null || fast.next == null) {\n            return false;\n        }\n        slow = slow.next;\n        fast = fast.next.next;\n    }\n    return true;\n}\n</code></pre>"},{"location":"010Java/030Algorithm/#2-hashset","title":"2. \u4f7f\u7528HashSet\u8bb0\u5f55\u8bbf\u95ee\u8fc7\u7684\u8282\u70b9","text":"<p>\u8fd9\u79cd\u65b9\u6cd5\u5229\u7528\u54c8\u5e0c\u8868\u8bb0\u5f55\u8bbf\u95ee\u8fc7\u7684\u8282\u70b9\uff0c\u7a7a\u95f4\u590d\u6742\u5ea6O(n)\u3002</p> <pre><code>public boolean hasCycle(ListNode head) {\n    Set&lt;ListNode&gt; visited = new HashSet&lt;&gt;();\n    while (head != null) {\n        if (visited.contains(head)) {\n            return true;\n        }\n        visited.add(head);\n        head = head.next;\n    }\n    return false;\n}\n</code></pre>"},{"location":"010Java/030Algorithm/#3_2","title":"3. \u4fee\u6539\u8282\u70b9\u503c\u7684\u6807\u8bb0\u6cd5","text":"<p>\u8fd9\u79cd\u65b9\u6cd5\u4f1a\u4fee\u6539\u94fe\u8868\u8282\u70b9\u7684\u503c\uff0c\u4e0d\u63a8\u8350\u5728\u5b9e\u9645\u4e2d\u4f7f\u7528\uff0c\u4ec5\u4f5c\u4e3a\u4e86\u89e3\u3002</p> <pre><code>public boolean hasCycle(ListNode head) {\n    while (head != null) {\n        if (head.val == Integer.MIN_VALUE) {\n            return true;\n        }\n        head.val = Integer.MIN_VALUE;\n        head = head.next;\n    }\n    return false;\n}\n</code></pre>"},{"location":"010Java/030Algorithm/#_31","title":"\u94fe\u8868\u8282\u70b9\u5b9a\u4e49","text":"<p>\u4ee5\u4e0a\u65b9\u6cd5\u4e2d\u4f7f\u7528\u7684ListNode\u901a\u5e38\u5b9a\u4e49\u4e3a\uff1a</p> <pre><code>class ListNode {\n    int val;\n    ListNode next;\n    ListNode(int x) {\n        val = x;\n        next = null;\n    }\n}\n</code></pre>"},{"location":"010Java/030Algorithm/#_32","title":"\u63a8\u8350\u65b9\u6cd5","text":"<p>\u5728\u5b9e\u9645\u5e94\u7528\u4e2d\uff0c\u5feb\u6162\u6307\u9488\u6cd5\u662f\u6700\u4f18\u9009\u62e9\uff0c\u56e0\u4e3a\u5b83\u4e0d\u9700\u8981\u989d\u5916\u7684\u5b58\u50a8\u7a7a\u95f4\uff0c\u4e14\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a\u7ebf\u6027\u3002HashSet\u65b9\u6cd5\u867d\u7136\u76f4\u89c2\uff0c\u4f46\u9700\u8981\u989d\u5916\u7684O(n)\u7a7a\u95f4\u3002\u4fee\u6539\u8282\u70b9\u503c\u7684\u65b9\u6cd5\u4f1a\u7834\u574f\u539f\u59cb\u6570\u636e\uff0c\u901a\u5e38\u4e0d\u63a8\u8350\u4f7f\u7528\u3002</p>"},{"location":"010Java/030Algorithm/#2000","title":"2000\u4e07\u4e2a\u6574\u6570\uff0c\u627e\u51fa\u7b2c\u4e94\u5341\u5927\u7684\u6570\u5b57\uff1f","text":"\u7b54\u6848"},{"location":"010Java/030Algorithm/#java200050","title":"\u5728Java\u4e2d\u627e\u51fa2000\u4e07\u4e2a\u6574\u6570\u4e2d\u7684\u7b2c50\u5927\u6570\u5b57","text":"<p>\u8981\u57282000\u4e07\u4e2a\u6574\u6570\u4e2d\u627e\u51fa\u7b2c50\u5927\u7684\u6570\u5b57\uff0c\u6709\u51e0\u79cd\u53ef\u884c\u7684\u89e3\u51b3\u65b9\u6848\uff0c\u5404\u6709\u4f18\u7f3a\u70b9\u3002\u4ee5\u4e0b\u662f\u51e0\u79cd\u5e38\u89c1\u7684\u65b9\u6cd5\uff1a</p>"},{"location":"010Java/030Algorithm/#_33","title":"\u65b9\u6cd5\u4e00\uff1a\u4f7f\u7528\u6700\u5c0f\u5806\uff08\u4f18\u5148\u961f\u5217\uff09","text":"<pre><code>import java.util.PriorityQueue;\n\npublic class FindNthLargest {\n    public static int find50thLargest(int[] nums) {\n        PriorityQueue&lt;Integer&gt; minHeap = new PriorityQueue&lt;&gt;();\n\n        for (int num : nums) {\n            minHeap.offer(num);\n            if (minHeap.size() &gt; 50) {\n                minHeap.poll(); // \u79fb\u9664\u6700\u5c0f\u7684\u5143\u7d20\uff0c\u4fdd\u6301\u5806\u5927\u5c0f\u4e3a50\n            }\n        }\n\n        return minHeap.peek(); // \u5806\u9876\u5c31\u662f\u7b2c50\u5927\u7684\u5143\u7d20\n    }\n\n    public static void main(String[] args) {\n        // \u5047\u8bbe\u6709\u4e00\u4e2a\u5305\u542b2000\u4e07\u4e2a\u6574\u6570\u7684\u6570\u7ec4\n        int[] hugeArray = new int[20_000_000];\n        // ... \u586b\u5145\u6570\u7ec4\u6570\u636e ...\n\n        int result = find50thLargest(hugeArray);\n        System.out.println(\"\u7b2c50\u5927\u7684\u6570\u5b57\u662f: \" + result);\n    }\n}\n</code></pre> <p>\u590d\u6742\u5ea6\u5206\u6790\uff1a - \u65f6\u95f4\u590d\u6742\u5ea6\uff1aO(n log k)\uff0c\u5176\u4e2dn\u662f\u5143\u7d20\u603b\u6570(20,000,000)\uff0ck\u662f50 - \u7a7a\u95f4\u590d\u6742\u5ea6\uff1aO(k)\uff0c\u53ea\u9700\u8981\u7ef4\u62a4\u5927\u5c0f\u4e3a50\u7684\u5806</p>"},{"location":"010Java/030Algorithm/#quickselect","title":"\u65b9\u6cd5\u4e8c\uff1a\u5feb\u901f\u9009\u62e9\u7b97\u6cd5\uff08Quickselect\uff09","text":"<pre><code>import java.util.Random;\n\npublic class FindNthLargest {\n    public static int find50thLargest(int[] nums) {\n        int k = 50;\n        int left = 0;\n        int right = nums.length - 1;\n        Random rand = new Random();\n\n        while (left &lt;= right) {\n            int pivotIndex = partition(nums, left, right, rand);\n            if (pivotIndex == nums.length - k) {\n                return nums[pivotIndex];\n            } else if (pivotIndex &lt; nums.length - k) {\n                left = pivotIndex + 1;\n            } else {\n                right = pivotIndex - 1;\n            }\n        }\n        return -1; // \u4e0d\u5e94\u8be5\u5230\u8fbe\u8fd9\u91cc\n    }\n\n    private static int partition(int[] nums, int left, int right, Random rand) {\n        int pivotIndex = left + rand.nextInt(right - left + 1);\n        int pivot = nums[pivotIndex];\n        swap(nums, pivotIndex, right);\n\n        int i = left;\n        for (int j = left; j &lt; right; j++) {\n            if (nums[j] &lt; pivot) {\n                swap(nums, i, j);\n                i++;\n            }\n        }\n        swap(nums, i, right);\n        return i;\n    }\n\n    private static void swap(int[] nums, int i, int j) {\n        int temp = nums[i];\n        nums[i] = nums[j];\n        nums[j] = temp;\n    }\n}\n</code></pre> <p>\u590d\u6742\u5ea6\u5206\u6790\uff1a - \u5e73\u5747\u65f6\u95f4\u590d\u6742\u5ea6\uff1aO(n) - \u6700\u574f\u65f6\u95f4\u590d\u6742\u5ea6\uff1aO(n^2)\uff08\u4f46\u968f\u673a\u5316\u53ef\u4ee5\u907f\u514d\u6700\u574f\u60c5\u51b5\uff09 - \u7a7a\u95f4\u590d\u6742\u5ea6\uff1aO(1)</p>"},{"location":"010Java/030Algorithm/#_34","title":"\u65b9\u6cd5\u9009\u62e9\u5efa\u8bae","text":"<ol> <li>\u5bf9\u4e8e2000\u4e07\u6570\u636e\u91cf\uff1a</li> <li>\u6700\u5c0f\u5806\u65b9\u6cd5\u66f4\u7a33\u5b9a\uff0c\u4e0d\u4f1a\u51fa\u73b0\u6700\u574f\u60c5\u51b5\uff0c\u4e14\u5b9e\u73b0\u7b80\u5355</li> <li> <p>\u5feb\u901f\u9009\u62e9\u7406\u8bba\u4e0a\u5e73\u5747\u66f4\u5feb\uff0c\u4f46\u5b9e\u73b0\u7a0d\u590d\u6742</p> </li> <li> <p>\u5b9e\u9645\u5e94\u7528\uff1a</p> </li> <li>\u5982\u679c\u53ea\u9700\u8981\u627e\u4e00\u6b21\u7b2c50\u5927\u7684\u6570\uff0c\u4e24\u79cd\u65b9\u6cd5\u90fd\u53ef\u4ee5</li> <li> <p>\u5982\u679c\u9700\u8981\u591a\u6b21\u67e5\u8be2\u4e0d\u540c\u6392\u540d\uff0c\u8003\u8651\u5148\u6392\u5e8f\uff08O(n log n)\uff09\u7136\u540e\u53ef\u4ee5O(1)\u67e5\u8be2</p> </li> <li> <p>\u5185\u5b58\u8003\u8651\uff1a</p> </li> <li>\u6700\u5c0f\u5806\u53ea\u9700\u8981\u5b58\u50a850\u4e2a\u5143\u7d20\uff0c\u5185\u5b58\u6548\u7387\u9ad8</li> <li>\u5feb\u901f\u9009\u62e9\u662f\u539f\u5730\u7b97\u6cd5\uff0c\u4f46\u9700\u8981\u80fd\u5168\u90e8\u88c5\u5165\u5185\u5b58</li> </ol> <p>\u5bf9\u4e8e2000\u4e07\u6574\u6570\uff08\u5047\u8bbe\u662fint\u7c7b\u578b\uff0c\u7ea680MB\u5185\u5b58\uff09\uff0c\u73b0\u4ee3\u8ba1\u7b97\u673a\u90fd\u80fd\u8f7b\u677e\u5904\u7406\uff0c\u4e24\u79cd\u65b9\u6cd5\u90fd\u662f\u53ef\u884c\u7684\u3002</p>"},{"location":"010Java/030Algorithm/#5050","title":"\u8fd4\u56de\u524d50\u5927\u7684\u6570\u5b57\uff08\u800c\u975e\u4ec5\u7b2c50\u5927\uff09","text":"<p>\u5982\u679c\u9700\u8981\u8fd4\u56de\u524d50\u5927\u7684\u6240\u6709\u6570\u5b57\uff08\u6309\u4ece\u5927\u5230\u5c0f\u987a\u5e8f\uff09\uff0c\u800c\u4e0d\u662f\u4ec5\u4ec5\u7b2c50\u5927\u7684\u6570\u5b57\uff0c\u6211\u4eec\u53ef\u4ee5\u5bf9\u4e4b\u524d\u7684\u89e3\u51b3\u65b9\u6848\u8fdb\u884c\u8c03\u6574\u3002\u4ee5\u4e0b\u662f\u51e0\u79cd\u5b9e\u73b0\u65b9\u6cd5\uff1a</p>"},{"location":"010Java/030Algorithm/#50","title":"\u65b9\u6cd5\u4e00\uff1a\u4f7f\u7528\u6700\u5c0f\u5806\uff08\u4f18\u5148\u961f\u5217\uff09\u8fd4\u56de\u524d50\u5927","text":"<pre><code>import java.util.ArrayList;\nimport java.util.Collections;\nimport java.util.List;\nimport java.util.PriorityQueue;\n\npublic class FindTopNLargest {\n    public static List&lt;Integer&gt; findTop50Largest(int[] nums) {\n        PriorityQueue&lt;Integer&gt; minHeap = new PriorityQueue&lt;&gt;();\n\n        for (int num : nums) {\n            minHeap.offer(num);\n            if (minHeap.size() &gt; 50) {\n                minHeap.poll(); // \u4fdd\u6301\u5806\u5927\u5c0f\u4e3a50\n            }\n        }\n\n        // \u5c06\u5806\u4e2d\u7684\u5143\u7d20\u8f6c\u4e3aList\u5e76\u6392\u5e8f\uff08\u4ece\u5927\u5230\u5c0f\uff09\n        List&lt;Integer&gt; result = new ArrayList&lt;&gt;(minHeap);\n        Collections.sort(result, Collections.reverseOrder());\n\n        return result;\n    }\n\n    public static void main(String[] args) {\n        int[] hugeArray = new int[20_000_000];\n        // ... \u586b\u5145\u6570\u7ec4\u6570\u636e ...\n\n        List&lt;Integer&gt; top50 = findTop50Largest(hugeArray);\n        System.out.println(\"\u524d50\u5927\u7684\u6570\u5b57\u662f: \" + top50);\n    }\n}\n</code></pre>"},{"location":"010Java/030Algorithm/#50_1","title":"\u65b9\u6cd5\u4e8c\uff1a\u4f7f\u7528\u5feb\u901f\u9009\u62e9\u5206\u533a\u540e\u63d0\u53d6\u524d50\u5927","text":"<pre><code>import java.util.ArrayList;\nimport java.util.Arrays;\nimport java.util.List;\nimport java.util.Random;\n\npublic class FindTopNLargest {\n    public static List&lt;Integer&gt; findTop50Largest(int[] nums) {\n        int k = 50;\n        if (nums.length &lt;= k) {\n            List&lt;Integer&gt; result = new ArrayList&lt;&gt;();\n            for (int num : nums) result.add(num);\n            result.sort(Collections.reverseOrder());\n            return result;\n        }\n\n        // \u4f7f\u7528\u5feb\u901f\u9009\u62e9\u627e\u5230\u7b2c50\u5927\u7684\u5143\u7d20\u7684\u5206\u754c\u70b9\n        quickSelect(nums, 0, nums.length - 1, nums.length - k);\n\n        // \u63d0\u53d6\u6700\u540e50\u4e2a\u5143\u7d20\uff08\u5373\u524d50\u5927\u7684\u5143\u7d20\uff09\n        int[] top50 = Arrays.copyOfRange(nums, nums.length - k, nums.length);\n\n        // \u6392\u5e8f\uff08\u4ece\u5927\u5230\u5c0f\uff09\n        Arrays.sort(top50);\n        List&lt;Integer&gt; result = new ArrayList&lt;&gt;();\n        for (int i = top50.length - 1; i &gt;= 0; i--) {\n            result.add(top50[i]);\n        }\n\n        return result;\n    }\n\n    private static void quickSelect(int[] nums, int left, int right, int k) {\n        Random rand = new Random();\n        while (left &lt;= right) {\n            int pivotIndex = partition(nums, left, right, rand);\n            if (pivotIndex == k) {\n                return;\n            } else if (pivotIndex &lt; k) {\n                left = pivotIndex + 1;\n            } else {\n                right = pivotIndex - 1;\n            }\n        }\n    }\n\n    private static int partition(int[] nums, int left, int right, Random rand) {\n        int pivotIndex = left + rand.nextInt(right - left + 1);\n        int pivot = nums[pivotIndex];\n        swap(nums, pivotIndex, right);\n\n        int i = left;\n        for (int j = left; j &lt; right; j++) {\n            if (nums[j] &lt; pivot) {\n                swap(nums, i, j);\n                i++;\n            }\n        }\n        swap(nums, i, right);\n        return i;\n    }\n\n    private static void swap(int[] nums, int i, int j) {\n        int temp = nums[i];\n        nums[i] = nums[j];\n        nums[j] = temp;\n    }\n}\n</code></pre>"},{"location":"010Java/030Algorithm/#_35","title":"\u65b9\u6cd5\u4e09\uff1a\u5b8c\u6574\u6392\u5e8f\uff08\u9002\u5408\u591a\u6b21\u67e5\u8be2\uff09","text":"<pre><code>import java.util.Arrays;\nimport java.util.Collections;\nimport java.util.List;\nimport java.util.stream.Collectors;\n\npublic class FindTopNLargest {\n    public static List&lt;Integer&gt; findTop50Largest(int[] nums) {\n        // \u5c06\u6570\u7ec4\u8f6c\u4e3aList\u4ee5\u4fbf\u4f7f\u7528Collections.sort\n        List&lt;Integer&gt; list = Arrays.stream(nums).boxed().collect(Collectors.toList());\n\n        // \u964d\u5e8f\u6392\u5e8f\n        Collections.sort(list, Collections.reverseOrder());\n\n        // \u8fd4\u56de\u524d50\u4e2a\u5143\u7d20\n        return list.subList(0, Math.min(50, list.size()));\n    }\n}\n</code></pre>"},{"location":"010Java/030Algorithm/#_36","title":"\u5404\u65b9\u6cd5\u6bd4\u8f83","text":"<ol> <li>\u6700\u5c0f\u5806\u65b9\u6cd5\uff1a</li> <li>\u65f6\u95f4\u590d\u6742\u5ea6\uff1aO(n log k)\uff0c\u5176\u4e2dk=50</li> <li>\u7a7a\u95f4\u590d\u6742\u5ea6\uff1aO(k)</li> <li>\u4f18\u70b9\uff1a\u5185\u5b58\u6548\u7387\u9ad8\uff0c\u9002\u5408\u5927\u6570\u636e\u91cf</li> <li> <p>\u7f3a\u70b9\uff1a\u9700\u8981\u989d\u5916\u7684\u6392\u5e8f\u6b65\u9aa4\u6765\u5f97\u5230\u6709\u5e8f\u7ed3\u679c</p> </li> <li> <p>\u5feb\u901f\u9009\u62e9+\u63d0\u53d6\u65b9\u6cd5\uff1a</p> </li> <li>\u5e73\u5747\u65f6\u95f4\u590d\u6742\u5ea6\uff1aO(n + k log k)</li> <li>\u7a7a\u95f4\u590d\u6742\u5ea6\uff1aO(k)\uff08\u5b58\u50a8\u7ed3\u679c\uff09</li> <li>\u4f18\u70b9\uff1a\u7406\u8bba\u4e0a\u5e73\u5747\u66f4\u5feb</li> <li> <p>\u7f3a\u70b9\uff1a\u5b9e\u73b0\u590d\u6742\uff0c\u6709\u6700\u574f\u60c5\u51b5\u98ce\u9669</p> </li> <li> <p>\u5b8c\u6574\u6392\u5e8f\u65b9\u6cd5\uff1a</p> </li> <li>\u65f6\u95f4\u590d\u6742\u5ea6\uff1aO(n log n)</li> <li>\u7a7a\u95f4\u590d\u6742\u5ea6\uff1aO(n)</li> <li>\u4f18\u70b9\uff1a\u5b9e\u73b0\u7b80\u5355</li> <li>\u7f3a\u70b9\uff1a\u5bf9\u4e8e\u53ea\u9700\u8981\u524d50\u5927\u7684\u60c5\u51b5\u6548\u7387\u4e0d\u9ad8</li> </ol>"},{"location":"010Java/030Algorithm/#_37","title":"\u63a8\u8350\u9009\u62e9","text":"<p>\u5bf9\u4e8e2000\u4e07\u6570\u636e\u91cf\u53ea\u9700\u8981\u524d50\u5927\u7684\u60c5\u51b5\uff0c\u6700\u5c0f\u5806\u65b9\u6cd5\u662f\u6700\u4f73\u9009\u62e9\uff1a - \u5185\u5b58\u6548\u7387\u9ad8\uff08\u53ea\u7ef4\u62a450\u4e2a\u5143\u7d20\u7684\u5806\uff09 - \u65f6\u95f4\u590d\u6742\u5ea6\u5408\u7406\uff08n log k\uff09 - \u5b9e\u73b0\u7b80\u5355\u53ef\u9760</p> <p>\u5982\u679c\u6027\u80fd\u6d4b\u8bd5\u8868\u660e\u9700\u8981\u66f4\u5feb\u7684\u89e3\u51b3\u65b9\u6848\uff0c\u53ef\u4ee5\u8003\u8651\u5feb\u901f\u9009\u62e9\u65b9\u6cd5\uff0c\u4f46\u5b9e\u73b0\u590d\u6742\u5ea6\u66f4\u9ad8\u3002</p>"},{"location":"010Java/030Algorithm/#100","title":"\u4e00\u4e2a\u6587\u4ef6\u4e2d\u6709100\u4e07\u4e2a\u6574\u6570\uff0c\u7531\u7a7a\u683c\u5206\u5f00\uff0c\u5728\u7a0b\u5e8f\u4e2d\u5224\u65ad\u7528\u6237\u8f93\u5165\u7684\u6574\u6570\u662f\u5426\u5728\u6b64\u6587\u4ef6\u4e2d\u3002\u8bf4\u51fa\u6700\u4f18\u7684\u65b9\u6cd5","text":"\u7b54\u6848"},{"location":"010Java/030Algorithm/#_38","title":"\u5224\u65ad\u5927\u6587\u4ef6\u4e2d\u662f\u5426\u5b58\u5728\u6307\u5b9a\u6574\u6570\u7684\u6700\u4f18\u65b9\u6cd5","text":"<p>\u5bf9\u4e8e\u5728\u5305\u542b100\u4e07\u4e2a\u6574\u6570\u7684\u6587\u4ef6\u4e2d\u5feb\u901f\u5224\u65ad\u7528\u6237\u8f93\u5165\u6574\u6570\u662f\u5426\u5b58\u5728\u7684\u95ee\u9898\uff0c\u6700\u4f18\u7684\u89e3\u51b3\u65b9\u6848\u9700\u8981\u8003\u8651\u4ee5\u4e0b\u51e0\u4e2a\u65b9\u9762\uff1a</p>"},{"location":"010Java/030Algorithm/#hashset","title":"\u6700\u4f18\u65b9\u6cd5\uff1a\u4f7f\u7528HashSet","text":"<ol> <li>\u9884\u5904\u7406\u9636\u6bb5\uff1a</li> <li>\u8bfb\u53d6\u6587\u4ef6\u5e76\u5c06\u6240\u6709\u6574\u6570\u5b58\u5165\u4e00\u4e2a<code>HashSet&lt;Integer&gt;</code>\u4e2d</li> <li> <p>HashSet\u7684\u67e5\u627e\u65f6\u95f4\u590d\u6742\u5ea6\u4e3aO(1)\uff0c\u975e\u5e38\u9ad8\u6548</p> </li> <li> <p>\u67e5\u8be2\u9636\u6bb5\uff1a</p> </li> <li>\u5f53\u7528\u6237\u8f93\u5165\u4e00\u4e2a\u6574\u6570\u65f6\uff0c\u53ea\u9700\u8c03\u7528<code>set.contains(inputNumber)</code></li> <li>\u8fd4\u56detrue\u8868\u793a\u5b58\u5728\uff0cfalse\u8868\u793a\u4e0d\u5b58\u5728</li> </ol>"},{"location":"010Java/030Algorithm/#_39","title":"\u5b9e\u73b0\u4ee3\u7801\u793a\u4f8b","text":"<pre><code>import java.io.*;\nimport java.util.*;\n\npublic class NumberChecker {\n    private Set&lt;Integer&gt; numbers = new HashSet&lt;&gt;();\n\n    public void loadFile(String filePath) throws IOException {\n        try (BufferedReader reader = new BufferedReader(new FileReader(filePath))) {\n            String line;\n            while ((line = reader.readLine()) != null) {\n                String[] parts = line.split(\" \");\n                for (String part : parts) {\n                    numbers.add(Integer.parseInt(part));\n                }\n            }\n        }\n    }\n\n    public boolean contains(int number) {\n        return numbers.contains(number);\n    }\n\n    public static void main(String[] args) {\n        NumberChecker checker = new NumberChecker();\n        try {\n            checker.loadFile(\"numbers.txt\");\n\n            Scanner scanner = new Scanner(System.in);\n            System.out.println(\"Enter a number to check (or 'q' to quit):\");\n\n            while (scanner.hasNext()) {\n                if (scanner.hasNextInt()) {\n                    int num = scanner.nextInt();\n                    System.out.println(\"Number \" + num + \" exists: \" + checker.contains(num));\n                } else if (scanner.next().equalsIgnoreCase(\"q\")) {\n                    break;\n                }\n            }\n        } catch (IOException e) {\n            e.printStackTrace();\n        }\n    }\n}\n</code></pre>"},{"location":"010Java/030Algorithm/#_40","title":"\u5176\u4ed6\u8003\u8651\u65b9\u6848","text":"<ol> <li>\u6392\u5e8f\u540e\u4e8c\u5206\u67e5\u627e\uff1a</li> <li>\u5982\u679c\u5185\u5b58\u53d7\u9650\uff0c\u53ef\u4ee5\u5c06\u6570\u5b57\u6392\u5e8f\u540e\u5b58\u50a8\u5728\u6570\u7ec4\u4e2d</li> <li>\u4f7f\u7528<code>Arrays.binarySearch()</code>\u8fdb\u884c\u67e5\u627e(O(log n)\u65f6\u95f4\u590d\u6742\u5ea6)</li> <li> <p>\u4f46\u9884\u5904\u7406\u65f6\u95f4\u8f83\u957f\uff0c\u4e14\u67e5\u8be2\u6548\u7387\u4e0d\u5982HashSet</p> </li> <li> <p>\u5e03\u9686\u8fc7\u6ee4\u5668(Bloom Filter)\uff1a</p> </li> <li>\u9002\u7528\u4e8e\u5185\u5b58\u6781\u5ea6\u53d7\u9650\u4e14\u53ef\u4ee5\u63a5\u53d7\u4e00\u5b9a\u8bef\u62a5\u7387\u7684\u573a\u666f</li> <li> <p>\u4f46Java\u6807\u51c6\u5e93\u6ca1\u6709\u5185\u7f6e\u5b9e\u73b0\uff0c\u9700\u8981\u7b2c\u4e09\u65b9\u5e93</p> </li> <li> <p>\u6570\u636e\u5e93/\u7d22\u5f15\uff1a</p> </li> <li>\u5bf9\u4e8e\u8d85\u5927\u89c4\u6a21\u6570\u636e(\u6570\u5341\u4ebf)\uff0c\u53ef\u4ee5\u8003\u8651\u4f7f\u7528\u6570\u636e\u5e93</li> <li>\u4f46\u5bf9\u4e8e100\u4e07\u91cf\u7ea7\uff0c\u5185\u5b58\u4e2d\u7684HashSet\u901a\u5e38\u662f\u6700\u4f73\u9009\u62e9</li> </ol>"},{"location":"010Java/030Algorithm/#_41","title":"\u6027\u80fd\u5206\u6790","text":"<ul> <li>\u7a7a\u95f4\u590d\u6742\u5ea6\uff1a\u6bcf\u4e2aInteger\u5bf9\u8c61\u7ea6\u5360\u752816\u5b57\u8282\uff0c100\u4e07\u6574\u6570\u7ea616MB\u5185\u5b58</li> <li>\u9884\u5904\u7406\u65f6\u95f4\uff1aO(n)\u65f6\u95f4\u8bfb\u53d6\u548c\u5b58\u50a8\u6240\u6709\u6570\u5b57</li> <li>\u67e5\u8be2\u65f6\u95f4\uff1a\u6bcf\u6b21\u67e5\u8be2O(1)\u65f6\u95f4</li> </ul> <p>\u5bf9\u4e8e100\u4e07\u6574\u6570\u7684\u89c4\u6a21\uff0cHashSet\u65b9\u6848\u5728\u5927\u591a\u6570\u73b0\u4ee3\u673a\u5668\u4e0a\u90fd\u80fd\u63d0\u4f9b\u6781\u5feb\u7684\u67e5\u8be2\u54cd\u5e94\u3002</p>"},{"location":"010Java/030Algorithm/#_42","title":"\u4e8c\u53c9\u6811\u7684\u6df1\u5ea6\u4f18\u5148\u904d\u5386\u548c\u5e7f\u5ea6\u4f18\u5148\u904d\u5386\u7684\u5177\u4f53\u5b9e\u73b0","text":"\u7b54\u6848"},{"location":"010Java/030Algorithm/#java_4","title":"Java \u5b9e\u73b0\u4e8c\u53c9\u6811\u7684\u6df1\u5ea6\u4f18\u5148\u904d\u5386\u548c\u5e7f\u5ea6\u4f18\u5148\u904d\u5386","text":"<p>\u4e0b\u9762\u6211\u5c06\u5206\u522b\u4ecb\u7ecd\u4e8c\u53c9\u6811\u7684\u6df1\u5ea6\u4f18\u5148\u904d\u5386\uff08DFS\uff09\u548c\u5e7f\u5ea6\u4f18\u5148\u904d\u5386\uff08BFS\uff09\u7684 Java \u5b9e\u73b0\uff0c\u5305\u62ec\u9012\u5f52\u548c\u975e\u9012\u5f52\u7248\u672c\u3002</p>"},{"location":"010Java/030Algorithm/#1_5","title":"1. \u4e8c\u53c9\u6811\u8282\u70b9\u5b9a\u4e49","text":"<p>\u9996\u5148\u5b9a\u4e49\u4e8c\u53c9\u6811\u7684\u8282\u70b9\u7c7b\uff1a</p> <pre><code>class TreeNode {\n    int val;\n    TreeNode left;\n    TreeNode right;\n\n    TreeNode(int x) {\n        val = x;\n    }\n}\n</code></pre>"},{"location":"010Java/030Algorithm/#2-dfs","title":"2. \u6df1\u5ea6\u4f18\u5148\u904d\u5386\uff08DFS\uff09","text":"<p>\u6df1\u5ea6\u4f18\u5148\u904d\u5386\u6709\u4e09\u79cd\u65b9\u5f0f\uff1a\u524d\u5e8f\u904d\u5386\u3001\u4e2d\u5e8f\u904d\u5386\u548c\u540e\u5e8f\u904d\u5386\u3002</p>"},{"location":"010Java/030Algorithm/#21","title":"2.1 \u9012\u5f52\u5b9e\u73b0","text":"<pre><code>// \u524d\u5e8f\u904d\u5386\uff08\u6839-\u5de6-\u53f3\uff09\npublic void preOrderTraversal(TreeNode root) {\n    if (root == null) return;\n    System.out.print(root.val + \" \"); // \u8bbf\u95ee\u6839\u8282\u70b9\n    preOrderTraversal(root.left);     // \u904d\u5386\u5de6\u5b50\u6811\n    preOrderTraversal(root.right);    // \u904d\u5386\u53f3\u5b50\u6811\n}\n\n// \u4e2d\u5e8f\u904d\u5386\uff08\u5de6-\u6839-\u53f3\uff09\npublic void inOrderTraversal(TreeNode root) {\n    if (root == null) return;\n    inOrderTraversal(root.left);      // \u904d\u5386\u5de6\u5b50\u6811\n    System.out.print(root.val + \" \"); // \u8bbf\u95ee\u6839\u8282\u70b9\n    inOrderTraversal(root.right);     // \u904d\u5386\u53f3\u5b50\u6811\n}\n\n// \u540e\u5e8f\u904d\u5386\uff08\u5de6-\u53f3-\u6839\uff09\npublic void postOrderTraversal(TreeNode root) {\n    if (root == null) return;\n    postOrderTraversal(root.left);    // \u904d\u5386\u5de6\u5b50\u6811\n    postOrderTraversal(root.right);   // \u904d\u5386\u53f3\u5b50\u6811\n    System.out.print(root.val + \" \"); // \u8bbf\u95ee\u6839\u8282\u70b9\n}\n</code></pre>"},{"location":"010Java/030Algorithm/#22","title":"2.2 \u975e\u9012\u5f52\u5b9e\u73b0\uff08\u4f7f\u7528\u6808\uff09","text":"<pre><code>// \u524d\u5e8f\u904d\u5386\uff08\u975e\u9012\u5f52\uff09\npublic void preOrderTraversalIterative(TreeNode root) {\n    if (root == null) return;\n\n    Stack&lt;TreeNode&gt; stack = new Stack&lt;&gt;();\n    stack.push(root);\n\n    while (!stack.isEmpty()) {\n        TreeNode node = stack.pop();\n        System.out.print(node.val + \" \");\n\n        // \u5148\u538b\u5165\u53f3\u8282\u70b9\uff0c\u518d\u538b\u5165\u5de6\u8282\u70b9\uff0c\u8fd9\u6837\u51fa\u6808\u987a\u5e8f\u5c31\u662f\u5de6-\u53f3\n        if (node.right != null) stack.push(node.right);\n        if (node.left != null) stack.push(node.left);\n    }\n}\n\n// \u4e2d\u5e8f\u904d\u5386\uff08\u975e\u9012\u5f52\uff09\npublic void inOrderTraversalIterative(TreeNode root) {\n    if (root == null) return;\n\n    Stack&lt;TreeNode&gt; stack = new Stack&lt;&gt;();\n    TreeNode curr = root;\n\n    while (curr != null || !stack.isEmpty()) {\n        // \u5148\u904d\u5386\u5230\u6700\u5de6\u8282\u70b9\n        while (curr != null) {\n            stack.push(curr);\n            curr = curr.left;\n        }\n\n        curr = stack.pop();\n        System.out.print(curr.val + \" \");\n        curr = curr.right;\n    }\n}\n\n// \u540e\u5e8f\u904d\u5386\uff08\u975e\u9012\u5f52\uff09\npublic void postOrderTraversalIterative(TreeNode root) {\n    if (root == null) return;\n\n    Stack&lt;TreeNode&gt; stack = new Stack&lt;&gt;();\n    Stack&lt;TreeNode&gt; output = new Stack&lt;&gt;();\n    stack.push(root);\n\n    while (!stack.isEmpty()) {\n        TreeNode node = stack.pop();\n        output.push(node);\n\n        if (node.left != null) stack.push(node.left);\n        if (node.right != null) stack.push(node.right);\n    }\n\n    while (!output.isEmpty()) {\n        System.out.print(output.pop().val + \" \");\n    }\n}\n</code></pre>"},{"location":"010Java/030Algorithm/#3-bfs","title":"3. \u5e7f\u5ea6\u4f18\u5148\u904d\u5386\uff08BFS\uff09","text":"<p>\u5e7f\u5ea6\u4f18\u5148\u904d\u5386\u901a\u5e38\u4f7f\u7528\u961f\u5217\u6765\u5b9e\u73b0\u3002</p>"},{"location":"010Java/030Algorithm/#31-bfs","title":"3.1 \u57fa\u672cBFS\u5b9e\u73b0","text":"<pre><code>public void levelOrderTraversal(TreeNode root) {\n    if (root == null) return;\n\n    Queue&lt;TreeNode&gt; queue = new LinkedList&lt;&gt;();\n    queue.offer(root);\n\n    while (!queue.isEmpty()) {\n        TreeNode node = queue.poll();\n        System.out.print(node.val + \" \");\n\n        if (node.left != null) queue.offer(node.left);\n        if (node.right != null) queue.offer(node.right);\n    }\n}\n</code></pre>"},{"location":"010Java/030Algorithm/#32-bfs","title":"3.2 \u6309\u5c42\u6253\u5370\u7684BFS\u5b9e\u73b0","text":"<pre><code>public void levelOrderTraversalByLevel(TreeNode root) {\n    if (root == null) return;\n\n    Queue&lt;TreeNode&gt; queue = new LinkedList&lt;&gt;();\n    queue.offer(root);\n\n    while (!queue.isEmpty()) {\n        int levelSize = queue.size();\n        for (int i = 0; i &lt; levelSize; i++) {\n            TreeNode node = queue.poll();\n            System.out.print(node.val + \" \");\n\n            if (node.left != null) queue.offer(node.left);\n            if (node.right != null) queue.offer(node.right);\n        }\n        System.out.println(); // \u6362\u884c\u8868\u793a\u65b0\u7684\u4e00\u5c42\n    }\n}\n</code></pre>"},{"location":"010Java/030Algorithm/#4_2","title":"4. \u6d4b\u8bd5\u4ee3\u7801","text":"<pre><code>public class BinaryTreeTraversal {\n    public static void main(String[] args) {\n        // \u6784\u5efa\u4e8c\u53c9\u6811\n        TreeNode root = new TreeNode(1);\n        root.left = new TreeNode(2);\n        root.right = new TreeNode(3);\n        root.left.left = new TreeNode(4);\n        root.left.right = new TreeNode(5);\n        root.right.left = new TreeNode(6);\n        root.right.right = new TreeNode(7);\n\n        BinaryTreeTraversal traversal = new BinaryTreeTraversal();\n\n        System.out.println(\"\u524d\u5e8f\u904d\u5386\uff08\u9012\u5f52\uff09:\");\n        traversal.preOrderTraversal(root);\n        System.out.println(\"\\n\u524d\u5e8f\u904d\u5386\uff08\u975e\u9012\u5f52\uff09:\");\n        traversal.preOrderTraversalIterative(root);\n\n        System.out.println(\"\\n\\n\u4e2d\u5e8f\u904d\u5386\uff08\u9012\u5f52\uff09:\");\n        traversal.inOrderTraversal(root);\n        System.out.println(\"\\n\u4e2d\u5e8f\u904d\u5386\uff08\u975e\u9012\u5f52\uff09:\");\n        traversal.inOrderTraversalIterative(root);\n\n        System.out.println(\"\\n\\n\u540e\u5e8f\u904d\u5386\uff08\u9012\u5f52\uff09:\");\n        traversal.postOrderTraversal(root);\n        System.out.println(\"\\n\u540e\u5e8f\u904d\u5386\uff08\u975e\u9012\u5f52\uff09:\");\n        traversal.postOrderTraversalIterative(root);\n\n        System.out.println(\"\\n\\n\u5e7f\u5ea6\u4f18\u5148\u904d\u5386:\");\n        traversal.levelOrderTraversal(root);\n\n        System.out.println(\"\\n\\n\u6309\u5c42\u6253\u5370\u7684\u5e7f\u5ea6\u4f18\u5148\u904d\u5386:\");\n        traversal.levelOrderTraversalByLevel(root);\n    }\n}\n</code></pre> <p>\u8f93\u51fa\u7ed3\u679c\uff1a <pre><code>\u524d\u5e8f\u904d\u5386\uff08\u9012\u5f52\uff09:\n1 2 4 5 3 6 7 \n\u524d\u5e8f\u904d\u5386\uff08\u975e\u9012\u5f52\uff09:\n1 2 4 5 3 6 7 \n\n\u4e2d\u5e8f\u904d\u5386\uff08\u9012\u5f52\uff09:\n4 2 5 1 6 3 7 \n\u4e2d\u5e8f\u904d\u5386\uff08\u975e\u9012\u5f52\uff09:\n4 2 5 1 6 3 7 \n\n\u540e\u5e8f\u904d\u5386\uff08\u9012\u5f52\uff09:\n4 5 2 6 7 3 1 \n\u540e\u5e8f\u904d\u5386\uff08\u975e\u9012\u5f52\uff09:\n4 5 2 6 7 3 1 \n\n\u5e7f\u5ea6\u4f18\u5148\u904d\u5386:\n1 2 3 4 5 6 7 \n\n\u6309\u5c42\u6253\u5370\u7684\u5e7f\u5ea6\u4f18\u5148\u904d\u5386:\n1 \n2 3 \n4 5 6 7 \n</code></pre></p> <p>\u8fd9\u4e9b\u5b9e\u73b0\u6db5\u76d6\u4e86\u4e8c\u53c9\u6811\u904d\u5386\u7684\u4e3b\u8981\u65b9\u6cd5\uff0c\u53ef\u4ee5\u6839\u636e\u9700\u8981\u9009\u62e9\u9012\u5f52\u6216\u975e\u9012\u5f52\u7248\u672c\u3002\u9012\u5f52\u7248\u672c\u4ee3\u7801\u7b80\u6d01\u4f46\u53ef\u80fd\u6709\u6808\u6ea2\u51fa\u98ce\u9669\uff0c\u975e\u9012\u5f52\u7248\u672c\u4f7f\u7528\u663e\u5f0f\u6808/\u961f\u5217\uff0c\u66f4\u9002\u5408\u6df1\u5ea6\u5927\u7684\u6811\u3002</p>"},{"location":"010Java/030Algorithm/#javaandroidview","title":"Java\u5bfb\u627eAndroid\u6700\u8fd1\u516c\u5171View/\u7956\u5148","text":"\u7b54\u6848"},{"location":"010Java/030Algorithm/#androidviewlca","title":"\u5728Android\u4e2d\u5bfb\u627e\u4e24\u4e2aView\u7684\u6700\u8fd1\u516c\u5171\u7956\u5148(LCA)","text":"<p>\u5728Android\u5f00\u53d1\u4e2d\uff0c\u6709\u65f6\u9700\u8981\u627e\u5230\u4e24\u4e2a\u89c6\u56fe(View)\u5728\u89c6\u56fe\u6811\u4e2d\u7684\u6700\u8fd1\u516c\u5171\u7956\u5148(\u6700\u4f4e\u516c\u5171\u7236\u8282\u70b9)\u3002\u4ee5\u4e0b\u662f\u51e0\u79cd\u5b9e\u73b0\u65b9\u6cd5\uff1a</p>"},{"location":"010Java/030Algorithm/#_43","title":"\u65b9\u6cd5\u4e00\uff1a\u901a\u8fc7\u904d\u5386\u7236\u8282\u70b9\u94fe","text":"<pre><code>public static View findLowestCommonAncestor(View view1, View view2) {\n    if (view1 == null || view2 == null) {\n        return null;\n    }\n\n    // \u6536\u96c6view1\u7684\u6240\u6709\u7956\u5148\n    List&lt;View&gt; ancestors1 = new ArrayList&lt;&gt;();\n    View current = view1;\n    while (current != null) {\n        ancestors1.add(current);\n        current = current.getParent() instanceof View ? (View) current.getParent() : null;\n    }\n\n    // \u68c0\u67e5view2\u53ca\u5176\u7956\u5148\u662f\u5426\u5728view1\u7684\u7956\u5148\u5217\u8868\u4e2d\n    current = view2;\n    while (current != null) {\n        if (ancestors1.contains(current)) {\n            return current;\n        }\n        current = current.getParent() instanceof View ? (View) current.getParent() : null;\n    }\n\n    return null; // \u6ca1\u6709\u516c\u5171\u7956\u5148\n}\n</code></pre>"},{"location":"010Java/030Algorithm/#_44","title":"\u65b9\u6cd5\u4e8c\uff1a\u4f18\u5316\u7248\u672c\uff08\u51cf\u5c11\u5185\u5b58\u4f7f\u7528\uff09","text":"<pre><code>public static View findLowestCommonAncestorOptimized(View view1, View view2) {\n    if (view1 == null || view2 == null) {\n        return null;\n    }\n\n    // \u83b7\u53d6\u4e24\u4e2a\u89c6\u56fe\u7684\u6df1\u5ea6\n    int depth1 = getDepth(view1);\n    int depth2 = getDepth(view2);\n\n    // \u4f7f\u4e24\u4e2a\u89c6\u56fe\u5904\u4e8e\u540c\u4e00\u6df1\u5ea6\n    while (depth1 &gt; depth2) {\n        view1 = view1.getParent() instanceof View ? (View) view1.getParent() : null;\n        depth1--;\n    }\n    while (depth2 &gt; depth1) {\n        view2 = view2.getParent() instanceof View ? (View) view2.getParent() : null;\n        depth2--;\n    }\n\n    // \u540c\u65f6\u5411\u4e0a\u904d\u5386\uff0c\u76f4\u5230\u627e\u5230\u516c\u5171\u7956\u5148\n    while (view1 != view2 &amp;&amp; view1 != null &amp;&amp; view2 != null) {\n        view1 = view1.getParent() instanceof View ? (View) view1.getParent() : null;\n        view2 = view2.getParent() instanceof View ? (View) view2.getParent() : null;\n    }\n\n    return view1 == view2 ? view1 : null;\n}\n\nprivate static int getDepth(View view) {\n    int depth = 0;\n    View current = view;\n    while (current != null) {\n        depth++;\n        current = current.getParent() instanceof View ? (View) current.getParent() : null;\n    }\n    return depth;\n}\n</code></pre>"},{"location":"010Java/030Algorithm/#_45","title":"\u65b9\u6cd5\u4e09\uff1a\u4f7f\u7528\u9012\u5f52\u5b9e\u73b0","text":"<pre><code>public static View findLowestCommonAncestorRecursive(View root, View view1, View view2) {\n    if (root == null || root == view1 || root == view2) {\n        return root;\n    }\n\n    View left = findLowestCommonAncestorRecursive(root.getParent(), view1, view2);\n    View right = findLowestCommonAncestorRecursive(root.getParent(), view1, view2);\n\n    if (left != null &amp;&amp; right != null) {\n        return root;\n    }\n\n    return left != null ? left : right;\n}\n</code></pre>"},{"location":"010Java/030Algorithm/#_46","title":"\u4f7f\u7528\u793a\u4f8b","text":"<pre><code>View view1 = findViewById(R.id.view1);\nView view2 = findViewById(R.id.view2);\nView lca = findLowestCommonAncestorOptimized(view1, view2);\n\nif (lca != null) {\n    Log.d(\"LCA\", \"\u6700\u8fd1\u516c\u5171\u7956\u5148\u7684ID: \" + (lca.getId() == View.NO_ID ? \"\u65e0ID\" : getResources().getResourceName(lca.getId())));\n} else {\n    Log.d(\"LCA\", \"\u6ca1\u6709\u627e\u5230\u516c\u5171\u7956\u5148\");\n}\n</code></pre>"},{"location":"010Java/030Algorithm/#_47","title":"\u6ce8\u610f\u4e8b\u9879","text":"<ol> <li>\u8fd9\u4e9b\u65b9\u6cd5\u9002\u7528\u4e8e\u4efb\u4f55Android\u89c6\u56fe\u5c42\u6b21\u7ed3\u6784\uff0c\u5305\u62ecActivity\u3001Fragment\u548c\u81ea\u5b9a\u4e49ViewGroup</li> <li>\u5982\u679c\u4e24\u4e2a\u89c6\u56fe\u4e0d\u5728\u540c\u4e00\u4e2a\u89c6\u56fe\u6811\u4e2d\uff0c\u5c06\u8fd4\u56denull</li> <li>\u65b9\u6cd5\u4e8c(\u4f18\u5316\u7248\u672c)\u901a\u5e38\u6027\u80fd\u6700\u597d\uff0c\u56e0\u4e3a\u5b83\u4e0d\u9700\u8981\u5b58\u50a8\u6574\u4e2a\u7956\u5148\u5217\u8868</li> <li>\u5728\u590d\u6742\u7684\u89c6\u56fe\u5c42\u6b21\u7ed3\u6784\u4e2d\uff0c\u9012\u5f52\u65b9\u6cd5\u53ef\u80fd\u4f1a\u5bfc\u81f4\u6808\u6ea2\u51fa</li> </ol> <p>\u9009\u62e9\u54ea\u79cd\u65b9\u6cd5\u53d6\u51b3\u4e8e\u4f60\u7684\u5177\u4f53\u9700\u6c42\u548c\u89c6\u56fe\u6811\u7684\u590d\u6742\u5ea6\u3002\u5bf9\u4e8e\u5927\u591a\u6570\u60c5\u51b5\uff0c\u65b9\u6cd5\u4e8c(\u4f18\u5316\u7248\u672c)\u662f\u6700\u4f73\u9009\u62e9\u3002</p>"},{"location":"010Java/030Algorithm/#_48","title":"\u4e8c\u53c9\u6811\uff0c\u8bfb\u53d6\u6bcf\u4e00\u5c42\u6700\u53f3\u8fb9\u7684\u8282\u70b9","text":"\u7b54\u6848"},{"location":"010Java/030Algorithm/#java_5","title":"\u83b7\u53d6\u4e8c\u53c9\u6811\u6bcf\u4e00\u5c42\u6700\u53f3\u8fb9\u7684\u8282\u70b9\uff08Java\u5b9e\u73b0\uff09","text":"<p>\u8981\u83b7\u53d6\u4e8c\u53c9\u6811\u6bcf\u4e00\u5c42\u6700\u53f3\u8fb9\u7684\u8282\u70b9\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u5e7f\u5ea6\u4f18\u5148\u641c\u7d22\uff08BFS\uff09\u7b97\u6cd5\uff0c\u4e5f\u79f0\u4e3a\u5c42\u5e8f\u904d\u5386\u3002\u5728\u904d\u5386\u6bcf\u4e00\u5c42\u65f6\uff0c\u8bb0\u5f55\u8be5\u5c42\u7684\u6700\u540e\u4e00\u4e2a\u8282\u70b9\u5373\u53ef\u3002</p> <p>\u4ee5\u4e0b\u662fJava\u5b9e\u73b0\uff1a</p> <pre><code>import java.util.ArrayList;\nimport java.util.LinkedList;\nimport java.util.List;\nimport java.util.Queue;\n\nclass TreeNode {\n    int val;\n    TreeNode left;\n    TreeNode right;\n    TreeNode(int x) { val = x; }\n}\n\npublic class RightSideView {\n    public List&lt;Integer&gt; rightSideView(TreeNode root) {\n        List&lt;Integer&gt; result = new ArrayList&lt;&gt;();\n        if (root == null) {\n            return result;\n        }\n\n        Queue&lt;TreeNode&gt; queue = new LinkedList&lt;&gt;();\n        queue.offer(root);\n\n        while (!queue.isEmpty()) {\n            int levelSize = queue.size();\n\n            for (int i = 0; i &lt; levelSize; i++) {\n                TreeNode currentNode = queue.poll();\n\n                // \u5982\u679c\u662f\u5f53\u524d\u5c42\u7684\u6700\u540e\u4e00\u4e2a\u8282\u70b9\uff0c\u52a0\u5165\u7ed3\u679c\u5217\u8868\n                if (i == levelSize - 1) {\n                    result.add(currentNode.val);\n                }\n\n                // \u6dfb\u52a0\u5b50\u8282\u70b9\u5230\u961f\u5217\n                if (currentNode.left != null) {\n                    queue.offer(currentNode.left);\n                }\n                if (currentNode.right != null) {\n                    queue.offer(currentNode.right);\n                }\n            }\n        }\n\n        return result;\n    }\n\n    // \u6d4b\u8bd5\u4ee3\u7801\n    public static void main(String[] args) {\n        // \u6784\u5efa\u6d4b\u8bd5\u4e8c\u53c9\u6811\n        //       1\n        //      / \\\n        //     2   3\n        //      \\   \\\n        //       5   4\n        TreeNode root = new TreeNode(1);\n        root.left = new TreeNode(2);\n        root.right = new TreeNode(3);\n        root.left.right = new TreeNode(5);\n        root.right.right = new TreeNode(4);\n\n        RightSideView solution = new RightSideView();\n        List&lt;Integer&gt; rightView = solution.rightSideView(root);\n        System.out.println(rightView); // \u8f93\u51fa: [1, 3, 4]\n    }\n}\n</code></pre>"},{"location":"010Java/030Algorithm/#_49","title":"\u7b97\u6cd5\u8bf4\u660e","text":"<ol> <li>\u521d\u59cb\u5316\uff1a\u521b\u5efa\u4e00\u4e2a\u961f\u5217\u7528\u4e8eBFS\u904d\u5386\uff0c\u4e00\u4e2a\u5217\u8868\u5b58\u50a8\u7ed3\u679c\u3002</li> <li>\u5904\u7406\u6839\u8282\u70b9\uff1a\u5982\u679c\u6839\u8282\u70b9\u4e0d\u4e3a\u7a7a\uff0c\u5c06\u5176\u52a0\u5165\u961f\u5217\u3002</li> <li>\u5c42\u5e8f\u904d\u5386\uff1a</li> <li>\u6bcf\u6b21\u5904\u7406\u4e00\u5c42\u8282\u70b9</li> <li>\u8bb0\u5f55\u5f53\u524d\u5c42\u7684\u8282\u70b9\u6570</li> <li>\u904d\u5386\u5f53\u524d\u5c42\u7684\u6240\u6709\u8282\u70b9\uff0c\u5c06\u6bcf\u4e2a\u8282\u70b9\u7684\u5de6\u53f3\u5b50\u8282\u70b9\u52a0\u5165\u961f\u5217</li> <li>\u5f53\u524d\u5c42\u7684\u6700\u540e\u4e00\u4e2a\u8282\u70b9\u5373\u4e3a\u8be5\u5c42\u6700\u53f3\u8fb9\u7684\u8282\u70b9\uff0c\u5c06\u5176\u503c\u52a0\u5165\u7ed3\u679c\u5217\u8868</li> <li>\u8fd4\u56de\u7ed3\u679c\uff1a\u5f53\u961f\u5217\u4e3a\u7a7a\u65f6\uff0c\u904d\u5386\u7ed3\u675f\uff0c\u8fd4\u56de\u7ed3\u679c\u5217\u8868</li> </ol>"},{"location":"010Java/030Algorithm/#_50","title":"\u590d\u6742\u5ea6\u5206\u6790","text":"<ul> <li>\u65f6\u95f4\u590d\u6742\u5ea6\uff1aO(n)\uff0c\u5176\u4e2dn\u662f\u4e8c\u53c9\u6811\u7684\u8282\u70b9\u6570\uff0c\u6bcf\u4e2a\u8282\u70b9\u6070\u597d\u88ab\u8bbf\u95ee\u4e00\u6b21</li> <li>\u7a7a\u95f4\u590d\u6742\u5ea6\uff1aO(n)\uff0c\u961f\u5217\u4e2d\u6700\u591a\u5b58\u50a8\u4e00\u5c42\u8282\u70b9\uff0c\u6700\u574f\u60c5\u51b5\u4e0b\u662fO(n)</li> </ul> <p>\u8fd9\u79cd\u65b9\u6cd5\u9ad8\u6548\u4e14\u76f4\u89c2\u5730\u89e3\u51b3\u4e86\u95ee\u9898\uff0c\u9002\u7528\u4e8e\u4efb\u4f55\u4e8c\u53c9\u6811\u7ed3\u6784\u3002</p>"},{"location":"010Java/040MultiThreading/","title":"\u591a\u7ebf\u7a0b\u76f8\u5173","text":""},{"location":"010Java/040MultiThreading/#_2","title":"\u4ec0\u4e48\u5bfc\u81f4\u7ebf\u7a0b\u963b\u585e","text":"\u7b54\u6848 <p>\u5728Java\u4e2d\uff0c\u7ebf\u7a0b\u963b\u585e\u662f\u6307\u7ebf\u7a0b\u6682\u65f6\u505c\u6b62\u6267\u884c\uff0c\u901a\u5e38\u662f\u7531\u4e8e\u67d0\u4e9b\u6761\u4ef6\u672a\u6ee1\u8db3\u6216\u8d44\u6e90\u4e0d\u53ef\u7528\u3002\u4ee5\u4e0b\u662f\u5bfc\u81f4\u7ebf\u7a0b\u963b\u585e\u7684\u5e38\u89c1\u539f\u56e0\uff1a</p>"},{"location":"010Java/040MultiThreading/#1-io","title":"1. I/O\u64cd\u4f5c","text":"<ul> <li>\u7ebf\u7a0b\u5728\u6267\u884cI/O\u64cd\u4f5c\uff08\u5982\u6587\u4ef6\u8bfb\u5199\u3001\u7f51\u7edc\u901a\u4fe1\uff09\u65f6\uff0c\u5982\u679c\u6570\u636e\u672a\u51c6\u5907\u597d\u6216I/O\u64cd\u4f5c\u672a\u5b8c\u6210\uff0c\u7ebf\u7a0b\u4f1a\u8fdb\u5165\u963b\u585e\u72b6\u6001\uff0c\u76f4\u5230\u64cd\u4f5c\u5b8c\u6210\u3002</li> </ul>"},{"location":"010Java/040MultiThreading/#2","title":"2. \u7b49\u5f85\u9501","text":"<ul> <li>\u5f53\u7ebf\u7a0b\u5c1d\u8bd5\u83b7\u53d6\u4e00\u4e2a\u5df2\u88ab\u5176\u4ed6\u7ebf\u7a0b\u6301\u6709\u7684\u9501\u65f6\uff08\u5982<code>synchronized</code>\u5757\u6216<code>ReentrantLock</code>\uff09\uff0c\u5b83\u4f1a\u8fdb\u5165\u963b\u585e\u72b6\u6001\uff0c\u76f4\u5230\u9501\u88ab\u91ca\u653e\u3002</li> </ul>"},{"location":"010Java/040MultiThreading/#3-objectwait","title":"3. \u8c03\u7528<code>Object.wait()</code>","text":"<ul> <li>\u7ebf\u7a0b\u8c03\u7528<code>Object.wait()</code>\u65f6\u4f1a\u91ca\u653e\u9501\u5e76\u8fdb\u5165\u7b49\u5f85\u72b6\u6001\uff0c\u76f4\u5230\u5176\u4ed6\u7ebf\u7a0b\u8c03\u7528<code>notify()</code>\u6216<code>notifyAll()</code>\u5c06\u5176\u5524\u9192\u3002</li> </ul>"},{"location":"010Java/040MultiThreading/#4-threadsleep","title":"4. \u8c03\u7528<code>Thread.sleep()</code>","text":"<ul> <li>\u7ebf\u7a0b\u8c03\u7528<code>Thread.sleep()</code>\u4f1a\u4e3b\u52a8\u8fdb\u5165\u963b\u585e\u72b6\u6001\uff0c\u6682\u505c\u6267\u884c\u6307\u5b9a\u7684\u65f6\u95f4\u3002</li> </ul>"},{"location":"010Java/040MultiThreading/#5-threadjoin","title":"5. \u8c03\u7528<code>Thread.join()</code>","text":"<ul> <li>\u5f53\u4e00\u4e2a\u7ebf\u7a0b\u8c03\u7528\u53e6\u4e00\u4e2a\u7ebf\u7a0b\u7684<code>join()</code>\u65b9\u6cd5\u65f6\uff0c\u5b83\u4f1a\u7b49\u5f85\u88ab\u8c03\u7528\u7ebf\u7a0b\u6267\u884c\u5b8c\u6bd5\uff0c\u671f\u95f4\u5904\u4e8e\u963b\u585e\u72b6\u6001\u3002</li> </ul>"},{"location":"010Java/040MultiThreading/#6","title":"6. \u7b49\u5f85\u6761\u4ef6\u53d8\u91cf","text":"<ul> <li>\u5728\u4f7f\u7528<code>Condition</code>\u5bf9\u8c61\u65f6\uff0c\u7ebf\u7a0b\u8c03\u7528<code>await()</code>\u65b9\u6cd5\u4f1a\u8fdb\u5165\u963b\u585e\u72b6\u6001\uff0c\u76f4\u5230\u5176\u4ed6\u7ebf\u7a0b\u8c03\u7528<code>signal()</code>\u6216<code>signalAll()</code>\u5c06\u5176\u5524\u9192\u3002</li> </ul>"},{"location":"010Java/040MultiThreading/#7","title":"7. \u7ebf\u7a0b\u6c60\u4efb\u52a1\u961f\u5217","text":"<ul> <li>\u5728\u7ebf\u7a0b\u6c60\u4e2d\uff0c\u5982\u679c\u4efb\u52a1\u961f\u5217\u5df2\u6ee1\u4e14\u7ebf\u7a0b\u6c60\u8fbe\u5230\u6700\u5927\u7ebf\u7a0b\u6570\uff0c\u65b0\u63d0\u4ea4\u7684\u4efb\u52a1\u4f1a\u4f7f\u7ebf\u7a0b\u963b\u585e\uff0c\u76f4\u5230\u961f\u5217\u6709\u7a7a\u95f2\u7a7a\u95f4\u3002</li> </ul>"},{"location":"010Java/040MultiThreading/#8","title":"8. \u7f51\u7edc\u901a\u4fe1","text":"<ul> <li>\u5728\u7f51\u7edc\u7f16\u7a0b\u4e2d\uff0c\u7ebf\u7a0b\u5728\u7b49\u5f85\u6570\u636e\u5230\u8fbe\u6216\u8fde\u63a5\u5efa\u7acb\u65f6\uff0c\u53ef\u80fd\u4f1a\u56e0\u7f51\u7edc\u5ef6\u8fdf\u6216\u6570\u636e\u672a\u5230\u8fbe\u800c\u963b\u585e\u3002</li> </ul>"},{"location":"010Java/040MultiThreading/#9","title":"9. \u6b7b\u9501","text":"<ul> <li>\u5f53\u591a\u4e2a\u7ebf\u7a0b\u4e92\u76f8\u7b49\u5f85\u5bf9\u65b9\u91ca\u653e\u9501\u65f6\uff0c\u4f1a\u5bfc\u81f4\u6240\u6709\u76f8\u5173\u7ebf\u7a0b\u6c38\u4e45\u963b\u585e\uff0c\u5f62\u6210\u6b7b\u9501\u3002</li> </ul>"},{"location":"010Java/040MultiThreading/#10","title":"10. \u8d44\u6e90\u7ade\u4e89","text":"<ul> <li>\u5f53\u591a\u4e2a\u7ebf\u7a0b\u7ade\u4e89\u6709\u9650\u8d44\u6e90\uff08\u5982\u6570\u636e\u5e93\u8fde\u63a5\uff09\u65f6\uff0c\u672a\u83b7\u5f97\u8d44\u6e90\u7684\u7ebf\u7a0b\u4f1a\u963b\u585e\uff0c\u76f4\u5230\u8d44\u6e90\u53ef\u7528\u3002</li> </ul>"},{"location":"010Java/040MultiThreading/#_3","title":"\u603b\u7ed3","text":"<p>\u7ebf\u7a0b\u963b\u585e\u901a\u5e38\u662f\u7531\u4e8e\u7b49\u5f85\u8d44\u6e90\u3001\u9501\u3001I/O\u64cd\u4f5c\u6216\u5176\u4ed6\u7ebf\u7a0b\u7684\u5b8c\u6210\u3002\u7406\u89e3\u8fd9\u4e9b\u539f\u56e0\u6709\u52a9\u4e8e\u7f16\u5199\u9ad8\u6548\u3001\u7a33\u5b9a\u7684\u591a\u7ebf\u7a0b\u7a0b\u5e8f\u3002</p>"},{"location":"010Java/040MultiThreading/#_4","title":"\u7ebf\u7a0b\u5982\u4f55\u5173\u95ed\uff1f","text":"\u7b54\u6848 <p>\u5728Java\u4e2d\uff0c\u5173\u95ed\u6216\u7ec8\u6b62\u7ebf\u7a0b\u662f\u4e00\u4e2a\u9700\u8981\u8c28\u614e\u5904\u7406\u7684\u64cd\u4f5c\uff0c\u56e0\u4e3a\u76f4\u63a5\u5f3a\u5236\u7ec8\u6b62\u7ebf\u7a0b\u53ef\u80fd\u4f1a\u5bfc\u81f4\u8d44\u6e90\u672a\u91ca\u653e\u3001\u6570\u636e\u4e0d\u4e00\u81f4\u7b49\u95ee\u9898\u3002\u4ee5\u4e0b\u662f\u51e0\u79cd\u5e38\u89c1\u7684\u5173\u95ed\u7ebf\u7a0b\u7684\u65b9\u5f0f\uff1a</p>"},{"location":"010Java/040MultiThreading/#1","title":"1. \u81ea\u7136\u7ec8\u6b62","text":"<p>\u7ebf\u7a0b\u5728\u6267\u884c\u5b8c<code>run()</code>\u65b9\u6cd5\u4e2d\u7684\u4ee3\u7801\u540e\u4f1a\u81ea\u7136\u7ec8\u6b62\u3002\u8fd9\u662f\u6700\u5b89\u5168\u548c\u63a8\u8350\u7684\u65b9\u5f0f\u3002</p> <pre><code>Thread thread = new Thread(() -&gt; {\n    System.out.println(\"Thread is running\");\n    // \u7ebf\u7a0b\u6267\u884c\u5b8c\u6bd5\uff0c\u81ea\u52a8\u7ec8\u6b62\n});\nthread.start();\n</code></pre>"},{"location":"010Java/040MultiThreading/#2_1","title":"2. \u4f7f\u7528\u6807\u5fd7\u4f4d\u63a7\u5236\u7ebf\u7a0b\u9000\u51fa","text":"<p>\u901a\u8fc7\u8bbe\u7f6e\u4e00\u4e2a\u6807\u5fd7\u4f4d\uff08\u5982<code>volatile boolean</code>\u53d8\u91cf\uff09\uff0c\u7ebf\u7a0b\u53ef\u4ee5\u5728<code>run()</code>\u65b9\u6cd5\u4e2d\u5b9a\u671f\u68c0\u67e5\u8be5\u6807\u5fd7\u4f4d\uff0c\u4ece\u800c\u5b89\u5168\u5730\u9000\u51fa\u3002</p> <pre><code>public class SafeShutdownExample {\n    private volatile boolean running = true;\n\n    public void stop() {\n        running = false;\n    }\n\n    public void run() {\n        while (running) {\n            System.out.println(\"Thread is running\");\n            try {\n                Thread.sleep(1000);\n            } catch (InterruptedException e) {\n                Thread.currentThread().interrupt(); // \u6062\u590d\u4e2d\u65ad\u72b6\u6001\n                System.out.println(\"Thread was interrupted\");\n                break;\n            }\n        }\n        System.out.println(\"Thread is stopped\");\n    }\n\n    public static void main(String[] args) throws InterruptedException {\n        SafeShutdownExample example = new SafeShutdownExample();\n        Thread thread = new Thread(example::run);\n        thread.start();\n\n        Thread.sleep(3000); // \u4e3b\u7ebf\u7a0b\u7b49\u5f853\u79d2\n        example.stop(); // \u505c\u6b62\u7ebf\u7a0b\n    }\n}\n</code></pre>"},{"location":"010Java/040MultiThreading/#3-interrupt","title":"3. \u4f7f\u7528<code>interrupt()</code>\u4e2d\u65ad\u7ebf\u7a0b","text":"<p>\u901a\u8fc7\u8c03\u7528\u7ebf\u7a0b\u7684<code>interrupt()</code>\u65b9\u6cd5\uff0c\u53ef\u4ee5\u5411\u7ebf\u7a0b\u53d1\u9001\u4e2d\u65ad\u4fe1\u53f7\u3002\u7ebf\u7a0b\u9700\u8981\u68c0\u67e5\u4e2d\u65ad\u72b6\u6001\u5e76\u505a\u51fa\u54cd\u5e94\u3002</p> <pre><code>public class InterruptExample {\n    public static void main(String[] args) throws InterruptedException {\n        Thread thread = new Thread(() -&gt; {\n            while (!Thread.currentThread().isInterrupted()) {\n                System.out.println(\"Thread is running\");\n                try {\n                    Thread.sleep(1000);\n                } catch (InterruptedException e) {\n                    System.out.println(\"Thread was interrupted\");\n                    Thread.currentThread().interrupt(); // \u91cd\u65b0\u8bbe\u7f6e\u4e2d\u65ad\u72b6\u6001\n                    break;\n                }\n            }\n            System.out.println(\"Thread is stopped\");\n        });\n\n        thread.start();\n        Thread.sleep(3000); // \u4e3b\u7ebf\u7a0b\u7b49\u5f853\u79d2\n        thread.interrupt(); // \u4e2d\u65ad\u7ebf\u7a0b\n    }\n}\n</code></pre>"},{"location":"010Java/040MultiThreading/#4-executorservice","title":"4. \u4f7f\u7528<code>ExecutorService</code>\u5173\u95ed\u7ebf\u7a0b\u6c60","text":"<p>\u5982\u679c\u4f7f\u7528\u7ebf\u7a0b\u6c60\uff08\u5982<code>ExecutorService</code>\uff09\uff0c\u53ef\u4ee5\u901a\u8fc7\u8c03\u7528<code>shutdown()</code>\u6216<code>shutdownNow()</code>\u6765\u5173\u95ed\u7ebf\u7a0b\u6c60\u3002</p> <ul> <li><code>shutdown()</code>\uff1a\u7b49\u5f85\u5df2\u63d0\u4ea4\u7684\u4efb\u52a1\u6267\u884c\u5b8c\u6bd5\uff0c\u7136\u540e\u5173\u95ed\u7ebf\u7a0b\u6c60\u3002</li> <li><code>shutdownNow()</code>\uff1a\u5c1d\u8bd5\u7acb\u5373\u505c\u6b62\u6240\u6709\u6b63\u5728\u6267\u884c\u7684\u4efb\u52a1\uff0c\u5e76\u8fd4\u56de\u7b49\u5f85\u6267\u884c\u7684\u4efb\u52a1\u5217\u8868\u3002</li> </ul> <pre><code>import java.util.concurrent.ExecutorService;\nimport java.util.concurrent.Executors;\n\npublic class ExecutorShutdownExample {\n    public static void main(String[] args) {\n        ExecutorService executor = Executors.newFixedThreadPool(2);\n\n        executor.submit(() -&gt; {\n            System.out.println(\"Task 1 is running\");\n            try {\n                Thread.sleep(2000);\n            } catch (InterruptedException e) {\n                System.out.println(\"Task 1 was interrupted\");\n            }\n        });\n\n        executor.submit(() -&gt; {\n            System.out.println(\"Task 2 is running\");\n            try {\n                Thread.sleep(2000);\n            } catch (InterruptedException e) {\n                System.out.println(\"Task 2 was interrupted\");\n            }\n        });\n\n        executor.shutdown(); // \u4f18\u96c5\u5173\u95ed\n        // executor.shutdownNow(); // \u7acb\u5373\u5173\u95ed\n    }\n}\n</code></pre>"},{"location":"010Java/040MultiThreading/#5-stopsuspendresume","title":"5. \u4e0d\u63a8\u8350\u7684\u65b9\u5f0f\uff1a<code>stop()</code>\u3001<code>suspend()</code>\u548c<code>resume()</code>","text":"<ul> <li><code>stop()</code>\uff1a\u5f3a\u5236\u7ec8\u6b62\u7ebf\u7a0b\uff0c\u5df2\u5f03\u7528\u3002\u53ef\u80fd\u5bfc\u81f4\u8d44\u6e90\u672a\u91ca\u653e\u6216\u6570\u636e\u4e0d\u4e00\u81f4\u3002</li> <li><code>suspend()</code>\uff1a\u6682\u505c\u7ebf\u7a0b\uff0c\u5df2\u5f03\u7528\u3002\u53ef\u80fd\u5bfc\u81f4\u6b7b\u9501\u3002</li> <li><code>resume()</code>\uff1a\u6062\u590d\u88ab\u6682\u505c\u7684\u7ebf\u7a0b\uff0c\u5df2\u5f03\u7528\u3002</li> </ul> <p>\u8fd9\u4e9b\u65b9\u6cd5\u5df2\u88ab\u6807\u8bb0\u4e3a<code>@Deprecated</code>\uff0c\u4e0d\u63a8\u8350\u4f7f\u7528\u3002</p>"},{"location":"010Java/040MultiThreading/#6-daemon-thread","title":"6. \u5b88\u62a4\u7ebf\u7a0b\uff08Daemon Thread\uff09","text":"<p>\u5b88\u62a4\u7ebf\u7a0b\u662f\u4e00\u79cd\u540e\u53f0\u7ebf\u7a0b\uff0c\u5f53\u6240\u6709\u975e\u5b88\u62a4\u7ebf\u7a0b\u7ed3\u675f\u65f6\uff0cJVM\u4f1a\u81ea\u52a8\u9000\u51fa\uff0c\u5b88\u62a4\u7ebf\u7a0b\u4e5f\u4f1a\u88ab\u5f3a\u5236\u7ec8\u6b62\u3002</p> <pre><code>Thread daemonThread = new Thread(() -&gt; {\n    while (true) {\n        System.out.println(\"Daemon thread is running\");\n        try {\n            Thread.sleep(1000);\n        } catch (InterruptedException e) {\n            System.out.println(\"Daemon thread was interrupted\");\n            break;\n        }\n    }\n});\ndaemonThread.setDaemon(true); // \u8bbe\u7f6e\u4e3a\u5b88\u62a4\u7ebf\u7a0b\ndaemonThread.start();\n</code></pre>"},{"location":"010Java/040MultiThreading/#_5","title":"\u603b\u7ed3","text":"\u65b9\u6cd5 \u7279\u70b9 \u81ea\u7136\u7ec8\u6b62 \u7ebf\u7a0b\u6267\u884c\u5b8c\u4efb\u52a1\u540e\u81ea\u52a8\u7ec8\u6b62\uff0c\u6700\u5b89\u5168\u3002 \u6807\u5fd7\u4f4d\u63a7\u5236 \u901a\u8fc7\u6807\u5fd7\u4f4d\u63a7\u5236\u7ebf\u7a0b\u9000\u51fa\uff0c\u63a8\u8350\u4f7f\u7528\u3002 <code>interrupt()</code> \u53d1\u9001\u4e2d\u65ad\u4fe1\u53f7\uff0c\u7ebf\u7a0b\u9700\u68c0\u67e5\u4e2d\u65ad\u72b6\u6001\u5e76\u54cd\u5e94\u3002 <code>ExecutorService</code> \u9002\u7528\u4e8e\u7ebf\u7a0b\u6c60\uff0c\u63d0\u4f9b\u4f18\u96c5\u5173\u95ed\u548c\u5f3a\u5236\u5173\u95ed\u9009\u9879\u3002 \u4e0d\u63a8\u8350\u7684\u65b9\u5f0f <code>stop()</code>\u3001<code>suspend()</code>\u3001<code>resume()</code>\uff0c\u5df2\u5f03\u7528\uff0c\u53ef\u80fd\u5bfc\u81f4\u95ee\u9898\u3002 \u5b88\u62a4\u7ebf\u7a0b \u5f53\u6240\u6709\u975e\u5b88\u62a4\u7ebf\u7a0b\u7ed3\u675f\u65f6\uff0cJVM\u4f1a\u81ea\u52a8\u7ec8\u6b62\u5b88\u62a4\u7ebf\u7a0b\u3002 <p>\u63a8\u8350\u4f7f\u7528\u6807\u5fd7\u4f4d\u63a7\u5236\u6216<code>interrupt()</code>\u6765\u5b89\u5168\u5730\u5173\u95ed\u7ebf\u7a0b\uff0c\u907f\u514d\u4f7f\u7528\u5df2\u5f03\u7528\u7684\u65b9\u6cd5\u3002</p>"},{"location":"010Java/040MultiThreading/#java","title":"\u8bb2\u4e00\u4e0b Java \u4e2d\u7684\u540c\u6b65\u7684\u65b9\u6cd5\uff0c\u5982\u4f55\u5b9e\u73b0\u7ebf\u7a0b\u540c\u6b65\uff1f","text":"\u7b54\u6848 <p>\u5728 Java \u4e2d\uff0c\u540c\u6b65\uff08Synchronization\uff09\u662f\u7528\u4e8e\u63a7\u5236\u591a\u4e2a\u7ebf\u7a0b\u5bf9\u5171\u4eab\u8d44\u6e90\u7684\u8bbf\u95ee\uff0c\u4ee5\u907f\u514d\u6570\u636e\u4e0d\u4e00\u81f4\u548c\u7ebf\u7a0b\u5e72\u6270\u3002Java \u63d0\u4f9b\u4e86\u591a\u79cd\u540c\u6b65\u673a\u5236\uff0c\u4ee5\u4e0b\u662f\u4e3b\u8981\u7684\u540c\u6b65\u65b9\u6cd5\uff1a</p>"},{"location":"010Java/040MultiThreading/#1-synchronized","title":"1. synchronized \u5173\u952e\u5b57","text":"<p><code>synchronized</code> \u662f Java \u4e2d\u6700\u5e38\u7528\u7684\u540c\u6b65\u673a\u5236\uff0c\u5b83\u53ef\u4ee5\u7528\u4e8e\u65b9\u6cd5\u6216\u4ee3\u7801\u5757\uff0c\u786e\u4fdd\u540c\u4e00\u65f6\u95f4\u53ea\u6709\u4e00\u4e2a\u7ebf\u7a0b\u53ef\u4ee5\u6267\u884c\u88ab\u540c\u6b65\u7684\u4ee3\u7801\u3002</p> <ul> <li> <p>\u540c\u6b65\u5b9e\u4f8b\u65b9\u6cd5\uff1a <pre><code>public synchronized void method() {\n    // \u540c\u6b65\u4ee3\u7801\n}\n</code></pre> \u5f53\u4e00\u4e2a\u7ebf\u7a0b\u8bbf\u95ee\u4e00\u4e2a\u5bf9\u8c61\u7684\u540c\u6b65\u5b9e\u4f8b\u65b9\u6cd5\u65f6\uff0c\u5176\u4ed6\u7ebf\u7a0b\u65e0\u6cd5\u8bbf\u95ee\u8be5\u5bf9\u8c61\u7684\u4efb\u4f55\u540c\u6b65\u5b9e\u4f8b\u65b9\u6cd5\uff0c\u4f46\u53ef\u4ee5\u8bbf\u95ee\u975e\u540c\u6b65\u65b9\u6cd5\u3002</p> </li> <li> <p>\u540c\u6b65\u9759\u6001\u65b9\u6cd5\uff1a <pre><code>public static synchronized void staticMethod() {\n    // \u540c\u6b65\u4ee3\u7801\n}\n</code></pre> \u540c\u6b65\u9759\u6001\u65b9\u6cd5\u9501\u5b9a\u7684\u662f\u7c7b\u7684 <code>Class</code> \u5bf9\u8c61\uff0c\u56e0\u6b64\u540c\u4e00\u65f6\u95f4\u53ea\u6709\u4e00\u4e2a\u7ebf\u7a0b\u53ef\u4ee5\u8bbf\u95ee\u8be5\u7c7b\u7684\u4efb\u4f55\u540c\u6b65\u9759\u6001\u65b9\u6cd5\u3002</p> </li> <li> <p>\u540c\u6b65\u4ee3\u7801\u5757\uff1a <pre><code>public void method() {\n    synchronized (this) {\n        // \u540c\u6b65\u4ee3\u7801\n    }\n}\n</code></pre> \u540c\u6b65\u4ee3\u7801\u5757\u5141\u8bb8\u4f60\u66f4\u7ec6\u7c92\u5ea6\u5730\u63a7\u5236\u540c\u6b65\uff0c\u53ef\u4ee5\u6307\u5b9a\u9501\u5bf9\u8c61\uff08\u5982 <code>this</code> \u6216\u67d0\u4e2a\u7279\u5b9a\u5bf9\u8c61\uff09\u3002</p> </li> </ul>"},{"location":"010Java/040MultiThreading/#2-reentrantlock","title":"2. ReentrantLock","text":"<p><code>ReentrantLock</code> \u662f <code>java.util.concurrent.locks</code> \u5305\u4e2d\u7684\u4e00\u4e2a\u7c7b\uff0c\u5b83\u63d0\u4f9b\u4e86\u6bd4 <code>synchronized</code> \u66f4\u7075\u6d3b\u7684\u9501\u5b9a\u673a\u5236\u3002</p> <ul> <li>\u57fa\u672c\u7528\u6cd5\uff1a <pre><code>import java.util.concurrent.locks.Lock;\nimport java.util.concurrent.locks.ReentrantLock;\n\npublic class Example {\n    private final Lock lock = new ReentrantLock();\n\n    public void method() {\n        lock.lock();  // \u83b7\u53d6\u9501\n        try {\n            // \u540c\u6b65\u4ee3\u7801\n        } finally {\n            lock.unlock();  // \u91ca\u653e\u9501\n        }\n    }\n}\n</code></pre> <code>ReentrantLock</code> \u5141\u8bb8\u66f4\u590d\u6742\u7684\u64cd\u4f5c\uff0c\u5982\u5c1d\u8bd5\u83b7\u53d6\u9501\u3001\u8d85\u65f6\u83b7\u53d6\u9501\u3001\u53ef\u4e2d\u65ad\u83b7\u53d6\u9501\u7b49\u3002</li> </ul>"},{"location":"010Java/040MultiThreading/#3-volatile","title":"3. volatile \u5173\u952e\u5b57","text":"<p><code>volatile</code> \u5173\u952e\u5b57\u7528\u4e8e\u4fee\u9970\u53d8\u91cf\uff0c\u786e\u4fdd\u53d8\u91cf\u7684\u53ef\u89c1\u6027\u3002\u5f53\u4e00\u4e2a\u7ebf\u7a0b\u4fee\u6539\u4e86 <code>volatile</code> \u53d8\u91cf\u7684\u503c\uff0c\u5176\u4ed6\u7ebf\u7a0b\u53ef\u4ee5\u7acb\u5373\u770b\u5230\u8fd9\u4e2a\u4fee\u6539\u3002</p> <ul> <li>\u793a\u4f8b\uff1a <pre><code>public class Example {\n    private volatile boolean flag = false;\n\n    public void toggleFlag() {\n        flag = !flag;\n    }\n\n    public boolean isFlag() {\n        return flag;\n    }\n}\n</code></pre> <code>volatile</code> \u9002\u7528\u4e8e\u7b80\u5355\u7684\u72b6\u6001\u6807\u5fd7\uff0c\u4f46\u4e0d\u80fd\u4fdd\u8bc1\u590d\u5408\u64cd\u4f5c\u7684\u539f\u5b50\u6027\u3002</li> </ul>"},{"location":"010Java/040MultiThreading/#4-atomic","title":"4. Atomic \u7c7b","text":"<p><code>java.util.concurrent.atomic</code> \u5305\u63d0\u4f9b\u4e86\u4e00\u7cfb\u5217\u539f\u5b50\u7c7b\uff08\u5982 <code>AtomicInteger</code>, <code>AtomicLong</code>, <code>AtomicReference</code> \u7b49\uff09\uff0c\u8fd9\u4e9b\u7c7b\u901a\u8fc7 CAS\uff08Compare-And-Swap\uff09\u64cd\u4f5c\u4fdd\u8bc1\u4e86\u539f\u5b50\u6027\u3002</p> <ul> <li>\u793a\u4f8b\uff1a <pre><code>import java.util.concurrent.atomic.AtomicInteger;\n\npublic class Example {\n    private AtomicInteger counter = new AtomicInteger(0);\n\n    public void increment() {\n        counter.incrementAndGet();\n    }\n\n    public int getCounter() {\n        return counter.get();\n    }\n}\n</code></pre> \u539f\u5b50\u7c7b\u9002\u7528\u4e8e\u9700\u8981\u539f\u5b50\u64cd\u4f5c\u7684\u573a\u666f\uff0c\u5982\u8ba1\u6570\u5668\u3001\u6807\u5fd7\u4f4d\u7b49\u3002</li> </ul>"},{"location":"010Java/040MultiThreading/#5-countdownlatchcyclicbarrier-semaphore","title":"5. CountDownLatch\u3001CyclicBarrier \u548c Semaphore","text":"<p>\u8fd9\u4e9b\u662f <code>java.util.concurrent</code> \u5305\u4e2d\u7684\u540c\u6b65\u5de5\u5177\u7c7b\uff0c\u7528\u4e8e\u66f4\u590d\u6742\u7684\u7ebf\u7a0b\u540c\u6b65\u573a\u666f\u3002</p> <ul> <li>CountDownLatch\uff1a\u5141\u8bb8\u4e00\u4e2a\u6216\u591a\u4e2a\u7ebf\u7a0b\u7b49\u5f85\u5176\u4ed6\u7ebf\u7a0b\u5b8c\u6210\u64cd\u4f5c\u3002</li> <li>CyclicBarrier\uff1a\u8ba9\u4e00\u7ec4\u7ebf\u7a0b\u4e92\u76f8\u7b49\u5f85\uff0c\u76f4\u5230\u6240\u6709\u7ebf\u7a0b\u90fd\u5230\u8fbe\u67d0\u4e2a\u5c4f\u969c\u70b9\u3002</li> <li>Semaphore\uff1a\u63a7\u5236\u540c\u65f6\u8bbf\u95ee\u67d0\u4e2a\u8d44\u6e90\u7684\u7ebf\u7a0b\u6570\u91cf\u3002</li> </ul>"},{"location":"010Java/040MultiThreading/#6-wait-notifynotifyall","title":"6. wait() \u548c notify()/notifyAll()","text":"<p><code>wait()</code>\u3001<code>notify()</code> \u548c <code>notifyAll()</code> \u662f <code>Object</code> \u7c7b\u7684\u65b9\u6cd5\uff0c\u7528\u4e8e\u7ebf\u7a0b\u95f4\u7684\u534f\u4f5c\u3002</p> <ul> <li>wait()\uff1a\u4f7f\u5f53\u524d\u7ebf\u7a0b\u7b49\u5f85\uff0c\u76f4\u5230\u5176\u4ed6\u7ebf\u7a0b\u8c03\u7528 <code>notify()</code> \u6216 <code>notifyAll()</code>\u3002</li> <li>notify()\uff1a\u5524\u9192\u4e00\u4e2a\u7b49\u5f85\u7684\u7ebf\u7a0b\u3002</li> <li> <p>notifyAll()\uff1a\u5524\u9192\u6240\u6709\u7b49\u5f85\u7684\u7ebf\u7a0b\u3002</p> </li> <li> <p>\u793a\u4f8b\uff1a <pre><code>public class Example {\n    private final Object lock = new Object();\n    private boolean condition = false;\n\n    public void waitForCondition() throws InterruptedException {\n        synchronized (lock) {\n            while (!condition) {\n                lock.wait();\n            }\n            // \u6761\u4ef6\u6ee1\u8db3\u540e\u7684\u64cd\u4f5c\n        }\n    }\n\n    public void setCondition() {\n        synchronized (lock) {\n            condition = true;\n            lock.notifyAll();\n        }\n    }\n}\n</code></pre></p> </li> </ul>"},{"location":"010Java/040MultiThreading/#_6","title":"\u603b\u7ed3","text":"<p>Java \u63d0\u4f9b\u4e86\u591a\u79cd\u540c\u6b65\u673a\u5236\uff0c\u9009\u62e9\u54ea\u79cd\u673a\u5236\u53d6\u51b3\u4e8e\u5177\u4f53\u7684\u5e94\u7528\u573a\u666f\u3002<code>synchronized</code> \u662f\u6700\u7b80\u5355\u7684\u540c\u6b65\u65b9\u5f0f\uff0c\u800c <code>ReentrantLock</code> \u548c <code>Atomic</code> \u7c7b\u63d0\u4f9b\u4e86\u66f4\u9ad8\u7ea7\u7684\u529f\u80fd\u3002<code>volatile</code> \u9002\u7528\u4e8e\u7b80\u5355\u7684\u72b6\u6001\u6807\u5fd7\uff0c\u800c <code>CountDownLatch</code>\u3001<code>CyclicBarrier</code> \u548c <code>Semaphore</code> \u5219\u9002\u7528\u4e8e\u66f4\u590d\u6742\u7684\u7ebf\u7a0b\u540c\u6b65\u9700\u6c42\u3002</p>"},{"location":"010Java/040MultiThreading/#java_1","title":"Java\u4e2d\u6570\u636e\u4e00\u81f4\u6027\u5982\u4f55\u4fdd\u8bc1\uff1f","text":"\u7b54\u6848 <p>\u5728 Java \u4e2d\uff0c\u6570\u636e\u4e00\u81f4\u6027\u662f\u6307\u5728\u591a\u7ebf\u7a0b\u73af\u5883\u4e0b\uff0c\u786e\u4fdd\u5171\u4eab\u6570\u636e\u7684\u6b63\u786e\u6027\u548c\u53ef\u89c1\u6027\u3002\u4e3a\u4e86\u5b9e\u73b0\u6570\u636e\u4e00\u81f4\u6027\uff0cJava \u63d0\u4f9b\u4e86\u591a\u79cd\u673a\u5236\u548c\u6280\u672f\u3002\u4ee5\u4e0b\u662f\u4fdd\u8bc1\u6570\u636e\u4e00\u81f4\u6027\u7684\u4e3b\u8981\u65b9\u6cd5\uff1a</p>"},{"location":"010Java/040MultiThreading/#1-synchronized_1","title":"1. \u4f7f\u7528 <code>synchronized</code> \u5173\u952e\u5b57","text":"<p><code>synchronized</code> \u662f Java \u4e2d\u6700\u5e38\u7528\u7684\u540c\u6b65\u673a\u5236\uff0c\u5b83\u53ef\u4ee5\u786e\u4fdd\u540c\u4e00\u65f6\u95f4\u53ea\u6709\u4e00\u4e2a\u7ebf\u7a0b\u8bbf\u95ee\u5171\u4eab\u8d44\u6e90\uff0c\u4ece\u800c\u907f\u514d\u6570\u636e\u7ade\u4e89\u548c\u4e0d\u4e00\u81f4\u3002</p> <ul> <li> <p>\u540c\u6b65\u65b9\u6cd5\uff1a <pre><code>public synchronized void updateData() {\n    // \u64cd\u4f5c\u5171\u4eab\u6570\u636e\n}\n</code></pre></p> </li> <li> <p>\u540c\u6b65\u4ee3\u7801\u5757\uff1a <pre><code>public void updateData() {\n    synchronized (this) {\n        // \u64cd\u4f5c\u5171\u4eab\u6570\u636e\n    }\n}\n</code></pre></p> </li> </ul> <p><code>synchronized</code> \u4fdd\u8bc1\u4e86\u539f\u5b50\u6027\u3001\u53ef\u89c1\u6027\u548c\u6709\u5e8f\u6027\uff1a - \u539f\u5b50\u6027\uff1a\u786e\u4fdd\u64cd\u4f5c\u4e0d\u53ef\u5206\u5272\u3002 - \u53ef\u89c1\u6027\uff1a\u786e\u4fdd\u4e00\u4e2a\u7ebf\u7a0b\u5bf9\u5171\u4eab\u6570\u636e\u7684\u4fee\u6539\u5bf9\u5176\u4ed6\u7ebf\u7a0b\u53ef\u89c1\u3002 - \u6709\u5e8f\u6027\uff1a\u786e\u4fdd\u4ee3\u7801\u7684\u6267\u884c\u987a\u5e8f\u7b26\u5408\u9884\u671f\u3002</p>"},{"location":"010Java/040MultiThreading/#2-volatile","title":"2. \u4f7f\u7528 <code>volatile</code> \u5173\u952e\u5b57","text":"<p><code>volatile</code> \u5173\u952e\u5b57\u7528\u4e8e\u4fee\u9970\u53d8\u91cf\uff0c\u786e\u4fdd\u53d8\u91cf\u7684\u53ef\u89c1\u6027\u548c\u6709\u5e8f\u6027\uff0c\u4f46\u4e0d\u4fdd\u8bc1\u539f\u5b50\u6027\u3002</p> <ul> <li>\u793a\u4f8b\uff1a <pre><code>public class Example {\n    private volatile boolean flag = false;\n\n    public void toggleFlag() {\n        flag = !flag; // \u4e0d\u4fdd\u8bc1\u539f\u5b50\u6027\n    }\n\n    public boolean isFlag() {\n        return flag;\n    }\n}\n</code></pre></li> </ul> <p><code>volatile</code> \u9002\u7528\u4e8e\u7b80\u5355\u7684\u72b6\u6001\u6807\u5fd7\uff0c\u4f46\u4e0d\u9002\u5408\u590d\u5408\u64cd\u4f5c\uff08\u5982 <code>i++</code>\uff09\u3002</p>"},{"location":"010Java/040MultiThreading/#3-atomic-classes","title":"3. \u4f7f\u7528\u539f\u5b50\u7c7b\uff08Atomic Classes\uff09","text":"<p><code>java.util.concurrent.atomic</code> \u5305\u63d0\u4f9b\u4e86\u4e00\u7cfb\u5217\u539f\u5b50\u7c7b\uff08\u5982 <code>AtomicInteger</code>\u3001<code>AtomicLong</code>\u3001<code>AtomicReference</code> \u7b49\uff09\uff0c\u8fd9\u4e9b\u7c7b\u901a\u8fc7 CAS\uff08Compare-And-Swap\uff09\u64cd\u4f5c\u4fdd\u8bc1\u539f\u5b50\u6027\u3002</p> <ul> <li>\u793a\u4f8b\uff1a <pre><code>import java.util.concurrent.atomic.AtomicInteger;\n\npublic class Example {\n    private AtomicInteger counter = new AtomicInteger(0);\n\n    public void increment() {\n        counter.incrementAndGet(); // \u539f\u5b50\u64cd\u4f5c\n    }\n\n    public int getCounter() {\n        return counter.get();\n    }\n}\n</code></pre></li> </ul> <p>\u539f\u5b50\u7c7b\u9002\u7528\u4e8e\u8ba1\u6570\u5668\u3001\u6807\u5fd7\u4f4d\u7b49\u9700\u8981\u539f\u5b50\u64cd\u4f5c\u7684\u573a\u666f\u3002</p>"},{"location":"010Java/040MultiThreading/#4-lock","title":"4. \u4f7f\u7528\u9501\uff08Lock\uff09","text":"<p><code>ReentrantLock</code> \u662f <code>java.util.concurrent.locks</code> \u5305\u4e2d\u7684\u4e00\u4e2a\u7c7b\uff0c\u63d0\u4f9b\u4e86\u6bd4 <code>synchronized</code> \u66f4\u7075\u6d3b\u7684\u9501\u5b9a\u673a\u5236\u3002</p> <ul> <li>\u793a\u4f8b\uff1a <pre><code>import java.util.concurrent.locks.Lock;\nimport java.util.concurrent.locks.ReentrantLock;\n\npublic class Example {\n    private final Lock lock = new ReentrantLock();\n    private int sharedData = 0;\n\n    public void updateData() {\n        lock.lock();\n        try {\n            sharedData++; // \u64cd\u4f5c\u5171\u4eab\u6570\u636e\n        } finally {\n            lock.unlock();\n        }\n    }\n}\n</code></pre></li> </ul> <p><code>ReentrantLock</code> \u652f\u6301\u53ef\u4e2d\u65ad\u9501\u3001\u8d85\u65f6\u9501\u548c\u516c\u5e73\u9501\u7b49\u9ad8\u7ea7\u529f\u80fd\u3002</p>"},{"location":"010Java/040MultiThreading/#5","title":"5. \u4f7f\u7528\u7ebf\u7a0b\u5b89\u5168\u7684\u96c6\u5408\u7c7b","text":"<p>Java \u63d0\u4f9b\u4e86\u591a\u79cd\u7ebf\u7a0b\u5b89\u5168\u7684\u96c6\u5408\u7c7b\uff0c\u5982 <code>ConcurrentHashMap</code>\u3001<code>CopyOnWriteArrayList</code> \u7b49\uff0c\u8fd9\u4e9b\u7c7b\u5185\u90e8\u5b9e\u73b0\u4e86\u540c\u6b65\u673a\u5236\uff0c\u53ef\u4ee5\u76f4\u63a5\u5728\u591a\u7ebf\u7a0b\u73af\u5883\u4e2d\u4f7f\u7528\u3002</p> <ul> <li>\u793a\u4f8b\uff1a <pre><code>import java.util.concurrent.ConcurrentHashMap;\n\npublic class Example {\n    private ConcurrentHashMap&lt;String, Integer&gt; map = new ConcurrentHashMap&lt;&gt;();\n\n    public void addData(String key, int value) {\n        map.put(key, value);\n    }\n\n    public int getData(String key) {\n        return map.getOrDefault(key, -1);\n    }\n}\n</code></pre></li> </ul>"},{"location":"010Java/040MultiThreading/#6-final","title":"6. \u4f7f\u7528 <code>final</code> \u5173\u952e\u5b57","text":"<p><code>final</code> \u5173\u952e\u5b57\u53ef\u4ee5\u786e\u4fdd\u53d8\u91cf\u7684\u4e0d\u53ef\u53d8\u6027\uff0c\u4ece\u800c\u907f\u514d\u6570\u636e\u7ade\u4e89\u3002</p> <ul> <li>\u793a\u4f8b\uff1a <pre><code>public class Example {\n    private final int immutableData = 42;\n\n    public int getImmutableData() {\n        return immutableData;\n    }\n}\n</code></pre></li> </ul> <p><code>final</code> \u53d8\u91cf\u5728\u6784\u9020\u51fd\u6570\u5b8c\u6210\u540e\u4e0d\u53ef\u4fee\u6539\uff0c\u56e0\u6b64\u662f\u7ebf\u7a0b\u5b89\u5168\u7684\u3002</p>"},{"location":"010Java/040MultiThreading/#7-thread-confinement","title":"7. \u4f7f\u7528\u7ebf\u7a0b\u5c01\u95ed\uff08Thread Confinement\uff09","text":"<p>\u7ebf\u7a0b\u5c01\u95ed\u662f\u6307\u5c06\u6570\u636e\u9650\u5236\u5728\u5355\u4e2a\u7ebf\u7a0b\u4e2d\uff0c\u907f\u514d\u5171\u4eab\u6570\u636e\u3002\u4f8b\u5982\uff0c\u4f7f\u7528 <code>ThreadLocal</code> \u7c7b\u53ef\u4ee5\u4e3a\u6bcf\u4e2a\u7ebf\u7a0b\u521b\u5efa\u72ec\u7acb\u7684\u53d8\u91cf\u526f\u672c\u3002</p> <ul> <li>\u793a\u4f8b\uff1a <pre><code>public class Example {\n    private ThreadLocal&lt;Integer&gt; threadLocalData = ThreadLocal.withInitial(() -&gt; 0);\n\n    public void setData(int value) {\n        threadLocalData.set(value);\n    }\n\n    public int getData() {\n        return threadLocalData.get();\n    }\n}\n</code></pre></li> </ul>"},{"location":"010Java/040MultiThreading/#8-immutable-objects","title":"8. \u4f7f\u7528\u4e0d\u53ef\u53d8\u5bf9\u8c61\uff08Immutable Objects\uff09","text":"<p>\u4e0d\u53ef\u53d8\u5bf9\u8c61\u662f\u6307\u4e00\u65e6\u521b\u5efa\u5c31\u4e0d\u80fd\u88ab\u4fee\u6539\u7684\u5bf9\u8c61\u3002\u7531\u4e8e\u4e0d\u53ef\u53d8\u5bf9\u8c61\u7684\u72b6\u6001\u4e0d\u4f1a\u6539\u53d8\uff0c\u56e0\u6b64\u5b83\u4eec\u662f\u7ebf\u7a0b\u5b89\u5168\u7684\u3002</p> <ul> <li>\u793a\u4f8b\uff1a <pre><code>public final class ImmutableExample {\n    private final int value;\n\n    public ImmutableExample(int value) {\n        this.value = value;\n    }\n\n    public int getValue() {\n        return value;\n    }\n}\n</code></pre></li> </ul>"},{"location":"010Java/040MultiThreading/#9_1","title":"9. \u4f7f\u7528\u5e76\u53d1\u5de5\u5177\u7c7b","text":"<p>Java \u7684 <code>java.util.concurrent</code> \u5305\u63d0\u4f9b\u4e86\u591a\u79cd\u5e76\u53d1\u5de5\u5177\u7c7b\uff0c\u5982 <code>CountDownLatch</code>\u3001<code>CyclicBarrier</code>\u3001<code>Semaphore</code> \u7b49\uff0c\u7528\u4e8e\u534f\u8c03\u591a\u4e2a\u7ebf\u7a0b\u7684\u6267\u884c\u3002</p> <ul> <li>\u793a\u4f8b\uff1a <pre><code>import java.util.concurrent.CountDownLatch;\n\npublic class Example {\n    private final CountDownLatch latch = new CountDownLatch(1);\n\n    public void await() throws InterruptedException {\n        latch.await(); // \u7b49\u5f85\u5176\u4ed6\u7ebf\u7a0b\u5b8c\u6210\n    }\n\n    public void finish() {\n        latch.countDown(); // \u901a\u77e5\u7b49\u5f85\u7684\u7ebf\u7a0b\n    }\n}\n</code></pre></li> </ul>"},{"location":"010Java/040MultiThreading/#10_1","title":"10. \u907f\u514d\u5171\u4eab\u6570\u636e","text":"<p>\u6700\u597d\u7684\u6570\u636e\u4e00\u81f4\u6027\u7b56\u7565\u662f\u5c3d\u91cf\u907f\u514d\u5171\u4eab\u6570\u636e\u3002\u901a\u8fc7\u8bbe\u8ba1\u65e0\u72b6\u6001\u5bf9\u8c61\u6216\u4f7f\u7528\u7ebf\u7a0b\u5c01\u95ed\u6280\u672f\uff0c\u53ef\u4ee5\u51cf\u5c11\u5bf9\u540c\u6b65\u7684\u9700\u6c42\u3002</p>"},{"location":"010Java/040MultiThreading/#_7","title":"\u603b\u7ed3","text":"<p>Java \u4e2d\u4fdd\u8bc1\u6570\u636e\u4e00\u81f4\u6027\u7684\u65b9\u6cd5\u5305\u62ec\uff1a 1. \u4f7f\u7528 <code>synchronized</code> \u6216 <code>ReentrantLock</code> \u5b9e\u73b0\u540c\u6b65\u3002 2. \u4f7f\u7528 <code>volatile</code> \u5173\u952e\u5b57\u4fdd\u8bc1\u53ef\u89c1\u6027\u3002 3. \u4f7f\u7528\u539f\u5b50\u7c7b\uff08\u5982 <code>AtomicInteger</code>\uff09\u5b9e\u73b0\u539f\u5b50\u64cd\u4f5c\u3002 4. \u4f7f\u7528\u7ebf\u7a0b\u5b89\u5168\u7684\u96c6\u5408\u7c7b\uff08\u5982 <code>ConcurrentHashMap</code>\uff09\u3002 5. \u4f7f\u7528 <code>final</code> \u5173\u952e\u5b57\u6216\u4e0d\u53ef\u53d8\u5bf9\u8c61\u3002 6. \u4f7f\u7528\u7ebf\u7a0b\u5c01\u95ed\u6280\u672f\uff08\u5982 <code>ThreadLocal</code>\uff09\u3002 7. \u4f7f\u7528\u5e76\u53d1\u5de5\u5177\u7c7b\uff08\u5982 <code>CountDownLatch</code>\u3001<code>Semaphore</code>\uff09\u3002 8. \u5c3d\u91cf\u907f\u514d\u5171\u4eab\u6570\u636e\u3002</p> <p>\u9009\u62e9\u5408\u9002\u7684\u65b9\u6cd5\u53d6\u51b3\u4e8e\u5177\u4f53\u7684\u5e94\u7528\u573a\u666f\u548c\u6027\u80fd\u9700\u6c42\u3002</p>"},{"location":"010Java/040MultiThreading/#_8","title":"\u5982\u4f55\u4fdd\u8bc1\u7ebf\u7a0b\u5b89\u5168\uff1f","text":"\u7b54\u6848 <p>\u5728 Java \u4e2d\uff0c\u7ebf\u7a0b\u5b89\u5168\u662f\u6307\u5f53\u591a\u4e2a\u7ebf\u7a0b\u540c\u65f6\u8bbf\u95ee\u5171\u4eab\u8d44\u6e90\u65f6\uff0c\u7a0b\u5e8f\u7684\u884c\u4e3a\u662f\u6b63\u786e\u7684\uff0c\u4e14\u4e0d\u4f1a\u51fa\u73b0\u6570\u636e\u4e0d\u4e00\u81f4\u6216\u4e0d\u53ef\u9884\u671f\u7684\u7ed3\u679c\u3002\u4e3a\u4e86\u4fdd\u8bc1\u7ebf\u7a0b\u5b89\u5168\uff0cJava \u63d0\u4f9b\u4e86\u591a\u79cd\u673a\u5236\u548c\u6280\u672f\u3002\u4ee5\u4e0b\u662f\u4fdd\u8bc1\u7ebf\u7a0b\u5b89\u5168\u7684\u4e3b\u8981\u65b9\u6cd5\uff1a</p>"},{"location":"010Java/040MultiThreading/#1-immutable-objects","title":"1. \u4f7f\u7528\u4e0d\u53ef\u53d8\u5bf9\u8c61\uff08Immutable Objects\uff09","text":"<p>\u4e0d\u53ef\u53d8\u5bf9\u8c61\u662f\u6307\u4e00\u65e6\u521b\u5efa\u5c31\u4e0d\u80fd\u88ab\u4fee\u6539\u7684\u5bf9\u8c61\u3002\u7531\u4e8e\u4e0d\u53ef\u53d8\u5bf9\u8c61\u7684\u72b6\u6001\u4e0d\u4f1a\u6539\u53d8\uff0c\u56e0\u6b64\u5b83\u4eec\u662f\u7ebf\u7a0b\u5b89\u5168\u7684\u3002</p> <ul> <li>\u793a\u4f8b\uff1a <pre><code>public final class ImmutableExample {\n    private final int value;\n\n    public ImmutableExample(int value) {\n        this.value = value;\n    }\n\n    public int getValue() {\n        return value;\n    }\n}\n</code></pre></li> </ul>"},{"location":"010Java/040MultiThreading/#2-synchronized","title":"2. \u4f7f\u7528 <code>synchronized</code> \u5173\u952e\u5b57","text":"<p><code>synchronized</code> \u662f Java \u4e2d\u6700\u5e38\u7528\u7684\u540c\u6b65\u673a\u5236\uff0c\u5b83\u53ef\u4ee5\u786e\u4fdd\u540c\u4e00\u65f6\u95f4\u53ea\u6709\u4e00\u4e2a\u7ebf\u7a0b\u8bbf\u95ee\u5171\u4eab\u8d44\u6e90\u3002</p> <ul> <li> <p>\u540c\u6b65\u65b9\u6cd5\uff1a <pre><code>public synchronized void method() {\n    // \u64cd\u4f5c\u5171\u4eab\u8d44\u6e90\n}\n</code></pre></p> </li> <li> <p>\u540c\u6b65\u4ee3\u7801\u5757\uff1a <pre><code>public void method() {\n    synchronized (this) {\n        // \u64cd\u4f5c\u5171\u4eab\u8d44\u6e90\n    }\n}\n</code></pre></p> </li> </ul> <p><code>synchronized</code> \u4fdd\u8bc1\u4e86\u539f\u5b50\u6027\u3001\u53ef\u89c1\u6027\u548c\u6709\u5e8f\u6027\u3002</p>"},{"location":"010Java/040MultiThreading/#3-volatile_1","title":"3. \u4f7f\u7528 <code>volatile</code> \u5173\u952e\u5b57","text":"<p><code>volatile</code> \u5173\u952e\u5b57\u7528\u4e8e\u4fee\u9970\u53d8\u91cf\uff0c\u786e\u4fdd\u53d8\u91cf\u7684\u53ef\u89c1\u6027\u548c\u6709\u5e8f\u6027\uff0c\u4f46\u4e0d\u4fdd\u8bc1\u539f\u5b50\u6027\u3002</p> <ul> <li>\u793a\u4f8b\uff1a <pre><code>public class Example {\n    private volatile boolean flag = false;\n\n    public void toggleFlag() {\n        flag = !flag; // \u4e0d\u4fdd\u8bc1\u539f\u5b50\u6027\n    }\n\n    public boolean isFlag() {\n        return flag;\n    }\n}\n</code></pre></li> </ul> <p><code>volatile</code> \u9002\u7528\u4e8e\u7b80\u5355\u7684\u72b6\u6001\u6807\u5fd7\uff0c\u4f46\u4e0d\u9002\u5408\u590d\u5408\u64cd\u4f5c\uff08\u5982 <code>i++</code>\uff09\u3002</p>"},{"location":"010Java/040MultiThreading/#4-atomic-classes","title":"4. \u4f7f\u7528\u539f\u5b50\u7c7b\uff08Atomic Classes\uff09","text":"<p><code>java.util.concurrent.atomic</code> \u5305\u63d0\u4f9b\u4e86\u4e00\u7cfb\u5217\u539f\u5b50\u7c7b\uff08\u5982 <code>AtomicInteger</code>\u3001<code>AtomicLong</code>\u3001<code>AtomicReference</code> \u7b49\uff09\uff0c\u8fd9\u4e9b\u7c7b\u901a\u8fc7 CAS\uff08Compare-And-Swap\uff09\u64cd\u4f5c\u4fdd\u8bc1\u539f\u5b50\u6027\u3002</p> <ul> <li>\u793a\u4f8b\uff1a <pre><code>import java.util.concurrent.atomic.AtomicInteger;\n\npublic class Example {\n    private AtomicInteger counter = new AtomicInteger(0);\n\n    public void increment() {\n        counter.incrementAndGet(); // \u539f\u5b50\u64cd\u4f5c\n    }\n\n    public int getCounter() {\n        return counter.get();\n    }\n}\n</code></pre></li> </ul> <p>\u539f\u5b50\u7c7b\u9002\u7528\u4e8e\u8ba1\u6570\u5668\u3001\u6807\u5fd7\u4f4d\u7b49\u9700\u8981\u539f\u5b50\u64cd\u4f5c\u7684\u573a\u666f\u3002</p>"},{"location":"010Java/040MultiThreading/#5-lock","title":"5. \u4f7f\u7528\u9501\uff08Lock\uff09","text":"<p><code>ReentrantLock</code> \u662f <code>java.util.concurrent.locks</code> \u5305\u4e2d\u7684\u4e00\u4e2a\u7c7b\uff0c\u63d0\u4f9b\u4e86\u6bd4 <code>synchronized</code> \u66f4\u7075\u6d3b\u7684\u9501\u5b9a\u673a\u5236\u3002</p> <ul> <li>\u793a\u4f8b\uff1a <pre><code>import java.util.concurrent.locks.Lock;\nimport java.util.concurrent.locks.ReentrantLock;\n\npublic class Example {\n    private final Lock lock = new ReentrantLock();\n    private int sharedData = 0;\n\n    public void updateData() {\n        lock.lock();\n        try {\n            sharedData++; // \u64cd\u4f5c\u5171\u4eab\u6570\u636e\n        } finally {\n            lock.unlock();\n        }\n    }\n}\n</code></pre></li> </ul> <p><code>ReentrantLock</code> \u652f\u6301\u53ef\u4e2d\u65ad\u9501\u3001\u8d85\u65f6\u9501\u548c\u516c\u5e73\u9501\u7b49\u9ad8\u7ea7\u529f\u80fd\u3002</p>"},{"location":"010Java/040MultiThreading/#6_1","title":"6. \u4f7f\u7528\u7ebf\u7a0b\u5b89\u5168\u7684\u96c6\u5408\u7c7b","text":"<p>Java \u63d0\u4f9b\u4e86\u591a\u79cd\u7ebf\u7a0b\u5b89\u5168\u7684\u96c6\u5408\u7c7b\uff0c\u5982 <code>ConcurrentHashMap</code>\u3001<code>CopyOnWriteArrayList</code> \u7b49\uff0c\u8fd9\u4e9b\u7c7b\u5185\u90e8\u5b9e\u73b0\u4e86\u540c\u6b65\u673a\u5236\uff0c\u53ef\u4ee5\u76f4\u63a5\u5728\u591a\u7ebf\u7a0b\u73af\u5883\u4e2d\u4f7f\u7528\u3002</p> <ul> <li>\u793a\u4f8b\uff1a <pre><code>import java.util.concurrent.ConcurrentHashMap;\n\npublic class Example {\n    private ConcurrentHashMap&lt;String, Integer&gt; map = new ConcurrentHashMap&lt;&gt;();\n\n    public void addData(String key, int value) {\n        map.put(key, value);\n    }\n\n    public int getData(String key) {\n        return map.getOrDefault(key, -1);\n    }\n}\n</code></pre></li> </ul>"},{"location":"010Java/040MultiThreading/#7-final","title":"7. \u4f7f\u7528 <code>final</code> \u5173\u952e\u5b57","text":"<p><code>final</code> \u5173\u952e\u5b57\u53ef\u4ee5\u786e\u4fdd\u53d8\u91cf\u7684\u4e0d\u53ef\u53d8\u6027\uff0c\u4ece\u800c\u907f\u514d\u6570\u636e\u7ade\u4e89\u3002</p> <ul> <li>\u793a\u4f8b\uff1a <pre><code>public class Example {\n    private final int immutableData = 42;\n\n    public int getImmutableData() {\n        return immutableData;\n    }\n}\n</code></pre></li> </ul> <p><code>final</code> \u53d8\u91cf\u5728\u6784\u9020\u51fd\u6570\u5b8c\u6210\u540e\u4e0d\u53ef\u4fee\u6539\uff0c\u56e0\u6b64\u662f\u7ebf\u7a0b\u5b89\u5168\u7684\u3002</p>"},{"location":"010Java/040MultiThreading/#8-thread-confinement","title":"8. \u4f7f\u7528\u7ebf\u7a0b\u5c01\u95ed\uff08Thread Confinement\uff09","text":"<p>\u7ebf\u7a0b\u5c01\u95ed\u662f\u6307\u5c06\u6570\u636e\u9650\u5236\u5728\u5355\u4e2a\u7ebf\u7a0b\u4e2d\uff0c\u907f\u514d\u5171\u4eab\u6570\u636e\u3002\u4f8b\u5982\uff0c\u4f7f\u7528 <code>ThreadLocal</code> \u7c7b\u53ef\u4ee5\u4e3a\u6bcf\u4e2a\u7ebf\u7a0b\u521b\u5efa\u72ec\u7acb\u7684\u53d8\u91cf\u526f\u672c\u3002</p> <ul> <li>\u793a\u4f8b\uff1a <pre><code>public class Example {\n    private ThreadLocal&lt;Integer&gt; threadLocalData = ThreadLocal.withInitial(() -&gt; 0);\n\n    public void setData(int value) {\n        threadLocalData.set(value);\n    }\n\n    public int getData() {\n        return threadLocalData.get();\n    }\n}\n</code></pre></li> </ul>"},{"location":"010Java/040MultiThreading/#9_2","title":"9. \u4f7f\u7528\u5e76\u53d1\u5de5\u5177\u7c7b","text":"<p>Java \u7684 <code>java.util.concurrent</code> \u5305\u63d0\u4f9b\u4e86\u591a\u79cd\u5e76\u53d1\u5de5\u5177\u7c7b\uff0c\u5982 <code>CountDownLatch</code>\u3001<code>CyclicBarrier</code>\u3001<code>Semaphore</code> \u7b49\uff0c\u7528\u4e8e\u534f\u8c03\u591a\u4e2a\u7ebf\u7a0b\u7684\u6267\u884c\u3002</p> <ul> <li>\u793a\u4f8b\uff1a <pre><code>import java.util.concurrent.CountDownLatch;\n\npublic class Example {\n    private final CountDownLatch latch = new CountDownLatch(1);\n\n    public void await() throws InterruptedException {\n        latch.await(); // \u7b49\u5f85\u5176\u4ed6\u7ebf\u7a0b\u5b8c\u6210\n    }\n\n    public void finish() {\n        latch.countDown(); // \u901a\u77e5\u7b49\u5f85\u7684\u7ebf\u7a0b\n    }\n}\n</code></pre></li> </ul>"},{"location":"010Java/040MultiThreading/#10_2","title":"10. \u907f\u514d\u5171\u4eab\u6570\u636e","text":"<p>\u6700\u597d\u7684\u7ebf\u7a0b\u5b89\u5168\u7b56\u7565\u662f\u5c3d\u91cf\u907f\u514d\u5171\u4eab\u6570\u636e\u3002\u901a\u8fc7\u8bbe\u8ba1\u65e0\u72b6\u6001\u5bf9\u8c61\u6216\u4f7f\u7528\u7ebf\u7a0b\u5c01\u95ed\u6280\u672f\uff0c\u53ef\u4ee5\u51cf\u5c11\u5bf9\u540c\u6b65\u7684\u9700\u6c42\u3002</p>"},{"location":"010Java/040MultiThreading/#11-readwritelock","title":"11. \u4f7f\u7528\u8bfb\u5199\u9501\uff08ReadWriteLock\uff09","text":"<p><code>ReadWriteLock</code> \u5141\u8bb8\u591a\u4e2a\u8bfb\u7ebf\u7a0b\u540c\u65f6\u8bbf\u95ee\u5171\u4eab\u8d44\u6e90\uff0c\u4f46\u5199\u7ebf\u7a0b\u72ec\u5360\u8bbf\u95ee\u6743\u3002\u9002\u7528\u4e8e\u8bfb\u591a\u5199\u5c11\u7684\u573a\u666f\u3002</p> <ul> <li>\u793a\u4f8b\uff1a <pre><code>import java.util.concurrent.locks.ReadWriteLock;\nimport java.util.concurrent.locks.ReentrantReadWriteLock;\n\npublic class Example {\n    private final ReadWriteLock rwLock = new ReentrantReadWriteLock();\n    private int sharedData = 0;\n\n    public int readData() {\n        rwLock.readLock().lock();\n        try {\n            return sharedData;\n        } finally {\n            rwLock.readLock().unlock();\n        }\n    }\n\n    public void writeData(int value) {\n        rwLock.writeLock().lock();\n        try {\n            sharedData = value;\n        } finally {\n            rwLock.writeLock().unlock();\n        }\n    }\n}\n</code></pre></li> </ul>"},{"location":"010Java/040MultiThreading/#12-stampedlock","title":"12. \u4f7f\u7528 <code>StampedLock</code>","text":"<p><code>StampedLock</code> \u662f Java 8 \u5f15\u5165\u7684\u4e00\u79cd\u66f4\u9ad8\u6548\u7684\u9501\u673a\u5236\uff0c\u652f\u6301\u4e50\u89c2\u8bfb\u9501\u3001\u60b2\u89c2\u8bfb\u9501\u548c\u5199\u9501\u3002</p> <ul> <li>\u793a\u4f8b\uff1a <pre><code>import java.util.concurrent.locks.StampedLock;\n\npublic class Example {\n    private final StampedLock stampedLock = new StampedLock();\n    private int sharedData = 0;\n\n    public int readData() {\n        long stamp = stampedLock.tryOptimisticRead();\n        int value = sharedData;\n        if (!stampedLock.validate(stamp)) {\n            stamp = stampedLock.readLock();\n            try {\n                value = sharedData;\n            } finally {\n                stampedLock.unlockRead(stamp);\n            }\n        }\n        return value;\n    }\n\n    public void writeData(int value) {\n        long stamp = stampedLock.writeLock();\n        try {\n            sharedData = value;\n        } finally {\n            stampedLock.unlockWrite(stamp);\n        }\n    }\n}\n</code></pre></li> </ul>"},{"location":"010Java/040MultiThreading/#_9","title":"\u603b\u7ed3","text":"<p>\u4fdd\u8bc1\u7ebf\u7a0b\u5b89\u5168\u7684\u65b9\u6cd5\u5305\u62ec\uff1a 1. \u4f7f\u7528\u4e0d\u53ef\u53d8\u5bf9\u8c61\u3002 2. \u4f7f\u7528 <code>synchronized</code> \u6216 <code>ReentrantLock</code> \u5b9e\u73b0\u540c\u6b65\u3002 3. \u4f7f\u7528 <code>volatile</code> \u5173\u952e\u5b57\u4fdd\u8bc1\u53ef\u89c1\u6027\u3002 4. \u4f7f\u7528\u539f\u5b50\u7c7b\uff08\u5982 <code>AtomicInteger</code>\uff09\u5b9e\u73b0\u539f\u5b50\u64cd\u4f5c\u3002 5. \u4f7f\u7528\u7ebf\u7a0b\u5b89\u5168\u7684\u96c6\u5408\u7c7b\uff08\u5982 <code>ConcurrentHashMap</code>\uff09\u3002 6. \u4f7f\u7528 <code>final</code> \u5173\u952e\u5b57\u6216\u4e0d\u53ef\u53d8\u5bf9\u8c61\u3002 7. \u4f7f\u7528\u7ebf\u7a0b\u5c01\u95ed\u6280\u672f\uff08\u5982 <code>ThreadLocal</code>\uff09\u3002 8. \u4f7f\u7528\u5e76\u53d1\u5de5\u5177\u7c7b\uff08\u5982 <code>CountDownLatch</code>\u3001<code>Semaphore</code>\uff09\u3002 9. \u5c3d\u91cf\u907f\u514d\u5171\u4eab\u6570\u636e\u3002 10. \u4f7f\u7528\u8bfb\u5199\u9501\uff08<code>ReadWriteLock</code>\uff09\u6216 <code>StampedLock</code>\u3002</p> <p>\u9009\u62e9\u5408\u9002\u7684\u65b9\u6cd5\u53d6\u51b3\u4e8e\u5177\u4f53\u7684\u5e94\u7528\u573a\u666f\u548c\u6027\u80fd\u9700\u6c42\u3002</p>"},{"location":"010Java/040MultiThreading/#java_2","title":"Java\u4e2d\u4e24\u4e2a\u8fdb\u7a0b\u540c\u65f6\u8981\u6c42\u8bfb\u5199\u6587\u4ef6\uff0c\u80fd\u4e0d\u80fd\u5b9e\u73b0\uff1f\u5982\u4f55\u9632\u6b62\u8fdb\u7a0b\u540c\u6b65\uff1f","text":"\u7b54\u6848 <p>\u5728Java\u4e2d\uff0c\u4e24\u4e2a\u8fdb\u7a0b\u540c\u65f6\u8981\u6c42\u8bfb\u5199\u6587\u4ef6\u662f\u53ef\u4ee5\u5b9e\u73b0\u7684\uff0c\u4f46\u9700\u8981\u91c7\u53d6\u63aa\u65bd\u6765\u9632\u6b62\u8fdb\u7a0b\u95f4\u7684\u540c\u6b65\u95ee\u9898\uff0c\u907f\u514d\u6570\u636e\u635f\u574f\u6216\u4e0d\u4e00\u81f4\u3002\u4ee5\u4e0b\u662f\u5b9e\u73b0\u65b9\u6cd5\u548c\u9632\u6b62\u540c\u6b65\u95ee\u9898\u7684\u7b56\u7565\uff1a</p>"},{"location":"010Java/040MultiThreading/#1-file-lock","title":"1. \u4f7f\u7528\u6587\u4ef6\u9501\uff08File Lock\uff09","text":"<p>Java\u7684<code>java.nio.channels.FileChannel</code>\u63d0\u4f9b\u4e86\u6587\u4ef6\u9501\u529f\u80fd\uff0c\u53ef\u4ee5\u63a7\u5236\u591a\u4e2a\u8fdb\u7a0b\u5bf9\u6587\u4ef6\u7684\u5e76\u53d1\u8bbf\u95ee\u3002</p> <ul> <li>\u6392\u4ed6\u9501\uff08Exclusive Lock\uff09\uff1a\u53ea\u5141\u8bb8\u4e00\u4e2a\u8fdb\u7a0b\u8fdb\u884c\u5199\u64cd\u4f5c\uff0c\u5176\u4ed6\u8fdb\u7a0b\u65e0\u6cd5\u8bfb\u5199\u3002</li> <li>\u5171\u4eab\u9501\uff08Shared Lock\uff09\uff1a\u5141\u8bb8\u591a\u4e2a\u8fdb\u7a0b\u540c\u65f6\u8bfb\uff0c\u4f46\u7981\u6b62\u5199\u64cd\u4f5c\u3002</li> </ul>"},{"location":"010Java/040MultiThreading/#_10","title":"\u793a\u4f8b\u4ee3\u7801\uff1a","text":"<pre><code>import java.io.RandomAccessFile;\nimport java.nio.channels.FileChannel;\nimport java.nio.channels.FileLock;\n\npublic class FileLockExample {\n    public static void main(String[] args) {\n        try (RandomAccessFile file = new RandomAccessFile(\"test.txt\", \"rw\");\n            FileChannel channel = file.getChannel()) {\n\n            // \u83b7\u53d6\u6392\u4ed6\u9501\n            FileLock lock = channel.lock();\n            System.out.println(\"Lock acquired\");\n\n            // \u8bfb\u5199\u64cd\u4f5c\n            file.writeBytes(\"Hello, World!\");\n\n            // \u91ca\u653e\u9501\n            lock.release();\n            System.out.println(\"Lock released\");\n\n        } catch (Exception e) {\n            e.printStackTrace();\n        }\n    }\n}\n</code></pre>"},{"location":"010Java/040MultiThreading/#2-ipc","title":"2. \u4f7f\u7528\u8fdb\u7a0b\u95f4\u901a\u4fe1\uff08IPC\uff09","text":"<p>\u901a\u8fc7\u8fdb\u7a0b\u95f4\u901a\u4fe1\u673a\u5236\uff08\u5982Socket\u3001\u5171\u4eab\u5185\u5b58\u7b49\uff09\u534f\u8c03\u6587\u4ef6\u8bbf\u95ee\uff0c\u786e\u4fdd\u540c\u4e00\u65f6\u95f4\u53ea\u6709\u4e00\u4e2a\u8fdb\u7a0b\u8fdb\u884c\u5199\u64cd\u4f5c\u3002</p>"},{"location":"010Java/040MultiThreading/#3","title":"3. \u4f7f\u7528\u5916\u90e8\u5de5\u5177","text":"<p>\u501f\u52a9\u6570\u636e\u5e93\u6216\u5206\u5e03\u5f0f\u9501\uff08\u5982ZooKeeper\u3001Redis\uff09\u7ba1\u7406\u6587\u4ef6\u8bbf\u95ee\uff0c\u786e\u4fdd\u540c\u4e00\u65f6\u95f4\u53ea\u6709\u4e00\u4e2a\u8fdb\u7a0b\u8fdb\u884c\u5199\u64cd\u4f5c\u3002</p>"},{"location":"010Java/040MultiThreading/#4","title":"4. \u6587\u4ef6\u8f6e\u8be2\u4e0e\u91cd\u8bd5\u673a\u5236","text":"<p>\u5982\u679c\u65e0\u6cd5\u4f7f\u7528\u6587\u4ef6\u9501\u6216IPC\uff0c\u53ef\u4ee5\u901a\u8fc7\u8f6e\u8be2\u548c\u91cd\u8bd5\u673a\u5236\u5b9e\u73b0\u7b80\u5355\u7684\u540c\u6b65\u63a7\u5236\u3002\u8fdb\u7a0b\u5728\u8bbf\u95ee\u6587\u4ef6\u524d\u68c0\u67e5\u67d0\u4e2a\u6807\u5fd7\u6587\u4ef6\u662f\u5426\u5b58\u5728\uff0c\u5b58\u5728\u5219\u7b49\u5f85\uff0c\u4e0d\u5b58\u5728\u5219\u521b\u5efa\u6807\u5fd7\u6587\u4ef6\u5e76\u6267\u884c\u64cd\u4f5c\uff0c\u5b8c\u6210\u540e\u5220\u9664\u6807\u5fd7\u6587\u4ef6\u3002</p>"},{"location":"010Java/040MultiThreading/#_11","title":"\u793a\u4f8b\u4ee3\u7801\uff1a","text":"<pre><code>import java.io.File;\nimport java.io.RandomAccessFile;\n\npublic class FilePollingExample {\n    public static void main(String[] args) {\n        File lockFile = new File(\"lockfile.lock\");\n        try {\n            while (!lockFile.createNewFile()) {\n                Thread.sleep(100); // \u7b49\u5f85\u5176\u4ed6\u8fdb\u7a0b\u91ca\u653e\u9501\n            }\n\n            // \u8bfb\u5199\u64cd\u4f5c\n            try (RandomAccessFile file = new RandomAccessFile(\"test.txt\", \"rw\")) {\n                file.writeBytes(\"Hello, World!\");\n            }\n\n        } catch (Exception e) {\n            e.printStackTrace();\n        } finally {\n            lockFile.delete(); // \u91ca\u653e\u9501\n        }\n    }\n}\n</code></pre>"},{"location":"010Java/040MultiThreading/#_12","title":"\u603b\u7ed3","text":"<ul> <li>\u6587\u4ef6\u9501\uff1a\u63a8\u8350\u4f7f\u7528<code>FileChannel</code>\u7684\u6587\u4ef6\u9501\u673a\u5236\u3002</li> <li>\u8fdb\u7a0b\u95f4\u901a\u4fe1\uff1a\u9002\u5408\u590d\u6742\u573a\u666f\uff0c\u534f\u8c03\u591a\u4e2a\u8fdb\u7a0b\u7684\u8bbf\u95ee\u3002</li> <li>\u5916\u90e8\u5de5\u5177\uff1a\u9002\u5408\u5206\u5e03\u5f0f\u73af\u5883\u3002</li> <li>\u8f6e\u8be2\u4e0e\u91cd\u8bd5\uff1a\u7b80\u5355\u4f46\u6548\u7387\u8f83\u4f4e\uff0c\u9002\u5408\u8f7b\u91cf\u7ea7\u5e94\u7528\u3002</li> </ul> <p>\u6839\u636e\u5177\u4f53\u9700\u6c42\u9009\u62e9\u5408\u9002\u7684\u65b9\u6cd5\uff0c\u786e\u4fdd\u6587\u4ef6\u8bbf\u95ee\u7684\u540c\u6b65\u6027\u548c\u6570\u636e\u4e00\u81f4\u6027\u3002</p>"},{"location":"010Java/040MultiThreading/#javalistlist","title":"Java\u591a\u7ebf\u7a0b\u64cd\u4f5cList\uff0c\u5982\u4f55\u4fdd\u8bc1List\u6570\u636e\u5b89\u5168\uff1f","text":"\u7b54\u6848 <p>\u5728Java\u4e2d\uff0c\u591a\u4e2a\u7ebf\u7a0b\u64cd\u4f5c\u540c\u4e00\u4e2a<code>List</code>\u65f6\uff0c\u53ef\u80fd\u4f1a\u9047\u5230\u7ebf\u7a0b\u5b89\u5168\u95ee\u9898\u3002\u5982\u679c\u591a\u4e2a\u7ebf\u7a0b\u540c\u65f6\u4fee\u6539<code>List</code>\uff0c\u53ef\u80fd\u4f1a\u5bfc\u81f4\u6570\u636e\u4e0d\u4e00\u81f4\u6216\u629b\u51fa\u5f02\u5e38\u3002\u4e3a\u4e86\u786e\u4fdd\u7ebf\u7a0b\u5b89\u5168\uff0c\u53ef\u4ee5\u91c7\u53d6\u4ee5\u4e0b\u51e0\u79cd\u65b9\u5f0f\uff1a</p>"},{"location":"010Java/040MultiThreading/#1-collectionssynchronizedlist","title":"1. \u4f7f\u7528<code>Collections.synchronizedList</code>","text":"<p><code>Collections.synchronizedList</code>\u53ef\u4ee5\u5c06\u4e00\u4e2a\u666e\u901a\u7684<code>List</code>\u8f6c\u6362\u4e3a\u7ebf\u7a0b\u5b89\u5168\u7684<code>List</code>\u3002\u5b83\u901a\u8fc7\u5728\u65b9\u6cd5\u4e0a\u6dfb\u52a0<code>synchronized</code>\u5173\u952e\u5b57\u6765\u4fdd\u8bc1\u7ebf\u7a0b\u5b89\u5168\u3002</p> <pre><code>import java.util.Collections;\nimport java.util.List;\nimport java.util.ArrayList;\n\npublic class SynchronizedListExample {\n    public static void main(String[] args) {\n        List&lt;String&gt; list = Collections.synchronizedList(new ArrayList&lt;&gt;());\n\n        Runnable task = () -&gt; {\n            for (int i = 0; i &lt; 100; i++) {\n                list.add(Thread.currentThread().getName() + \" - \" + i);\n            }\n        };\n\n        Thread thread1 = new Thread(task);\n        Thread thread2 = new Thread(task);\n\n        thread1.start();\n        thread2.start();\n\n        try {\n            thread1.join();\n            thread2.join();\n        } catch (InterruptedException e) {\n            e.printStackTrace();\n        }\n\n        System.out.println(\"List size: \" + list.size());\n    }\n}\n</code></pre>"},{"location":"010Java/040MultiThreading/#2-copyonwritearraylist","title":"2. \u4f7f\u7528<code>CopyOnWriteArrayList</code>","text":"<p><code>CopyOnWriteArrayList</code>\u662f<code>java.util.concurrent</code>\u5305\u4e2d\u7684\u4e00\u4e2a\u7ebf\u7a0b\u5b89\u5168\u7684<code>List</code>\u5b9e\u73b0\u3002\u5b83\u5728\u5199\u64cd\u4f5c\u65f6\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u526f\u672c\uff0c\u56e0\u6b64\u8bfb\u64cd\u4f5c\u4e0d\u9700\u8981\u52a0\u9501\uff0c\u9002\u5408\u8bfb\u591a\u5199\u5c11\u7684\u573a\u666f\u3002</p> <pre><code>import java.util.concurrent.CopyOnWriteArrayList;\nimport java.util.List;\n\npublic class CopyOnWriteArrayListExample {\n    public static void main(String[] args) {\n        List&lt;String&gt; list = new CopyOnWriteArrayList&lt;&gt;();\n\n        Runnable task = () -&gt; {\n            for (int i = 0; i &lt; 100; i++) {\n                list.add(Thread.currentThread().getName() + \" - \" + i);\n            }\n        };\n\n        Thread thread1 = new Thread(task);\n        Thread thread2 = new Thread(task);\n\n        thread1.start();\n        thread2.start();\n\n        try {\n            thread1.join();\n            thread2.join();\n        } catch (InterruptedException e) {\n            e.printStackTrace();\n        }\n\n        System.out.println(\"List size: \" + list.size());\n    }\n}\n</code></pre>"},{"location":"010Java/040MultiThreading/#3_1","title":"3. \u624b\u52a8\u540c\u6b65","text":"<p>\u5982\u679c\u4f60\u4e0d\u60f3\u4f7f\u7528<code>Collections.synchronizedList</code>\u6216<code>CopyOnWriteArrayList</code>\uff0c\u53ef\u4ee5\u624b\u52a8\u4f7f\u7528<code>synchronized</code>\u5173\u952e\u5b57\u6765\u540c\u6b65\u5bf9<code>List</code>\u7684\u8bbf\u95ee\u3002</p> <pre><code>import java.util.List;\nimport java.util.ArrayList;\n\npublic class ManualSynchronizationExample {\n    public static void main(String[] args) {\n        List&lt;String&gt; list = new ArrayList&lt;&gt;();\n\n        Runnable task = () -&gt; {\n            synchronized (list) {\n                for (int i = 0; i &lt; 100; i++) {\n                    list.add(Thread.currentThread().getName() + \" - \" + i);\n                }\n            }\n        };\n\n        Thread thread1 = new Thread(task);\n        Thread thread2 = new Thread(task);\n\n        thread1.start();\n        thread2.start();\n\n        try {\n            thread1.join();\n            thread2.join();\n        } catch (InterruptedException e) {\n            e.printStackTrace();\n        }\n\n        System.out.println(\"List size: \" + list.size());\n    }\n}\n</code></pre>"},{"location":"010Java/040MultiThreading/#4-reentrantlock","title":"4. \u4f7f\u7528<code>ReentrantLock</code>","text":"<p>\u4f60\u4e5f\u53ef\u4ee5\u4f7f\u7528<code>ReentrantLock</code>\u6765\u624b\u52a8\u63a7\u5236\u5bf9<code>List</code>\u7684\u8bbf\u95ee\u3002</p> <pre><code>import java.util.List;\nimport java.util.ArrayList;\nimport java.util.concurrent.locks.ReentrantLock;\n\npublic class ReentrantLockExample {\n    private static final ReentrantLock lock = new ReentrantLock();\n\n    public static void main(String[] args) {\n        List&lt;String&gt; list = new ArrayList&lt;&gt;();\n\n        Runnable task = () -&gt; {\n            lock.lock();\n            try {\n                for (int i = 0; i &lt; 100; i++) {\n                    list.add(Thread.currentThread().getName() + \" - \" + i);\n                }\n            } finally {\n                lock.unlock();\n            }\n        };\n\n        Thread thread1 = new Thread(task);\n        Thread thread2 = new Thread(task);\n\n        thread1.start();\n        thread2.start();\n\n        try {\n            thread1.join();\n            thread2.join();\n        } catch (InterruptedException e) {\n            e.printStackTrace();\n        }\n\n        System.out.println(\"List size: \" + list.size());\n    }\n}\n</code></pre>"},{"location":"010Java/040MultiThreading/#_13","title":"\u603b\u7ed3","text":"<ul> <li><code>Collections.synchronizedList</code>\uff1a\u9002\u5408\u7b80\u5355\u7684\u540c\u6b65\u9700\u6c42\uff0c\u4f46\u9700\u8981\u624b\u52a8\u540c\u6b65\u8fed\u4ee3\u64cd\u4f5c\u3002</li> <li><code>CopyOnWriteArrayList</code>\uff1a\u9002\u5408\u8bfb\u591a\u5199\u5c11\u7684\u573a\u666f\uff0c\u5199\u64cd\u4f5c\u6027\u80fd\u8f83\u5dee\u3002</li> <li>\u624b\u52a8\u540c\u6b65\uff1a\u7075\u6d3b\uff0c\u4f46\u9700\u8981\u5c0f\u5fc3\u5904\u7406\u540c\u6b65\u5757\u3002</li> <li><code>ReentrantLock</code>\uff1a\u63d0\u4f9b\u66f4\u7075\u6d3b\u7684\u9501\u63a7\u5236\uff0c\u9002\u5408\u590d\u6742\u7684\u540c\u6b65\u9700\u6c42\u3002</li> </ul> <p>\u6839\u636e\u5177\u4f53\u7684\u5e94\u7528\u573a\u666f\u9009\u62e9\u5408\u9002\u7684\u7ebf\u7a0b\u5b89\u5168\u7b56\u7565\u3002</p>"},{"location":"010Java/040MultiThreading/#sleepwait","title":"\u7ebf\u7a0bsleep\u548cwait\u7684\u533a\u522b","text":"\u7b54\u6848 <p>\u5728Java\u4e2d\uff0c<code>sleep()</code>\u548c<code>wait()</code>\u90fd\u53ef\u4ee5\u4f7f\u7ebf\u7a0b\u6682\u505c\u6267\u884c\uff0c\u4f46\u5b83\u4eec\u7684\u884c\u4e3a\u548c\u7528\u9014\u6709\u663e\u8457\u533a\u522b\u3002\u4ee5\u4e0b\u662f\u4e24\u8005\u7684\u4e3b\u8981\u533a\u522b\uff1a</p>"},{"location":"010Java/040MultiThreading/#1_1","title":"1. \u6240\u5c5e\u7c7b","text":"<ul> <li><code>sleep()</code>\uff1a\u662f<code>Thread</code>\u7c7b\u7684\u9759\u6001\u65b9\u6cd5\u3002</li> <li><code>wait()</code>\uff1a\u662f<code>Object</code>\u7c7b\u7684\u5b9e\u4f8b\u65b9\u6cd5\u3002</li> </ul>"},{"location":"010Java/040MultiThreading/#2_2","title":"2. \u8c03\u7528\u65b9\u5f0f","text":"<ul> <li><code>sleep()</code>\uff1a\u53ef\u4ee5\u76f4\u63a5\u901a\u8fc7<code>Thread.sleep()</code>\u8c03\u7528\u3002     <pre><code>Thread.sleep(1000); // \u5f53\u524d\u7ebf\u7a0b\u4f11\u77201\u79d2\n</code></pre></li> <li><code>wait()</code>\uff1a\u5fc5\u987b\u5728\u540c\u6b65\u4ee3\u7801\u5757\u6216\u540c\u6b65\u65b9\u6cd5\u4e2d\u8c03\u7528\uff0c\u4e14\u9700\u8981\u6301\u6709\u5bf9\u8c61\u7684\u76d1\u89c6\u5668\u9501\uff08\u5373\u4f7f\u7528<code>synchronized</code>\uff09\u3002     <pre><code>synchronized (obj) {\n    obj.wait(); // \u5f53\u524d\u7ebf\u7a0b\u7b49\u5f85\uff0c\u91ca\u653eobj\u7684\u9501\n}\n</code></pre></li> </ul>"},{"location":"010Java/040MultiThreading/#3_2","title":"3. \u9501\u7684\u884c\u4e3a","text":"<ul> <li><code>sleep()</code>\uff1a\u4e0d\u4f1a\u91ca\u653e\u9501\u3002\u5373\u4f7f\u7ebf\u7a0b\u4f11\u7720\uff0c\u5b83\u4ecd\u7136\u6301\u6709\u9501\u3002</li> <li><code>wait()</code>\uff1a\u4f1a\u91ca\u653e\u9501\u3002\u8c03\u7528<code>wait()</code>\u540e\uff0c\u7ebf\u7a0b\u4f1a\u91ca\u653e\u5bf9\u8c61\u7684\u76d1\u89c6\u5668\u9501\uff0c\u5141\u8bb8\u5176\u4ed6\u7ebf\u7a0b\u83b7\u53d6\u9501\u5e76\u6267\u884c\u3002</li> </ul>"},{"location":"010Java/040MultiThreading/#4_1","title":"4. \u5524\u9192\u673a\u5236","text":"<ul> <li><code>sleep()</code>\uff1a\u7ebf\u7a0b\u5728\u6307\u5b9a\u7684\u65f6\u95f4\u540e\u81ea\u52a8\u5524\u9192\uff0c\u6216\u8005\u53ef\u4ee5\u901a\u8fc7<code>interrupt()</code>\u4e2d\u65ad\u4f11\u7720\u3002</li> <li><code>wait()</code>\uff1a\u7ebf\u7a0b\u9700\u8981\u88ab\u663e\u5f0f\u5524\u9192\uff0c\u901a\u5e38\u901a\u8fc7\u4ee5\u4e0b\u65b9\u5f0f\uff1a<ul> <li>\u5176\u4ed6\u7ebf\u7a0b\u8c03\u7528<code>notify()</code>\u6216<code>notifyAll()</code>\u3002</li> <li>\u8d85\u65f6\u65f6\u95f4\u5230\u8fbe\uff08\u5982\u679c\u6307\u5b9a\u4e86\u8d85\u65f6\u65f6\u95f4\uff09\u3002</li> <li>\u7ebf\u7a0b\u88ab<code>interrupt()</code>\u4e2d\u65ad\u3002</li> </ul> </li> </ul>"},{"location":"010Java/040MultiThreading/#5_1","title":"5. \u4f7f\u7528\u573a\u666f","text":"<ul> <li><code>sleep()</code>\uff1a\u7528\u4e8e\u8ba9\u7ebf\u7a0b\u6682\u505c\u6267\u884c\u4e00\u6bb5\u65f6\u95f4\uff0c\u901a\u5e38\u7528\u4e8e\u6a21\u62df\u5ef6\u8fdf\u6216\u5b9a\u65f6\u4efb\u52a1\u3002</li> <li><code>wait()</code>\uff1a\u7528\u4e8e\u7ebf\u7a0b\u95f4\u7684\u534f\u4f5c\uff0c\u901a\u5e38\u4e0e<code>notify()</code>\u6216<code>notifyAll()</code>\u914d\u5408\u4f7f\u7528\uff0c\u5b9e\u73b0\u7ebf\u7a0b\u7684\u7b49\u5f85\u548c\u5524\u9192\u673a\u5236\u3002</li> </ul>"},{"location":"010Java/040MultiThreading/#6_2","title":"6. \u5f02\u5e38\u5904\u7406","text":"<ul> <li><code>sleep()</code>\uff1a\u4f1a\u629b\u51fa<code>InterruptedException</code>\uff0c\u9700\u8981\u6355\u83b7\u6216\u58f0\u660e\u629b\u51fa\u3002</li> <li><code>wait()</code>\uff1a\u540c\u6837\u4f1a\u629b\u51fa<code>InterruptedException</code>\uff0c\u9700\u8981\u6355\u83b7\u6216\u58f0\u660e\u629b\u51fa\u3002</li> </ul>"},{"location":"010Java/040MultiThreading/#7_1","title":"7. \u793a\u4f8b\u4ee3\u7801","text":""},{"location":"010Java/040MultiThreading/#sleep","title":"<code>sleep()</code> \u793a\u4f8b","text":"<pre><code>public class SleepExample {\n    public static void main(String[] args) {\n        System.out.println(\"Start\");\n        try {\n            Thread.sleep(2000); // \u5f53\u524d\u7ebf\u7a0b\u4f11\u77202\u79d2\n        } catch (InterruptedException e) {\n            e.printStackTrace();\n        }\n        System.out.println(\"End\");\n    }\n}\n</code></pre>"},{"location":"010Java/040MultiThreading/#wait","title":"<code>wait()</code> \u793a\u4f8b","text":"<pre><code>public class WaitExample {\n    public static void main(String[] args) {\n        Object lock = new Object();\n\n        Thread t1 = new Thread(() -&gt; {\n            synchronized (lock) {\n                System.out.println(\"Thread 1 is waiting\");\n                try {\n                    lock.wait(); // \u91ca\u653e\u9501\u5e76\u7b49\u5f85\n                } catch (InterruptedException e) {\n                    e.printStackTrace();\n                }\n                System.out.println(\"Thread 1 is resumed\");\n            }\n        });\n\n        Thread t2 = new Thread(() -&gt; {\n            synchronized (lock) {\n                System.out.println(\"Thread 2 is notifying\");\n                lock.notify(); // \u5524\u9192\u7b49\u5f85\u7684\u7ebf\u7a0b\n            }\n        });\n\n        t1.start();\n        try {\n            Thread.sleep(1000); // \u786e\u4fddt1\u5148\u6267\u884c\n        } catch (InterruptedException e) {\n            e.printStackTrace();\n        }\n        t2.start();\n    }\n}\n</code></pre>"},{"location":"010Java/040MultiThreading/#_14","title":"\u603b\u7ed3\u5bf9\u6bd4","text":"\u7279\u6027 <code>sleep()</code> <code>wait()</code> \u6240\u5c5e\u7c7b <code>Thread</code> <code>Object</code> \u9501\u7684\u884c\u4e3a \u4e0d\u91ca\u653e\u9501 \u91ca\u653e\u9501 \u5524\u9192\u673a\u5236 \u81ea\u52a8\u5524\u9192\u6216\u4e2d\u65ad \u9700\u8981<code>notify()</code>/<code>notifyAll()</code>\u6216\u4e2d\u65ad \u4f7f\u7528\u573a\u666f \u5b9a\u65f6\u6682\u505c \u7ebf\u7a0b\u95f4\u534f\u4f5c \u8c03\u7528\u8981\u6c42 \u65e0\u7279\u6b8a\u8981\u6c42 \u5fc5\u987b\u5728\u540c\u6b65\u4ee3\u7801\u5757\u4e2d\u8c03\u7528 \u5f02\u5e38 <code>InterruptedException</code> <code>InterruptedException</code> <p>\u7406\u89e3\u4e24\u8005\u7684\u533a\u522b\u6709\u52a9\u4e8e\u5728\u591a\u7ebf\u7a0b\u7f16\u7a0b\u4e2d\u9009\u62e9\u5408\u9002\u7684\u5de5\u5177\u6765\u5b9e\u73b0\u7ebf\u7a0b\u63a7\u5236\u3002</p>"},{"location":"010Java/040MultiThreading/#java_3","title":"Java\u4e2d\u5f00\u542f\u7ebf\u7a0b\u7684\u4e09\u79cd\u65b9\u5f0f\uff1f\u5206\u522b\u6709\u4ec0\u4e48\u4f18\u52bf\uff1f","text":"\u7b54\u6848 <p>\u5728Java\u4e2d\uff0c\u5f00\u542f\u7ebf\u7a0b\u4e3b\u8981\u6709\u4ee5\u4e0b\u4e09\u79cd\u65b9\u5f0f\uff1a</p>"},{"location":"010Java/040MultiThreading/#1-thread","title":"1. \u7ee7\u627f <code>Thread</code> \u7c7b","text":"<p>\u901a\u8fc7\u7ee7\u627f <code>Thread</code> \u7c7b\u5e76\u91cd\u5199 <code>run()</code> \u65b9\u6cd5\u6765\u521b\u5efa\u7ebf\u7a0b\u3002</p> <pre><code>class MyThread extends Thread {\n    @Override\n    public void run() {\n        // \u7ebf\u7a0b\u6267\u884c\u7684\u4ee3\u7801\n    }\n}\n\n// \u4f7f\u7528\nMyThread thread = new MyThread();\nthread.start();\n</code></pre> <p>\u4f18\u52bf\uff1a - \u7b80\u5355\u6613\u7528\uff0c\u9002\u5408\u7b80\u5355\u7684\u7ebf\u7a0b\u4efb\u52a1\u3002 - \u53ef\u4ee5\u76f4\u63a5\u8c03\u7528 <code>Thread</code> \u7c7b\u7684\u65b9\u6cd5\uff0c\u5982 <code>getName()</code>\u3001<code>setName()</code> \u7b49\u3002</p> <p>\u52a3\u52bf\uff1a - Java\u4e0d\u652f\u6301\u591a\u7ee7\u627f\uff0c\u56e0\u6b64\u5982\u679c\u7c7b\u5df2\u7ecf\u7ee7\u627f\u4e86\u5176\u4ed6\u7c7b\uff0c\u5c31\u65e0\u6cd5\u518d\u7ee7\u627f <code>Thread</code>\u3002 - \u4ee3\u7801\u7684\u590d\u7528\u6027\u8f83\u5dee\uff0c\u56e0\u4e3a\u7ebf\u7a0b\u903b\u8f91\u4e0e <code>Thread</code> \u7c7b\u8026\u5408\u3002</p>"},{"location":"010Java/040MultiThreading/#2-runnable","title":"2. \u5b9e\u73b0 <code>Runnable</code> \u63a5\u53e3","text":"<p>\u901a\u8fc7\u5b9e\u73b0 <code>Runnable</code> \u63a5\u53e3\u5e76\u5c06\u5b9e\u4f8b\u4f20\u9012\u7ed9 <code>Thread</code> \u5bf9\u8c61\u6765\u521b\u5efa\u7ebf\u7a0b\u3002</p> <pre><code>class MyRunnable implements Runnable {\n    @Override\n    public void run() {\n        // \u7ebf\u7a0b\u6267\u884c\u7684\u4ee3\u7801\n    }\n}\n\n// \u4f7f\u7528\nThread thread = new Thread(new MyRunnable());\nthread.start();\n</code></pre> <p>\u4f18\u52bf\uff1a - \u907f\u514d\u4e86\u5355\u7ee7\u627f\u7684\u9650\u5236\uff0c\u56e0\u4e3a\u53ef\u4ee5\u5b9e\u73b0\u591a\u4e2a\u63a5\u53e3\u3002 - \u66f4\u9002\u5408\u591a\u4e2a\u7ebf\u7a0b\u5171\u4eab\u76f8\u540c\u8d44\u6e90\u7684\u573a\u666f\uff0c\u56e0\u4e3a\u53ef\u4ee5\u5c06\u540c\u4e00\u4e2a <code>Runnable</code> \u5b9e\u4f8b\u4f20\u9012\u7ed9\u591a\u4e2a <code>Thread</code> \u5bf9\u8c61\u3002 - \u4ee3\u7801\u7684\u590d\u7528\u6027\u66f4\u597d\uff0c\u7ebf\u7a0b\u903b\u8f91\u4e0e <code>Thread</code> \u7c7b\u89e3\u8026\u3002</p> <p>\u52a3\u52bf\uff1a - \u65e0\u6cd5\u76f4\u63a5\u8bbf\u95ee <code>Thread</code> \u7c7b\u7684\u65b9\u6cd5\uff0c\u9700\u8981\u901a\u8fc7 <code>Thread.currentThread()</code> \u83b7\u53d6\u5f53\u524d\u7ebf\u7a0b\u5bf9\u8c61\u3002</p>"},{"location":"010Java/040MultiThreading/#3-callable-futuretask","title":"3. \u5b9e\u73b0 <code>Callable</code> \u63a5\u53e3\u5e76\u901a\u8fc7 <code>FutureTask</code> \u542f\u52a8\u7ebf\u7a0b","text":"<p>\u901a\u8fc7\u5b9e\u73b0 <code>Callable</code> \u63a5\u53e3\u5e76\u4f7f\u7528 <code>FutureTask</code> \u6765\u521b\u5efa\u7ebf\u7a0b\u3002<code>Callable</code> \u4e0e <code>Runnable</code> \u7c7b\u4f3c\uff0c\u4f46\u5b83\u53ef\u4ee5\u8fd4\u56de\u7ed3\u679c\u5e76\u629b\u51fa\u5f02\u5e38\u3002</p> <pre><code>import java.util.concurrent.Callable;\nimport java.util.concurrent.FutureTask;\n\nclass MyCallable implements Callable&lt;String&gt; {\n    @Override\n    public String call() throws Exception {\n        // \u7ebf\u7a0b\u6267\u884c\u7684\u4ee3\u7801\n        return \"\u4efb\u52a1\u5b8c\u6210\";\n    }\n}\n\n// \u4f7f\u7528\nFutureTask&lt;String&gt; futureTask = new FutureTask&lt;&gt;(new MyCallable());\nThread thread = new Thread(futureTask);\nthread.start();\n\n// \u83b7\u53d6\u7ed3\u679c\nString result = futureTask.get();\n</code></pre> <p>\u4f18\u52bf\uff1a - \u53ef\u4ee5\u8fd4\u56de\u7ebf\u7a0b\u6267\u884c\u7684\u7ed3\u679c\uff0c\u9002\u5408\u9700\u8981\u83b7\u53d6\u7ebf\u7a0b\u6267\u884c\u7ed3\u679c\u7684\u573a\u666f\u3002 - \u53ef\u4ee5\u629b\u51fa\u5f02\u5e38\uff0c\u65b9\u4fbf\u5904\u7406\u7ebf\u7a0b\u4e2d\u7684\u5f02\u5e38\u60c5\u51b5\u3002 - \u4e0e <code>ExecutorService</code> \u7ed3\u5408\u4f7f\u7528\uff0c\u53ef\u4ee5\u66f4\u597d\u5730\u7ba1\u7406\u7ebf\u7a0b\u6c60\u548c\u4efb\u52a1\u3002</p> <p>\u52a3\u52bf\uff1a - \u4f7f\u7528\u76f8\u5bf9\u590d\u6742\uff0c\u9700\u8981\u5904\u7406 <code>FutureTask</code> \u548c <code>Callable</code> \u7684\u5173\u7cfb\u3002 - \u83b7\u53d6\u7ed3\u679c\u65f6\u4f1a\u963b\u585e\u5f53\u524d\u7ebf\u7a0b\uff0c\u76f4\u5230\u4efb\u52a1\u5b8c\u6210\u3002</p>"},{"location":"010Java/040MultiThreading/#_15","title":"\u603b\u7ed3","text":"<ul> <li>\u7ee7\u627f <code>Thread</code> \u7c7b\uff1a\u9002\u5408\u7b80\u5355\u7684\u7ebf\u7a0b\u4efb\u52a1\uff0c\u4f46\u53d7\u9650\u4e8e\u5355\u7ee7\u627f\u3002</li> <li>\u5b9e\u73b0 <code>Runnable</code> \u63a5\u53e3\uff1a\u9002\u5408\u9700\u8981\u5171\u4eab\u8d44\u6e90\u7684\u573a\u666f\uff0c\u4ee3\u7801\u590d\u7528\u6027\u597d\u3002</li> <li>\u5b9e\u73b0 <code>Callable</code> \u63a5\u53e3\uff1a\u9002\u5408\u9700\u8981\u8fd4\u56de\u7ed3\u679c\u6216\u5904\u7406\u5f02\u5e38\u7684\u573a\u666f\uff0c\u901a\u5e38\u4e0e\u7ebf\u7a0b\u6c60\u7ed3\u5408\u4f7f\u7528\u3002</li> </ul> <p>\u6839\u636e\u5177\u4f53\u9700\u6c42\u9009\u62e9\u5408\u9002\u7684\u65b9\u5f0f\u3002</p>"},{"location":"010Java/040MultiThreading/#threadrunnablecallablefutrue","title":"Thread\u3001Runnable\u3001Callable\u3001Futrue\u7c7b\u5173\u7cfb\u4e0e\u533a\u522b","text":"\u7b54\u6848 <p><code>Thread</code>\u3001<code>Runnable</code>\u3001<code>Callable</code> \u548c <code>Future</code> \u662f Java \u591a\u7ebf\u7a0b\u7f16\u7a0b\u4e2d\u5e38\u7528\u7684\u7c7b\u548c\u63a5\u53e3\uff0c\u5b83\u4eec\u4e4b\u95f4\u7684\u5173\u7cfb\u548c\u533a\u522b\u5982\u4e0b\uff1a</p>"},{"location":"010Java/040MultiThreading/#1-thread_1","title":"1. Thread","text":"<p><code>Thread</code> \u662f Java \u4e2d\u8868\u793a\u7ebf\u7a0b\u7684\u7c7b\u3002\u6bcf\u4e2a <code>Thread</code> \u5bf9\u8c61\u4ee3\u8868\u4e00\u4e2a\u72ec\u7acb\u7684\u6267\u884c\u7ebf\u7a0b\u3002</p> <ul> <li>\u7279\u70b9\uff1a</li> <li>\u7ee7\u627f <code>Thread</code> \u7c7b\u5e76\u91cd\u5199 <code>run()</code> \u65b9\u6cd5\u53ef\u4ee5\u5b9a\u4e49\u7ebf\u7a0b\u7684\u6267\u884c\u903b\u8f91\u3002</li> <li>\u901a\u8fc7\u8c03\u7528 <code>start()</code> \u65b9\u6cd5\u542f\u52a8\u7ebf\u7a0b\u3002</li> <li> <p>\u76f4\u63a5\u64cd\u4f5c\u7ebf\u7a0b\u7684\u751f\u547d\u5468\u671f\uff08\u5982 <code>start()</code>\u3001<code>join()</code>\u3001<code>interrupt()</code> \u7b49\uff09\u3002</p> </li> <li> <p>\u7f3a\u70b9\uff1a</p> </li> <li>Java \u4e0d\u652f\u6301\u591a\u7ee7\u627f\uff0c\u5982\u679c\u7c7b\u5df2\u7ecf\u7ee7\u627f\u4e86\u5176\u4ed6\u7c7b\uff0c\u5219\u65e0\u6cd5\u518d\u7ee7\u627f <code>Thread</code>\u3002</li> <li> <p>\u7ebf\u7a0b\u903b\u8f91\u4e0e <code>Thread</code> \u7c7b\u8026\u5408\uff0c\u590d\u7528\u6027\u8f83\u5dee\u3002</p> </li> <li> <p>\u793a\u4f8b\uff1a <pre><code>class MyThread extends Thread {\n    @Override\n    public void run() {\n        System.out.println(\"Thread is running\");\n    }\n}\n\nMyThread thread = new MyThread();\nthread.start();\n</code></pre></p> </li> </ul>"},{"location":"010Java/040MultiThreading/#2-runnable_1","title":"2. Runnable","text":"<p><code>Runnable</code> \u662f\u4e00\u4e2a\u51fd\u6570\u5f0f\u63a5\u53e3\uff0c\u7528\u4e8e\u5b9a\u4e49\u7ebf\u7a0b\u7684\u4efb\u52a1\u903b\u8f91\u3002</p> <ul> <li>\u7279\u70b9\uff1a</li> <li>\u5b9e\u73b0 <code>Runnable</code> \u63a5\u53e3\u5e76\u91cd\u5199 <code>run()</code> \u65b9\u6cd5\u3002</li> <li>\u9700\u8981\u5c06 <code>Runnable</code> \u5b9e\u4f8b\u4f20\u9012\u7ed9 <code>Thread</code> \u5bf9\u8c61\u6765\u542f\u52a8\u7ebf\u7a0b\u3002</li> <li> <p>\u907f\u514d\u4e86\u5355\u7ee7\u627f\u7684\u9650\u5236\uff0c\u9002\u5408\u591a\u4e2a\u7ebf\u7a0b\u5171\u4eab\u76f8\u540c\u8d44\u6e90\u7684\u573a\u666f\u3002</p> </li> <li> <p>\u4f18\u70b9\uff1a</p> </li> <li>\u4ee3\u7801\u590d\u7528\u6027\u9ad8\uff0c\u7ebf\u7a0b\u903b\u8f91\u4e0e <code>Thread</code> \u7c7b\u89e3\u8026\u3002</li> <li> <p>\u9002\u5408\u4e0e\u7ebf\u7a0b\u6c60\uff08\u5982 <code>ExecutorService</code>\uff09\u7ed3\u5408\u4f7f\u7528\u3002</p> </li> <li> <p>\u793a\u4f8b\uff1a <pre><code>class MyRunnable implements Runnable {\n    @Override\n    public void run() {\n        System.out.println(\"Runnable is running\");\n    }\n}\n\nThread thread = new Thread(new MyRunnable());\nthread.start();\n</code></pre></p> </li> </ul>"},{"location":"010Java/040MultiThreading/#3-callable","title":"3. Callable","text":"<p><code>Callable</code> \u662f\u4e00\u4e2a\u6cdb\u578b\u63a5\u53e3\uff0c\u7c7b\u4f3c\u4e8e <code>Runnable</code>\uff0c\u4f46\u5b83\u53ef\u4ee5\u8fd4\u56de\u7ed3\u679c\u5e76\u629b\u51fa\u5f02\u5e38\u3002</p> <ul> <li>\u7279\u70b9\uff1a</li> <li>\u5b9e\u73b0 <code>Callable</code> \u63a5\u53e3\u5e76\u91cd\u5199 <code>call()</code> \u65b9\u6cd5\u3002</li> <li><code>call()</code> \u65b9\u6cd5\u53ef\u4ee5\u8fd4\u56de\u4e00\u4e2a\u7ed3\u679c\uff08\u6cdb\u578b\u7c7b\u578b\uff09\uff0c\u5e76\u629b\u51fa\u5f02\u5e38\u3002</li> <li> <p>\u901a\u5e38\u4e0e <code>Future</code> \u6216 <code>FutureTask</code> \u7ed3\u5408\u4f7f\u7528\uff0c\u7528\u4e8e\u83b7\u53d6\u7ebf\u7a0b\u6267\u884c\u7684\u7ed3\u679c\u3002</p> </li> <li> <p>\u4f18\u70b9\uff1a</p> </li> <li>\u652f\u6301\u8fd4\u56de\u503c\uff0c\u9002\u5408\u9700\u8981\u83b7\u53d6\u7ebf\u7a0b\u6267\u884c\u7ed3\u679c\u7684\u573a\u666f\u3002</li> <li> <p>\u652f\u6301\u5f02\u5e38\u5904\u7406\uff0c\u65b9\u4fbf\u6355\u83b7\u7ebf\u7a0b\u4e2d\u7684\u5f02\u5e38\u3002</p> </li> <li> <p>\u793a\u4f8b\uff1a <pre><code>import java.util.concurrent.Callable;\nimport java.util.concurrent.FutureTask;\n\nclass MyCallable implements Callable&lt;String&gt; {\n    @Override\n    public String call() throws Exception {\n        return \"Callable result\";\n    }\n}\n\nFutureTask&lt;String&gt; futureTask = new FutureTask&lt;&gt;(new MyCallable());\nThread thread = new Thread(futureTask);\nthread.start();\n\nString result = futureTask.get(); // \u83b7\u53d6\u7ed3\u679c\nSystem.out.println(result);\n</code></pre></p> </li> </ul>"},{"location":"010Java/040MultiThreading/#4-future","title":"4. Future","text":"<p><code>Future</code> \u662f\u4e00\u4e2a\u63a5\u53e3\uff0c\u8868\u793a\u5f02\u6b65\u8ba1\u7b97\u7684\u7ed3\u679c\u3002</p> <ul> <li>\u7279\u70b9\uff1a</li> <li>\u7528\u4e8e\u83b7\u53d6 <code>Callable</code> \u4efb\u52a1\u7684\u6267\u884c\u7ed3\u679c\u3002</li> <li>\u63d0\u4f9b\u4e86\u68c0\u67e5\u4efb\u52a1\u662f\u5426\u5b8c\u6210\u3001\u83b7\u53d6\u7ed3\u679c\u3001\u53d6\u6d88\u4efb\u52a1\u7b49\u65b9\u6cd5\u3002</li> <li> <p>\u901a\u5e38\u4e0e <code>ExecutorService</code> \u7ed3\u5408\u4f7f\u7528\u3002</p> </li> <li> <p>\u5e38\u7528\u65b9\u6cd5\uff1a</p> </li> <li><code>get()</code>\uff1a\u83b7\u53d6\u8ba1\u7b97\u7ed3\u679c\uff08\u963b\u585e\u76f4\u5230\u4efb\u52a1\u5b8c\u6210\uff09\u3002</li> <li><code>isDone()</code>\uff1a\u68c0\u67e5\u4efb\u52a1\u662f\u5426\u5b8c\u6210\u3002</li> <li> <p><code>cancel()</code>\uff1a\u53d6\u6d88\u4efb\u52a1\u3002</p> </li> <li> <p>\u793a\u4f8b\uff1a <pre><code>import java.util.concurrent.*;\n\nclass MyCallable implements Callable&lt;String&gt; {\n    @Override\n    public String call() throws Exception {\n        return \"Future result\";\n    }\n}\n\nExecutorService executor = Executors.newSingleThreadExecutor();\nFuture&lt;String&gt; future = executor.submit(new MyCallable());\n\nString result = future.get(); // \u83b7\u53d6\u7ed3\u679c\nSystem.out.println(result);\n\nexecutor.shutdown();\n</code></pre></p> </li> </ul>"},{"location":"010Java/040MultiThreading/#5-futuretask","title":"5. FutureTask","text":"<p><code>FutureTask</code> \u662f <code>Future</code> \u63a5\u53e3\u7684\u4e00\u4e2a\u5b9e\u73b0\u7c7b\uff0c\u540c\u65f6\u5b9e\u73b0\u4e86 <code>Runnable</code> \u63a5\u53e3\u3002</p> <ul> <li>\u7279\u70b9\uff1a</li> <li>\u53ef\u4ee5\u5c06 <code>Callable</code> \u6216 <code>Runnable</code> \u4efb\u52a1\u5305\u88c5\u4e3a <code>FutureTask</code>\u3002</li> <li> <p>\u65e2\u53ef\u4ee5\u4f5c\u4e3a <code>Runnable</code> \u88ab\u7ebf\u7a0b\u6267\u884c\uff0c\u53c8\u53ef\u4ee5\u4f5c\u4e3a <code>Future</code> \u83b7\u53d6\u7ed3\u679c\u3002</p> </li> <li> <p>\u793a\u4f8b\uff1a <pre><code>import java.util.concurrent.*;\n\nclass MyCallable implements Callable&lt;String&gt; {\n    @Override\n    public String call() throws Exception {\n        return \"FutureTask result\";\n    }\n}\n\nFutureTask&lt;String&gt; futureTask = new FutureTask&lt;&gt;(new MyCallable());\nThread thread = new Thread(futureTask);\nthread.start();\n\nString result = futureTask.get(); // \u83b7\u53d6\u7ed3\u679c\nSystem.out.println(result);\n</code></pre></p> </li> </ul>"},{"location":"010Java/040MultiThreading/#_16","title":"\u5173\u7cfb\u4e0e\u533a\u522b","text":"\u7279\u6027 Thread Runnable Callable Future \u7c7b\u578b \u7c7b \u63a5\u53e3 \u63a5\u53e3 \u63a5\u53e3 \u8fd4\u56de\u503c \u65e0 \u65e0 \u6709\uff08\u6cdb\u578b\uff09 \u6709\uff08\u6cdb\u578b\uff09 \u5f02\u5e38\u5904\u7406 \u65e0 \u65e0 \u652f\u6301 \u652f\u6301 \u4f7f\u7528\u65b9\u5f0f \u7ee7\u627f <code>Thread</code> \u7c7b \u5b9e\u73b0 <code>Runnable</code> \u63a5\u53e3 \u5b9e\u73b0 <code>Callable</code> \u63a5\u53e3 \u4e0e <code>Callable</code> \u6216\u7ebf\u7a0b\u6c60\u7ed3\u5408 \u9002\u7528\u573a\u666f \u7b80\u5355\u7ebf\u7a0b\u4efb\u52a1 \u5171\u4eab\u8d44\u6e90\u7684\u591a\u7ebf\u7a0b\u4efb\u52a1 \u9700\u8981\u8fd4\u56de\u7ed3\u679c\u7684\u4efb\u52a1 \u5f02\u6b65\u4efb\u52a1\u7ed3\u679c\u83b7\u53d6 \u7ebf\u7a0b\u542f\u52a8 \u76f4\u63a5\u8c03\u7528 <code>start()</code> \u9700\u8981\u4f20\u9012\u7ed9 <code>Thread</code> \u9700\u8981\u4f20\u9012\u7ed9 <code>FutureTask</code> \u901a\u8fc7\u7ebf\u7a0b\u6c60\u63d0\u4ea4\u4efb\u52a1"},{"location":"010Java/040MultiThreading/#_17","title":"\u603b\u7ed3","text":"<ul> <li><code>Thread</code>\uff1a\u76f4\u63a5\u64cd\u4f5c\u7ebf\u7a0b\uff0c\u9002\u5408\u7b80\u5355\u4efb\u52a1\uff0c\u4f46\u53d7\u9650\u4e8e\u5355\u7ee7\u627f\u3002</li> <li><code>Runnable</code>\uff1a\u89e3\u8026\u7ebf\u7a0b\u903b\u8f91\uff0c\u9002\u5408\u5171\u4eab\u8d44\u6e90\u7684\u4efb\u52a1\u3002</li> <li><code>Callable</code>\uff1a\u652f\u6301\u8fd4\u56de\u503c\u548c\u5f02\u5e38\u5904\u7406\uff0c\u9002\u5408\u9700\u8981\u7ed3\u679c\u7684\u4efb\u52a1\u3002</li> <li><code>Future</code>\uff1a\u7528\u4e8e\u83b7\u53d6\u5f02\u6b65\u4efb\u52a1\u7684\u7ed3\u679c\uff0c\u901a\u5e38\u4e0e\u7ebf\u7a0b\u6c60\u7ed3\u5408\u4f7f\u7528\u3002</li> </ul> <p>\u6839\u636e\u5177\u4f53\u9700\u6c42\u9009\u62e9\u5408\u9002\u7684\u5de5\u5177\u7c7b\u6216\u63a5\u53e3\u3002</p>"},{"location":"010Java/040MultiThreading/#jdkthread","title":"JDK\u7ebf\u7a0b\u6c60\u662f\u4ec0\u4e48\uff0c\u76f8\u6bd4Thread\u6709\u54ea\u4e9b\u4f18\u52bf\uff1f","text":"\u7b54\u6848 <p>JDK\u7ebf\u7a0b\u6c60\u662fJava\u4e2d\u7ba1\u7406\u548c\u590d\u7528\u7ebf\u7a0b\u7684\u673a\u5236\uff0c\u76f8\u6bd4\u76f4\u63a5\u4f7f\u7528<code>Thread</code>\u7c7b\uff0c\u5177\u6709\u4ee5\u4e0b\u4f18\u52bf\uff1a</p>"},{"location":"010Java/040MultiThreading/#1_2","title":"1. \u8d44\u6e90\u7ba1\u7406","text":"<ul> <li>\u7ebf\u7a0b\u590d\u7528\uff1a\u7ebf\u7a0b\u6c60\u901a\u8fc7\u590d\u7528\u5df2\u6709\u7ebf\u7a0b\uff0c\u51cf\u5c11\u9891\u7e41\u521b\u5efa\u548c\u9500\u6bc1\u7ebf\u7a0b\u7684\u5f00\u9500\u3002</li> <li>\u8d44\u6e90\u63a7\u5236\uff1a\u53ef\u4ee5\u9650\u5236\u7ebf\u7a0b\u6570\u91cf\uff0c\u9632\u6b62\u8d44\u6e90\u8017\u5c3d\u3002</li> </ul>"},{"location":"010Java/040MultiThreading/#2_3","title":"2. \u6027\u80fd\u63d0\u5347","text":"<ul> <li>\u964d\u4f4e\u5f00\u9500\uff1a\u7ebf\u7a0b\u521b\u5efa\u548c\u9500\u6bc1\u7684\u5f00\u9500\u8f83\u5927\uff0c\u7ebf\u7a0b\u6c60\u901a\u8fc7\u590d\u7528\u7ebf\u7a0b\u63d0\u5347\u6027\u80fd\u3002</li> <li>\u54cd\u5e94\u901f\u5ea6\uff1a\u4efb\u52a1\u5230\u8fbe\u65f6\uff0c\u7ebf\u7a0b\u6c60\u53ef\u4ee5\u7acb\u5373\u5206\u914d\u7ebf\u7a0b\u6267\u884c\uff0c\u65e0\u9700\u7b49\u5f85\u7ebf\u7a0b\u521b\u5efa\u3002</li> </ul>"},{"location":"010Java/040MultiThreading/#3_3","title":"3. \u4efb\u52a1\u7ba1\u7406","text":"<ul> <li>\u4efb\u52a1\u961f\u5217\uff1a\u7ebf\u7a0b\u6c60\u63d0\u4f9b\u4efb\u52a1\u961f\u5217\uff0c\u652f\u6301\u4efb\u52a1\u6392\u961f\u548c\u6267\u884c\u7b56\u7565\u7684\u7075\u6d3b\u914d\u7f6e\u3002</li> <li>\u62d2\u7edd\u7b56\u7565\uff1a\u5f53\u4efb\u52a1\u8fc7\u591a\u65f6\uff0c\u7ebf\u7a0b\u6c60\u63d0\u4f9b\u591a\u79cd\u62d2\u7edd\u7b56\u7565\uff0c\u5982\u4e22\u5f03\u4efb\u52a1\u6216\u629b\u51fa\u5f02\u5e38\u3002</li> </ul>"},{"location":"010Java/040MultiThreading/#4_2","title":"4. \u7ebf\u7a0b\u7ba1\u7406","text":"<ul> <li>\u7edf\u4e00\u7ba1\u7406\uff1a\u7ebf\u7a0b\u6c60\u96c6\u4e2d\u7ba1\u7406\u7ebf\u7a0b\u7684\u751f\u547d\u5468\u671f\uff0c\u7b80\u5316\u7ebf\u7a0b\u7ba1\u7406\u3002</li> <li>\u76d1\u63a7\u548c\u7edf\u8ba1\uff1a\u63d0\u4f9b\u7ebf\u7a0b\u72b6\u6001\u548c\u4efb\u52a1\u6267\u884c\u7684\u76d1\u63a7\u529f\u80fd\uff0c\u4fbf\u4e8e\u8c03\u8bd5\u548c\u4f18\u5316\u3002</li> </ul>"},{"location":"010Java/040MultiThreading/#5_2","title":"5. \u53ef\u6269\u5c55\u6027","text":"<ul> <li>\u81ea\u5b9a\u4e49\u7ebf\u7a0b\u6c60\uff1a\u901a\u8fc7<code>ThreadPoolExecutor</code>\u7c7b\uff0c\u53ef\u4ee5\u6839\u636e\u9700\u6c42\u81ea\u5b9a\u4e49\u7ebf\u7a0b\u6c60\u53c2\u6570\uff0c\u5982\u6838\u5fc3\u7ebf\u7a0b\u6570\u3001\u6700\u5927\u7ebf\u7a0b\u6570\u7b49\u3002</li> </ul>"},{"location":"010Java/040MultiThreading/#_18","title":"\u793a\u4f8b\u4ee3\u7801","text":"<pre><code>import java.util.concurrent.ExecutorService;\nimport java.util.concurrent.Executors;\n\npublic class ThreadPoolExample {\n    public static void main(String[] args) {\n        // \u521b\u5efa\u56fa\u5b9a\u5927\u5c0f\u7684\u7ebf\u7a0b\u6c60\n        ExecutorService executor = Executors.newFixedThreadPool(5);\n\n        // \u63d0\u4ea4\u4efb\u52a1\n        for (int i = 0; i &lt; 10; i++) {\n            Runnable task = new Task(i);\n            executor.execute(task);\n        }\n\n        // \u5173\u95ed\u7ebf\u7a0b\u6c60\n        executor.shutdown();\n    }\n}\n\nclass Task implements Runnable {\n    private int taskId;\n\n    public Task(int taskId) {\n        this.taskId = taskId;\n    }\n\n    @Override\n    public void run() {\n        System.out.println(\"Task \" + taskId + \" is running on thread \" + Thread.currentThread().getName());\n    }\n}\n</code></pre>"},{"location":"010Java/040MultiThreading/#_19","title":"\u603b\u7ed3","text":"<p>JDK\u7ebf\u7a0b\u6c60\u901a\u8fc7\u590d\u7528\u7ebf\u7a0b\u3001\u63a7\u5236\u8d44\u6e90\u3001\u63d0\u5347\u6027\u80fd\u3001\u7b80\u5316\u7ba1\u7406\u548c\u63d0\u4f9b\u7075\u6d3b\u6027\uff0c\u663e\u8457\u4f18\u4e8e\u76f4\u63a5\u4f7f\u7528<code>Thread</code>\u7c7b\uff0c\u9002\u5408\u9ad8\u5e76\u53d1\u548c\u591a\u4efb\u52a1\u573a\u666f\u3002</p>"},{"location":"010Java/040MultiThreading/#jdk","title":"JDK\u4e2d\u9ed8\u8ba4\u63d0\u4f9b\u4e86\u54ea\u4e9b\u7ebf\u7a0b\u6c60\uff0c\u5404\u81ea\u6709\u4f55\u4f18\u52bf","text":"\u7b54\u6848 <p>JDK\u901a\u8fc7<code>Executors</code>\u7c7b\u63d0\u4f9b\u4e86\u51e0\u79cd\u5e38\u7528\u7684\u7ebf\u7a0b\u6c60\uff0c\u6bcf\u79cd\u7ebf\u7a0b\u6c60\u9002\u7528\u4e8e\u4e0d\u540c\u7684\u573a\u666f\u3002\u4ee5\u4e0b\u662f\u9ed8\u8ba4\u63d0\u4f9b\u7684\u7ebf\u7a0b\u6c60\u53ca\u5176\u4f18\u52bf\uff1a</p>"},{"location":"010Java/040MultiThreading/#1-fixedthreadpool","title":"1. FixedThreadPool\uff08\u56fa\u5b9a\u5927\u5c0f\u7ebf\u7a0b\u6c60\uff09","text":"<ul> <li>\u521b\u5efa\u65b9\u5f0f\uff1a <pre><code>ExecutorService executor = Executors.newFixedThreadPool(int nThreads);\n</code></pre></li> <li>\u7279\u70b9\uff1a</li> <li>\u7ebf\u7a0b\u6c60\u4e2d\u7684\u7ebf\u7a0b\u6570\u91cf\u56fa\u5b9a\u3002</li> <li>\u5982\u679c\u6240\u6709\u7ebf\u7a0b\u90fd\u5728\u5fd9\uff0c\u65b0\u4efb\u52a1\u4f1a\u8fdb\u5165\u961f\u5217\u7b49\u5f85\u3002</li> <li>\u4f18\u52bf\uff1a</li> <li>\u9002\u5408\u8d1f\u8f7d\u8f83\u91cd\u7684\u670d\u52a1\u5668\u73af\u5883\uff0c\u53ef\u4ee5\u63a7\u5236\u8d44\u6e90\u4f7f\u7528\u3002</li> <li>\u7ebf\u7a0b\u6570\u91cf\u56fa\u5b9a\uff0c\u907f\u514d\u9891\u7e41\u521b\u5efa\u548c\u9500\u6bc1\u7ebf\u7a0b\u3002</li> <li>\u9002\u7528\u573a\u666f\uff1a</li> <li>\u9700\u8981\u9650\u5236\u5e76\u53d1\u7ebf\u7a0b\u6570\u91cf\u7684\u573a\u666f\u3002</li> <li>CPU\u5bc6\u96c6\u578b\u4efb\u52a1\uff08\u7ebf\u7a0b\u6570\u901a\u5e38\u8bbe\u7f6e\u4e3aCPU\u6838\u5fc3\u6570\uff09\u3002</li> </ul>"},{"location":"010Java/040MultiThreading/#2-cachedthreadpool","title":"2. CachedThreadPool\uff08\u7f13\u5b58\u7ebf\u7a0b\u6c60\uff09","text":"<ul> <li>\u521b\u5efa\u65b9\u5f0f\uff1a <pre><code>ExecutorService executor = Executors.newCachedThreadPool();\n</code></pre></li> <li>\u7279\u70b9\uff1a</li> <li>\u7ebf\u7a0b\u6c60\u4e2d\u7684\u7ebf\u7a0b\u6570\u91cf\u4e0d\u56fa\u5b9a\uff0c\u6839\u636e\u9700\u8981\u521b\u5efa\u65b0\u7ebf\u7a0b\u3002</li> <li>\u7a7a\u95f2\u7ebf\u7a0b\u4f1a\u88ab\u56de\u6536\uff08\u9ed8\u8ba460\u79d2\uff09\u3002</li> <li>\u4f18\u52bf\uff1a</li> <li>\u9002\u5408\u5904\u7406\u5927\u91cf\u77ed\u751f\u547d\u5468\u671f\u7684\u4efb\u52a1\u3002</li> <li>\u7ebf\u7a0b\u6c60\u4f1a\u6839\u636e\u4efb\u52a1\u6570\u91cf\u52a8\u6001\u8c03\u6574\u7ebf\u7a0b\u6570\u3002</li> <li>\u9002\u7528\u573a\u666f\uff1a</li> <li>\u5927\u91cf\u77ed\u671f\u5f02\u6b65\u4efb\u52a1\u3002</li> <li>IO\u5bc6\u96c6\u578b\u4efb\u52a1\uff08\u5982\u7f51\u7edc\u8bf7\u6c42\u3001\u6587\u4ef6\u8bfb\u5199\uff09\u3002</li> </ul>"},{"location":"010Java/040MultiThreading/#3-singlethreadexecutor","title":"3. SingleThreadExecutor\uff08\u5355\u7ebf\u7a0b\u7ebf\u7a0b\u6c60\uff09","text":"<ul> <li>\u521b\u5efa\u65b9\u5f0f\uff1a <pre><code>ExecutorService executor = Executors.newSingleThreadExecutor();\n</code></pre></li> <li>\u7279\u70b9\uff1a</li> <li>\u7ebf\u7a0b\u6c60\u4e2d\u53ea\u6709\u4e00\u4e2a\u7ebf\u7a0b\u3002</li> <li>\u4efb\u52a1\u6309\u987a\u5e8f\u6267\u884c\u3002</li> <li>\u4f18\u52bf\uff1a</li> <li>\u4fdd\u8bc1\u4efb\u52a1\u987a\u5e8f\u6267\u884c\uff0c\u65e0\u9700\u989d\u5916\u540c\u6b65\u3002</li> <li>\u9002\u5408\u9700\u8981\u4fdd\u8bc1\u4efb\u52a1\u987a\u5e8f\u7684\u573a\u666f\u3002</li> <li>\u9002\u7528\u573a\u666f\uff1a</li> <li>\u9700\u8981\u987a\u5e8f\u6267\u884c\u4efb\u52a1\u7684\u573a\u666f\u3002</li> <li>\u5355\u7ebf\u7a0b\u4efb\u52a1\u961f\u5217\u3002</li> </ul>"},{"location":"010Java/040MultiThreading/#4-scheduledthreadpool","title":"4. ScheduledThreadPool\uff08\u5b9a\u65f6\u4efb\u52a1\u7ebf\u7a0b\u6c60\uff09","text":"<ul> <li>\u521b\u5efa\u65b9\u5f0f\uff1a <pre><code>ScheduledExecutorService executor = Executors.newScheduledThreadPool(int corePoolSize);\n</code></pre></li> <li>\u7279\u70b9\uff1a</li> <li>\u652f\u6301\u5b9a\u65f6\u4efb\u52a1\u548c\u5468\u671f\u6027\u4efb\u52a1\u3002</li> <li>\u53ef\u4ee5\u6307\u5b9a\u4efb\u52a1\u7684\u5ef6\u8fdf\u65f6\u95f4\u6216\u6267\u884c\u5468\u671f\u3002</li> <li>\u4f18\u52bf\uff1a</li> <li>\u9002\u5408\u9700\u8981\u5b9a\u65f6\u6267\u884c\u6216\u5468\u671f\u6027\u6267\u884c\u4efb\u52a1\u7684\u573a\u666f\u3002</li> <li>\u7075\u6d3b\u63a7\u5236\u4efb\u52a1\u7684\u6267\u884c\u65f6\u95f4\u3002</li> <li>\u9002\u7528\u573a\u666f\uff1a</li> <li>\u5b9a\u65f6\u4efb\u52a1\uff08\u5982\u5b9a\u65f6\u6570\u636e\u540c\u6b65\uff09\u3002</li> <li>\u5468\u671f\u6027\u4efb\u52a1\uff08\u5982\u5fc3\u8df3\u68c0\u6d4b\uff09\u3002</li> </ul>"},{"location":"010Java/040MultiThreading/#5-workstealingpool","title":"5. WorkStealingPool\uff08\u5de5\u4f5c\u7a83\u53d6\u7ebf\u7a0b\u6c60\uff09","text":"<ul> <li>\u521b\u5efa\u65b9\u5f0f\uff1a <pre><code>ExecutorService executor = Executors.newWorkStealingPool(int parallelism);\n</code></pre></li> <li>\u7279\u70b9\uff1a</li> <li>\u57fa\u4e8eForkJoinPool\u5b9e\u73b0\uff0c\u652f\u6301\u5de5\u4f5c\u7a83\u53d6\u7b97\u6cd5\u3002</li> <li>\u9ed8\u8ba4\u5e76\u884c\u5ea6\u4e3aCPU\u6838\u5fc3\u6570\u3002</li> <li>\u4f18\u52bf\uff1a</li> <li>\u9002\u5408\u5904\u7406\u5927\u91cf\u5c0f\u4efb\u52a1\u7684\u573a\u666f\u3002</li> <li>\u81ea\u52a8\u5e73\u8861\u7ebf\u7a0b\u8d1f\u8f7d\uff0c\u63d0\u9ad8CPU\u5229\u7528\u7387\u3002</li> <li>\u9002\u7528\u573a\u666f\uff1a</li> <li>\u5e76\u884c\u8ba1\u7b97\u4efb\u52a1\u3002</li> <li>\u5927\u91cf\u5c0f\u4efb\u52a1\u7684\u5e76\u53d1\u5904\u7406\u3002</li> </ul>"},{"location":"010Java/040MultiThreading/#6-forkjoinpool","title":"6. ForkJoinPool\uff08\u5206\u6cbb\u7ebf\u7a0b\u6c60\uff09","text":"<ul> <li>\u521b\u5efa\u65b9\u5f0f\uff1a <pre><code>ForkJoinPool pool = new ForkJoinPool(int parallelism);\n</code></pre></li> <li>\u7279\u70b9\uff1a</li> <li>\u57fa\u4e8e\u5206\u6cbb\u7b97\u6cd5\uff08Divide and Conquer\uff09\uff0c\u9002\u5408\u9012\u5f52\u4efb\u52a1\u3002</li> <li>\u652f\u6301\u5de5\u4f5c\u7a83\u53d6\u7b97\u6cd5\u3002</li> <li>\u4f18\u52bf\uff1a</li> <li>\u9002\u5408\u5904\u7406\u53ef\u4ee5\u5206\u89e3\u7684\u5b50\u4efb\u52a1\u3002</li> <li>\u81ea\u52a8\u5e73\u8861\u4efb\u52a1\u8d1f\u8f7d\u3002</li> <li>\u9002\u7528\u573a\u666f\uff1a</li> <li>\u9012\u5f52\u4efb\u52a1\uff08\u5982\u5f52\u5e76\u6392\u5e8f\u3001\u5feb\u901f\u6392\u5e8f\uff09\u3002</li> <li>\u5e76\u884c\u8ba1\u7b97\u4efb\u52a1\u3002</li> </ul>"},{"location":"010Java/040MultiThreading/#_20","title":"\u603b\u7ed3","text":"\u7ebf\u7a0b\u6c60\u7c7b\u578b \u7279\u70b9 \u4f18\u52bf \u9002\u7528\u573a\u666f FixedThreadPool \u56fa\u5b9a\u7ebf\u7a0b\u6570 \u8d44\u6e90\u63a7\u5236\uff0c\u9002\u5408\u8d1f\u8f7d\u8f83\u91cd\u7684\u573a\u666f CPU\u5bc6\u96c6\u578b\u4efb\u52a1 CachedThreadPool \u52a8\u6001\u8c03\u6574\u7ebf\u7a0b\u6570 \u9002\u5408\u5927\u91cf\u77ed\u671f\u4efb\u52a1 IO\u5bc6\u96c6\u578b\u4efb\u52a1 SingleThreadExecutor \u5355\u7ebf\u7a0b \u4fdd\u8bc1\u4efb\u52a1\u987a\u5e8f\u6267\u884c \u987a\u5e8f\u4efb\u52a1\u961f\u5217 ScheduledThreadPool \u652f\u6301\u5b9a\u65f6\u548c\u5468\u671f\u6027\u4efb\u52a1 \u7075\u6d3b\u63a7\u5236\u4efb\u52a1\u6267\u884c\u65f6\u95f4 \u5b9a\u65f6\u4efb\u52a1\u3001\u5468\u671f\u6027\u4efb\u52a1 WorkStealingPool \u57fa\u4e8eForkJoinPool\uff0c\u5de5\u4f5c\u7a83\u53d6\u7b97\u6cd5 \u81ea\u52a8\u5e73\u8861\u8d1f\u8f7d\uff0c\u9002\u5408\u5927\u91cf\u5c0f\u4efb\u52a1 \u5e76\u884c\u8ba1\u7b97\u4efb\u52a1 ForkJoinPool \u5206\u6cbb\u7b97\u6cd5\uff0c\u5de5\u4f5c\u7a83\u53d6 \u9002\u5408\u9012\u5f52\u4efb\u52a1\uff0c\u81ea\u52a8\u5e73\u8861\u8d1f\u8f7d \u9012\u5f52\u4efb\u52a1\u3001\u5e76\u884c\u8ba1\u7b97 <p>\u6839\u636e\u5177\u4f53\u9700\u6c42\u9009\u62e9\u5408\u9002\u7684\u7ebf\u7a0b\u6c60\uff0c\u53ef\u4ee5\u663e\u8457\u63d0\u5347\u7a0b\u5e8f\u6027\u80fd\u548c\u8d44\u6e90\u5229\u7528\u7387\u3002</p>"},{"location":"010Java/040MultiThreading/#threadpoolexecutor","title":"ThreadPoolExecutor\u6e90\u7801\u5206\u6790","text":"\u7b54\u6848 <p>\u53c2\u8003\u7b54\u6848 https://juejin.cn/post/6926471351452565512</p> <p><code>ThreadPoolExecutor</code> \u662f JDK \u4e2d\u7ebf\u7a0b\u6c60\u7684\u6838\u5fc3\u5b9e\u73b0\u7c7b\uff0c\u63d0\u4f9b\u4e86\u4e30\u5bcc\u7684\u529f\u80fd\u548c\u7075\u6d3b\u7684\u914d\u7f6e\u9009\u9879\u3002\u901a\u8fc7\u5206\u6790\u5176\u6e90\u7801\uff0c\u53ef\u4ee5\u6df1\u5165\u4e86\u89e3\u5176\u8bbe\u8ba1\u601d\u60f3\u548c\u7279\u6027\u3002\u4ee5\u4e0b\u662f <code>ThreadPoolExecutor</code> \u7684\u4e3b\u8981\u7279\u6027\u53ca\u5176\u6e90\u7801\u5206\u6790\uff1a</p>"},{"location":"010Java/040MultiThreading/#1_3","title":"1. \u6838\u5fc3\u53c2\u6570","text":"<p><code>ThreadPoolExecutor</code> \u7684\u6784\u9020\u51fd\u6570\u5305\u542b\u4ee5\u4e0b\u6838\u5fc3\u53c2\u6570\uff1a <pre><code>public ThreadPoolExecutor(\n    int corePoolSize,      // \u6838\u5fc3\u7ebf\u7a0b\u6570\n    int maximumPoolSize,   // \u6700\u5927\u7ebf\u7a0b\u6570\n    long keepAliveTime,    // \u7a7a\u95f2\u7ebf\u7a0b\u5b58\u6d3b\u65f6\u95f4\n    TimeUnit unit,         // \u65f6\u95f4\u5355\u4f4d\n    BlockingQueue&lt;Runnable&gt; workQueue, // \u4efb\u52a1\u961f\u5217\n    ThreadFactory threadFactory,       // \u7ebf\u7a0b\u5de5\u5382\n    RejectedExecutionHandler handler   // \u62d2\u7edd\u7b56\u7565\n)\n</code></pre> - corePoolSize\uff1a\u6838\u5fc3\u7ebf\u7a0b\u6570\uff0c\u5373\u4f7f\u7ebf\u7a0b\u7a7a\u95f2\u4e5f\u4e0d\u4f1a\u88ab\u56de\u6536\uff0c\u9664\u975e\u8bbe\u7f6e <code>allowCoreThreadTimeOut</code>\u3002 - maximumPoolSize\uff1a\u6700\u5927\u7ebf\u7a0b\u6570\uff0c\u5f53\u4efb\u52a1\u961f\u5217\u6ee1\u65f6\uff0c\u4f1a\u521b\u5efa\u65b0\u7ebf\u7a0b\uff0c\u76f4\u5230\u8fbe\u5230\u6700\u5927\u7ebf\u7a0b\u6570\u3002 - keepAliveTime\uff1a\u975e\u6838\u5fc3\u7ebf\u7a0b\u7684\u7a7a\u95f2\u5b58\u6d3b\u65f6\u95f4\u3002 - workQueue\uff1a\u4efb\u52a1\u961f\u5217\uff0c\u7528\u4e8e\u5b58\u653e\u5f85\u6267\u884c\u7684\u4efb\u52a1\u3002 - threadFactory\uff1a\u7ebf\u7a0b\u5de5\u5382\uff0c\u7528\u4e8e\u521b\u5efa\u7ebf\u7a0b\u3002 - handler\uff1a\u62d2\u7edd\u7b56\u7565\uff0c\u5f53\u7ebf\u7a0b\u6c60\u548c\u961f\u5217\u90fd\u6ee1\u65f6\uff0c\u5982\u4f55\u5904\u7406\u65b0\u4efb\u52a1\u3002</p>"},{"location":"010Java/040MultiThreading/#2_4","title":"2. \u4efb\u52a1\u8c03\u5ea6\u673a\u5236","text":"<p><code>ThreadPoolExecutor</code> \u7684\u4efb\u52a1\u8c03\u5ea6\u903b\u8f91\u4e3b\u8981\u5728 <code>execute(Runnable command)</code> \u65b9\u6cd5\u4e2d\u5b9e\u73b0\uff1a <pre><code>public void execute(Runnable command) {\n    if (command == null)\n        throw new NullPointerException();\n    int c = ctl.get();\n    // 1. \u5982\u679c\u5f53\u524d\u7ebf\u7a0b\u6570\u5c0f\u4e8e\u6838\u5fc3\u7ebf\u7a0b\u6570\uff0c\u521b\u5efa\u65b0\u7ebf\u7a0b\n    if (workerCountOf(c) &lt; corePoolSize) {\n        if (addWorker(command, true))\n            return;\n        c = ctl.get();\n    }\n    // 2. \u5982\u679c\u7ebf\u7a0b\u6c60\u6b63\u5728\u8fd0\u884c\uff0c\u5c06\u4efb\u52a1\u52a0\u5165\u961f\u5217\n    if (isRunning(c) &amp;&amp; workQueue.offer(command)) {\n        int recheck = ctl.get();\n        if (!isRunning(recheck) &amp;&amp; remove(command))\n            reject(command);\n        else if (workerCountOf(recheck) == 0)\n            addWorker(null, false);\n    }\n    // 3. \u5982\u679c\u961f\u5217\u5df2\u6ee1\uff0c\u5c1d\u8bd5\u521b\u5efa\u65b0\u7ebf\u7a0b\n    else if (!addWorker(command, false))\n        // 4. \u5982\u679c\u521b\u5efa\u7ebf\u7a0b\u5931\u8d25\uff0c\u6267\u884c\u62d2\u7edd\u7b56\u7565\n        reject(command);\n}\n</code></pre> - \u6b65\u9aa41\uff1a\u4f18\u5148\u521b\u5efa\u6838\u5fc3\u7ebf\u7a0b\u6267\u884c\u4efb\u52a1\u3002 - \u6b65\u9aa42\uff1a\u5982\u679c\u6838\u5fc3\u7ebf\u7a0b\u5df2\u6ee1\uff0c\u5c06\u4efb\u52a1\u52a0\u5165\u961f\u5217\u3002 - \u6b65\u9aa43\uff1a\u5982\u679c\u961f\u5217\u5df2\u6ee1\uff0c\u5c1d\u8bd5\u521b\u5efa\u975e\u6838\u5fc3\u7ebf\u7a0b\u3002 - \u6b65\u9aa44\uff1a\u5982\u679c\u7ebf\u7a0b\u6c60\u5df2\u6ee1\uff0c\u6267\u884c\u62d2\u7edd\u7b56\u7565\u3002</p>"},{"location":"010Java/040MultiThreading/#3_4","title":"3. \u7ebf\u7a0b\u7ba1\u7406","text":"<p><code>ThreadPoolExecutor</code> \u4f7f\u7528 <code>Worker</code> \u7c7b\u6765\u7ba1\u7406\u7ebf\u7a0b\uff1a <pre><code>private final class Worker extends AbstractQueuedSynchronizer implements Runnable {\n    final Thread thread; // \u5b9e\u9645\u6267\u884c\u4efb\u52a1\u7684\u7ebf\u7a0b\n    Runnable firstTask;  // \u521d\u59cb\u4efb\u52a1\n    Worker(Runnable firstTask) {\n        this.firstTask = firstTask;\n        this.thread = getThreadFactory().newThread(this);\n    }\n    public void run() {\n        runWorker(this);\n    }\n    // ...\n}\n</code></pre> - Worker \u662f\u7ebf\u7a0b\u6c60\u4e2d\u7ebf\u7a0b\u7684\u5c01\u88c5\uff0c\u6bcf\u4e2a <code>Worker</code> \u6301\u6709\u4e00\u4e2a\u7ebf\u7a0b\u548c\u4e00\u4e2a\u521d\u59cb\u4efb\u52a1\u3002 - <code>runWorker</code> \u65b9\u6cd5\u662f\u7ebf\u7a0b\u6267\u884c\u4efb\u52a1\u7684\u6838\u5fc3\u903b\u8f91\uff0c\u4f1a\u4e0d\u65ad\u4ece\u961f\u5217\u4e2d\u83b7\u53d6\u4efb\u52a1\u5e76\u6267\u884c\u3002</p>"},{"location":"010Java/040MultiThreading/#4_3","title":"4. \u4efb\u52a1\u961f\u5217","text":"<p><code>ThreadPoolExecutor</code> \u4f7f\u7528 <code>BlockingQueue</code> \u6765\u5b58\u50a8\u4efb\u52a1\uff0c\u5e38\u89c1\u7684\u961f\u5217\u7c7b\u578b\u5305\u62ec\uff1a - \u65e0\u754c\u961f\u5217\uff08\u5982 <code>LinkedBlockingQueue</code>\uff09\uff1a\u9002\u5408\u4efb\u52a1\u6570\u91cf\u4e0d\u56fa\u5b9a\u7684\u573a\u666f\u3002 - \u6709\u754c\u961f\u5217\uff08\u5982 <code>ArrayBlockingQueue</code>\uff09\uff1a\u9002\u5408\u9700\u8981\u63a7\u5236\u4efb\u52a1\u6570\u91cf\u7684\u573a\u666f\u3002 - \u540c\u6b65\u961f\u5217\uff08\u5982 <code>SynchronousQueue</code>\uff09\uff1a\u9002\u5408\u9700\u8981\u7acb\u5373\u6267\u884c\u4efb\u52a1\u7684\u573a\u666f\u3002</p>"},{"location":"010Java/040MultiThreading/#5_3","title":"5. \u62d2\u7edd\u7b56\u7565","text":"<p>\u5f53\u7ebf\u7a0b\u6c60\u548c\u961f\u5217\u90fd\u6ee1\u65f6\uff0c\u4f1a\u89e6\u53d1\u62d2\u7edd\u7b56\u7565\u3002JDK \u63d0\u4f9b\u4e86\u56db\u79cd\u9ed8\u8ba4\u7b56\u7565\uff1a - AbortPolicy\uff1a\u76f4\u63a5\u629b\u51fa <code>RejectedExecutionException</code>\u3002 - CallerRunsPolicy\uff1a\u7531\u63d0\u4ea4\u4efb\u52a1\u7684\u7ebf\u7a0b\u76f4\u63a5\u6267\u884c\u4efb\u52a1\u3002 - DiscardPolicy\uff1a\u76f4\u63a5\u4e22\u5f03\u4efb\u52a1\uff0c\u4e0d\u629b\u5f02\u5e38\u3002 - DiscardOldestPolicy\uff1a\u4e22\u5f03\u961f\u5217\u4e2d\u6700\u65e7\u7684\u4efb\u52a1\uff0c\u7136\u540e\u91cd\u65b0\u63d0\u4ea4\u65b0\u4efb\u52a1\u3002</p> <p>\u53ef\u4ee5\u901a\u8fc7\u5b9e\u73b0 <code>RejectedExecutionHandler</code> \u63a5\u53e3\u81ea\u5b9a\u4e49\u62d2\u7edd\u7b56\u7565\u3002</p>"},{"location":"010Java/040MultiThreading/#6_3","title":"6. \u7ebf\u7a0b\u6c60\u72b6\u6001","text":"<p><code>ThreadPoolExecutor</code> \u4f7f\u7528\u4e00\u4e2a <code>AtomicInteger</code>\uff08<code>ctl</code>\uff09\u6765\u540c\u65f6\u8868\u793a\u7ebf\u7a0b\u6c60\u7684\u72b6\u6001\u548c\u7ebf\u7a0b\u6570\u91cf\uff1a - \u72b6\u6001\uff1a - <code>RUNNING</code>\uff1a\u6b63\u5e38\u8fd0\u884c\uff0c\u53ef\u4ee5\u63a5\u53d7\u65b0\u4efb\u52a1\u3002 - <code>SHUTDOWN</code>\uff1a\u4e0d\u518d\u63a5\u53d7\u65b0\u4efb\u52a1\uff0c\u4f46\u4f1a\u5904\u7406\u961f\u5217\u4e2d\u7684\u4efb\u52a1\u3002 - <code>STOP</code>\uff1a\u4e0d\u518d\u63a5\u53d7\u65b0\u4efb\u52a1\uff0c\u4e5f\u4e0d\u5904\u7406\u961f\u5217\u4e2d\u7684\u4efb\u52a1\uff0c\u5e76\u4e2d\u65ad\u6b63\u5728\u6267\u884c\u7684\u4efb\u52a1\u3002 - <code>TIDYING</code>\uff1a\u6240\u6709\u4efb\u52a1\u5df2\u7ec8\u6b62\uff0c\u7ebf\u7a0b\u6c60\u5373\u5c06\u7ec8\u6b62\u3002 - <code>TERMINATED</code>\uff1a\u7ebf\u7a0b\u6c60\u5b8c\u5168\u7ec8\u6b62\u3002</p>"},{"location":"010Java/040MultiThreading/#7_2","title":"7. \u52a8\u6001\u8c03\u6574\u53c2\u6570","text":"<p><code>ThreadPoolExecutor</code> \u652f\u6301\u52a8\u6001\u8c03\u6574\u6838\u5fc3\u7ebf\u7a0b\u6570\u3001\u6700\u5927\u7ebf\u7a0b\u6570\u548c\u7a7a\u95f2\u65f6\u95f4\uff1a - <code>setCorePoolSize(int corePoolSize)</code> - <code>setMaximumPoolSize(int maximumPoolSize)</code> - <code>setKeepAliveTime(long time, TimeUnit unit)</code></p>"},{"location":"010Java/040MultiThreading/#8_1","title":"8. \u76d1\u63a7\u548c\u7edf\u8ba1","text":"<p><code>ThreadPoolExecutor</code> \u63d0\u4f9b\u4e86\u4ee5\u4e0b\u76d1\u63a7\u65b9\u6cd5\uff1a - <code>getPoolSize()</code>\uff1a\u5f53\u524d\u7ebf\u7a0b\u6c60\u4e2d\u7684\u7ebf\u7a0b\u6570\u3002 - <code>getActiveCount()</code>\uff1a\u6b63\u5728\u6267\u884c\u4efb\u52a1\u7684\u7ebf\u7a0b\u6570\u3002 - <code>getCompletedTaskCount()</code>\uff1a\u5df2\u5b8c\u6210\u7684\u4efb\u52a1\u6570\u3002 - <code>getTaskCount()</code>\uff1a\u603b\u4efb\u52a1\u6570\uff08\u5305\u62ec\u5df2\u6267\u884c\u548c\u672a\u6267\u884c\u7684\uff09\u3002</p>"},{"location":"010Java/040MultiThreading/#9_3","title":"9. \u7ebf\u7a0b\u5de5\u5382","text":"<p>\u901a\u8fc7 <code>ThreadFactory</code> \u53ef\u4ee5\u81ea\u5b9a\u4e49\u7ebf\u7a0b\u7684\u521b\u5efa\u8fc7\u7a0b\uff0c\u4f8b\u5982\u8bbe\u7f6e\u7ebf\u7a0b\u540d\u79f0\u3001\u4f18\u5148\u7ea7\u7b49\u3002</p>"},{"location":"010Java/040MultiThreading/#10_3","title":"10. \u94a9\u5b50\u65b9\u6cd5","text":"<p><code>ThreadPoolExecutor</code> \u63d0\u4f9b\u4e86\u4ee5\u4e0b\u94a9\u5b50\u65b9\u6cd5\uff0c\u65b9\u4fbf\u6269\u5c55\uff1a - <code>beforeExecute(Thread t, Runnable r)</code>\uff1a\u4efb\u52a1\u6267\u884c\u524d\u8c03\u7528\u3002 - <code>afterExecute(Runnable r, Throwable t)</code>\uff1a\u4efb\u52a1\u6267\u884c\u540e\u8c03\u7528\u3002 - <code>terminated()</code>\uff1a\u7ebf\u7a0b\u6c60\u7ec8\u6b62\u65f6\u8c03\u7528\u3002</p>"},{"location":"010Java/040MultiThreading/#_21","title":"\u603b\u7ed3","text":"<p><code>ThreadPoolExecutor</code> \u7684\u6838\u5fc3\u7279\u6027\u5305\u62ec\uff1a 1. \u7075\u6d3b\u7684\u7ebf\u7a0b\u7ba1\u7406\uff1a\u652f\u6301\u6838\u5fc3\u7ebf\u7a0b\u3001\u975e\u6838\u5fc3\u7ebf\u7a0b\u548c\u4efb\u52a1\u961f\u5217\u7684\u52a8\u6001\u8c03\u6574\u3002 2. \u4e30\u5bcc\u7684\u4efb\u52a1\u8c03\u5ea6\u673a\u5236\uff1a\u4f18\u5148\u521b\u5efa\u6838\u5fc3\u7ebf\u7a0b\uff0c\u961f\u5217\u6ee1\u65f6\u521b\u5efa\u975e\u6838\u5fc3\u7ebf\u7a0b\uff0c\u6700\u7ec8\u89e6\u53d1\u62d2\u7edd\u7b56\u7565\u3002 3. \u53ef\u6269\u5c55\u6027\uff1a\u652f\u6301\u81ea\u5b9a\u4e49\u7ebf\u7a0b\u5de5\u5382\u3001\u62d2\u7edd\u7b56\u7565\u548c\u94a9\u5b50\u65b9\u6cd5\u3002 4. \u76d1\u63a7\u548c\u7edf\u8ba1\uff1a\u63d0\u4f9b\u7ebf\u7a0b\u6c60\u72b6\u6001\u548c\u4efb\u52a1\u6267\u884c\u7684\u76d1\u63a7\u65b9\u6cd5\u3002 5. \u9ad8\u6027\u80fd\u8bbe\u8ba1\uff1a\u901a\u8fc7 <code>Worker</code> \u7c7b\u548c <code>ctl</code> \u72b6\u6001\u673a\u5b9e\u73b0\u9ad8\u6548\u7684\u4efb\u52a1\u8c03\u5ea6\u548c\u7ebf\u7a0b\u7ba1\u7406\u3002</p> <p>\u901a\u8fc7\u6df1\u5165\u7406\u89e3 <code>ThreadPoolExecutor</code> \u7684\u6e90\u7801\uff0c\u53ef\u4ee5\u66f4\u597d\u5730\u4f7f\u7528\u548c\u6269\u5c55\u7ebf\u7a0b\u6c60\uff0c\u6ee1\u8db3\u4e0d\u540c\u573a\u666f\u7684\u9700\u6c42\u3002</p>"},{"location":"010Java/040MultiThreading/#_22","title":"\u5728\u7406\u89e3\u9ed8\u8ba4\u7ebf\u7a0b\u6c60\u7684\u524d\u63d0\u4e0b\uff0c\u81ea\u5df1\u5b9e\u73b0\u7ebf\u7a0b\u6c60","text":"\u7b54\u6848 <p>\u5b9e\u73b0\u4e00\u4e2a\u7b80\u6613\u7ebf\u7a0b\u6c60\u53ef\u4ee5\u5e2e\u52a9\u6df1\u5165\u7406\u89e3\u7ebf\u7a0b\u6c60\u7684\u5de5\u4f5c\u539f\u7406\u3002\u4ee5\u4e0b\u662f\u4e00\u4e2a\u57fa\u4e8e <code>ThreadPoolExecutor</code> \u6838\u5fc3\u601d\u60f3\u7684\u7b80\u6613\u7ebf\u7a0b\u6c60\u5b9e\u73b0\uff0c\u5305\u542b\u4efb\u52a1\u961f\u5217\u3001\u7ebf\u7a0b\u7ba1\u7406\u548c\u4efb\u52a1\u8c03\u5ea6\u529f\u80fd\u3002</p>"},{"location":"010Java/040MultiThreading/#_23","title":"\u7b80\u6613\u7ebf\u7a0b\u6c60\u5b9e\u73b0","text":"<pre><code>import java.util.ArrayList;\nimport java.util.List;\nimport java.util.concurrent.BlockingQueue;\nimport java.util.concurrent.LinkedBlockingQueue;\n\npublic class SimpleThreadPool {\n    // \u4efb\u52a1\u961f\u5217\n    private final BlockingQueue&lt;Runnable&gt; taskQueue;\n    // \u5de5\u4f5c\u7ebf\u7a0b\u5217\u8868\n    private final List&lt;WorkerThread&gt; workers;\n    // \u7ebf\u7a0b\u6c60\u662f\u5426\u5173\u95ed\n    private boolean isShutdown = false;\n\n    // \u6784\u9020\u51fd\u6570\n    public SimpleThreadPool(int poolSize) {\n        this.taskQueue = new LinkedBlockingQueue&lt;&gt;();\n        this.workers = new ArrayList&lt;&gt;();\n\n        // \u521d\u59cb\u5316\u5de5\u4f5c\u7ebf\u7a0b\n        for (int i = 0; i &lt; poolSize; i++) {\n            WorkerThread worker = new WorkerThread(\"Worker-\" + i);\n            worker.start();\n            workers.add(worker);\n        }\n    }\n\n    // \u63d0\u4ea4\u4efb\u52a1\n    public void execute(Runnable task) {\n        if (isShutdown) {\n            throw new IllegalStateException(\"ThreadPool is shutdown\");\n        }\n        taskQueue.offer(task);\n    }\n\n    // \u5173\u95ed\u7ebf\u7a0b\u6c60\n    public void shutdown() {\n        isShutdown = true;\n        for (WorkerThread worker : workers) {\n            worker.interrupt();\n        }\n    }\n\n    // \u5de5\u4f5c\u7ebf\u7a0b\n    private class WorkerThread extends Thread {\n        public WorkerThread(String name) {\n            super(name);\n        }\n\n        @Override\n        public void run() {\n            while (!isShutdown || !taskQueue.isEmpty()) {\n                try {\n                    // \u4ece\u961f\u5217\u4e2d\u83b7\u53d6\u4efb\u52a1\n                    Runnable task = taskQueue.take();\n                    task.run(); // \u6267\u884c\u4efb\u52a1\n                } catch (InterruptedException e) {\n                    // \u7ebf\u7a0b\u88ab\u4e2d\u65ad\uff0c\u9000\u51fa\u5faa\u73af\n                    break;\n                }\n            }\n        }\n    }\n\n    // \u6d4b\u8bd5\n    public static void main(String[] args) {\n        SimpleThreadPool pool = new SimpleThreadPool(3);\n\n        // \u63d0\u4ea4\u4efb\u52a1\n        for (int i = 0; i &lt; 10; i++) {\n            int taskId = i;\n            pool.execute(() -&gt; {\n                System.out.println(Thread.currentThread().getName() + \" is executing task \" + taskId);\n                try {\n                    Thread.sleep(1000); // \u6a21\u62df\u4efb\u52a1\u6267\u884c\u65f6\u95f4\n                } catch (InterruptedException e) {\n                    e.printStackTrace();\n                }\n            });\n        }\n\n        // \u5173\u95ed\u7ebf\u7a0b\u6c60\n        pool.shutdown();\n    }\n}\n</code></pre>"},{"location":"010Java/040MultiThreading/#_24","title":"\u4ee3\u7801\u89e3\u6790","text":""},{"location":"010Java/040MultiThreading/#1_4","title":"1. \u4efb\u52a1\u961f\u5217","text":"<ul> <li>\u4f7f\u7528 <code>BlockingQueue</code> \u5b58\u50a8\u4efb\u52a1\uff0c\u652f\u6301\u7ebf\u7a0b\u5b89\u5168\u7684\u5165\u961f\u548c\u51fa\u961f\u64cd\u4f5c\u3002</li> <li>\u9ed8\u8ba4\u4f7f\u7528 <code>LinkedBlockingQueue</code>\uff0c\u53ef\u4ee5\u66ff\u6362\u4e3a\u5176\u4ed6\u961f\u5217\u5b9e\u73b0\u3002</li> </ul>"},{"location":"010Java/040MultiThreading/#2_5","title":"2. \u5de5\u4f5c\u7ebf\u7a0b","text":"<ul> <li><code>WorkerThread</code> \u662f\u7ebf\u7a0b\u6c60\u4e2d\u7684\u5de5\u4f5c\u7ebf\u7a0b\uff0c\u7ee7\u627f\u81ea <code>Thread</code>\u3002</li> <li>\u6bcf\u4e2a\u5de5\u4f5c\u7ebf\u7a0b\u4e0d\u65ad\u4ece\u4efb\u52a1\u961f\u5217\u4e2d\u83b7\u53d6\u4efb\u52a1\u5e76\u6267\u884c\u3002</li> </ul>"},{"location":"010Java/040MultiThreading/#3_5","title":"3. \u7ebf\u7a0b\u6c60\u7ba1\u7406","text":"<ul> <li><code>SimpleThreadPool</code> \u8d1f\u8d23\u521d\u59cb\u5316\u5de5\u4f5c\u7ebf\u7a0b\u3001\u63d0\u4ea4\u4efb\u52a1\u548c\u5173\u95ed\u7ebf\u7a0b\u6c60\u3002</li> <li><code>execute</code> \u65b9\u6cd5\u7528\u4e8e\u63d0\u4ea4\u4efb\u52a1\uff0c\u5c06\u4efb\u52a1\u52a0\u5165\u961f\u5217\u3002</li> <li><code>shutdown</code> \u65b9\u6cd5\u7528\u4e8e\u5173\u95ed\u7ebf\u7a0b\u6c60\uff0c\u4e2d\u65ad\u6240\u6709\u5de5\u4f5c\u7ebf\u7a0b\u3002</li> </ul>"},{"location":"010Java/040MultiThreading/#4_4","title":"4. \u4efb\u52a1\u8c03\u5ea6","text":"<ul> <li>\u5de5\u4f5c\u7ebf\u7a0b\u901a\u8fc7 <code>taskQueue.take()</code> \u4ece\u961f\u5217\u4e2d\u83b7\u53d6\u4efb\u52a1\uff0c\u5982\u679c\u961f\u5217\u4e3a\u7a7a\uff0c\u7ebf\u7a0b\u4f1a\u963b\u585e\u7b49\u5f85\u3002</li> <li>\u5f53\u7ebf\u7a0b\u6c60\u5173\u95ed\u65f6\uff0c\u5de5\u4f5c\u7ebf\u7a0b\u4f1a\u68c0\u67e5\u961f\u5217\u662f\u5426\u4e3a\u7a7a\uff0c\u786e\u4fdd\u6240\u6709\u4efb\u52a1\u6267\u884c\u5b8c\u6bd5\u3002</li> </ul>"},{"location":"010Java/040MultiThreading/#_25","title":"\u6d4b\u8bd5\u8fd0\u884c","text":"<p>\u8fd0\u884c <code>main</code> \u65b9\u6cd5\uff0c\u8f93\u51fa\u5982\u4e0b\uff1a <pre><code>Worker-0 is executing task 0\nWorker-1 is executing task 1\nWorker-2 is executing task 2\nWorker-0 is executing task 3\nWorker-1 is executing task 4\nWorker-2 is executing task 5\nWorker-0 is executing task 6\nWorker-1 is executing task 7\nWorker-2 is executing task 8\nWorker-0 is executing task 9\n</code></pre></p>"},{"location":"010Java/040MultiThreading/#_26","title":"\u529f\u80fd\u6269\u5c55","text":"<ol> <li>\u652f\u6301\u52a8\u6001\u8c03\u6574\u7ebf\u7a0b\u6570\uff1a</li> <li> <p>\u589e\u52a0 <code>resizePool</code> \u65b9\u6cd5\uff0c\u52a8\u6001\u8c03\u6574\u5de5\u4f5c\u7ebf\u7a0b\u6570\u91cf\u3002</p> </li> <li> <p>\u652f\u6301\u62d2\u7edd\u7b56\u7565\uff1a</p> </li> <li> <p>\u5f53\u4efb\u52a1\u961f\u5217\u6ee1\u65f6\uff0c\u53ef\u4ee5\u6dfb\u52a0\u62d2\u7edd\u7b56\u7565\uff08\u5982\u4e22\u5f03\u4efb\u52a1\u6216\u629b\u51fa\u5f02\u5e38\uff09\u3002</p> </li> <li> <p>\u652f\u6301\u4efb\u52a1\u8fd4\u56de\u503c\uff1a</p> </li> <li> <p>\u4f7f\u7528 <code>Callable</code> \u548c <code>Future</code> \u5b9e\u73b0\u5e26\u8fd4\u56de\u503c\u7684\u4efb\u52a1\u3002</p> </li> <li> <p>\u652f\u6301\u7ebf\u7a0b\u6c60\u76d1\u63a7\uff1a</p> </li> <li>\u6dfb\u52a0\u65b9\u6cd5\u7edf\u8ba1\u4efb\u52a1\u6570\u91cf\u3001\u6d3b\u8dc3\u7ebf\u7a0b\u6570\u7b49\u3002</li> </ol>"},{"location":"010Java/040MultiThreading/#_27","title":"\u603b\u7ed3","text":"<p>\u8fd9\u4e2a\u7b80\u6613\u7ebf\u7a0b\u6c60\u5b9e\u73b0\u4e86\u7ebf\u7a0b\u6c60\u7684\u6838\u5fc3\u529f\u80fd\uff0c\u5305\u62ec\u4efb\u52a1\u961f\u5217\u3001\u5de5\u4f5c\u7ebf\u7a0b\u7ba1\u7406\u548c\u4efb\u52a1\u8c03\u5ea6\u3002\u901a\u8fc7\u8fd9\u4e2a\u5b9e\u73b0\uff0c\u53ef\u4ee5\u66f4\u597d\u5730\u7406\u89e3 <code>ThreadPoolExecutor</code> \u7684\u5de5\u4f5c\u539f\u7406\uff0c\u5e76\u4e3a\u8fdb\u4e00\u6b65\u6269\u5c55\u548c\u4f18\u5316\u7ebf\u7a0b\u6c60\u6253\u4e0b\u57fa\u7840\u3002</p>"},{"location":"010Java/040MultiThreading/#java_4","title":"Java\u8bbe\u8ba1\u4e00\u4e2a\u751f\u4ea7\u8005\uff0c\u6d88\u8d39\u8005\u6a21\u578b","text":"\u7b54\u6848"},{"location":"010Java/040MultiThreading/#1-queue","title":"\u6848\u4f8b1 \u5e26Queue","text":"<p>\u751f\u4ea7\u8005-\u6d88\u8d39\u8005\u6a21\u578b\u662f\u4e00\u4e2a\u7ecf\u5178\u7684\u591a\u7ebf\u7a0b\u540c\u6b65\u95ee\u9898\uff0c\u5176\u4e2d\u751f\u4ea7\u8005\u7ebf\u7a0b\u751f\u6210\u6570\u636e\u5e76\u5c06\u5176\u653e\u5165\u5171\u4eab\u7f13\u51b2\u533a\uff0c\u800c\u6d88\u8d39\u8005\u7ebf\u7a0b\u4ece\u7f13\u51b2\u533a\u4e2d\u53d6\u51fa\u6570\u636e\u5e76\u8fdb\u884c\u5904\u7406\u3002\u4e3a\u4e86\u5b9e\u73b0\u8fd9\u4e2a\u6a21\u578b\uff0c\u6211\u4eec\u9700\u8981\u786e\u4fdd\u751f\u4ea7\u8005\u548c\u6d88\u8d39\u8005\u4e4b\u95f4\u7684\u540c\u6b65\uff0c\u4ee5\u907f\u514d\u7f13\u51b2\u533a\u6ea2\u51fa\u6216\u4e0b\u6ea2\u3002</p> <p>\u5728Java\u4e2d\uff0c\u53ef\u4ee5\u4f7f\u7528<code>wait()</code>\u548c<code>notify()</code>\u65b9\u6cd5\u6765\u5b9e\u73b0\u751f\u4ea7\u8005\u548c\u6d88\u8d39\u8005\u4e4b\u95f4\u7684\u540c\u6b65\u3002\u4e0b\u9762\u662f\u4e00\u4e2a\u7b80\u5355\u7684\u751f\u4ea7\u8005-\u6d88\u8d39\u8005\u6a21\u578b\u7684\u5b9e\u73b0\uff1a</p> <pre><code>import java.util.LinkedList;\nimport java.util.Queue;\n\npublic class ProducerConsumer {\n    private static final int BUFFER_SIZE = 10;\n    private final Queue&lt;Integer&gt; buffer = new LinkedList&lt;&gt;();\n    private final Object lock = new Object();\n\n    public static void main(String[] args) {\n        ProducerConsumer pc = new ProducerConsumer();\n        Thread producerThread = new Thread(pc.new Producer());\n        Thread consumerThread = new Thread(pc.new Consumer());\n\n        producerThread.start();\n        consumerThread.start();\n    }\n\n    class Producer implements Runnable {\n        @Override\n        public void run() {\n            int value = 0;\n            while (true) {\n                synchronized (lock) {\n                    while (buffer.size() == BUFFER_SIZE) {\n                        try {\n                            lock.wait(); // \u7f13\u51b2\u533a\u6ee1\uff0c\u7b49\u5f85\n                        } catch (InterruptedException e) {\n                            e.printStackTrace();\n                        }\n                    }\n                    buffer.add(value);\n                    System.out.println(\"Produced: \" + value);\n                    value++;\n                    lock.notifyAll(); // \u901a\u77e5\u6d88\u8d39\u8005\n                }\n\n                try {\n                    Thread.sleep(100); // \u6a21\u62df\u751f\u4ea7\u65f6\u95f4\n                } catch (InterruptedException e) {\n                    e.printStackTrace();\n                }\n            }\n        }\n    }\n\n    class Consumer implements Runnable {\n        @Override\n        public void run() {\n            while (true) {\n                synchronized (lock) {\n                    while (buffer.isEmpty()) {\n                        try {\n                            lock.wait(); // \u7f13\u51b2\u533a\u7a7a\uff0c\u7b49\u5f85\n                        } catch (InterruptedException e) {\n                            e.printStackTrace();\n                        }\n                    }\n                    int value = buffer.poll();\n                    System.out.println(\"Consumed: \" + value);\n                    lock.notifyAll(); // \u901a\u77e5\u751f\u4ea7\u8005\n                }\n\n                try {\n                    Thread.sleep(100); // \u6a21\u62df\u6d88\u8d39\u65f6\u95f4\n                } catch (InterruptedException e) {\n                    e.printStackTrace();\n                }\n            }\n        }\n    }\n}\n</code></pre>"},{"location":"010Java/040MultiThreading/#_28","title":"\u4ee3\u7801\u8bf4\u660e\uff1a","text":"<ol> <li>\u7f13\u51b2\u533a\uff1a\u4f7f\u7528<code>Queue&lt;Integer&gt;</code>\u4f5c\u4e3a\u7f13\u51b2\u533a\uff0c<code>LinkedList</code>\u5b9e\u73b0\u4e86<code>Queue</code>\u63a5\u53e3\u3002</li> <li>\u9501\u5bf9\u8c61\uff1a\u4f7f\u7528<code>Object</code>\u7c7b\u578b\u7684<code>lock</code>\u4f5c\u4e3a\u540c\u6b65\u9501\u3002</li> <li>\u751f\u4ea7\u8005\uff1a</li> <li>\u751f\u4ea7\u8005\u7ebf\u7a0b\u4e0d\u65ad\u751f\u6210\u6570\u636e\u5e76\u5c06\u5176\u653e\u5165\u7f13\u51b2\u533a\u3002</li> <li>\u5982\u679c\u7f13\u51b2\u533a\u5df2\u6ee1\uff0c\u751f\u4ea7\u8005\u7ebf\u7a0b\u4f1a\u8c03\u7528<code>lock.wait()</code>\u8fdb\u5165\u7b49\u5f85\u72b6\u6001\uff0c\u76f4\u5230\u6d88\u8d39\u8005\u7ebf\u7a0b\u901a\u77e5\u5b83\u3002</li> <li>\u751f\u4ea7\u8005\u7ebf\u7a0b\u5728\u653e\u5165\u6570\u636e\u540e\uff0c\u8c03\u7528<code>lock.notifyAll()</code>\u901a\u77e5\u6d88\u8d39\u8005\u7ebf\u7a0b\u3002</li> <li>\u6d88\u8d39\u8005\uff1a</li> <li>\u6d88\u8d39\u8005\u7ebf\u7a0b\u4e0d\u65ad\u4ece\u7f13\u51b2\u533a\u4e2d\u53d6\u51fa\u6570\u636e\u3002</li> <li>\u5982\u679c\u7f13\u51b2\u533a\u4e3a\u7a7a\uff0c\u6d88\u8d39\u8005\u7ebf\u7a0b\u4f1a\u8c03\u7528<code>lock.wait()</code>\u8fdb\u5165\u7b49\u5f85\u72b6\u6001\uff0c\u76f4\u5230\u751f\u4ea7\u8005\u7ebf\u7a0b\u901a\u77e5\u5b83\u3002</li> <li>\u6d88\u8d39\u8005\u7ebf\u7a0b\u5728\u53d6\u51fa\u6570\u636e\u540e\uff0c\u8c03\u7528<code>lock.notifyAll()</code>\u901a\u77e5\u751f\u4ea7\u8005\u7ebf\u7a0b\u3002</li> </ol>"},{"location":"010Java/040MultiThreading/#_29","title":"\u6ce8\u610f\u4e8b\u9879\uff1a","text":"<ul> <li><code>wait()</code>\u548c<code>notifyAll()</code>\u5fc5\u987b\u5728\u540c\u6b65\u5757\u6216\u540c\u6b65\u65b9\u6cd5\u4e2d\u8c03\u7528\u3002</li> <li><code>wait()</code>\u4f1a\u91ca\u653e\u9501\uff0c\u800c<code>notifyAll()</code>\u4f1a\u5524\u9192\u6240\u6709\u7b49\u5f85\u8be5\u9501\u7684\u7ebf\u7a0b\u3002</li> <li>\u4f7f\u7528<code>while</code>\u5faa\u73af\u68c0\u67e5\u6761\u4ef6\uff0c\u800c\u4e0d\u662f<code>if</code>\uff0c\u4ee5\u9632\u6b62\u865a\u5047\u5524\u9192\u3002</li> </ul>"},{"location":"010Java/040MultiThreading/#_30","title":"\u8fd0\u884c\u7ed3\u679c\uff1a","text":"<p>\u8fd0\u884c\u8be5\u7a0b\u5e8f\u540e\uff0c\u4f60\u4f1a\u770b\u5230\u751f\u4ea7\u8005\u548c\u6d88\u8d39\u8005\u4ea4\u66ff\u8f93\u51fa\u751f\u4ea7\u548c\u6d88\u8d39\u7684\u6570\u636e\uff0c\u786e\u4fdd\u7f13\u51b2\u533a\u4e0d\u4f1a\u6ea2\u51fa\u6216\u4e0b\u6ea2\u3002</p> <p>\u8fd9\u4e2a\u6a21\u578b\u53ef\u4ee5\u8fdb\u4e00\u6b65\u6269\u5c55\uff0c\u4f8b\u5982\u4f7f\u7528<code>BlockingQueue</code>\u6765\u7b80\u5316\u540c\u6b65\u64cd\u4f5c\uff0c\u6216\u8005\u589e\u52a0\u591a\u4e2a\u751f\u4ea7\u8005\u548c\u6d88\u8d39\u8005\u7ebf\u7a0b\u3002</p>"},{"location":"010Java/040MultiThreading/#2-queue","title":"\u6848\u4f8b2 \u4e0d\u5e26Queue","text":"<p>\u5982\u679c\u53bb\u6389<code>Queue</code>\uff08\u5373\u6ca1\u6709\u7f13\u51b2\u533a\uff09\uff0c\u751f\u4ea7\u8005\u548c\u6d88\u8d39\u8005\u4e4b\u95f4\u5c06\u76f4\u63a5\u8fdb\u884c\u6570\u636e\u4f20\u9012\uff0c\u8fd9\u79cd\u60c5\u51b5\u4e0b\u4ecd\u7136\u53ef\u4ee5\u4fdd\u8bc1\u7ebf\u7a0b\u5b89\u5168\uff0c\u4f46\u5b9e\u73b0\u65b9\u5f0f\u4f1a\u6709\u6240\u4e0d\u540c\u3002\u7531\u4e8e\u6ca1\u6709\u7f13\u51b2\u533a\uff0c\u751f\u4ea7\u8005\u548c\u6d88\u8d39\u8005\u5fc5\u987b\u4e25\u683c\u540c\u6b65\uff0c\u786e\u4fdd\u751f\u4ea7\u8005\u751f\u4ea7\u4e00\u4e2a\u6570\u636e\u540e\uff0c\u6d88\u8d39\u8005\u7acb\u5373\u6d88\u8d39\u5b83\uff0c\u7136\u540e\u518d\u751f\u4ea7\u4e0b\u4e00\u4e2a\u6570\u636e\u3002</p> <p>\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u53ef\u4ee5\u4f7f\u7528\u4fe1\u53f7\u91cf\u6216\u6761\u4ef6\u53d8\u91cf\u6765\u5b9e\u73b0\u751f\u4ea7\u8005\u548c\u6d88\u8d39\u8005\u4e4b\u95f4\u7684\u540c\u6b65\u3002\u4e0b\u9762\u662f\u4e00\u4e2a\u4f7f\u7528<code>Object</code>\u7684<code>wait()</code>\u548c<code>notify()</code>\u65b9\u6cd5\u5b9e\u73b0\u7684\u65e0\u7f13\u51b2\u533a\u751f\u4ea7\u8005-\u6d88\u8d39\u8005\u6a21\u578b\uff1a</p>"},{"location":"010Java/040MultiThreading/#_31","title":"\u4ee3\u7801\u5b9e\u73b0","text":"<pre><code>public class ProducerConsumerWithoutBuffer {\n    private Integer value = null; // \u7528\u4e8e\u76f4\u63a5\u4f20\u9012\u6570\u636e\u7684\u53d8\u91cf\n    private final Object lock = new Object(); // \u9501\u5bf9\u8c61\n\n    public static void main(String[] args) {\n        ProducerConsumerWithoutBuffer pc = new ProducerConsumerWithoutBuffer();\n        Thread producerThread = new Thread(pc.new Producer());\n        Thread consumerThread = new Thread(pc.new Consumer());\n\n        producerThread.start();\n        consumerThread.start();\n    }\n\n    class Producer implements Runnable {\n        @Override\n        public void run() {\n            int producedValue = 0;\n            while (true) {\n                synchronized (lock) {\n                    // \u5982\u679cvalue\u4e0d\u4e3anull\uff0c\u8bf4\u660e\u4e0a\u4e00\u4e2a\u503c\u8fd8\u672a\u88ab\u6d88\u8d39\uff0c\u7b49\u5f85\n                    while (value != null) {\n                        try {\n                            lock.wait(); // \u7b49\u5f85\u6d88\u8d39\u8005\u6d88\u8d39\n                        } catch (InterruptedException e) {\n                            e.printStackTrace();\n                        }\n                    }\n                    // \u751f\u4ea7\u6570\u636e\n                    value = producedValue;\n                    System.out.println(\"Produced: \" + value);\n                    producedValue++;\n                    lock.notifyAll(); // \u901a\u77e5\u6d88\u8d39\u8005\n                }\n\n                try {\n                    Thread.sleep(100); // \u6a21\u62df\u751f\u4ea7\u65f6\u95f4\n                } catch (InterruptedException e) {\n                    e.printStackTrace();\n                }\n            }\n        }\n    }\n\n    class Consumer implements Runnable {\n        @Override\n        public void run() {\n            while (true) {\n                synchronized (lock) {\n                    // \u5982\u679cvalue\u4e3anull\uff0c\u8bf4\u660e\u6ca1\u6709\u6570\u636e\u53ef\u6d88\u8d39\uff0c\u7b49\u5f85\n                    while (value == null) {\n                        try {\n                            lock.wait(); // \u7b49\u5f85\u751f\u4ea7\u8005\u751f\u4ea7\n                        } catch (InterruptedException e) {\n                            e.printStackTrace();\n                        }\n                    }\n                    // \u6d88\u8d39\u6570\u636e\n                    System.out.println(\"Consumed: \" + value);\n                    value = null; // \u6e05\u7a7a\u6570\u636e\n                    lock.notifyAll(); // \u901a\u77e5\u751f\u4ea7\u8005\n                }\n\n                try {\n                    Thread.sleep(100); // \u6a21\u62df\u6d88\u8d39\u65f6\u95f4\n                } catch (InterruptedException e) {\n                    e.printStackTrace();\n                }\n            }\n        }\n    }\n}\n</code></pre>"},{"location":"010Java/040MultiThreading/#_32","title":"\u4ee3\u7801\u8bf4\u660e","text":"<ol> <li>\u6570\u636e\u4f20\u9012\uff1a</li> <li>\u4f7f\u7528\u4e00\u4e2a<code>Integer</code>\u7c7b\u578b\u7684\u53d8\u91cf<code>value</code>\u6765\u76f4\u63a5\u4f20\u9012\u6570\u636e\u3002</li> <li> <p>\u751f\u4ea7\u8005\u5c06\u6570\u636e\u5199\u5165<code>value</code>\uff0c\u6d88\u8d39\u8005\u4ece<code>value</code>\u4e2d\u8bfb\u53d6\u6570\u636e\u3002</p> </li> <li> <p>\u540c\u6b65\u673a\u5236\uff1a</p> </li> <li>\u751f\u4ea7\u8005\u68c0\u67e5<code>value</code>\u662f\u5426\u4e3a<code>null</code>\uff1a<ul> <li>\u5982\u679c<code>value</code>\u4e0d\u4e3a<code>null</code>\uff0c\u8bf4\u660e\u4e0a\u4e00\u4e2a\u6570\u636e\u8fd8\u672a\u88ab\u6d88\u8d39\uff0c\u751f\u4ea7\u8005\u8c03\u7528<code>lock.wait()</code>\u8fdb\u5165\u7b49\u5f85\u72b6\u6001\u3002</li> <li>\u5982\u679c<code>value</code>\u4e3a<code>null</code>\uff0c\u751f\u4ea7\u8005\u5c06\u6570\u636e\u5199\u5165<code>value</code>\u5e76\u8c03\u7528<code>lock.notifyAll()</code>\u901a\u77e5\u6d88\u8d39\u8005\u3002</li> </ul> </li> <li> <p>\u6d88\u8d39\u8005\u68c0\u67e5<code>value</code>\u662f\u5426\u4e3a<code>null</code>\uff1a</p> <ul> <li>\u5982\u679c<code>value</code>\u4e3a<code>null</code>\uff0c\u8bf4\u660e\u6ca1\u6709\u6570\u636e\u53ef\u6d88\u8d39\uff0c\u6d88\u8d39\u8005\u8c03\u7528<code>lock.wait()</code>\u8fdb\u5165\u7b49\u5f85\u72b6\u6001\u3002</li> <li>\u5982\u679c<code>value</code>\u4e0d\u4e3a<code>null</code>\uff0c\u6d88\u8d39\u8005\u8bfb\u53d6\u6570\u636e\u5e76\u5c06<code>value</code>\u7f6e\u4e3a<code>null</code>\uff0c\u7136\u540e\u8c03\u7528<code>lock.notifyAll()</code>\u901a\u77e5\u751f\u4ea7\u8005\u3002</li> </ul> </li> <li> <p>\u7ebf\u7a0b\u5b89\u5168\uff1a</p> </li> <li>\u901a\u8fc7<code>synchronized</code>\u5173\u952e\u5b57\u548c<code>wait()</code>/<code>notifyAll()</code>\u65b9\u6cd5\uff0c\u786e\u4fdd\u751f\u4ea7\u8005\u548c\u6d88\u8d39\u8005\u4e4b\u95f4\u7684\u540c\u6b65\u3002</li> <li>\u4efb\u4f55\u65f6\u5019\u53ea\u6709\u4e00\u4e2a\u7ebf\u7a0b\uff08\u751f\u4ea7\u8005\u6216\u6d88\u8d39\u8005\uff09\u53ef\u4ee5\u8bbf\u95ee<code>value</code>\uff0c\u907f\u514d\u4e86\u7ade\u4e89\u6761\u4ef6\u3002</li> </ol>"},{"location":"010Java/040MultiThreading/#_33","title":"\u8fd0\u884c\u7ed3\u679c","text":"<p>\u8fd0\u884c\u8be5\u7a0b\u5e8f\u540e\uff0c\u4f60\u4f1a\u770b\u5230\u751f\u4ea7\u8005\u548c\u6d88\u8d39\u8005\u4ea4\u66ff\u8f93\u51fa\u751f\u4ea7\u548c\u6d88\u8d39\u7684\u6570\u636e\uff0c\u4f8b\u5982\uff1a</p> <pre><code>Produced: 0\nConsumed: 0\nProduced: 1\nConsumed: 1\nProduced: 2\nConsumed: 2\n...\n</code></pre>"},{"location":"010Java/040MultiThreading/#_34","title":"\u6ce8\u610f\u4e8b\u9879","text":"<ol> <li>\u65e0\u7f13\u51b2\u533a\u7684\u9650\u5236\uff1a</li> <li>\u7531\u4e8e\u6ca1\u6709\u7f13\u51b2\u533a\uff0c\u751f\u4ea7\u8005\u548c\u6d88\u8d39\u8005\u5fc5\u987b\u4e25\u683c\u4ea4\u66ff\u6267\u884c\u3002</li> <li> <p>\u5982\u679c\u751f\u4ea7\u8005\u751f\u4ea7\u901f\u5ea6\u8fc7\u5feb\uff0c\u6d88\u8d39\u8005\u6765\u4e0d\u53ca\u6d88\u8d39\uff0c\u751f\u4ea7\u8005\u4f1a\u88ab\u963b\u585e\uff1b\u53cd\u4e4b\u4ea6\u7136\u3002</p> </li> <li> <p>\u6027\u80fd\u95ee\u9898\uff1a</p> </li> <li>\u8fd9\u79cd\u5b9e\u73b0\u65b9\u5f0f\u6548\u7387\u8f83\u4f4e\uff0c\u56e0\u4e3a\u751f\u4ea7\u8005\u548c\u6d88\u8d39\u8005\u5fc5\u987b\u9891\u7e41\u5730\u7b49\u5f85\u548c\u5524\u9192\u3002</li> <li> <p>\u5982\u679c\u9700\u8981\u66f4\u9ad8\u7684\u6027\u80fd\uff0c\u5efa\u8bae\u4f7f\u7528\u7f13\u51b2\u533a\uff08\u5982<code>Queue</code>\uff09\u6765\u89e3\u8026\u751f\u4ea7\u8005\u548c\u6d88\u8d39\u8005\u3002</p> </li> <li> <p>\u6269\u5c55\u6027\uff1a</p> </li> <li>\u8fd9\u79cd\u6a21\u578b\u9002\u7528\u4e8e\u5355\u751f\u4ea7\u8005\u548c\u5355\u6d88\u8d39\u8005\u7684\u573a\u666f\u3002</li> <li>\u5982\u679c\u9700\u8981\u652f\u6301\u591a\u751f\u4ea7\u8005\u6216\u591a\u6d88\u8d39\u8005\uff0c\u5efa\u8bae\u4f7f\u7528\u7f13\u51b2\u533a\uff08\u5982<code>BlockingQueue</code>\uff09\u3002</li> </ol>"},{"location":"010Java/040MultiThreading/#_35","title":"\u603b\u7ed3","text":"<p>\u53bb\u6389<code>Queue</code>\u540e\uff0c\u4ecd\u7136\u53ef\u4ee5\u901a\u8fc7<code>wait()</code>\u548c<code>notify()</code>\u65b9\u6cd5\u5b9e\u73b0\u7ebf\u7a0b\u5b89\u5168\u7684\u751f\u4ea7\u8005-\u6d88\u8d39\u8005\u6a21\u578b\u3002\u4f46\u8fd9\u79cd\u65b9\u5f0f\u9650\u5236\u4e86\u751f\u4ea7\u8005\u548c\u6d88\u8d39\u8005\u7684\u5e76\u53d1\u6027\uff0c\u9002\u7528\u4e8e\u7b80\u5355\u7684\u573a\u666f\u3002\u5982\u679c\u9700\u8981\u66f4\u9ad8\u7684\u5e76\u53d1\u6027\u548c\u6269\u5c55\u6027\uff0c\u5efa\u8bae\u4f7f\u7528\u7f13\u51b2\u533a\uff08\u5982<code>Queue</code>\u6216<code>BlockingQueue</code>\uff09\u3002</p>"},{"location":"010Java/040MultiThreading/#3-blockingqueue","title":"\u6848\u4f8b3  BlockingQueue","text":"<p>\u4f7f\u7528<code>BlockingQueue</code>\u5b9e\u73b0\u751f\u4ea7\u8005-\u6d88\u8d39\u8005\u6a21\u578b\u662f\u6700\u7b80\u5355\u4e14\u9ad8\u6548\u7684\u65b9\u5f0f\u4e4b\u4e00\u3002<code>BlockingQueue</code>\u662fJava\u5e76\u53d1\u5305\uff08<code>java.util.concurrent</code>\uff09\u4e2d\u7684\u4e00\u4e2a\u7ebf\u7a0b\u5b89\u5168\u7684\u961f\u5217\u5b9e\u73b0\uff0c\u5b83\u5185\u90e8\u5df2\u7ecf\u5904\u7406\u597d\u4e86\u7ebf\u7a0b\u540c\u6b65\u95ee\u9898\uff0c\u751f\u4ea7\u8005\u53ef\u4ee5\u76f4\u63a5\u8c03\u7528<code>put()</code>\u65b9\u6cd5\u653e\u5165\u6570\u636e\uff0c\u6d88\u8d39\u8005\u53ef\u4ee5\u76f4\u63a5\u8c03\u7528<code>take()</code>\u65b9\u6cd5\u53d6\u51fa\u6570\u636e\u3002\u5982\u679c\u961f\u5217\u6ee1\u4e86\uff0c<code>put()</code>\u65b9\u6cd5\u4f1a\u81ea\u52a8\u963b\u585e\uff1b\u5982\u679c\u961f\u5217\u4e3a\u7a7a\uff0c<code>take()</code>\u65b9\u6cd5\u4f1a\u81ea\u52a8\u963b\u585e\u3002</p> <p>\u4e0b\u9762\u662f\u4e00\u4e2a\u4f7f\u7528<code>BlockingQueue</code>\u5b9e\u73b0\u7684\u751f\u4ea7\u8005-\u6d88\u8d39\u8005\u6a21\u578b\u7684\u793a\u4f8b\u4ee3\u7801\uff1a</p>"},{"location":"010Java/040MultiThreading/#_36","title":"\u4ee3\u7801\u5b9e\u73b0","text":"<pre><code>import java.util.concurrent.BlockingQueue;\nimport java.util.concurrent.LinkedBlockingQueue;\n\npublic class ProducerConsumerWithBlockingQueue {\n    private static final int QUEUE_CAPACITY = 10; // \u961f\u5217\u5bb9\u91cf\n    private final BlockingQueue&lt;Integer&gt; queue = new LinkedBlockingQueue&lt;&gt;(QUEUE_CAPACITY);\n\n    public static void main(String[] args) {\n        ProducerConsumerWithBlockingQueue pc = new ProducerConsumerWithBlockingQueue();\n        Thread producerThread = new Thread(pc.new Producer());\n        Thread consumerThread = new Thread(pc.new Consumer());\n\n        producerThread.start();\n        consumerThread.start();\n    }\n\n    class Producer implements Runnable {\n        @Override\n        public void run() {\n            int value = 0;\n            while (true) {\n                try {\n                    queue.put(value); // \u5c06\u6570\u636e\u653e\u5165\u961f\u5217\uff08\u5982\u679c\u961f\u5217\u6ee1\uff0c\u5219\u963b\u585e\uff09\n                    System.out.println(\"Produced: \" + value);\n                    value++;\n                } catch (InterruptedException e) {\n                    e.printStackTrace();\n                }\n\n                try {\n                    Thread.sleep(100); // \u6a21\u62df\u751f\u4ea7\u65f6\u95f4\n                } catch (InterruptedException e) {\n                    e.printStackTrace();\n                }\n            }\n        }\n    }\n\n    class Consumer implements Runnable {\n        @Override\n        public void run() {\n            while (true) {\n                try {\n                    int value = queue.take(); // \u4ece\u961f\u5217\u4e2d\u53d6\u51fa\u6570\u636e\uff08\u5982\u679c\u961f\u5217\u7a7a\uff0c\u5219\u963b\u585e\uff09\n                    System.out.println(\"Consumed: \" + value);\n                } catch (InterruptedException e) {\n                    e.printStackTrace();\n                }\n\n                try {\n                    Thread.sleep(100); // \u6a21\u62df\u6d88\u8d39\u65f6\u95f4\n                } catch (InterruptedException e) {\n                    e.printStackTrace();\n                }\n            }\n        }\n    }\n}\n</code></pre>"},{"location":"010Java/040MultiThreading/#_37","title":"\u4ee3\u7801\u8bf4\u660e","text":"<ol> <li><code>BlockingQueue</code>\u7684\u4f7f\u7528\uff1a</li> <li><code>BlockingQueue</code>\u662f\u4e00\u4e2a\u7ebf\u7a0b\u5b89\u5168\u7684\u961f\u5217\uff0c\u652f\u6301\u963b\u585e\u64cd\u4f5c\u3002</li> <li>\u751f\u4ea7\u8005\u8c03\u7528<code>put()</code>\u65b9\u6cd5\u5c06\u6570\u636e\u653e\u5165\u961f\u5217\u3002\u5982\u679c\u961f\u5217\u5df2\u6ee1\uff0c<code>put()</code>\u65b9\u6cd5\u4f1a\u963b\u585e\uff0c\u76f4\u5230\u961f\u5217\u6709\u7a7a\u95f2\u7a7a\u95f4\u3002</li> <li> <p>\u6d88\u8d39\u8005\u8c03\u7528<code>take()</code>\u65b9\u6cd5\u4ece\u961f\u5217\u4e2d\u53d6\u51fa\u6570\u636e\u3002\u5982\u679c\u961f\u5217\u4e3a\u7a7a\uff0c<code>take()</code>\u65b9\u6cd5\u4f1a\u963b\u585e\uff0c\u76f4\u5230\u961f\u5217\u4e2d\u6709\u6570\u636e\u3002</p> </li> <li> <p>\u961f\u5217\u5bb9\u91cf\uff1a</p> </li> <li>\u4f7f\u7528<code>LinkedBlockingQueue</code>\u521b\u5efa\u4e86\u4e00\u4e2a\u5bb9\u91cf\u4e3a<code>QUEUE_CAPACITY</code>\uff08\u8fd9\u91cc\u662f10\uff09\u7684\u961f\u5217\u3002</li> <li> <p>\u961f\u5217\u5bb9\u91cf\u53ef\u4ee5\u6839\u636e\u5b9e\u9645\u9700\u6c42\u8c03\u6574\u3002</p> </li> <li> <p>\u751f\u4ea7\u8005\u548c\u6d88\u8d39\u8005\u903b\u8f91\uff1a</p> </li> <li>\u751f\u4ea7\u8005\u4e0d\u65ad\u751f\u6210\u6570\u636e\u5e76\u653e\u5165\u961f\u5217\u3002</li> <li>\u6d88\u8d39\u8005\u4e0d\u65ad\u4ece\u961f\u5217\u4e2d\u53d6\u51fa\u6570\u636e\u5e76\u5904\u7406\u3002</li> <li> <p>\u751f\u4ea7\u548c\u6d88\u8d39\u7684\u901f\u5ea6\u53ef\u4ee5\u901a\u8fc7<code>Thread.sleep()</code>\u6a21\u62df\u3002</p> </li> <li> <p>\u7ebf\u7a0b\u5b89\u5168\uff1a</p> </li> <li><code>BlockingQueue</code>\u5185\u90e8\u5df2\u7ecf\u5b9e\u73b0\u4e86\u7ebf\u7a0b\u540c\u6b65\uff0c\u65e0\u9700\u624b\u52a8\u52a0\u9501\u6216\u4f7f\u7528<code>wait()</code>/<code>notify()</code>\u3002</li> </ol>"},{"location":"010Java/040MultiThreading/#_38","title":"\u8fd0\u884c\u7ed3\u679c","text":"<p>\u8fd0\u884c\u8be5\u7a0b\u5e8f\u540e\uff0c\u4f60\u4f1a\u770b\u5230\u751f\u4ea7\u8005\u548c\u6d88\u8d39\u8005\u4ea4\u66ff\u8f93\u51fa\u751f\u4ea7\u548c\u6d88\u8d39\u7684\u6570\u636e\uff0c\u4f8b\u5982\uff1a</p> <pre><code>Produced: 0\nConsumed: 0\nProduced: 1\nConsumed: 1\nProduced: 2\nConsumed: 2\n...\n</code></pre>"},{"location":"010Java/040MultiThreading/#_39","title":"\u4f18\u70b9","text":"<ol> <li>\u7b80\u5316\u4ee3\u7801\uff1a</li> <li> <p>\u65e0\u9700\u624b\u52a8\u5b9e\u73b0\u7ebf\u7a0b\u540c\u6b65\u903b\u8f91\uff0c<code>BlockingQueue</code>\u5df2\u7ecf\u5c01\u88c5\u597d\u4e86\u6240\u6709\u7ec6\u8282\u3002</p> </li> <li> <p>\u9ad8\u6548\u5e76\u53d1\uff1a</p> </li> <li> <p><code>BlockingQueue</code>\u5185\u90e8\u4f7f\u7528\u4e86\u9ad8\u6548\u7684\u9501\u673a\u5236\uff0c\u652f\u6301\u9ad8\u5e76\u53d1\u573a\u666f\u3002</p> </li> <li> <p>\u7075\u6d3b\u6027\uff1a</p> </li> <li>\u53ef\u4ee5\u901a\u8fc7\u8c03\u6574\u961f\u5217\u5bb9\u91cf\u6765\u63a7\u5236\u751f\u4ea7\u8005\u548c\u6d88\u8d39\u8005\u7684\u884c\u4e3a\u3002</li> <li>\u652f\u6301\u591a\u751f\u4ea7\u8005\u548c\u591a\u6d88\u8d39\u8005\u573a\u666f\u3002</li> </ol>"},{"location":"010Java/040MultiThreading/#_40","title":"\u6269\u5c55\uff1a\u591a\u751f\u4ea7\u8005\u548c\u591a\u6d88\u8d39\u8005","text":"<p>\u5982\u679c\u9700\u8981\u652f\u6301\u591a\u751f\u4ea7\u8005\u548c\u591a\u6d88\u8d39\u8005\uff0c\u53ea\u9700\u521b\u5efa\u591a\u4e2a\u751f\u4ea7\u8005\u548c\u6d88\u8d39\u8005\u7ebf\u7a0b\u5373\u53ef\u3002\u4f8b\u5982\uff1a</p> <pre><code>public class ProducerConsumerWithBlockingQueue {\n    private static final int QUEUE_CAPACITY = 10;\n    private final BlockingQueue&lt;Integer&gt; queue = new LinkedBlockingQueue&lt;&gt;(QUEUE_CAPACITY);\n\n    public static void main(String[] args) {\n        ProducerConsumerWithBlockingQueue pc = new ProducerConsumerWithBlockingQueue();\n        Thread producerThread1 = new Thread(pc.new Producer());\n        Thread producerThread2 = new Thread(pc.new Producer());\n        Thread consumerThread1 = new Thread(pc.new Consumer());\n        Thread consumerThread2 = new Thread(pc.new Consumer());\n\n        producerThread1.start();\n        producerThread2.start();\n        consumerThread1.start();\n        consumerThread2.start();\n    }\n\n    // \u751f\u4ea7\u8005\u548c\u6d88\u8d39\u8005\u7c7b\u7684\u5b9e\u73b0\u4e0e\u4e4b\u524d\u76f8\u540c\n}\n</code></pre>"},{"location":"010Java/040MultiThreading/#_41","title":"\u603b\u7ed3","text":"<p>\u4f7f\u7528<code>BlockingQueue</code>\u5b9e\u73b0\u751f\u4ea7\u8005-\u6d88\u8d39\u8005\u6a21\u578b\u662f\u6700\u63a8\u8350\u7684\u65b9\u5f0f\uff0c\u56e0\u4e3a\u5b83\u7b80\u5355\u3001\u9ad8\u6548\u4e14\u7ebf\u7a0b\u5b89\u5168\u3002\u65e0\u8bba\u662f\u5355\u751f\u4ea7\u8005-\u5355\u6d88\u8d39\u8005\uff0c\u8fd8\u662f\u591a\u751f\u4ea7\u8005-\u591a\u6d88\u8d39\u8005\u573a\u666f\uff0c<code>BlockingQueue</code>\u90fd\u80fd\u5f88\u597d\u5730\u6ee1\u8db3\u9700\u6c42\u3002</p>"},{"location":"010Java/040MultiThreading/#java12121212","title":"Java\u53cc\u7ebf\u7a0b\u901a\u8fc7\u7ebf\u7a0b\u540c\u6b65\u7684\u65b9\u5f0f\u6253\u537012121212.......","text":"\u7b54\u6848 <p>\u5728Java\u4e2d\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528\u4e24\u4e2a\u7ebf\u7a0b\u5e76\u901a\u8fc7\u7ebf\u7a0b\u540c\u6b65\u7684\u65b9\u5f0f\u4ea4\u66ff\u6253\u5370 <code>1</code> \u548c <code>2</code>\u3002\u53ef\u4ee5\u901a\u8fc7 <code>wait()</code> \u548c <code>notify()</code> \u65b9\u6cd5\u6765\u5b9e\u73b0\u7ebf\u7a0b\u95f4\u7684\u540c\u6b65\u3002\u4ee5\u4e0b\u662f\u4e00\u4e2a\u7b80\u5355\u7684\u793a\u4f8b\u4ee3\u7801\uff1a</p> <pre><code>public class AlternatePrinting {\n    public static void main(String[] args) {\n        Printer printer = new Printer();\n\n        Thread t1 = new Thread(() -&gt; {\n            try {\n                printer.print1();\n            } catch (InterruptedException e) {\n                e.printStackTrace();\n            }\n        });\n\n        Thread t2 = new Thread(() -&gt; {\n            try {\n                printer.print2();\n            } catch (InterruptedException e) {\n                e.printStackTrace();\n            }\n        });\n\n        t1.start();\n        t2.start();\n    }\n}\n\nclass Printer {\n    private boolean print1Turn = true; // \u7528\u4e8e\u63a7\u5236\u4ea4\u66ff\u6253\u5370\n\n    public synchronized void print1() throws InterruptedException {\n        while (true) {\n            while (!print1Turn) {\n                wait(); // \u7b49\u5f85print2\u6253\u5370\u5b8c\u6bd5\n            }\n            System.out.print(\"1\");\n            print1Turn = false;\n            notify(); // \u5524\u9192print2\n        }\n    }\n\n    public synchronized void print2() throws InterruptedException {\n        while (true) {\n            while (print1Turn) {\n                wait(); // \u7b49\u5f85print1\u6253\u5370\u5b8c\u6bd5\n            }\n            System.out.print(\"2\");\n            print1Turn = true;\n            notify(); // \u5524\u9192print1\n        }\n    }\n}\n</code></pre>"},{"location":"010Java/040MultiThreading/#_42","title":"\u4ee3\u7801\u8bf4\u660e\uff1a","text":"<ol> <li> <p>Printer\u7c7b\uff1a\u8fd9\u4e2a\u7c7b\u6709\u4e24\u4e2a\u65b9\u6cd5 <code>print1</code> \u548c <code>print2</code>\uff0c\u5206\u522b\u7528\u4e8e\u6253\u5370 <code>1</code> \u548c <code>2</code>\u3002<code>print1Turn</code> \u662f\u4e00\u4e2a\u5e03\u5c14\u53d8\u91cf\uff0c\u7528\u4e8e\u63a7\u5236\u54ea\u4e2a\u7ebf\u7a0b\u5e94\u8be5\u6253\u5370\u3002</p> </li> <li> <p>synchronized\u5173\u952e\u5b57\uff1a<code>print1</code> \u548c <code>print2</code> \u65b9\u6cd5\u90fd\u662f\u540c\u6b65\u7684\uff0c\u786e\u4fdd\u540c\u4e00\u65f6\u95f4\u53ea\u6709\u4e00\u4e2a\u7ebf\u7a0b\u53ef\u4ee5\u8fdb\u5165\u8fd9\u4e9b\u65b9\u6cd5\u3002</p> </li> <li> <p>wait() \u548c notify()\uff1a<code>wait()</code> \u65b9\u6cd5\u4f7f\u5f53\u524d\u7ebf\u7a0b\u7b49\u5f85\uff0c\u76f4\u5230\u53e6\u4e00\u4e2a\u7ebf\u7a0b\u8c03\u7528 <code>notify()</code> \u6216 <code>notifyAll()</code> \u65b9\u6cd5\u3002<code>notify()</code> \u65b9\u6cd5\u5524\u9192\u4e00\u4e2a\u7b49\u5f85\u7684\u7ebf\u7a0b\u3002</p> </li> <li> <p>\u65e0\u9650\u5faa\u73af\uff1a\u4e24\u4e2a\u7ebf\u7a0b\u90fd\u5728\u65e0\u9650\u5faa\u73af\u4e2d\u8fd0\u884c\uff0c\u4ea4\u66ff\u6253\u5370 <code>1</code> \u548c <code>2</code>\u3002</p> </li> </ol>"},{"location":"010Java/040MultiThreading/#_43","title":"\u8fd0\u884c\u7ed3\u679c\uff1a","text":"<p>\u8fd0\u884c\u8fd9\u4e2a\u7a0b\u5e8f\u540e\uff0c\u63a7\u5236\u53f0\u4f1a\u4e0d\u65ad\u8f93\u51fa <code>12121212...</code>\uff0c\u76f4\u5230\u4f60\u624b\u52a8\u505c\u6b62\u7a0b\u5e8f\u3002</p>"},{"location":"010Java/040MultiThreading/#_44","title":"\u6ce8\u610f\u4e8b\u9879\uff1a","text":"<ul> <li>\u8fd9\u4e2a\u7a0b\u5e8f\u662f\u4e00\u4e2a\u7b80\u5355\u7684\u793a\u4f8b\uff0c\u5b9e\u9645\u5e94\u7528\u4e2d\u53ef\u80fd\u9700\u8981\u66f4\u590d\u6742\u7684\u7ebf\u7a0b\u7ba1\u7406\u548c\u540c\u6b65\u673a\u5236\u3002</li> <li>\u5982\u679c\u4f60\u60f3\u8981\u505c\u6b62\u7a0b\u5e8f\uff0c\u53ef\u4ee5\u901a\u8fc7\u6dfb\u52a0\u4e00\u4e2a\u505c\u6b62\u6761\u4ef6\u5e76\u5728\u9002\u5f53\u7684\u65f6\u5019\u8c03\u7528 <code>Thread.interrupt()</code> \u6765\u4e2d\u65ad\u7ebf\u7a0b\u3002</li> </ul>"},{"location":"010Java/040MultiThreading/#synchronized","title":"Synchronized","text":"\u7b54\u6848 <p>synchronized\uff0c\u662fJava\u4e2d\u7528\u4e8e\u89e3\u51b3\u5e76\u53d1\u60c5\u51b5\u4e0b\u6570\u636e\u540c\u6b65\u8bbf\u95ee\u7684\u4e00\u4e2a\u5f88\u91cd\u8981\u7684\u5173\u952e\u5b57\u3002\u5f53\u6211\u4eec\u60f3\u8981\u4fdd\u8bc1\u4e00\u4e2a\u5171\u4eab\u8d44\u6e90\u5728\u540c\u4e00\u4e2a\u65f6\u95f4\u53ea\u4f1a\u88ab\u4e00\u4e2a\u7ebf\u7a0b\u8bbf\u95ee\u5230\u65f6\uff0c\u6211\u4eec\u53ef\u4ee5\u5728\u4ee3\u7801\u4e2d\u4f7f\u7528synchronized\u5173\u952e\u5b57\u5bf9\u7c7b\u6216\u8005\u5bf9\u8c61\u52a0\u9501\u3002</p> <p>\u5728Java\u4e2d\uff0csynchronized\u6709\u4e24\u79cd\u4f7f\u7528\u65b9\u5f0f\uff0c\u540c\u6b65\u65b9\u6cd5\u548c\u540c\u6b65\u4ee3\u7801\u5757\u3002</p> <p>\u5bf9\u4e8e\u540c\u6b65\u65b9\u6cd5\uff0cJVM\u91c7\u7528ACC_SYNCHRONIZED\u6807\u8bb0\u7b26\u6765\u5b9e\u73b0\u540c\u6b65\u3002\u5bf9\u4e8e\u540c\u6b65\u4ee3\u7801\u5757\uff0cJVM\u91c7\u7528monitorenter\u3001monitorexit \u4e24\u4e2a\u6307\u4ee4\u6765\u5b9e\u73b0\u540c\u6b65\u3002</p> <p>\u540c\u6b65\u65b9\u6cd5 \u65b9\u6cd5\u7ea7\u7684\u540c\u6b65\u662f\u9690\u5f0f\u7684\uff0c\u540c\u6b65\u65b9\u6cd5\u7684\u5e38\u91cf\u6c60\u4e2d\u4f1a\u6709\u4e00\u4e2aACC_SYNCHRNZED \u6807\u5fd7\uff0c\u5f53\u67d0\u4e2a\u7ebf\u7a0b\u8981\u8bbf\u95ee\u67d0\u4e2a\u65b9\u6cd5\u7684\u65f6\u5019\uff0c\u4f1a\u68c0\u67e5\u662f\u5426\u6709 ACC_SYNCHORIZED \uff0c\u5982\u679c\u6709\u8bbe\u7f6e\uff0c\u5219\u9700\u8981\u5148\u83b7\u5f97\u76d1\u89c6\u5668\u9501\uff0c\u7136\u540e\u5f00\u59cb\u6267\u884c\u65b9\u6cd5\uff0c\u65b9\u6cd5\u6267\u884c\u4e4b\u540e\u5728\u91ca\u653e\u76d1\u89c6\u5668\u9501\u3002\u8fd9\u65f6\u5982\u679c\u5176\u4ed6\u7ebf\u7a0b\u6765\u8bf7\u6c42\u6267\u884c\u65b9\u6cd5\uff0c\u4f1a\u56e0\u4e3a\u65e0\u6cd5\u83b7\u5f97\u76d1\u89c6\u5668\u9501\u800c\u88ab\u963b\u65ad\u4f4f\u3002\u503c\u5f97\u6ce8\u610f\u7684\u662f\uff0c\u5982\u679c\u65b9\u6cd5\u5728\u6267\u884c\u8fc7\u7a0b\u4e2d\u53d1\u751f\u4e86\u5f02\u5e38\uff0c\u5e76\u4e14\u65b9\u6cd5\u5185\u90e8\u5e76\u6ca1\u6709\u5904\u7406\u8be5\u5f02\u5e38\uff0c\u90a3\u4e48\u5f02\u5e38\u88ab\u629b\u5230\u65b9\u6cd5\u5916\u9762\u4e4b\u524d\u76d1\u89c6\u5668\u9501\u4f1a\u88ab\u81ea\u52a8\u91ca\u653e\u3002</p> <p>\u540c\u6b65\u4ee3\u7801\u5757 \u540c\u6b65\u4ee3\u7801\u5757\u4f7f\u7528monitorenter\u548cmonitorexit\u4e24\u4e2a\u6307\u4ee4\u5b9e\u73b0\u3002\u53ef\u4ee5\u628a\u6267\u884cmonitorenter\u6307\u4ee4\u7406\u89e3\u4e3a\u52a0\u9501\uff0c\u6267\u884cmonitorexit\u7406\u89e3\u4e3a\u91ca\u653e\u9501\u3002\u6bcf\u4e2a\u5bf9\u8c61\u7ef4\u62a4\u7740\u4e00\u4e2a\u8bb0\u5f55\u88ab\u9501\u6b21\u6570\u7684\u8ba1\u6570\u5668\uff0c\u672a\u88ab\u9501\u5b9a\u7684\u5bf9\u8c61\u7684\u8be5\u8ba1\u6570\u5668\u4e3a0\uff0c\u5f53\u4e00\u4e2a\u7ebf\u7a0b\u83b7\u5f97\u9501\uff08\u6267\u884cmonitorenter\uff09\u540e\uff0c\u8be5\u8ba1\u6570\u5668\u81ea\u589e\u53d8\u4e3a1\uff0c\u5f53\u540c\u4e00\u4e2a\u7ebf\u7a0b\u518d\u6b21\u83b7\u5f97\u8be5\u5bf9\u8c61\u7684\u9501\u7684\u65f6\u5019\uff0c\u8ba1\u6570\u5668\u518d\u6b21\u81ea\u589e\u3002\u5f53\u540c\u4e00\u4e2a\u7ebf\u7a0b\u91ca\u653e\u9501\uff08\u6267\u884cmonitorexit\u6307\u4ee4\uff09\u7684\u65f6\u5019\uff0c\u8ba1\u6570\u5668\u5728\u81ea\u51cf\u3002\u5f53\u8ba1\u6570\u5668\u4e3a0\u7684\u65f6\u5019\uff0c\u9501\u5c06\u88ab\u91ca\u653e\uff0c\u5176\u4ed6\u7ebf\u7a0b\u4fbf\u53ef\u4ee5\u83b7\u5f97\u9501\u3002</p> <p>synchronized\u4e0e\u539f\u5b50\u6027 \u539f\u5b50\u6027\u662f\u6307\u4e00\u4e2a\u64cd\u4f5c\u662f\u4e0d\u53ef\u4e2d\u65ad\u7684\uff0c\u8981\u5168\u90e8\u6267\u884c\u5b8c\u6210\uff0c\u8981\u4e0d\u5c31\u90fd\u4e0d\u6267\u884c\u3002</p> <p>\u7ebf\u7a0b\u662fCPU\u8c03\u5ea6\u7684\u57fa\u672c\u5355\u4f4d\uff0cCPU\u6709\u65f6\u95f4\u7247\u7684\u6982\u5ff5\uff0c\u4f1a\u6839\u636e\u4e0d\u540c\u7684\u8c03\u5ea6\u7b97\u6cd5\u8fdb\u884c\u7ebf\u7a0b\u8c03\u5ea6\u3002\u5f53\u4e00\u4e2a\u7ebf\u7a0b\u83b7\u5f97\u65f6\u95f4\u7247\u4e4b\u540e\u5f00\u59cb\u6267\u884c\uff0c\u5728\u65f6\u95f4\u7247\u8017\u5c3d\u4e4b\u540e\uff0c\u5c31\u4f1a\u5931\u53bbCPU\u4f7f\u7528\u6743\u3002\u6240\u4ee5\u5728\u591a\u7ebf\u7a0b\u573a\u666f\u4e0b\uff0c\u7531\u4e8e\u65f6\u95f4\u7247\u5728\u7ebf\u7a0b\u95f4\u8f6e\u6362\uff0c\u5c31\u4f1a\u53d1\u751f\u539f\u5b50\u6027\u95ee\u9898\u3002</p> <p>\u5728Java\u4e2d\uff0c\u4e3a\u4e86\u4fdd\u8bc1\u539f\u5b50\u6027\uff0c\u63d0\u4f9b\u4e86\u4e24\u4e2a\u9ad8\u7ea7\u7684\u5b57\u8282\u7801\u6307\u4ee4 monitorenter \u548c monitorexit \u3002\u524d\u9762\u4ecb\u7ecd\u8fc7\uff0c\u8fd9\u4e24\u4e2a\u5b57\u8282\u7801\u6307\u4ee4\uff0c\u5728Java\u4e2d\u5bf9\u5e94\u7684\u5173\u952e\u5b57\u5c31\u662f synchronized\u3002</p> <p>\u901a\u8fc7 monitorenter \u548c monitorexit \u6307\u4ee4\uff0c\u53ef\u4ee5\u4fdd\u8bc1\u88ab synchronized\u4fee\u9970\u7684\u4ee3\u7801\u5728\u540c\u4e00\u65f6\u95f4\u53ea\u80fd\u88ab\u4e00\u4e2a\u7ebf\u7a0b\u8bbf\u95ee\uff0c\u5728\u9501\u672a\u91ca\u653e\u4e4b\u524d\uff0c\u65e0\u6cd5\u88ab\u5176\u4ed6\u7ebf\u7a0b\u8bbf\u95ee\u5230\u3002\u56e0\u6b64\uff0c\u5728Java\u4e2d\u53ef\u4ee5\u4f7f\u7528 synchronized \u6765\u4fdd\u8bc1\u65b9\u6cd5\u548c\u4ee3\u7801\u5757\u5185\u7684\u64cd\u4f5c\u662f\u539f\u5b50\u6027\u7684\u3002</p> <p>\u7ebf\u7a0b\u4e00\u5728\u6267\u884cmonitorenter\u6307\u4ee4\u7684\u65f6\u5019\uff0c\u4f1a\u5bf9Monitor\u8fdb\u884c\u52a0\u9501\uff0c\u52a0\u9501\u540e\u5176\u4ed6\u7ebf\u7a0b\u65e0\u6cd5\u83b7\u5f97\u9501\uff0c\u9664\u975e\u7ebf\u7a0b\u4e00\u4e3b\u52a8\u89e3\u9501\u3002\u5373\u4f7f\u5728\u6267\u884c\u8fc7\u7a0b\u4e2d\uff0c\u7531\u4e8e\u67d0\u79cd\u539f\u56e0\uff0c\u6bd4\u5982CPU\u65f6\u95f4\u7247\u7528\u5b8c\uff0c\u7ebf\u7a0b\u4e00\u653e\u5f03\u4e86CPU\uff0c\u4f46\u662f\uff0c\u4ed6\u5e76\u6ca1\u6709\u8fdb\u884c\u89e3\u9501\uff0c\u800c\u7531\u4e8e synchorized \u7684\u9501\u662f\u53ef\u4ee5\u91cd\u5165\u7684\uff0c\u4e0b\u4e00\u4e2a\u65f6\u95f4\u7247\u8fd8\u662f\u53ea\u80fd\u88ab\u4ed6\u81ea\u5df1\u83b7\u53d6\u5230\uff0c\u8fd8\u662f\u4f1a\u7ee7\u7eed\u6267\u884c\u4ee3\u7801\uff0c\u76f4\u5230\u6240\u6709\u4ee3\u7801\u6267\u884c\u5b8c\uff0c\u8fd9\u5c31\u4fdd\u8bc1\u4e86\u539f\u5b50\u6027\u3002</p> <p>synchroized\u4e0e\u53ef\u89c1\u6027 \u53ef\u89c1\u6027\u662f\u6307\u5f53\u591a\u4e2a\u7ebf\u7a0b\u8bbf\u95ee\u540c\u4e00\u4e2a\u53d8\u91cf\u65f6\uff0c\u4e00\u4e2a\u7ebf\u7a0b\u4fee\u6539\u4e86\u8fd9\u4e2a\u53d8\u91cf\u7684\u503c\uff0c\u5176\u4ed6\u7ebf\u7a0b\u80fd\u591f\u7acb\u5373\u770b\u5f97\u5230\u4fee\u6539\u7684\u503c\u3002</p> <p>Java\u5185\u5b58\u6a21\u578b\u89c4\u5b9a\u4e86\u6240\u6709\u7684\u53d8\u91cf\u90fd\u5b58\u50a8\u5728\u4e3b\u5185\u5b58\u4e2d\uff0c\u6bcf\u6761\u7ebf\u7a0b\u8fd8\u6709\u81ea\u5df1\u7684\u5de5\u4f5c\u5185\u5b58\uff0c\u7ebf\u7a0b\u7684\u5de5\u4f5c\u5185\u5b58\u4fdd\u5b58\u4e86\u8be5\u7ebf\u7a0b\u4e2d\u662f\u7528\u5230\u7684\u53d8\u91cf\u7684\u4e3b\u5185\u5b58\u526f\u672c\u62f7\u8d1d\uff0c\u7ebf\u7a0b\u5bf9\u53d8\u91cf\u7684\u6240\u6709\u64cd\u4f5c\u90fd\u5fc5\u987b\u5728\u5de5\u4f5c\u5185\u5b58\u4e2d\u8fdb\u884c\uff0c\u800c\u4e0d\u80fd\u76f4\u63a5\u8bfb\u5199\u4e3b\u5185\u5b58\u3002\u4e0d\u540c\u7684\u7ebf\u7a0b\u4e4b\u540e\u4e5f\u65e0\u6cd5\u76f4\u63a5\u8bbf\u95ee\u5bf9\u65b9\u5de5\u4f5c\u5185\u5b58\u4e2d\u7684\u53d8\u91cf\uff0c\u7ebf\u7a0b\u95f4\u53d8\u91cf\u7684\u4f20\u9012\u5747\u9700\u8981\u81ea\u5df1\u7684\u5de5\u4f5c\u5185\u5b58\u548c\u4e3b\u5185\u5b58\u4e4b\u95f4\u8fdb\u884c\u6570\u636e\u540c\u6b65\u8fdb\u884c\u3002\u6240\u4ee5\uff0c\u5c31\u53ef\u80fd\u51fa\u73b0\u7ebf\u7a0b\u4e00\u4fee\u6539\u4e86\u67d0\u4e2a\u53d8\u91cf\u7684\u503c\uff0c\u4f46\u7ebf\u7a0b\u4e8c\u4e0d\u53ef\u89c1\u7684\u60c5\u51b5\u3002</p> <p>\u524d\u9762\u6211\u4eec\u4ecb\u7ecd\u8fc7\uff0c\u88ab synchronized \u4fee\u9970\u7684\u4ee3\u7801\uff0c\u5728\u5f00\u59cb\u6267\u884c\u65f6\u4f1a\u52a0\u9501\uff0c\u6267\u884c\u5b8c\u6210\u540e\u4f1a\u8fdb\u884c\u89e3\u9501\u3002\u800c\u4e3a\u4e86\u4fdd\u8bc1\u53ef\u89c1\u6027\uff0c\u6709\u4e00\u6761\u89c4\u5219\u662f\u4e13\u4e1a\u7684\uff1a\u5bf9\u4e00\u4e2a\u53d8\u91cf\u89e3\u9501\u4e4b\u524d\uff0c\u5fc5\u987b\u5148\u628a\u53d8\u91cf\u540c\u6b65\u5230\u4e3b\u5185\u5b58\u4e2d\u3002\u8fd9\u6837\u89e3\u9501\u540e\uff0c\u540e\u7eed\u7ebf\u7a0b\u5c31\u53ef\u4ee5\u8bbf\u95ee\u5230\u88ab\u4fee\u6539\u540e\u7684\u503c\u3002</p> <p>\u6240\u4ee5\uff0c\u88ab synchronized \u5173\u952e\u5b57\u9501\u4f4f\u7684\u5bf9\u8c61\uff0c\u5176\u503c\u662f\u5177\u6709\u53ef\u89c1\u6027\u7684\u3002</p> <p>synchronized\u4e0e\u6709\u5e8f\u6027 \u6709\u5e8f\u6027\u5373\u7a0b\u5e8f\u6267\u884c\u7684\u987a\u5e8f\u6309\u7167\u4ee3\u7801\u7684\u5148\u540e\u987a\u5e8f\u6267\u884c\u3002</p> <p>\u9664\u4e86\u5f15\u5165\u4e86\u65f6\u95f4\u7247\u4ee5\u5916\uff0c\u7531\u4e8e\u5904\u7406\u5668\u4f18\u5316\u548c\u6307\u4ee4\u91cd\u6392\uff0cCPU\u8fd8\u53ef\u80fd\u5bf9\u8f93\u5165\u4ee3\u7801\u8fdb\u884c\u4e71\u5e8f\u6267\u884c\uff0c\u8fd9\u5c31\u53ef\u80fd\u5b58\u5728\u6709\u5e8f\u6027\u95ee\u9898\u3002</p> <p>\u8fd9\u91cc\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0csynchronized \u662f\u65e0\u6cd5\u7981\u6b62\u6307\u4ee4\u91cd\u6392\u548c\u5904\u7406\u5668\u4f18\u5316\u7684\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0csynchronized \u65e0\u6cd5\u907f\u514d\u4e0a\u8ff0\u63d0\u5230\u7684\u95ee\u9898\u3002\u90a3\u4e48\u4e3a\u4ec0\u4e48\u8fd8\u8bf4synchronized \u4e5f\u63d0\u4f9b\u4e86\u6709\u5e8f\u6027\u4fdd\u8bc1\u5462\uff1f</p> <p>\u8fd9\u5c31\u8981\u628a\u6709\u5e8f\u6027\u7684\u6982\u5ff5\u6269\u5c55\u4e00\u4e0b\u4e86\uff0cJava\u7a0b\u5e8f\u4e2d\u5929\u7136\u7684\u6709\u5e8f\u6027\u53ef\u4ee5\u603b\u7ed3\u4e3a\u4e00\u53e5\u8bdd\uff1a\u5982\u679c\u5728\u672c\u7ebf\u7a0b\u5185\u89c2\u5bdf\uff0c\u6240\u6709\u64cd\u4f5c\u90fd\u662f\u5929\u7136\u6709\u5e8f\u7684\uff0c\u5982\u679c\u5728\u4e00\u4e2a\u7ebf\u7a0b\u4e2d\u89c2\u5bdf\u53e6\u5916\u4e00\u4e2a\u7ebf\u7a0b\uff0c\u6240\u6709\u7684\u64cd\u4f5c\u90fd\u662f\u65e0\u5e8f\u7684\u3002</p> <p>\u4ee5\u4e0a\u8fd9\u53e5\u8bdd\u4e5f\u662f\u300a\u6df1\u5165\u7406\u89e3Java\u865a\u62df\u673a\u300b\u4e2d\u7684\u539f\u53e5\uff0c\u4f46\u662f\u600e\u4e48\u7406\u89e3\u5462\uff1f\u8fd9\u5176\u5b9e\u548c as-if-serial\u8bed\u4e49\u6709\u5173\u3002</p> <p>as-if-serial \u8bed\u4e49\u7684\u610f\u601d\u662f\u6307\uff1a\u4e0d\u7ba1\u600e\u4e48\u91cd\u6392\u5e8f\uff08\u7f16\u8bd1\u5668\u548c\u5904\u7406\u5668\u4e3a\u4e86\u63d0\u9ad8\u5e76\u884c\u5ea6\uff09\uff0c\u5355\u7ebf\u7a0b\u7a0b\u5e8f\u7684\u6267\u884c\u7ed3\u679c\u90fd\u4e0d\u80fd\u88ab\u6539\u53d8\uff0c\u7f16\u8bd1\u5668\u548c\u5904\u7406\u5668\u65e0\u8bba\u5982\u4f55\u4f18\u5316\uff0c\u90fd\u5fc5\u987b\u9075\u5b88 as-if-serial\u8bed\u4e49\u3002</p> <p>\u7b80\u5355\u6765\u8bf4\uff0cas-if-serial\u8bed\u4e49\u4fdd\u8bc1\u4e86\u5355\u7ebf\u7a0b\u4e2d\uff0c\u6307\u4ee4\u91cd\u6392\u662f\u6709\u4e00\u5b9a\u9650\u5236\u7684\uff0c\u800c\u53ea\u8981\u7f16\u8bd1\u5668\u548c\u5904\u7406\u5668\u90fd\u9075\u5b88\u8fd9\u4e2a\u8bed\u4e49\uff0c\u90a3\u4e48\u5c31\u53ef\u4ee5\u8ba4\u4e3a\u5355\u7ebf\u7a0b\u7a0b\u5e8f\u662f\u6309\u7167\u987a\u5e8f\u6267\u884c\u7684\uff0c\u5f53\u7136\uff0c\u5b9e\u9645\u4e0a\u8fd8\u662f\u6709\u91cd\u6392\uff0c\u53ea\u4e0d\u8fc7\u6211\u4eec\u65e0\u9700\u5173\u5fc3\u8fd9\u79cd\u91cd\u6392\u7684\u5e72\u6270\u3002</p> <p>\u6240\u4ee5\u8bf4\uff0c\u7531\u4e8esynchronized\u4fee\u9970\u7684\u4ee3\u7801\uff0c\u540c\u4e00\u65f6\u95f4\u53ea\u80fd\u88ab\u540c\u4e00\u4e2a\u7ebf\u7a0b\u8bbf\u95ee\uff0c\u90a3\u4e48\u4e5f\u5c31\u662f\u5355\u7ebf\u7a0b\u6267\u884c\uff0c\u6240\u4ee5\u53ef\u4ee5\u4fdd\u8bc1\u5176\u6709\u5e8f\u6027\u3002</p> <p>synchronized\u4e0e\u9501\u4f18\u5316</p> <p>\u65e0\u8bba\u662fACC_SYNCHORIZED\u8fd8\u662fmonitorenter\u3001monitorexit\u90fd\u662f\u57fa\u4e8eMonitor\u5b9e\u73b0\u7684\uff0c\u5728Java\u865a\u62df\u673a\uff08HotSpot\uff09\u4e2d\uff0cMonitor\u662f\u57fa\u4e8eC++\u5b9e\u73b0\u7684\uff0c\u7531ObjectMonitor\u5b9e\u73b0\u3002</p> <p>ObjectMonitor\u7c7b\u4e2d\u63d0\u4f9b\u4e86\u51e0\u4e2a\u65b9\u6cd5\uff0c\u5982 enter\u3001exit\u3001wait\u3001notify\u3001notifyAll \u7b49\u3002sychronized \u52a0\u9501\u7684\u539f\u7406\uff0c\u4f1a\u8c03\u7528 objectMonitor\u7684enter\u65b9\u6cd5\uff0c\u89e3\u9501\u7684\u65f6\u5019\u4f1a\u8c03\u7528 exit \u65b9\u6cd5\u3002\u4e8b\u5b9e\u4e0a\uff0c\u53ea\u6709\u5728JDK1.6\u4e4b\u524d\uff0csynchronized\u7684\u5b9e\u73b0\u624d\u4f1a\u76f4\u63a5\u8c03\u7528ObjectMonitor\u7684enter\u548cexit\uff0c\u8fd9\u79cd\u9501\u88ab\u79f0\u4e4b\u4e3a\u91cd\u91cf\u7ea7\u9501\u3002\u4e3a\u4ec0\u4e48\u8bf4\u8fd9\u79cd\u65b9\u5f0f\u64cd\u4f5c\u9501\u5f88\u91cd\u5462\uff1f</p> <p>Java\u7684\u7ebf\u7a0b\u662f\u6620\u5c04\u5230\u64cd\u4f5c\u7cfb\u7edf\u539f\u751f\u7ebf\u7a0b\u4e4b\u4e0a\u7684\uff0c\u5982\u679c\u8981\u963b\u585e\u6216\u5524\u9192\u4e00\u4e2a\u7ebf\u7a0b\u5c31\u9700\u8981\u64cd\u4f5c\u7cfb\u7edf\u7684\u5e2e\u5fd9\uff0c\u8fd9\u5c31\u662f\u8981\u4ece\u7528\u6237\u6001\u8f6c\u6362\u4e3a\u6838\u5fc3\u6001\uff0c\u56e0\u6b64\u72b6\u6001\u8f6c\u6362\u9700\u8981\u82b1\u8d39\u5f88\u591a\u7684\u5904\u7406\u5668\u65f6\u95f4\uff0c\u5bf9\u4e8e\u4ee3\u7801\u7b80\u5355\u7684\u540c\u6b65\u5757\uff0c\u72b6\u6001\u8f6c\u6362\u6d88\u8017\u7684\u65f6\u95f4\u6709\u53ef\u80fd\u6bd4\u7528\u6237\u4ee3\u7801\u6267\u884c\u7684\u65f6\u95f4\u8fd8\u8981\u957f\uff0c\u6240\u4ee5\u8bf4synchroized\u662fjava\u8bed\u8a00\u4e2d\u4e00\u4e2a\u91cd\u91cf\u7ea7\u7684\u64cd\u7eb5\u3002</p> <p>\u6240\u4ee5\uff0c\u5728JDK1.6\u4e2d\u51fa\u73b0\u5bf9\u9501\u8fdb\u884c\u4e86\u5f88\u591a\u7684\u4f18\u5316\uff0c\u8fdb\u800c\u51fa\u73b0\u4e86\u8f7b\u91cf\u7ea7\u9501\u3001\u504f\u5411\u9501\u3001\u9501\u6d88\u9664\uff0c\u9002\u5e94\u6027\u81ea\u65cb\u9501\u7b49\u7b49\uff0c\u8fd9\u4e9b\u64cd\u4f5c\u90fd\u662f\u4e3a\u4e86\u5728\u7ebf\u7a0b\u4e4b\u95f4\u66f4\u9ad8\u6548\u7684\u5171\u4eab\u6570\u636e\uff0c\u89e3\u51b3\u7ade\u4e89\u95ee\u9898\u3002</p>"},{"location":"010Java/040MultiThreading/#synchronized_1","title":"Synchronized\u80fd\u4fee\u9970\u4ec0\u4e48\uff1f\u5b83\u4eec\u5bf9\u5e94\u7684\u9501\u662f\u4ec0\u4e48\uff1f","text":"\u7b54\u6848 <p>\u8fd9\u91cc\u5199\u7684\u4e0d\u9519\u3002 https://cloud.tencent.com/developer/article/1998110</p> <p>\u53ef\u7528\u4e8e\u4fee\u9970\u666e\u901a\u65b9\u6cd5\u3001\u9759\u6001\u65b9\u6cd5\u548c\u4ee3\u7801\u5757</p> <p>\u5f53 synchronized \u4fee\u9970\u666e\u901a\u4ee3\u7801\u5757\u662f\uff0c\u5b83\u7684\u9501\u662f\u8c03\u7528\u8fd9\u4e2a\u65b9\u6cd5\u7684\u5bf9\u8c61\u3002</p> <p>\u5f53 synchronized \u4fee\u9970\u9759\u6001\u65b9\u6cd5\u65f6\uff0c\u5176\u4f5c\u7528\u8303\u56f4\u662f\u6574\u4e2a\u7a0b\u5e8f\uff0c\u8fd9\u4e2a\u9501\u5bf9\u4e8e\u6240\u6709\u8c03\u7528\u8fd9\u4e2a\u9501\u7684\u5bf9\u8c61\u90fd\u662f\u4e92\u65a5\u7684\u3002</p> <p>\u9759\u6001\u65b9\u6cd5\u52a0\u9501\u662f\u5168\u5c40\u7684\uff0c\u9488\u5bf9\u7684\u662f\u6240\u6709\u8c03\u7528\u8005\uff1b\u800c\u666e\u901a\u65b9\u6cd5\u52a0\u9501\u662f\u5bf9\u8c61\u7ea7\u522b\u7684\uff0c\u4e0d\u540c\u7684\u5bf9\u8c61\u62e5\u6709\u7684\u9501\u4e5f\u4e0d\u540c\u3002</p> <p>\u603b\u7ed3 synchronized \u7528 3 \u79cd\u7528\u6cd5\uff0c\u7528\u5b83\u53ef\u4ee5\u6765\u4fee\u9970\u666e\u901a\u65b9\u6cd5\u3001\u9759\u6001\u65b9\u6cd5\u548c\u4ee3\u7801\u5757\uff0c\u5176\u4e2d\u6700\u5e38\u7528\u7684\u662f\u4fee\u9970\u4ee3\u7801\u5757\uff0c\u800c\u4fee\u9970\u4ee3\u7801\u5757\u65f6\u9700\u8981\u6307\u5b9a\u4e00\u4e2a\u52a0\u9501\u5bf9\u8c61\uff0c\u8fd9\u4e2a\u52a0\u9501\u5bf9\u8c61\u901a\u5e38\u4f7f\u7528 this \u6216 xxx.class \u6765\u8868\u793a\uff0c\u5f53\u4f7f\u7528 this \u65f6\uff0c\u8868\u793a\u4f7f\u7528\u5f53\u524d\u5bf9\u8c61\u6765\u52a0\u9501\uff0c\u800c\u4f7f\u7528 class \u65f6\uff0c\u8868\u793a\u8868\u793a\u4f7f\u7528\u67d0\u4e2a\u7c7b\uff08\u975e\u7c7b\u5bf9\u8c61\u5b9e\u4f8b\uff09\u6765\u52a0\u9501\uff0c\u5b83\u662f\u5168\u5c40\u751f\u6548\u7684\u3002</p>"},{"location":"010Java/040MultiThreading/#_45","title":"\u5bf9\u8c61\u9501\u548c\u7c7b\u9501\u662f\u5426\u4f1a\u4e92\u76f8\u5f71\u54cd","text":"\u7b54\u6848 <p>\u5728Java\u4e2d\uff0c\u5bf9\u8c61\u9501\u548c\u7c7b\u9501\u662f\u4e24\u79cd\u4e0d\u540c\u7684\u9501\u673a\u5236\uff0c\u5b83\u4eec\u4e0d\u4f1a\u4e92\u76f8\u5f71\u54cd\u3002</p>"},{"location":"010Java/040MultiThreading/#1_5","title":"1. \u5bf9\u8c61\u9501","text":"<p>\u5bf9\u8c61\u9501\u662f\u9488\u5bf9\u67d0\u4e2a\u7279\u5b9a\u5b9e\u4f8b\u5bf9\u8c61\u7684\u9501\u3002\u6bcf\u4e2aJava\u5bf9\u8c61\u90fd\u6709\u4e00\u4e2a\u5185\u7f6e\u7684\u9501\uff08\u4e5f\u79f0\u4e3a\u76d1\u89c6\u5668\u9501\uff09\uff0c\u5f53\u4e00\u4e2a\u7ebf\u7a0b\u8bbf\u95ee\u67d0\u4e2a\u5bf9\u8c61\u7684<code>synchronized</code>\u5b9e\u4f8b\u65b9\u6cd5\u6216\u4ee3\u7801\u5757\u65f6\uff0c\u5b83\u4f1a\u83b7\u53d6\u8be5\u5bf9\u8c61\u7684\u9501\uff0c\u5176\u4ed6\u7ebf\u7a0b\u5728\u9501\u91ca\u653e\u524d\u65e0\u6cd5\u8bbf\u95ee\u8be5\u5bf9\u8c61\u7684\u5176\u4ed6<code>synchronized</code>\u5b9e\u4f8b\u65b9\u6cd5\u6216\u4ee3\u7801\u5757\u3002</p> <pre><code>public class MyClass {\n    public synchronized void instanceMethod() {\n        // \u540c\u6b65\u4ee3\u7801\n    }\n\n    public void anotherInstanceMethod() {\n        synchronized (this) {\n            // \u540c\u6b65\u4ee3\u7801\n        }\n    }\n}\n</code></pre>"},{"location":"010Java/040MultiThreading/#2_6","title":"2. \u7c7b\u9501","text":"<p>\u7c7b\u9501\u662f\u9488\u5bf9\u7c7b\u7684\u9501\uff0c\u6bcf\u4e2a\u7c7b\u4e5f\u6709\u4e00\u4e2a\u5185\u7f6e\u7684\u9501\u3002\u5f53\u4e00\u4e2a\u7ebf\u7a0b\u8bbf\u95ee\u67d0\u4e2a\u7c7b\u7684<code>synchronized</code>\u9759\u6001\u65b9\u6cd5\u6216\u4ee3\u7801\u5757\u65f6\uff0c\u5b83\u4f1a\u83b7\u53d6\u8be5\u7c7b\u7684\u9501\uff0c\u5176\u4ed6\u7ebf\u7a0b\u5728\u9501\u91ca\u653e\u524d\u65e0\u6cd5\u8bbf\u95ee\u8be5\u7c7b\u7684\u5176\u4ed6<code>synchronized</code>\u9759\u6001\u65b9\u6cd5\u6216\u4ee3\u7801\u5757\u3002</p> <pre><code>public class MyClass {\n    public static synchronized void staticMethod() {\n        // \u540c\u6b65\u4ee3\u7801\n    }\n\n    public static void anotherStaticMethod() {\n        synchronized (MyClass.class) {\n            // \u540c\u6b65\u4ee3\u7801\n        }\n    }\n}\n</code></pre>"},{"location":"010Java/040MultiThreading/#3_6","title":"3. \u5bf9\u8c61\u9501\u548c\u7c7b\u9501\u7684\u5173\u7cfb","text":"<ul> <li>\u5bf9\u8c61\u9501\uff1a\u9501\u5b9a\u7684\u662f\u67d0\u4e2a\u5177\u4f53\u7684\u5b9e\u4f8b\u5bf9\u8c61\u3002</li> <li>\u7c7b\u9501\uff1a\u9501\u5b9a\u7684\u662f\u7c7b\u7684Class\u5bf9\u8c61\u3002</li> </ul> <p>\u7531\u4e8e\u5bf9\u8c61\u9501\u548c\u7c7b\u9501\u9501\u5b9a\u7684\u662f\u4e0d\u540c\u7684\u5bf9\u8c61\uff08\u5b9e\u4f8b\u5bf9\u8c61 vs \u7c7b\u7684Class\u5bf9\u8c61\uff09\uff0c\u56e0\u6b64\u5b83\u4eec\u4e0d\u4f1a\u4e92\u76f8\u5f71\u54cd\u3002\u4e00\u4e2a\u7ebf\u7a0b\u53ef\u4ee5\u540c\u65f6\u6301\u6709\u5bf9\u8c61\u9501\u548c\u7c7b\u9501\uff0c\u800c\u4e0d\u4f1a\u5bfc\u81f4\u51b2\u7a81\u3002</p>"},{"location":"010Java/040MultiThreading/#_46","title":"\u793a\u4f8b","text":"<pre><code>public class MyClass {\n    public synchronized void instanceMethod() {\n        // \u5bf9\u8c61\u9501\n    }\n\n    public static synchronized void staticMethod() {\n        // \u7c7b\u9501\n    }\n}\n</code></pre> <p>\u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff1a - \u7ebf\u7a0bA\u8c03\u7528<code>instanceMethod()</code>\u65f6\uff0c\u4f1a\u83b7\u53d6<code>MyClass</code>\u7684\u67d0\u4e2a\u5b9e\u4f8b\u7684\u5bf9\u8c61\u9501\u3002 - \u7ebf\u7a0bB\u8c03\u7528<code>staticMethod()</code>\u65f6\uff0c\u4f1a\u83b7\u53d6<code>MyClass</code>\u7c7b\u7684\u7c7b\u9501\u3002</p> <p>\u8fd9\u4e24\u4e2a\u64cd\u4f5c\u4e0d\u4f1a\u4e92\u76f8\u963b\u585e\uff0c\u56e0\u4e3a\u5b83\u4eec\u9501\u5b9a\u7684\u662f\u4e0d\u540c\u7684\u5bf9\u8c61\u3002</p>"},{"location":"010Java/040MultiThreading/#_47","title":"\u603b\u7ed3","text":"<ul> <li>\u5bf9\u8c61\u9501\u548c\u7c7b\u9501\u662f\u72ec\u7acb\u7684\uff0c\u4e0d\u4f1a\u4e92\u76f8\u5f71\u54cd\u3002</li> <li>\u5bf9\u8c61\u9501\u9501\u5b9a\u7684\u662f\u5b9e\u4f8b\u5bf9\u8c61\uff0c\u7c7b\u9501\u9501\u5b9a\u7684\u662f\u7c7b\u7684Class\u5bf9\u8c61\u3002</li> <li>\u4e00\u4e2a\u7ebf\u7a0b\u53ef\u4ee5\u540c\u65f6\u6301\u6709\u5bf9\u8c61\u9501\u548c\u7c7b\u9501\u3002</li> </ul>"},{"location":"010Java/040MultiThreading/#volatile","title":"volatile \u7684\u610f\u4e49\uff1f","text":"\u7b54\u6848 <p>volatile\u7528\u6cd5</p> <p>volatile\u901a\u5e38\u88ab\u6bd4\u55bb\u6210\u8f7b\u91cf\u7ea7\u7684synchronized\uff0c\u4e5f\u662fJava\u5e76\u53d1\u7f16\u7a0b\u4e2d\u6bd4\u8f83\u91cd\u8981\u7684\u4e00\u4e2a\u5173\u952e\u5b57\uff0c\u548csynchronized\u4e0d\u540c\uff0cvolatile\u662f\u4e00\u4e2a\u53d8\u91cf\u4fee\u9970\u7b26\uff0c\u53ea\u80fd\u7528\u6765\u4fee\u9970\u53d8\u91cf\uff0c\u65e0\u6cd5\u4fee\u9970\u65b9\u6cd5\u4ee5\u53ca\u4ee3\u7801\u5757\u3002</p> <p>volatile\u7684\u7528\u6cd5\u6bd4\u8f83\u7b80\u5355\uff0c\u53ea\u9700\u8981\u5728\u58f0\u660e\u4e00\u4e2a\u53ef\u80fd\u88ab\u591a\u7ebf\u7a0b\u540c\u65f6\u8bbf\u95ee\u7684\u53d8\u91cf\u65f6\uff0c\u4f7f\u7528volatile\u4fee\u9970\u5c31\u53ef\u4ee5\u4e86\u3002</p> <p>volatile\u539f\u7406 \u4e3a\u4e86\u63d0\u9ad8\u5904\u7406\u5668\u7684\u6267\u884c\u901f\u5ea6\uff0c\u5728\u5904\u7406\u5668\u548c\u5185\u5b58\u4e4b\u95f4\u589e\u52a0\u4e86\u591a\u7ea7\u7f13\u5b58\u6765\u63d0\u5347\uff0c\u4f46\u662f\u7531\u4e8e\u5f15\u5165\u4e86\u591a\u7ea7\u7f13\u5b58\uff0c\u5c31\u5b58\u5728\u7f13\u5b58\u6570\u636e\u4e0d\u4e00\u81f4\u7684\u95ee\u9898\u3002</p> <p>\u4f46\u662f\uff0c\u5bf9\u4e8evolatile\u53d8\u91cf\uff0c\u5f53\u5bf9volatile\u53d8\u91cf\u8fdb\u884c\u5199\u64cd\u4f5c\u7684\u65f6\u5019\uff0cJVM\u4f1a\u5411\u5904\u7406\u5668\u53d1\u9001\u4e00\u6761Lock\u524d\u7f00\u7684\u6307\u4ee4\uff0c\u5c06\u8fd9\u4e2a\u7f13\u5b58\u4e2d\u7684\u53d8\u91cf\u56de\u5199\u5230\u7cfb\u7edf\u4e3b\u5b58\u4e2d\u3002</p> <p>\u4f46\u662f\u5c31\u7b97\u56de\u5199\u5185\u5b58\uff0c\u5982\u679c\u5176\u4ed6\u5904\u7406\u5668\u7f13\u5b58\u7684\u503c\u8fd8\u662f\u65e7\u7684\uff0c\u5728\u6267\u884c\u8ba1\u7b97\u64cd\u4f5c\u5c31\u4f1a\u6709\u95ee\u9898\uff0c\u6240\u4ee5\u5728\u591a\u5904\u7406\u5668\u4e0b\uff0c\u4e3a\u4e86\u4fdd\u8bc1\u5404\u4e2a\u5904\u7406\u5668\u7684\u7f13\u5b58\u662f\u4e00\u81f4\u7684\uff0c\u5c31\u4f1a\u5b9e\u73b0\u7f13\u5b58\u4e00\u81f4\u6027\u534f\u8bae\u3002</p> <p>\u7f13\u5b58\u4e00\u81f4\u6027\u534f\u8bae\uff1a</p> <p>\u6bcf\u4e2a\u5904\u7406\u5668\u901a\u8fc7\u55c5\u63a2\u5728\u603b\u7ebf\u4e0a\u4f20\u64ad\u7684\u6570\u636e\u6765\u68c0\u6d4b\u81ea\u5df1\u7f13\u5b58\u7684\u4fe1\u606f\u662f\u4e0d\u662f\u8fc7\u671f\u4e86\uff0c\u5f53\u5904\u7406\u5668\u53d1\u73b0\u81ea\u5df1\u7f13\u5b58\u884c\u5bf9\u5e94\u7684\u5185\u5b58\u5730\u5740\u88ab\u4fee\u6539\u4e86\uff0c\u5c31\u4f1a\u5c06\u5f53\u524d\u5904\u7406\u5668\u7684\u7f13\u5b58\u884c\u8bbe\u7f6e\u4e3a\u65e0\u6548\u72b6\u6001\uff0c\u5f53\u5904\u7406\u5668\u8981\u5bf9\u8fd9\u4e2a\u6570\u636e\u8fdb\u884c\u4fee\u6539\u64cd\u4f5c\u7684\u65f6\u5019\uff0c\u4f1a\u5f3a\u5236\u91cd\u65b0\u4ece\u7cfb\u7edf\u5185\u5b58\u91cc\u628a\u6570\u636e\u8bfb\u5230\u5904\u7406\u5668\u7f13\u5b58\u91cc\u3002</p> <p>\u6240\u4ee5\uff0c\u5982\u679c\u4e00\u4e2a\u53d8\u91cf\u88abvolatile\u6240\u4fee\u9970\u7684\u8bdd\uff0c\u5728\u6bcf\u6b21\u6570\u636e\u53d8\u5316\u4e4b\u540e\uff0c\u5176\u503c\u90fd\u4f1a\u88ab\u5f3a\u5236\u5237\u65b0\u5165\u4e3b\u5b58\u3002\u800c\u5176\u4ed6\u5904\u7406\u5668\u7684\u7f13\u5b58\u7531\u4e8e\u9075\u5b88\u4e86\u7f13\u5b58\u4e00\u81f4\u6027\u534f\u8bae\uff0c\u4e5f\u4f1a\u628a\u8fd9\u4e2a\u53d8\u91cf\u7684\u503c\u4ece\u4e3b\u5b58\u52a0\u8f7d\u5230\u81ea\u5df1\u7684\u7f13\u5b58\u4e2d\uff0c\u8fd9\u5c31\u4fdd\u8bc1\u4e86\u4e00\u4e2avolatile\u4fee\u9970\u7684\u53d8\u91cf\u5728\u591a\u4e2a\u7f13\u5b58\u4e2d\u662f\u53ef\u89c1\u7684\u3002</p> <p>volatile\u4e0e\u53ef\u89c1\u6027 \u53ef\u89c1\u6027\u662f\u6307\u5f53\u591a\u4e2a\u7ebf\u7a0b\u8bbf\u95ee\u540c\u4e00\u4e2a\u53d8\u91cf\u65f6\uff0c\u4e00\u4e2a\u7ebf\u7a0b\u4fee\u6539\u4e86\u8fd9\u4e2a\u53d8\u91cf\u7684\u503c\uff0c\u5176\u4ed6\u7ebf\u7a0b\u4e5f\u80fd\u591f\u7acb\u5373\u770b\u5230\u4fee\u6539\u7684\u503c\u3002</p> <p>\u524d\u9762\u5728\u5173\u4e8evolatile\u539f\u7406\u7684\u65f6\u5019\u8bb2\u8fc7\uff0cJava\u4e2d\u7684volatile\u5173\u952e\u5b57\u63d0\u4f9b\u4e86\u4e00\u4e2a\u529f\u80fd\uff0c\u90a3\u5c31\u662f\u88ab\u4fee\u9970\u7684\u53d8\u91cf\u5728\u88ab\u4fee\u6539\u540e\u53ef\u4ee5\u7acb\u5373\u540c\u6b65\u5230\u4e3b\u5b58\u4e2d\uff0c\u88ab\u5176\u4fee\u9970\u7684\u53d8\u91cf\u5728\u6bcf\u6b21\u4f7f\u7528\u4e4b\u524d\u90fd\u662f\u4ece\u4e3b\u5185\u5b58\u4e2d\u5237\u65b0\u3002\u56e0\u6b64\uff0c\u53ef\u4ee5\u4f7f\u7528volatile\u6765\u4fdd\u8bc1\u591a\u7ebf\u7a0b\u64cd\u4f5c\u65f6\u53d8\u91cf\u7684\u53ef\u89c1\u6027\u3002</p> <p>volatile\u4e0e\u6709\u5e8f\u6027 volatile\u7981\u6b62\u6307\u4ee4\u91cd\u6392\u4f18\u5316\uff0c\u8fd9\u5c31\u4fdd\u8bc1\u4e86\u4ee3\u7801\u7684\u7a0b\u5e8f\u4f1a\u4e25\u683c\u6309\u7167\u4ee3\u7801\u7684\u5148\u540e\u987a\u5e8f\u6267\u884c\uff0c\u8fd9\u5c31\u4fdd\u8bc1\u4e86\u6709\u5e8f\u6027\u3002</p> <p>volatile\u4e0e\u539f\u5b50\u6027 \u5728\u4e0a\u9762\u4ecb\u7ecdsynchronized\u7684\u65f6\u5019\uff0c\u63d0\u5230\u8fc7\uff0c\u4e3a\u4e86\u4fdd\u8bc1\u539f\u5b50\u6027\uff0c\u9700\u8981\u901a\u8fc7\u5b57\u8282\u7801\u6307\u4ee4monitorenter\u548cmonitorexit\uff0c\u4f46\u662fvolatile\u548c\u8fd9\u4e24\u4e2a\u6307\u4ee4\u6ca1\u6709\u4efb\u4f55\u5173\u7cfb\u3002</p> <p>\u6240\u4ee5\uff0cvolatile\u662f\u4e0d\u80fd\u4fdd\u8bc1\u539f\u5b50\u6027\u7684\u3002</p> <p>\u5728\u4ee5\u4e0b\u4e24\u4e2a\u573a\u666f\u4e2d\u53ef\u4ee5\u4f7f\u7528volatile\u66ff\u4ee3synchronized\uff1a</p> <ol> <li>\u8fd0\u7b97\u7ed3\u679c\u5e76\u4e0d\u4f9d\u8d56\u53d8\u91cf\u7684\u5f53\u524d\u503c\uff0c\u6216\u8005\u80fd\u591f\u786e\u4fdd\u53ea\u6709\u5355\u4e00\u7684\u7ebf\u7a0b\u4f1a\u4fee\u6539\u53d8\u91cf\u7684\u503c</li> <li>\u53d8\u91cf\u4e0d\u9700\u8981\u4e0e\u5176\u4ed6\u72b6\u6001\u53d8\u91cf\u5171\u540c\u53c2\u4e0e\u4e0d\u53d8\u7ea6\u675f</li> </ol> <p>\u9664\u4e86\u4ee5\u4e0a\u573a\u666f\uff0c\u90fd\u9700\u8981\u4f7f\u7528\u5176\u4ed6\u65b9\u5f0f\u6765\u4fdd\u8bc1\u539f\u5b50\u6027\uff0c\u5982synchronized\u6216\u8005concurrent\u5305\u3002</p> <p>synchronized\u53ef\u4ee5\u4fdd\u8bc1\u539f\u5b50\u6027\u3001\u6709\u5e8f\u6027\u548c\u53ef\u89c1\u6027\uff0c\u800cvolatile\u53ea\u80fd\u4fdd\u8bc1\u6709\u5e8f\u6027\u548c\u53ef\u89c1\u6027\u3002</p>"},{"location":"010Java/040MultiThreading/#_48","title":"Java\u591a\u7ebf\u7a0b","text":""},{"location":"010Java/050Pattern/","title":"Java\u8bbe\u8ba1\u6a21\u5f0f","text":""},{"location":"010Java/050Pattern/#_1","title":"\u8bbe\u8ba1\u6a21\u5f0f","text":""},{"location":"010Java/050Pattern/#_2","title":"\u9762\u5411\u5bf9\u8c61\u601d\u60f3","text":"\u7b54\u6848 \u7b80\u5199 \u7ffb\u8bd1 SRP \u5355\u4e00\u804c\u8d23\u539f\u5219 OCP \u5f00\u653e\u5c01\u95ed\u539f\u5219 LSP \u91cc\u6c0f\u66ff\u6362\u539f\u5219 ISP \u63a5\u53e3\u5206\u79bb\u539f\u5219 DIP \u4f9d\u8d56\u5012\u7f6e\u539f\u5219 <p>\u5355\u4e00\u804c\u8d23\u539f\u5219</p> <p>\u4fee\u6539\u4e00\u4e2a\u7c7b\u7684\u539f\u56e0\u5e94\u8be5\u53ea\u6709\u4e00\u4e2a</p> <p>\u6362\u53e5\u8bdd\u8bf4\u5c31\u662f\u8ba9\u4e00\u4e2a\u7c7b\u53ea\u8d1f\u8d23\u4e00\u4ef6\u4e8b\uff0c\u5f53\u8fd9\u4e2a\u7c7b\u9700\u8981\u505a\u8fc7\u591a\u7684\u4e8b\u60c5\u7684\u65f6\u5019\uff0c\u5c31\u9700\u8981\u5206\u89e3\u8fd9\u4e2a\u7c7b\u3002</p> <p>\u5982\u679c\u4e00\u4e2a\u7c7b\u627f\u62c5\u7684\u804c\u8d23\u8fc7\u591a\uff0c\u5c31\u7b49\u4e8e\u628a\u8fd9\u4e9b\u804c\u8d23\u8026\u5408\u5728\u4e86\u4e00\u8d77\uff0c\u4e00\u4e2a\u804c\u8d23\u7684\u53d8\u5316\u53ef\u80fd\u4f1a\u524a\u5f31\u8fd9\u4e2a\u7c7b\u5b8c\u6210\u5176\u5b83\u804c\u8d23\u7684\u80fd\u529b\u3002</p> <p>\u5f00\u653e\u5c01\u95ed\u539f\u5219</p> <p>\u7c7b\u5e94\u8be5\u5bf9\u6269\u5c55\u5f00\u653e\uff0c\u5bf9\u4fee\u6539\u5173\u95ed</p> <p>\u6269\u5c55\u5c31\u662f\u6dfb\u52a0\u65b0\u529f\u80fd\u7684\u610f\u601d\uff0c\u56e0\u6b64\u8be5\u539f\u5219\u8981\u6c42\u5728\u6dfb\u52a0\u65b0\u529f\u80fd\u65f6\u4e0d\u9700\u8981\u4fee\u6539\u4ee3\u7801\u3002</p> <p>\u7b26\u5408\u5f00\u95ed\u539f\u5219\u6700\u5178\u578b\u7684\u8bbe\u8ba1\u6a21\u5f0f\u662f\u88c5\u9970\u8005\u6a21\u5f0f\uff0c\u5b83\u53ef\u4ee5\u52a8\u6001\u5730\u5c06\u804c\u8d23\u9644\u52a0\u5230\u5bf9\u8c61\u4e0a\uff0c\u800c\u4e0d\u7528\u53bb\u4fee\u6539\u7c7b\u7684\u4ee3\u7801\u3002</p> <p>\u91cc\u6c0f\u66ff\u6362\u539f\u5219</p> <p>\u5b50\u7c7b\u5bf9\u8c61\u5fc5\u987b\u80fd\u591f\u66ff\u6362\u6389\u6240\u6709\u7236\u7c7b\u5bf9\u8c61</p> <p>\u7ee7\u627f\u662f\u4e00\u79cd IS - A \u5173\u7cfb\uff0c\u5b50\u7c7b\u9700\u8981\u80fd\u591f\u5f53\u6210\u7236\u7c7b\u6765\u4f7f\u7528\uff0c\u5e76\u4e14\u9700\u8981\u6bd4\u7236\u7c7b\u66f4\u7279\u6b8a\u3002</p> <p>\u5982\u679c\u4e0d\u6ee1\u8db3\u8fd9\u4e2a\u539f\u5219\uff0c\u90a3\u4e48\u5404\u4e2a\u5b50\u7c7b\u7684\u884c\u4e3a\u4e0a\u5c31\u4f1a\u6709\u5f88\u5927\u5dee\u5f02\uff0c\u589e\u52a0\u7ee7\u627f\u4f53\u7cfb\u7684\u590d\u6742\u5ea6\u3002</p> <p>\u63a5\u53e3\u5206\u79bb\u539f\u5219</p> <p>\u4e0d\u5e94\u8be5\u5f3a\u8feb\u5ba2\u6237\u4f9d\u8d56\u4e8e\u5b83\u4eec\u4e0d\u7528\u7684\u65b9\u6cd5</p> <p>\u56e0\u6b64\u4f7f\u7528\u591a\u4e2a\u4e13\u95e8\u7684\u63a5\u53e3\u6bd4\u4f7f\u7528\u5355\u4e00\u7684\u603b\u63a5\u53e3\u66f4\u597d\u3002</p> <p>\u4f9d\u8d56\u5012\u7f6e\u539f\u5219</p> <p>\u9ad8\u5c42\u6a21\u5757\u4e0d\u5e94\u8be5\u4f9d\u8d56\u4e8e\u4f4e\u5c42\u6a21\u5757\uff0c\u4e24\u8005\u90fd\u5e94\u8be5\u4f9d\u8d56\u4e8e\u62bd\u8c61\u3002</p> <p>\u62bd\u8c61\u4e0d\u5e94\u8be5\u4f9d\u8d56\u4e8e\u7ec6\u8282\uff0c\u7ec6\u8282\u5e94\u8be5\u4f9d\u8d56\u4e8e\u62bd\u8c61\u3002</p> <p>\u9ad8\u5c42\u6a21\u5757\u5305\u542b\u4e00\u4e2a\u5e94\u7528\u7a0b\u5e8f\u4e2d\u91cd\u8981\u7684\u7b56\u7565\u9009\u62e9\u548c\u4e1a\u52a1\u6a21\u5757\uff0c\u5982\u679c\u9ad8\u5c42\u6a21\u5757\u4f9d\u8d56\u4e8e\u4f4e\u5c42\u6a21\u5757\uff0c\u90a3\u4e48\u4f4e\u5c42\u6a21\u5757\u7684\u6539\u52a8\u5c31\u4f1a\u76f4\u63a5\u5f71\u54cd\u5230\u9ad8\u5c42\u6a21\u5757\uff0c\u4ece\u800c\u8feb\u4f7f\u9ad8\u5c42\u6a21\u5757\u4e5f\u9700\u8981\u6539\u52a8\u3002</p> <p>\u4f9d\u8d56\u4e8e\u62bd\u8c61\u610f\u5473\u7740\uff1a</p> <ul> <li>\u4efb\u4f55\u53d8\u91cf\u90fd\u4e0d\u5e94\u8be5\u6301\u6709\u4e00\u4e2a\u6307\u5411\u5177\u4f53\u7c7b\u7684\u6307\u9488\u6216\u8005\u5f15\u7528</li> <li>\u4efb\u4f55\u7c7b\u90fd\u4e0d\u5e94\u8be5\u4ece\u5177\u4f53\u7c7b\u6d3e\u751f</li> <li>\u4efb\u4f55\u65b9\u6cd5\u90fd\u4e0d\u5e94\u8be5\u8986\u5199\u5b83\u7684\u4efb\u4f55\u57fa\u7c7b\u4e2d\u7684\u5df2\u7ecf\u5b9e\u73b0\u7684\u65b9\u6cd5</li> </ul>"},{"location":"010Java/050Pattern/#_3","title":"\u4e09\u5927\u7279\u6027","text":"<p>\u5c01\u88c5</p> <p>\u5229\u7528\u62bd\u8c61\u6570\u636e\u7c7b\u578b\u5c06\u6570\u636e\u548c\u57fa\u4e8e\u6570\u636e\u7684\u64cd\u4f5c\u5c01\u88c5\u5728\u4e00\u8d77\uff0c\u4f7f\u5176\u6784\u6210\u4e00\u4e2a\u4e0d\u53ef\u5206\u79bb\u7684\u72ec\u7acb\u5b9e\u4f53\u3002\u6570\u636e\u88ab\u4fdd\u62a4\u5728\u62bd\u8c61\u6570\u636e\u7c7b\u578b\u7684\u5185\u90e8\uff0c\u5c3d\u53ef\u80fd\u7684\u9690\u85cf\u5185\u90e8\u7ec6\u8282\uff0c\u53ea\u4fdd\u7559\u4e00\u4e9b\u5bf9\u5916\u63a5\u53e3\u4f7f\u4e4b\u4e0e\u5916\u90e8\u53d1\u751f\u8054\u7cfb\u3002\u7528\u6237\u65e0\u9700\u77e5\u9053\u5bf9\u8c61\u5185\u90e8\u7684\u7ec6\u8282\uff0c\u4f46\u53ef\u4ee5\u901a\u8fc7\u5bf9\u8c61\u5bf9\u5916\u63d0\u4f9b\u7684\u63a5\u53e3\u6765\u8bbf\u95ee\u8be5\u5bf9\u8c61\u3002</p> <p>\u4f18\u70b9\uff1a</p> <ul> <li>\u964d\u4f4e\u8026\u5408\uff1a\u53ef\u4ee5\u72ec\u7acb\u5f00\u53d1\u3001\u6d4b\u8bd5\u3001\u4f18\u5316\u548c\u4fee\u6539\u7b49</li> <li>\u51cf\u8f7b\u7ef4\u62a4\u7684\u8d1f\u62c5\uff1a\u53ef\u4ee5\u66f4\u5bb9\u6613\u7684\u88ab\u7a0b\u5e8f\u733f\u7406\u89e3\uff0c\u5e76\u4e14\u5728\u8c03\u8bd5\u7684\u65f6\u5019\u53ef\u4ee5\u4e0d\u5f71\u54cd\u5176\u4ed6\u6a21\u5757</li> <li>\u6709\u6548\u5730\u8c03\u8282\u6027\u80fd\uff1a\u53ef\u4ee5\u901a\u8fc7\u5256\u6790\u786e\u5b9a\u54ea\u4e9b\u6a21\u5757\u5f71\u54cd\u4e86\u7cfb\u7edf\u7684\u6027\u80fd</li> <li>\u63d0\u9ad8\u8f6f\u4ef6\u7684\u53ef\u91cd\u7528\u6027</li> <li>\u964d\u4f4e\u4e86\u6784\u5efa\u5927\u578b\u7cfb\u7edf\u7684\u5206\u4eab\uff1a\u5373\u4f7f\u6574\u4e2a\u7cfb\u7edf\u4e0d\u53ef\u7528\uff0c\u4f46\u662f\u8fd9\u4e9b\u72ec\u7acb\u7684\u6a21\u5757\u5374\u6709\u53ef\u80fd\u662f\u53ef\u7528\u7684</li> </ul> <p>\u7ee7\u627f</p> <p>\u7ee7\u627f\u5b9e\u73b0\u4e86 IS - A \u5173\u7cfb\uff0c\u7ee7\u627f\u5e94\u8be5\u9075\u5faa\u91cc\u6c0f\u66ff\u6362\u539f\u5219\uff0c\u5b50\u7c7b\u5bf9\u8c61\u5fc5\u987b\u80fd\u591f\u66ff\u6362\u6389\u6240\u6709\u7236\u7c7b\u5bf9\u8c61\u3002</p> <p>\u591a\u6001</p> <p>\u591a\u6001\u5206\u4e3a\u7f16\u8bd1\u65f6\u591a\u6001\u548c\u8fd0\u884c\u65f6\u591a\u6001\u3002\u7f16\u8bd1\u65f6\u591a\u6001\u4e3b\u8981\u6307\u65b9\u6cd5\u7684\u91cd\u8f7d\uff0c\u8fd0\u884c\u65f6\u591a\u6001\u6307\u7a0b\u5e8f\u4e2d\u5b9a\u4e49\u7684\u5bf9\u8c61\u5f15\u7528\u6240\u6307\u5411\u7684\u5177\u4f53\u7c7b\u578b\u5728\u8fd0\u884c\u671f\u95f4\u624d\u786e\u5b9a\u3002</p> <p>\u8fd0\u884c\u65f6\u591a\u6001\u6709\u4e09\u4e2a\u6761\u4ef6\uff1a</p> <ul> <li>\u7ee7\u627f</li> <li>\u8986\u76d6</li> <li>\u5411\u4e0a\u8f6c\u578b</li> </ul>"},{"location":"010Java/050Pattern/#_4","title":"\u4ee3\u7801\u8bbe\u8ba1\u7684\u57fa\u7840\u539f\u5219","text":"\u7b54\u6848 <p>\u4ee3\u7801\u8bbe\u8ba1\u7684\u57fa\u7840\u539f\u5219\u662f\u786e\u4fdd\u4ee3\u7801\u8d28\u91cf\u3001\u53ef\u7ef4\u62a4\u6027\u548c\u53ef\u6269\u5c55\u6027\u7684\u5173\u952e\u3002\u4ee5\u4e0b\u662f\u5e38\u89c1\u7684\u4ee3\u7801\u8bbe\u8ba1\u539f\u5219\uff1a</p>"},{"location":"010Java/050Pattern/#1-kisskeep-it-simple-stupid","title":"1. KISS\uff08Keep It Simple, Stupid\uff09","text":"<ul> <li>\u7b80\u6d01\u6027\uff1a\u4ee3\u7801\u5e94\u5c3d\u91cf\u7b80\u5355\uff0c\u907f\u514d\u4e0d\u5fc5\u8981\u7684\u590d\u6742\u6027\u3002</li> <li>\u6613\u8bfb\u6027\uff1a\u7b80\u5355\u7684\u4ee3\u7801\u66f4\u6613\u7406\u89e3\u548c\u7ef4\u62a4\u3002</li> </ul>"},{"location":"010Java/050Pattern/#2-drydont-repeat-yourself","title":"2. DRY\uff08Don't Repeat Yourself\uff09","text":"<ul> <li>\u907f\u514d\u91cd\u590d\uff1a\u76f8\u540c\u7684\u4ee3\u7801\u4e0d\u5e94\u5728\u591a\u4e2a\u5730\u65b9\u51fa\u73b0\uff0c\u5e94\u901a\u8fc7\u51fd\u6570\u3001\u7c7b\u6216\u6a21\u5757\u590d\u7528\u3002</li> <li>\u5355\u4e00\u804c\u8d23\uff1a\u6bcf\u4e2a\u51fd\u6570\u6216\u7c7b\u5e94\u53ea\u8d1f\u8d23\u4e00\u4e2a\u529f\u80fd\u3002</li> </ul>"},{"location":"010Java/050Pattern/#3-yagniyou-arent-gonna-need-it","title":"3. YAGNI\uff08You Aren't Gonna Need It\uff09","text":"<ul> <li>\u907f\u514d\u8fc7\u5ea6\u8bbe\u8ba1\uff1a\u53ea\u5b9e\u73b0\u5f53\u524d\u9700\u8981\u7684\u529f\u80fd\uff0c\u4e0d\u8981\u4e3a\u672a\u6765\u53ef\u80fd\u7684\u9700\u6c42\u9884\u5148\u7f16\u5199\u4ee3\u7801\u3002</li> </ul>"},{"location":"010Java/050Pattern/#4-solid","title":"4. SOLID \u539f\u5219","text":"<ul> <li>\u5355\u4e00\u804c\u8d23\u539f\u5219\uff08SRP\uff09\uff1a\u4e00\u4e2a\u7c7b\u5e94\u53ea\u6709\u4e00\u4e2a\u804c\u8d23\u3002</li> <li>\u5f00\u95ed\u539f\u5219\uff08OCP\uff09\uff1a\u8f6f\u4ef6\u5b9e\u4f53\u5e94\u5bf9\u6269\u5c55\u5f00\u653e\uff0c\u5bf9\u4fee\u6539\u5173\u95ed\u3002</li> <li>\u91cc\u6c0f\u66ff\u6362\u539f\u5219\uff08LSP\uff09\uff1a\u5b50\u7c7b\u5e94\u80fd\u66ff\u6362\u7236\u7c7b\u800c\u4e0d\u5f71\u54cd\u7a0b\u5e8f\u884c\u4e3a\u3002</li> <li>\u63a5\u53e3\u9694\u79bb\u539f\u5219\uff08ISP\uff09\uff1a\u5ba2\u6237\u7aef\u4e0d\u5e94\u4f9d\u8d56\u4e0d\u9700\u8981\u7684\u63a5\u53e3\u3002</li> <li>\u4f9d\u8d56\u5012\u7f6e\u539f\u5219\uff08DIP\uff09\uff1a\u9ad8\u5c42\u6a21\u5757\u4e0d\u5e94\u4f9d\u8d56\u4f4e\u5c42\u6a21\u5757\uff0c\u4e24\u8005\u90fd\u5e94\u4f9d\u8d56\u62bd\u8c61\u3002</li> </ul>"},{"location":"010Java/050Pattern/#5","title":"5. \u9ad8\u5185\u805a\u4f4e\u8026\u5408","text":"<ul> <li>\u9ad8\u5185\u805a\uff1a\u6a21\u5757\u5185\u90e8\u5143\u7d20\u5e94\u7d27\u5bc6\u76f8\u5173\uff0c\u4e13\u6ce8\u4e8e\u5355\u4e00\u4efb\u52a1\u3002</li> <li>\u4f4e\u8026\u5408\uff1a\u6a21\u5757\u4e4b\u95f4\u5e94\u5c3d\u91cf\u51cf\u5c11\u4f9d\u8d56\uff0c\u4fbf\u4e8e\u72ec\u7acb\u4fee\u6539\u548c\u6d4b\u8bd5\u3002</li> </ul>"},{"location":"010Java/050Pattern/#6","title":"6. \u4ee3\u7801\u590d\u7528","text":"<ul> <li>\u6a21\u5757\u5316\u8bbe\u8ba1\uff1a\u901a\u8fc7\u6a21\u5757\u5316\u63d0\u9ad8\u4ee3\u7801\u590d\u7528\u6027\u3002</li> <li>\u5e93\u548c\u6846\u67b6\uff1a\u5229\u7528\u73b0\u6709\u5e93\u548c\u6846\u67b6\u51cf\u5c11\u91cd\u590d\u5de5\u4f5c\u3002</li> </ul>"},{"location":"010Java/050Pattern/#7","title":"7. \u53ef\u6d4b\u8bd5\u6027","text":"<ul> <li>\u5355\u5143\u6d4b\u8bd5\uff1a\u4ee3\u7801\u5e94\u6613\u4e8e\u7f16\u5199\u5355\u5143\u6d4b\u8bd5\uff0c\u786e\u4fdd\u5404\u90e8\u5206\u529f\u80fd\u6b63\u786e\u3002</li> <li>\u81ea\u52a8\u5316\u6d4b\u8bd5\uff1a\u901a\u8fc7\u81ea\u52a8\u5316\u6d4b\u8bd5\u51cf\u5c11\u624b\u52a8\u6d4b\u8bd5\u5de5\u4f5c\u91cf\u3002</li> </ul>"},{"location":"010Java/050Pattern/#8","title":"8. \u53ef\u8bfb\u6027","text":"<ul> <li>\u547d\u540d\u89c4\u8303\uff1a\u4f7f\u7528\u6709\u610f\u4e49\u7684\u53d8\u91cf\u3001\u51fd\u6570\u548c\u7c7b\u540d\u3002</li> <li>\u6ce8\u91ca\u548c\u6587\u6863\uff1a\u9002\u5f53\u6ce8\u91ca\u548c\u7f16\u5199\u6587\u6863\uff0c\u5e2e\u52a9\u4ed6\u4eba\u7406\u89e3\u4ee3\u7801\u3002</li> </ul>"},{"location":"010Java/050Pattern/#9","title":"9. \u6027\u80fd\u4e0e\u4f18\u5316","text":"<ul> <li>\u907f\u514d\u8fc7\u65e9\u4f18\u5316\uff1a\u5148\u786e\u4fdd\u4ee3\u7801\u6b63\u786e\uff0c\u518d\u8003\u8651\u6027\u80fd\u4f18\u5316\u3002</li> <li>\u6027\u80fd\u5206\u6790\uff1a\u901a\u8fc7\u6027\u80fd\u5206\u6790\u5de5\u5177\u627e\u51fa\u74f6\u9888\u5e76\u8fdb\u884c\u4f18\u5316\u3002</li> </ul>"},{"location":"010Java/050Pattern/#10","title":"10. \u5b89\u5168\u6027","text":"<ul> <li>\u8f93\u5165\u9a8c\u8bc1\uff1a\u9632\u6b62\u6ce8\u5165\u653b\u51fb\u7b49\u5b89\u5168\u95ee\u9898\u3002</li> <li>\u6570\u636e\u4fdd\u62a4\uff1a\u786e\u4fdd\u654f\u611f\u6570\u636e\u7684\u5b89\u5168\u5b58\u50a8\u548c\u4f20\u8f93\u3002</li> </ul>"},{"location":"010Java/050Pattern/#11","title":"11. \u7248\u672c\u63a7\u5236","text":"<ul> <li>\u4f7f\u7528\u7248\u672c\u63a7\u5236\u7cfb\u7edf\uff1a\u5982Git\uff0c\u4fbf\u4e8e\u4ee3\u7801\u7ba1\u7406\u548c\u56e2\u961f\u534f\u4f5c\u3002</li> <li>\u5206\u652f\u7b56\u7565\uff1a\u91c7\u7528\u5408\u9002\u7684\u5206\u652f\u7b56\u7565\uff0c\u5982Git Flow\u6216GitHub Flow\u3002</li> </ul>"},{"location":"010Java/050Pattern/#12-cicd","title":"12. \u6301\u7eed\u96c6\u6210\u4e0e\u6301\u7eed\u4ea4\u4ed8\uff08CI/CD\uff09","text":"<ul> <li>\u81ea\u52a8\u5316\u6784\u5efa\u548c\u6d4b\u8bd5\uff1a\u901a\u8fc7CI/CD\u5de5\u5177\u5b9e\u73b0\u81ea\u52a8\u5316\u6784\u5efa\u548c\u6d4b\u8bd5\u3002</li> <li>\u5feb\u901f\u53cd\u9988\uff1a\u5c3d\u65e9\u53d1\u73b0\u5e76\u4fee\u590d\u95ee\u9898\u3002</li> </ul>"},{"location":"010Java/050Pattern/#13","title":"13. \u4ee3\u7801\u5ba1\u67e5","text":"<ul> <li>\u540c\u884c\u8bc4\u5ba1\uff1a\u901a\u8fc7\u4ee3\u7801\u5ba1\u67e5\u53d1\u73b0\u6f5c\u5728\u95ee\u9898\uff0c\u63d0\u5347\u4ee3\u7801\u8d28\u91cf\u3002</li> <li>\u77e5\u8bc6\u5171\u4eab\uff1a\u4fc3\u8fdb\u56e2\u961f\u95f4\u7684\u77e5\u8bc6\u4ea4\u6d41\u3002</li> </ul>"},{"location":"010Java/050Pattern/#14","title":"14. \u8bbe\u8ba1\u6a21\u5f0f","text":"<ul> <li>\u5e38\u7528\u8bbe\u8ba1\u6a21\u5f0f\uff1a\u5982\u5355\u4f8b\u3001\u5de5\u5382\u3001\u89c2\u5bdf\u8005\u7b49\uff0c\u89e3\u51b3\u5e38\u89c1\u8bbe\u8ba1\u95ee\u9898\u3002</li> <li>\u6a21\u5f0f\u9009\u62e9\uff1a\u6839\u636e\u5177\u4f53\u9700\u6c42\u9009\u62e9\u5408\u9002\u7684\u8bbe\u8ba1\u6a21\u5f0f\u3002</li> </ul>"},{"location":"010Java/050Pattern/#15","title":"15. \u9519\u8bef\u5904\u7406","text":"<ul> <li>\u5f02\u5e38\u5904\u7406\uff1a\u5408\u7406\u5904\u7406\u5f02\u5e38\uff0c\u907f\u514d\u7a0b\u5e8f\u5d29\u6e83\u3002</li> <li>\u65e5\u5fd7\u8bb0\u5f55\uff1a\u8bb0\u5f55\u9519\u8bef\u4fe1\u606f\uff0c\u4fbf\u4e8e\u95ee\u9898\u6392\u67e5\u3002</li> </ul>"},{"location":"010Java/050Pattern/#_5","title":"\u603b\u7ed3","text":"<p>\u9075\u5faa\u8fd9\u4e9b\u539f\u5219\u53ef\u4ee5\u63d0\u5347\u4ee3\u7801\u7684\u53ef\u7ef4\u62a4\u6027\u3001\u53ef\u6269\u5c55\u6027\u548c\u53ef\u8bfb\u6027\uff0c\u51cf\u5c11\u9519\u8bef\u5e76\u63d0\u9ad8\u5f00\u53d1\u6548\u7387\u3002\u5b9e\u9645\u5e94\u7528\u4e2d\uff0c\u5e94\u6839\u636e\u9879\u76ee\u9700\u6c42\u7075\u6d3b\u8c03\u6574\u3002</p>"},{"location":"010Java/050Pattern/#uml","title":"\u7528UML\u753b\u51fa\u5de5\u5382\u6a21\u5f0f","text":"\u7b54\u6848 <p>\u5de5\u5382\u6a21\u5f0f\uff08Factory Pattern\uff09\u662f\u4e00\u79cd\u521b\u5efa\u578b\u8bbe\u8ba1\u6a21\u5f0f\uff0c\u5b83\u63d0\u4f9b\u4e86\u4e00\u79cd\u521b\u5efa\u5bf9\u8c61\u7684\u65b9\u5f0f\uff0c\u800c\u65e0\u9700\u6307\u5b9a\u5177\u4f53\u7684\u7c7b\u3002\u5de5\u5382\u6a21\u5f0f\u901a\u5e38\u5305\u62ec\u4ee5\u4e0b\u51e0\u4e2a\u89d2\u8272\uff1a</p> <ol> <li>\u4ea7\u54c1\u63a5\u53e3\uff08Product Interface\uff09\uff1a\u5b9a\u4e49\u4e86\u4ea7\u54c1\u7684\u63a5\u53e3\u3002</li> <li>\u5177\u4f53\u4ea7\u54c1\uff08Concrete Product\uff09\uff1a\u5b9e\u73b0\u4e86\u4ea7\u54c1\u63a5\u53e3\u7684\u5177\u4f53\u7c7b\u3002</li> <li>\u5de5\u5382\u63a5\u53e3\uff08Factory Interface\uff09\uff1a\u5b9a\u4e49\u4e86\u521b\u5efa\u4ea7\u54c1\u7684\u65b9\u6cd5\u3002</li> <li>\u5177\u4f53\u5de5\u5382\uff08Concrete Factory\uff09\uff1a\u5b9e\u73b0\u4e86\u5de5\u5382\u63a5\u53e3\uff0c\u8d1f\u8d23\u521b\u5efa\u5177\u4f53\u4ea7\u54c1\u3002</li> </ol> <p>\u4e0b\u9762\u662f\u4e00\u4e2a\u7b80\u5355\u7684UML\u7c7b\u56fe\uff0c\u5c55\u793a\u4e86\u5de5\u5382\u6a21\u5f0f\u7684\u7ed3\u6784\uff1a</p> <pre><code>+-------------------+        +-------------------+\n|   Product         |        |   Factory          |\n+-------------------+        +-------------------+\n| + operation()     |        | + createProduct()  |\n+-------------------+        +-------------------+\n        ^                            ^\n        |                            |\n        |                            |\n+-------------------+        +-------------------+\n| ConcreteProductA  |        | ConcreteFactoryA   |\n+-------------------+        +-------------------+\n| + operation()     |        | + createProduct()  |\n+-------------------+        +-------------------+\n\n+-------------------+        +-------------------+\n| ConcreteProductB  |        | ConcreteFactoryB   |\n+-------------------+        +-------------------+\n| + operation()     |        | + createProduct()  |\n+-------------------+        +-------------------+\n</code></pre>"},{"location":"010Java/050Pattern/#_6","title":"\u89e3\u91ca\uff1a","text":"<ul> <li>Product\uff1a\u4ea7\u54c1\u63a5\u53e3\uff0c\u5b9a\u4e49\u4e86\u4ea7\u54c1\u7684\u64cd\u4f5c\u3002</li> <li>ConcreteProductA \u548c ConcreteProductB\uff1a\u5177\u4f53\u4ea7\u54c1\u7c7b\uff0c\u5b9e\u73b0\u4e86\u4ea7\u54c1\u63a5\u53e3\u3002</li> <li>Factory\uff1a\u5de5\u5382\u63a5\u53e3\uff0c\u5b9a\u4e49\u4e86\u521b\u5efa\u4ea7\u54c1\u7684\u65b9\u6cd5\u3002</li> <li>ConcreteFactoryA \u548c ConcreteFactoryB\uff1a\u5177\u4f53\u5de5\u5382\u7c7b\uff0c\u5b9e\u73b0\u4e86\u5de5\u5382\u63a5\u53e3\uff0c\u8d1f\u8d23\u521b\u5efa\u5177\u4f53\u4ea7\u54c1\u3002</li> </ul>"},{"location":"010Java/050Pattern/#java","title":"\u4ee3\u7801\u793a\u4f8b\uff08Java\uff09\uff1a","text":"<pre><code>// \u4ea7\u54c1\u63a5\u53e3\ninterface Product {\n    void operation();\n}\n\n// \u5177\u4f53\u4ea7\u54c1A\nclass ConcreteProductA implements Product {\n    @Override\n    public void operation() {\n        System.out.println(\"ConcreteProductA operation\");\n    }\n}\n\n// \u5177\u4f53\u4ea7\u54c1B\nclass ConcreteProductB implements Product {\n    @Override\n    public void operation() {\n        System.out.println(\"ConcreteProductB operation\");\n    }\n}\n\n// \u5de5\u5382\u63a5\u53e3\ninterface Factory {\n    Product createProduct();\n}\n\n// \u5177\u4f53\u5de5\u5382A\nclass ConcreteFactoryA implements Factory {\n    @Override\n    public Product createProduct() {\n        return new ConcreteProductA();\n    }\n}\n\n// \u5177\u4f53\u5de5\u5382B\nclass ConcreteFactoryB implements Factory {\n    @Override\n    public Product createProduct() {\n        return new ConcreteProductB();\n    }\n}\n\n// \u5ba2\u6237\u7aef\u4ee3\u7801\npublic class FactoryPatternDemo {\n    public static void main(String[] args) {\n        Factory factoryA = new ConcreteFactoryA();\n        Product productA = factoryA.createProduct();\n        productA.operation();\n\n        Factory factoryB = new ConcreteFactoryB();\n        Product productB = factoryB.createProduct();\n        productB.operation();\n    }\n}\n</code></pre>"},{"location":"010Java/050Pattern/#_7","title":"\u8fd0\u884c\u7ed3\u679c\uff1a","text":"<pre><code>ConcreteProductA operation\nConcreteProductB operation\n</code></pre> <p>\u8fd9\u4e2aUML\u56fe\u548c\u4ee3\u7801\u793a\u4f8b\u5c55\u793a\u4e86\u5de5\u5382\u6a21\u5f0f\u7684\u57fa\u672c\u7ed3\u6784\u548c\u5b9e\u73b0\u65b9\u5f0f\u3002\u5de5\u5382\u6a21\u5f0f\u7684\u6838\u5fc3\u601d\u60f3\u662f\u5c06\u5bf9\u8c61\u7684\u521b\u5efa\u4e0e\u4f7f\u7528\u5206\u79bb\uff0c\u4f7f\u5f97\u7cfb\u7edf\u66f4\u52a0\u7075\u6d3b\u548c\u53ef\u6269\u5c55\u3002</p>"},{"location":"010Java/050Pattern/#android","title":"Android\u7cfb\u7edf\u6e90\u7801\u4e2d\uff0c\u6709\u54ea\u4e9b\u4f7f\u7528\u54ea\u4e9b\u8bbe\u8ba1\u6a21\u5f0f\uff1f\u8bf7\u5217\u4e3e\u4e00\u4e9b\u5e38\u7528\u7684\u8bbe\u8ba1\u6a21\u5f0f\u3002","text":"\u7b54\u6848 <p>\u5728Android\u7cfb\u7edf\u6e90\u7801\u4e2d\uff0c\u8bbe\u8ba1\u6a21\u5f0f\u88ab\u5e7f\u6cdb\u7528\u4e8e\u89e3\u51b3\u5e38\u89c1\u95ee\u9898\u5e76\u63d0\u5347\u4ee3\u7801\u7684\u53ef\u7ef4\u62a4\u6027\u548c\u6269\u5c55\u6027\u3002\u4ee5\u4e0b\u662f\u4e00\u4e9b\u5e38\u7528\u7684\u8bbe\u8ba1\u6a21\u5f0f\u53ca\u5176\u5e94\u7528\u573a\u666f\uff1a</p>"},{"location":"010Java/050Pattern/#1-singleton","title":"1. \u5355\u4f8b\u6a21\u5f0f\uff08Singleton\uff09","text":"<ul> <li>\u5e94\u7528\u573a\u666f\uff1a\u786e\u4fdd\u4e00\u4e2a\u7c7b\u53ea\u6709\u4e00\u4e2a\u5b9e\u4f8b\uff0c\u5e76\u63d0\u4f9b\u5168\u5c40\u8bbf\u95ee\u70b9\u3002</li> <li>\u793a\u4f8b\uff1a<code>LayoutInflater</code>\u3001<code>InputMethodManager</code>\u7b49\u7cfb\u7edf\u670d\u52a1\u901a\u5e38\u901a\u8fc7\u5355\u4f8b\u6a21\u5f0f\u63d0\u4f9b\u3002</li> </ul>"},{"location":"010Java/050Pattern/#2-factory","title":"2. \u5de5\u5382\u6a21\u5f0f\uff08Factory\uff09","text":"<ul> <li>\u5e94\u7528\u573a\u666f\uff1a\u521b\u5efa\u5bf9\u8c61\u65f6\u9690\u85cf\u5177\u4f53\u5b9e\u73b0\uff0c\u63d0\u4f9b\u7edf\u4e00\u7684\u63a5\u53e3\u3002</li> <li>\u793a\u4f8b\uff1a<code>BitmapFactory</code>\u7528\u4e8e\u521b\u5efa<code>Bitmap</code>\u5bf9\u8c61\u3002</li> </ul>"},{"location":"010Java/050Pattern/#3-observer","title":"3. \u89c2\u5bdf\u8005\u6a21\u5f0f\uff08Observer\uff09","text":"<ul> <li>\u5e94\u7528\u573a\u666f\uff1a\u5b9a\u4e49\u5bf9\u8c61\u95f4\u7684\u4e00\u5bf9\u591a\u4f9d\u8d56\u5173\u7cfb\uff0c\u5f53\u4e00\u4e2a\u5bf9\u8c61\u72b6\u6001\u6539\u53d8\u65f6\uff0c\u6240\u6709\u4f9d\u8d56\u5bf9\u8c61\u90fd\u4f1a\u6536\u5230\u901a\u77e5\u3002</li> <li>\u793a\u4f8b\uff1a<code>LiveData</code>\u3001<code>View</code>\u4e0e<code>ViewTreeObserver</code>\u7684\u4ea4\u4e92\u3002</li> </ul>"},{"location":"010Java/050Pattern/#4-adapter","title":"4. \u9002\u914d\u5668\u6a21\u5f0f\uff08Adapter\uff09","text":"<ul> <li>\u5e94\u7528\u573a\u666f\uff1a\u5c06\u4e00\u4e2a\u7c7b\u7684\u63a5\u53e3\u8f6c\u6362\u6210\u5ba2\u6237\u7aef\u671f\u671b\u7684\u53e6\u4e00\u4e2a\u63a5\u53e3\u3002</li> <li>\u793a\u4f8b\uff1a<code>RecyclerView.Adapter</code>\u7528\u4e8e\u5c06\u6570\u636e\u9002\u914d\u5230<code>RecyclerView</code>\u4e2d\u3002</li> </ul>"},{"location":"010Java/050Pattern/#5-decorator","title":"5. \u88c5\u9970\u8005\u6a21\u5f0f\uff08Decorator\uff09","text":"<ul> <li>\u5e94\u7528\u573a\u666f\uff1a\u52a8\u6001\u5730\u4e3a\u5bf9\u8c61\u6dfb\u52a0\u529f\u80fd\uff0c\u907f\u514d\u901a\u8fc7\u5b50\u7c7b\u6269\u5c55\u3002</li> <li>\u793a\u4f8b\uff1a<code>ContextWrapper</code>\u662f\u5bf9<code>Context</code>\u7684\u88c5\u9970\uff0c\u5141\u8bb8\u5728\u4e0d\u4fee\u6539\u539f\u59cb\u7c7b\u7684\u60c5\u51b5\u4e0b\u6269\u5c55\u529f\u80fd\u3002</li> </ul>"},{"location":"010Java/050Pattern/#6-strategy","title":"6. \u7b56\u7565\u6a21\u5f0f\uff08Strategy\uff09","text":"<ul> <li>\u5e94\u7528\u573a\u666f\uff1a\u5b9a\u4e49\u4e00\u7cfb\u5217\u7b97\u6cd5\uff0c\u5c01\u88c5\u6bcf\u4e2a\u7b97\u6cd5\uff0c\u5e76\u4f7f\u5b83\u4eec\u53ef\u4ee5\u4e92\u6362\u3002</li> <li>\u793a\u4f8b\uff1a<code>Animation</code>\u4e2d\u7684\u63d2\u503c\u5668\uff08Interpolator\uff09\u5141\u8bb8\u52a8\u6001\u6539\u53d8\u52a8\u753b\u7684\u884c\u4e3a\u3002</li> </ul>"},{"location":"010Java/050Pattern/#7-template-method","title":"7. \u6a21\u677f\u65b9\u6cd5\u6a21\u5f0f\uff08Template Method\uff09","text":"<ul> <li>\u5e94\u7528\u573a\u666f\uff1a\u5b9a\u4e49\u4e00\u4e2a\u7b97\u6cd5\u7684\u6846\u67b6\uff0c\u5141\u8bb8\u5b50\u7c7b\u5728\u4e0d\u6539\u53d8\u7ed3\u6784\u7684\u60c5\u51b5\u4e0b\u91cd\u5199\u67d0\u4e9b\u6b65\u9aa4\u3002</li> <li>\u793a\u4f8b\uff1a<code>AsyncTask</code>\u4e2d\u7684<code>doInBackground</code>\u3001<code>onPostExecute</code>\u7b49\u65b9\u6cd5\u3002</li> </ul>"},{"location":"010Java/050Pattern/#8-builder","title":"8. \u5efa\u9020\u8005\u6a21\u5f0f\uff08Builder\uff09","text":"<ul> <li>\u5e94\u7528\u573a\u666f\uff1a\u5c06\u4e00\u4e2a\u590d\u6742\u5bf9\u8c61\u7684\u6784\u5efa\u4e0e\u5176\u8868\u793a\u5206\u79bb\uff0c\u4f7f\u5f97\u540c\u6837\u7684\u6784\u5efa\u8fc7\u7a0b\u53ef\u4ee5\u521b\u5efa\u4e0d\u540c\u7684\u8868\u793a\u3002</li> <li>\u793a\u4f8b\uff1a<code>AlertDialog.Builder</code>\u7528\u4e8e\u6784\u5efa<code>AlertDialog</code>\u3002</li> </ul>"},{"location":"010Java/050Pattern/#9-proxy","title":"9. \u4ee3\u7406\u6a21\u5f0f\uff08Proxy\uff09","text":"<ul> <li>\u5e94\u7528\u573a\u666f\uff1a\u4e3a\u5176\u4ed6\u5bf9\u8c61\u63d0\u4f9b\u4e00\u79cd\u4ee3\u7406\u4ee5\u63a7\u5236\u5bf9\u8fd9\u4e2a\u5bf9\u8c61\u7684\u8bbf\u95ee\u3002</li> <li>\u793a\u4f8b\uff1a<code>Binder</code>\u673a\u5236\u4e2d\u7684\u4ee3\u7406\u5bf9\u8c61\u7528\u4e8e\u8de8\u8fdb\u7a0b\u901a\u4fe1\u3002</li> </ul>"},{"location":"010Java/050Pattern/#10-composite","title":"10. \u7ec4\u5408\u6a21\u5f0f\uff08Composite\uff09","text":"<ul> <li>\u5e94\u7528\u573a\u666f\uff1a\u5c06\u5bf9\u8c61\u7ec4\u5408\u6210\u6811\u5f62\u7ed3\u6784\u4ee5\u8868\u793a\u201c\u90e8\u5206-\u6574\u4f53\u201d\u7684\u5c42\u6b21\u7ed3\u6784\u3002</li> <li>\u793a\u4f8b\uff1a<code>View</code>\u548c<code>ViewGroup</code>\u7684\u5c42\u6b21\u7ed3\u6784\u3002</li> </ul>"},{"location":"010Java/050Pattern/#11-command","title":"11. \u547d\u4ee4\u6a21\u5f0f\uff08Command\uff09","text":"<ul> <li>\u5e94\u7528\u573a\u666f\uff1a\u5c06\u8bf7\u6c42\u5c01\u88c5\u4e3a\u5bf9\u8c61\uff0c\u4f7f\u5f97\u53ef\u4ee5\u7528\u4e0d\u540c\u7684\u8bf7\u6c42\u5bf9\u5ba2\u6237\u8fdb\u884c\u53c2\u6570\u5316\u3002</li> <li>\u793a\u4f8b\uff1a<code>Runnable</code>\u548c<code>Handler</code>\u7528\u4e8e\u5c01\u88c5\u548c\u6267\u884c\u4efb\u52a1\u3002</li> </ul>"},{"location":"010Java/050Pattern/#12-state","title":"12. \u72b6\u6001\u6a21\u5f0f\uff08State\uff09","text":"<ul> <li>\u5e94\u7528\u573a\u666f\uff1a\u5141\u8bb8\u5bf9\u8c61\u5728\u5176\u5185\u90e8\u72b6\u6001\u6539\u53d8\u65f6\u6539\u53d8\u5176\u884c\u4e3a\u3002</li> <li>\u793a\u4f8b\uff1a<code>View</code>\u7684\u72b6\u6001\u7ba1\u7406\uff08\u5982<code>View.Visibility</code>\uff09\u3002</li> </ul>"},{"location":"010Java/050Pattern/#13-memento","title":"13. \u5907\u5fd8\u5f55\u6a21\u5f0f\uff08Memento\uff09","text":"<ul> <li>\u5e94\u7528\u573a\u666f\uff1a\u5728\u4e0d\u7834\u574f\u5c01\u88c5\u6027\u7684\u524d\u63d0\u4e0b\uff0c\u6355\u83b7\u5e76\u5916\u90e8\u5316\u4e00\u4e2a\u5bf9\u8c61\u7684\u5185\u90e8\u72b6\u6001\u3002</li> <li>\u793a\u4f8b\uff1a<code>Activity</code>\u7684\u72b6\u6001\u4fdd\u5b58\u4e0e\u6062\u590d\uff08<code>onSaveInstanceState</code>\u548c<code>onRestoreInstanceState</code>\uff09\u3002</li> </ul>"},{"location":"010Java/050Pattern/#14-iterator","title":"14. \u8fed\u4ee3\u5668\u6a21\u5f0f\uff08Iterator\uff09","text":"<ul> <li>\u5e94\u7528\u573a\u666f\uff1a\u63d0\u4f9b\u4e00\u79cd\u65b9\u6cd5\u987a\u5e8f\u8bbf\u95ee\u4e00\u4e2a\u805a\u5408\u5bf9\u8c61\u4e2d\u7684\u5404\u4e2a\u5143\u7d20\uff0c\u800c\u53c8\u4e0d\u66b4\u9732\u5176\u5185\u90e8\u8868\u793a\u3002</li> <li>\u793a\u4f8b\uff1a<code>Cursor</code>\u7528\u4e8e\u904d\u5386\u6570\u636e\u5e93\u67e5\u8be2\u7ed3\u679c\u3002</li> </ul>"},{"location":"010Java/050Pattern/#15-facade","title":"15. \u5916\u89c2\u6a21\u5f0f\uff08Facade\uff09","text":"<ul> <li>\u5e94\u7528\u573a\u666f\uff1a\u4e3a\u5b50\u7cfb\u7edf\u4e2d\u7684\u4e00\u7ec4\u63a5\u53e3\u63d0\u4f9b\u4e00\u4e2a\u7edf\u4e00\u7684\u63a5\u53e3\u3002</li> <li>\u793a\u4f8b\uff1a<code>Context</code>\u5c01\u88c5\u4e86\u8bbf\u95ee\u7cfb\u7edf\u8d44\u6e90\u7684\u63a5\u53e3\u3002</li> </ul> <p>\u8fd9\u4e9b\u8bbe\u8ba1\u6a21\u5f0f\u5728Android\u6e90\u7801\u4e2d\u5e7f\u6cdb\u5e94\u7528\uff0c\u5e2e\u52a9\u5f00\u53d1\u8005\u6784\u5efa\u7075\u6d3b\u3001\u53ef\u7ef4\u62a4\u7684\u7cfb\u7edf\u67b6\u6784\u3002</p>"},{"location":"010Java/050Pattern/#_8","title":"Java\u8bbe\u8ba1\u6a21\u5f0f","text":"\u7b54\u6848"},{"location":"020Kotlin/010Basic/","title":"Kotlin\u57fa\u7840","text":""},{"location":"020Kotlin/010Basic/#javakotlinkotlin","title":"Java\u548cKotlin\u6709\u54ea\u4e9b\u533a\u522b\uff0cKotlin\u6709\u54ea\u4e9b\u4f18\u52bf\uff1f","text":"\u7b54\u6848 <p>\u5728Android\u5f00\u53d1\u4e2d\uff0cJava\u548cKotlin\u662f\u4e24\u79cd\u4e3b\u8981\u7f16\u7a0b\u8bed\u8a00\uff0c\u5b83\u4eec\u6709\u4ee5\u4e0b\u533a\u522b\u548cKotlin\u7684\u4f18\u52bf\uff1a</p>"},{"location":"020Kotlin/010Basic/#1","title":"1. \u7a7a\u5b89\u5168","text":"<ul> <li>Kotlin\uff1a\u5f15\u5165\u4e86\u53ef\u7a7a\u548c\u4e0d\u53ef\u7a7a\u7c7b\u578b\uff0c\u6709\u6548\u51cf\u5c11\u7a7a\u6307\u9488\u5f02\u5e38\uff08<code>NullPointerException</code>\uff09\u3002</li> <li>Java\uff1a\u7f3a\u4e4f\u5185\u7f6e\u7684\u7a7a\u5b89\u5168\u673a\u5236\uff0c\u9700\u624b\u52a8\u68c0\u67e5\u7a7a\u503c\u3002</li> </ul>"},{"location":"020Kotlin/010Basic/#2","title":"2. \u8bed\u6cd5\u7b80\u6d01","text":"<ul> <li>Kotlin\uff1a\u8bed\u6cd5\u66f4\u7b80\u6d01\uff0c\u51cf\u5c11\u4e86\u6837\u677f\u4ee3\u7801\u3002\u4f8b\u5982\uff0c\u6570\u636e\u7c7b\u53ea\u9700\u4e00\u884c\u4ee3\u7801\u3002</li> <li>Java\uff1a\u4ee3\u7801\u5197\u957f\uff0c\u5c24\u5176\u5728\u5904\u7406\u7b80\u5355\u4efb\u52a1\u65f6\u3002</li> </ul>"},{"location":"020Kotlin/010Basic/#3","title":"3. \u51fd\u6570\u5f0f\u7f16\u7a0b","text":"<ul> <li>Kotlin\uff1a\u652f\u6301\u9ad8\u9636\u51fd\u6570\u3001Lambda\u8868\u8fbe\u5f0f\u7b49\u51fd\u6570\u5f0f\u7f16\u7a0b\u7279\u6027\u3002</li> <li>Java\uff1a\u76f4\u5230Java 8\u624d\u5f15\u5165Lambda\u8868\u8fbe\u5f0f\uff0c\u4e14\u51fd\u6570\u5f0f\u7f16\u7a0b\u652f\u6301\u4e0d\u5982Kotlin\u3002</li> </ul>"},{"location":"020Kotlin/010Basic/#4","title":"4. \u6269\u5c55\u51fd\u6570","text":"<ul> <li>Kotlin\uff1a\u5141\u8bb8\u5728\u4e0d\u4fee\u6539\u7c7b\u7684\u60c5\u51b5\u4e0b\u6269\u5c55\u5176\u529f\u80fd\u3002</li> <li>Java\uff1a\u9700\u901a\u8fc7\u7ee7\u627f\u6216\u5de5\u5177\u7c7b\u5b9e\u73b0\u7c7b\u4f3c\u529f\u80fd\u3002</li> </ul>"},{"location":"020Kotlin/010Basic/#5","title":"5. \u534f\u7a0b","text":"<ul> <li>Kotlin\uff1a\u5185\u7f6e\u534f\u7a0b\u652f\u6301\uff0c\u7b80\u5316\u5f02\u6b65\u7f16\u7a0b\u3002</li> <li>Java\uff1a\u4f9d\u8d56\u7ebf\u7a0b\u548c<code>Future</code>\u7b49\u673a\u5236\uff0c\u4ee3\u7801\u590d\u6742\u3002</li> </ul>"},{"location":"020Kotlin/010Basic/#6","title":"6. \u4e92\u64cd\u4f5c\u6027","text":"<ul> <li>Kotlin\uff1a\u4e0eJava\u5b8c\u5168\u517c\u5bb9\uff0c\u53ef\u5728\u540c\u4e00\u9879\u76ee\u4e2d\u6df7\u7528\u3002</li> <li>Java\uff1a\u65e0\u6cd5\u76f4\u63a5\u8c03\u7528Kotlin\u7684\u67d0\u4e9b\u7279\u6027\u3002</li> </ul>"},{"location":"020Kotlin/010Basic/#7","title":"7. \u9ed8\u8ba4\u53c2\u6570\u548c\u547d\u540d\u53c2\u6570","text":"<ul> <li>Kotlin\uff1a\u652f\u6301\u9ed8\u8ba4\u53c2\u6570\u548c\u547d\u540d\u53c2\u6570\uff0c\u51cf\u5c11\u91cd\u8f7d\u65b9\u6cd5\u3002</li> <li>Java\uff1a\u4e0d\u652f\u6301\uff0c\u9700\u901a\u8fc7\u65b9\u6cd5\u91cd\u8f7d\u5b9e\u73b0\u7c7b\u4f3c\u529f\u80fd\u3002</li> </ul>"},{"location":"020Kotlin/010Basic/#8","title":"8. \u7c7b\u578b\u63a8\u65ad","text":"<ul> <li>Kotlin\uff1a\u652f\u6301\u7c7b\u578b\u63a8\u65ad\uff0c\u51cf\u5c11\u663e\u5f0f\u7c7b\u578b\u58f0\u660e\u3002</li> <li>Java\uff1a\u7c7b\u578b\u63a8\u65ad\u80fd\u529b\u8f83\u5f31\uff0c\u5c24\u5176\u5728\u6cdb\u578b\u4e2d\u3002</li> </ul>"},{"location":"020Kotlin/010Basic/#9","title":"9. \u6570\u636e\u7c7b","text":"<ul> <li>Kotlin\uff1a\u6570\u636e\u7c7b\u81ea\u52a8\u751f\u6210<code>toString()</code>\u3001<code>equals()</code>\u3001<code>hashCode()</code>\u7b49\u65b9\u6cd5\u3002</li> <li>Java\uff1a\u9700\u624b\u52a8\u5b9e\u73b0\u8fd9\u4e9b\u65b9\u6cd5\u6216\u4f7f\u7528Lombok\u7b49\u5de5\u5177\u3002</li> </ul>"},{"location":"020Kotlin/010Basic/#10","title":"10. \u793e\u533a\u548c\u5de5\u5177\u652f\u6301","text":"<ul> <li>Kotlin\uff1aGoogle\u5b98\u65b9\u63a8\u8350\uff0cAndroid Studio\u63d0\u4f9b\u826f\u597d\u652f\u6301\u3002</li> <li>Java\uff1a\u957f\u671f\u4f5c\u4e3aAndroid\u5f00\u53d1\u4e3b\u6d41\u8bed\u8a00\uff0c\u5de5\u5177\u652f\u6301\u6210\u719f\u3002</li> </ul>"},{"location":"020Kotlin/010Basic/#kotlin_1","title":"Kotlin\u7684\u4f18\u52bf\u603b\u7ed3","text":"<ol> <li>\u7a7a\u5b89\u5168\uff1a\u51cf\u5c11\u7a7a\u6307\u9488\u5f02\u5e38\u3002</li> <li>\u7b80\u6d01\u8bed\u6cd5\uff1a\u51cf\u5c11\u6837\u677f\u4ee3\u7801\u3002</li> <li>\u51fd\u6570\u5f0f\u7f16\u7a0b\uff1a\u7b80\u5316\u4ee3\u7801\uff0c\u63d0\u5347\u53ef\u8bfb\u6027\u3002</li> <li>\u6269\u5c55\u51fd\u6570\uff1a\u589e\u5f3a\u4ee3\u7801\u7075\u6d3b\u6027\u3002</li> <li>\u534f\u7a0b\uff1a\u7b80\u5316\u5f02\u6b65\u7f16\u7a0b\u3002</li> <li>\u4e92\u64cd\u4f5c\u6027\uff1a\u4e0eJava\u65e0\u7f1d\u96c6\u6210\u3002</li> <li>\u9ed8\u8ba4\u53c2\u6570\u548c\u547d\u540d\u53c2\u6570\uff1a\u51cf\u5c11\u65b9\u6cd5\u91cd\u8f7d\u3002</li> <li>\u7c7b\u578b\u63a8\u65ad\uff1a\u51cf\u5c11\u663e\u5f0f\u7c7b\u578b\u58f0\u660e\u3002</li> <li>\u6570\u636e\u7c7b\uff1a\u81ea\u52a8\u751f\u6210\u5e38\u7528\u65b9\u6cd5\u3002</li> <li>\u5b98\u65b9\u652f\u6301\uff1aGoogle\u63a8\u8350\uff0c\u5de5\u5177\u652f\u6301\u5b8c\u5584\u3002</li> </ol> <p>\u56e0\u6b64\uff0cKotlin\u5728Android\u5f00\u53d1\u4e2d\u66f4\u5177\u4f18\u52bf\uff0c\u9010\u6e10\u6210\u4e3a\u9996\u9009\u8bed\u8a00\u3002</p>"},{"location":"020Kotlin/010Basic/#androidkotlin","title":"\u5728Android\u5e73\u53f0\u4e0a\u4f7f\u7528Kotlin\u7684\u65f6\u5019\u6709\u54ea\u4e9b\u6280\u5de7\uff0c\u53ef\u4ee5\u63d0\u9ad8\u5f00\u53d1\u6548\u7387\uff1f","text":"\u7b54\u6848 <p>\u5728Android\u5e73\u53f0\u4e0a\uff0cKotlin\u63d0\u4f9b\u4e86\u8bb8\u591a\u7279\u6027\u6765\u63d0\u5347\u7f16\u7801\u6548\u7387\u3002\u4ee5\u4e0b\u662f\u4e00\u4e9b\u5b9e\u7528\u7684\u6280\u5de7\u548c\u5efa\u8bae\uff1a</p>"},{"location":"020Kotlin/010Basic/#1-letapplyalsorunwith","title":"1. \u4f7f\u7528<code>let</code>\u3001<code>apply</code>\u3001<code>also</code>\u3001<code>run</code>\u3001<code>with</code>\u7b49\u4f5c\u7528\u57df\u51fd\u6570","text":"<ul> <li><code>let</code>\uff1a\u5728\u975e\u7a7a\u5bf9\u8c61\u4e0a\u6267\u884c\u64cd\u4f5c\uff0c\u907f\u514d\u7a7a\u6307\u9488\u3002     <pre><code>user?.let {\n    println(it.name)\n}\n</code></pre></li> <li><code>apply</code>\uff1a\u5728\u5bf9\u8c61\u521d\u59cb\u5316\u65f6\u914d\u7f6e\u5c5e\u6027\u3002     <pre><code>val user = User().apply {\n    name = \"John\"\n    age = 30\n}\n</code></pre></li> <li><code>also</code>\uff1a\u5728\u5bf9\u8c61\u4e0a\u6267\u884c\u989d\u5916\u64cd\u4f5c\u3002     <pre><code>val user = User().also {\n    println(\"User created: $it\")\n}\n</code></pre></li> <li><code>run</code>\uff1a\u5728\u5bf9\u8c61\u4e0a\u6267\u884c\u64cd\u4f5c\u5e76\u8fd4\u56de\u7ed3\u679c\u3002     <pre><code>val result = user.run {\n    name = \"Jane\"\n    age = 25\n    \"User updated\"\n}\n</code></pre></li> <li><code>with</code>\uff1a\u5728\u5bf9\u8c61\u4e0a\u6267\u884c\u591a\u4e2a\u64cd\u4f5c\u3002     <pre><code>with(user) {\n    name = \"Alice\"\n    age = 28\n}\n</code></pre></li> </ul>"},{"location":"020Kotlin/010Basic/#2-data-class","title":"2. \u4f7f\u7528\u6570\u636e\u7c7b\uff08Data Class\uff09","text":"<ul> <li>\u6570\u636e\u7c7b\u81ea\u52a8\u751f\u6210<code>toString()</code>\u3001<code>equals()</code>\u3001<code>hashCode()</code>\u7b49\u65b9\u6cd5\uff0c\u51cf\u5c11\u6837\u677f\u4ee3\u7801\u3002     <pre><code>data class User(val name: String, val age: Int)\n</code></pre></li> </ul>"},{"location":"020Kotlin/010Basic/#3_1","title":"3. \u4f7f\u7528\u6269\u5c55\u51fd\u6570","text":"<ul> <li>\u6269\u5c55\u51fd\u6570\u5141\u8bb8\u5728\u4e0d\u4fee\u6539\u7c7b\u7684\u60c5\u51b5\u4e0b\u6dfb\u52a0\u65b0\u529f\u80fd\u3002     <pre><code>fun String.isEmailValid(): Boolean {\n    return Patterns.EMAIL_ADDRESS.matcher(this).matches()\n}\n</code></pre></li> </ul>"},{"location":"020Kotlin/010Basic/#4_1","title":"4. \u4f7f\u7528\u9ed8\u8ba4\u53c2\u6570\u548c\u547d\u540d\u53c2\u6570","text":"<ul> <li>\u9ed8\u8ba4\u53c2\u6570\u51cf\u5c11\u65b9\u6cd5\u91cd\u8f7d\uff0c\u547d\u540d\u53c2\u6570\u63d0\u9ad8\u4ee3\u7801\u53ef\u8bfb\u6027\u3002     <pre><code>fun createUser(name: String, age: Int = 18, email: String = \"\") {\n    // ...\n}\ncreateUser(\"John\", email = \"john@example.com\")\n</code></pre></li> </ul>"},{"location":"020Kotlin/010Basic/#5-coroutines","title":"5. \u4f7f\u7528\u534f\u7a0b\uff08Coroutines\uff09\u5904\u7406\u5f02\u6b65\u4efb\u52a1","text":"<ul> <li>\u534f\u7a0b\u7b80\u5316\u5f02\u6b65\u7f16\u7a0b\uff0c\u907f\u514d\u56de\u8c03\u5730\u72f1\u3002     <pre><code>lifecycleScope.launch {\n    val result = withContext(Dispatchers.IO) {\n        // \u6267\u884c\u8017\u65f6\u64cd\u4f5c\n    }\n    // \u66f4\u65b0UI\n}\n</code></pre></li> </ul>"},{"location":"020Kotlin/010Basic/#6-when","title":"6. \u4f7f\u7528<code>when</code>\u8868\u8fbe\u5f0f","text":"<ul> <li><code>when</code>\u8868\u8fbe\u5f0f\u6bd4<code>switch</code>\u66f4\u5f3a\u5927\uff0c\u652f\u6301\u591a\u79cd\u6761\u4ef6\u5224\u65ad\u3002     <pre><code>when (user.age) {\n    in 0..17 -&gt; println(\"Underage\")\n    18 -&gt; println(\"Just became an adult\")\n    else -&gt; println(\"Adult\")\n}\n</code></pre></li> </ul>"},{"location":"020Kotlin/010Basic/#7_1","title":"7. \u4f7f\u7528\u96c6\u5408\u64cd\u4f5c\u7b26","text":"<ul> <li>Kotlin\u63d0\u4f9b\u4e86\u4e30\u5bcc\u7684\u96c6\u5408\u64cd\u4f5c\u7b26\uff0c\u5982<code>map</code>\u3001<code>filter</code>\u3001<code>reduce</code>\u7b49\uff0c\u7b80\u5316\u96c6\u5408\u64cd\u4f5c\u3002     <pre><code>val names = users.map { it.name }\nval adults = users.filter { it.age &gt;= 18 }\n</code></pre></li> </ul>"},{"location":"020Kotlin/010Basic/#8-lateinitby-lazy","title":"8. \u4f7f\u7528<code>lateinit</code>\u548c<code>by lazy</code>","text":"<ul> <li><code>lateinit</code>\uff1a\u5ef6\u8fdf\u521d\u59cb\u5316\u975e\u7a7a\u5c5e\u6027\u3002     <pre><code>lateinit var user: User\n</code></pre></li> <li><code>by lazy</code>\uff1a\u5ef6\u8fdf\u521d\u59cb\u5316\u53ea\u8bfb\u5c5e\u6027\u3002     <pre><code>val user: User by lazy {\n    User(\"John\", 30)\n}\n</code></pre></li> </ul>"},{"location":"020Kotlin/010Basic/#9-sealed-class","title":"9. \u4f7f\u7528<code>sealed class</code>","text":"<ul> <li><code>sealed class</code>\u7528\u4e8e\u8868\u793a\u53d7\u9650\u7684\u7c7b\u5c42\u6b21\u7ed3\u6784\uff0c\u5e38\u7528\u4e8e\u72b6\u6001\u7ba1\u7406\u3002     <pre><code>sealed class Result {\n    data class Success(val data: String) : Result()\n    data class Error(val message: String) : Result()\n}\n</code></pre></li> </ul>"},{"location":"020Kotlin/010Basic/#10-typealias","title":"10. \u4f7f\u7528<code>typealias</code>","text":"<ul> <li><code>typealias</code>\u53ef\u4ee5\u4e3a\u590d\u6742\u7c7b\u578b\u5b9a\u4e49\u522b\u540d\uff0c\u63d0\u9ad8\u4ee3\u7801\u53ef\u8bfb\u6027\u3002     <pre><code>typealias UserList = List&lt;User&gt;\n</code></pre></li> </ul>"},{"location":"020Kotlin/010Basic/#11-jvmoverloads","title":"11. \u4f7f\u7528<code>@JvmOverloads</code>","text":"<ul> <li><code>@JvmOverloads</code>\u751f\u6210\u591a\u4e2a\u91cd\u8f7d\u65b9\u6cd5\uff0c\u65b9\u4fbfJava\u8c03\u7528\u3002     <pre><code>@JvmOverloads\nfun createUser(name: String, age: Int = 18, email: String = \"\") {\n    // ...\n}\n</code></pre></li> </ul>"},{"location":"020Kotlin/010Basic/#12-inline","title":"12. \u4f7f\u7528<code>inline</code>\u51fd\u6570","text":"<ul> <li><code>inline</code>\u51fd\u6570\u51cf\u5c11\u9ad8\u9636\u51fd\u6570\u7684\u8fd0\u884c\u65f6\u5f00\u9500\u3002     <pre><code>inline fun &lt;T&gt; measureTimeMillis(block: () -&gt; T): T {\n    val start = System.currentTimeMillis()\n    val result = block()\n    println(\"Time taken: ${System.currentTimeMillis() - start} ms\")\n    return result\n}\n</code></pre></li> </ul>"},{"location":"020Kotlin/010Basic/#13-reified","title":"13. \u4f7f\u7528<code>reified</code>\u7c7b\u578b\u53c2\u6570","text":"<ul> <li><code>reified</code>\u7c7b\u578b\u53c2\u6570\u5141\u8bb8\u5728\u6cdb\u578b\u51fd\u6570\u4e2d\u8bbf\u95ee\u7c7b\u578b\u4fe1\u606f\u3002     <pre><code>inline fun &lt;reified T&gt; parseJson(json: String): T {\n    return Gson().fromJson(json, T::class.java)\n}\n</code></pre></li> </ul>"},{"location":"020Kotlin/010Basic/#14-parcelize","title":"14. \u4f7f\u7528<code>@Parcelize</code>","text":"<ul> <li><code>@Parcelize</code>\u81ea\u52a8\u751f\u6210<code>Parcelable</code>\u5b9e\u73b0\u4ee3\u7801\u3002     <pre><code>@Parcelize\ndata class User(val name: String, val age: Int) : Parcelable\n</code></pre></li> </ul>"},{"location":"020Kotlin/010Basic/#15-jvmstaticjvmfield","title":"15. \u4f7f\u7528<code>@JvmStatic</code>\u548c<code>@JvmField</code>","text":"<ul> <li><code>@JvmStatic</code>\u548c<code>@JvmField</code>\u4f18\u5316\u4e0eJava\u7684\u4e92\u64cd\u4f5c\u6027\u3002     <pre><code>companion object {\n    @JvmStatic\n    fun create() = User(\"John\", 30)\n\n    @JvmField\n    val DEFAULT_USER = User(\"Default\", 0)\n}\n</code></pre></li> </ul> <p>\u901a\u8fc7\u5408\u7406\u8fd0\u7528\u8fd9\u4e9b\u6280\u5de7\uff0c\u53ef\u4ee5\u663e\u8457\u63d0\u5347Kotlin\u5728Android\u5f00\u53d1\u4e2d\u7684\u7f16\u7801\u6548\u7387\u3002</p>"},{"location":"020Kotlin/010Basic/#data","title":"data \u7c7b\u5230\u5e95\u751f\u6210\u4e86\u54ea\u4e9b\u65b9\u6cd5\uff1f","text":"\u7b54\u6848 <p>\u5728 Kotlin \u4e2d\uff0c<code>data</code> \u7c7b\u4f1a\u81ea\u52a8\u751f\u6210\u4ee5\u4e0b\u65b9\u6cd5\uff1a</p> <ol> <li><code>equals()</code> / <code>hashCode()</code></li> <li> <p>\u4f5c\u7528: \u7528\u4e8e\u6bd4\u8f83\u4e24\u4e2a\u5bf9\u8c61\u7684\u76f8\u7b49\u6027\u3002<code>equals()</code> \u6bd4\u8f83\u5bf9\u8c61\u5185\u5bb9\u662f\u5426\u76f8\u540c\uff0c<code>hashCode()</code> \u8fd4\u56de\u5bf9\u8c61\u7684\u54c8\u5e0c\u7801\uff0c\u786e\u4fdd\u76f8\u7b49\u7684\u5bf9\u8c61\u6709\u76f8\u540c\u7684\u54c8\u5e0c\u7801\u3002</p> </li> <li> <p><code>toString()</code></p> </li> <li> <p>\u4f5c\u7528: \u8fd4\u56de\u5bf9\u8c61\u7684\u5b57\u7b26\u4e32\u8868\u793a\uff0c\u683c\u5f0f\u4e3a <code>\"ClassName(property1=value1, property2=value2, ...)\"</code>\uff0c\u4fbf\u4e8e\u8c03\u8bd5\u548c\u65e5\u5fd7\u8bb0\u5f55\u3002</p> </li> <li> <p><code>componentN()</code> \u51fd\u6570</p> </li> <li> <p>\u4f5c\u7528: \u6309\u58f0\u660e\u987a\u5e8f\u4e3a\u6bcf\u4e2a\u5c5e\u6027\u751f\u6210\u89e3\u6784\u58f0\u660e\u51fd\u6570\uff0c\u5982 <code>component1()</code> \u8fd4\u56de\u7b2c\u4e00\u4e2a\u5c5e\u6027\uff0c<code>component2()</code> \u8fd4\u56de\u7b2c\u4e8c\u4e2a\u5c5e\u6027\uff0c\u4f9d\u6b64\u7c7b\u63a8\u3002</p> </li> <li> <p><code>copy()</code></p> </li> <li>\u4f5c\u7528: \u751f\u6210\u4e00\u4e2a\u5bf9\u8c61\u7684\u526f\u672c\uff0c\u5141\u8bb8\u4fee\u6539\u90e8\u5206\u5c5e\u6027\u3002\u4f8b\u5982\uff0c<code>data class User(val name: String, val age: Int)</code> \u7684 <code>copy()</code> \u53ef\u4ee5\u8fd9\u6837\u4f7f\u7528\uff1a<code>user.copy(age = 30)</code>\u3002</li> </ol>"},{"location":"020Kotlin/010Basic/#_1","title":"\u793a\u4f8b","text":"<pre><code>data class User(val name: String, val age: Int)\n\nfun main() {\n    val user1 = User(\"Alice\", 25)\n    val user2 = User(\"Alice\", 25)\n\n    println(user1 == user2) // true, \u4f7f\u7528 equals()\n    println(user1.hashCode()) // \u54c8\u5e0c\u7801\n    println(user1.toString()) // \"User(name=Alice, age=25)\"\n\n    val (name, age) = user1 // \u89e3\u6784\u58f0\u660e\n    println(\"$name, $age\") // \"Alice, 25\"\n\n    val user3 = user1.copy(age = 30) // \u590d\u5236\u5e76\u4fee\u6539 age\n    println(user3) // \"User(name=Alice, age=30)\"\n}\n</code></pre>"},{"location":"020Kotlin/010Basic/#_2","title":"\u603b\u7ed3","text":"<p><code>data</code> \u7c7b\u81ea\u52a8\u751f\u6210\u7684\u65b9\u6cd5\u7b80\u5316\u4e86\u5bf9\u8c61\u7684\u6bd4\u8f83\u3001\u5b57\u7b26\u4e32\u8868\u793a\u3001\u89e3\u6784\u548c\u590d\u5236\u64cd\u4f5c\uff0c\u63d0\u5347\u4e86\u4ee3\u7801\u7684\u7b80\u6d01\u6027\u548c\u53ef\u8bfb\u6027\u3002</p>"},{"location":"020Kotlin/010Basic/#kotlin_2","title":"Kotlin !! \u548c ? \u7684\u533a\u522b?","text":"\u7b54\u6848 <p>\u5728 Kotlin \u4e2d\uff0c<code>!!</code> \u548c <code>?</code> \u662f\u7528\u4e8e\u5904\u7406\u53ef\u7a7a\u7c7b\u578b\u7684\u64cd\u4f5c\u7b26\uff0c\u5b83\u4eec\u7684\u4e3b\u8981\u533a\u522b\u5982\u4e0b\uff1a</p>"},{"location":"020Kotlin/010Basic/#1_1","title":"1. <code>?</code> \u64cd\u4f5c\u7b26","text":"<ul> <li>\u53ef\u7a7a\u7c7b\u578b\u58f0\u660e\uff1a\u7528\u4e8e\u58f0\u660e\u4e00\u4e2a\u53d8\u91cf\u53ef\u4ee5\u4e3a <code>null</code>\u3002 <pre><code>var name: String? = null\n</code></pre></li> <li>\u5b89\u5168\u8c03\u7528\uff1a\u5728\u8bbf\u95ee\u53ef\u80fd\u4e3a <code>null</code> \u7684\u5bf9\u8c61\u65f6\uff0c\u4f7f\u7528 <code>?.</code> \u53ef\u4ee5\u907f\u514d <code>NullPointerException</code>\u3002\u5982\u679c\u5bf9\u8c61\u4e3a <code>null</code>\uff0c\u8868\u8fbe\u5f0f\u4f1a\u8fd4\u56de <code>null</code> \u800c\u4e0d\u662f\u629b\u51fa\u5f02\u5e38\u3002 <pre><code>val length = name?.length  // \u5982\u679c name \u4e3a null\uff0clength \u4e5f\u4e3a null\n</code></pre></li> <li>Elvis \u64cd\u4f5c\u7b26\uff1a<code>?:</code> \u7528\u4e8e\u63d0\u4f9b\u9ed8\u8ba4\u503c\uff0c\u5f53\u5de6\u4fa7\u8868\u8fbe\u5f0f\u4e3a <code>null</code> \u65f6\uff0c\u8fd4\u56de\u53f3\u4fa7\u7684\u503c\u3002 <pre><code>val length = name?.length ?: 0  // \u5982\u679c name \u4e3a null\uff0clength \u4e3a 0\n</code></pre></li> </ul>"},{"location":"020Kotlin/010Basic/#2_1","title":"2. <code>!!</code> \u64cd\u4f5c\u7b26","text":"<ul> <li>\u975e\u7a7a\u65ad\u8a00\uff1a\u7528\u4e8e\u5c06\u53ef\u7a7a\u7c7b\u578b\u5f3a\u5236\u8f6c\u6362\u4e3a\u975e\u7a7a\u7c7b\u578b\u3002\u5982\u679c\u5bf9\u8c61\u4e3a <code>null</code>\uff0c\u4f1a\u629b\u51fa <code>NullPointerException</code>\u3002 <pre><code>val length = name!!.length  // \u5982\u679c name \u4e3a null\uff0c\u629b\u51fa NullPointerException\n</code></pre></li> </ul>"},{"location":"020Kotlin/010Basic/#_3","title":"\u603b\u7ed3","text":"<ul> <li><code>?</code>\uff1a\u7528\u4e8e\u5b89\u5168\u5904\u7406\u53ef\u7a7a\u7c7b\u578b\uff0c\u907f\u514d <code>NullPointerException</code>\u3002</li> <li><code>!!</code>\uff1a\u7528\u4e8e\u65ad\u8a00\u975e\u7a7a\uff0c\u5982\u679c\u4e3a <code>null</code> \u5219\u629b\u51fa\u5f02\u5e38\u3002</li> </ul>"},{"location":"020Kotlin/010Basic/#_4","title":"\u793a\u4f8b","text":"<pre><code>fun main() {\n    var name: String? = \"Kotlin\"\n\n    // \u5b89\u5168\u8c03\u7528\n    println(name?.length)  // \u8f93\u51fa: 6\n\n    name = null\n\n    // \u5b89\u5168\u8c03\u7528\u8fd4\u56de null\n    println(name?.length)  // \u8f93\u51fa: null\n\n    // Elvis \u64cd\u4f5c\u7b26\u63d0\u4f9b\u9ed8\u8ba4\u503c\n    println(name?.length ?: 0)  // \u8f93\u51fa: 0\n\n    // \u975e\u7a7a\u65ad\u8a00\uff0c\u629b\u51fa NullPointerException\n    println(name!!.length)  // \u629b\u51fa\u5f02\u5e38\n}\n</code></pre>"},{"location":"020Kotlin/010Basic/#_5","title":"\u4f7f\u7528\u5efa\u8bae","text":"<ul> <li>\u4f18\u5148\u4f7f\u7528 <code>?</code> \u8fdb\u884c\u5b89\u5168\u8c03\u7528\uff0c\u907f\u514d\u6f5c\u5728\u7684 <code>NullPointerException</code>\u3002</li> <li>\u4ec5\u5728\u786e\u4fdd\u53d8\u91cf\u4e0d\u4e3a <code>null</code> \u65f6\u4f7f\u7528 <code>!!</code>\uff0c\u5426\u5219\u53ef\u80fd\u5bfc\u81f4\u8fd0\u884c\u65f6\u5f02\u5e38\u3002</li> </ul>"},{"location":"020Kotlin/010Basic/#_6","title":"\u57df\u51fd\u6570\u4f7f\u7528\u5f97\u591a\u5417\uff0c\u6709\u54ea\u4e9b\u57df\u51fd\u6570\uff0c\u5206\u522b\u6709\u4ec0\u4e48\u533a\u522b\uff0c\u5728\u4ec0\u4e48\u5730\u65b9\u4f7f\u7528","text":"\u7b54\u6848"},{"location":"020Kotlin/010Basic/#kotlin_3","title":"Kotlin \u57df\u51fd\u6570\u539f\u7406\u5206\u6790\uff08\u4ece\u6e90\u7801\u89d2\u5ea6\uff09","text":"<p>Kotlin \u7684\u57df\u51fd\u6570\uff08Scope Functions\uff09\u5305\u62ec <code>let</code>\u3001<code>run</code>\u3001<code>with</code>\u3001<code>apply</code> \u548c <code>also</code>\uff0c\u5b83\u4eec\u90fd\u662f\u901a\u8fc7\u6269\u5c55\u51fd\u6570\u6216\u5185\u8054\u51fd\u6570\u5b9e\u73b0\u7684\u3002\u4e0b\u9762\u6211\u4ece\u6e90\u7801\u89d2\u5ea6\u5206\u6790\u5b83\u4eec\u7684\u5b9e\u73b0\u539f\u7406\u3002</p>"},{"location":"020Kotlin/010Basic/#1_2","title":"1. \u57fa\u672c\u5b9e\u73b0\u65b9\u5f0f","text":"<p>\u6240\u6709\u57df\u51fd\u6570\u90fd\u5b9a\u4e49\u5728 <code>Standard.kt</code> \u6587\u4ef6\u4e2d\uff08\u4f4d\u4e8e kotlin-stdlib \u4e2d\uff09\u3002\u5b83\u4eec\u7684\u4e3b\u8981\u7279\u70b9\uff1a</p> <ol> <li>\u90fd\u662f\u6269\u5c55\u51fd\u6570\uff08\u9664\u4e86 <code>with</code>\uff09</li> <li>\u5927\u591a\u6570\u4f7f\u7528 <code>inline</code> \u4fee\u9970\u7b26</li> <li>\u901a\u8fc7 lambda \u8868\u8fbe\u5f0f\u63a5\u6536\u5668\u6216\u53c2\u6570\u6765\u6539\u53d8\u4f5c\u7528\u57df</li> </ol>"},{"location":"020Kotlin/010Basic/#2_2","title":"2. \u5404\u51fd\u6570\u6e90\u7801\u5206\u6790","text":""},{"location":"020Kotlin/010Basic/#21-let","title":"2.1 let \u51fd\u6570","text":"<pre><code>@kotlin.internal.InlineOnly\npublic inline fun &lt;T, R&gt; T.let(block: (T) -&gt; R): R {\n    contract {\n        callsInPlace(block, InvocationKind.EXACTLY_ONCE)\n    }\n    return block(this)\n}\n</code></pre> <ul> <li>\u539f\u7406\uff1a\u63a5\u6536\u4e00\u4e2a\u5c06 <code>T</code> \u8f6c\u6362\u4e3a <code>R</code> \u7684\u51fd\u6570\uff0c\u5e76\u8fd4\u56de\u8be5\u51fd\u6570\u7684\u6267\u884c\u7ed3\u679c</li> <li>\u7279\u70b9\uff1a</li> <li><code>this</code> \u4f5c\u4e3a\u53c2\u6570\u4f20\u5165 lambda</li> <li>\u8fd4\u56de lambda \u7684\u7ed3\u679c</li> <li>\u4f7f\u7528 <code>@InlineOnly</code> \u548c\u5185\u8054\u4f18\u5316</li> </ul>"},{"location":"020Kotlin/010Basic/#22-run","title":"2.2 run \u51fd\u6570\uff08\u6269\u5c55\u51fd\u6570\u7248\u672c\uff09","text":"<pre><code>@kotlin.internal.InlineOnly\npublic inline fun &lt;T, R&gt; T.run(block: T.() -&gt; R): R {\n    contract {\n        callsInPlace(block, InvocationKind.EXACTLY_ONCE)\n    }\n    return block()\n}\n</code></pre> <ul> <li>\u539f\u7406\uff1a\u5728 <code>T</code> \u7684\u4e0a\u4e0b\u6587\u4e2d\u6267\u884c lambda\uff0c\u8fd4\u56de lambda \u7ed3\u679c</li> <li>\u7279\u70b9\uff1a</li> <li>lambda \u5185\u90e8 <code>this</code> \u6307\u5411\u63a5\u6536\u8005\u5bf9\u8c61</li> <li>\u8fd4\u56de lambda \u7684\u7ed3\u679c</li> </ul>"},{"location":"020Kotlin/010Basic/#23-with","title":"2.3 with \u51fd\u6570","text":"<pre><code>@kotlin.internal.InlineOnly\npublic inline fun &lt;T, R&gt; with(receiver: T, block: T.() -&gt; R): R {\n    contract {\n        callsInPlace(block, InvocationKind.EXACTLY_ONCE)\n    }\n    return receiver.block()\n}\n</code></pre> <ul> <li>\u539f\u7406\uff1a\u975e\u6269\u5c55\u51fd\u6570\uff0c\u663e\u5f0f\u63a5\u6536\u5bf9\u8c61\u4f5c\u4e3a\u53c2\u6570</li> <li>\u7279\u70b9\uff1a</li> <li>\u7b2c\u4e00\u4e2a\u53c2\u6570\u662f\u63a5\u6536\u8005\u5bf9\u8c61</li> <li>\u8fd4\u56de lambda \u7684\u7ed3\u679c</li> </ul>"},{"location":"020Kotlin/010Basic/#24-apply","title":"2.4 apply \u51fd\u6570","text":"<pre><code>@kotlin.internal.InlineOnly\npublic inline fun &lt;T&gt; T.apply(block: T.() -&gt; Unit): T {\n    contract {\n        callsInPlace(block, InvocationKind.EXACTLY_ONCE)\n    }\n    block()\n    return this\n}\n</code></pre> <ul> <li>\u539f\u7406\uff1a\u5728\u5bf9\u8c61\u4e0a\u4e0b\u6587\u4e2d\u6267\u884c lambda\uff0c\u7136\u540e\u8fd4\u56de\u5bf9\u8c61\u672c\u8eab</li> <li>\u7279\u70b9\uff1a</li> <li>\u603b\u662f\u8fd4\u56de\u63a5\u6536\u8005\u5bf9\u8c61 (<code>this</code>)</li> <li>\u9002\u5408\u5bf9\u8c61\u521d\u59cb\u5316</li> </ul>"},{"location":"020Kotlin/010Basic/#25-also","title":"2.5 also \u51fd\u6570","text":"<pre><code>@kotlin.internal.InlineOnly\npublic inline fun &lt;T&gt; T.also(block: (T) -&gt; Unit): T {\n    contract {\n        callsInPlace(block, InvocationKind.EXACTLY_ONCE)\n    }\n    block(this)\n    return this\n}\n</code></pre> <ul> <li>\u539f\u7406\uff1a\u63a5\u6536 lambda \u5bf9\u5bf9\u8c61\u6267\u884c\u64cd\u4f5c\uff0c\u7136\u540e\u8fd4\u56de\u5bf9\u8c61\u672c\u8eab</li> <li>\u7279\u70b9\uff1a</li> <li>\u7c7b\u4f3c <code>apply</code>\uff0c\u4f46 lambda \u53c2\u6570\u662f <code>it</code> \u800c\u975e <code>this</code></li> <li>\u9002\u5408\u526f\u4f5c\u7528\u64cd\u4f5c</li> </ul>"},{"location":"020Kotlin/010Basic/#3_2","title":"3. \u5173\u952e\u5b9e\u73b0\u7ec6\u8282","text":"<ol> <li>\u5185\u8054\u4f18\u5316\uff1a\u6240\u6709\u51fd\u6570\u90fd\u4f7f\u7528 <code>inline</code> \u4fee\u9970\u7b26\uff0c\u907f\u514d\u4e86 lambda \u5e26\u6765\u7684\u8fd0\u884c\u65f6\u5f00\u9500</li> <li>\u7f16\u8bd1\u65f6\u4f1a\u5c06 lambda \u4f53\u76f4\u63a5\u63d2\u5165\u8c03\u7528\u5904</li> <li> <p>\u4e0d\u4f1a\u521b\u5efa\u989d\u5916\u7684\u51fd\u6570\u5bf9\u8c61</p> </li> <li> <p>\u5408\u7ea6(contract)\uff1a\u4f7f\u7528 <code>contract</code> API \u544a\u8bc9\u7f16\u8bd1\u5668\u5173\u4e8e\u51fd\u6570\u884c\u4e3a\u7684\u4fdd\u8bc1</p> </li> <li><code>callsInPlace</code> \u8868\u793a block \u53ea\u4f1a\u5728\u51fd\u6570\u5185\u90e8\u8c03\u7528\u4e00\u6b21</li> <li> <p>\u5e2e\u52a9\u7f16\u8bd1\u5668\u8fdb\u884c\u4f18\u5316\u548c\u9759\u6001\u5206\u6790</p> </li> <li> <p>\u63a5\u6536\u8005\u4e0e\u53c2\u6570\u7684\u533a\u522b\uff1a</p> </li> <li><code>T.() -&gt; R</code> \u5f62\u5f0f\uff1alambda \u5185\u90e8 <code>this</code> \u6307\u5411\u63a5\u6536\u8005</li> <li><code>(T) -&gt; R</code> \u5f62\u5f0f\uff1alambda \u5185\u90e8\u901a\u8fc7\u53c2\u6570\u8bbf\u95ee\u5bf9\u8c61</li> </ol>"},{"location":"020Kotlin/010Basic/#4_2","title":"4. \u6027\u80fd\u8003\u8651","text":"<p>\u7531\u4e8e\u8fd9\u4e9b\u51fd\u6570\u90fd\u662f\u5185\u8054\u7684\uff0c\u5728\u8fd0\u884c\u65f6\u4e0d\u4f1a\u6709\u989d\u5916\u7684\u51fd\u6570\u8c03\u7528\u5f00\u9500\u3002\u7f16\u8bd1\u540e\u7684\u4ee3\u7801\u7c7b\u4f3c\u4e8e\u76f4\u63a5\u7f16\u5199\u4e86 lambda \u4f53\u4e2d\u7684\u4ee3\u7801\u3002</p> <p>\u4f8b\u5982\uff1a <pre><code>val result = \"Hello\".let { it.length }\n</code></pre> \u7f16\u8bd1\u540e\u5927\u81f4\u76f8\u5f53\u4e8e\uff1a <pre><code>val result = \"Hello\".length\n</code></pre></p>"},{"location":"020Kotlin/010Basic/#5_1","title":"5. \u8bbe\u8ba1\u76ee\u7684","text":"<p>\u8fd9\u4e9b\u57df\u51fd\u6570\u7684\u8bbe\u8ba1\u4e3b\u8981\u662f\u4e3a\u4e86\uff1a</p> <ol> <li>\u63d0\u4f9b\u66f4\u6e05\u6670\u7684\u4ee3\u7801\u7ed3\u6784</li> <li>\u51cf\u5c11\u4e34\u65f6\u53d8\u91cf</li> <li>\u63d0\u4f9b\u94fe\u5f0f\u8c03\u7528\u80fd\u529b</li> <li>\u533a\u5206\u5bf9\u8c61\u4f5c\u4e3a\u53c2\u6570\u6216\u63a5\u6536\u8005\u7684\u4e0d\u540c\u573a\u666f</li> </ol> <p>\u901a\u8fc7\u5206\u6790\u6e90\u7801\u53ef\u4ee5\u770b\u51fa\uff0cKotlin \u6807\u51c6\u5e93\u901a\u8fc7\u7b80\u5355\u7684\u6269\u5c55\u51fd\u6570\u548c\u5185\u8054\u4f18\u5316\uff0c\u5b9e\u73b0\u4e86\u8fd9\u4e9b\u5f3a\u5927\u7684 DSL \u7279\u6027\u3002</p>"},{"location":"020Kotlin/010Basic/#kotlin_4","title":"Kotlin \u57df\u51fd\u6570\u53cd\u7f16\u8bd1\u5206\u6790","text":"<p>\u5f53\u4f60\u5c06\u4f7f\u7528 Kotlin \u57df\u51fd\u6570\u7684\u4ee3\u7801\u53cd\u7f16\u8bd1\u4e3a Java \u4ee3\u7801\u65f6\uff0c\u53ef\u4ee5\u770b\u5230\u8fd9\u4e9b\u5185\u8054\u51fd\u6570\u7684\u5b9e\u9645\u6548\u679c\u3002\u7531\u4e8e\u57df\u51fd\u6570\u90fd\u662f <code>inline</code> \u7684\uff0c\u5b83\u4eec\u5728\u53cd\u7f16\u8bd1\u540e\u7684 Java \u4ee3\u7801\u4e2d\u4e0d\u4f1a\u4fdd\u7559\u51fd\u6570\u8c03\u7528\uff0c\u800c\u662f\u76f4\u63a5\u5c55\u5f00\u4e86 lambda \u8868\u8fbe\u5f0f\u7684\u5185\u5bb9\u3002</p>"},{"location":"020Kotlin/010Basic/#1_3","title":"1. \u5404\u57df\u51fd\u6570\u53cd\u7f16\u8bd1\u6548\u679c","text":""},{"location":"020Kotlin/010Basic/#11-let","title":"1.1 <code>let</code> \u51fd\u6570\u793a\u4f8b","text":"<p>Kotlin \u4ee3\u7801: <pre><code>val length = \"Hello\".let { it.length }\n</code></pre></p> <p>\u53cd\u7f16\u8bd1\u540e\u7684 Java \u4ee3\u7801: <pre><code>String str = \"Hello\";\nint length = str.length(); // lambda \u5185\u5bb9\u76f4\u63a5\u5185\u8054\n</code></pre></p>"},{"location":"020Kotlin/010Basic/#12-run","title":"1.2 <code>run</code> \u51fd\u6570\u793a\u4f8b","text":"<p>Kotlin \u4ee3\u7801: <pre><code>val result = \"Hello\".run {\n    println(this)\n    length\n}\n</code></pre></p> <p>\u53cd\u7f16\u8bd1\u540e\u7684 Java \u4ee3\u7801: <pre><code>String str = \"Hello\";\nSystem.out.println(str);\nint result = str.length(); // lambda \u5185\u5bb9\u76f4\u63a5\u5185\u8054\n</code></pre></p>"},{"location":"020Kotlin/010Basic/#13-with","title":"1.3 <code>with</code> \u51fd\u6570\u793a\u4f8b","text":"<p>Kotlin \u4ee3\u7801: <pre><code>val sb = StringBuilder()\nval result = with(sb) {\n    append(\"Hello\")\n    append(\"World\")\n    length\n}\n</code></pre></p> <p>\u53cd\u7f16\u8bd1\u540e\u7684 Java \u4ee3\u7801: <pre><code>StringBuilder sb = new StringBuilder();\nsb.append(\"Hello\");\nsb.append(\"World\");\nint result = sb.length(); // lambda \u5185\u5bb9\u76f4\u63a5\u5185\u8054\n</code></pre></p>"},{"location":"020Kotlin/010Basic/#14-apply","title":"1.4 <code>apply</code> \u51fd\u6570\u793a\u4f8b","text":"<p>Kotlin \u4ee3\u7801: <pre><code>val sb = StringBuilder().apply {\n    append(\"Hello\")\n    append(\"World\")\n}\n</code></pre></p> <p>\u53cd\u7f16\u8bd1\u540e\u7684 Java \u4ee3\u7801: <pre><code>StringBuilder sb = new StringBuilder();\nsb.append(\"Hello\");\nsb.append(\"World\");\n// apply \u8fd4\u56de\u5bf9\u8c61\u672c\u8eab\uff0c\u6240\u4ee5\u4e0d\u9700\u8981\u989d\u5916\u8d4b\u503c\n</code></pre></p>"},{"location":"020Kotlin/010Basic/#15-also","title":"1.5 <code>also</code> \u51fd\u6570\u793a\u4f8b","text":"<p>Kotlin \u4ee3\u7801: <pre><code>val list = mutableListOf&lt;Int&gt;().also {\n    it.add(1)\n    it.add(2)\n}\n</code></pre></p> <p>\u53cd\u7f16\u8bd1\u540e\u7684 Java \u4ee3\u7801: <pre><code>List&lt;Integer&gt; list = new ArrayList&lt;&gt;();\nlist.add(1);\nlist.add(2);\n// also \u8fd4\u56de\u5bf9\u8c61\u672c\u8eab\uff0c\u6240\u4ee5\u4e0d\u9700\u8981\u989d\u5916\u8d4b\u503c\n</code></pre></p>"},{"location":"020Kotlin/010Basic/#2_3","title":"2. \u53cd\u7f16\u8bd1\u540e\u7684\u5173\u952e\u7279\u70b9","text":"<ol> <li> <p>\u65e0\u989d\u5916\u51fd\u6570\u8c03\u7528\uff1a\u7531\u4e8e\u662f\u5185\u8054\u51fd\u6570\uff0c\u53cd\u7f16\u8bd1\u540e\u770b\u4e0d\u5230 <code>let</code>\u3001<code>run</code> \u7b49\u51fd\u6570\u7684\u8c03\u7528\u75d5\u8ff9</p> </li> <li> <p>lambda \u5185\u5bb9\u76f4\u63a5\u5c55\u5f00\uff1alambda \u8868\u8fbe\u5f0f\u7684\u5185\u5bb9\u88ab\u76f4\u63a5\u63d2\u5165\u5230\u8c03\u7528\u5904</p> </li> <li> <p>\u65e0\u533f\u540d\u7c7b\u751f\u6210\uff1a\u4e0e\u666e\u901a\u9ad8\u9636\u51fd\u6570\u4e0d\u540c\uff0c\u4e0d\u4f1a\u751f\u6210\u989d\u5916\u7684 <code>FunctionN</code> \u7c7b</p> </li> <li> <p>\u4e0a\u4e0b\u6587\u5bf9\u8c61\u5904\u7406\uff1a</p> </li> <li>\u5bf9\u4e8e <code>T.()</code> \u5f62\u5f0f\uff08\u5982 <code>run</code>\u3001<code>apply</code>\uff09\uff0c\u76f4\u63a5\u4f7f\u7528\u5bf9\u8c61\u4f5c\u4e3a <code>this</code></li> <li> <p>\u5bf9\u4e8e <code>(T)</code> \u5f62\u5f0f\uff08\u5982 <code>let</code>\u3001<code>also</code>\uff09\uff0c\u5bf9\u8c61\u4f5c\u4e3a\u53c2\u6570\u4f20\u9012</p> </li> <li> <p>\u8fd4\u56de\u503c\u5904\u7406\uff1a</p> </li> <li>\u8fd4\u56de\u5bf9\u8c61\u672c\u8eab\u7684\u51fd\u6570\uff08<code>apply</code>\u3001<code>also</code>\uff09\u5728\u53cd\u7f16\u8bd1\u540e\u770b\u8d77\u6765\u5c31\u50cf\u76f4\u63a5\u64cd\u4f5c\u5bf9\u8c61</li> <li>\u8fd4\u56de lambda \u7ed3\u679c\u7684\u51fd\u6570\uff08<code>let</code>\u3001<code>run</code>\u3001<code>with</code>\uff09\u4f1a\u5c06\u7ed3\u679c\u76f4\u63a5\u8d4b\u7ed9\u53d8\u91cf</li> </ol>"},{"location":"020Kotlin/010Basic/#3_3","title":"3. \u5bf9\u6bd4\u975e\u5185\u8054\u51fd\u6570","text":"<p>\u5982\u679c\u5bf9\u6bd4\u975e\u5185\u8054\u7684\u9ad8\u9636\u51fd\u6570\uff0c\u5dee\u5f02\u5f88\u660e\u663e\uff1a</p> <p>Kotlin \u975e\u5185\u8054\u51fd\u6570: <pre><code>fun &lt;T, R&gt; T.myLet(block: (T) -&gt; R): R = block(this)\n\nval length = \"Hello\".myLet { it.length }\n</code></pre></p> <p>\u53cd\u7f16\u8bd1\u540e\u7684 Java \u4ee3\u7801: <pre><code>// \u4f1a\u751f\u6210\u989d\u5916\u7684 Function1 \u533f\u540d\u7c7b\nint length = StandardKt.myLet(\"Hello\", new Function1&lt;String, Integer&gt;() {\n    @Override\n    public Integer invoke(String it) {\n        return it.length();\n    }\n});\n</code></pre></p> <p>\u53ef\u4ee5\u770b\u5230\u975e\u5185\u8054\u51fd\u6570\u4f1a\u751f\u6210\u989d\u5916\u7684\u533f\u540d\u7c7b\uff0c\u5e26\u6765\u8fd0\u884c\u65f6\u5f00\u9500\u3002</p>"},{"location":"020Kotlin/010Basic/#4_3","title":"4. \u6027\u80fd\u542f\u793a","text":"<p>\u4ece\u53cd\u7f16\u8bd1\u7ed3\u679c\u53ef\u4ee5\u770b\u51fa\uff1a</p> <ol> <li>\u65e0\u8fd0\u884c\u65f6\u5f00\u9500\uff1a\u57df\u51fd\u6570\u5728\u8fd0\u884c\u65f6\u4e0e\u76f4\u63a5\u7f16\u5199\u4ee3\u7801\u6027\u80fd\u76f8\u540c</li> <li>\u65e0\u5bf9\u8c61\u5206\u914d\uff1a\u4e0d\u4f1a\u521b\u5efa\u989d\u5916\u7684\u51fd\u6570\u5bf9\u8c61</li> <li>\u7f16\u8bd1\u671f\u4f18\u5316\uff1a\u6240\u6709\u8f6c\u6362\u5728\u7f16\u8bd1\u671f\u5b8c\u6210</li> <li>\u8c03\u8bd5\u4fe1\u606f\u4fdd\u7559\uff1a\u867d\u7136\u5185\u8054\uff0c\u4f46\u8c03\u8bd5\u65f6\u4ecd\u80fd\u770b\u5230\u539f\u59cb Kotlin \u4ee3\u7801\u7ed3\u6784</li> </ol>"},{"location":"020Kotlin/010Basic/#5_2","title":"5. \u7279\u6b8a\u60c5\u51b5","text":"<p>\u5f53\u57df\u51fd\u6570\u7528\u4e8e\u53ef\u7a7a\u7c7b\u578b\u65f6\uff0c\u53cd\u7f16\u8bd1\u540e\u4f1a\u770b\u5230 null \u68c0\u67e5\uff1a</p> <p>Kotlin \u4ee3\u7801: <pre><code>val str: String? = getString()\nval length = str?.let { it.length } ?: 0\n</code></pre></p> <p>\u53cd\u7f16\u8bd1\u540e\u7684 Java \u4ee3\u7801: <pre><code>String str = getString();\nint length = str != null ? str.length() : 0;\n</code></pre></p> <p>\u8fd9\u79cd\u5b89\u5168\u8c03\u7528\u8f6c\u6362\u4e5f\u662f\u7f16\u8bd1\u671f\u5b8c\u6210\u7684\u4f18\u5316\u3002</p>"},{"location":"020Kotlin/010Basic/#kotlin-inline-oninline-crossline","title":"Kotlin inline oninline crossline\u5206\u522b\u6709\u4ec0\u4e48\u4f5c\u7528","text":"\u7b54\u6848 <p>\u5185\u8054 lambda \u8868\u8fbe\u5f0f\u53c2\u6570\uff08\u4e3b\u8981\u4f18\u70b9\uff09\uff1a \u5185\u8054\u51fd\u6570\u7684\u53c2\u6570\u5982\u679c\u662f lambda \u8868\u8fbe\u5f0f\uff0c\u5219\u8be5\u53c2\u6570\u9ed8\u8ba4\u4e5f\u662f inline \u7684\u3002lambda \u8868\u8fbe\u5f0f\u4e5f\u4f1a\u88ab\u56fa\u5316\u7684\u51fd\u6570\u8c03\u7528\u4f4d\u7f6e\uff0c\u4ece\u800c\u51cf\u5c11\u4e86\u4e3a lambda \u8868\u8fbe\u5f0f\u521b\u5efa\u533f\u540d\u5185\u90e8\u7c7b\u5bf9\u8c61\u7684\u5f00\u9500\u3002\u5f53 lambda \u8868\u8fbe\u5f0f\u88ab\u7ecf\u5e38\u8c03\u7528\u65f6\uff0c\u53ef\u4ee5\u51cf\u5c11\u5185\u5b58\u5f00\u9500\u3002</p> <p>\u51cf\u5c11\u5165\u6808\u51fa\u6808\u8fc7\u7a0b\uff08\u6b21\u8981\u4f18\u70b9\uff09\uff1a \u5185\u8054\u51fd\u6570\u7684\u51fd\u6570\u4f53\u88ab\u56fa\u5316\u5230\u51fd\u6570\u8c03\u7528\u4f4d\u7f6e\uff0c\u6267\u884c\u8fc7\u7a0b\u4e2d\u51cf\u5c11\u4e86\u6808\u5e27\u521b\u5efa\u3001\u5165\u6808\u548c\u51fa\u6808\u8fc7\u7a0b\u3002\u9700\u8981\u6ce8\u610f\uff1a\u5982\u679c\u51fd\u6570\u4f53\u592a\u5927\u5c31\u4e0d\u9002\u5408\u4f7f\u7528\u5185\u8054\u51fd\u6570\u4e86\uff0c\u56e0\u4e3a\u4f1a\u5927\u5e45\u5ea6\u589e\u52a0\u5b57\u8282\u7801\u5927\u5c0f\u3002</p> <p>@PublishApi \u6ce8\u89e3\uff1a \u7f16\u8bd1\u5668\u8981\u6c42\u5185\u8054\u51fd\u6570\u5fc5\u987b\u662f public \u7c7b\u578b\uff0c\u4f7f\u7528 @PublishApi \u6ce8\u89e3\u53ef\u4ee5\u5b9e\u73b0 internal \u7b49\u8bbf\u95ee\u4fee\u9970\u7684\u540c\u65f6\u53c8\u5b9e\u73b0\u5185\u8054</p> <p>noinline \u975e\u5185\u8054\uff1a \u5982\u679c\u5728\u5185\u8054\u51fd\u6570\u5185\u90e8\uff0clambda \u8868\u8fbe\u5f0f\u53c2\u6570\u88ab\u5176\u5b83\u975e\u5185\u8054\u51fd\u6570\u8c03\u7528\uff0c\u4f1a\u62a5\u7f16\u8bd1\u65f6\u9519\u8bef\u3002\u8fd9\u662f\u56e0\u4e3a lambda \u8868\u8fbe\u5f0f\u5df2\u7ecf\u88ab\u62c9\u5e73\u800c\u65e0\u6cd5\u4f20\u9012\u7ed9\u5176\u4ed6\u975e\u5185\u8054\u51fd\u6570\u3002\u53ef\u4ee5\u7ed9\u53c2\u6570\u52a0\u4e0a noinline \u5173\u952e\u5b57\u8868\u793a\u7981\u6b62\u5185\u8054\u3002</p> <p>crossinline \u975e\u5c40\u90e8\u8fd4\u56de\uff1a \u7981\u6b62\u5185\u8054\u51fd\u6570\u7684 lambda \u8868\u8fbe\u5f0f\u53c2\u6570\u4f7f\u7528\u975e\u5c40\u90e8\u8fd4\u56de</p> <p>\u5728Kotlin\u4e2d\uff0c<code>inline</code>\u3001<code>noinline</code> \u548c <code>crossinline</code> \u662f\u4e0e\u5185\u8054\u51fd\u6570\u76f8\u5173\u7684\u5173\u952e\u5b57\uff0c\u4e3b\u8981\u7528\u4e8e\u4f18\u5316\u9ad8\u9636\u51fd\u6570\u7684\u6027\u80fd\u548c\u63a7\u5236\u51fd\u6570\u53c2\u6570\u7684\u884c\u4e3a\u3002\u4ee5\u4e0b\u662f\u5b83\u4eec\u7684\u8be6\u7ec6\u8bf4\u660e\u53ca\u5728Android\u5e73\u53f0\u4e0a\u7684\u5e94\u7528\u3002</p>"},{"location":"020Kotlin/010Basic/#1-inline","title":"1. <code>inline</code>","text":"<p>\u4f5c\u7528\uff1a<code>inline</code> \u5173\u952e\u5b57\u7528\u4e8e\u5185\u8054\u51fd\u6570\u3002\u5185\u8054\u51fd\u6570\u5728\u7f16\u8bd1\u65f6\u4f1a\u5c06\u51fd\u6570\u4f53\u76f4\u63a5\u63d2\u5165\u5230\u8c03\u7528\u5904\uff0c\u800c\u4e0d\u662f\u751f\u6210\u4e00\u4e2a\u51fd\u6570\u8c03\u7528\u3002\u8fd9\u53ef\u4ee5\u51cf\u5c11\u51fd\u6570\u8c03\u7528\u7684\u5f00\u9500\uff0c\u5c24\u5176\u662f\u5bf9\u4e8e\u9ad8\u9636\u51fd\u6570\uff08\u5982Lambda\u8868\u8fbe\u5f0f\uff09\uff0c\u907f\u514d\u521b\u5efa\u989d\u5916\u7684\u5bf9\u8c61\u3002</p> <p>\u4f7f\u7528\u573a\u666f\uff1a - \u5f53\u4f60\u4f7f\u7528\u9ad8\u9636\u51fd\u6570\uff08\u5982 <code>map</code>\u3001<code>filter</code> \u7b49\uff09\u65f6\uff0cKotlin \u4f1a\u4e3a\u6bcf\u4e2a Lambda \u8868\u8fbe\u5f0f\u751f\u6210\u4e00\u4e2a\u533f\u540d\u7c7b\u5b9e\u4f8b\u3002\u4f7f\u7528 <code>inline</code> \u53ef\u4ee5\u907f\u514d\u8fd9\u79cd\u5f00\u9500\u3002 - \u9002\u7528\u4e8e\u9891\u7e41\u8c03\u7528\u7684\u5c0f\u51fd\u6570\uff0c\u5c24\u5176\u662f\u5305\u542b Lambda \u8868\u8fbe\u5f0f\u7684\u51fd\u6570\u3002</p> <p>\u793a\u4f8b\uff1a <pre><code>inline fun &lt;T&gt; execute(action: () -&gt; T): T {\n    return action()\n}\n\nfun main() {\n    execute {\n        println(\"Inline function\")\n    }\n}\n</code></pre></p> <p>Android \u5e73\u53f0\u4f7f\u7528\uff1a - \u5728 Android \u5f00\u53d1\u4e2d\uff0c<code>inline</code> \u5e38\u7528\u4e8e\u4f18\u5316\u6027\u80fd\uff0c\u5c24\u5176\u662f\u5728\u5904\u7406\u5927\u91cf\u6570\u636e\u6216\u9891\u7e41\u8c03\u7528\u7684\u573a\u666f\u4e2d\u3002\u4f8b\u5982\uff0c<code>View.setOnClickListener</code> \u53ef\u4ee5\u4f7f\u7528 <code>inline</code> \u6765\u907f\u514d\u521b\u5efa\u989d\u5916\u7684 Lambda \u5bf9\u8c61\u3002</p>"},{"location":"020Kotlin/010Basic/#2-noinline","title":"2. <code>noinline</code>","text":"<p>\u4f5c\u7528\uff1a<code>noinline</code> \u7528\u4e8e\u6807\u8bb0\u5185\u8054\u51fd\u6570\u4e2d\u7684\u67d0\u4e2a Lambda \u53c2\u6570\uff0c\u4f7f\u5176\u4e0d\u88ab\u5185\u8054\u3002\u8fd9\u610f\u5473\u7740\u8be5 Lambda \u8868\u8fbe\u5f0f\u4f1a\u88ab\u7f16\u8bd1\u4e3a\u4e00\u4e2a\u666e\u901a\u7684\u51fd\u6570\u5bf9\u8c61\uff0c\u800c\u4e0d\u662f\u76f4\u63a5\u63d2\u5165\u5230\u8c03\u7528\u5904\u3002</p> <p>\u4f7f\u7528\u573a\u666f\uff1a - \u5f53\u4f60\u5e0c\u671b\u67d0\u4e2a Lambda \u53c2\u6570\u4e0d\u88ab\u5185\u8054\u65f6\u4f7f\u7528\u3002\u4f8b\u5982\uff0c\u5982\u679c\u4f60\u9700\u8981\u5c06 Lambda \u4f20\u9012\u7ed9\u53e6\u4e00\u4e2a\u975e\u5185\u8054\u51fd\u6570\uff0c\u6216\u8005\u9700\u8981\u5728\u51fd\u6570\u5916\u90e8\u5b58\u50a8 Lambda\u3002</p> <p>\u793a\u4f8b\uff1a <pre><code>inline fun execute(action1: () -&gt; Unit, noinline action2: () -&gt; Unit) {\n    action1()\n    runLater(action2)  // \u5047\u8bbe runLater \u662f\u4e00\u4e2a\u975e\u5185\u8054\u51fd\u6570\n}\n\nfun runLater(action: () -&gt; Unit) {\n    // \u7a0d\u540e\u6267\u884c action\n}\n</code></pre></p> <p>Android \u5e73\u53f0\u4f7f\u7528\uff1a - \u5728 Android \u4e2d\uff0c<code>noinline</code> \u53ef\u4ee5\u7528\u4e8e\u9700\u8981\u5c06 Lambda \u4f20\u9012\u7ed9\u5176\u4ed6\u975e\u5185\u8054\u51fd\u6570\u7684\u573a\u666f\uff0c\u4f8b\u5982\u5c06\u56de\u8c03\u4f20\u9012\u7ed9\u5f02\u6b65\u4efb\u52a1\u3002</p>"},{"location":"020Kotlin/010Basic/#3-crossinline","title":"3. <code>crossinline</code>","text":"<p>\u4f5c\u7528\uff1a<code>crossinline</code> \u7528\u4e8e\u6807\u8bb0\u5185\u8054\u51fd\u6570\u4e2d\u7684 Lambda \u53c2\u6570\uff0c\u786e\u4fdd\u8be5 Lambda \u4e0d\u4f1a\u5728\u51fd\u6570\u4f53\u5185\u8fdb\u884c\u975e\u5c40\u90e8\u8fd4\u56de\uff08\u5373\u4e0d\u80fd\u4f7f\u7528 <code>return</code> \u76f4\u63a5\u8fd4\u56de\u5230\u5916\u5c42\u51fd\u6570\uff09\u3002\u5b83\u5141\u8bb8 Lambda \u5728\u5185\u8054\u51fd\u6570\u4e2d\u4f7f\u7528\uff0c\u4f46\u4e0d\u80fd\u4ece Lambda \u4e2d\u76f4\u63a5\u8fd4\u56de\u3002</p> <p>\u4f7f\u7528\u573a\u666f\uff1a - \u5f53\u4f60\u5e0c\u671b\u786e\u4fdd Lambda \u4e0d\u4f1a\u4ece\u5185\u8054\u51fd\u6570\u4e2d\u975e\u5c40\u90e8\u8fd4\u56de\u65f6\u4f7f\u7528\u3002\u901a\u5e38\u7528\u4e8e\u9700\u8981\u5728\u5f02\u6b65\u6216\u5ef6\u8fdf\u6267\u884c\u7684\u4ee3\u7801\u5757\u4e2d\u4f7f\u7528 Lambda\u3002</p> <p>\u793a\u4f8b\uff1a <pre><code>inline fun execute(crossinline action: () -&gt; Unit) {\n    runOnUiThread {\n        action()  // \u4e0d\u80fd\u5728\u8fd9\u91cc\u4f7f\u7528 return\n    }\n}\n\nfun runOnUiThread(action: () -&gt; Unit) {\n    // \u6a21\u62df\u5728 UI \u7ebf\u7a0b\u6267\u884c\n    action()\n}\n</code></pre></p> <p>Android \u5e73\u53f0\u4f7f\u7528\uff1a - \u5728 Android \u4e2d\uff0c<code>crossinline</code> \u5e38\u7528\u4e8e\u9700\u8981\u5728\u5f02\u6b65\u4efb\u52a1\u6216 UI \u7ebf\u7a0b\u4e2d\u6267\u884c\u7684 Lambda \u8868\u8fbe\u5f0f\uff0c\u786e\u4fdd\u4e0d\u4f1a\u53d1\u751f\u975e\u5c40\u90e8\u8fd4\u56de\u3002</p>"},{"location":"020Kotlin/010Basic/#android","title":"Android \u7cfb\u7edf\u6e90\u7801\u4e2d\u7684\u4f7f\u7528","text":"<p>\u5728 Android \u7cfb\u7edf\u6e90\u7801\u4e2d\uff0c<code>inline</code>\u3001<code>noinline</code> \u548c <code>crossinline</code> \u4e3b\u8981\u7528\u4e8e\u4f18\u5316\u6027\u80fd\u548c\u63a7\u5236 Lambda \u8868\u8fbe\u5f0f\u7684\u884c\u4e3a\u3002\u4ee5\u4e0b\u662f\u4e00\u4e9b\u5e38\u89c1\u7684\u5e94\u7528\u573a\u666f\uff1a</p> <ol> <li>Kotlin \u6807\u51c6\u5e93\uff1a</li> <li> <p>Kotlin \u6807\u51c6\u5e93\u4e2d\u7684\u8bb8\u591a\u9ad8\u9636\u51fd\u6570\uff08\u5982 <code>map</code>\u3001<code>filter</code>\u3001<code>let</code>\u3001<code>run</code> \u7b49\uff09\u90fd\u4f7f\u7528\u4e86 <code>inline</code> \u6765\u4f18\u5316\u6027\u80fd\u3002</p> </li> <li> <p>Android KTX \u5e93\uff1a</p> </li> <li> <p>Android KTX \u5e93\u4e2d\u7684\u8bb8\u591a\u6269\u5c55\u51fd\u6570\u4e5f\u4f7f\u7528\u4e86 <code>inline</code> \u6765\u4f18\u5316\u6027\u80fd\u3002\u4f8b\u5982\uff0c<code>View.doOnPreDraw</code> \u548c <code>View.doOnLayout</code> \u7b49\u51fd\u6570\u3002</p> </li> <li> <p>\u534f\u7a0b\uff1a</p> </li> <li>Kotlin \u534f\u7a0b\u5e93\u4e2d\u7684\u8bb8\u591a\u51fd\u6570\uff08\u5982 <code>launch</code> \u548c <code>async</code>\uff09\u4e5f\u4f7f\u7528\u4e86 <code>inline</code> \u548c <code>crossinline</code> \u6765\u786e\u4fdd Lambda \u8868\u8fbe\u5f0f\u5728\u534f\u7a0b\u4e0a\u4e0b\u6587\u4e2d\u6b63\u786e\u6267\u884c\u3002</li> </ol>"},{"location":"020Kotlin/010Basic/#_7","title":"\u603b\u7ed3","text":"<ul> <li><code>inline</code>\uff1a\u7528\u4e8e\u5185\u8054\u51fd\u6570\uff0c\u51cf\u5c11\u9ad8\u9636\u51fd\u6570\u7684\u5f00\u9500\u3002</li> <li><code>noinline</code>\uff1a\u7528\u4e8e\u6807\u8bb0\u4e0d\u88ab\u5185\u8054\u7684 Lambda \u53c2\u6570\u3002</li> <li><code>crossinline</code>\uff1a\u7528\u4e8e\u786e\u4fdd Lambda \u4e0d\u4f1a\u8fdb\u884c\u975e\u5c40\u90e8\u8fd4\u56de\u3002</li> </ul> <p>inline \u7528\u4e8e\u4fee\u9970\u51fd\u6570\u3002</p> <p>noinline \u548c crossinline \u7528\u4e8e\u4fee\u9970\u5df2\u7ecf\u88ab inline \u4fee\u9970\u8fc7\u7684\u51fd\u6570\u7684 Lambda \u53c2\u6570\u3002</p> <p>\u5728 Android \u5f00\u53d1\u4e2d\uff0c\u8fd9\u4e9b\u5173\u952e\u5b57\u5e38\u7528\u4e8e\u4f18\u5316\u6027\u80fd\u548c\u63a7\u5236 Lambda \u8868\u8fbe\u5f0f\u7684\u884c\u4e3a\uff0c\u5c24\u5176\u662f\u5728\u5904\u7406\u5f02\u6b65\u4efb\u52a1\u3001UI \u64cd\u4f5c\u548c\u9ad8\u9636\u51fd\u6570\u65f6\u3002</p>"},{"location":"020Kotlin/010Basic/#crossinline","title":"crossinline\u6848\u4f8b","text":"\u7b54\u6848"},{"location":"020Kotlin/010Basic/#1_4","title":"1. \u5f02\u6b65\u4efb\u52a1\u4e2d\u7684\u975e\u5c40\u90e8\u8fd4\u56de\u95ee\u9898","text":"<p>\u5047\u8bbe\u6211\u4eec\u6709\u4e00\u4e2a\u5185\u8054\u51fd\u6570\uff0c\u7528\u4e8e\u5728\u540e\u53f0\u7ebf\u7a0b\u6267\u884c\u4efb\u52a1\uff0c\u5e76\u5728\u4efb\u52a1\u5b8c\u6210\u540e\u66f4\u65b0 UI\u3002\u5982\u679c\u4e0d\u4f7f\u7528 <code>crossinline</code>\uff0c\u53ef\u80fd\u4f1a\u53d1\u751f\u975e\u5c40\u90e8\u8fd4\u56de\uff0c\u5bfc\u81f4\u610f\u5916\u7684\u884c\u4e3a\u3002</p>"},{"location":"020Kotlin/010Basic/#1-crossinline","title":"\u793a\u4f8b 1\uff1a\u6ca1\u6709 <code>crossinline</code> \u7684\u95ee\u9898","text":"<p><pre><code>inline fun doAsyncTask(action: () -&gt; Unit) {\n    Thread {\n        action()  // \u8fd9\u91cc\u53ef\u80fd\u53d1\u751f\u975e\u5c40\u90e8\u8fd4\u56de\n    }.start()\n}\n\nfun main() {\n    println(\"Start\")\n    doAsyncTask {\n        println(\"Running task\")\n        return  // \u975e\u5c40\u90e8\u8fd4\u56de\uff0c\u76f4\u63a5\u8fd4\u56de\u5230 main \u51fd\u6570\u7684\u8c03\u7528\u5904\n    }\n    println(\"End\")  // \u8fd9\u884c\u4ee3\u7801\u4e0d\u4f1a\u88ab\u6267\u884c\n}\n</code></pre> \u8f93\u51fa\uff1a <pre><code>Start\nRunning task\n</code></pre></p> <p>\u95ee\u9898\uff1a - \u5728 <code>doAsyncTask</code> \u4e2d\uff0c<code>action</code> \u662f\u4e00\u4e2a\u5185\u8054\u7684 Lambda \u8868\u8fbe\u5f0f\u3002 - \u5f53 <code>action</code> \u4e2d\u4f7f\u7528\u4e86 <code>return</code> \u65f6\uff0c\u5b83\u4f1a\u76f4\u63a5\u8fd4\u56de\u5230 <code>main</code> \u51fd\u6570\u7684\u8c03\u7528\u5904\uff0c\u5bfc\u81f4 <code>println(\"End\")</code> \u4e0d\u4f1a\u88ab\u6267\u884c\u3002 - \u8fd9\u79cd\u884c\u4e3a\u5728\u5f02\u6b65\u4efb\u52a1\u4e2d\u662f\u4e0d\u53ef\u9884\u671f\u7684\uff0c\u56e0\u4e3a\u6211\u4eec\u5e0c\u671b\u4efb\u52a1\u5b8c\u6210\u540e\u7ee7\u7eed\u6267\u884c\u540e\u7eed\u4ee3\u7801\u3002</p>"},{"location":"020Kotlin/010Basic/#2-crossinline","title":"\u793a\u4f8b 2\uff1a\u4f7f\u7528 <code>crossinline</code> \u4fee\u590d\u95ee\u9898","text":"<p><pre><code>inline fun doAsyncTask(crossinline action: () -&gt; Unit) {\n    Thread {\n        action()  // \u8fd9\u91cc\u4e0d\u80fd\u4f7f\u7528\u975e\u5c40\u90e8\u8fd4\u56de\n    }.start()\n}\n\nfun main() {\n    println(\"Start\")\n    doAsyncTask {\n        println(\"Running task\")\n        // return  // \u8fd9\u91cc\u4e0d\u80fd\u4f7f\u7528 return\uff0c\u5426\u5219\u4f1a\u7f16\u8bd1\u9519\u8bef\n    }\n    println(\"End\")  // \u8fd9\u884c\u4ee3\u7801\u4f1a\u88ab\u6267\u884c\n}\n</code></pre> \u8f93\u51fa\uff1a <pre><code>Start\nRunning task\nEnd\n</code></pre></p> <p>\u4fee\u590d\uff1a - \u4f7f\u7528 <code>crossinline</code> \u4fee\u9970 <code>action</code>\uff0c\u786e\u4fdd Lambda \u8868\u8fbe\u5f0f\u4e2d\u7684 <code>return</code> \u53ea\u80fd\u662f\u5c40\u90e8\u8fd4\u56de\u3002 - \u5982\u679c\u5c1d\u8bd5\u5728 <code>action</code> \u4e2d\u4f7f\u7528 <code>return</code>\uff0c\u7f16\u8bd1\u5668\u4f1a\u62a5\u9519\uff0c\u4ece\u800c\u907f\u514d\u4e86\u975e\u5c40\u90e8\u8fd4\u56de\u7684\u95ee\u9898\u3002</p>"},{"location":"020Kotlin/010Basic/#2-ui","title":"2. UI \u7ebf\u7a0b\u4e2d\u7684\u975e\u5c40\u90e8\u8fd4\u56de\u95ee\u9898","text":"<p>\u5728 Android \u5f00\u53d1\u4e2d\uff0c\u6211\u4eec\u7ecf\u5e38\u9700\u8981\u5728 UI \u7ebf\u7a0b\u4e2d\u6267\u884c\u4efb\u52a1\u3002\u5982\u679c\u4e0d\u4f7f\u7528 <code>crossinline</code>\uff0c\u53ef\u80fd\u4f1a\u5728 UI \u7ebf\u7a0b\u7684 Lambda \u8868\u8fbe\u5f0f\u4e2d\u53d1\u751f\u975e\u5c40\u90e8\u8fd4\u56de\uff0c\u5bfc\u81f4 UI \u66f4\u65b0\u4e0d\u5b8c\u6574\u3002</p>"},{"location":"020Kotlin/010Basic/#3-crossinline_1","title":"\u793a\u4f8b 3\uff1a\u6ca1\u6709 <code>crossinline</code> \u7684\u95ee\u9898","text":"<p><pre><code>inline fun runOnUiThread(action: () -&gt; Unit) {\n    Handler(Looper.getMainLooper()).post {\n        action()  // \u8fd9\u91cc\u53ef\u80fd\u53d1\u751f\u975e\u5c40\u90e8\u8fd4\u56de\n    }\n}\n\nfun main() {\n    println(\"Start\")\n    runOnUiThread {\n        println(\"Updating UI\")\n        return  // \u975e\u5c40\u90e8\u8fd4\u56de\uff0c\u76f4\u63a5\u8fd4\u56de\u5230 main \u51fd\u6570\u7684\u8c03\u7528\u5904\n    }\n    println(\"End\")  // \u8fd9\u884c\u4ee3\u7801\u4e0d\u4f1a\u88ab\u6267\u884c\n}\n</code></pre> \u8f93\u51fa\uff1a <pre><code>Start\nUpdating UI\n</code></pre></p> <p>\u95ee\u9898\uff1a - \u5728 <code>runOnUiThread</code> \u4e2d\uff0c<code>action</code> \u662f\u4e00\u4e2a\u5185\u8054\u7684 Lambda \u8868\u8fbe\u5f0f\u3002 - \u5f53 <code>action</code> \u4e2d\u4f7f\u7528\u4e86 <code>return</code> \u65f6\uff0c\u5b83\u4f1a\u76f4\u63a5\u8fd4\u56de\u5230 <code>main</code> \u51fd\u6570\u7684\u8c03\u7528\u5904\uff0c\u5bfc\u81f4 <code>println(\"End\")</code> \u4e0d\u4f1a\u88ab\u6267\u884c\u3002 - \u8fd9\u79cd\u884c\u4e3a\u5728 UI \u66f4\u65b0\u4e2d\u662f\u4e0d\u53ef\u9884\u671f\u7684\uff0c\u56e0\u4e3a\u6211\u4eec\u5e0c\u671b UI \u66f4\u65b0\u5b8c\u6210\u540e\u7ee7\u7eed\u6267\u884c\u540e\u7eed\u4ee3\u7801\u3002</p>"},{"location":"020Kotlin/010Basic/#4-crossinline","title":"\u793a\u4f8b 4\uff1a\u4f7f\u7528 <code>crossinline</code> \u4fee\u590d\u95ee\u9898","text":"<p><pre><code>inline fun runOnUiThread(crossinline action: () -&gt; Unit) {\n    Handler(Looper.getMainLooper()).post {\n        action()  // \u8fd9\u91cc\u4e0d\u80fd\u4f7f\u7528\u975e\u5c40\u90e8\u8fd4\u56de\n    }\n}\n\nfun main() {\n    println(\"Start\")\n    runOnUiThread {\n        println(\"Updating UI\")\n        // return  // \u8fd9\u91cc\u4e0d\u80fd\u4f7f\u7528 return\uff0c\u5426\u5219\u4f1a\u7f16\u8bd1\u9519\u8bef\n    }\n    println(\"End\")  // \u8fd9\u884c\u4ee3\u7801\u4f1a\u88ab\u6267\u884c\n}\n</code></pre> \u8f93\u51fa\uff1a <pre><code>Start\nUpdating UI\nEnd\n</code></pre></p> <p>\u4fee\u590d\uff1a - \u4f7f\u7528 <code>crossinline</code> \u4fee\u9970 <code>action</code>\uff0c\u786e\u4fdd Lambda \u8868\u8fbe\u5f0f\u4e2d\u7684 <code>return</code> \u53ea\u80fd\u662f\u5c40\u90e8\u8fd4\u56de\u3002 - \u5982\u679c\u5c1d\u8bd5\u5728 <code>action</code> \u4e2d\u4f7f\u7528 <code>return</code>\uff0c\u7f16\u8bd1\u5668\u4f1a\u62a5\u9519\uff0c\u4ece\u800c\u907f\u514d\u4e86\u975e\u5c40\u90e8\u8fd4\u56de\u7684\u95ee\u9898\u3002</p>"},{"location":"020Kotlin/010Basic/#3-crossinline_2","title":"3. \u603b\u7ed3\uff1a\u4e3a\u4ec0\u4e48\u8981\u4f7f\u7528 <code>crossinline</code>\uff1f","text":"<p>\u901a\u8fc7\u4ee5\u4e0a\u4f8b\u5b50\uff0c\u6211\u4eec\u53ef\u4ee5\u770b\u5230 <code>crossinline</code> \u7684\u4e3b\u8981\u4f5c\u7528\u662f\uff1a 1. \u9632\u6b62\u975e\u5c40\u90e8\u8fd4\u56de\uff1a\u786e\u4fdd Lambda \u8868\u8fbe\u5f0f\u4e2d\u7684 <code>return</code> \u4e0d\u4f1a\u76f4\u63a5\u8fd4\u56de\u5230\u5916\u5c42\u51fd\u6570\u7684\u8c03\u7528\u5904\uff0c\u4ece\u800c\u907f\u514d\u610f\u5916\u7684\u884c\u4e3a\u3002 2. \u63a7\u5236\u6267\u884c\u6d41\u7a0b\uff1a\u5728\u5f02\u6b65\u4efb\u52a1\u6216 UI \u66f4\u65b0\u7b49\u573a\u666f\u4e2d\uff0c\u786e\u4fdd\u4efb\u52a1\u5b8c\u6210\u540e\u7ee7\u7eed\u6267\u884c\u540e\u7eed\u4ee3\u7801\u3002 3. \u63d0\u9ad8\u4ee3\u7801\u53ef\u9884\u6d4b\u6027\uff1a\u901a\u8fc7\u9650\u5236 <code>return</code> \u7684\u4f5c\u7528\u8303\u56f4\uff0c\u4f7f\u4ee3\u7801\u7684\u884c\u4e3a\u66f4\u52a0\u660e\u786e\u548c\u53ef\u63a7\u3002</p>"},{"location":"020Kotlin/010Basic/#4-crossinline_1","title":"4. <code>crossinline</code> \u7684\u5178\u578b\u4f7f\u7528\u573a\u666f","text":"<ul> <li>\u5f02\u6b65\u4efb\u52a1\uff1a\u786e\u4fdd\u4efb\u52a1\u5b8c\u6210\u540e\u7ee7\u7eed\u6267\u884c\u540e\u7eed\u4ee3\u7801\u3002</li> <li>UI \u66f4\u65b0\uff1a\u786e\u4fdd UI \u66f4\u65b0\u5b8c\u6210\u540e\u7ee7\u7eed\u6267\u884c\u540e\u7eed\u4ee3\u7801\u3002</li> <li>\u5ef6\u8fdf\u6267\u884c\uff1a\u5728 <code>Handler.post</code>\u3001<code>Executors</code> \u7b49\u5ef6\u8fdf\u6267\u884c\u7684\u4ee3\u7801\u5757\u4e2d\u4f7f\u7528\u3002</li> </ul>"},{"location":"020Kotlin/010Basic/#5_3","title":"5. \u6700\u7ec8\u603b\u7ed3","text":"<ul> <li>\u6ca1\u6709 <code>crossinline</code>\uff1aLambda \u8868\u8fbe\u5f0f\u4e2d\u7684 <code>return</code> \u53ef\u80fd\u4f1a\u5bfc\u81f4\u975e\u5c40\u90e8\u8fd4\u56de\uff0c\u76f4\u63a5\u8fd4\u56de\u5230\u5916\u5c42\u51fd\u6570\u7684\u8c03\u7528\u5904\u3002</li> <li>\u4f7f\u7528 <code>crossinline</code>\uff1aLambda \u8868\u8fbe\u5f0f\u4e2d\u7684 <code>return</code> \u53ea\u80fd\u662f\u5c40\u90e8\u8fd4\u56de\uff0c\u786e\u4fdd\u4ee3\u7801\u7684\u884c\u4e3a\u66f4\u52a0\u53ef\u63a7\u3002</li> </ul>"},{"location":"020Kotlin/010Basic/#kotlin_5","title":"Kotlin\u5f3a\u8f6c\u7b26\u53f7\u662f\u4ec0\u4e48\uff1f","text":"\u7b54\u6848 <p>\u5728 Kotlin \u4e2d\uff0c\u7c7b\u578b\u8f6c\u6362\u662f\u5c06\u4e00\u4e2a\u5bf9\u8c61\u4ece\u4e00\u79cd\u7c7b\u578b\u8f6c\u6362\u4e3a\u53e6\u4e00\u79cd\u7c7b\u578b\u7684\u64cd\u4f5c\u3002Kotlin \u63d0\u4f9b\u4e86\u591a\u79cd\u65b9\u5f0f\u6765\u5b9e\u73b0\u7c7b\u578b\u8f6c\u6362\uff0c\u4f46\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0cKotlin \u662f\u5f3a\u7c7b\u578b\u8bed\u8a00\uff0c\u4e0d\u652f\u6301\u9690\u5f0f\u7684\u7c7b\u578b\u8f6c\u6362\uff08\u4f8b\u5982\uff0c\u4e0d\u80fd\u76f4\u63a5\u5c06 <code>Int</code> \u8d4b\u503c\u7ed9 <code>Long</code>\uff0c\u5fc5\u987b\u663e\u5f0f\u8f6c\u6362\uff09\u3002</p>"},{"location":"020Kotlin/010Basic/#_8","title":"\u5f3a\u5236\u7c7b\u578b\u8f6c\u6362\u7684\u5173\u952e\u5b57","text":"<p>\u5728 Kotlin \u4e2d\uff0c\u5f3a\u5236\u7c7b\u578b\u8f6c\u6362\u901a\u5e38\u4f7f\u7528 <code>as</code> \u5173\u952e\u5b57\u3002<code>as</code> \u7528\u4e8e\u5c06\u4e00\u4e2a\u5bf9\u8c61\u663e\u5f0f\u8f6c\u6362\u4e3a\u76ee\u6807\u7c7b\u578b\u3002</p>"},{"location":"020Kotlin/010Basic/#_9","title":"\u793a\u4f8b","text":"<pre><code>val obj: Any = \"Hello, Kotlin\"\nval str: String = obj as String  // \u5f3a\u5236\u5c06 Any \u7c7b\u578b\u8f6c\u6362\u4e3a String \u7c7b\u578b\nprintln(str)  // \u8f93\u51fa: Hello, Kotlin\n</code></pre>"},{"location":"020Kotlin/010Basic/#_10","title":"\u5b89\u5168\u7c7b\u578b\u8f6c\u6362","text":"<p>\u5982\u679c\u5f3a\u5236\u7c7b\u578b\u8f6c\u6362\u5931\u8d25\uff08\u4f8b\u5982\uff0c\u5bf9\u8c61\u4e0d\u662f\u76ee\u6807\u7c7b\u578b\uff09\uff0c\u4f1a\u629b\u51fa <code>ClassCastException</code>\u3002\u4e3a\u4e86\u907f\u514d\u5f02\u5e38\uff0c\u53ef\u4ee5\u4f7f\u7528 <code>as?</code> \u8fdb\u884c\u5b89\u5168\u7c7b\u578b\u8f6c\u6362\u3002\u5982\u679c\u8f6c\u6362\u5931\u8d25\uff0c<code>as?</code> \u4f1a\u8fd4\u56de <code>null</code> \u800c\u4e0d\u662f\u629b\u51fa\u5f02\u5e38\u3002</p>"},{"location":"020Kotlin/010Basic/#_11","title":"\u793a\u4f8b","text":"<pre><code>val obj: Any = 123\nval str: String? = obj as? String  // \u5b89\u5168\u8f6c\u6362\uff0c\u5931\u8d25\u65f6\u8fd4\u56de null\nprintln(str)  // \u8f93\u51fa: null\n</code></pre>"},{"location":"020Kotlin/010Basic/#_12","title":"\u6ce8\u610f\u4e8b\u9879","text":"<ol> <li>\u7c7b\u578b\u517c\u5bb9\u6027\uff1a\u53ea\u80fd\u5c06\u5bf9\u8c61\u8f6c\u6362\u4e3a\u517c\u5bb9\u7684\u7c7b\u578b\u3002\u4f8b\u5982\uff0c\u4e0d\u80fd\u5c06 <code>String</code> \u8f6c\u6362\u4e3a <code>Int</code>\u3002</li> <li>\u57fa\u672c\u7c7b\u578b\u8f6c\u6362\uff1aKotlin \u63d0\u4f9b\u4e86\u663e\u5f0f\u7684\u65b9\u6cd5\u6765\u8f6c\u6362\u57fa\u672c\u7c7b\u578b\uff08\u5982 <code>toInt()</code>\u3001<code>toLong()</code> \u7b49\uff09\uff0c\u800c\u4e0d\u662f\u4f7f\u7528 <code>as</code>\u3002 <pre><code>val number: Double = 123.45\nval intValue: Int = number.toInt()  // \u5c06 Double \u8f6c\u6362\u4e3a Int\nprintln(intValue)  // \u8f93\u51fa: 123\n</code></pre></li> <li>\u667a\u80fd\u7c7b\u578b\u8f6c\u6362\uff1a\u5728 Kotlin \u4e2d\uff0c\u5982\u679c\u7f16\u8bd1\u5668\u80fd\u591f\u63a8\u65ad\u51fa\u7c7b\u578b\uff0c\u53ef\u4ee5\u81ea\u52a8\u8fdb\u884c\u667a\u80fd\u7c7b\u578b\u8f6c\u6362\uff0c\u65e0\u9700\u663e\u5f0f\u4f7f\u7528 <code>as</code>\u3002 <pre><code>val obj: Any = \"Kotlin\"\nif (obj is String) {\n    println(obj.length)  // \u81ea\u52a8\u667a\u80fd\u8f6c\u6362\u4e3a String \u7c7b\u578b\n}\n</code></pre></li> </ol>"},{"location":"020Kotlin/010Basic/#_13","title":"\u603b\u7ed3","text":"<ul> <li>\u5f3a\u5236\u7c7b\u578b\u8f6c\u6362\u4f7f\u7528 <code>as</code> \u5173\u952e\u5b57\u3002</li> <li>\u5b89\u5168\u7c7b\u578b\u8f6c\u6362\u4f7f\u7528 <code>as?</code>\uff0c\u907f\u514d\u629b\u51fa\u5f02\u5e38\u3002</li> <li>\u57fa\u672c\u7c7b\u578b\u8f6c\u6362\u4f7f\u7528 <code>toInt()</code>\u3001<code>toLong()</code> \u7b49\u65b9\u6cd5\u3002</li> <li>\u667a\u80fd\u7c7b\u578b\u8f6c\u6362\u662f Kotlin \u7684\u7279\u6027\uff0c\u53ef\u4ee5\u5728\u6761\u4ef6\u5224\u65ad\u540e\u81ea\u52a8\u8f6c\u6362\u7c7b\u578b\u3002</li> </ul>"},{"location":"020Kotlin/010Basic/#objectcompanion","title":"object\u548ccompanion\u7684\u533a\u522b\u3002","text":"\u7b54\u6848 <p><code>object</code> \u5173\u952e\u5b57\u548c <code>companion</code> \u5173\u952e\u5b57\u5728 Kotlin \u4e2d\u90fd\u4e0e\u5355\u4f8b\u5bf9\u8c61\u76f8\u5173\uff0c\u4f46\u5b83\u4eec\u7684\u7528\u9014\u548c\u884c\u4e3a\u6709\u6240\u4e0d\u540c\u3002\u4ee5\u4e0b\u662f\u5bf9\u5b83\u4eec\u7684\u8be6\u7ec6\u5bf9\u6bd4\uff0c\u4ee5\u53ca <code>object</code> \u662f\u5426\u5177\u6709 Java \u4e2d <code>static</code> \u7684\u6548\u679c\u7684\u89e3\u91ca\u3002</p>"},{"location":"020Kotlin/010Basic/#1-object","title":"1. <code>object</code> \u5173\u952e\u5b57","text":"<p><code>object</code> \u5173\u952e\u5b57\u7528\u4e8e\u5b9a\u4e49\u5355\u4f8b\u5bf9\u8c61\u6216\u533f\u540d\u5bf9\u8c61\u3002\u5b83\u7684\u4e3b\u8981\u7279\u70b9\u662f\uff1a - \u5355\u4f8b\u6027\uff1a<code>object</code> \u58f0\u660e\u521b\u5efa\u4e00\u4e2a\u5168\u5c40\u552f\u4e00\u7684\u5bf9\u8c61\u3002 - \u72ec\u7acb\u6027\uff1a<code>object</code> \u5b9a\u4e49\u7684\u5bf9\u8c61\u662f\u72ec\u7acb\u7684\uff0c\u4e0d\u4f9d\u8d56\u4e8e\u4efb\u4f55\u7c7b\u3002 - \u7528\u9014\uff1a - \u5355\u4f8b\u6a21\u5f0f\uff1a\u5b9a\u4e49\u4e00\u4e2a\u5168\u5c40\u552f\u4e00\u7684\u5bf9\u8c61\u3002 - \u533f\u540d\u5bf9\u8c61\uff1a\u521b\u5efa\u4e00\u4e2a\u4e34\u65f6\u7684\u3001\u672a\u547d\u540d\u7684\u5bf9\u8c61\uff08\u7c7b\u4f3c\u4e8e Java \u7684\u533f\u540d\u5185\u90e8\u7c7b\uff09\u3002</p>"},{"location":"020Kotlin/010Basic/#_14","title":"\u793a\u4f8b","text":"<pre><code>object Database {\n    val name = \"MyDatabase\"\n    fun connect() {\n        println(\"Connected to $name\")\n    }\n}\n\nfun main() {\n    Database.connect()  // \u76f4\u63a5\u8bbf\u95ee\u5355\u4f8b\u5bf9\u8c61\n}\n</code></pre>"},{"location":"020Kotlin/010Basic/#2-companion","title":"2. <code>companion</code> \u5173\u952e\u5b57","text":"<p><code>companion</code> \u5173\u952e\u5b57\u7528\u4e8e\u5b9a\u4e49\u4f34\u751f\u5bf9\u8c61\uff0c\u5b83\u662f\u4e00\u4e2a\u4e0e\u7c7b\u5173\u8054\u7684\u5355\u4f8b\u5bf9\u8c61\u3002\u5b83\u7684\u4e3b\u8981\u7279\u70b9\u662f\uff1a - \u5173\u8054\u6027\uff1a\u4f34\u751f\u5bf9\u8c61\u4e0e\u7c7b\u7ed1\u5b9a\uff0c\u751f\u547d\u5468\u671f\u4e0e\u7c7b\u4e00\u81f4\u3002 - \u8bbf\u95ee\u65b9\u5f0f\uff1a\u4f34\u751f\u5bf9\u8c61\u7684\u6210\u5458\u53ef\u4ee5\u901a\u8fc7\u7c7b\u540d\u76f4\u63a5\u8bbf\u95ee\uff08\u7c7b\u4f3c\u4e8e Java \u7684\u9759\u6001\u6210\u5458\uff09\u3002 - \u7528\u9014\uff1a - \u66ff\u4ee3 Java \u4e2d\u7684\u9759\u6001\u6210\u5458\uff08\u9759\u6001\u65b9\u6cd5\u3001\u9759\u6001\u5c5e\u6027\uff09\u3002 - \u5b9e\u73b0\u5de5\u5382\u6a21\u5f0f\u3002 - \u5b9e\u73b0\u63a5\u53e3\u3002</p>"},{"location":"020Kotlin/010Basic/#_15","title":"\u793a\u4f8b","text":"<pre><code>class MyClass {\n    companion object {\n        const val CONSTANT = \"This is a constant\"\n        fun create(): MyClass = MyClass()\n    }\n}\n\nfun main() {\n    println(MyClass.CONSTANT)  // \u901a\u8fc7\u7c7b\u540d\u8bbf\u95ee\u4f34\u751f\u5bf9\u8c61\u7684\u6210\u5458\n    val instance = MyClass.create()\n}\n</code></pre>"},{"location":"020Kotlin/010Basic/#3-object-companion","title":"3. <code>object</code> \u548c <code>companion</code> \u7684\u533a\u522b","text":"\u7279\u6027 <code>object</code> <code>companion object</code> \u5173\u8054\u6027 \u72ec\u7acb\u5bf9\u8c61\uff0c\u4e0d\u4f9d\u8d56\u4e8e\u7c7b \u4e0e\u7c7b\u5173\u8054\uff0c\u751f\u547d\u5468\u671f\u4e0e\u7c7b\u7ed1\u5b9a \u5355\u4f8b\u6027 \u5168\u5c40\u552f\u4e00\u7684\u5355\u4f8b\u5bf9\u8c61 \u6bcf\u4e2a\u7c7b\u53ea\u80fd\u6709\u4e00\u4e2a\u4f34\u751f\u5bf9\u8c61 \u8bbf\u95ee\u65b9\u5f0f \u901a\u8fc7\u5bf9\u8c61\u540d\u8bbf\u95ee\uff08\u5982 <code>Database</code>\uff09 \u901a\u8fc7\u7c7b\u540d\u8bbf\u95ee\uff08\u5982 <code>MyClass.CONSTANT</code>\uff09 \u7528\u9014 \u5355\u4f8b\u6a21\u5f0f\u3001\u533f\u540d\u5bf9\u8c61 \u66ff\u4ee3\u9759\u6001\u6210\u5458\u3001\u5de5\u5382\u65b9\u6cd5\u3001\u5b9e\u73b0\u63a5\u53e3 \u4e0e Java \u4e92\u64cd\u4f5c \u901a\u8fc7\u5bf9\u8c61\u540d\u8bbf\u95ee \u901a\u8fc7 <code>\u7c7b\u540d.Companion.\u6210\u5458\u540d</code> \u8bbf\u95ee"},{"location":"020Kotlin/010Basic/#4-object-java-static","title":"4. <code>object</code> \u662f\u5426\u5177\u6709 Java <code>static</code> \u7684\u6548\u679c\uff1f","text":"<p><code>object</code> \u5173\u952e\u5b57\u672c\u8eab\u5e76\u4e0d\u76f4\u63a5\u7b49\u540c\u4e8e Java \u7684 <code>static</code>\uff0c\u4f46\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u65b9\u5f0f\u5b9e\u73b0\u7c7b\u4f3c\u7684\u6548\u679c\uff1a</p>"},{"location":"020Kotlin/010Basic/#_16","title":"\u5355\u4f8b\u5bf9\u8c61\u7684\u9759\u6001\u6548\u679c","text":"<ul> <li><code>object</code> \u5b9a\u4e49\u7684\u5bf9\u8c61\u662f\u5355\u4f8b\u7684\uff0c\u56e0\u6b64\u5b83\u7684\u5c5e\u6027\u548c\u65b9\u6cd5\u5728\u5168\u5c40\u8303\u56f4\u5185\u662f\u552f\u4e00\u7684\uff0c\u53ef\u4ee5\u901a\u8fc7\u5bf9\u8c61\u540d\u76f4\u63a5\u8bbf\u95ee\u3002</li> <li>\u8fd9\u79cd\u65b9\u5f0f\u7c7b\u4f3c\u4e8e Java \u4e2d\u7684\u9759\u6001\u6210\u5458\uff0c\u4f46\u672c\u8d28\u4e0a\u662f\u5355\u4f8b\u5bf9\u8c61\u7684\u6210\u5458\u3002</li> </ul>"},{"location":"020Kotlin/010Basic/#_17","title":"\u793a\u4f8b","text":"<pre><code>object Constants {\n    const val PI = 3.14159\n    fun printPi() {\n        println(PI)\n    }\n}\n\nfun main() {\n    println(Constants.PI)  // \u7c7b\u4f3c\u4e8e Java \u7684\u9759\u6001\u5c5e\u6027\n    Constants.printPi()    // \u7c7b\u4f3c\u4e8e Java \u7684\u9759\u6001\u65b9\u6cd5\n}\n</code></pre>"},{"location":"020Kotlin/010Basic/#javakotlinstatic","title":"\u53cd\u7f16\u8bd1\u540e\u7684Java\u4ee3\u7801\uff0c\u53ef\u4ee5\u770b\u5230\u7684\u662f\uff0c\u4ec5\u4ec5\u662fKotlin\u52a0\u4e86\u4e00\u5c42\u8bed\u6cd5\u7cd6\uff0c\u6240\u4ee5\u770b\u8d77\u6765\u50cf\u662fstatic\u3002","text":"<pre><code>public final class TestKt {\n    public static final void main() {\n        double var0 = 3.14159;\n        System.out.println(var0);\n        Constants.INSTANCE.printPi();\n    }\n        // $FF: synthetic method\n    public static void main(String[] args) {\n        main();\n    }\n}\n</code></pre>"},{"location":"020Kotlin/010Basic/#companion-object","title":"\u4e0e <code>companion object</code> \u7684\u533a\u522b","text":"<ul> <li><code>object</code> \u662f\u72ec\u7acb\u7684\u5355\u4f8b\u5bf9\u8c61\uff0c\u4e0d\u4f9d\u8d56\u4e8e\u7c7b\u3002</li> <li><code>companion object</code> \u662f\u4e0e\u7c7b\u5173\u8054\u7684\u5355\u4f8b\u5bf9\u8c61\uff0c\u53ef\u4ee5\u901a\u8fc7\u7c7b\u540d\u76f4\u63a5\u8bbf\u95ee\u5176\u6210\u5458\uff0c\u66f4\u63a5\u8fd1 Java \u7684 <code>static</code>\u3002</li> </ul>"},{"location":"020Kotlin/010Basic/#5_4","title":"5. \u603b\u7ed3","text":"\u7279\u6027 <code>object</code> <code>companion object</code> Java <code>static</code> \u5355\u4f8b\u6027 \u662f \u662f \u5426\uff08\u9759\u6001\u6210\u5458\u5c5e\u4e8e\u7c7b\uff0c\u4e0d\u662f\u5355\u4f8b\uff09 \u8bbf\u95ee\u65b9\u5f0f \u901a\u8fc7\u5bf9\u8c61\u540d\u8bbf\u95ee \u901a\u8fc7\u7c7b\u540d\u8bbf\u95ee \u901a\u8fc7\u7c7b\u540d\u8bbf\u95ee \u5173\u8054\u6027 \u72ec\u7acb\u5bf9\u8c61 \u4e0e\u7c7b\u5173\u8054 \u4e0e\u7c7b\u5173\u8054 \u7528\u9014 \u5355\u4f8b\u6a21\u5f0f\u3001\u533f\u540d\u5bf9\u8c61 \u66ff\u4ee3\u9759\u6001\u6210\u5458\u3001\u5de5\u5382\u65b9\u6cd5 \u9759\u6001\u6210\u5458 <ul> <li><code>object</code>\uff1a\u7528\u4e8e\u521b\u5efa\u5355\u4f8b\u5bf9\u8c61\u6216\u533f\u540d\u5bf9\u8c61\uff0c\u4e0d\u76f4\u63a5\u7b49\u540c\u4e8e Java \u7684 <code>static</code>\uff0c\u4f46\u53ef\u4ee5\u901a\u8fc7\u5355\u4f8b\u5bf9\u8c61\u5b9e\u73b0\u7c7b\u4f3c\u7684\u6548\u679c\u3002</li> <li><code>companion object</code>\uff1a\u7528\u4e8e\u66ff\u4ee3 Java \u7684 <code>static</code>\uff0c\u63d0\u4f9b\u4e0e\u7c7b\u5173\u8054\u7684\u9759\u6001\u6210\u5458\u529f\u80fd\u3002</li> </ul> <p>\u5982\u679c\u4f60\u9700\u8981\u5b9e\u73b0\u7c7b\u4f3c Java \u7684\u9759\u6001\u6210\u5458\u529f\u80fd\uff0c\u901a\u5e38\u4f7f\u7528 <code>companion object</code> \u66f4\u4e3a\u5408\u9002\uff1b\u800c <code>object</code> \u66f4\u9002\u5408\u7528\u4e8e\u5168\u5c40\u5355\u4f8b\u6216\u533f\u540d\u5bf9\u8c61\u7684\u573a\u666f\u3002</p>"},{"location":"020Kotlin/010Basic/#companion","title":"companion\u5173\u952e\u5b57\u662f\u4ec0\u4e48\uff1f\u6709\u4ec0\u4e48\u4f5c\u7528\uff1f","text":"\u7b54\u6848 <p>\u5728 Kotlin \u4e2d\uff0c<code>companion</code> \u5173\u952e\u5b57\u7528\u4e8e\u5b9a\u4e49\u4f34\u751f\u5bf9\u8c61\uff08Companion Object\uff09\u3002\u4f34\u751f\u5bf9\u8c61\u662f\u4e00\u4e2a\u4e0e\u7c7b\u5173\u8054\u7684\u5355\u4f8b\u5bf9\u8c61\uff0c\u5b83\u7684\u4e3b\u8981\u4f5c\u7528\u662f\u4e3a\u7c7b\u63d0\u4f9b\u7c7b\u4f3c\u4e8e Java \u4e2d\u9759\u6001\u6210\u5458\uff08\u9759\u6001\u65b9\u6cd5\u3001\u9759\u6001\u5c5e\u6027\uff09\u7684\u529f\u80fd\u3002Kotlin \u672c\u8eab\u6ca1\u6709 <code>static</code> \u5173\u952e\u5b57\uff0c\u56e0\u6b64\u901a\u8fc7\u4f34\u751f\u5bf9\u8c61\u6765\u5b9e\u73b0\u7c7b\u4f3c\u7684\u529f\u80fd\u3002</p>"},{"location":"020Kotlin/010Basic/#_18","title":"\u4f34\u751f\u5bf9\u8c61\u7684\u4f5c\u7528","text":"<ol> <li>\u66ff\u4ee3\u9759\u6001\u6210\u5458\uff1a</li> <li>\u5728 Java \u4e2d\uff0c\u9759\u6001\u6210\u5458\uff08\u5982\u9759\u6001\u65b9\u6cd5\u3001\u9759\u6001\u5c5e\u6027\uff09\u5c5e\u4e8e\u7c7b\u800c\u4e0d\u662f\u5b9e\u4f8b\uff0c\u53ef\u4ee5\u76f4\u63a5\u901a\u8fc7\u7c7b\u540d\u8bbf\u95ee\u3002</li> <li> <p>\u5728 Kotlin \u4e2d\uff0c\u4f34\u751f\u5bf9\u8c61\u53ef\u4ee5\u5b9a\u4e49\u7c7b\u4f3c\u7684\u6210\u5458\uff0c\u8fd9\u4e9b\u6210\u5458\u53ef\u4ee5\u901a\u8fc7\u7c7b\u540d\u76f4\u63a5\u8bbf\u95ee\u3002</p> </li> <li> <p>\u5355\u4f8b\u5bf9\u8c61\uff1a</p> </li> <li> <p>\u4f34\u751f\u5bf9\u8c61\u662f\u4e00\u4e2a\u5355\u4f8b\u5bf9\u8c61\uff0c\u5b83\u7684\u751f\u547d\u5468\u671f\u4e0e\u7c7b\u7ed1\u5b9a\uff0c\u4e14\u5728\u7c7b\u52a0\u8f7d\u65f6\u521d\u59cb\u5316\u3002</p> </li> <li> <p>\u5de5\u5382\u65b9\u6cd5\uff1a</p> </li> <li> <p>\u4f34\u751f\u5bf9\u8c61\u53ef\u4ee5\u7528\u4e8e\u5b9e\u73b0\u5de5\u5382\u6a21\u5f0f\uff0c\u63d0\u4f9b\u521b\u5efa\u7c7b\u5b9e\u4f8b\u7684\u9759\u6001\u65b9\u6cd5\u3002</p> </li> <li> <p>\u5b9e\u73b0\u63a5\u53e3\uff1a</p> </li> <li>\u4f34\u751f\u5bf9\u8c61\u53ef\u4ee5\u5b9e\u73b0\u63a5\u53e3\uff0c\u4ece\u800c\u4e3a\u7c7b\u63d0\u4f9b\u989d\u5916\u7684\u529f\u80fd\u3002</li> </ol>"},{"location":"020Kotlin/010Basic/#_19","title":"\u4f34\u751f\u5bf9\u8c61\u7684\u8bed\u6cd5","text":"<p>\u4f34\u751f\u5bf9\u8c61\u901a\u8fc7 <code>companion object</code> \u5173\u952e\u5b57\u5b9a\u4e49\uff0c\u901a\u5e38\u653e\u5728\u7c7b\u7684\u5185\u90e8\u3002\u5b83\u53ef\u4ee5\u6709\u540d\u79f0\uff0c\u4e5f\u53ef\u4ee5\u6ca1\u6709\u540d\u79f0\uff08\u9ed8\u8ba4\u540d\u79f0\u4e3a <code>Companion</code>\uff09\u3002</p>"},{"location":"020Kotlin/010Basic/#1_5","title":"\u793a\u4f8b 1\uff1a\u57fa\u672c\u7528\u6cd5","text":"<pre><code>class MyClass {\n    companion object {\n        const val CONSTANT = \"This is a constant\"  // \u7c7b\u4f3c\u4e8e\u9759\u6001\u5e38\u91cf\n        fun create(): MyClass = MyClass()  // \u7c7b\u4f3c\u4e8e\u9759\u6001\u5de5\u5382\u65b9\u6cd5\n    }\n}\n\nfun main() {\n    println(MyClass.CONSTANT)  // \u8f93\u51fa: This is a constant\n    val instance = MyClass.create()  // \u901a\u8fc7\u4f34\u751f\u5bf9\u8c61\u521b\u5efa\u5b9e\u4f8b\n}\n</code></pre>"},{"location":"020Kotlin/010Basic/#2_4","title":"\u793a\u4f8b 2\uff1a\u547d\u540d\u4f34\u751f\u5bf9\u8c61","text":"<pre><code>class MyClass {\n    companion object Factory {\n        fun create(): MyClass = MyClass()\n    }\n}\n\nfun main() {\n    val instance = MyClass.Factory.create()  // \u901a\u8fc7\u547d\u540d\u4f34\u751f\u5bf9\u8c61\u521b\u5efa\u5b9e\u4f8b\n}\n</code></pre>"},{"location":"020Kotlin/010Basic/#3_4","title":"\u793a\u4f8b 3\uff1a\u5b9e\u73b0\u63a5\u53e3","text":"<pre><code>interface Factory&lt;T&gt; {\n    fun create(): T\n}\n\nclass MyClass {\n    companion object : Factory&lt;MyClass&gt; {\n        override fun create(): MyClass = MyClass()\n    }\n}\n\nfun main() {\n    val instance = MyClass.create()  // \u901a\u8fc7\u4f34\u751f\u5bf9\u8c61\u521b\u5efa\u5b9e\u4f8b\n}\n</code></pre>"},{"location":"020Kotlin/010Basic/#_20","title":"\u4f34\u751f\u5bf9\u8c61\u7684\u7279\u70b9","text":"<ol> <li>\u5355\u4f8b\u6027\uff1a</li> <li> <p>\u6bcf\u4e2a\u7c7b\u53ea\u80fd\u6709\u4e00\u4e2a\u4f34\u751f\u5bf9\u8c61\uff0c\u4e14\u4f34\u751f\u5bf9\u8c61\u662f\u5355\u4f8b\u7684\u3002</p> </li> <li> <p>\u8bbf\u95ee\u6743\u9650\uff1a</p> </li> <li> <p>\u4f34\u751f\u5bf9\u8c61\u7684\u6210\u5458\u53ef\u4ee5\u8bbf\u95ee\u7c7b\u7684\u79c1\u6709\u6210\u5458\uff08\u5305\u62ec\u79c1\u6709\u6784\u9020\u51fd\u6570\uff09\uff0c\u8fd9\u4f7f\u5f97\u5b83\u975e\u5e38\u9002\u5408\u5b9e\u73b0\u5de5\u5382\u6a21\u5f0f\u3002</p> </li> <li> <p>\u540d\u79f0\u53ef\u9009\uff1a</p> </li> <li> <p>\u4f34\u751f\u5bf9\u8c61\u53ef\u4ee5\u547d\u540d\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528\u9ed8\u8ba4\u540d\u79f0 <code>Companion</code>\u3002</p> </li> <li> <p>\u4e0e Java \u4e92\u64cd\u4f5c\uff1a</p> </li> <li>\u5728 Java \u4e2d\uff0c\u4f34\u751f\u5bf9\u8c61\u7684\u6210\u5458\u53ef\u4ee5\u901a\u8fc7 <code>\u7c7b\u540d.Companion.\u6210\u5458\u540d</code> \u8bbf\u95ee\u3002</li> <li>\u5982\u679c\u4f34\u751f\u5bf9\u8c61\u6709\u540d\u79f0\uff0c\u5219\u901a\u8fc7 <code>\u7c7b\u540d.\u4f34\u751f\u5bf9\u8c61\u540d\u79f0.\u6210\u5458\u540d</code> \u8bbf\u95ee\u3002</li> </ol>"},{"location":"020Kotlin/010Basic/#vs","title":"\u4f34\u751f\u5bf9\u8c61 vs \u666e\u901a\u5bf9\u8c61","text":"\u7279\u6027 \u4f34\u751f\u5bf9\u8c61 (<code>companion object</code>) \u666e\u901a\u5bf9\u8c61 (<code>object</code>) \u5173\u8054\u6027 \u4e0e\u7c7b\u5173\u8054\uff0c\u751f\u547d\u5468\u671f\u4e0e\u7c7b\u7ed1\u5b9a \u72ec\u7acb\u5b58\u5728\uff0c\u4e0d\u4f9d\u8d56\u4e8e\u7c7b \u8bbf\u95ee\u65b9\u5f0f \u901a\u8fc7\u7c7b\u540d\u76f4\u63a5\u8bbf\u95ee \u901a\u8fc7\u5bf9\u8c61\u540d\u8bbf\u95ee \u5355\u4f8b\u6027 \u6bcf\u4e2a\u7c7b\u53ea\u80fd\u6709\u4e00\u4e2a\u4f34\u751f\u5bf9\u8c61 \u6bcf\u4e2a\u5bf9\u8c61\u58f0\u660e\u90fd\u662f\u4e00\u4e2a\u5355\u4f8b \u4e3b\u8981\u7528\u9014 \u66ff\u4ee3\u9759\u6001\u6210\u5458\u3001\u5de5\u5382\u65b9\u6cd5\u3001\u5b9e\u73b0\u63a5\u53e3 \u5355\u4f8b\u6a21\u5f0f\u3001\u533f\u540d\u5bf9\u8c61"},{"location":"020Kotlin/010Basic/#_21","title":"\u603b\u7ed3","text":"<p><code>companion</code> \u5173\u952e\u5b57\u7528\u4e8e\u5b9a\u4e49\u4f34\u751f\u5bf9\u8c61\uff0c\u5176\u4e3b\u8981\u4f5c\u7528\u662f\uff1a 1. \u63d0\u4f9b\u7c7b\u4f3c\u4e8e Java \u9759\u6001\u6210\u5458\u7684\u529f\u80fd\u3002 2. \u5b9e\u73b0\u5de5\u5382\u6a21\u5f0f\u3002 3. \u5b9e\u73b0\u63a5\u53e3\uff0c\u4e3a\u7c7b\u63d0\u4f9b\u989d\u5916\u529f\u80fd\u3002</p> <p>\u4f34\u751f\u5bf9\u8c61\u662f Kotlin \u4e2d\u4e00\u79cd\u5f3a\u5927\u7684\u7279\u6027\uff0c\u65e2\u4fdd\u6301\u4e86\u9762\u5411\u5bf9\u8c61\u7684\u8bbe\u8ba1\u539f\u5219\uff0c\u53c8\u63d0\u4f9b\u4e86\u7c7b\u4f3c\u9759\u6001\u6210\u5458\u7684\u4fbf\u5229\u6027\u3002\u901a\u8fc7\u4f34\u751f\u5bf9\u8c61\uff0cKotlin \u907f\u514d\u4e86\u5f15\u5165 <code>static</code> \u5173\u952e\u5b57\uff0c\u540c\u65f6\u4fdd\u6301\u4e86\u4ee3\u7801\u7684\u7b80\u6d01\u6027\u548c\u4e00\u81f4\u6027\u3002</p>"},{"location":"020Kotlin/010Basic/#object","title":"object\u5173\u952e\u5b57\u6709\u4ec0\u4e48\u4f5c\u7528\uff1f","text":"\u7b54\u6848"},{"location":"020Kotlin/010Basic/#kotlin-object","title":"Kotlin \u5c06 <code>object</code> \u5173\u952e\u5b57\u8bbe\u8ba1\u4e3a\u540c\u65f6\u652f\u6301\u5355\u4f8b\u6a21\u5f0f\u548c\u533f\u540d\u5bf9\u8c61\uff0c\u4e3b\u8981\u662f\u4e3a\u4e86\u7b80\u5316\u4ee3\u7801\u3001\u63d0\u9ad8\u8bed\u8a00\u7684\u4e00\u81f4\u6027\u548c\u7075\u6d3b\u6027\u3002\u8fd9\u79cd\u8bbe\u8ba1\u80cc\u540e\u7684\u539f\u56e0\u53ef\u4ee5\u4ece\u4ee5\u4e0b\u51e0\u4e2a\u65b9\u9762\u6765\u7406\u89e3\uff1a","text":""},{"location":"020Kotlin/010Basic/#1_6","title":"1. \u5355\u4f8b\u6a21\u5f0f\u7684\u9700\u6c42","text":"<ul> <li>\u5355\u4f8b\u6a21\u5f0f\u662f\u4e00\u79cd\u5e38\u89c1\u7684\u8bbe\u8ba1\u6a21\u5f0f\uff0c\u7528\u4e8e\u786e\u4fdd\u4e00\u4e2a\u7c7b\u53ea\u6709\u4e00\u4e2a\u5b9e\u4f8b\uff0c\u5e76\u63d0\u4f9b\u4e00\u4e2a\u5168\u5c40\u8bbf\u95ee\u70b9\u3002</li> <li>\u5728 Java \u4e2d\uff0c\u5b9e\u73b0\u5355\u4f8b\u6a21\u5f0f\u9700\u8981\u624b\u52a8\u7f16\u5199\u4ee3\u7801\uff08\u5982\u53cc\u91cd\u68c0\u67e5\u9501\u5b9a\u3001\u9759\u6001\u5185\u90e8\u7c7b\u7b49\uff09\uff0c\u5bb9\u6613\u51fa\u9519\u4e14\u4ee3\u7801\u5197\u957f\u3002</li> <li>Kotlin \u901a\u8fc7 <code>object</code> \u5173\u952e\u5b57\u76f4\u63a5\u652f\u6301\u5355\u4f8b\u6a21\u5f0f\uff0c\u7b80\u5316\u4e86\u5355\u4f8b\u7684\u5b9e\u73b0\uff0c\u907f\u514d\u4e86\u624b\u52a8\u7f16\u5199\u590d\u6742\u4ee3\u7801\u3002</li> </ul> <p>\u793a\u4f8b\uff1a <pre><code>object Database {\n    fun connect() {\n        println(\"Connected to database\")\n    }\n}\n\nfun main() {\n    Database.connect()  // \u76f4\u63a5\u8bbf\u95ee\u5355\u4f8b\u5bf9\u8c61\n}\n</code></pre></p>"},{"location":"020Kotlin/010Basic/#2_5","title":"2. \u533f\u540d\u5bf9\u8c61\u7684\u9700\u6c42","text":"<ul> <li>\u533f\u540d\u5bf9\u8c61\u662f\u4e00\u79cd\u4e34\u65f6\u521b\u5efa\u7684\u5bf9\u8c61\uff0c\u901a\u5e38\u7528\u4e8e\u5b9e\u73b0\u63a5\u53e3\u6216\u62bd\u8c61\u7c7b\uff0c\u800c\u4e0d\u9700\u8981\u663e\u5f0f\u5b9a\u4e49\u4e00\u4e2a\u5177\u540d\u7c7b\u3002</li> <li>\u5728 Java \u4e2d\uff0c\u533f\u540d\u5bf9\u8c61\u901a\u8fc7\u533f\u540d\u5185\u90e8\u7c7b\u5b9e\u73b0\uff0c\u4f46\u8bed\u6cd5\u8f83\u4e3a\u7e41\u7410\u3002</li> <li>Kotlin \u901a\u8fc7 <code>object</code> \u5173\u952e\u5b57\u7b80\u5316\u4e86\u533f\u540d\u5bf9\u8c61\u7684\u521b\u5efa\uff0c\u4f7f\u5176\u8bed\u6cd5\u66f4\u52a0\u7b80\u6d01\u548c\u76f4\u89c2\u3002</li> </ul> <p>\u793a\u4f8b\uff1a <pre><code>val runnable = object : Runnable {\n    override fun run() {\n        println(\"Running...\")\n    }\n}\n\nfun main() {\n    runnable.run()  // \u8f93\u51fa: Running...\n}\n</code></pre></p>"},{"location":"020Kotlin/010Basic/#3_5","title":"3. \u7edf\u4e00\u7684\u8bbe\u8ba1\u54f2\u5b66","text":"<p>Kotlin \u7684\u8bbe\u8ba1\u54f2\u5b66\u4e4b\u4e00\u662f\u7b80\u6d01\u6027\u548c\u4e00\u81f4\u6027\u3002\u901a\u8fc7\u5c06\u5355\u4f8b\u6a21\u5f0f\u548c\u533f\u540d\u5bf9\u8c61\u7edf\u4e00\u5230 <code>object</code> \u5173\u952e\u5b57\u4e2d\uff0cKotlin \u51cf\u5c11\u4e86\u8bed\u8a00\u4e2d\u7684\u5197\u4f59\u6982\u5ff5\uff0c\u4f7f\u5f00\u53d1\u8005\u66f4\u5bb9\u6613\u7406\u89e3\u548c\u8bb0\u5fc6\u3002</p> <ul> <li>\u5355\u4f8b\u6a21\u5f0f\u548c\u533f\u540d\u5bf9\u8c61\u672c\u8d28\u4e0a\u90fd\u662f\u201c\u521b\u5efa\u4e00\u4e2a\u5bf9\u8c61\u201d\uff0c\u53ea\u662f\u7528\u9014\u4e0d\u540c\uff1a<ul> <li>\u5355\u4f8b\u6a21\u5f0f\uff1a\u521b\u5efa\u4e00\u4e2a\u5168\u5c40\u552f\u4e00\u7684\u5bf9\u8c61\u3002</li> <li>\u533f\u540d\u5bf9\u8c61\uff1a\u521b\u5efa\u4e00\u4e2a\u4e34\u65f6\u7684\u3001\u672a\u547d\u540d\u7684\u5bf9\u8c61\u3002</li> </ul> </li> <li>\u901a\u8fc7 <code>object</code> \u5173\u952e\u5b57\u7edf\u4e00\u8fd9\u4e24\u79cd\u7528\u9014\uff0cKotlin \u907f\u514d\u4e86\u5f15\u5165\u989d\u5916\u7684\u5173\u952e\u5b57\u6216\u8bed\u6cd5\u3002</li> </ul>"},{"location":"020Kotlin/010Basic/#4_4","title":"4. \u7075\u6d3b\u6027","text":"<ul> <li>\u5c06 <code>object</code> \u8bbe\u8ba1\u4e3a\u540c\u65f6\u652f\u6301\u5355\u4f8b\u6a21\u5f0f\u548c\u533f\u540d\u5bf9\u8c61\uff0c\u589e\u52a0\u4e86\u8bed\u8a00\u7684\u7075\u6d3b\u6027\u3002</li> <li>\u5f00\u53d1\u8005\u53ef\u4ee5\u6839\u636e\u9700\u8981\u9009\u62e9\u4f7f\u7528\u5355\u4f8b\u6a21\u5f0f\u8fd8\u662f\u533f\u540d\u5bf9\u8c61\uff0c\u800c\u4e0d\u9700\u8981\u5b66\u4e60\u4e24\u79cd\u4e0d\u540c\u7684\u8bed\u6cd5\u3002</li> </ul>"},{"location":"020Kotlin/010Basic/#5-java","title":"5. \u4e0e Java \u7684\u4e92\u64cd\u4f5c\u6027","text":"<ul> <li>Kotlin \u7684\u8bbe\u8ba1\u76ee\u6807\u4e4b\u4e00\u662f\u66f4\u597d\u5730\u4e0e Java \u4e92\u64cd\u4f5c\u3002</li> <li>\u5728 Java \u4e2d\uff0c\u5355\u4f8b\u6a21\u5f0f\u548c\u533f\u540d\u5bf9\u8c61\u90fd\u662f\u5e38\u89c1\u7684\u7f16\u7a0b\u6a21\u5f0f\u3002Kotlin \u901a\u8fc7 <code>object</code> \u5173\u952e\u5b57\u63d0\u4f9b\u4e86\u4e00\u79cd\u66f4\u7b80\u6d01\u7684\u65b9\u5f0f\u6765\u5b9e\u73b0\u8fd9\u4e24\u79cd\u6a21\u5f0f\uff0c\u540c\u65f6\u4fdd\u6301\u4e0e Java \u7684\u517c\u5bb9\u6027\u3002</li> </ul>"},{"location":"020Kotlin/010Basic/#6_1","title":"6. \u51cf\u5c11\u8bed\u8a00\u590d\u6742\u6027","text":"<ul> <li>\u5982\u679c Kotlin \u5c06\u5355\u4f8b\u6a21\u5f0f\u548c\u533f\u540d\u5bf9\u8c61\u5206\u5f00\u8bbe\u8ba1\uff0c\u53ef\u80fd\u9700\u8981\u5f15\u5165\u4e24\u4e2a\u4e0d\u540c\u7684\u5173\u952e\u5b57\u6216\u8bed\u6cd5\u7ed3\u6784\uff0c\u8fd9\u4f1a\u589e\u52a0\u8bed\u8a00\u7684\u590d\u6742\u6027\u3002</li> <li>\u901a\u8fc7\u7edf\u4e00\u5230 <code>object</code> \u5173\u952e\u5b57\uff0cKotlin \u4fdd\u6301\u4e86\u8bed\u8a00\u7684\u7b80\u6d01\u6027\u548c\u6613\u7528\u6027\u3002</li> </ul>"},{"location":"020Kotlin/010Basic/#_22","title":"\u603b\u7ed3","text":"<p>Kotlin \u5c06 <code>object</code> \u5173\u952e\u5b57\u8bbe\u8ba1\u4e3a\u540c\u65f6\u652f\u6301\u5355\u4f8b\u6a21\u5f0f\u548c\u533f\u540d\u5bf9\u8c61\uff0c\u4e3b\u8981\u662f\u4e3a\u4e86\uff1a 1. \u7b80\u5316\u4ee3\u7801\uff0c\u51cf\u5c11\u5197\u4f59\u3002 2. \u63d0\u9ad8\u8bed\u8a00\u7684\u4e00\u81f4\u6027\u548c\u7075\u6d3b\u6027\u3002 3. \u4e0e Java \u66f4\u597d\u5730\u4e92\u64cd\u4f5c\u3002 4. \u51cf\u5c11\u8bed\u8a00\u7684\u590d\u6742\u6027\uff0c\u4f7f\u5f00\u53d1\u8005\u66f4\u5bb9\u6613\u5b66\u4e60\u548c\u4f7f\u7528\u3002</p> <p>\u8fd9\u79cd\u8bbe\u8ba1\u4f53\u73b0\u4e86 Kotlin \u7684\u6838\u5fc3\u7406\u5ff5\uff1a\u7528\u66f4\u5c11\u7684\u4ee3\u7801\u505a\u66f4\u591a\u7684\u4e8b\u60c5\uff0c\u540c\u65f6\u4fdd\u6301\u4ee3\u7801\u7684\u6e05\u6670\u548c\u6613\u8bfb\u3002</p>"},{"location":"020Kotlin/010Basic/#kotlin_6","title":"Kotlin\u59d4\u6258\u662f\u4ec0\u4e48\uff0c\u6709\u4ec0\u4e48\u4f5c\u7528\uff1f","text":"\u7b54\u6848 <p>\u5728 Kotlin \u4e2d\uff0c\u59d4\u6258\u662f\u4e00\u79cd\u8bbe\u8ba1\u6a21\u5f0f\uff0c\u5141\u8bb8\u5bf9\u8c61\u5c06\u90e8\u5206\u804c\u8d23\u4ea4\u7ed9\u53e6\u4e00\u4e2a\u5bf9\u8c61\u5904\u7406\u3002Kotlin \u901a\u8fc7 <code>by</code> \u5173\u952e\u5b57\u652f\u6301\u59d4\u6258\uff0c\u7b80\u5316\u4e86\u5b9e\u73b0\u3002</p>"},{"location":"020Kotlin/010Basic/#_23","title":"\u59d4\u6258\u7684\u57fa\u672c\u6982\u5ff5","text":"<p>\u59d4\u6258\u7684\u6838\u5fc3\u601d\u60f3\u662f\u5c06\u4e00\u4e2a\u7c7b\u7684\u67d0\u4e9b\u529f\u80fd\u59d4\u6258\u7ed9\u53e6\u4e00\u4e2a\u7c7b\u3002Kotlin \u652f\u6301\u4e24\u79cd\u4e3b\u8981\u59d4\u6258\uff1a</p> <ol> <li>\u7c7b\u59d4\u6258\uff1a\u5c06\u4e00\u4e2a\u7c7b\u7684\u5b9e\u73b0\u59d4\u6258\u7ed9\u53e6\u4e00\u4e2a\u7c7b\u3002</li> <li>\u5c5e\u6027\u59d4\u6258\uff1a\u5c06\u5c5e\u6027\u7684 getter \u548c setter \u903b\u8f91\u59d4\u6258\u7ed9\u53e6\u4e00\u4e2a\u5bf9\u8c61\u3002</li> </ol>"},{"location":"020Kotlin/010Basic/#_24","title":"\u7c7b\u59d4\u6258","text":"<p>\u7c7b\u59d4\u6258\u5e38\u7528\u4e8e\u5b9e\u73b0\u7ee7\u627f\u7684\u66ff\u4ee3\u65b9\u6848\u3002\u901a\u8fc7\u59d4\u6258\uff0c\u53ef\u4ee5\u5c06\u4e00\u4e2a\u7c7b\u7684\u63a5\u53e3\u5b9e\u73b0\u59d4\u6258\u7ed9\u53e6\u4e00\u4e2a\u7c7b\u3002</p> <pre><code>interface Base {\n    fun print()\n}\n\nclass BaseImpl(val x: Int) : Base {\n    override fun print() { println(x) }\n}\n\nclass Derived(b: Base) : Base by b\n\nfun main() {\n    val b = BaseImpl(10)\n    Derived(b).print()  // \u8f93\u51fa: 10\n}\n</code></pre> <p>\u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0c<code>Derived</code> \u7c7b\u5c06 <code>Base</code> \u63a5\u53e3\u7684\u5b9e\u73b0\u59d4\u6258\u7ed9\u4e86 <code>b</code> \u5bf9\u8c61\u3002</p>"},{"location":"020Kotlin/010Basic/#_25","title":"\u5c5e\u6027\u59d4\u6258","text":"<p>\u5c5e\u6027\u59d4\u6258\u5141\u8bb8\u5c06\u5c5e\u6027\u7684 getter \u548c setter \u903b\u8f91\u59d4\u6258\u7ed9\u53e6\u4e00\u4e2a\u5bf9\u8c61\u3002Kotlin \u6807\u51c6\u5e93\u63d0\u4f9b\u4e86\u51e0\u79cd\u5e38\u89c1\u7684\u59d4\u6258\uff1a</p> <ol> <li>lazy\uff1a\u5ef6\u8fdf\u521d\u59cb\u5316\u5c5e\u6027\uff0c\u9996\u6b21\u8bbf\u95ee\u65f6\u8ba1\u7b97\u503c\u3002</li> <li>observable\uff1a\u5728\u5c5e\u6027\u503c\u53d8\u5316\u65f6\u89e6\u53d1\u56de\u8c03\u3002</li> <li>vetoable\uff1a\u5728\u5c5e\u6027\u503c\u53d8\u5316\u524d\u8fdb\u884c\u9a8c\u8bc1\u3002</li> <li>map\uff1a\u5c06\u5c5e\u6027\u5b58\u50a8\u5728 <code>Map</code> \u4e2d\u3002</li> </ol>"},{"location":"020Kotlin/010Basic/#1-lazy","title":"1. Lazy \u59d4\u6258","text":"<p><code>lazy</code> \u7528\u4e8e\u5ef6\u8fdf\u521d\u59cb\u5316\u5c5e\u6027\uff0c\u9002\u7528\u4e8e\u521d\u59cb\u5316\u6210\u672c\u8f83\u9ad8\u7684\u573a\u666f\u3002</p> <pre><code>val lazyValue: String by lazy {\n    println(\"computed!\")\n    \"Hello\"\n}\n\nfun main() {\n    println(lazyValue)  // \u8f93\u51fa: computed! Hello\n    println(lazyValue)  // \u8f93\u51fa: Hello\n}\n</code></pre>"},{"location":"020Kotlin/010Basic/#2-observable","title":"2. Observable \u59d4\u6258","text":"<p><code>observable</code> \u5728\u5c5e\u6027\u503c\u53d8\u5316\u65f6\u89e6\u53d1\u56de\u8c03\u3002</p> <pre><code>import kotlin.properties.Delegates\n\nvar observedValue: String by Delegates.observable(\"\u521d\u59cb\u503c\") { _, old, new -&gt;\n    println(\"\u503c\u4ece $old \u53d8\u4e3a $new\")\n}\n\nfun main() {\n    observedValue = \"\u65b0\u503c\"  // \u8f93\u51fa: \u503c\u4ece \u521d\u59cb\u503c \u53d8\u4e3a \u65b0\u503c\n}\n</code></pre>"},{"location":"020Kotlin/010Basic/#3-vetoable","title":"3. Vetoable \u59d4\u6258","text":"<p><code>vetoable</code> \u5141\u8bb8\u5728\u5c5e\u6027\u503c\u53d8\u5316\u524d\u8fdb\u884c\u9a8c\u8bc1\uff0c\u53ea\u6709\u6ee1\u8db3\u6761\u4ef6\u65f6\u624d\u4f1a\u66f4\u65b0\u3002</p> <pre><code>import kotlin.properties.Delegates\n\nvar vetoableValue: Int by Delegates.vetoable(0) { _, old, new -&gt;\n    new &gt; old\n}\n\nfun main() {\n    vetoableValue = 10\n    println(vetoableValue)  // \u8f93\u51fa: 10\n    vetoableValue = 5\n    println(vetoableValue)  // \u8f93\u51fa: 10 (\u56e0\u4e3a 5 \u4e0d\u5927\u4e8e 10)\n}\n</code></pre>"},{"location":"020Kotlin/010Basic/#4-map","title":"4. Map \u59d4\u6258","text":"<p><code>map</code> \u59d4\u6258\u5141\u8bb8\u5c06\u5c5e\u6027\u5b58\u50a8\u5728 <code>Map</code> \u4e2d\uff0c\u9002\u7528\u4e8e\u52a8\u6001\u5c5e\u6027\u573a\u666f\u3002</p> <pre><code>class User(val map: Map&lt;String, Any?&gt;) {\n    val name: String by map\n    val age: Int by map\n}\n\nfun main() {\n    val user = User(mapOf(\n        \"name\" to \"John\",\n        \"age\" to 25\n    ))\n    println(user.name)  // \u8f93\u51fa: John\n    println(user.age)   // \u8f93\u51fa: 25\n}\n</code></pre>"},{"location":"020Kotlin/010Basic/#_26","title":"\u5e38\u89c1\u4f7f\u7528\u6848\u4f8b","text":"<ol> <li>\u5ef6\u8fdf\u521d\u59cb\u5316\uff1a\u4f7f\u7528 <code>lazy</code> \u59d4\u6258\u5ef6\u8fdf\u521d\u59cb\u5316\u9ad8\u6210\u672c\u5c5e\u6027\u3002</li> <li>\u5c5e\u6027\u76d1\u542c\uff1a\u4f7f\u7528 <code>observable</code> \u6216 <code>vetoable</code> \u76d1\u542c\u5c5e\u6027\u53d8\u5316\u3002</li> <li>\u52a8\u6001\u5c5e\u6027\uff1a\u4f7f\u7528 <code>map</code> \u59d4\u6258\u5904\u7406\u52a8\u6001\u5c5e\u6027\u3002</li> <li>\u63a5\u53e3\u5b9e\u73b0\u59d4\u6258\uff1a\u901a\u8fc7\u7c7b\u59d4\u6258\u51cf\u5c11\u6837\u677f\u4ee3\u7801\uff0c\u907f\u514d\u591a\u91cd\u7ee7\u627f\u3002</li> </ol>"},{"location":"020Kotlin/010Basic/#_27","title":"\u603b\u7ed3","text":"<p>Kotlin \u7684\u59d4\u6258\u673a\u5236\u901a\u8fc7 <code>by</code> \u5173\u952e\u5b57\u7b80\u5316\u4e86\u4ee3\u7801\uff0c\u63d0\u5347\u4e86\u53ef\u7ef4\u62a4\u6027\u3002\u7c7b\u59d4\u6258\u548c\u5c5e\u6027\u59d4\u6258\u662f\u5176\u4e3b\u8981\u5f62\u5f0f\uff0c\u5e38\u89c1\u4e8e\u5ef6\u8fdf\u521d\u59cb\u5316\u3001\u5c5e\u6027\u76d1\u542c\u3001\u52a8\u6001\u5c5e\u6027\u7b49\u573a\u666f\u3002</p>"},{"location":"020Kotlin/010Basic/#kotlinandroid","title":"Kotlin\u59d4\u6258\u5728Android\u4e0a\u7684\u4e00\u4e9b\u5e94\u7528\u3002","text":"\u7b54\u6848 <p>\u5728 Android \u5f00\u53d1\u4e2d\uff0cKotlin \u7684\u59d4\u6258\u673a\u5236\u975e\u5e38\u6709\u7528\uff0c\u5c24\u5176\u662f\u5728\u7b80\u5316\u4ee3\u7801\u3001\u63d0\u9ad8\u53ef\u7ef4\u62a4\u6027\u548c\u51cf\u5c11\u6837\u677f\u4ee3\u7801\u65b9\u9762\u3002\u4ee5\u4e0b\u662f\u4e00\u4e9b\u5728 Android \u5e73\u53f0\u4e0a\u5e38\u89c1\u7684\u59d4\u6258\u4f7f\u7528\u573a\u666f\u548c\u4f8b\u5b50\uff1a</p>"},{"location":"020Kotlin/010Basic/#1-lazy-view","title":"1. <code>lazy</code> \u59d4\u6258\uff1a\u5ef6\u8fdf\u521d\u59cb\u5316 View","text":"<p>\u5728 Android \u4e2d\uff0c<code>findViewById</code> \u662f\u4e00\u4e2a\u5e38\u89c1\u7684\u64cd\u4f5c\uff0c\u4f46\u6bcf\u6b21\u8c03\u7528\u90fd\u6bd4\u8f83\u8017\u65f6\u3002\u4f7f\u7528 <code>lazy</code> \u59d4\u6258\u53ef\u4ee5\u5ef6\u8fdf\u521d\u59cb\u5316 View\uff0c\u76f4\u5230\u7b2c\u4e00\u6b21\u8bbf\u95ee\u65f6\u624d\u8fdb\u884c <code>findViewById</code>\u3002</p> <pre><code>class MainActivity : AppCompatActivity() {\n    // \u5ef6\u8fdf\u521d\u59cb\u5316 View\n    private val textView: TextView by lazy {\n        findViewById(R.id.text_view)\n    }\n\n    override fun onCreate(savedInstanceState: Bundle?) {\n        super.onCreate(savedInstanceState)\n        setContentView(R.layout.activity_main)\n\n        // \u7b2c\u4e00\u6b21\u8bbf\u95ee\u65f6\u521d\u59cb\u5316\n        textView.text = \"Hello, World!\"\n    }\n}\n</code></pre> <p>\u4f18\u70b9\uff1a - \u907f\u514d\u5728 <code>onCreate</code> \u4e2d\u4e00\u6b21\u6027\u521d\u59cb\u5316\u6240\u6709 View\uff0c\u63d0\u5347\u6027\u80fd\u3002 - \u4ee3\u7801\u66f4\u7b80\u6d01\u3002</p>"},{"location":"020Kotlin/010Basic/#2-observable_1","title":"2. <code>observable</code> \u59d4\u6258\uff1a\u76d1\u542c\u5c5e\u6027\u53d8\u5316","text":"<p>\u5728 Android \u4e2d\uff0c\u7ecf\u5e38\u9700\u8981\u76d1\u542c\u67d0\u4e9b\u5c5e\u6027\u7684\u53d8\u5316\uff08\u6bd4\u5982\u6570\u636e\u6a21\u578b\u7684\u66f4\u65b0\uff09\u3002\u4f7f\u7528 <code>observable</code> \u59d4\u6258\u53ef\u4ee5\u65b9\u4fbf\u5730\u5b9e\u73b0\u5c5e\u6027\u76d1\u542c\u3002</p> <pre><code>class UserViewModel : ViewModel() {\n    var name: String by Delegates.observable(\"\u9ed8\u8ba4\u503c\") { _, old, new -&gt;\n        println(\"\u540d\u5b57\u4ece $old \u53d8\u4e3a $new\")\n    }\n}\n\n// \u5728 Activity \u6216 Fragment \u4e2d\u4f7f\u7528\nval viewModel = UserViewModel()\nviewModel.name = \"John\"  // \u8f93\u51fa: \u540d\u5b57\u4ece \u9ed8\u8ba4\u503c \u53d8\u4e3a John\nviewModel.name = \"Alice\" // \u8f93\u51fa: \u540d\u5b57\u4ece John \u53d8\u4e3a Alice\n</code></pre> <p>\u4f18\u70b9\uff1a - \u4e0d\u9700\u8981\u624b\u52a8\u5199\u76d1\u542c\u5668\uff0c\u4ee3\u7801\u66f4\u7b80\u6d01\u3002 - \u9002\u5408 MVVM \u67b6\u6784\u4e2d\u7684\u6570\u636e\u7ed1\u5b9a\u3002</p>"},{"location":"020Kotlin/010Basic/#3-vetoable_1","title":"3. <code>vetoable</code> \u59d4\u6258\uff1a\u5c5e\u6027\u8d4b\u503c\u524d\u7684\u9a8c\u8bc1","text":"<p>\u5728 Android \u4e2d\uff0c\u6709\u65f6\u9700\u8981\u5bf9\u5c5e\u6027\u7684\u8d4b\u503c\u8fdb\u884c\u9a8c\u8bc1\uff08\u6bd4\u5982\u8f93\u5165\u6846\u7684\u503c\uff09\u3002\u4f7f\u7528 <code>vetoable</code> \u59d4\u6258\u53ef\u4ee5\u5728\u8d4b\u503c\u524d\u8fdb\u884c\u9a8c\u8bc1\u3002</p> <pre><code>class LoginViewModel : ViewModel() {\n    var password: String by Delegates.vetoable(\"\") { _, old, new -&gt;\n        // \u53ea\u6709\u65b0\u5bc6\u7801\u957f\u5ea6 &gt;= 6 \u65f6\u624d\u5141\u8bb8\u8d4b\u503c\n        new.length &gt;= 6\n    }\n}\n\n// \u5728 Activity \u6216 Fragment \u4e2d\u4f7f\u7528\nval viewModel = LoginViewModel()\nviewModel.password = \"123\"   // \u8d4b\u503c\u5931\u8d25\uff0c\u56e0\u4e3a\u957f\u5ea6\u4e0d\u8db3\nprintln(viewModel.password)  // \u8f93\u51fa: \"\"\nviewModel.password = \"123456\" // \u8d4b\u503c\u6210\u529f\nprintln(viewModel.password)  // \u8f93\u51fa: 123456\n</code></pre> <p>\u4f18\u70b9\uff1a - \u907f\u514d\u65e0\u6548\u6570\u636e\u8d4b\u503c\u3002 - \u903b\u8f91\u6e05\u6670\uff0c\u4ee3\u7801\u7b80\u6d01\u3002</p>"},{"location":"020Kotlin/010Basic/#4-map_1","title":"4. <code>map</code> \u59d4\u6258\uff1a\u52a8\u6001\u5c5e\u6027","text":"<p>\u5728 Android \u4e2d\uff0c\u6709\u65f6\u9700\u8981\u5904\u7406\u52a8\u6001\u5c5e\u6027\uff08\u6bd4\u5982\u4ece\u670d\u52a1\u5668\u8fd4\u56de\u7684 JSON \u6570\u636e\uff09\u3002\u4f7f\u7528 <code>map</code> \u59d4\u6258\u53ef\u4ee5\u5c06\u5c5e\u6027\u503c\u5b58\u50a8\u5728 <code>Map</code> \u4e2d\u3002</p> <pre><code>class User(val map: Map&lt;String, Any?&gt;) {\n    val name: String by map\n    val age: Int by map\n}\n\n// \u4ece\u670d\u52a1\u5668\u8fd4\u56de\u7684 JSON \u6570\u636e\nval json = mapOf(\n    \"name\" to \"John\",\n    \"age\" to 25\n)\n\n// \u4f7f\u7528 map \u59d4\u6258\nval user = User(json)\nprintln(user.name)  // \u8f93\u51fa: John\nprintln(user.age)   // \u8f93\u51fa: 25\n</code></pre> <p>\u4f18\u70b9\uff1a - \u9002\u5408\u5904\u7406\u52a8\u6001\u6570\u636e\u3002 - \u907f\u514d\u624b\u52a8\u89e3\u6790 JSON\u3002</p>"},{"location":"020Kotlin/010Basic/#5-sharedpreferences","title":"5. \u81ea\u5b9a\u4e49\u59d4\u6258\uff1a\u7b80\u5316 SharedPreferences \u8bbf\u95ee","text":"<p>\u5728 Android \u4e2d\uff0c\u8bbf\u95ee <code>SharedPreferences</code> \u662f\u4e00\u4e2a\u5e38\u89c1\u7684\u64cd\u4f5c\u3002\u901a\u8fc7\u81ea\u5b9a\u4e49\u59d4\u6258\uff0c\u53ef\u4ee5\u7b80\u5316 <code>SharedPreferences</code> \u7684\u8bfb\u5199\u3002</p> <pre><code>class PreferenceDelegate&lt;T&gt;(\n    private val context: Context,\n    private val name: String,\n    private val defaultValue: T\n) {\n    private val prefs by lazy {\n        context.getSharedPreferences(\"my_prefs\", Context.MODE_PRIVATE)\n    }\n\n    operator fun getValue(thisRef: Any?, property: KProperty&lt;*&gt;): T {\n        return when (defaultValue) {\n            is String -&gt; prefs.getString(name, defaultValue) as T\n            is Int -&gt; prefs.getInt(name, defaultValue) as T\n            is Boolean -&gt; prefs.getBoolean(name, defaultValue) as T\n            else -&gt; throw IllegalArgumentException(\"Unsupported type\")\n        }\n    }\n\n    operator fun setValue(thisRef: Any?, property: KProperty&lt;*&gt;, value: T) {\n        with(prefs.edit()) {\n            when (value) {\n                is String -&gt; putString(name, value)\n                is Int -&gt; putInt(name, value)\n                is Boolean -&gt; putBoolean(name, value)\n                else -&gt; throw IllegalArgumentException(\"Unsupported type\")\n            }\n            apply()\n        }\n    }\n}\n\n// \u5728 Activity \u4e2d\u4f7f\u7528\nclass MainActivity : AppCompatActivity() {\n    var username: String by PreferenceDelegate(this, \"username\", \"\u9ed8\u8ba4\u7528\u6237\")\n    var isLoggedIn: Boolean by PreferenceDelegate(this, \"is_logged_in\", false)\n\n    override fun onCreate(savedInstanceState: Bundle?) {\n        super.onCreate(savedInstanceState)\n        setContentView(R.layout.activity_main)\n\n        println(username)  // \u8bfb\u53d6 SharedPreferences \u4e2d\u7684\u503c\n        username = \"John\"  // \u5199\u5165 SharedPreferences\n    }\n}\n</code></pre> <p>\u4f18\u70b9\uff1a - \u7b80\u5316 <code>SharedPreferences</code> \u7684\u8bfb\u5199\u64cd\u4f5c\u3002 - \u4ee3\u7801\u66f4\u6613\u8bfb\u3001\u66f4\u6613\u7ef4\u62a4\u3002</p>"},{"location":"020Kotlin/010Basic/#6_2","title":"6. \u7c7b\u59d4\u6258\uff1a\u5b9e\u73b0\u63a5\u53e3\u7684\u9ed8\u8ba4\u884c\u4e3a","text":"<p>\u5728 Android \u4e2d\uff0c\u6709\u65f6\u9700\u8981\u5b9e\u73b0\u4e00\u4e9b\u63a5\u53e3\uff08\u6bd4\u5982 <code>RecyclerView.Adapter</code> \u6216 <code>View.OnClickListener</code>\uff09\uff0c\u4f46\u4e0d\u60f3\u5199\u592a\u591a\u6837\u677f\u4ee3\u7801\u3002\u901a\u8fc7\u7c7b\u59d4\u6258\uff0c\u53ef\u4ee5\u5c06\u63a5\u53e3\u7684\u5b9e\u73b0\u4ea4\u7ed9\u53e6\u4e00\u4e2a\u7c7b\u3002</p> <pre><code>class MyClickListener : View.OnClickListener {\n    override fun onClick(v: View?) {\n        println(\"\u70b9\u51fb\u4e8b\u4ef6\u89e6\u53d1\")\n    }\n}\n\nclass MyActivity : AppCompatActivity(), View.OnClickListener by MyClickListener() {\n    override fun onCreate(savedInstanceState: Bundle?) {\n        super.onCreate(savedInstanceState)\n        setContentView(R.layout.activity_main)\n\n        val button = findViewById&lt;Button&gt;(R.id.button)\n        button.setOnClickListener(this)\n    }\n}\n</code></pre> <p>\u4f18\u70b9\uff1a - \u51cf\u5c11\u6837\u677f\u4ee3\u7801\u3002 - \u63d0\u9ad8\u4ee3\u7801\u590d\u7528\u6027\u3002</p>"},{"location":"020Kotlin/010Basic/#7-lifecycle","title":"7. <code>Lifecycle</code> \u59d4\u6258\uff1a\u81ea\u52a8\u7ba1\u7406\u8d44\u6e90","text":"<p>\u5728 Android \u4e2d\uff0c\u7ecf\u5e38\u9700\u8981\u6839\u636e <code>Lifecycle</code> \u7684\u72b6\u6001\u6765\u7ba1\u7406\u8d44\u6e90\uff08\u6bd4\u5982\u6ce8\u518c\u548c\u6ce8\u9500\u76d1\u542c\u5668\uff09\u3002\u901a\u8fc7\u81ea\u5b9a\u4e49\u59d4\u6258\uff0c\u53ef\u4ee5\u81ea\u52a8\u7ba1\u7406\u8fd9\u4e9b\u8d44\u6e90\u3002</p> <pre><code>class LifecycleAwareDelegate&lt;T&gt;(\n    private val lifecycle: Lifecycle,\n    private val initialValue: T,\n    private val onStart: () -&gt; Unit,\n    private val onStop: () -&gt; Unit\n) : ReadWriteProperty&lt;Any?, T&gt; {\n\n    private var value: T = initialValue\n\n    init {\n        lifecycle.addObserver(object : LifecycleObserver {\n            @OnLifecycleEvent(Lifecycle.Event.ON_START)\n            fun onStart() {\n                onStart()\n            }\n\n            @OnLifecycleEvent(Lifecycle.Event.ON_STOP)\n            fun onStop() {\n                onStop()\n            }\n        })\n    }\n\n    override fun getValue(thisRef: Any?, property: KProperty&lt;*&gt;): T {\n        return value\n    }\n\n    override fun setValue(thisRef: Any?, property: KProperty&lt;*&gt;, value: T) {\n        this.value = value\n    }\n}\n\n// \u5728 Activity \u4e2d\u4f7f\u7528\nclass MainActivity : AppCompatActivity() {\n    private var data: String by LifecycleAwareDelegate(\n        lifecycle,\n        \"\u9ed8\u8ba4\u503c\",\n        onStart = { println(\"Activity \u8fdb\u5165\u524d\u53f0\") },\n        onStop = { println(\"Activity \u8fdb\u5165\u540e\u53f0\") }\n    )\n\n    override fun onCreate(savedInstanceState: Bundle?) {\n        super.onCreate(savedInstanceState)\n        setContentView(R.layout.activity_main)\n    }\n}\n</code></pre> <p>\u4f18\u70b9\uff1a - \u81ea\u52a8\u7ba1\u7406\u8d44\u6e90\uff0c\u907f\u514d\u5185\u5b58\u6cc4\u6f0f\u3002 - \u4ee3\u7801\u66f4\u7b80\u6d01\u3002</p>"},{"location":"020Kotlin/010Basic/#_28","title":"\u603b\u7ed3","text":"<p>\u5728 Android \u5f00\u53d1\u4e2d\uff0cKotlin \u7684\u59d4\u6258\u673a\u5236\u53ef\u4ee5\u5e2e\u52a9\u4f60\uff1a 1. \u5ef6\u8fdf\u521d\u59cb\u5316 View\uff08<code>lazy</code>\uff09\u3002 2. \u76d1\u542c\u5c5e\u6027\u53d8\u5316\uff08<code>observable</code>\uff09\u3002 3. \u9a8c\u8bc1\u5c5e\u6027\u8d4b\u503c\uff08<code>vetoable</code>\uff09\u3002 4. \u5904\u7406\u52a8\u6001\u5c5e\u6027\uff08<code>map</code>\uff09\u3002 5. \u7b80\u5316 <code>SharedPreferences</code> \u8bbf\u95ee\uff08\u81ea\u5b9a\u4e49\u59d4\u6258\uff09\u3002 6. \u51cf\u5c11\u63a5\u53e3\u5b9e\u73b0\u7684\u6837\u677f\u4ee3\u7801\uff08\u7c7b\u59d4\u6258\uff09\u3002 7. \u81ea\u52a8\u7ba1\u7406\u8d44\u6e90\uff08<code>Lifecycle</code> \u59d4\u6258\uff09\u3002</p> <p>\u8fd9\u4e9b\u573a\u666f\u90fd\u662f Android \u5f00\u53d1\u4e2d\u975e\u5e38\u5e38\u89c1\u7684\uff0c\u59d4\u6258\u53ef\u4ee5\u8ba9\u4f60\u7684\u4ee3\u7801\u66f4\u7b80\u6d01\u3001\u66f4\u6613\u7ef4\u62a4\uff01</p>"},{"location":"020Kotlin/010Basic/#kotlin_7","title":"Kotlin\u4e2d\u662f\u5426\u5b58\u5728\u6269\u5c55\u5c5e\u6027\uff1f","text":"\u7b54\u6848 <p>\u6269\u5c55\u5c5e\u6027 \u9664\u4e86\u51fd\u6570\uff0cKotlin \u4e5f\u652f\u6301\u5c5e\u6027\u5bf9\u5c5e\u6027\u8fdb\u884c\u6269\u5c55:</p> <p>val  List.lastIndex: Int     get() = size - 1 <p>\u6269\u5c55\u5c5e\u6027\u5141\u8bb8\u5b9a\u4e49\u5728\u7c7b\u6216\u8005kotlin\u6587\u4ef6\u4e2d\uff0c\u4e0d\u5141\u8bb8\u5b9a\u4e49\u5728\u51fd\u6570\u4e2d\u3002\u521d\u59cb\u5316\u5c5e\u6027\u56e0\u4e3a\u5c5e\u6027\u6ca1\u6709\u540e\u7aef\u5b57\u6bb5\uff08backing field\uff09\uff0c\u6240\u4ee5\u4e0d\u5141\u8bb8\u88ab\u521d\u59cb\u5316\uff0c\u53ea\u80fd\u7531\u663e\u5f0f\u63d0\u4f9b\u7684 getter/setter \u5b9a\u4e49\u3002</p> <p>val Foo.bar = 1 // \u9519\u8bef\uff1a\u6269\u5c55\u5c5e\u6027\u4e0d\u80fd\u6709\u521d\u59cb\u5316\u5668 \u6269\u5c55\u5c5e\u6027\u53ea\u80fd\u88ab\u58f0\u660e\u4e3a val\u3002</p> <p>\u5728Kotlin\u4e2d\uff0c\u6269\u5c55\u5c5e\u6027\u5141\u8bb8\u4f60\u4e3a\u73b0\u6709\u7c7b\u6dfb\u52a0\u65b0\u7684\u5c5e\u6027\uff0c\u800c\u65e0\u9700\u4fee\u6539\u5176\u6e90\u4ee3\u7801\u6216\u4f7f\u7528\u7ee7\u627f\u3002\u6269\u5c55\u5c5e\u6027\u901a\u8fc7\u63d0\u4f9b\u81ea\u5b9a\u4e49\u7684getter\u548csetter\u6765\u5b9e\u73b0\uff0c\u7c7b\u4f3c\u4e8e\u6269\u5c55\u51fd\u6570\u3002</p>"},{"location":"020Kotlin/010Basic/#_29","title":"\u5b9a\u4e49\u6269\u5c55\u5c5e\u6027","text":"<p>\u6269\u5c55\u5c5e\u6027\u7684\u5b9a\u4e49\u8bed\u6cd5\u5982\u4e0b\uff1a</p> <pre><code>val &lt;T&gt; ClassName&lt;T&gt;.propertyName: PropertyType\n    get() = // \u81ea\u5b9a\u4e49getter\u903b\u8f91\n\nvar &lt;T&gt; ClassName&lt;T&gt;.propertyName: PropertyType\n    get() = // \u81ea\u5b9a\u4e49getter\u903b\u8f91\n    set(value) { // \u81ea\u5b9a\u4e49setter\u903b\u8f91 }\n</code></pre>"},{"location":"020Kotlin/010Basic/#_30","title":"\u793a\u4f8b","text":"<p>\u5047\u8bbe\u4f60\u60f3\u4e3a<code>String</code>\u7c7b\u6dfb\u52a0\u4e00\u4e2a<code>isPalindrome</code>\u5c5e\u6027\uff0c\u7528\u4e8e\u5224\u65ad\u5b57\u7b26\u4e32\u662f\u5426\u4e3a\u56de\u6587\uff1a</p> <pre><code>val String.isPalindrome: Boolean\n    get() = this == this.reversed()\n</code></pre> <p>\u4f7f\u7528\u65f6\uff1a</p> <pre><code>val text = \"racecar\"\nprintln(text.isPalindrome) // \u8f93\u51fa: true\n</code></pre>"},{"location":"020Kotlin/010Basic/#_31","title":"\u597d\u5904","text":"<ol> <li>\u589e\u5f3a\u73b0\u6709\u7c7b\uff1a\u65e0\u9700\u4fee\u6539\u7c7b\u6e90\u4ee3\u7801\u5373\u53ef\u4e3a\u5176\u6dfb\u52a0\u65b0\u5c5e\u6027\u3002</li> <li>\u4ee3\u7801\u7ec4\u7ec7\uff1a\u5c06\u4e0e\u7c7b\u76f8\u5173\u7684\u5c5e\u6027\u96c6\u4e2d\u7ba1\u7406\uff0c\u63d0\u5347\u4ee3\u7801\u53ef\u8bfb\u6027\u3002</li> <li>\u51cf\u5c11\u7ee7\u627f\uff1a\u907f\u514d\u901a\u8fc7\u7ee7\u627f\u6269\u5c55\u529f\u80fd\uff0c\u4fdd\u6301\u7c7b\u5c42\u6b21\u7b80\u6d01\u3002</li> </ol>"},{"location":"020Kotlin/010Basic/#_32","title":"\u9650\u5236","text":"<ol> <li>\u65e0\u5b9e\u9645\u6210\u5458\uff1a\u6269\u5c55\u5c5e\u6027\u4e0d\u4f1a\u5728\u7c7b\u4e2d\u63d2\u5165\u5b9e\u9645\u6210\u5458\uff0c\u53ea\u662f\u8bed\u6cd5\u7cd6\u3002</li> <li>\u8bbf\u95ee\u9650\u5236\uff1a\u53ea\u80fd\u8bbf\u95ee\u7c7b\u7684\u516c\u6709\u6210\u5458\uff0c\u65e0\u6cd5\u8bbf\u95ee\u79c1\u6709\u6216\u53d7\u4fdd\u62a4\u6210\u5458\u3002</li> <li>\u547d\u540d\u51b2\u7a81\uff1a\u5982\u679c\u6269\u5c55\u5c5e\u6027\u4e0e\u7c7b\u73b0\u6709\u6210\u5458\u540c\u540d\uff0c\u7c7b\u6210\u5458\u4f18\u5148\u3002</li> <li>\u521d\u59cb\u5316\u9650\u5236\uff1a\u6269\u5c55\u5c5e\u6027\u4e0d\u80fd\u6709\u521d\u59cb\u5316\u5668\uff0c\u5fc5\u987b\u901a\u8fc7getter\u548csetter\u5b9a\u4e49\u884c\u4e3a\u3002</li> </ol>"},{"location":"020Kotlin/010Basic/#_33","title":"\u603b\u7ed3","text":"<p>\u6269\u5c55\u5c5e\u6027\u4e3a\u73b0\u6709\u7c7b\u6dfb\u52a0\u65b0\u5c5e\u6027\u63d0\u4f9b\u4e86\u4fbf\u6377\u65b9\u5f0f\uff0c\u589e\u5f3a\u4e86\u4ee3\u7801\u7684\u53ef\u8bfb\u6027\u548c\u53ef\u7ef4\u62a4\u6027\uff0c\u4f46\u9700\u6ce8\u610f\u5176\u8bbf\u95ee\u9650\u5236\u548c\u547d\u540d\u51b2\u7a81\u95ee\u9898\u3002</p>"},{"location":"020Kotlin/010Basic/#kotlin_8","title":"Kotlin\u6269\u5c55\u5c5e\u6027\u6848\u4f8b","text":"\u7b54\u6848"},{"location":"020Kotlin/010Basic/#1-mutablelist-lastindex","title":"\u6848\u4f8b 1\uff1a\u4e3a <code>MutableList</code> \u6dfb\u52a0 <code>lastIndex</code> \u6269\u5c55\u5c5e\u6027","text":"<p>\u4e3a <code>MutableList</code> \u6dfb\u52a0\u4e00\u4e2a <code>lastIndex</code> \u5c5e\u6027\uff0c\u8fd4\u56de\u5217\u8868\u7684\u6700\u540e\u4e00\u4e2a\u7d22\u5f15\u3002</p> <pre><code>val &lt;T&gt; List&lt;T&gt;.lastIndex: Int\n    get() = this.size - 1\n</code></pre> <p>\u4f7f\u7528\u793a\u4f8b\uff1a</p> <pre><code>val list = listOf(\"a\", \"b\", \"c\")\nprintln(list.lastIndex) // \u8f93\u51fa: 2\n</code></pre>"},{"location":"020Kotlin/010Basic/#2-string-reversedtext","title":"\u6848\u4f8b 2\uff1a\u4e3a <code>String</code> \u6dfb\u52a0\u53ef\u8bfb\u5199\u7684 <code>reversedText</code> \u6269\u5c55\u5c5e\u6027","text":"<p>\u4e3a <code>String</code> \u6dfb\u52a0\u4e00\u4e2a <code>reversedText</code> \u5c5e\u6027\uff0c\u53ef\u4ee5\u83b7\u53d6\u53cd\u8f6c\u540e\u7684\u5b57\u7b26\u4e32</p> <pre><code>var String.reversedText: String\n    get() = this.reversed()\n\n    set(value) { // \u4e0d\u80fdset \uff0c\u540c\u65f6\u4e5f\u4e0d\u80fdvar\u3002\u53ea\u80fdval\u3002\n        this = value.reversed()\n    }\n\n// \u6269\u5c55\u51fd\u6570\uff1a\u53cd\u8f6c\u5b57\u7b26\u4e32\nfun String.reversedText(): String {\n    return this.reversed()\n}\n\n// \u6269\u5c55\u51fd\u6570\uff1a\u8bbe\u7f6e\u53cd\u8f6c\u540e\u7684\u5b57\u7b26\u4e32\nfun String.setReversedText(value: String): String {\n    return value.reversed()\n}\n\n// \u4f7f\u7528\u793a\u4f8b\nvar text = \"hello\"\nprintln(text.reversedText()) // \u8f93\u51fa: olleh\ntext = text.setReversedText(\"world\")\nprintln(text) // \u8f93\u51fa: dlrow\n</code></pre> <p>\u4f7f\u7528\u793a\u4f8b\uff1a</p> <pre><code>var text = \"hello\"\nprintln(text.reversedText) // \u8f93\u51fa: olleh\ntext.reversedText = \"world\"\nprintln(text) // \u8f93\u51fa: dlrow\n</code></pre>"},{"location":"020Kotlin/010Basic/#3-map-keysaslist","title":"\u6848\u4f8b 3\uff1a\u4e3a <code>Map</code> \u6dfb\u52a0\u6cdb\u578b\u6269\u5c55\u5c5e\u6027 <code>keysAsList</code>","text":"<p>\u4e3a <code>Map</code> \u6dfb\u52a0\u4e00\u4e2a\u6cdb\u578b\u6269\u5c55\u5c5e\u6027 <code>keysAsList</code>\uff0c\u5c06 <code>Map</code> \u7684\u952e\u8f6c\u6362\u4e3a <code>List</code>\u3002</p> <pre><code>val &lt;K, V&gt; Map&lt;K, V&gt;.keysAsList: List&lt;K&gt;\n    get() = this.keys.toList()\n</code></pre> <p>\u4f7f\u7528\u793a\u4f8b\uff1a</p> <pre><code>val map = mapOf(1 to \"one\", 2 to \"two\", 3 to \"three\")\nprintln(map.keysAsList) // \u8f93\u51fa: [1, 2, 3]\n</code></pre>"},{"location":"020Kotlin/010Basic/#4-int-iseven","title":"\u6848\u4f8b 4\uff1a\u4e3a <code>Int</code> \u6dfb\u52a0 <code>isEven</code> \u6269\u5c55\u5c5e\u6027","text":"<p>\u4e3a <code>Int</code> \u6dfb\u52a0\u4e00\u4e2a <code>isEven</code> \u5c5e\u6027\uff0c\u5224\u65ad\u6574\u6570\u662f\u5426\u4e3a\u5076\u6570\u3002</p> <pre><code>val Int.isEven: Boolean\n    get() = this % 2 == 0\n</code></pre> <p>\u4f7f\u7528\u793a\u4f8b\uff1a</p> <pre><code>val number = 4\nprintln(number.isEven) // \u8f93\u51fa: true\n</code></pre>"},{"location":"020Kotlin/010Basic/#5-pair-swapped","title":"\u6848\u4f8b 5\uff1a\u4e3a <code>Pair</code> \u6dfb\u52a0\u6cdb\u578b\u6269\u5c55\u5c5e\u6027 <code>swapped</code>","text":"<p>\u4e3a <code>Pair</code> \u6dfb\u52a0\u4e00\u4e2a\u6cdb\u578b\u6269\u5c55\u5c5e\u6027 <code>swapped</code>\uff0c\u8fd4\u56de\u4e00\u4e2a\u4ea4\u6362\u4e86\u952e\u503c\u7684\u65b0 <code>Pair</code>\u3002</p> <pre><code>val &lt;A, B&gt; Pair&lt;A, B&gt;.swapped: Pair&lt;B, A&gt;\n    get() = Pair(this.second, this.first)\n</code></pre> <p>\u4f7f\u7528\u793a\u4f8b\uff1a</p> <pre><code>val pair = Pair(\"key\", \"value\")\nprintln(pair.swapped) // \u8f93\u51fa: (value, key)\n</code></pre>"},{"location":"020Kotlin/010Basic/#6-file-ishidden","title":"\u6848\u4f8b 6\uff1a\u4e3a <code>File</code> \u6dfb\u52a0 <code>isHidden</code> \u6269\u5c55\u5c5e\u6027","text":"<p>\u4e3a <code>File</code> \u6dfb\u52a0\u4e00\u4e2a <code>isHidden</code> \u5c5e\u6027\uff0c\u5224\u65ad\u6587\u4ef6\u662f\u5426\u4e3a\u9690\u85cf\u6587\u4ef6\u3002</p> <pre><code>import java.io.File\n\nval File.isHidden: Boolean\n    get() = this.isHidden\n</code></pre> <p>\u4f7f\u7528\u793a\u4f8b\uff1a</p> <pre><code>val file = File(\"path/to/file.txt\")\nprintln(file.isHidden) // \u8f93\u51fa: true \u6216 false\n</code></pre>"},{"location":"020Kotlin/010Basic/#7-localdate-isleapyear","title":"\u6848\u4f8b 7\uff1a\u4e3a <code>LocalDate</code> \u6dfb\u52a0 <code>isLeapYear</code> \u6269\u5c55\u5c5e\u6027","text":"<p>\u4e3a <code>LocalDate</code> \u6dfb\u52a0\u4e00\u4e2a <code>isLeapYear</code> \u5c5e\u6027\uff0c\u5224\u65ad\u5f53\u524d\u65e5\u671f\u662f\u5426\u5c5e\u4e8e\u95f0\u5e74\u3002</p> <pre><code>import java.time.LocalDate\n\nval LocalDate.isLeapYear: Boolean\n    get() = this.year % 4 == 0 &amp;&amp; (this.year % 100 != 0 || this.year % 400 == 0)\n</code></pre> <p>\u4f7f\u7528\u793a\u4f8b\uff1a</p> <pre><code>val date = LocalDate.of(2024, 1, 1)\nprintln(date.isLeapYear) // \u8f93\u51fa: true\n</code></pre>"},{"location":"020Kotlin/010Basic/#_34","title":"\u603b\u7ed3","text":"<p>\u901a\u8fc7\u8fd9\u4e9b\u6848\u4f8b\u53ef\u4ee5\u770b\u51fa\uff0c\u6269\u5c55\u5c5e\u6027\u975e\u5e38\u7075\u6d3b\uff0c\u80fd\u591f\u4e3a\u73b0\u6709\u7c7b\u6dfb\u52a0\u65b0\u7684\u529f\u80fd\uff0c\u540c\u65f6\u652f\u6301\u6cdb\u578b\u548c\u81ea\u5b9a\u4e49\u7684 <code>get</code> \u548c <code>set</code> \u903b\u8f91\u3002\u5408\u7406\u4f7f\u7528\u6269\u5c55\u5c5e\u6027\u53ef\u4ee5\u663e\u8457\u63d0\u5347\u4ee3\u7801\u7684\u53ef\u8bfb\u6027\u548c\u53ef\u7ef4\u62a4\u6027\u3002\u6ce8\u610f\u4e0d\u80fd\u4f7f\u7528var\u53bb\u58f0\u660e\u3002</p>"},{"location":"020Kotlin/010Basic/#kotlin-anyjava-object","title":"\u8bf7\u95eeKotlin Any\u548cJava \u7684Object\u7c7b\u6709\u4ec0\u4e48\u533a\u522b?","text":"\u7b54\u6848 <p>Kotlin \u7684 <code>Any</code> \u7c7b\u548c Java \u7684 <code>Object</code> \u7c7b\u5728\u529f\u80fd\u4e0a\u975e\u5e38\u76f8\u4f3c\uff0c\u90fd\u662f\u6240\u6709\u7c7b\u7684\u8d85\u7c7b\uff0c\u4f46\u5b83\u4eec\u6709\u4e00\u4e9b\u5173\u952e\u533a\u522b\uff1a</p>"},{"location":"020Kotlin/010Basic/#1_7","title":"1. \u7c7b\u5c42\u6b21\u7ed3\u6784","text":"<ul> <li>Kotlin \u7684 <code>Any</code>: \u5728 Kotlin \u4e2d\uff0c<code>Any</code> \u662f\u6240\u6709\u7c7b\u7684\u8d85\u7c7b\uff0c\u5305\u62ec\u57fa\u672c\u6570\u636e\u7c7b\u578b\uff08\u5982 <code>Int</code>\u3001<code>Boolean</code> \u7b49\uff09\u7684\u88c5\u7bb1\u7c7b\u578b\u3002Kotlin \u7684\u57fa\u672c\u6570\u636e\u7c7b\u578b\uff08\u5982 <code>Int</code>\u3001<code>Boolean</code> \u7b49\uff09\u5728\u5e95\u5c42\u4f1a\u88ab\u7f16\u8bd1\u4e3a Java \u7684\u57fa\u672c\u7c7b\u578b\uff08\u5982 <code>int</code>\u3001<code>boolean</code> \u7b49\uff09\uff0c\u4f46\u5728 Kotlin \u4e2d\u5b83\u4eec\u4ecd\u7136\u7ee7\u627f\u81ea <code>Any</code>\u3002</li> <li>Java \u7684 <code>Object</code>: \u5728 Java \u4e2d\uff0c<code>Object</code> \u662f\u6240\u6709\u7c7b\u7684\u8d85\u7c7b\uff0c\u4f46\u57fa\u672c\u6570\u636e\u7c7b\u578b\uff08\u5982 <code>int</code>\u3001<code>boolean</code> \u7b49\uff09\u5e76\u4e0d\u7ee7\u627f\u81ea <code>Object</code>\u3002\u53ea\u6709\u5f15\u7528\u7c7b\u578b\uff08\u5982 <code>Integer</code>\u3001<code>Boolean</code> \u7b49\uff09\u7ee7\u627f\u81ea <code>Object</code>\u3002</li> </ul>"},{"location":"020Kotlin/010Basic/#2_6","title":"2. \u65b9\u6cd5","text":"<ul> <li>Kotlin \u7684 <code>Any</code>: <code>Any</code> \u7c7b\u6709\u4e09\u4e2a\u65b9\u6cd5\uff1a<ul> <li><code>equals(other: Any?): Boolean</code></li> <li><code>hashCode(): Int</code></li> <li><code>toString(): String</code></li> </ul> </li> <li>Java \u7684 <code>Object</code>: <code>Object</code> \u7c7b\u6709\u66f4\u591a\u7684\u65b9\u6cd5\uff0c\u5305\u62ec\uff1a<ul> <li><code>equals(Object obj)</code></li> <li><code>hashCode()</code></li> <li><code>toString()</code></li> <li><code>clone()</code></li> <li><code>finalize()</code></li> <li><code>getClass()</code></li> <li><code>notify()</code></li> <li><code>notifyAll()</code></li> <li><code>wait()</code></li> <li><code>wait(long timeout)</code></li> <li><code>wait(long timeout, int nanos)</code></li> </ul> </li> </ul> <p>Kotlin \u7684 <code>Any</code> \u7c7b\u6ca1\u6709 <code>clone()</code>\u3001<code>finalize()</code>\u3001<code>getClass()</code>\u3001<code>notify()</code>\u3001<code>notifyAll()</code> \u548c <code>wait()</code> \u7b49\u65b9\u6cd5\u3002\u8fd9\u4e9b\u65b9\u6cd5\u5728 Kotlin \u4e2d\u53ef\u4ee5\u901a\u8fc7\u5176\u4ed6\u65b9\u5f0f\u4f7f\u7528\uff0c\u4f8b\u5982\u901a\u8fc7 Java \u4e92\u64cd\u4f5c\u6027\u3002</p>"},{"location":"020Kotlin/010Basic/#3_6","title":"3. \u53ef\u7a7a\u6027","text":"<ul> <li>Kotlin \u7684 <code>Any</code>: <code>Any</code> \u662f\u975e\u7a7a\u7c7b\u578b\uff0c<code>Any?</code> \u662f\u53ef\u7a7a\u7c7b\u578b\u3002Kotlin \u7684\u7c7b\u578b\u7cfb\u7edf\u660e\u786e\u533a\u5206\u4e86\u53ef\u7a7a\u548c\u975e\u7a7a\u7c7b\u578b\u3002</li> <li>Java \u7684 <code>Object</code>: <code>Object</code> \u672c\u8eab\u6ca1\u6709\u53ef\u7a7a\u6027\u6982\u5ff5\uff0c\u56e0\u4e3a Java \u7684\u7c7b\u578b\u7cfb\u7edf\u4e0d\u652f\u6301\u53ef\u7a7a\u6027\u3002\u5728 Java \u4e2d\uff0c\u4efb\u4f55\u5bf9\u8c61\u5f15\u7528\u90fd\u53ef\u4ee5\u4e3a <code>null</code>\u3002</li> </ul>"},{"location":"020Kotlin/010Basic/#4_5","title":"4. \u6269\u5c55\u51fd\u6570","text":"<ul> <li>Kotlin \u7684 <code>Any</code>: Kotlin \u5141\u8bb8\u4e3a <code>Any</code> \u7c7b\u5b9a\u4e49\u6269\u5c55\u51fd\u6570\uff0c\u8fd9\u610f\u5473\u7740\u4f60\u53ef\u4ee5\u5728\u4efb\u4f55\u5bf9\u8c61\u4e0a\u8c03\u7528\u8fd9\u4e9b\u6269\u5c55\u51fd\u6570\u3002</li> <li>Java \u7684 <code>Object</code>: Java \u4e0d\u652f\u6301\u6269\u5c55\u51fd\u6570\uff0c\u56e0\u6b64\u4f60\u4e0d\u80fd\u4e3a <code>Object</code> \u7c7b\u6dfb\u52a0\u65b0\u7684\u65b9\u6cd5\u3002</li> </ul>"},{"location":"020Kotlin/010Basic/#5_5","title":"5. \u5e73\u53f0\u7c7b\u578b","text":"<ul> <li>\u5728 Kotlin \u4e2d\uff0c\u5f53\u4e0e Java \u4ee3\u7801\u4e92\u64cd\u4f5c\u65f6\uff0cKotlin \u4f1a\u5c06 Java \u7684 <code>Object</code> \u7c7b\u578b\u89c6\u4e3a\u5e73\u53f0\u7c7b\u578b\uff08<code>T!</code>\uff09\uff0c\u8fd9\u610f\u5473\u7740\u5b83\u65e2\u53ef\u4ee5\u662f\u975e\u7a7a\u7684\u4e5f\u53ef\u4ee5\u662f\u53ef\u7a7a\u7684\uff0c\u5177\u4f53\u53d6\u51b3\u4e8e\u4e0a\u4e0b\u6587\u3002</li> </ul>"},{"location":"020Kotlin/010Basic/#_35","title":"\u603b\u7ed3","text":"<ul> <li><code>Any</code> \u662f Kotlin \u4e2d\u6240\u6709\u7c7b\u7684\u8d85\u7c7b\uff0c\u5305\u62ec\u57fa\u672c\u6570\u636e\u7c7b\u578b\u7684\u88c5\u7bb1\u7c7b\u578b\u3002</li> <li><code>Object</code> \u662f Java \u4e2d\u6240\u6709\u7c7b\u7684\u8d85\u7c7b\uff0c\u4f46\u4e0d\u5305\u62ec\u57fa\u672c\u6570\u636e\u7c7b\u578b\u3002</li> <li><code>Any</code> \u7684\u65b9\u6cd5\u6bd4 <code>Object</code> \u5c11\uff0c\u4f46 Kotlin \u63d0\u4f9b\u4e86\u5176\u4ed6\u673a\u5236\u6765\u5904\u7406\u8fd9\u4e9b\u529f\u80fd\u3002</li> <li>Kotlin \u7684\u7c7b\u578b\u7cfb\u7edf\u652f\u6301\u53ef\u7a7a\u6027\uff0c\u800c Java \u4e0d\u652f\u6301\u3002</li> </ul> <p>\u8fd9\u4e9b\u533a\u522b\u4f7f\u5f97 Kotlin \u7684\u7c7b\u578b\u7cfb\u7edf\u66f4\u52a0\u5b89\u5168\u548c\u8868\u8fbe\u529b\u66f4\u5f3a\uff0c\u540c\u65f6\u4fdd\u6301\u4e86\u4e0e Java \u7684\u4e92\u64cd\u4f5c\u6027\u3002</p>"},{"location":"020Kotlin/010Basic/#anyobject","title":"\u90a3\u8bf7\u95eeAny\u7684\u5e95\u5c42\u539f\u7406\u662f\u4ec0\u4e48\uff1f\u548cObject\u6709\u5173\u7cfb\u5417\uff1f","text":"\u7b54\u6848 <p>Kotlin \u7684 <code>Any</code> \u7c7b\u5728\u5e95\u5c42\u786e\u5b9e\u4e0e Java \u7684 <code>Object</code> \u7c7b\u6709\u76f4\u63a5\u5173\u7cfb\uff0c\u56e0\u4e3a Kotlin \u6700\u7ec8\u4f1a\u88ab\u7f16\u8bd1\u6210 JVM \u5b57\u8282\u7801\uff0c\u800c JVM \u7684\u7c7b\u7ee7\u627f\u4f53\u7cfb\u662f\u57fa\u4e8e Java \u7684 <code>Object</code> \u7c7b\u7684\u3002\u4ee5\u4e0b\u662f <code>Any</code> \u7684\u5e95\u5c42\u539f\u7406\u53ca\u5176\u4e0e <code>Object</code> \u7684\u5173\u7cfb\uff1a</p>"},{"location":"020Kotlin/010Basic/#1-any","title":"1. <code>Any</code> \u7684\u5e95\u5c42\u5b9e\u73b0","text":"<ul> <li>\u5728 Kotlin \u4e2d\uff0c<code>Any</code> \u662f\u6240\u6709\u7c7b\u7684\u8d85\u7c7b\uff0c\u5305\u62ec\u57fa\u672c\u6570\u636e\u7c7b\u578b\u7684\u88c5\u7bb1\u7c7b\u578b\uff08\u5982 <code>Int</code>\u3001<code>Boolean</code> \u7b49\uff09\u3002</li> <li>\u5f53 Kotlin \u4ee3\u7801\u88ab\u7f16\u8bd1\u4e3a JVM \u5b57\u8282\u7801\u65f6\uff0c<code>Any</code> \u4f1a\u88ab\u6620\u5c04\u4e3a Java \u7684 <code>Object</code> \u7c7b\u3002\u4e5f\u5c31\u662f\u8bf4\uff0cKotlin \u7684 <code>Any</code> \u5728 JVM \u5c42\u9762\u5b9e\u9645\u4e0a\u5c31\u662f <code>java.lang.Object</code>\u3002</li> <li>\u4f8b\u5982\uff0cKotlin \u4e2d\u7684 <code>Any</code> \u7c7b\u578b\u53d8\u91cf\u5728\u7f16\u8bd1\u540e\u4f1a\u53d8\u6210 Java \u7684 <code>Object</code> \u7c7b\u578b\u3002</li> </ul>"},{"location":"020Kotlin/010Basic/#2-any-object","title":"2. <code>Any</code> \u7684\u65b9\u6cd5\u4e0e <code>Object</code> \u7684\u5173\u7cfb","text":"<ul> <li>Kotlin \u7684 <code>Any</code> \u7c7b\u63d0\u4f9b\u4e86\u4e09\u4e2a\u65b9\u6cd5\uff1a<code>equals()</code>\u3001<code>hashCode()</code> \u548c <code>toString()</code>\u3002</li> <li>\u8fd9\u4e9b\u65b9\u6cd5\u5728\u5e95\u5c42\u76f4\u63a5\u5bf9\u5e94 Java <code>Object</code> \u7c7b\u4e2d\u7684\u540c\u540d\u65b9\u6cd5\uff1a<ul> <li><code>Any.equals()</code> \u2192 <code>Object.equals()</code></li> <li><code>Any.hashCode()</code> \u2192 <code>Object.hashCode()</code></li> <li><code>Any.toString()</code> \u2192 <code>Object.toString()</code></li> </ul> </li> <li>\u56e0\u6b64\uff0cKotlin \u7684 <code>Any</code> \u65b9\u6cd5\u5b9e\u9645\u4e0a\u662f\u901a\u8fc7\u8c03\u7528 Java <code>Object</code> \u7684\u5bf9\u5e94\u65b9\u6cd5\u6765\u5b9e\u73b0\u7684\u3002</li> </ul>"},{"location":"020Kotlin/010Basic/#3-any-object","title":"3. \u4e3a\u4ec0\u4e48 <code>Any</code> \u6ca1\u6709 <code>Object</code> \u7684\u5176\u4ed6\u65b9\u6cd5\uff1f","text":"<ul> <li>Java \u7684 <code>Object</code> \u7c7b\u63d0\u4f9b\u4e86\u66f4\u591a\u65b9\u6cd5\uff0c\u4f8b\u5982 <code>wait()</code>\u3001<code>notify()</code>\u3001<code>getClass()</code> \u7b49\u3002</li> <li>Kotlin \u7684 <code>Any</code> \u7c7b\u6ca1\u6709\u76f4\u63a5\u66b4\u9732\u8fd9\u4e9b\u65b9\u6cd5\uff0c\u56e0\u4e3a Kotlin \u7684\u8bbe\u8ba1\u76ee\u6807\u662f\u63d0\u4f9b\u66f4\u7b80\u6d01\u548c\u5b89\u5168\u7684 API\u3002</li> <li>\u5982\u679c\u9700\u8981\u4f7f\u7528\u8fd9\u4e9b\u65b9\u6cd5\uff0c\u53ef\u4ee5\u901a\u8fc7 Kotlin \u4e0e Java \u7684\u4e92\u64cd\u4f5c\u6027\u6765\u8c03\u7528\u3002\u4f8b\u5982\uff1a     <pre><code>val obj: Any = \"Hello\"\n(obj as java.lang.Object).wait() // \u901a\u8fc7\u7c7b\u578b\u8f6c\u6362\u8c03\u7528 Java \u7684 Object \u65b9\u6cd5\n</code></pre></li> </ul>"},{"location":"020Kotlin/010Basic/#4_6","title":"4. \u57fa\u672c\u6570\u636e\u7c7b\u578b\u7684\u5904\u7406","text":"<ul> <li>\u5728 Kotlin \u4e2d\uff0c\u57fa\u672c\u6570\u636e\u7c7b\u578b\uff08\u5982 <code>Int</code>\u3001<code>Boolean</code> \u7b49\uff09\u5728\u5e95\u5c42\u4f1a\u88ab\u7f16\u8bd1\u4e3a JVM \u7684\u57fa\u672c\u7c7b\u578b\uff08\u5982 <code>int</code>\u3001<code>boolean</code> \u7b49\uff09\u3002</li> <li>\u7136\u800c\uff0cKotlin \u7684\u7c7b\u578b\u7cfb\u7edf\u5c06\u8fd9\u4e9b\u57fa\u672c\u6570\u636e\u7c7b\u578b\u89c6\u4e3a <code>Any</code> \u7684\u5b50\u7c7b\u3002\u8fd9\u610f\u5473\u7740\u5728 Kotlin \u4e2d\uff0c\u4f60\u53ef\u4ee5\u5c06\u57fa\u672c\u6570\u636e\u7c7b\u578b\u8d4b\u503c\u7ed9 <code>Any</code> \u7c7b\u578b\u7684\u53d8\u91cf\uff1a     <pre><code>val number: Any = 42 // Int \u88ab\u81ea\u52a8\u88c5\u7bb1\u4e3a Integer\n</code></pre></li> <li>\u5728\u7f16\u8bd1\u540e\u7684\u5b57\u8282\u7801\u4e2d\uff0c<code>number</code> \u5b9e\u9645\u4e0a\u662f\u4e00\u4e2a <code>java.lang.Integer</code> \u5bf9\u8c61\uff0c\u800c <code>Integer</code> \u662f <code>Object</code> \u7684\u5b50\u7c7b\u3002</li> </ul>"},{"location":"020Kotlin/010Basic/#5-any","title":"5. \u53ef\u7a7a\u7c7b\u578b (<code>Any?</code>) \u7684\u5904\u7406","text":"<ul> <li>Kotlin \u7684\u7c7b\u578b\u7cfb\u7edf\u533a\u5206\u4e86\u53ef\u7a7a\u7c7b\u578b\u548c\u975e\u7a7a\u7c7b\u578b\u3002<code>Any</code> \u662f\u975e\u7a7a\u7c7b\u578b\uff0c\u800c <code>Any?</code> \u662f\u53ef\u7a7a\u7c7b\u578b\u3002</li> <li>\u5728\u7f16\u8bd1\u540e\u7684\u5b57\u8282\u7801\u4e2d\uff0c<code>Any?</code> \u4f1a\u88ab\u6620\u5c04\u4e3a <code>Object</code>\uff0c\u4f46 Kotlin \u7f16\u8bd1\u5668\u4f1a\u751f\u6210\u989d\u5916\u7684\u7a7a\u68c0\u67e5\u4ee3\u7801\u6765\u786e\u4fdd\u7c7b\u578b\u5b89\u5168\u3002</li> <li>\u4f8b\u5982\uff1a     <pre><code>val nullable: Any? = null\n</code></pre>     \u5728\u5b57\u8282\u7801\u4e2d\uff0c<code>nullable</code> \u662f\u4e00\u4e2a <code>Object</code> \u7c7b\u578b\u7684\u53d8\u91cf\uff0c\u4f46 Kotlin \u7f16\u8bd1\u5668\u4f1a\u5728\u8bbf\u95ee\u5b83\u65f6\u63d2\u5165\u7a7a\u68c0\u67e5\u903b\u8f91\u3002</li> </ul>"},{"location":"020Kotlin/010Basic/#6-any-object","title":"6. \u603b\u7ed3\uff1a<code>Any</code> \u548c <code>Object</code> \u7684\u5173\u7cfb","text":"<ul> <li><code>Any</code> \u662f Kotlin \u8bed\u8a00\u5c42\u9762\u7684\u62bd\u8c61\uff0c\u7528\u4e8e\u7edf\u4e00\u6240\u6709\u7c7b\u578b\uff08\u5305\u62ec\u57fa\u672c\u6570\u636e\u7c7b\u578b\uff09\u7684\u8d85\u7c7b\u3002</li> <li><code>Object</code> \u662f JVM \u5c42\u9762\u7684\u5b9e\u73b0\uff0cKotlin \u7684 <code>Any</code> \u5728\u7f16\u8bd1\u540e\u4f1a\u6620\u5c04\u4e3a Java \u7684 <code>Object</code>\u3002</li> <li>Kotlin \u901a\u8fc7\u7f16\u8bd1\u5668\u9b54\u6cd5\u548c\u7c7b\u578b\u7cfb\u7edf\u6269\u5c55\u4e86 <code>Object</code> \u7684\u529f\u80fd\uff0c\u4f8b\u5982\u652f\u6301\u57fa\u672c\u6570\u636e\u7c7b\u578b\u3001\u53ef\u7a7a\u6027\u68c0\u67e5\u548c\u6269\u5c55\u51fd\u6570\u3002</li> </ul>"},{"location":"020Kotlin/010Basic/#7-kotlin","title":"7. \u793a\u4f8b\uff1aKotlin \u4ee3\u7801\u4e0e\u7f16\u8bd1\u540e\u7684\u5b57\u8282\u7801\u5bf9\u6bd4","text":"<ul> <li>Kotlin \u4ee3\u7801\uff1a     <pre><code>val obj: Any = 42\nprintln(obj.toString())\n</code></pre></li> <li>\u7f16\u8bd1\u540e\u7684\u5b57\u8282\u7801\uff08\u53cd\u7f16\u8bd1\u4e3a Java\uff09\uff1a     <pre><code>Object obj = Integer.valueOf(42);\nSystem.out.println(obj.toString());\n</code></pre></li> </ul> <p>\u53ef\u4ee5\u770b\u5230\uff0cKotlin \u7684 <code>Any</code> \u88ab\u76f4\u63a5\u6620\u5c04\u4e3a Java \u7684 <code>Object</code>\u3002</p>"},{"location":"020Kotlin/010Basic/#_36","title":"\u7ed3\u8bba","text":"<p>Kotlin \u7684 <code>Any</code> \u7c7b\u5728\u5e95\u5c42\u662f\u901a\u8fc7 Java \u7684 <code>Object</code> \u7c7b\u5b9e\u73b0\u7684\uff0c\u4f46 Kotlin \u901a\u8fc7\u8bed\u8a00\u8bbe\u8ba1\u548c\u7f16\u8bd1\u5668\u4f18\u5316\uff0c\u63d0\u4f9b\u4e86\u66f4\u5f3a\u5927\u548c\u5b89\u5168\u7684\u7c7b\u578b\u7cfb\u7edf\u3002<code>Any</code> \u7684\u8bbe\u8ba1\u4f7f\u5f97 Kotlin \u80fd\u591f\u66f4\u597d\u5730\u4e0e JVM \u517c\u5bb9\uff0c\u540c\u65f6\u63d0\u4f9b\u66f4\u73b0\u4ee3\u5316\u7684\u8bed\u8a00\u7279\u6027\u3002</p>"},{"location":"020Kotlin/010Basic/#kotlin-lateinit-by-lazy","title":"Kotlin lateinit \u548c by lazy\u6709\u4ec0\u4e48\u533a\u522b\uff0c\u5404\u81ea\u6709\u4ec0\u4e48\u7279\u6027\uff0c\u662f\u5426\u53ef\u4ee5\u4e3a\u7a7a\uff1f","text":"\u7b54\u6848 <p>\u5728Kotlin\u4e2d\uff0c<code>lateinit</code> \u548c <code>by lazy</code> \u90fd\u7528\u4e8e\u5ef6\u8fdf\u521d\u59cb\u5316\u5c5e\u6027\uff0c\u4f46\u5b83\u4eec\u6709\u4e0d\u540c\u7684\u7279\u6027\u548c\u9002\u7528\u573a\u666f\u3002</p>"},{"location":"020Kotlin/010Basic/#lateinit","title":"<code>lateinit</code> \u7684\u7279\u6027","text":"<ol> <li>\u9002\u7528\u7c7b\u578b\uff1a<code>lateinit</code> \u53ea\u80fd\u7528\u4e8e <code>var</code> \u58f0\u660e\u7684\u53ef\u53d8\u5c5e\u6027\uff0c\u4e14\u5c5e\u6027\u7c7b\u578b\u4e0d\u80fd\u662f\u57fa\u672c\u7c7b\u578b\uff08\u5982 <code>Int</code>\u3001<code>Boolean</code> \u7b49\uff09\u3002</li> <li>\u521d\u59cb\u5316\u65f6\u673a\uff1a<code>lateinit</code> \u5c5e\u6027\u5fc5\u987b\u5728\u5bf9\u8c61\u521b\u5efa\u540e\u624b\u52a8\u521d\u59cb\u5316\uff0c\u5426\u5219\u5728\u8bbf\u95ee\u65f6\u4f1a\u629b\u51fa <code>UninitializedPropertyAccessException</code>\u3002</li> <li>\u662f\u5426\u53ef\u4e3a\u7a7a\uff1a<code>lateinit</code> \u5c5e\u6027\u4e0d\u80fd\u4e3a <code>null</code>\uff0c\u56e0\u4e3a\u5b83\u7684\u8bbe\u8ba1\u521d\u8877\u662f\u5ef6\u8fdf\u521d\u59cb\u5316\u975e\u7a7a\u5c5e\u6027\u3002</li> <li>\u7ebf\u7a0b\u5b89\u5168\uff1a<code>lateinit</code> \u4e0d\u662f\u7ebf\u7a0b\u5b89\u5168\u7684\uff0c\u9700\u8981\u5728\u591a\u7ebf\u7a0b\u73af\u5883\u4e0b\u81ea\u884c\u5904\u7406\u540c\u6b65\u95ee\u9898\u3002</li> <li>\u9002\u7528\u573a\u666f\uff1a\u9002\u7528\u4e8e\u90a3\u4e9b\u5728\u5bf9\u8c61\u521b\u5efa\u65f6\u65e0\u6cd5\u521d\u59cb\u5316\uff0c\u4f46\u5728\u4f7f\u7528\u524d\u4e00\u5b9a\u4f1a\u88ab\u521d\u59cb\u5316\u7684\u5c5e\u6027\uff0c\u4f8b\u5982\u4f9d\u8d56\u6ce8\u5165\u6216\u5355\u5143\u6d4b\u8bd5\u4e2d\u7684\u5c5e\u6027\u3002</li> </ol> <pre><code>class Example {\n    lateinit var name: String\n\n    fun initializeName() {\n        name = \"Kotlin\"\n    }\n\n    fun printName() {\n        if (::name.isInitialized) {\n            println(name)\n        } else {\n            println(\"Name is not initialized\")\n        }\n    }\n}\n</code></pre>"},{"location":"020Kotlin/010Basic/#by-lazy","title":"<code>by lazy</code> \u7684\u7279\u6027","text":"<ol> <li>\u9002\u7528\u7c7b\u578b\uff1a<code>by lazy</code> \u53ea\u80fd\u7528\u4e8e <code>val</code> \u58f0\u660e\u7684\u4e0d\u53ef\u53d8\u5c5e\u6027\u3002</li> <li>\u521d\u59cb\u5316\u65f6\u673a\uff1a<code>by lazy</code> \u5c5e\u6027\u5728\u7b2c\u4e00\u6b21\u8bbf\u95ee\u65f6\u81ea\u52a8\u521d\u59cb\u5316\uff0c\u4e14\u53ea\u4f1a\u521d\u59cb\u5316\u4e00\u6b21\u3002</li> <li>\u662f\u5426\u53ef\u4e3a\u7a7a\uff1a<code>by lazy</code> \u5c5e\u6027\u53ef\u4ee5\u4e3a\u7a7a\u6216\u975e\u7a7a\uff0c\u5177\u4f53\u53d6\u51b3\u4e8e\u521d\u59cb\u5316\u7684\u8868\u8fbe\u5f0f\u3002</li> <li>\u7ebf\u7a0b\u5b89\u5168\uff1a<code>by lazy</code> \u9ed8\u8ba4\u662f\u7ebf\u7a0b\u5b89\u5168\u7684\uff0c\u53ef\u4ee5\u901a\u8fc7 <code>LazyThreadSafetyMode</code> \u6307\u5b9a\u4e0d\u540c\u7684\u7ebf\u7a0b\u5b89\u5168\u6a21\u5f0f\u3002</li> <li>\u9002\u7528\u573a\u666f\uff1a\u9002\u7528\u4e8e\u90a3\u4e9b\u521d\u59cb\u5316\u6210\u672c\u8f83\u9ad8\uff0c\u4e14\u53ea\u5728\u9700\u8981\u65f6\u624d\u521d\u59cb\u5316\u7684\u5c5e\u6027\uff0c\u4f8b\u5982\u5355\u4f8b\u5bf9\u8c61\u6216\u5ef6\u8fdf\u8ba1\u7b97\u7684\u5c5e\u6027\u3002</li> </ol> <pre><code>class Example {\n    val name: String by lazy {\n        println(\"Initializing name\")\n        \"Kotlin\"\n    }\n}\n\nfun main() {\n    val example = Example()\n    println(example.name) // \u7b2c\u4e00\u6b21\u8bbf\u95ee\u65f6\u521d\u59cb\u5316\n    println(example.name) // \u76f4\u63a5\u4f7f\u7528\u5df2\u521d\u59cb\u5316\u7684\u503c\n}\n</code></pre>"},{"location":"020Kotlin/010Basic/#_37","title":"\u603b\u7ed3","text":"<ul> <li><code>lateinit</code>\uff1a\u7528\u4e8e <code>var</code> \u5c5e\u6027\uff0c\u624b\u52a8\u521d\u59cb\u5316\uff0c\u4e0d\u80fd\u4e3a\u7a7a\uff0c\u9002\u7528\u4e8e\u660e\u786e\u77e5\u9053\u5728\u4f7f\u7528\u524d\u4f1a\u521d\u59cb\u5316\u7684\u573a\u666f\u3002</li> <li><code>by lazy</code>\uff1a\u7528\u4e8e <code>val</code> \u5c5e\u6027\uff0c\u81ea\u52a8\u521d\u59cb\u5316\uff0c\u53ef\u4ee5\u4e3a\u7a7a\u6216\u975e\u7a7a\uff0c\u9002\u7528\u4e8e\u5ef6\u8fdf\u521d\u59cb\u5316\u4e14\u53ea\u9700\u521d\u59cb\u5316\u4e00\u6b21\u7684\u573a\u666f\u3002</li> </ul> <p>\u6839\u636e\u5177\u4f53\u9700\u6c42\u9009\u62e9\u5408\u9002\u7684\u5ef6\u8fdf\u521d\u59cb\u5316\u65b9\u5f0f\u3002</p>"},{"location":"020Kotlin/010Basic/#kotlinsequence","title":"\u8c08\u8c08Kotlin\u4e2d\u7684Sequence\uff0c\u4e3a\u4ec0\u4e48\u5b83\u5904\u7406\u96c6\u5408\u64cd\u4f5c\u66f4\u52a0\u9ad8\u6548\uff1f","text":"\u7b54\u6848"},{"location":"020Kotlin/010Basic/#kotlinsequence_1","title":"Kotlin\u4e2d\u7684Sequence\u53ca\u5176\u9ad8\u6548\u6027\u5206\u6790","text":"<p>Sequence\uff08\u5e8f\u5217\uff09\u662fKotlin\u4e2d\u4e00\u79cd\u7279\u6b8a\u7684\u96c6\u5408\u7c7b\u578b\uff0c\u5b83\u5728\u5904\u7406\u96c6\u5408\u64cd\u4f5c\u65f6\u6bd4\u666e\u901a\u7684\u96c6\u5408\u64cd\u4f5c\u66f4\u52a0\u9ad8\u6548\u3002\u4e0b\u9762\u6211\u6765\u8be6\u7ec6\u89e3\u91caSequence\u7684\u5de5\u4f5c\u539f\u7406\u53ca\u5176\u4f18\u52bf\u3002</p>"},{"location":"020Kotlin/010Basic/#sequence","title":"Sequence\u7684\u57fa\u672c\u6982\u5ff5","text":"<p>Sequence\u662fKotlin\u4e2d\u8868\u793a\u60f0\u6027\u6c42\u503c\u7684\u96c6\u5408\u64cd\u4f5c\u94fe\uff0c\u7c7b\u4f3c\u4e8eJava 8\u4e2d\u7684Stream\u3002\u4e0e\u666e\u901a\u96c6\u5408\u64cd\u4f5c\u4e0d\u540c\uff0cSequence\u64cd\u4f5c\u662f\"\u60f0\u6027\"\u7684\uff0c\u53ea\u6709\u5728\u9700\u8981\u7ed3\u679c\u65f6\u624d\u4f1a\u8fdb\u884c\u8ba1\u7b97\u3002</p>"},{"location":"020Kotlin/010Basic/#sequence_1","title":"\u4e3a\u4ec0\u4e48Sequence\u66f4\u9ad8\u6548\uff1f","text":""},{"location":"020Kotlin/010Basic/#1-lazy-evaluation","title":"1. \u60f0\u6027\u6c42\u503c\uff08Lazy Evaluation\uff09","text":"<p>\u666e\u901a\u96c6\u5408\u64cd\u4f5c\uff08\u5982<code>map</code>\u3001<code>filter</code>\u7b49\uff09\u662f\u6025\u5207\u7684(eager)\uff0c\u6bcf\u4e00\u6b65\u64cd\u4f5c\u90fd\u4f1a\u7acb\u5373\u6267\u884c\u5e76\u521b\u5efa\u4e2d\u95f4\u96c6\u5408\uff1a</p> <pre><code>listOf(1, 2, 3, 4, 5)\n    .map { it * it }        // \u521b\u5efa\u65b0\u5217\u8868[1, 4, 9, 16, 25]\n    .filter { it &gt; 10 }     // \u521b\u5efa\u65b0\u5217\u8868[16, 25]\n    .first()                // \u8fd4\u56de16\n</code></pre> <p>\u800cSequence\u64cd\u4f5c\u662f\u60f0\u6027\u7684\uff0c\u53ea\u6709\u5728\u7ec8\u7aef\u64cd\u4f5c\uff08\u5982<code>first()</code>\u3001<code>toList()</code>\u7b49\uff09\u88ab\u8c03\u7528\u65f6\u624d\u4f1a\u6267\u884c\uff1a</p> <pre><code>listOf(1, 2, 3, 4, 5).asSequence()\n    .map { it * it }        // \u4e0d\u7acb\u5373\u8ba1\u7b97\n    .filter { it &gt; 10 }     // \u4e0d\u7acb\u5373\u8ba1\u7b97\n    .first()               // \u5f00\u59cb\u8ba1\u7b97\uff1a1\u21921(\u8fc7\u6ee4), 4\u219216(\u5339\u914d), \u8fd4\u56de16\n</code></pre>"},{"location":"020Kotlin/010Basic/#2_7","title":"2. \u907f\u514d\u4e2d\u95f4\u96c6\u5408\u521b\u5efa","text":"<p>\u666e\u901a\u96c6\u5408\u64cd\u4f5c\u6bcf\u4e00\u6b65\u90fd\u4f1a\u521b\u5efa\u65b0\u7684\u4e2d\u95f4\u96c6\u5408\uff0c\u5f53\u6570\u636e\u91cf\u5927\u65f6\u8fd9\u4f1a\u5e26\u6765\u663e\u8457\u7684\u5185\u5b58\u5f00\u9500\u3002Sequence\u5219\u5728\u6574\u4e2a\u64cd\u4f5c\u94fe\u4e2d\u53ea\u5904\u7406\u5355\u4e2a\u5143\u7d20\uff0c\u4e0d\u9700\u8981\u4e2d\u95f4\u5b58\u50a8\u3002</p>"},{"location":"020Kotlin/010Basic/#3-short-circuiting","title":"3. \u77ed\u8def\u64cd\u4f5c\uff08Short-circuiting\uff09","text":"<p>Sequence\u53ef\u4ee5\u5728\u6ee1\u8db3\u6761\u4ef6\u65f6\u7acb\u5373\u505c\u6b62\u5904\u7406\uff0c\u4f8b\u5982<code>find</code>\u3001<code>first</code>\u7b49\u64cd\u4f5c\u627e\u5230\u7ed3\u679c\u540e\u5c31\u4e0d\u4f1a\u5904\u7406\u5269\u4f59\u5143\u7d20\u3002</p>"},{"location":"020Kotlin/010Basic/#sequence_2","title":"\u4f55\u65f6\u4f7f\u7528Sequence\uff1f","text":"<p>Sequence\u5728\u4ee5\u4e0b\u573a\u666f\u7279\u522b\u9ad8\u6548\uff1a - \u64cd\u4f5c\u94fe\u8f83\u957f\u65f6\uff08\u591a\u4e2a<code>map</code>\u3001<code>filter</code>\u7b49\u7ec4\u5408\uff09 - \u6570\u636e\u96c6\u8f83\u5927\u65f6 - \u53ea\u9700\u8981\u90e8\u5206\u7ed3\u679c\u65f6\uff08\u5982<code>find</code>\u3001<code>take</code>\u7b49\u64cd\u4f5c\uff09</p>"},{"location":"020Kotlin/010Basic/#_38","title":"\u6027\u80fd\u5bf9\u6bd4\u793a\u4f8b","text":"<pre><code>// \u666e\u901a\u96c6\u5408\u64cd\u4f5c - \u5904\u7406\u6240\u6709\u5143\u7d20\nval listResult = (1..1_000_000).toList()\n    .map { it * 2 }\n    .filter { it % 3 == 0 }\n    .take(10)\n\n// Sequence\u64cd\u4f5c - \u53ea\u5904\u7406\u5230\u627e\u523010\u4e2a\u6ee1\u8db3\u6761\u4ef6\u7684\u5143\u7d20\u4e3a\u6b62\nval sequenceResult = (1..1_000_000).asSequence()\n    .map { it * 2 }\n    .filter { it % 3 == 0 }\n    .take(10)\n    .toList()\n</code></pre> <p>\u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0cSequence\u7248\u672c\u53ef\u80fd\u53ea\u5904\u7406\u51e0\u5341\u4e2a\u5143\u7d20\u5c31\u80fd\u5f97\u5230\u7ed3\u679c\uff0c\u800c\u666e\u901a\u96c6\u5408\u7248\u672c\u4f1a\u5904\u7406\u5168\u90e8100\u4e07\u4e2a\u5143\u7d20\u3002</p>"},{"location":"020Kotlin/010Basic/#sequence_3","title":"\u521b\u5efaSequence\u7684\u65b9\u5f0f","text":"<ol> <li>\u4ece\u73b0\u6709\u96c6\u5408\u8f6c\u6362\uff1a<code>collection.asSequence()</code></li> <li>\u4f7f\u7528\u751f\u6210\u5668\u51fd\u6570\uff1a<code>generateSequence { ... }</code></li> <li>\u4f7f\u7528\u5e8f\u5217\u5b57\u9762\u91cf\uff1a<code>sequence { yield(...) }</code></li> </ol>"},{"location":"020Kotlin/010Basic/#_39","title":"\u603b\u7ed3","text":"<p>Kotlin\u7684Sequence\u901a\u8fc7\u60f0\u6027\u6c42\u503c\u548c\u5143\u7d20\u7ea7\u5904\u7406\u7b56\u7565\uff0c\u907f\u514d\u4e86\u4e0d\u5fc5\u8981\u7684\u4e2d\u95f4\u96c6\u5408\u521b\u5efa\u548c\u5168\u91cf\u6570\u636e\u5904\u7406\uff0c\u4ece\u800c\u5728\u5904\u7406\u590d\u6742\u96c6\u5408\u64cd\u4f5c\u94fe\u65f6\u63d0\u4f9b\u4e86\u663e\u8457\u7684\u6027\u80fd\u4f18\u52bf\uff0c\u7279\u522b\u662f\u5728\u5927\u6570\u636e\u96c6\u548c\u53ea\u9700\u8981\u90e8\u5206\u7ed3\u679c\u7684\u573a\u666f\u4e0b\u3002</p>"},{"location":"020Kotlin/010Basic/#xxx","title":"xxx","text":"\u7b54\u6848"},{"location":"020Kotlin/010Basic/#xxx_1","title":"xxx","text":"\u7b54\u6848"},{"location":"020Kotlin/020Coroutines/","title":"Kotlin\u534f\u7a0b","text":""},{"location":"020Kotlin/020Coroutines/#_1","title":"\u534f\u7a0b\u7684\u4e00\u4e9b\u57fa\u7840\u9762\u8bd5\u9898","text":"\u7b54\u6848"},{"location":"020Kotlin/020Coroutines/#_2","title":"\u57fa\u7840\u6982\u5ff5","text":""},{"location":"020Kotlin/020Coroutines/#1-kotlin","title":"1. \u4ec0\u4e48\u662fKotlin\u534f\u7a0b\uff1f\u5b83\u4e0e\u7ebf\u7a0b\u6709\u4ec0\u4e48\u533a\u522b\uff1f","text":"<p>\u7b54\u6848\uff1a Kotlin\u534f\u7a0b\u662f\u4e00\u79cd\u8f7b\u91cf\u7ea7\u7684\u7ebf\u7a0b\u7ba1\u7406\u6846\u67b6\uff0c\u5b83\u5141\u8bb8\u4ee5\u987a\u5e8f\u7684\u65b9\u5f0f\u7f16\u5199\u5f02\u6b65\u4ee3\u7801\u3002\u534f\u7a0b\u4e0e\u7ebf\u7a0b\u7684\u4e3b\u8981\u533a\u522b\u5305\u62ec\uff1a - \u534f\u7a0b\u662f\u7528\u6237\u6001\u7684\uff0c\u7ebf\u7a0b\u662f\u7cfb\u7edf\u6001\u7684 - \u534f\u7a0b\u66f4\u8f7b\u91cf\uff0c\u53ef\u4ee5\u521b\u5efa\u6210\u5343\u4e0a\u4e07\u4e2a\u800c\u4e0d\u4f1a\u5bfc\u81f4\u6027\u80fd\u95ee\u9898 - \u534f\u7a0b\u901a\u8fc7\u6302\u8d77(suspend)\u800c\u975e\u963b\u585e\u6765\u5b9e\u73b0\u5e76\u53d1 - \u534f\u7a0b\u53ef\u4ee5\u5728\u5355\u4e2a\u7ebf\u7a0b\u4e0a\u6267\u884c\u591a\u4e2a\u534f\u7a0b - \u534f\u7a0b\u63d0\u4f9b\u4e86\u66f4\u7b80\u5355\u7684\u9519\u8bef\u5904\u7406\u548c\u53d6\u6d88\u673a\u5236</p>"},{"location":"020Kotlin/020Coroutines/#2-suspend","title":"2. \u89e3\u91ca<code>suspend</code>\u5173\u952e\u5b57\u7684\u4f5c\u7528","text":"<p>\u7b54\u6848\uff1a <code>suspend</code>\u5173\u952e\u5b57\u7528\u4e8e\u6807\u8bb0\u4e00\u4e2a\u51fd\u6570\u4e3a\u6302\u8d77\u51fd\u6570(suspend function)\uff0c\u8fd9\u7c7b\u51fd\u6570\u53ef\u4ee5\uff1a - \u5728\u4e0d\u963b\u585e\u7ebf\u7a0b\u7684\u60c5\u51b5\u4e0b\u6682\u505c\u6267\u884c - \u53ea\u80fd\u5728\u534f\u7a0b\u6216\u5176\u4ed6\u6302\u8d77\u51fd\u6570\u4e2d\u8c03\u7528 - \u901a\u5e38\u7528\u4e8e\u6267\u884c\u8017\u65f6\u64cd\u4f5c(\u5982\u7f51\u7edc\u8bf7\u6c42\u3001\u6570\u636e\u5e93\u64cd\u4f5c\u7b49) - \u53ef\u4ee5\u4f7f\u7528\u534f\u7a0b\u5e93\u63d0\u4f9b\u7684\u6302\u8d77\u51fd\u6570(\u5982<code>delay()</code>, <code>withContext()</code>\u7b49)</p>"},{"location":"020Kotlin/020Coroutines/#_3","title":"\u534f\u7a0b\u6784\u5efa\u5668","text":""},{"location":"020Kotlin/020Coroutines/#3-launchasync","title":"3. <code>launch</code>\u548c<code>async</code>\u6709\u4ec0\u4e48\u533a\u522b\uff1f","text":"<p>\u7b54\u6848\uff1a - <code>launch</code>: \u542f\u52a8\u4e00\u4e2a\u4e0d\u8fd4\u56de\u7ed3\u679c\u7684\u534f\u7a0b\uff0c\u8fd4\u56de<code>Job</code>\u5bf9\u8c61\u3002\u901a\u5e38\u7528\u4e8e\"\u5373\u53d1\u5373\u5fd8\"\u7684\u573a\u666f\u3002 - <code>async</code>: \u542f\u52a8\u4e00\u4e2a\u8fd4\u56de<code>Deferred</code>(\u5305\u542b\u7ed3\u679c\u7684\u8f7b\u91cf\u7ea7future)\u7684\u534f\u7a0b\uff0c\u53ef\u4ee5\u901a\u8fc7<code>await()</code>\u83b7\u53d6\u7ed3\u679c\u3002\u901a\u5e38\u7528\u4e8e\u9700\u8981\u5e76\u884c\u8ba1\u7b97\u5e76\u83b7\u53d6\u7ed3\u679c\u7684\u573a\u666f\u3002</p> <p>\u5173\u952e\u533a\u522b\uff1a - <code>async</code>\u53ef\u4ee5\u8fd4\u56de\u7ed3\u679c\uff0c<code>launch</code>\u4e0d\u80fd - <code>async</code>\u9700\u8981\u8c03\u7528<code>await()</code>\u6765\u83b7\u53d6\u7ed3\u679c\uff0c\u8fd9\u53ef\u80fd\u4f1a\u6302\u8d77\u534f\u7a0b - \u5982\u679c<code>async</code>\u534f\u7a0b\u629b\u51fa\u5f02\u5e38\uff0c\u5b83\u4f1a\u5728\u8c03\u7528<code>await()</code>\u65f6\u629b\u51fa\uff0c\u800c<code>launch</code>\u7684\u5f02\u5e38\u4f1a\u7acb\u5373\u629b\u51fa</p>"},{"location":"020Kotlin/020Coroutines/#4-runblocking","title":"4. \u89e3\u91ca<code>runBlocking</code>\u7684\u4f5c\u7528\u548c\u4f7f\u7528\u573a\u666f","text":"<p>\u7b54\u6848\uff1a <code>runBlocking</code>\u662f\u4e00\u4e2a\u534f\u7a0b\u6784\u5efa\u5668\uff0c\u5b83\u4f1a\u963b\u585e\u5f53\u524d\u7ebf\u7a0b\uff0c\u76f4\u5230\u5176\u4e2d\u7684\u534f\u7a0b\u6267\u884c\u5b8c\u6bd5\u3002\u4e3b\u8981\u7279\u70b9\uff1a - \u4e3b\u8981\u7528\u4e8e\u6d4b\u8bd5\u548cmain\u51fd\u6570\u4e2d - \u4e0d\u5e94\u8be5\u5728\u5e38\u89c4\u7684Android\u5e94\u7528\u4ee3\u7801\u4e2d\u4f7f\u7528\uff0c\u56e0\u4e3a\u5b83\u4f1a\u963b\u585eUI\u7ebf\u7a0b - \u53ef\u4ee5\u5c06\u5e38\u89c4\u7684\u963b\u585e\u4ee3\u7801\u6865\u63a5\u5230\u6302\u8d77\u98ce\u683c\u7684\u4ee3\u7801\u4e2d - \u5728JUnit\u6d4b\u8bd5\u4e2d\u7528\u4e8e\u6d4b\u8bd5\u6302\u8d77\u51fd\u6570</p>"},{"location":"020Kotlin/020Coroutines/#_4","title":"\u534f\u7a0b\u4e0a\u4e0b\u6587\u4e0e\u8c03\u5ea6\u5668","text":""},{"location":"020Kotlin/020Coroutines/#5-coroutinedispatcher","title":"5. \u89e3\u91caCoroutineDispatcher\u53ca\u5176\u5e38\u89c1\u7c7b\u578b","text":"<p>\u7b54\u6848\uff1a <code>CoroutineDispatcher</code>\u51b3\u5b9a\u534f\u7a0b\u5728\u54ea\u4e2a\u6216\u54ea\u4e9b\u7ebf\u7a0b\u4e0a\u6267\u884c\u3002\u5e38\u89c1\u7684\u8c03\u5ea6\u5668\u5305\u62ec\uff1a - <code>Dispatchers.Main</code>: Android\u4e0a\u7684\u4e3b\u7ebf\u7a0b\uff0c\u7528\u4e8eUI\u64cd\u4f5c - <code>Dispatchers.IO</code>: \u9002\u7528\u4e8e\u78c1\u76d8\u548c\u7f51\u7edcI/O\u64cd\u4f5c\u7684\u7ebf\u7a0b\u6c60 - <code>Dispatchers.Default</code>: \u9002\u7528\u4e8eCPU\u5bc6\u96c6\u578b\u4efb\u52a1\u7684\u7ebf\u7a0b\u6c60 - <code>Dispatchers.Unconfined</code>: \u4e0d\u9650\u5236\u5230\u4efb\u4f55\u7279\u5b9a\u7ebf\u7a0b(\u4e0d\u63a8\u8350\u5e38\u89c4\u4f7f\u7528)</p> <p>\u53ef\u4ee5\u901a\u8fc7<code>withContext</code>\u5207\u6362\u534f\u7a0b\u7684\u8c03\u5ea6\u5668\uff1a <pre><code>withContext(Dispatchers.IO) {\n    // \u5728IO\u7ebf\u7a0b\u6267\u884c\n}\n</code></pre></p>"},{"location":"020Kotlin/020Coroutines/#6-coroutinescopeandroidviewmodelscopelifecyclescope","title":"6. \u4ec0\u4e48\u662fCoroutineScope\uff1f\u4e3a\u4ec0\u4e48\u5728Android\u4e2d\u63a8\u8350\u4f7f\u7528viewModelScope\u548clifecycleScope\uff1f","text":"<p>\u7b54\u6848\uff1a <code>CoroutineScope</code>\u5b9a\u4e49\u4e86\u534f\u7a0b\u7684\u751f\u547d\u5468\u671f\u8303\u56f4\uff0c\u4e3b\u8981\u4f5c\u7528\uff1a - \u7ba1\u7406\u534f\u7a0b\u7684\u751f\u547d\u5468\u671f - \u63d0\u4f9b\u9ed8\u8ba4\u7684\u534f\u7a0b\u4e0a\u4e0b\u6587 - \u53ef\u4ee5\u53d6\u6d88\u6240\u6709\u5728\u5176\u8303\u56f4\u5185\u542f\u52a8\u7684\u534f\u7a0b</p> <p>\u5728Android\u4e2d\u63a8\u8350\u4f7f\u7528\uff1a - <code>viewModelScope</code>: \u4e0eViewModel\u7ed1\u5b9a\uff0c\u5f53ViewModel\u6e05\u9664\u65f6\u81ea\u52a8\u53d6\u6d88\u6240\u6709\u534f\u7a0b - <code>lifecycleScope</code>: \u4e0eLifecycleOwner(\u5982Activity/Fragment)\u7ed1\u5b9a\uff0c\u5f53\u751f\u547d\u5468\u671f\u7ed3\u675f\u65f6\u81ea\u52a8\u53d6\u6d88\u534f\u7a0b</p> <p>\u8fd9\u6837\u53ef\u4ee5\u907f\u514d\u5185\u5b58\u6cc4\u6f0f\u548c\u786e\u4fdd\u8d44\u6e90\u53ca\u65f6\u91ca\u653e\u3002</p>"},{"location":"020Kotlin/020Coroutines/#_5","title":"\u5f02\u5e38\u5904\u7406","text":""},{"location":"020Kotlin/020Coroutines/#7","title":"7. \u5982\u4f55\u5728\u534f\u7a0b\u4e2d\u5904\u7406\u5f02\u5e38\uff1f","text":"<p>\u7b54\u6848\uff1a \u534f\u7a0b\u4e2d\u7684\u5f02\u5e38\u5904\u7406\u65b9\u5f0f\uff1a 1. \u4f7f\u7528<code>try/catch</code>\u5305\u88f9\u53ef\u80fd\u629b\u51fa\u5f02\u5e38\u7684\u4ee3\u7801 2. \u4f7f\u7528<code>CoroutineExceptionHandler</code>: <pre><code>val handler = CoroutineExceptionHandler { _, exception -&gt;\n    println(\"Caught $exception\")\n}\nGlobalScope.launch(handler) {\n    throw AssertionError()\n}\n</code></pre> 3. \u5bf9\u4e8e<code>async</code>\u6784\u5efa\u7684\u534f\u7a0b\uff0c\u5728<code>await()</code>\u65f6\u6355\u83b7\u5f02\u5e38 4. \u4f7f\u7528<code>supervisorScope</code>\u6216<code>SupervisorJob</code>\u6765\u9632\u6b62\u5f02\u5e38\u4f20\u64ad(\u5b50\u534f\u7a0b\u7684\u5f02\u5e38\u4e0d\u4f1a\u5f71\u54cd\u7236\u534f\u7a0b\u548c\u5176\u4ed6\u5b50\u534f\u7a0b)</p>"},{"location":"020Kotlin/020Coroutines/#8-supervisorjobjob","title":"8. SupervisorJob\u548c\u5e38\u89c4Job\u6709\u4ec0\u4e48\u533a\u522b\uff1f","text":"<p>\u7b54\u6848\uff1a - \u5e38\u89c4<code>Job</code>: \u5b50\u534f\u7a0b\u7684\u5931\u8d25\u4f1a\u7acb\u5373\u4f20\u64ad\u5230\u7236\u534f\u7a0b\uff0c\u5bfc\u81f4\u6240\u6709\u5176\u4ed6\u5b50\u534f\u7a0b\u88ab\u53d6\u6d88 - <code>SupervisorJob</code>: \u5b50\u534f\u7a0b\u7684\u5931\u8d25\u4e0d\u4f1a\u5f71\u54cd\u7236\u534f\u7a0b\u548c\u5176\u4ed6\u5b50\u534f\u7a0b - <code>SupervisorJob</code>\u901a\u5e38\u4e0e<code>viewModelScope</code>\u4e00\u8d77\u4f7f\u7528\uff0c\u6216\u8005\u901a\u8fc7<code>supervisorScope</code>\u6784\u5efa\u5668\u4f7f\u7528</p>"},{"location":"020Kotlin/020Coroutines/#_6","title":"\u5b9e\u9645\u5e94\u7528","text":""},{"location":"020Kotlin/020Coroutines/#9-android","title":"9. \u5982\u4f55\u5728Android\u4e2d\u4f7f\u7528\u534f\u7a0b\u8fdb\u884c\u7f51\u7edc\u8bf7\u6c42\uff1f","text":"<p>\u7b54\u6848\uff1a \u5178\u578b\u793a\u4f8b\uff1a <pre><code>viewModelScope.launch {\n    try {\n        // \u5207\u6362\u5230IO\u7ebf\u7a0b\u6267\u884c\u7f51\u7edc\u8bf7\u6c42\n        val result = withContext(Dispatchers.IO) {\n            repository.fetchData()\n        }\n        // \u56de\u5230\u4e3b\u7ebf\u7a0b\u66f4\u65b0UI\n        _uiState.value = UiState.Success(result)\n    } catch (e: Exception) {\n        _uiState.value = UiState.Error(e.message)\n    }\n}\n</code></pre></p> <p>\u6700\u4f73\u5b9e\u8df5\uff1a - \u4f7f\u7528<code>viewModelScope</code>\u786e\u4fdd\u751f\u547d\u5468\u671f\u5b89\u5168 - \u4f7f\u7528<code>withContext(Dispatchers.IO)</code>\u6267\u884c\u7f51\u7edc\u8bf7\u6c42 - \u5728\u4e3b\u7ebf\u7a0b\u66f4\u65b0UI - \u6b63\u786e\u5904\u7406\u5f02\u5e38</p>"},{"location":"020Kotlin/020Coroutines/#10","title":"10. \u5982\u4f55\u6d4b\u8bd5\u534f\u7a0b\u4ee3\u7801\uff1f","text":"<p>\u7b54\u6848\uff1a \u6d4b\u8bd5\u534f\u7a0b\u4ee3\u7801\u7684\u65b9\u6cd5\uff1a 1. \u4f7f\u7528<code>runBlockingTest</code>(\u6765\u81ea<code>kotlinx-coroutines-test</code>\u5e93): <pre><code>@Test\nfun testCoroutine() = runBlockingTest {\n    val result = repository.fetchData()\n    assertEquals(expected, result)\n}\n</code></pre> 2. \u63a7\u5236\u865a\u62df\u65f6\u95f4: <pre><code>@Test\nfun testDelay() = runBlockingTest {\n    val job = launch {\n        delay(1000)\n        println(\"Done\")\n    }\n    advanceTimeBy(1000) // \u5feb\u8fdb\u65f6\u95f4\n    job.cancel()\n}\n</code></pre> 3. \u4f7f\u7528<code>TestCoroutineDispatcher</code>\u6765\u63a7\u5236\u534f\u7a0b\u8c03\u5ea6 4. \u4f7f\u7528<code>TestCoroutineScope</code>\u6765\u7ba1\u7406\u6d4b\u8bd5\u534f\u7a0b\u7684\u751f\u547d\u5468\u671f</p>"},{"location":"020Kotlin/020Coroutines/#_7","title":"\u9ad8\u7ea7\u4e3b\u9898","text":""},{"location":"020Kotlin/020Coroutines/#11","title":"11. \u89e3\u91ca\u534f\u7a0b\u4e2d\u7684\u7ed3\u6784\u5316\u5e76\u53d1\u6982\u5ff5","text":"<p>\u7b54\u6848\uff1a \u7ed3\u6784\u5316\u5e76\u53d1\u662f\u6307\u534f\u7a0b\u7684\u751f\u547d\u5468\u671f\u4e0e\u7279\u5b9a\u7684\u4f5c\u7528\u57df\u7ed1\u5b9a\uff0c\u4e3b\u8981\u539f\u5219\uff1a 5. \u6bcf\u4e2a\u534f\u7a0b\u5fc5\u987b\u5728\u7279\u5b9a\u7684<code>CoroutineScope</code>\u4e2d\u542f\u52a8 6. \u7236\u534f\u7a0b\u4f1a\u7b49\u5f85\u6240\u6709\u5b50\u534f\u7a0b\u5b8c\u6210 7. \u7236\u534f\u7a0b\u7684\u53d6\u6d88\u4f1a\u5bfc\u81f4\u6240\u6709\u5b50\u534f\u7a0b\u53d6\u6d88 8. \u5b50\u534f\u7a0b\u7684\u5931\u8d25(\u9664\u975e\u4f7f\u7528SupervisorJob)\u4f1a\u4f20\u64ad\u5230\u7236\u534f\u7a0b</p> <p>\u7ed3\u6784\u5316\u5e76\u53d1\u7684\u597d\u5904\uff1a - \u907f\u514d\u534f\u7a0b\u6cc4\u6f0f(\u6c38\u8fdc\u4e0d\u4f1a\u5b8c\u6210\u7684\u534f\u7a0b) - \u81ea\u52a8\u4f20\u64ad\u53d6\u6d88 - \u81ea\u52a8\u4f20\u64ad\u9519\u8bef - \u66f4\u597d\u7684\u53ef\u89c2\u5bdf\u6027\u548c\u53ef\u7ef4\u62a4\u6027</p>"},{"location":"020Kotlin/020Coroutines/#12","title":"12. \u4ec0\u4e48\u662f\u534f\u7a0b\u7684\u53d6\u6d88\uff1f\u5982\u4f55\u6b63\u786e\u5904\u7406\u53d6\u6d88\uff1f","text":"<p>\u7b54\u6848\uff1a \u534f\u7a0b\u53d6\u6d88\u662f\u901a\u8fc7<code>Job.cancel()</code>\u65b9\u6cd5\u5b9e\u73b0\u7684\u3002\u6b63\u786e\u5904\u7406\u53d6\u6d88\uff1a 1. \u5b9a\u671f\u68c0\u67e5<code>isActive</code>\u6216\u8c03\u7528<code>ensureActive()</code> <pre><code>while (i &lt; 5 &amp;&amp; isActive) {\n    // do work\n}\n</code></pre> 2. \u4f7f\u7528<code>yield()</code>\u5728\u957f\u65f6\u95f4\u8ba1\u7b97\u4e2d\u68c0\u67e5\u53d6\u6d88 3. \u4f7f\u7528<code>try/finally</code>\u6216<code>use</code>\u8d44\u6e90\u6e05\u7406 <pre><code>val job = launch {\n    try {\n        // do work\n    } finally {\n        // clean up\n    }\n}\n</code></pre> 4. \u5bf9\u4e8e\u4e0d\u53ef\u53d6\u6d88\u7684\u4ee3\u7801\u5757\uff0c\u4f7f\u7528<code>withContext(NonCancellable)</code> 5. \u6302\u8d77\u51fd\u6570(\u5982<code>delay()</code>)\u4f1a\u81ea\u52a8\u68c0\u67e5\u53d6\u6d88</p>"},{"location":"020Kotlin/020Coroutines/#13-channelflow","title":"13. \u89e3\u91ca<code>channel</code>\u548c<code>flow</code>\u7684\u533a\u522b\u53ca\u4f7f\u7528\u573a\u666f","text":"<p>\u7b54\u6848\uff1a <code>Channel</code>: - \u70ed\u6d41\uff1a\u6570\u636e\u751f\u4ea7\u72ec\u7acb\u4e8e\u6d88\u8d39 - \u70b9\u5bf9\u70b9\u901a\u4fe1\uff1a\u4e00\u4e2a\u751f\u4ea7\u8005\uff0c\u4e00\u4e2a\u6d88\u8d39\u8005 - \u53ef\u4ee5\u5173\u95ed\u4ee5\u8868\u793a\u5b8c\u6210 - \u9002\u5408\u4e8b\u4ef6\u5904\u7406\u6216\u751f\u4ea7\u8005-\u6d88\u8d39\u8005\u6a21\u5f0f</p> <p><code>Flow</code>: - \u51b7\u6d41\uff1a\u6570\u636e\u751f\u4ea7\u53ea\u5728\u6536\u96c6\u65f6\u5f00\u59cb - \u53ef\u4ee5\u6709\u591a\u4e2a\u6536\u96c6\u8005 - \u57fa\u4e8e\u534f\u7a0b\u6784\u5efa\uff0c\u652f\u6301\u6302\u8d77\u51fd\u6570 - \u9002\u5408\u6570\u636e\u6d41\u6216\u72b6\u6001\u66f4\u65b0 - \u63d0\u4f9b\u4e30\u5bcc\u7684\u64cd\u4f5c\u7b26(map, filter, etc.)</p> <p>\u9009\u62e9\u4f9d\u636e\uff1a - \u9700\u8981\u7b80\u5355\u901a\u4fe1? \u4f7f\u7528Channel - \u9700\u8981\u6570\u636e\u5904\u7406\u7ba1\u9053? \u4f7f\u7528Flow - \u9700\u8981\u591a\u4e2a\u8ba2\u9605\u8005? \u4f7f\u7528SharedFlow/StateFlow</p>"},{"location":"020Kotlin/020Coroutines/#14","title":"14. \u5982\u4f55\u5728\u534f\u7a0b\u4e2d\u5904\u7406\u591a\u4e2a\u5e76\u884c\u4efb\u52a1\u5e76\u5408\u5e76\u7ed3\u679c\uff1f","text":"<p>\u7b54\u6848\uff1a \u5904\u7406\u5e76\u884c\u4efb\u52a1\u5e76\u5408\u5e76\u7ed3\u679c\u7684\u51e0\u79cd\u65b9\u5f0f\uff1a 1. \u4f7f\u7528\u591a\u4e2a<code>async</code>: <pre><code>val result1 = async { fetchData1() }\nval result2 = async { fetchData2() }\nval combined = result1.await() + result2.await()\n</code></pre> 2. \u4f7f\u7528<code>awaitAll</code>: <pre><code>val results = awaitAll(\n    async { fetchData1() },\n    async { fetchData2() }\n)\n</code></pre> 3. \u4f7f\u7528<code>coroutineScope</code>\u6784\u5efa\u5668\u786e\u4fdd\u7ed3\u6784\u5316\u5e76\u53d1: <pre><code>coroutineScope {\n    val result1 = async { fetchData1() }\n    val result2 = async { fetchData2() }\n    combineResults(result1.await(), result2.await())\n}\n</code></pre></p>"},{"location":"020Kotlin/020Coroutines/#15-stateflowsharedflow","title":"15. \u89e3\u91caStateFlow\u548cSharedFlow\u7684\u533a\u522b","text":"<p>\u7b54\u6848\uff1a <code>StateFlow</code>: - \u5fc5\u987b\u6709\u521d\u59cb\u503c - \u53ea\u4fdd\u7559\u6700\u65b0\u503c - \u65b0\u8ba2\u9605\u8005\u7acb\u5373\u83b7\u5f97\u5f53\u524d\u503c - \u9002\u5408\u8868\u793aUI\u72b6\u6001 - \u503c\u76f8\u7b49\u7684\u66f4\u65b0\u4f1a\u88ab\u5ffd\u7565(\u4f7f\u7528<code>distinctUntilChanged</code>)</p> <p><code>SharedFlow</code>: - \u4e0d\u9700\u8981\u521d\u59cb\u503c - \u53ef\u4ee5\u914d\u7f6e\u91cd\u653e(replay)\u548c\u7f13\u51b2\u533a\u5927\u5c0f - \u6ca1\u6709\u8ba2\u9605\u8005\u65f6\u53ef\u4ee5\u4e22\u5f03\u4e8b\u4ef6 - \u9002\u5408\u4e8b\u4ef6\u603b\u7ebf\u6216\u4e00\u6b21\u6027\u4e8b\u4ef6 - \u6240\u6709\u66f4\u65b0\u90fd\u4f1a\u88ab\u53d1\u5c04</p> <p>\u9009\u62e9\u4f9d\u636e\uff1a - \u9700\u8981\u8868\u793a\u72b6\u6001? \u4f7f\u7528StateFlow - \u9700\u8981\u5904\u7406\u4e8b\u4ef6? \u4f7f\u7528SharedFlow - \u9700\u8981\u5386\u53f2\u503c? \u914d\u7f6eSharedFlow\u7684replay</p>"},{"location":"020Kotlin/020Coroutines/#_8","title":"\u534f\u7a0b\u7684\u57fa\u672c\u4f7f\u7528","text":"\u7b54\u6848"},{"location":"020Kotlin/020Coroutines/#android","title":"\u534f\u7a0b\u5728Android\u5e73\u53f0\u7684\u57fa\u672c\u4f7f\u7528","text":"<p>\u534f\u7a0b(Coroutines)\u662fKotlin\u63d0\u4f9b\u7684\u4e00\u79cd\u8f7b\u91cf\u7ea7\u7ebf\u7a0b\u7ba1\u7406\u65b9\u6848\uff0c\u7279\u522b\u9002\u5408Android\u5f00\u53d1\u4e2d\u5904\u7406\u5f02\u6b65\u4efb\u52a1\u3002\u4e0b\u9762\u6211\u5c06\u4ecb\u7ecd\u534f\u7a0b\u7684\u57fa\u672c\u4f7f\u7528\u4ee5\u53ca\u5728Android\u4e2d\u7684\u5178\u578b\u5e94\u7528\u573a\u666f\u3002</p>"},{"location":"020Kotlin/020Coroutines/#_9","title":"\u534f\u7a0b\u7684\u57fa\u672c\u6982\u5ff5","text":"<p>\u534f\u7a0b\u662f\u53ef\u6302\u8d77(suspend)\u7684\u8ba1\u7b97\u5b9e\u4f8b\uff0c\u5b83\u53ef\u4ee5\u5728\u4e0d\u963b\u585e\u7ebf\u7a0b\u7684\u60c5\u51b5\u4e0b\u6682\u505c\u6267\u884c\u5e76\u5728\u7a0d\u540e\u6062\u590d\u3002\u4e0e\u7ebf\u7a0b\u76f8\u6bd4\uff0c\u534f\u7a0b\u66f4\u8f7b\u91cf(\u53ef\u4ee5\u521b\u5efa\u6570\u5343\u4e2a\u800c\u4e0d\u4f1a\u5f71\u54cd\u6027\u80fd)\uff0c\u4e14\u53ef\u4ee5\u901a\u8fc7\u7ed3\u6784\u5316\u5e76\u53d1\u6765\u907f\u514d\u5185\u5b58\u6cc4\u6f0f\u3002</p>"},{"location":"020Kotlin/020Coroutines/#android_1","title":"Android\u4e2d\u534f\u7a0b\u7684\u6838\u5fc3\u7c7b","text":""},{"location":"020Kotlin/020Coroutines/#1-coroutinescope-","title":"1. CoroutineScope - \u534f\u7a0b\u4f5c\u7528\u57df","text":"<p>\u5728Android\u4e2d\u5e38\u7528\u7684\u534f\u7a0b\u4f5c\u7528\u57df\uff1a</p> <ul> <li>GlobalScope: \u5168\u5c40\u4f5c\u7528\u57df\uff0c\u751f\u547d\u5468\u671f\u4e0e\u5e94\u7528\u4e00\u81f4\uff0c\u4e0d\u63a8\u8350\u5728\u5e38\u89c4Android\u5f00\u53d1\u4e2d\u4f7f\u7528</li> <li>LifecycleScope: \u4e0eActivity/Fragment\u751f\u547d\u5468\u671f\u7ed1\u5b9a</li> <li>ViewModelScope: \u4e0eViewModel\u751f\u547d\u5468\u671f\u7ed1\u5b9a</li> <li>MainScope: \u5728\u4e3b\u7ebf\u7a0b\u8fd0\u884c\u7684\u534f\u7a0b\u4f5c\u7528\u57df</li> </ul> <pre><code>// \u5728ViewModel\u4e2d\u4f7f\u7528\nclass MyViewModel : ViewModel() {\n    fun fetchData() {\n        viewModelScope.launch {\n            // \u5728\u8fd9\u91cc\u6267\u884c\u534f\u7a0b\u4ee3\u7801\n        }\n    }\n}\n\n// \u5728Activity\u4e2d\u4f7f\u7528\nclass MyActivity : AppCompatActivity() {\n    override fun onCreate(savedInstanceState: Bundle?) {\n        super.onCreate(savedInstanceState)\n\n        lifecycleScope.launch {\n            // \u5728\u8fd9\u91cc\u6267\u884c\u534f\u7a0b\u4ee3\u7801\n        }\n    }\n}\n</code></pre>"},{"location":"020Kotlin/020Coroutines/#2-coroutinedispatcher-","title":"2. CoroutineDispatcher - \u534f\u7a0b\u8c03\u5ea6\u5668","text":"<p>Android\u4e2d\u5e38\u7528\u7684\u8c03\u5ea6\u5668\uff1a</p> <ul> <li>Dispatchers.Main: \u4e3b\u7ebf\u7a0b\uff0c\u7528\u4e8eUI\u64cd\u4f5c</li> <li>Dispatchers.IO: IO\u5bc6\u96c6\u578b\u64cd\u4f5c(\u7f51\u7edc\u8bf7\u6c42\u3001\u6570\u636e\u5e93\u8bbf\u95ee)</li> <li>Dispatchers.Default: CPU\u5bc6\u96c6\u578b\u64cd\u4f5c(\u6392\u5e8f\u3001\u590d\u6742\u8ba1\u7b97)</li> </ul> <pre><code>viewModelScope.launch(Dispatchers.IO) {\n    // \u6267\u884cIO\u64cd\u4f5c\n    val data = fetchFromNetwork()\n\n    withContext(Dispatchers.Main) {\n        // \u56de\u5230\u4e3b\u7ebf\u7a0b\u66f4\u65b0UI\n        updateUI(data)\n    }\n}\n</code></pre>"},{"location":"020Kotlin/020Coroutines/#3-job-","title":"3. Job - \u534f\u7a0b\u4efb\u52a1","text":"<p>\u8868\u793a\u4e00\u4e2a\u534f\u7a0b\u4efb\u52a1\uff0c\u53ef\u4ee5\u7528\u4e8e\u53d6\u6d88\u534f\u7a0b\u6216\u7b49\u5f85\u534f\u7a0b\u5b8c\u6210\u3002</p> <pre><code>val job = viewModelScope.launch {\n    // \u957f\u65f6\u95f4\u8fd0\u884c\u7684\u4efb\u52a1\n}\n\n// \u53d6\u6d88\u534f\u7a0b\njob.cancel()\n</code></pre>"},{"location":"020Kotlin/020Coroutines/#4-deferred-","title":"4. Deferred - \u6709\u7ed3\u679c\u7684\u534f\u7a0b","text":"<p><code>async</code>\u542f\u52a8\u7684\u534f\u7a0b\u4f1a\u8fd4\u56de\u4e00\u4e2a<code>Deferred</code>\u5bf9\u8c61\uff0c\u53ef\u4ee5\u901a\u8fc7<code>await()</code>\u83b7\u53d6\u7ed3\u679c\u3002</p> <pre><code>viewModelScope.launch {\n    val deferred1 = async { fetchData1() }\n    val deferred2 = async { fetchData2() }\n\n    val result1 = deferred1.await()\n    val result2 = deferred2.await()\n\n    // \u5408\u5e76\u7ed3\u679c\n    showResult(result1 + result2)\n}\n</code></pre>"},{"location":"020Kotlin/020Coroutines/#android_2","title":"Android\u4e2d\u534f\u7a0b\u7684\u5178\u578b\u4f7f\u7528\u573a\u666f","text":""},{"location":"020Kotlin/020Coroutines/#1","title":"1. \u7f51\u7edc\u8bf7\u6c42","text":"<pre><code>viewModelScope.launch {\n    try {\n        val response = withContext(Dispatchers.IO) {\n            retrofitService.getUserData()\n        }\n        _uiState.value = UiState.Success(response)\n    } catch (e: Exception) {\n        _uiState.value = UiState.Error(e.message)\n    }\n}\n</code></pre>"},{"location":"020Kotlin/020Coroutines/#2","title":"2. \u6570\u636e\u5e93\u64cd\u4f5c","text":"<pre><code>fun insertUser(user: User) = viewModelScope.launch(Dispatchers.IO) {\n    userDao.insert(user)\n}\n\nfun getUsers(): LiveData&lt;List&lt;User&gt;&gt; {\n    return userDao.getUsers().asLiveData()\n}\n</code></pre>"},{"location":"020Kotlin/020Coroutines/#3","title":"3. \u591a\u4e2a\u5e76\u884c\u8bf7\u6c42","text":"<pre><code>viewModelScope.launch {\n    val userDeferred = async { getUser() }\n    val postsDeferred = async { getPosts() }\n\n    val user = userDeferred.await()\n    val posts = postsDeferred.await()\n\n    showUserProfile(user, posts)\n}\n</code></pre>"},{"location":"020Kotlin/020Coroutines/#4","title":"4. \u8d85\u65f6\u5904\u7406","text":"<pre><code>viewModelScope.launch {\n    try {\n        val result = withTimeout(5000) { // 5\u79d2\u8d85\u65f6\n            fetchData()\n        }\n        showResult(result)\n    } catch (e: TimeoutCancellationException) {\n        showTimeoutError()\n    }\n}\n</code></pre>"},{"location":"020Kotlin/020Coroutines/#_10","title":"\u534f\u7a0b\u7684\u6700\u4f73\u5b9e\u8df5","text":"<ol> <li>\u907f\u514d\u4f7f\u7528GlobalScope - \u4f7f\u7528ViewModelScope\u6216LifecycleScope\u4ee5\u907f\u514d\u5185\u5b58\u6cc4\u6f0f</li> <li>\u6b63\u786e\u5904\u7406\u5f02\u5e38 - \u4f7f\u7528try-catch\u6216CoroutineExceptionHandler\u5904\u7406\u5f02\u5e38</li> <li>\u5408\u7406\u9009\u62e9\u8c03\u5ea6\u5668 - \u6839\u636e\u4efb\u52a1\u7c7b\u578b\u9009\u62e9\u5408\u9002\u7684Dispatcher</li> <li>\u907f\u514d\u963b\u585e\u64cd\u4f5c - \u5728\u534f\u7a0b\u4e2d\u4e0d\u8981\u4f7f\u7528\u963b\u585e\u8c03\u7528(\u5982Thread.sleep())</li> <li>\u4f7f\u7528\u7ed3\u6784\u5316\u5e76\u53d1 - \u786e\u4fdd\u534f\u7a0b\u6709\u660e\u786e\u7684\u751f\u547d\u5468\u671f\u7ba1\u7406</li> </ol>"},{"location":"020Kotlin/020Coroutines/#livedata","title":"\u534f\u7a0b\u4e0eLiveData\u7684\u7ed3\u5408","text":"<p>Android\u63d0\u4f9b\u4e86<code>liveData</code>\u6784\u5efa\u5668\u6765\u65b9\u4fbf\u5730\u5c06\u534f\u7a0b\u4e0eLiveData\u7ed3\u5408\uff1a</p> <pre><code>val user: LiveData&lt;User&gt; = liveData {\n    val data = database.loadUser() // \u6302\u8d77\u51fd\u6570\n    emit(data)\n}\n</code></pre> <p>\u534f\u7a0b\u4e3aAndroid\u5f02\u6b65\u7f16\u7a0b\u63d0\u4f9b\u4e86\u66f4\u7b80\u6d01\u3001\u66f4\u5b89\u5168\u7684\u89e3\u51b3\u65b9\u6848\uff0c\u7279\u522b\u662f\u5728\u7ed3\u5408ViewModel\u548cLiveData\u4f7f\u7528\u65f6\uff0c\u80fd\u591f\u6709\u6548\u7ba1\u7406\u751f\u547d\u5468\u671f\u548c\u907f\u514d\u5185\u5b58\u6cc4\u6f0f\u3002</p>"},{"location":"020Kotlin/020Coroutines/#_11","title":"\u534f\u7a0b\u7684\u57fa\u672c\u7406\u89e3","text":"\u7b54\u6848"},{"location":"020Kotlin/020Coroutines/#kotlin_1","title":"Kotlin\u534f\u7a0b\u89e3\u6790","text":"<p>Kotlin\u534f\u7a0b\u662fKotlin\u8bed\u8a00\u63d0\u4f9b\u7684\u4e00\u79cd\u8f7b\u91cf\u7ea7\u7ebf\u7a0b\u7ba1\u7406\u65b9\u6848\uff0c\u7528\u4e8e\u7b80\u5316\u5f02\u6b65\u7f16\u7a0b\u548c\u5e76\u53d1\u64cd\u4f5c\u3002\u4e0b\u9762\u6211\u5c06\u4ece\u591a\u4e2a\u89d2\u5ea6\u5bf9Kotlin\u534f\u7a0b\u8fdb\u884c\u8be6\u7ec6\u89e3\u6790\u3002</p>"},{"location":"020Kotlin/020Coroutines/#_12","title":"\u57fa\u672c\u6982\u5ff5","text":"<ol> <li>\u534f\u7a0b\u662f\u4ec0\u4e48\uff1a</li> <li>\u534f\u7a0b\u662f\u4e00\u79cd\u8f7b\u91cf\u7ea7\u7684\u7ebf\u7a0b\uff0c\u53ef\u4ee5\u5728\u4e0d\u963b\u585e\u7ebf\u7a0b\u7684\u60c5\u51b5\u4e0b\u6302\u8d77\u548c\u6062\u590d\u6267\u884c</li> <li>\u5b83\u4e0d\u662f\u7ebf\u7a0b\uff0c\u800c\u662f\u8fd0\u884c\u5728\u7ebf\u7a0b\u4e0a\u7684\u53ef\u6302\u8d77\u8ba1\u7b97</li> <li> <p>\u4e00\u4e2a\u7ebf\u7a0b\u53ef\u4ee5\u8fd0\u884c\u591a\u4e2a\u534f\u7a0b</p> </li> <li> <p>\u4e3b\u8981\u7279\u70b9\uff1a</p> </li> <li>\u8f7b\u91cf\uff1a\u53ef\u4ee5\u5728\u5355\u4e2a\u7ebf\u7a0b\u4e0a\u8fd0\u884c\u5927\u91cf\u534f\u7a0b</li> <li>\u7ed3\u6784\u5316\u5e76\u53d1\uff1a\u63d0\u4f9b\u660e\u786e\u7684\u751f\u547d\u5468\u671f\u7ba1\u7406\u548c\u53d6\u6d88\u673a\u5236</li> <li>\u6302\u8d77\u51fd\u6570\uff1a\u4f7f\u7528<code>suspend</code>\u5173\u952e\u5b57\u6807\u8bb0\uff0c\u53ef\u4ee5\u5728\u4e0d\u963b\u585e\u7ebf\u7a0b\u7684\u60c5\u51b5\u4e0b\u6682\u505c\u6267\u884c</li> </ol>"},{"location":"020Kotlin/020Coroutines/#_13","title":"\u6838\u5fc3\u7ec4\u4ef6","text":"<ol> <li>CoroutineScope\uff1a</li> <li>\u534f\u7a0b\u4f5c\u7528\u57df\uff0c\u5b9a\u4e49\u4e86\u534f\u7a0b\u7684\u751f\u547d\u5468\u671f\u8303\u56f4</li> <li>\u5e38\u7528\u5b9e\u73b0\uff1a<code>GlobalScope</code>(\u5168\u5c40)\u3001<code>CoroutineScope</code>(\u81ea\u5b9a\u4e49)\u3001<code>MainScope</code>(\u4e3b\u7ebf\u7a0b)</li> <li> <p>\u7ed3\u6784\u5316\u5e76\u53d1\u7684\u5173\u952e\uff0c\u53ef\u4ee5\u53d6\u6d88\u4f5c\u7528\u57df\u4e0b\u6240\u6709\u534f\u7a0b</p> </li> <li> <p>CoroutineContext\uff1a</p> </li> <li>\u534f\u7a0b\u4e0a\u4e0b\u6587\uff0c\u5305\u542b\u534f\u7a0b\u8fd0\u884c\u7684\u5404\u79cd\u5143\u7d20</li> <li> <p>\u4e3b\u8981\u7ec4\u4ef6\uff1a</p> <ul> <li>Job\uff1a\u63a7\u5236\u534f\u7a0b\u7684\u751f\u547d\u5468\u671f</li> <li>Dispatcher\uff1a\u51b3\u5b9a\u534f\u7a0b\u5728\u54ea\u4e2a\u7ebf\u7a0b\u4e0a\u8fd0\u884c</li> <li>CoroutineName\uff1a\u534f\u7a0b\u540d\u79f0(\u8c03\u8bd5\u7528)</li> <li>ExceptionHandler\uff1a\u5f02\u5e38\u5904\u7406</li> </ul> </li> <li> <p>Dispatcher\uff1a</p> </li> <li>Dispatchers.Default\uff1aCPU\u5bc6\u96c6\u578b\u4efb\u52a1</li> <li>Dispatchers.IO\uff1aIO\u5bc6\u96c6\u578b\u4efb\u52a1</li> <li>Dispatchers.Main\uff1aAndroid\u4e3b\u7ebf\u7a0b</li> <li> <p>Dispatchers.Unconfined\uff1a\u4e0d\u9650\u5b9a\u7279\u5b9a\u7ebf\u7a0b</p> </li> <li> <p>Job\uff1a</p> </li> <li>\u8868\u793a\u4e00\u4e2a\u534f\u7a0b\u4efb\u52a1</li> <li>\u53ef\u4ee5\u53d6\u6d88\u3001\u7b49\u5f85\u5b8c\u6210\u3001\u67e5\u8be2\u72b6\u6001</li> <li> <p>\u53ef\u4ee5\u5f62\u6210\u7236\u5b50\u5173\u7cfb\uff0c\u7236Job\u53d6\u6d88\u4f1a\u5bfc\u81f4\u6240\u6709\u5b50Job\u53d6\u6d88</p> </li> <li> <p>Deferred\uff1a</p> </li> <li>\u7ee7\u627f\u81eaJob\uff0c\u8868\u793a\u4e00\u4e2a\u6709\u8fd4\u56de\u503c\u7684\u5f02\u6b65\u4efb\u52a1</li> <li>\u53ef\u4ee5\u901a\u8fc7<code>await()</code>\u83b7\u53d6\u7ed3\u679c</li> </ol>"},{"location":"020Kotlin/020Coroutines/#_14","title":"\u57fa\u672c\u7528\u6cd5","text":""},{"location":"020Kotlin/020Coroutines/#_15","title":"\u542f\u52a8\u534f\u7a0b","text":"<pre><code>// \u65b9\u5f0f1: launch - \u4e0d\u8fd4\u56de\u7ed3\u679c\nval job = CoroutineScope(Dispatchers.IO).launch {\n    // \u534f\u7a0b\u4f53\n    delay(1000)\n    println(\"Hello from coroutine\")\n}\n\n// \u65b9\u5f0f2: async - \u8fd4\u56deDeferred&lt;T&gt;\nval deferred = CoroutineScope(Dispatchers.Default).async {\n    // \u8ba1\u7b97\u5e76\u8fd4\u56de\u7ed3\u679c\n    delay(1000)\n    \"Result\"\n}\n\n// \u83b7\u53d6async\u7ed3\u679c\nval result = deferred.await()\n</code></pre>"},{"location":"020Kotlin/020Coroutines/#_16","title":"\u6302\u8d77\u51fd\u6570","text":"<pre><code>suspend fun fetchUserData(): User {\n    return withContext(Dispatchers.IO) {\n        // \u6a21\u62df\u7f51\u7edc\u8bf7\u6c42\n        delay(1000)\n        User(\"John\", 30)\n    }\n}\n</code></pre>"},{"location":"020Kotlin/020Coroutines/#_17","title":"\u7ed3\u6784\u5316\u5e76\u53d1","text":"<pre><code>fun loadData() {\n    CoroutineScope(Dispatchers.Main).launch {\n        try {\n            val user = async { fetchUserData() }\n            val posts = async { fetchUserPosts() }\n\n            updateUI(user.await(), posts.await())\n        } catch (e: Exception) {\n            showError(e)\n        }\n    }\n}\n</code></pre>"},{"location":"020Kotlin/020Coroutines/#_18","title":"\u5f02\u5e38\u5904\u7406","text":"<ol> <li> <p>try-catch\uff1a <pre><code>CoroutineScope(Dispatchers.IO).launch {\n    try {\n        fetchData()\n    } catch (e: Exception) {\n        // \u5904\u7406\u5f02\u5e38\n    }\n}\n</code></pre></p> </li> <li> <p>CoroutineExceptionHandler\uff1a <pre><code>val handler = CoroutineExceptionHandler { _, exception -&gt;\n    println(\"Caught $exception\")\n}\n\nCoroutineScope(Dispatchers.IO + handler).launch {\n    throw Exception(\"Test exception\")\n}\n</code></pre></p> </li> </ol>"},{"location":"020Kotlin/020Coroutines/#_19","title":"\u534f\u7a0b\u6784\u5efa\u5668","text":"<ol> <li>launch\uff1a</li> <li>\u542f\u52a8\u4e00\u4e2a\u4e0d\u8fd4\u56de\u7ed3\u679c\u7684\u534f\u7a0b</li> <li> <p>\u8fd4\u56deJob\u5bf9\u8c61\uff0c\u53ef\u7528\u4e8e\u53d6\u6d88\u6216\u7b49\u5f85</p> </li> <li> <p>async\uff1a</p> </li> <li>\u542f\u52a8\u4e00\u4e2a\u8fd4\u56deDeferred\u7684\u534f\u7a0b <li> <p>\u53ef\u4ee5\u901a\u8fc7await()\u83b7\u53d6\u7ed3\u679c</p> </li> <li> <p>runBlocking\uff1a</p> </li> <li>\u963b\u585e\u5f53\u524d\u7ebf\u7a0b\u76f4\u5230\u534f\u7a0b\u6267\u884c\u5b8c\u6210</li> <li> <p>\u4e3b\u8981\u7528\u4e8e\u6d4b\u8bd5\u6216main\u51fd\u6570\u4e2d</p> </li> <li> <p>withContext\uff1a</p> </li> <li>\u5207\u6362\u534f\u7a0b\u4e0a\u4e0b\u6587</li> <li>\u5e38\u7528\u4e8e\u5728\u4e0d\u540cDispatcher\u95f4\u5207\u6362</li>"},{"location":"020Kotlin/020Coroutines/#_20","title":"\u5b9e\u9645\u5e94\u7528\u573a\u666f","text":"<ol> <li> <p>\u7f51\u7edc\u8bf7\u6c42\uff1a <pre><code>suspend fun fetchData(): Data {\n    return withContext(Dispatchers.IO) {\n        // \u6267\u884c\u7f51\u7edc\u8bf7\u6c42\n    }\n}\n</code></pre></p> </li> <li> <p>\u6570\u636e\u5e93\u64cd\u4f5c\uff1a <pre><code>suspend fun insertUser(user: User) {\n    withContext(Dispatchers.IO) {\n        database.userDao().insert(user)\n    }\n}\n</code></pre></p> </li> <li> <p>\u5e76\u53d1\u4efb\u52a1\uff1a <pre><code>suspend fun loadData() {\n    val data1 = async { fetchData1() }\n    val data2 = async { fetchData2() }\n\n    val combinedData = combineData(data1.await(), data2.await())\n}\n</code></pre></p> </li> <li> <p>\u8d85\u65f6\u63a7\u5236\uff1a <pre><code>suspend fun fetchWithTimeout() {\n    try {\n        withTimeout(3000) {\n            fetchData()\n        }\n    } catch (e: TimeoutCancellationException) {\n        // \u5904\u7406\u8d85\u65f6\n    }\n}\n</code></pre></p> </li> </ol>"},{"location":"020Kotlin/020Coroutines/#_21","title":"\u6027\u80fd\u4f18\u5316\u6280\u5de7","text":"<ol> <li>\u907f\u514d\u5728\u534f\u7a0b\u4e2d\u6267\u884c\u963b\u585e\u64cd\u4f5c\uff0c\u4f7f\u7528\u9002\u5f53\u7684Dispatcher</li> <li>\u5408\u7406\u4f7f\u7528\u534f\u7a0b\u4f5c\u7528\u57df\uff0c\u907f\u514d\u5185\u5b58\u6cc4\u6f0f</li> <li>\u5bf9\u4e8e\u5927\u91cf\u5e76\u884c\u4efb\u52a1\uff0c\u8003\u8651\u4f7f\u7528<code>coroutineScope</code>\u6216<code>supervisorScope</code></li> <li>\u4f7f\u7528<code>channel</code>\u6216<code>flow</code>\u5904\u7406\u6570\u636e\u6d41</li> <li>\u907f\u514d\u4e0d\u5fc5\u8981\u7684\u534f\u7a0b\u521b\u5efa\uff0c\u590d\u7528\u73b0\u6709\u7684\u4f5c\u7528\u57df</li> </ol>"},{"location":"020Kotlin/020Coroutines/#rxjava","title":"\u4e0eRxJava\u6bd4\u8f83","text":"<ol> <li>\u5b66\u4e60\u66f2\u7ebf\uff1a\u534f\u7a0b\u66f4\u7b80\u5355\uff0c\u6982\u5ff5\u66f4\u5c11</li> <li>\u8d44\u6e90\u6d88\u8017\uff1a\u534f\u7a0b\u66f4\u8f7b\u91cf</li> <li>\u7ed3\u6784\u5316\u5e76\u53d1\uff1a\u534f\u7a0b\u539f\u751f\u652f\u6301</li> <li>\u64cd\u4f5c\u7b26\u4e30\u5bcc\u5ea6\uff1aRxJava\u64cd\u4f5c\u7b26\u66f4\u4e30\u5bcc</li> <li>\u80cc\u538b\u5904\u7406\uff1aRxJava\u6709\u66f4\u597d\u7684\u80cc\u538b\u652f\u6301</li> </ol> <p>Kotlin\u534f\u7a0b\u63d0\u4f9b\u4e86\u4e00\u79cd\u66f4\u52a0\u76f4\u89c2\u548c\u7b80\u6d01\u7684\u65b9\u5f0f\u6765\u5904\u7406\u5f02\u6b65\u7f16\u7a0b\uff0c\u7279\u522b\u9002\u5408Kotlin\u548cAndroid\u5f00\u53d1\u3002\u901a\u8fc7\u7ed3\u6784\u5316\u5e76\u53d1\u548c\u6302\u8d77\u51fd\u6570\uff0c\u53ef\u4ee5\u7f16\u5199\u51fa\u66f4\u6e05\u6670\u3001\u66f4\u5b89\u5168\u7684\u5f02\u6b65\u4ee3\u7801\u3002</p>"},{"location":"020Kotlin/020Coroutines/#_22","title":"\u534f\u7a0b\u7684\u6280\u672f\u539f\u7406","text":"\u7b54\u6848"},{"location":"020Kotlin/020Coroutines/#kotlin_2","title":"Kotlin\u534f\u7a0b\u6e90\u7801\u5206\u6790","text":"<p>Kotlin\u534f\u7a0b\u662fKotlin\u8bed\u8a00\u4e2d\u7528\u4e8e\u7b80\u5316\u5f02\u6b65\u7f16\u7a0b\u7684\u91cd\u8981\u7279\u6027\u3002\u4e0b\u9762\u4ece\u6e90\u7801\u89d2\u5ea6\u5206\u6790\u5176\u6838\u5fc3\u5b9e\u73b0\u673a\u5236\u3002</p>"},{"location":"020Kotlin/020Coroutines/#_23","title":"\u4e00\u3001\u534f\u7a0b\u7684\u57fa\u672c\u7ed3\u6784","text":"<p>Kotlin\u534f\u7a0b\u7684\u6838\u5fc3\u4ee3\u7801\u4e3b\u8981\u5728<code>kotlinx.coroutines</code>\u5305\u4e2d\uff0c\u5173\u952e\u7c7b\u5305\u62ec\uff1a</p> <ol> <li> <p>Continuation.kt - \u5b9a\u4e49\u534f\u7a0b\u7684\u7eed\u4f53(Continuation)\u63a5\u53e3 <pre><code>public interface Continuation&lt;in T&gt; {\n    public val context: CoroutineContext\n    public fun resumeWith(result: Result&lt;T&gt;)\n}\n</code></pre></p> </li> <li> <p>CoroutineContext.kt - \u5b9a\u4e49\u534f\u7a0b\u4e0a\u4e0b\u6587 <pre><code>public interface CoroutineContext {\n    // \u64cd\u4f5c\u7b26\u91cd\u8f7d\u548c\u4e0a\u4e0b\u6587\u5143\u7d20\u7ba1\u7406\n}\n</code></pre></p> </li> </ol>"},{"location":"020Kotlin/020Coroutines/#_24","title":"\u4e8c\u3001\u534f\u7a0b\u6784\u5efa\u5668\u5b9e\u73b0","text":""},{"location":"020Kotlin/020Coroutines/#1-launch","title":"1. launch\u6784\u5efa\u5668","text":"<p><code>launch</code>\u662f\u5e38\u7528\u7684\u534f\u7a0b\u6784\u5efa\u5668\uff0c\u5176\u6838\u5fc3\u5b9e\u73b0\uff1a</p> <pre><code>public fun CoroutineScope.launch(\n    context: CoroutineContext = EmptyCoroutineContext,\n    start: CoroutineStart = CoroutineStart.DEFAULT,\n    block: suspend CoroutineScope.() -&gt; Unit\n): Job {\n    val newContext = newCoroutineContext(context)\n    val coroutine = if (start.isLazy)\n        LazyStandaloneCoroutine(newContext, block) else\n        StandaloneCoroutine(newContext, active = true)\n    coroutine.start(start, coroutine, block)\n    return coroutine\n}\n</code></pre>"},{"location":"020Kotlin/020Coroutines/#2-async","title":"2. async\u6784\u5efa\u5668","text":"<p><code>async</code>\u8fd4\u56de<code>Deferred</code>\u5bf9\u8c61\uff0c\u5141\u8bb8\u83b7\u53d6\u5f02\u6b65\u7ed3\u679c\uff1a</p> <pre><code>public fun &lt;T&gt; CoroutineScope.async(\n    context: CoroutineContext = EmptyCoroutineContext,\n    start: CoroutineStart = CoroutineStart.DEFAULT,\n    block: suspend CoroutineScope.() -&gt; T\n): Deferred&lt;T&gt; {\n    val newContext = newCoroutineContext(context)\n    val coroutine = if (start.isLazy)\n        LazyDeferredCoroutine(newContext, block) else\n        DeferredCoroutine&lt;T&gt;(newContext, active = true)\n    coroutine.start(start, coroutine, block)\n    return coroutine\n}\n</code></pre>"},{"location":"020Kotlin/020Coroutines/#_25","title":"\u4e09\u3001\u534f\u7a0b\u8c03\u5ea6\u5668\u5b9e\u73b0","text":"<p>\u8c03\u5ea6\u5668\u6838\u5fc3\u5728<code>Dispatchers.kt</code>\u4e2d\uff1a</p> <pre><code>public actual object Dispatchers {\n    public actual val Default: CoroutineDispatcher = DefaultScheduler\n    public actual val Main: MainCoroutineDispatcher get() = MainDispatcherLoader.dispatcher\n    public actual val Unconfined: CoroutineDispatcher = kotlinx.coroutines.Unconfined\n    public val IO: CoroutineDispatcher = DefaultIoScheduler\n}\n</code></pre> <p>\u8c03\u5ea6\u5668\u7ee7\u627f\u5173\u7cfb\uff1a <pre><code>CoroutineDispatcher\n    -&gt; ExperimentalCoroutineDispatcher\n    -&gt; ExecutorCoroutineDispatcher\n        -&gt; ThreadPoolDispatcher\n    -&gt; EventLoop\n        -&gt; Unconfined\n</code></pre></p>"},{"location":"020Kotlin/020Coroutines/#_26","title":"\u56db\u3001\u534f\u7a0b\u6302\u8d77\u4e0e\u6062\u590d\u673a\u5236","text":""},{"location":"020Kotlin/020Coroutines/#1_1","title":"1. \u6302\u8d77\u51fd\u6570\u8f6c\u6362","text":"<p>Kotlin\u7f16\u8bd1\u5668\u4f1a\u5c06\u6302\u8d77\u51fd\u6570\u8f6c\u6362\u4e3a\u72b6\u6001\u673a\u3002\u4f8b\u5982\uff1a</p> <pre><code>suspend fun foo() = suspendCoroutine { cont -&gt; \n    // \u5f02\u6b65\u64cd\u4f5c\n}\n</code></pre> <p>\u4f1a\u88ab\u7f16\u8bd1\u5668\u8f6c\u6362\u4e3a\u7c7b\u4f3c\uff1a <pre><code>public final Object foo(Continuation $completion) {\n    SafeContinuation cont = new SafeContinuation(IntrinsicsKt.intercepted($completion));\n    // \u5f02\u6b65\u64cd\u4f5c\u903b\u8f91\n    return cont.getResult();\n}\n</code></pre></p>"},{"location":"020Kotlin/020Coroutines/#2-continuation-passing-style-cps","title":"2. Continuation Passing Style (CPS)","text":"<p>\u7f16\u8bd1\u5668\u5c06\u6302\u8d77\u51fd\u6570\u8f6c\u6362\u4e3aCPS\u98ce\u683c\uff0c\u6bcf\u4e2a\u6302\u8d77\u70b9\u5bf9\u5e94\u4e00\u4e2a\u72b6\u6001\uff1a</p> <pre><code>// \u539f\u59cb\u4ee3\u7801\nsuspend fun fetchData(): Data {\n    val data1 = fetchData1() // \u6302\u8d77\u70b91\n    val data2 = fetchData2(data1) // \u6302\u8d77\u70b92\n    return process(data2)\n}\n\n// \u8f6c\u6362\u540e\u7c7b\u4f3c\nfun fetchData(continuation: Continuation&lt;Data&gt;): Any {\n    class FetchDataContinuation(...) : ContinuationImpl {\n        var result: Any? = null\n        var label = 0\n\n        fun invokeSuspend(result: Any?): Any? {\n            this.result = result\n            return fetchData(this)\n        }\n    }\n\n    val cont = continuation as? FetchDataContinuation ?: FetchDataContinuation(continuation)\n\n    when (cont.label) {\n        0 -&gt; {\n            cont.label = 1\n            val result = fetchData1(cont)\n            if (result == COROUTINE_SUSPENDED) return COROUTINE_SUSPENDED\n            // \u7ee7\u7eed\u6267\u884c\n        }\n        1 -&gt; {\n            val data1 = cont.result as Data\n            cont.label = 2\n            val result = fetchData2(data1, cont)\n            if (result == COROUTINE_SUSPENDED) return COROUTINE_SUSPENDED\n            // \u7ee7\u7eed\u6267\u884c\n        }\n        // \u5176\u4ed6\u72b6\u6001...\n    }\n}\n</code></pre>"},{"location":"020Kotlin/020Coroutines/#_27","title":"\u4e94\u3001\u534f\u7a0b\u4e0a\u4e0b\u6587\u4e0e\u62e6\u622a\u5668","text":"<p><code>CoroutineContext</code>\u4f7f\u7528\u7c7b\u4f3cMap\u7684\u7ed3\u6784\u5b58\u50a8\u4e0a\u4e0b\u6587\u5143\u7d20\uff0c\u5173\u952e\u5b9e\u73b0\uff1a</p> <pre><code>public interface CoroutineContext {\n    public operator fun &lt;E : Element&gt; get(key: Key&lt;E&gt;): E?\n    public fun &lt;R&gt; fold(initial: R, operation: (R, Element) -&gt; R): R\n    public operator fun plus(context: CoroutineContext): CoroutineContext\n    // ...\n}\n\npublic interface Element : CoroutineContext {\n    public val key: Key&lt;*&gt;\n}\n</code></pre> <p>\u62e6\u622a\u5668\u5b9e\u73b0\uff1a <pre><code>public interface ContinuationInterceptor : CoroutineContext.Element {\n    companion object Key : CoroutineContext.Key&lt;ContinuationInterceptor&gt;\n\n    fun &lt;T&gt; interceptContinuation(continuation: Continuation&lt;T&gt;): Continuation&lt;T&gt;\n    // ...\n}\n</code></pre></p>"},{"location":"020Kotlin/020Coroutines/#_28","title":"\u516d\u3001\u534f\u7a0b\u53d6\u6d88\u673a\u5236","text":"<p>\u53d6\u6d88\u901a\u8fc7\u534f\u4f5c\u5f0f\u5b9e\u73b0\uff0c\u6838\u5fc3\u5728<code>JobSupport.kt</code>\uff1a</p> <pre><code>public open class JobSupport constructor(active: Boolean) : Job, ChildJob, ParentJob, SelectClause0 {\n    protected final override fun cancelImpl(cause: Any?): Boolean {\n        // \u53d6\u6d88\u903b\u8f91\n        makeCancelling(cause)\n        // ...\n    }\n\n    private fun makeCancelling(cause: Any?): Boolean {\n        // \u72b6\u6001\u8f6c\u6362\n        _state.update { state -&gt;\n            if (state !is Incomplete) return false // \u5df2\u7ecf\u5b8c\u6210\n            val newState = Finishing(state, cause, handled = false)\n            // ...\n        }\n        // \u901a\u77e5\u5b50\u534f\u7a0b\n        notifyCancelling(list, cause)\n    }\n}\n</code></pre>"},{"location":"020Kotlin/020Coroutines/#_29","title":"\u4e03\u3001\u534f\u7a0b\u4e0e\u7ebf\u7a0b\u6c60","text":"<p>\u9ed8\u8ba4\u8c03\u5ea6\u5668\u4f7f\u7528\u7ebf\u7a0b\u6c60\u5b9e\u73b0\uff0c\u6838\u5fc3\u5728<code>CoroutineScheduler.kt</code>\uff1a</p> <pre><code>internal class CoroutineScheduler(\n    val corePoolSize: Int,\n    val maxPoolSize: Int,\n    val idleWorkerKeepAliveNs: Long = IDLE_WORKER_KEEP_ALIVE_NS,\n    val schedulerName: String = DEFAULT_SCHEDULER_NAME\n) : Executor, Closeable {\n    // \u5de5\u4f5c\u7ebf\u7a0b\u7ba1\u7406\n    private val workers = atomicArrayOfNulls&lt;Worker&gt;(corePoolSize)\n\n    // \u4efb\u52a1\u961f\u5217\n    private val globalCpuQueue = GlobalQueue()\n    private val globalBlockingQueue = GlobalQueue()\n\n    // \u6267\u884c\u903b\u8f91\n    fun dispatch(block: Runnable, taskContext: TaskContext = NonBlockingContext, tailDispatch: Boolean = false) {\n        // \u4efb\u52a1\u5206\u53d1\u903b\u8f91\n    }\n}\n</code></pre>"},{"location":"020Kotlin/020Coroutines/#flow","title":"\u516b\u3001Flow\u5b9e\u73b0\u539f\u7406","text":"<p>Kotlin Flow\u662f\u57fa\u4e8e\u534f\u7a0b\u7684\u54cd\u5e94\u5f0f\u6d41\u5b9e\u73b0\uff0c\u6838\u5fc3\u5728<code>Flow.kt</code>\uff1a</p> <pre><code>public interface Flow&lt;out T&gt; {\n    public suspend fun collect(collector: FlowCollector&lt;T&gt;)\n}\n\npublic fun &lt;T&gt; flow(block: suspend FlowCollector&lt;T&gt;.() -&gt; Unit): Flow&lt;T&gt; = SafeFlow(block)\n\nprivate class SafeFlow&lt;T&gt;(private val block: suspend FlowCollector&lt;T&gt;.() -&gt; Unit) : AbstractFlow&lt;T&gt;() {\n    override suspend fun collectSafely(collector: FlowCollector&lt;T&gt;) {\n        collector.block()\n    }\n}\n</code></pre>"},{"location":"020Kotlin/020Coroutines/#_30","title":"\u4e5d\u3001\u534f\u7a0b\u8c03\u8bd5\u652f\u6301","text":"<p>\u534f\u7a0b\u63d0\u4f9b\u4e86\u8c03\u8bd5\u5de5\u5177\uff0c\u901a\u8fc7<code>-Dkotlinx.coroutines.debug</code>\u542f\u7528\uff1a</p> <pre><code>public actual val CoroutineId: CoroutineContext.Key&lt;CoroutineId&gt; = CoroutineId.Key\n\npublic class CoroutineId(\n    public val id: Long\n) : ThreadContextElement&lt;String&gt;, AbstractCoroutineContextElement(CoroutineId) {\n    // \u4e3a\u7ebf\u7a0b\u4e0a\u4e0b\u6587\u6dfb\u52a0\u534f\u7a0bID\n}\n</code></pre>"},{"location":"020Kotlin/020Coroutines/#_31","title":"\u603b\u7ed3","text":"<p>Kotlin\u534f\u7a0b\u901a\u8fc7\u4ee5\u4e0b\u6838\u5fc3\u6280\u672f\u5b9e\u73b0\uff1a 1. CPS\u8f6c\u6362 - \u7f16\u8bd1\u5668\u5c06\u6302\u8d77\u51fd\u6570\u8f6c\u6362\u4e3a\u72b6\u6001\u673a 2. \u7eed\u4f53\u4f20\u9012 - \u901a\u8fc7Continuation\u5bf9\u8c61\u7ba1\u7406\u6267\u884c\u6d41\u7a0b 3. \u8c03\u5ea6\u5668 - \u63a7\u5236\u534f\u7a0b\u5728\u54ea\u4e2a\u7ebf\u7a0b\u6267\u884c 4. \u7ed3\u6784\u5316\u5e76\u53d1 - \u901a\u8fc7Job\u548cScope\u7ba1\u7406\u534f\u7a0b\u751f\u547d\u5468\u671f 5. \u534f\u4f5c\u5f0f\u53d6\u6d88 - \u5b89\u5168\u5730\u53d6\u6d88\u534f\u7a0b\u6267\u884c</p> <p>\u534f\u7a0b\u7684\u8f7b\u91cf\u7ea7\u7279\u6027\u6765\u81ea\u4e8e\u5b83\u4e0d\u76f4\u63a5\u7ed1\u5b9a\u7ebf\u7a0b\uff0c\u800c\u662f\u901a\u8fc7\u6302\u8d77/\u6062\u590d\u673a\u5236\u5b9e\u73b0\u7ebf\u7a0b\u7684\u9ad8\u6548\u5229\u7528\u3002</p>"},{"location":"020Kotlin/020Coroutines/#java","title":"\u534f\u7a0b\u548cJava\u7ebf\u7a0b\u7684\u5173\u7cfb\u548c\u533a\u522b","text":"\u7b54\u6848 <p>\u5728\u534f\u7a0b\u7684\u5b9e\u73b0\u4e2d\uff08\u4ee5 Kotlin\u534f\u7a0b \u4e3a\u4f8b\uff09\uff0c\u534f\u7a0b\u7684\u8c03\u5ea6\u4f9d\u8d56\u4e8eJava\u7ebf\u7a0b\u6c60\u6216\u7ebf\u7a0b\u6a21\u578b\uff0c\u4f46\u901a\u8fc7\u5c01\u88c5\u5c06\u534f\u7a0b\u4efb\u52a1\u5206\u914d\u5230\u7ebf\u7a0b\u4e0a\u6267\u884c\u3002\u4ee5\u4e0b\u662f\u5173\u952e\u7c7b\u548c\u673a\u5236\u7684\u5206\u6790\uff1a</p> \u8be6\u7ec6\u7b54\u6848"},{"location":"020Kotlin/020Coroutines/#1-kotlinjava","title":"1. Kotlin\u534f\u7a0b\u4e2d\u4e0eJava\u7ebf\u7a0b\u4ea4\u4e92\u7684\u6838\u5fc3\u7c7b","text":""},{"location":"020Kotlin/020Coroutines/#1dispatchers","title":"\uff081\uff09\u8c03\u5ea6\u5668\uff08Dispatchers\uff09","text":"<ul> <li>\u4f5c\u7528\uff1a\u51b3\u5b9a\u534f\u7a0b\u8fd0\u884c\u5728\u54ea\u4e2a\u7ebf\u7a0b\u6216\u7ebf\u7a0b\u6c60\u3002</li> <li>\u6838\u5fc3\u7c7b\uff1a</li> <li><code>Dispatchers.Default</code>\uff1a\u9ed8\u8ba4\u7684CPU\u5bc6\u96c6\u578b\u4efb\u52a1\u7ebf\u7a0b\u6c60\uff08\u57fa\u4e8e<code>java.util.concurrent.Executor</code>\uff09\u3002</li> <li><code>Dispatchers.IO</code>\uff1aI/O\u5bc6\u96c6\u578b\u4efb\u52a1\u7684\u7ebf\u7a0b\u6c60\uff08\u590d\u7528<code>Default</code>\u7684\u7ebf\u7a0b\u6c60\uff0c\u4f46\u5141\u8bb8\u66f4\u5927\u5e76\u53d1\u6570\uff09\u3002</li> <li><code>Dispatchers.Main</code>\uff1aAndroid/JavaFX\u7b49UI\u7ebf\u7a0b\uff08\u901a\u8fc7\u5e73\u53f0\u7279\u5b9a\u5b9e\u73b0\uff0c\u5982<code>Handler</code>\u6216<code>JavaFX Application Thread</code>\uff09\u3002</li> </ul> <p>\u6e90\u7801\u5173\u952e\u70b9\uff1a <pre><code>// kotlinx.coroutines.Dispatchers\npublic actual val Default: CoroutineDispatcher = DefaultScheduler\npublic actual val IO: CoroutineDispatcher = DefaultIoScheduler\n</code></pre></p>"},{"location":"020Kotlin/020Coroutines/#2java","title":"\uff082\uff09\u7ebf\u7a0b\u6c60\u5b9e\u73b0\uff08\u5e95\u5c42\u4f9d\u8d56Java\u7ebf\u7a0b\uff09","text":"<ul> <li><code>ExecutorCoroutineDispatcher</code>\uff1a \u62bd\u8c61\u7c7b\uff0c\u5c06\u534f\u7a0b\u8c03\u5ea6\u5230Java\u7684<code>Executor</code>\u7ebf\u7a0b\u6c60\u3002 <pre><code>// kotlinx.coroutines.ExecutorCoroutineDispatcher\npublic abstract class ExecutorCoroutineDispatcher : CoroutineDispatcher(), Closeable {\n    public abstract val executor: Executor\n}\n</code></pre></li> <li><code>ThreadPoolDispatcher</code>\uff08\u65e7\u7248\uff09 / <code>DefaultScheduler</code>\uff1a \u5185\u90e8\u4f7f\u7528Java\u7684<code>ThreadPoolExecutor</code>\uff1a <pre><code>// kotlinx.coroutines.scheduling.CoroutineScheduler\ninternal class CoroutineScheduler(...) : Executor, Closeable {\n    // \u5b9e\u9645\u4f7f\u7528Java\u7ebf\u7a0b\u6c60\u7684Worker\u7ebf\u7a0b\n    private val workers = Array(parallelism) { Worker(it) }\n}\n</code></pre></li> </ul>"},{"location":"020Kotlin/020Coroutines/#3coroutinedispatcher","title":"\uff083\uff09\u534f\u7a0b\u4e0e\u7ebf\u7a0b\u7684\u7ed1\u5b9a\uff08CoroutineDispatcher\uff09","text":"<ul> <li><code>CoroutineDispatcher</code>\uff1a \u534f\u7a0b\u8c03\u5ea6\u5668\u7684\u57fa\u7c7b\uff0c\u901a\u8fc7<code>dispatch</code>\u65b9\u6cd5\u5c06\u534f\u7a0b\u4efb\u52a1\u5206\u914d\u5230\u7ebf\u7a0b\u3002 <pre><code>public abstract class CoroutineDispatcher {\n    public abstract fun dispatch(context: CoroutineContext, block: Runnable)\n}\n</code></pre></li> <li>\u5b9e\u73b0\u7c7b\uff08\u5982<code>Dispatchers.Default</code>\uff09\u4f1a\u8c03\u7528Java\u7ebf\u7a0b\u6c60\u7684<code>execute</code>\u65b9\u6cd5\u3002</li> </ul>"},{"location":"020Kotlin/020Coroutines/#2_1","title":"2. \u6e90\u7801\u8c03\u7528\u94fe\u793a\u4f8b","text":"<p>\u4ee5<code>launch(Dispatchers.IO)</code>\u4e3a\u4f8b\uff1a 1. \u542f\u52a8\u534f\u7a0b\uff1a <pre><code>launch(Dispatchers.IO) { /* \u534f\u7a0b\u4f53 */ }\n</code></pre> 2. \u8c03\u5ea6\u5230\u7ebf\u7a0b\u6c60\uff1a - <code>Dispatchers.IO</code>\u5b9e\u9645\u662f<code>LimitingDispatcher</code>\uff0c\u6700\u7ec8\u59d4\u6258\u7ed9<code>DefaultScheduler</code>\u3002 - <code>DefaultScheduler</code>\u5185\u90e8\u901a\u8fc7<code>CoroutineScheduler</code>\uff08\u7c7b\u4f3c\u7ebf\u7a0b\u6c60\uff09\u6267\u884c\u4efb\u52a1\u3002 3. \u7ebf\u7a0b\u6c60\u6267\u884c\uff1a - <code>CoroutineScheduler.Worker</code>\u7ee7\u627f\u81ea<code>Thread</code>\uff0c\u6700\u7ec8\u7531Java\u7ebf\u7a0b\u6267\u884c\u534f\u7a0b\u4efb\u52a1\u3002</p>"},{"location":"020Kotlin/020Coroutines/#3_1","title":"3. \u5173\u952e\u4ee3\u7801\u7247\u6bb5","text":""},{"location":"020Kotlin/020Coroutines/#1java","title":"\uff081\uff09\u8c03\u5ea6\u5668\u4f7f\u7528Java\u7ebf\u7a0b\u6c60","text":"<p>\u5728<code>kotlinx.coroutines.scheduling</code>\u5305\u4e2d\uff1a <pre><code>// CoroutineScheduler.kt\ninternal class CoroutineScheduler(\n    val corePoolSize: Int,\n    val maxPoolSize: Int,\n    val idleWorkerKeepAliveNs: Long\n) : Executor {\n    // Worker\u662fJava\u7ebf\u7a0b\u7684\u5c01\u88c5\n    private inner class Worker private constructor() : Thread() {\n        override fun run() = runWorker()\n    }\n}\n</code></pre></p>"},{"location":"020Kotlin/020Coroutines/#2dispatcher","title":"\uff082\uff09Dispatcher\u7684\u7ebf\u7a0b\u6c60\u7ed1\u5b9a","text":"<p><code>Dispatchers.IO</code>\u7684\u9ed8\u8ba4\u5b9e\u73b0\uff1a <pre><code>// Dispatchers.kt\ninternal object DefaultScheduler : ExperimentalCoroutineDispatcher() {\n    override fun dispatch(context: CoroutineContext, block: Runnable) {\n        // \u6700\u7ec8\u8c03\u7528CoroutineScheduler\u7684execute\u65b9\u6cd5\n        coroutineScheduler.dispatch(block)\n    }\n}\n</code></pre></p>"},{"location":"020Kotlin/020Coroutines/#4_1","title":"4. \u5176\u4ed6\u534f\u7a0b\u5e93\u7684\u7ebf\u7a0b\u4ea4\u4e92","text":""},{"location":"020Kotlin/020Coroutines/#1project-loomvirtualthread","title":"\uff081\uff09Project Loom\uff08VirtualThread\uff09","text":"<ul> <li><code>VirtualThread</code>\uff1a JVM\u5c42\u9762\u7684\u8f7b\u91cf\u7ea7\u7ebf\u7a0b\uff0c\u76f4\u63a5\u7531JVM\u8c03\u5ea6\u5230Java\u7684<code>Carrier Thread</code>\uff08\u5e73\u53f0\u7ebf\u7a0b\uff09\u4e0a\u3002 <pre><code>// Java\u4ee3\u7801\u793a\u4f8b\nThread.startVirtualThread(() -&gt; {\n    System.out.println(\"Running on virtual thread\");\n});\n</code></pre></li> </ul>"},{"location":"020Kotlin/020Coroutines/#2quasarqe","title":"\uff082\uff09Quasar/QE","text":"<ul> <li><code>Fiber</code>\uff1a \u901a\u8fc7\u5b57\u8282\u7801\u589e\u5f3a\u6302\u8d77\u534f\u7a0b\uff0c\u4f9d\u8d56<code>FiberScheduler</code>\uff08\u5185\u90e8\u4f7f\u7528<code>ForkJoinPool</code>\u6216\u81ea\u5b9a\u4e49\u7ebf\u7a0b\u6c60\uff09\u3002</li> </ul>"},{"location":"020Kotlin/020Coroutines/#_32","title":"\u603b\u7ed3","text":"<ul> <li>\u76f4\u63a5\u4f9d\u8d56Java\u7ebf\u7a0b\u7684\u7c7b\uff1a</li> <li><code>CoroutineScheduler.Worker</code>\uff08Kotlin\u534f\u7a0b\uff09</li> <li><code>ExecutorCoroutineDispatcher</code>\uff08\u5c01\u88c5Java\u7684<code>Executor</code>\uff09</li> <li><code>VirtualThread</code>\uff08Project Loom\uff09</li> <li>\u6838\u5fc3\u673a\u5236\uff1a</li> <li>\u534f\u7a0b\u901a\u8fc7\u8c03\u5ea6\u5668\uff08<code>Dispatcher</code>\uff09\u5c06\u4efb\u52a1\u5206\u914d\u5230Java\u7ebf\u7a0b\u6c60\u3002</li> <li>\u6302\u8d77/\u6062\u590d\u7531\u534f\u7a0b\u5e93\u7ba1\u7406\uff0c\u4e0d\u963b\u585e\u5e95\u5c42\u7ebf\u7a0b\u3002</li> </ul> <p>\u901a\u8fc7\u5206\u6790<code>Dispatchers</code>\u3001<code>CoroutineScheduler</code>\u7b49\u7c7b\uff0c\u53ef\u4ee5\u6e05\u6670\u770b\u5230\u534f\u7a0b\u5982\u4f55\u5229\u7528Java\u7ebf\u7a0b\u5b9e\u73b0\u9ad8\u6548\u8c03\u5ea6\u3002</p>"},{"location":"020Kotlin/020Coroutines/#kotlin_3","title":"Kotlin\u534f\u7a0b\u7684\u7ebf\u7a0b\u8c03\u5ea6\u673a\u5236\u5206\u6790","text":"<p>Kotlin\u534f\u7a0b\u63d0\u4f9b\u4e86\u4e00\u5957\u5f3a\u5927\u7684\u5f02\u6b65\u7f16\u7a0b\u6a21\u578b\uff0c\u5176\u5e95\u5c42\u5b9e\u73b0\u4f9d\u8d56\u4e8eJava\u7684\u7ebf\u7a0b\u7cfb\u7edf\u8fdb\u884c\u5b9e\u9645\u7684\u4efb\u52a1\u6267\u884c\u3002\u6211\u5c06\u4ece\u6e90\u7801\u89d2\u5ea6\u5206\u6790Kotlin\u534f\u7a0b\u662f\u5982\u4f55\u534f\u8c03Java\u7ebf\u7a0b\u6267\u884c\u4efb\u52a1\u7684\u3002</p>"},{"location":"020Kotlin/020Coroutines/#_33","title":"\u6574\u4f53\u67b6\u6784","text":"<p>Kotlin\u534f\u7a0b\u7684\u8c03\u5ea6\u7cfb\u7edf\u4e3b\u8981\u7531\u4ee5\u4e0b\u51e0\u4e2a\u6838\u5fc3\u7ec4\u4ef6\u6784\u6210\uff1a</p> <ol> <li>Dispatchers - \u534f\u7a0b\u8c03\u5ea6\u5668\uff0c\u51b3\u5b9a\u534f\u7a0b\u5728\u54ea\u4e2a\u7ebf\u7a0b\u4e0a\u6267\u884c</li> <li>CoroutineScheduler - \u5185\u90e8\u7ebf\u7a0b\u6c60\u5b9e\u73b0</li> <li>Worker - \u5de5\u4f5c\u7ebf\u7a0b\u7684\u5c01\u88c5</li> <li>WorkQueue - \u4efb\u52a1\u961f\u5217</li> <li>Task - \u5b9e\u9645\u6267\u884c\u7684\u534f\u7a0b\u4efb\u52a1</li> </ol>"},{"location":"020Kotlin/020Coroutines/#defaultschedulercoroutinescheduler","title":"DefaultScheduler\u4e0eCoroutineScheduler","text":"<p><code>DefaultScheduler</code>\u662f<code>Dispatchers.Default</code>\u7684\u5e95\u5c42\u5b9e\u73b0\uff0c\u5b83\u4f5c\u4e3a\u9ed8\u8ba4\u7684\u534f\u7a0b\u8c03\u5ea6\u5668\uff0c\u4f7f\u7528<code>CoroutineScheduler</code>\u4f5c\u4e3a\u5176\u7ebf\u7a0b\u6c60\u5b9e\u73b0\u3002</p> <pre><code>internal object DefaultScheduler : ExperimentalCoroutineDispatcher() {\n    val IO: CoroutineDispatcher = LimitingDispatcher(\n        this,\n        systemProp(IO_PARALLELISM_PROPERTY_NAME, 64.coerceAtLeast(AVAILABLE_PROCESSORS)),\n        \"Dispatchers.IO\",\n        TASK_PROBABLY_BLOCKING\n    )\n\n    override fun close() {\n        throw UnsupportedOperationException(\"$DEFAULT_DISPATCHER_NAME cannot be closed\")\n    }\n}\n</code></pre> <p><code>CoroutineScheduler</code>\u662f\u4e00\u4e2a\u81ea\u5b9a\u4e49\u7684\u7ebf\u7a0b\u6c60\u5b9e\u73b0\uff0c\u8d1f\u8d23\u7ba1\u7406\u4e00\u7ec4Worker\u7ebf\u7a0b\uff1a</p> <pre><code>internal class CoroutineScheduler(\n    @JvmField val corePoolSize: Int,\n    @JvmField val maxPoolSize: Int,\n    @JvmField val idleWorkerKeepAliveNs: Long = IDLE_WORKER_KEEP_ALIVE_NS,\n    @JvmField val schedulerName: String = \"CoroutineScheduler\"\n) : Executor, Closeable {\n    // \u5b58\u50a8\u6240\u6709\u7684Worker\u7ebf\u7a0b\n    private val workers = AtomicReferenceArray&lt;Worker?&gt;(maxPoolSize + 1)\n\n    // \u5168\u5c40\u4efb\u52a1\u961f\u5217\n    internal val globalCpuQueue = GlobalQueue()\n    internal val globalBlockingQueue = GlobalQueue()\n}\n</code></pre>"},{"location":"020Kotlin/020Coroutines/#worker","title":"Worker\u7ebf\u7a0b","text":"<p><code>Worker</code>\u662f<code>CoroutineScheduler</code>\u4e2d\u7684\u5de5\u4f5c\u7ebf\u7a0b\uff0c\u7ee7\u627f\u81eaJava\u7684<code>Thread</code>\uff1a</p> <pre><code>internal inner class Worker private constructor() : Thread() {\n    // \u6bcf\u4e2aWorker\u90fd\u6709\u81ea\u5df1\u7684\u672c\u5730\u4efb\u52a1\u961f\u5217\n    internal val localQueue = WorkQueue()\n\n    // Worker\u72b6\u6001\uff1aPARKING, BLOCKING, DORMANT\u7b49\n    private var state = DORMANT\n\n    override fun run() {\n        var task = findTask()\n        while (task != null) {\n            runTask(task)\n            task = findTask()\n        }\n        // \u6ca1\u6709\u4efb\u52a1\u540e\uff0c\u7ebf\u7a0b\u4f1a\u8fdb\u5165PARKING\u72b6\u6001\n    }\n\n    private fun findTask(): Task? {\n        // 1. \u5148\u67e5\u770b\u672c\u5730\u961f\u5217\n        // 2. \u5c1d\u8bd5\u4ece\u5176\u4ed6Worker\u5077\u53d6\u4efb\u52a1\n        // 3. \u4ece\u5168\u5c40\u961f\u5217\u83b7\u53d6\u4efb\u52a1\n        // 4. \u5982\u679c\u8fd8\u6ca1\u6709\uff0c\u53ef\u80fd\u4f1a\u963b\u585e\u6216\u8fdb\u5165PARKING\u72b6\u6001\n    }\n}\n</code></pre>"},{"location":"020Kotlin/020Coroutines/#workqueue","title":"WorkQueue\u4efb\u52a1\u961f\u5217","text":"<p><code>WorkQueue</code>\u662f\u4e00\u4e2a\u65e0\u9501\u7684\u4efb\u52a1\u961f\u5217\uff0c\u7528\u4e8e\u5b58\u50a8\u5f85\u6267\u884c\u7684\u534f\u7a0b\u4efb\u52a1\uff1a</p> <pre><code>internal class WorkQueue {\n    // \u5e95\u5c42\u4f7f\u7528\u6570\u7ec4\u5b9e\u73b0\n    private var array = arrayOfNulls&lt;Task&gt;(INITIAL_CAPACITY)\n\n    // \u6dfb\u52a0\u4efb\u52a1\n    fun add(task: Task): Boolean {\n        // \u4f7f\u7528CAS\u64cd\u4f5c\u5b89\u5168\u5730\u6dfb\u52a0\u4efb\u52a1\n    }\n\n    // \u5f39\u51fa\u4efb\u52a1\n    fun poll(): Task? {\n        // \u4f7f\u7528CAS\u64cd\u4f5c\u5b89\u5168\u5730\u83b7\u53d6\u4efb\u52a1\n    }\n\n    // \u5141\u8bb8\u5176\u4ed6Worker\u5077\u53d6\u4efb\u52a1\n    fun steal(): Task? {\n        // \u4ece\u961f\u5217\u5c3e\u90e8\u7a83\u53d6\u4efb\u52a1\n    }\n}\n</code></pre>"},{"location":"020Kotlin/020Coroutines/#_34","title":"\u4efb\u52a1\u8c03\u5ea6\u6d41\u7a0b","text":"<ol> <li>\u534f\u7a0b\u521b\u5efa\u4e0e\u8c03\u5ea6\uff1a\u5f53\u4f60\u4f7f\u7528<code>launch</code>\u6216<code>async</code>\u521b\u5efa\u534f\u7a0b\u65f6\uff0c\u534f\u7a0b\u4f1a\u88ab\u63d0\u4ea4\u5230\u76f8\u5e94\u7684\u8c03\u5ea6\u5668</li> </ol> <pre><code>launch(Dispatchers.Default) {\n    // \u534f\u7a0b\u4ee3\u7801\n}\n</code></pre> <ol> <li>\u4efb\u52a1\u63d0\u4ea4\uff1a\u8c03\u5ea6\u5668\u5c06\u534f\u7a0b\u5305\u88c5\u4e3a<code>Task</code>\uff0c\u7136\u540e\u63d0\u4ea4\u7ed9<code>CoroutineScheduler</code></li> </ol> <pre><code>override fun dispatch(context: CoroutineContext, block: Runnable) {\n    val task = createTask(block, context)\n    submitTask(task)\n}\n</code></pre> <ol> <li>\u4efb\u52a1\u6267\u884c\uff1a<code>CoroutineScheduler</code>\u5c06\u4efb\u52a1\u653e\u5165\u961f\u5217\uff0c\u5e76\u7531Worker\u7ebf\u7a0b\u6267\u884c</li> </ol> <pre><code>fun submitTask(task: Task) {\n    // \u5148\u5c1d\u8bd5\u63d0\u4ea4\u7ed9\u5f53\u524dWorker\u7684\u672c\u5730\u961f\u5217\n    val currentWorker = currentWorker()\n    if (currentWorker != null &amp;&amp; currentWorker.submitToLocalQueue(task, fair = true)) {\n        return\n    }\n\n    // \u5426\u5219\u63d0\u4ea4\u5230\u5168\u5c40\u961f\u5217\n    submitToGlobalQueue(task)\n\n    // \u786e\u4fdd\u6709\u8db3\u591f\u7684Worker\u6765\u5904\u7406\u4efb\u52a1\n    signalCpuWork()\n}\n</code></pre> <ol> <li>\u7ebf\u7a0b\u7ba1\u7406\uff1a<code>CoroutineScheduler</code>\u4f1a\u6839\u636e\u9700\u8981\u521b\u5efa\u65b0\u7684Worker\u6216\u590d\u7528\u7a7a\u95f2Worker</li> </ol> <pre><code>private fun createNewWorker(): Boolean {\n    synchronized(workers) {\n        // \u68c0\u67e5\u662f\u5426\u5df2\u8fbe\u5230\u7ebf\u7a0b\u6c60\u4e0a\u9650\n        if (createdWorkers &gt;= maxPoolSize) return false\n\n        // \u521b\u5efa\u65b0Worker\u5e76\u542f\u52a8\n        val newWorker = createWorkerUnlocked()\n        newWorker.start()\n        return true\n    }\n}\n</code></pre>"},{"location":"020Kotlin/020Coroutines/#java_1","title":"\u4e0eJava\u7ebf\u7a0b\u7cfb\u7edf\u7684\u534f\u4f5c","text":"<ol> <li> <p>Worker\u7ebf\u7a0b\u672c\u8d28\u4e0a\u662fJava Thread\uff1a<code>Worker</code>\u7ee7\u627f\u81eaJava\u7684<code>Thread</code>\uff0c\u8fd0\u884c\u5728JVM\u7684\u7ebf\u7a0b\u7cfb\u7edf\u4e2d</p> </li> <li> <p>\u963b\u585e\u64cd\u4f5c\u5904\u7406\uff1a\u5f53\u9047\u5230\u963b\u585e\u64cd\u4f5c\u65f6\uff0c\u534f\u7a0b\u8c03\u5ea6\u5668\u4f1a\u6807\u8bb0Worker\u4e3a<code>BLOCKING</code>\u72b6\u6001\uff0c\u5e76\u53ef\u80fd\u521b\u5efa\u65b0Worker\u4fdd\u6301CPU\u5229\u7528\u7387</p> </li> </ol> <pre><code>fun beforeTask(taskMode: Int) {\n    if (taskMode == TASK_PROBABLY_BLOCKING) {\n        // \u6807\u8bb0\u4e3a\u963b\u585e\u72b6\u6001\n        state = BLOCKING\n        // \u901a\u77e5\u8c03\u5ea6\u5668\u53ef\u80fd\u9700\u8981\u521b\u5efa\u65b0Worker\n        scheduler.signalCpuWork()\n    }\n}\n\nfun afterTask(taskMode: Int) {\n    if (taskMode == TASK_PROBABLY_BLOCKING) {\n        // \u6062\u590d\u72b6\u6001\n        state = CLAIMING\n    }\n}\n</code></pre> <ol> <li>\u4e0eJava Executor\u7684\u517c\u5bb9\uff1a<code>CoroutineScheduler</code>\u5b9e\u73b0\u4e86Java\u7684<code>Executor</code>\u63a5\u53e3\uff0c\u53ef\u4ee5\u4f5c\u4e3a\u6807\u51c6Java\u7ebf\u7a0b\u6c60\u4f7f\u7528</li> </ol> <pre><code>override fun execute(command: Runnable) {\n    val task = createTask(command)\n    submitTask(task)\n}\n</code></pre>"},{"location":"020Kotlin/020Coroutines/#_35","title":"\u7ebf\u7a0b\u6c60\u7ba1\u7406","text":"<ol> <li>\u52a8\u6001\u8c03\u6574\u7ebf\u7a0b\u6570\uff1a<code>CoroutineScheduler</code>\u4f1a\u6839\u636e\u5de5\u4f5c\u8d1f\u8f7d\u52a8\u6001\u8c03\u6574\u6d3b\u8dc3Worker\u6570\u91cf</li> </ol> <pre><code>private fun signalCpuWork() {\n    // \u68c0\u67e5\u662f\u5426\u9700\u8981\u66f4\u591aWorker\n    if (tryUnpark() || tryCreateWorker()) return\n\n    // \u5c1d\u8bd5\u5524\u9192PARKING\u72b6\u6001\u7684Worker\n    tryUnparkParking()\n}\n</code></pre> <ol> <li>\u7ebf\u7a0b\u72b6\u6001\u7ba1\u7406\uff1aWorker\u6709\u591a\u79cd\u72b6\u6001\uff08PARKING, BLOCKING, DORMANT\u7b49\uff09\uff0c\u8c03\u5ea6\u5668\u4f1a\u6839\u636e\u72b6\u6001\u8fdb\u884c\u7ba1\u7406</li> </ol> <pre><code>enum class WorkerState {\n    PARKING,      // \u7ebf\u7a0b\u5373\u5c06\u963b\u585e\u7b49\u5f85\u65b0\u4efb\u52a1\n    BLOCKING,     // \u7ebf\u7a0b\u6b63\u5728\u6267\u884c\u963b\u585e\u64cd\u4f5c\n    DORMANT,      // \u65b0\u521b\u5efa\u4f46\u672a\u542f\u52a8\u7684\u7ebf\u7a0b\n    TERMINATED,   // \u5df2\u7ec8\u6b62\u7684\u7ebf\u7a0b\n    CPU_ACQUIRED, // \u7ebf\u7a0b\u6b63\u5728\u6267\u884cCPU\u4efb\u52a1\n    CLAIMING      // \u7ebf\u7a0b\u6b63\u5728\u5bfb\u627e\u65b0\u4efb\u52a1\n}\n</code></pre>"},{"location":"020Kotlin/020Coroutines/#_36","title":"\u603b\u7ed3","text":"<p>Kotlin\u534f\u7a0b\u8c03\u5ea6\u7cfb\u7edf\u901a\u8fc7\u4ee5\u4e0b\u65b9\u5f0f\u534f\u8c03Java\u7ebf\u7a0b\u6267\u884c\u4efb\u52a1\uff1a</p> <ol> <li>\u4f7f\u7528\u81ea\u5b9a\u4e49\u7684<code>CoroutineScheduler</code>\u4f5c\u4e3a\u7ebf\u7a0b\u6c60\u5b9e\u73b0</li> <li>\u5c06\u534f\u7a0b\u4efb\u52a1\u5305\u88c5\u4e3a<code>Task</code>\u63d0\u4ea4\u7ed9\u8c03\u5ea6\u5668</li> <li>\u7531<code>Worker</code>\u7ebf\u7a0b\uff08\u7ee7\u627f\u81eaJava Thread\uff09\u6267\u884c\u5b9e\u9645\u4efb\u52a1</li> <li>\u901a\u8fc7\u672c\u5730\u4efb\u52a1\u961f\u5217\u548c\u5168\u5c40\u4efb\u52a1\u961f\u5217\u9ad8\u6548\u5206\u914d\u4efb\u52a1</li> <li>\u4f7f\u7528\u4efb\u52a1\u7a83\u53d6\u7b97\u6cd5\u63d0\u9ad8\u7ebf\u7a0b\u5229\u7528\u7387</li> <li>\u7279\u6b8a\u5904\u7406\u963b\u585e\u64cd\u4f5c\uff0c\u4fdd\u6301\u7cfb\u7edf\u54cd\u5e94\u6027</li> </ol> <p>\u8fd9\u79cd\u8bbe\u8ba1\u65e2\u5229\u7528\u4e86Java\u7ebf\u7a0b\u7cfb\u7edf\u7684\u80fd\u529b\uff0c\u53c8\u63d0\u4f9b\u4e86\u66f4\u9ad8\u7ea7\u7684\u534f\u7a0b\u62bd\u8c61\uff0c\u5b9e\u73b0\u4e86\u9ad8\u6548\u3001\u6613\u7528\u7684\u5f02\u6b65\u7f16\u7a0b\u6a21\u578b\u3002</p>"},{"location":"020Kotlin/020Coroutines/#workqueue_1","title":"WorkQueue\u548c\u534f\u7a0b\u7684\u7a7a\u95f2\u72b6\u6001\u5904\u7406","text":"<p>\u8ba9\u6211\u4eec\u901a\u8fc7\u6e90\u7801\u5206\u6790\u6765\u4e86\u89e3\u5f53WorkQueue\u4e2d\u6ca1\u6709\u4efb\u52a1\u65f6\uff0c\u534f\u7a0b\u8c03\u5ea6\u7cfb\u7edf\u4f1a\u5982\u4f55\u5904\u7406\u8fd9\u79cd\u60c5\u51b5\u3002</p>"},{"location":"020Kotlin/020Coroutines/#workqueue_2","title":"WorkQueue\u7684\u65e0\u9501\u7279\u6027","text":"<p>\u9996\u5148\u786e\u8ba4WorkQueue\u786e\u5b9e\u662f\u4e00\u4e2a\u65e0\u9501\u961f\u5217\u5b9e\u73b0\uff1a</p> <pre><code>internal class WorkQueue {\n    // \u4f7f\u7528\u539f\u5b50\u64cd\u4f5c\u8fdb\u884c\u5e76\u53d1\u63a7\u5236\n    private var producerIndex = 0\n    private var consumerIndex = 0\n    private var blockingTasksInBuffer = 0\n\n    // \u5e95\u5c42\u5b58\u50a8\u6570\u7ec4\n    private var array = arrayOfNulls&lt;Task&gt;(INITIAL_CAPACITY)\n\n    // \u961f\u5217\u64cd\u4f5c\u4f7f\u7528CAS\u800c\u975e\u9501\n    fun poll(): Task? {\n        while (true) {\n            val consumerIdx = consumerIndex\n            if (consumerIdx - producerIndex == 0) return null // \u961f\u5217\u4e3a\u7a7a\n            val task = array[consumerIdx and mask]\n            if (task === null) continue // \u6d88\u8d39\u8005\u8ffd\u4e0a\u4e86\u751f\u4ea7\u8005\n\n            // CAS\u64cd\u4f5c\u66f4\u65b0consumerIndex\n            if (CONSUMER_INDEX.compareAndSet(this, consumerIdx, consumerIdx + 1)) {\n                array[consumerIdx and mask] = null\n                return task\n            }\n        }\n    }\n    // ...\u5176\u4ed6\u65b9\u6cd5\u4e5f\u91c7\u7528\u7c7b\u4f3c\u7684\u65e0\u9501\u5b9e\u73b0\n}\n</code></pre>"},{"location":"020Kotlin/020Coroutines/#workqueue_3","title":"\u5f53WorkQueue\u4e3a\u7a7a\u65f6\u7684\u5904\u7406","text":"<p>\u5f53Worker\u7ebf\u7a0b\u53d1\u73b0\u6ca1\u6709\u4efb\u52a1\u53ef\u6267\u884c\u65f6\uff08\u5305\u62ec\u672c\u5730\u961f\u5217\u3001\u5168\u5c40\u961f\u5217\u548c\u4efb\u52a1\u7a83\u53d6\u90fd\u65e0\u6cd5\u83b7\u53d6\u4efb\u52a1\uff09\uff0c\u534f\u7a0b\u8c03\u5ea6\u7cfb\u7edf\u4f1a\u6309\u7167\u4ee5\u4e0b\u6d41\u7a0b\u5904\u7406\uff1a</p>"},{"location":"020Kotlin/020Coroutines/#1_2","title":"1. \u4efb\u52a1\u67e5\u627e\u6d41\u7a0b","text":"<p>\u5728<code>Worker.run()</code>\u65b9\u6cd5\u4e2d\uff0cWorker\u4f1a\u4e0d\u65ad\u5730\u5bfb\u627e\u5e76\u6267\u884c\u4efb\u52a1\uff1a</p> <pre><code>override fun run() {\n    var task = findTask()\n    while (!isTerminated &amp;&amp; task != null) {\n        runTask(task)\n        task = findTask()\n    }\n    // \u5f53\u9000\u51fa\u5faa\u73af\u65f6\uff0c\u8981\u4e48Worker\u88ab\u7ec8\u6b62\uff0c\u8981\u4e48\u6ca1\u6709\u627e\u5230\u4efb\u52a1\n}\n</code></pre> <p>\u5173\u952e\u662f<code>findTask()</code>\u65b9\u6cd5\u7684\u5b9e\u73b0\uff1a</p> <pre><code>private fun findTask(): Task? {\n    // 1. \u68c0\u67e5\u672c\u5730\u961f\u5217\n    val localQueue = localQueue\n    if (localQueue.poll().also { if (it != null) return it } == null) {\n        // 2. \u4ece\u5168\u5c40\u961f\u5217\u83b7\u53d6\u4efb\u52a1\n        if (tryAcquireGlobalCpuPermit()) {\n            val globalCpuQueue = scheduler.globalCpuQueue\n            val task = globalCpuQueue.poll()\n            if (task != null) return task\n\n            // \u5f52\u8fd8\u8bb8\u53ef\n            releaseCpuPermit()\n        }\n\n        // 3. \u5c1d\u8bd5\u4ece\u5176\u4ed6Worker\u5077\u53d6\u4efb\u52a1\n        if (trySteal().also { if (it != null) return it } == null) {\n            // 4. \u5c1d\u8bd5\u4ece\u963b\u585e\u961f\u5217\u83b7\u53d6\u4efb\u52a1\n            return pollGlobalBlockingQueue()\n        }\n    }\n    return null\n}\n</code></pre>"},{"location":"020Kotlin/020Coroutines/#2-park","title":"2. \u65e0\u4efb\u52a1\u65f6\u7684park\u5904\u7406","text":"<p>\u5f53<code>findTask()</code>\u8fd4\u56denull\u65f6\uff0cWorker\u4f1a\u8fdb\u5165park\u6d41\u7a0b\uff1a</p> <pre><code>private fun park() {\n    // 1. \u66f4\u65b0Worker\u72b6\u6001\u4e3aPARKING\n    state = WorkerState.PARKING\n\n    // 2. \u5c06Worker\u6dfb\u52a0\u5230parkingWorkers\u5217\u8868\n    scheduler.parkedWorkersStackPush(this)\n\n    // 3. \u8ba9\u51faCPU\uff0c\u8fdb\u5165\u4f11\u7720\u72b6\u6001\n    LockSupport.parkNanos(idleWorkerKeepAliveNs)\n\n    // 4. \u88ab\u5524\u9192\u540e\uff0c\u5c1d\u8bd5\u4eceparkingWorkers\u5217\u8868\u4e2d\u79fb\u9664\u81ea\u5df1\n    scheduler.parkedWorkersStackPop()\n\n    // 5. \u66f4\u65b0\u72b6\u6001\u4e3aCLAIMED\uff0c\u7ee7\u7eed\u5bfb\u627e\u4efb\u52a1\n    state = WorkerState.CLAIMING\n}\n</code></pre>"},{"location":"020Kotlin/020Coroutines/#3-worker","title":"3. \u8d85\u65f6\u5904\u7406\u4e0eWorker\u56de\u6536","text":"<p>\u5982\u679cWorker\u5728park\u72b6\u6001\u4e0b\u957f\u65f6\u95f4\u6ca1\u6709\u88ab\u5524\u9192\uff0c\u53ef\u80fd\u4f1a\u88ab\u56de\u6536\uff1a</p> <pre><code>// \u5de5\u4f5c\u7ebf\u7a0b\u88ab\u5524\u9192\u540e\u68c0\u67e5\u662f\u5426\u5e94\u8be5\u7ec8\u6b62\nprivate fun tryPark() {\n    // \u8ba1\u7b97\u5df2\u521b\u5efa\u7684\u5de5\u4f5c\u7ebf\u7a0b\u6570\u91cf\u4e0e\u6838\u5fc3\u6c60\u5927\u5c0f\u7684\u5dee\n    val created = createdWorkers\n    val excess = created - corePoolSize\n\n    // \u5982\u679c\u8d85\u51fa\u6838\u5fc3\u6c60\u5927\u5c0f\u4e14\u7a7a\u95f2\u65f6\u95f4\u8d85\u8fc7\u9608\u503c\uff0c\u53ef\u80fd\u4f1a\u7ec8\u6b62\u8be5Worker\n    if (excess &gt; 0 &amp;&amp; parkingWorkers.isEmpty() &amp;&amp; \n        currentTick - lastExcessWorkersCheckTick &gt;= EXCESS_WORKERS_CHECK_PERIOD) {\n        lastExcessWorkersCheckTick = currentTick\n\n        // \u5c1d\u8bd5\u51cf\u5c11\u5de5\u4f5c\u7ebf\u7a0b\u6570\u91cf\n        tryReleaseWorker(excess)\n    }\n}\n</code></pre>"},{"location":"020Kotlin/020Coroutines/#4_2","title":"4. \u534f\u7a0b\u8c03\u5ea6\u5668\u7684\u5524\u9192\u673a\u5236","text":"<p>\u5f53\u65b0\u4efb\u52a1\u88ab\u63d0\u4ea4\u65f6\uff0c\u8c03\u5ea6\u5668\u4f1a\u5524\u9192park\u72b6\u6001\u7684Worker\uff1a</p> <pre><code>internal fun submitToGlobalQueue(task: Task) {\n    // \u63d0\u4ea4\u4efb\u52a1\u5230\u5168\u5c40\u961f\u5217\n    if (task.taskContext.taskMode == TaskMode.PROBABLY_BLOCKING) {\n        globalBlockingQueue.addLast(task)\n    } else {\n        globalCpuQueue.addLast(task)\n    }\n\n    // \u6709\u4e86\u65b0\u4efb\u52a1\uff0c\u5524\u9192\u4e00\u4e2a\u5de5\u4f5c\u7ebf\u7a0b\n    tryUnpark()\n}\n\ninternal fun tryUnpark(): Boolean {\n    // \u5c1d\u8bd5\u5524\u9192\u4e00\u4e2aPARKING\u72b6\u6001\u7684Worker\n    val worker = parkedWorkersStackPop() ?: return false\n\n    // \u4f7f\u7528LockSupport\u5524\u9192\u7ebf\u7a0b\n    LockSupport.unpark(worker)\n    return true\n}\n</code></pre>"},{"location":"020Kotlin/020Coroutines/#_37","title":"\u534f\u7a0b\u6302\u8d77\u70b9\u4e0e\u7ebf\u7a0b\u590d\u7528","text":"<p>\u534f\u7a0b\u672c\u8eab\u7684\u6302\u8d77\u70b9\u662f\u7531<code>suspendCoroutine</code>\u6216<code>suspendCancellableCoroutine</code>\u51fd\u6570\u5b9e\u73b0\u7684\uff1a</p> <pre><code>suspend fun &lt;T&gt; suspendCoroutine(block: (Continuation&lt;T&gt;) -&gt; Unit): T {\n    // \u83b7\u53d6\u5f53\u524d\u534f\u7a0b\u7684Continuation\n    val continuation = kotlin.coroutines.intrinsics.suspendCoroutineUninterceptedOrReturn&lt;T&gt; { cont -&gt;\n        block(cont.intercepted())\n        COROUTINE_SUSPENDED\n    }\n    return continuation\n}\n</code></pre> <p>\u5f53\u534f\u7a0b\u6302\u8d77\u65f6\uff0c\u5e95\u5c42Worker\u7ebf\u7a0b\u4e0d\u4f1a\u88ab\u963b\u585e\uff0c\u800c\u662f\u7acb\u5373\u53bb\u6267\u884c\u5176\u4ed6\u4efb\u52a1\uff1a</p> <pre><code>// \u5728Continuation.resumeWith\u4e2d\npublic final override fun resumeWith(result: Result&lt;T&gt;) {\n    // ...\u5904\u7406\u7ed3\u679c\n\n    // \u5c06\u7ee7\u7eed\u6267\u884c\u7684\u534f\u7a0b\u5305\u88c5\u4e3a\u65b0\u7684Task\n    val task = DispatchedContinuation(this, result)\n\n    // \u63d0\u4ea4\u5230\u8c03\u5ea6\u5668\n    dispatcher.dispatch(context, task)\n}\n</code></pre>"},{"location":"020Kotlin/020Coroutines/#_38","title":"\u603b\u7ed3","text":"<p>\u901a\u8fc7\u6e90\u7801\u5206\u6790\uff0c\u5f53WorkQueue\u4e2d\u6ca1\u6709\u4efb\u52a1\u65f6\uff0c\u534f\u7a0b\u8c03\u5ea6\u7cfb\u7edf\u4f1a\uff1a</p> <ol> <li>Worker\u7ebf\u7a0b\u8fdb\u5165\u505c\u8f66\uff08park\uff09\u72b6\u6001\uff1a</li> <li>Worker\u5c1d\u8bd5\u4ece\u672c\u5730\u961f\u5217\u3001\u5168\u5c40\u961f\u5217\u548c\u5176\u4ed6Worker\u961f\u5217\u5bfb\u627e\u4efb\u52a1</li> <li>\u5982\u679c\u90fd\u6ca1\u6709\u627e\u5230\u4efb\u52a1\uff0c\u5219\u8c03\u7528<code>LockSupport.parkNanos()</code>\u4f7f\u7ebf\u7a0b\u4f11\u7720</li> <li> <p>Worker\u88ab\u6dfb\u52a0\u5230<code>parkingWorkers</code>\u5217\u8868\u4e2d</p> </li> <li> <p>\u7ebf\u7a0b\u8d44\u6e90\u7ba1\u7406\uff1a</p> </li> <li>\u8d85\u51fa\u6838\u5fc3\u6c60\u5927\u5c0f\u7684\u7a7a\u95f2Worker\u5728\u8d85\u65f6\u540e\u53ef\u80fd\u88ab\u56de\u6536</li> <li> <p>\u8fd9\u786e\u4fdd\u4e86\u7ebf\u7a0b\u8d44\u6e90\u4e0d\u4f1a\u88ab\u65e0\u9650\u5360\u7528</p> </li> <li> <p>\u5524\u9192\u673a\u5236\uff1a</p> </li> <li>\u5f53\u65b0\u4efb\u52a1\u63d0\u4ea4\u65f6\uff0c\u8c03\u5ea6\u5668\u4f1a\u5524\u9192\u4e00\u4e2a\u5904\u4e8epark\u72b6\u6001\u7684Worker</li> <li> <p>\u4f7f\u7528<code>LockSupport.unpark(worker)</code>\u5524\u9192\u7ebf\u7a0b</p> </li> <li> <p>\u534f\u7a0b\u6302\u8d77\u4e0e\u7ebf\u7a0b\u590d\u7528\uff1a</p> </li> <li>\u534f\u7a0b\u6302\u8d77\u65f6\u4e0d\u4f1a\u963b\u585e\u7ebf\u7a0b\uff0c\u7ebf\u7a0b\u4f1a\u7acb\u5373\u53bb\u6267\u884c\u5176\u4ed6\u53ef\u7528\u4efb\u52a1</li> <li>\u5f53\u6302\u8d77\u7684\u534f\u7a0b\u6062\u590d\u65f6\uff0c\u4f1a\u88ab\u5305\u88c5\u4e3a\u65b0\u4efb\u52a1\u91cd\u65b0\u63d0\u4ea4\u7ed9\u8c03\u5ea6\u5668</li> </ol> <p>\u8fd9\u79cd\u8bbe\u8ba1\u5b9e\u73b0\u4e86\u9ad8\u6548\u7684\u8d44\u6e90\u5229\u7528\uff1a\u65e0\u4efb\u52a1\u65f6\u7ebf\u7a0b\u4e0d\u4f1a\u7a7a\u8f6c\u6d88\u8017CPU\u8d44\u6e90\uff0c\u6709\u65b0\u4efb\u52a1\u65f6\u80fd\u5feb\u901f\u54cd\u5e94\uff0c\u540c\u65f6\u8fd8\u80fd\u6839\u636e\u7cfb\u7edf\u8d1f\u8f7d\u52a8\u6001\u8c03\u6574\u6d3b\u8dc3\u7ebf\u7a0b\u6570\u91cf\u3002</p>"},{"location":"020Kotlin/020Coroutines/#locksupport","title":"LockSupport\u7684\u4f11\u7720\u4e0e\u5524\u9192\u539f\u7406\u5206\u6790","text":"<p><code>LockSupport</code>\u662fJava\u5e76\u53d1\u5305\u4e2d\u7684\u4e00\u4e2a\u5e95\u5c42\u5de5\u5177\u7c7b\uff0c\u5b83\u4e3a\u7ebf\u7a0b\u7684\u963b\u585e\u548c\u5524\u9192\u63d0\u4f9b\u4e86\u57fa\u672c\u64cd\u4f5c\u3002\u8ba9\u6211\u4eec\u6df1\u5165\u5206\u6790<code>parkNanos()</code>\u548c<code>unpark()</code>\u7684\u5de5\u4f5c\u539f\u7406\u3002</p>"},{"location":"020Kotlin/020Coroutines/#locksupport_1","title":"LockSupport\u7684\u57fa\u672c\u539f\u7406","text":"<p><code>LockSupport</code>\u7c7b\u4f9d\u8d56\u4e8eJVM\u4e2d\u7684\u5e95\u5c42\u673a\u5236\uff0c\u4e3b\u8981\u662f\u57fa\u4e8eUnsafe\u7c7b\u4e2d\u7684\u672c\u5730\u65b9\u6cd5\u5b9e\u73b0\u3002</p> <pre><code>public class LockSupport {\n    // Hotspot implementation via intrinsics\n    private static final Unsafe U = Unsafe.getUnsafe();\n\n    private static final long PARKBLOCKER = U.objectFieldOffset(Thread.class, \"parkBlocker\");\n\n    private static final long SECONDARY = U.objectFieldOffset(Thread.class, \"threadLocalRandomSecondarySeed\");\n\n    private LockSupport() {} // Cannot be instantiated\n\n    // \u6838\u5fc3\u65b9\u6cd5\u5b9e\u73b0...\n}\n</code></pre>"},{"location":"020Kotlin/020Coroutines/#parknanos","title":"parkNanos()\u7684\u5b9e\u73b0\u539f\u7406","text":"<p><code>LockSupport.parkNanos(long nanos)</code>\u65b9\u6cd5\u5141\u8bb8\u7ebf\u7a0b\u6682\u505c\u6307\u5b9a\u7684\u7eb3\u79d2\u6570\uff1a</p> <pre><code>public static void parkNanos(long nanos) {\n    if (nanos &gt; 0)\n        U.park(false, nanos);  // \u8c03\u7528Unsafe\u7684native\u65b9\u6cd5\n}\n\n// \u5e26blocker\u5bf9\u8c61\u7684\u91cd\u8f7d\u7248\u672c\npublic static void parkNanos(Object blocker, long nanos) {\n    if (nanos &gt; 0) {\n        Thread t = Thread.currentThread();\n        setBlocker(t, blocker);  // \u8bbe\u7f6e\u7ebf\u7a0b\u7684parkBlocker\u5b57\u6bb5\n        U.park(false, nanos);    // \u8c03\u7528Unsafe\u7684park\u65b9\u6cd5\n        setBlocker(t, null);     // \u6e05\u9664parkBlocker\u5b57\u6bb5\n    }\n}\n</code></pre>"},{"location":"020Kotlin/020Coroutines/#unsafepark","title":"Unsafe.park\u7684\u5e95\u5c42\u5b9e\u73b0","text":"<p><code>Unsafe.park(boolean isAbsolute, long time)</code>\u662f\u4e00\u4e2a\u672c\u5730(native)\u65b9\u6cd5\uff0c\u5728HotSpot JVM\u4e2d\u7684\u5b9e\u73b0\u8c03\u7528\u4e86\u64cd\u4f5c\u7cfb\u7edf\u7684\u7ebf\u7a0b\u8c03\u5ea6\u51fd\u6570\uff1a</p> <ol> <li>Linux\u5e73\u53f0\uff1a\u5e95\u5c42\u4f1a\u8c03\u7528<code>pthread_cond_timedwait</code>\u51fd\u6570</li> <li>Windows\u5e73\u53f0\uff1a\u4f7f\u7528<code>WaitForSingleObject</code>\u51fd\u6570</li> <li>macOS\uff1a\u540c\u6837\u4f7f\u7528<code>pthread_cond_timedwait</code></li> </ol> <p>\u5728OpenJDK\u7684C++\u5b9e\u73b0\u4e2d\uff0c\u5927\u81f4\u5982\u4e0b\uff1a</p> <pre><code>// hotspot/src/share/vm/runtime/park.cpp\nvoid Parker::park(bool isAbsolute, jlong time) {\n    // \u68c0\u67e5permit\u72b6\u6001\uff0c\u5982\u679c\u5df2\u8bbe\u7f6e\uff0c\u5219\u6d88\u8d39permit\u5e76\u7acb\u5373\u8fd4\u56de\n    if (_counter &gt; 0) {\n        _counter = 0;\n        return;\n    }\n\n    // \u51c6\u5907\u7b49\u5f85\n    Thread* thread = Thread::current();\n    ThreadBlockInVM tbivm(thread);\n\n    // \u83b7\u53d6\u4e92\u65a5\u9501\n    pthread_mutex_lock(_mutex);\n\n    // \u518d\u6b21\u68c0\u67e5permit(\u9632\u6b62\u5728\u6211\u4eec\u83b7\u53d6\u9501\u671f\u95f4\u88ab\u8bbe\u7f6e)\n    if (_counter &gt; 0) {\n        _counter = 0;\n        pthread_mutex_unlock(_mutex);\n        return;\n    }\n\n    // \u8ba1\u7b97\u8d85\u65f6\u65f6\u95f4\n    struct timespec absTime;\n    if (time &gt; 0) {\n        compute_abstime(&amp;absTime, time, isAbsolute);\n    }\n\n    // \u8fdb\u5165\u6761\u4ef6\u7b49\u5f85\n    if (time &gt; 0) {\n        pthread_cond_timedwait(_cond, _mutex, &amp;absTime);\n    } else {\n        pthread_cond_wait(_cond, _mutex);\n    }\n\n    // \u5524\u9192\u540e\u6e05\u9664permit\n    _counter = 0;\n    pthread_mutex_unlock(_mutex);\n}\n</code></pre> <p>\u8fd9\u4e2a\u5b9e\u73b0\u4f7f\u7528\u4e86\u57fa\u4e8e\u6761\u4ef6\u53d8\u91cf(condition variable)\u7684\u7b49\u5f85\u673a\u5236\uff0c\u5173\u952e\u70b9\u662f\uff1a</p> <ol> <li>\u6bcf\u4e2a\u7ebf\u7a0b\u90fd\u6709\u4e00\u4e2a\u5173\u8054\u7684\"\u8bb8\u53ef\u8bc1\"(permit)</li> <li>\u8c03\u7528<code>park()</code>\u65f6\uff0c\u5982\u679cpermit\u5df2\u8bbe\u7f6e\u5219\u6d88\u8d39\u5e76\u7acb\u5373\u8fd4\u56de\uff1b\u5426\u5219\u7ebf\u7a0b\u5c06\u963b\u585e</li> <li>\u6709\u65f6\u9650\u7684\u7b49\u5f85\u4f1a\u5728\u6307\u5b9a\u65f6\u95f4\u540e\u81ea\u52a8\u9192\u6765</li> </ol>"},{"location":"020Kotlin/020Coroutines/#unpark","title":"unpark()\u7684\u5b9e\u73b0\u539f\u7406","text":"<p><code>LockSupport.unpark(Thread thread)</code>\u7528\u4e8e\u5524\u9192\u6307\u5b9a\u7684\u7ebf\u7a0b\uff1a</p> <pre><code>public static void unpark(Thread thread) {\n    if (thread != null)\n        U.unpark(thread);  // \u8c03\u7528Unsafe\u7684native\u65b9\u6cd5\n}\n</code></pre>"},{"location":"020Kotlin/020Coroutines/#unsafeunpark","title":"Unsafe.unpark\u7684\u5e95\u5c42\u5b9e\u73b0","text":"<p><code>Unsafe.unpark(Object thread)</code>\u5728JVM\u4e2d\u7684\u5b9e\u73b0\uff1a</p> <pre><code>// hotspot/src/share/vm/runtime/park.cpp\nvoid Parker::unpark() {\n    pthread_mutex_lock(_mutex);\n    _counter = 1;  // \u8bbe\u7f6epermit\n    pthread_cond_signal(_cond);  // \u5524\u9192\u7b49\u5f85\u7ebf\u7a0b\n    pthread_mutex_unlock(_mutex);\n}\n</code></pre> <p>\u5173\u952e\u70b9\u662f\uff1a</p> <ol> <li>\u8bbe\u7f6epermit\u6807\u5fd7\u4e3a1</li> <li>\u4f7f\u7528\u6761\u4ef6\u53d8\u91cf\u7684signal\u64cd\u4f5c\u5524\u9192\u53ef\u80fd\u5728\u7b49\u5f85\u7684\u7ebf\u7a0b</li> </ol>"},{"location":"020Kotlin/020Coroutines/#kotlin_4","title":"\u5728Kotlin\u534f\u7a0b\u4e2d\u7684\u5e94\u7528","text":"<p>\u5728Kotlin\u7684<code>CoroutineScheduler</code>\u4e2d\uff0c<code>LockSupport</code>\u7528\u4e8eWorker\u7ebf\u7a0b\u7684\u4f11\u7720\u4e0e\u5524\u9192\uff1a</p> <pre><code>// Worker\u7684park\u64cd\u4f5c\nprivate fun park() {\n    // \u66f4\u65b0\u72b6\u6001\n    state = WorkerState.PARKING\n\n    // \u52a0\u5165\u8c03\u5ea6\u5668\u7684\u505c\u8f66\u5217\u8868\n    scheduler.parkedWorkersStackPush(this)\n\n    // \u4f11\u7720\u6307\u5b9a\u65f6\u95f4 - \u8fd9\u91cc\u4f7f\u7528\u4e86LockSupport\n    LockSupport.parkNanos(idleWorkerKeepAliveNs)\n\n    // \u88ab\u5524\u9192\u540e\u7684\u5904\u7406...\n}\n\n// \u8c03\u5ea6\u5668\u7684unpark\u64cd\u4f5c\ninternal fun tryUnpark(): Boolean {\n    // \u83b7\u53d6\u4e00\u4e2a\u5df2\u505c\u8f66\u7684Worker\n    val worker = parkedWorkersStackPop() ?: return false\n\n    // \u5524\u9192Worker\u7ebf\u7a0b\n    LockSupport.unpark(worker)\n    return true\n}\n</code></pre>"},{"location":"020Kotlin/020Coroutines/#locksupport_2","title":"LockSupport\u4e0e\u4f20\u7edf\u7ebf\u7a0b\u540c\u6b65\u673a\u5236\u7684\u6bd4\u8f83","text":"<p>\u76f8\u6bd4\u4e8e<code>Object.wait()</code>\u548c<code>Object.notify()</code>\uff0c<code>LockSupport</code>\u6709\u51e0\u4e2a\u91cd\u8981\u4f18\u52bf\uff1a</p> <ol> <li>\u65e0\u9501\u8981\u6c42\uff1a<code>park</code>\u548c<code>unpark</code>\u4e0d\u9700\u8981\u5148\u83b7\u53d6\u5bf9\u8c61\u7684\u76d1\u89c6\u5668\u9501</li> <li>\u987a\u5e8f\u72ec\u7acb\uff1a\u53ef\u4ee5\u5148\u8c03\u7528<code>unpark</code>\u518d\u8c03\u7528<code>park</code>\uff0c\u4e0d\u4f1a\u5bfc\u81f4\u6b7b\u9501</li> <li>\u7cbe\u786e\u63a7\u5236\uff1a\u53ef\u4ee5\u6307\u5b9a\u5524\u9192\u7279\u5b9a\u7ebf\u7a0b\uff0c\u800c\u4e0d\u662f\u901a\u77e5\u6240\u6709\u7b49\u5f85\u7684\u7ebf\u7a0b</li> <li>\u4e2d\u65ad\u53cb\u597d\uff1a<code>park</code>\u65b9\u6cd5\u4f1a\u54cd\u5e94\u7ebf\u7a0b\u4e2d\u65ad\uff0c\u4f46\u4e0d\u4f1a\u629b\u51faInterruptedException</li> </ol>"},{"location":"020Kotlin/020Coroutines/#_39","title":"\u6027\u80fd\u4e0e\u5b9e\u73b0\u7279\u70b9","text":"<ol> <li>\u8f7b\u91cf\u7ea7\uff1a\u76f8\u6bd4\u4e8e\u91cd\u91cf\u7ea7\u9501\uff0c<code>LockSupport</code>\u64cd\u4f5c\u66f4\u4e3a\u8f7b\u91cf</li> <li>\u81ea\u9002\u5e94\u81ea\u65cb\uff1a\u5728\u67d0\u4e9bJVM\u5b9e\u73b0\u4e2d\uff0c<code>park</code>\u53ef\u80fd\u9996\u5148\u5c1d\u8bd5\u81ea\u65cb\u4e00\u6bb5\u65f6\u95f4\u518d\u771f\u6b63\u963b\u585e\u7ebf\u7a0b</li> <li>\u7cfb\u7edf\u8c03\u7528\uff1a\u6700\u7ec8\u4f1a\u8c03\u7528\u64cd\u4f5c\u7cfb\u7edf\u7684\u7ebf\u7a0b\u8c03\u5ea6\u539f\u8bed\uff0c\u5982<code>futex</code>\u64cd\u4f5c(Linux)</li> <li>\u865a\u5047\u5524\u9192\uff1a<code>park</code>\u65b9\u6cd5\u4e5f\u53ef\u80fd\u53d1\u751f\"\u4f2a\u5524\u9192\"(spurious wakeup)\uff0c\u9700\u8981\u8c03\u7528\u8005\u5904\u7406</li> </ol>"},{"location":"020Kotlin/020Coroutines/#_40","title":"\u603b\u7ed3","text":"<p><code>LockSupport.parkNanos()</code>\u548c<code>unpark()</code>\u5728\u534f\u7a0b\u8c03\u5ea6\u5668\u4e2d\u53d1\u6325\u7740\u6838\u5fc3\u4f5c\u7528\uff1a</p> <ol> <li><code>parkNanos()</code>\u4f7f\u7a7a\u95f2Worker\u7ebf\u7a0b\u6682\u65f6\u4f11\u7720\uff0c\u6709\u6548\u51cf\u5c11CPU\u8d44\u6e90\u6d88\u8017</li> <li>\u5e95\u5c42\u901a\u8fc7\u64cd\u4f5c\u7cfb\u7edf\u7684\u6761\u4ef6\u53d8\u91cf\u5b9e\u73b0\u7ebf\u7a0b\u963b\u585e</li> <li> <p>\u6307\u5b9a\u8d85\u65f6\u65f6\u95f4\u540e\u81ea\u52a8\u5524\u9192\uff0c\u786e\u4fdd\u7ebf\u7a0b\u4e0d\u4f1a\u6c38\u4e45\u963b\u585e</p> </li> <li> <p><code>unpark()</code>\u5728\u6709\u65b0\u4efb\u52a1\u65f6\u7cbe\u786e\u5524\u9192\u7279\u5b9a\u7684Worker\u7ebf\u7a0b</p> </li> <li>\u8bbe\u7f6e\u7ebf\u7a0b\u7684permit\u6807\u5fd7\u5e76\u53d1\u9001\u4fe1\u53f7</li> <li>\u88ab\u5524\u9192\u7684\u7ebf\u7a0b\u53ef\u4ee5\u7acb\u5373\u5904\u7406\u65b0\u5230\u8fbe\u7684\u4efb\u52a1</li> </ol> <p>\u8fd9\u79cd\u673a\u5236\u786e\u4fdd\u4e86\u534f\u7a0b\u8c03\u5ea6\u7cfb\u7edf\u5728\u6ca1\u6709\u4efb\u52a1\u65f6\u80fd\u591f\u8282\u7701\u8d44\u6e90\uff0c\u540c\u65f6\u5728\u6709\u4efb\u52a1\u5230\u8fbe\u65f6\u80fd\u591f\u8fc5\u901f\u54cd\u5e94\uff0c\u5bf9\u6574\u4e2a\u534f\u7a0b\u6846\u67b6\u7684\u9ad8\u6548\u8fd0\u884c\u81f3\u5173\u91cd\u8981\u3002</p> <p>\u60a8\u63d0\u51fa\u4e86\u4e00\u4e2a\u975e\u5e38\u597d\u7684\u95ee\u9898\u3002\u867d\u7136Java\u7684BlockingQueue\u548cKotlin\u534f\u7a0b\u7684WorkQueue\u5728\u6ca1\u6709\u4efb\u52a1\u65f6\u90fd\u4f1a\u5bfc\u81f4\u7ebf\u7a0b\u4f11\u7720\uff0c\u4f46\u5b83\u4eec\u5728\u8bbe\u8ba1\u7406\u5ff5\u548c\u5b9e\u73b0\u7ec6\u8282\u4e0a\u6709\u663e\u8457\u5dee\u5f02\uff0c\u8fd9\u4e9b\u5dee\u5f02\u4e5f\u5e26\u6765\u4e86\u4e0d\u540c\u7684\u4f18\u52bf\u3002</p>"},{"location":"020Kotlin/020Coroutines/#workqueueblockingqueue","title":"WorkQueue\u4e0eBlockingQueue\u7684\u4e3b\u8981\u533a\u522b","text":""},{"location":"020Kotlin/020Coroutines/#1-vs","title":"1. \u65e0\u9501\u8bbe\u8ba1 vs. \u9501\u540c\u6b65","text":"<p>WorkQueue: - \u91c7\u7528\u65e0\u9501\uff08lock-free\uff09\u8bbe\u8ba1\uff0c\u4f7f\u7528\u539f\u5b50\u64cd\u4f5c\uff08CAS - Compare-And-Swap\uff09\u5b9e\u73b0\u5e76\u53d1\u63a7\u5236 - \u4e0d\u9700\u8981\u83b7\u53d6\u548c\u91ca\u653e\u9501\u7684\u5f00\u9500 - \u6e90\u7801\u793a\u4f8b\uff1a <pre><code>fun poll(): Task? {\n    while (true) {\n        val consumerIdx = consumerIndex\n        if (consumerIdx - producerIndex == 0) return null // \u7a7a\u961f\u5217\u68c0\u67e5\n        val task = array[consumerIdx and mask]\n        // CAS\u64cd\u4f5c\u66f4\u65b0\u7d22\u5f15\n        if (CONSUMER_INDEX.compareAndSet(this, consumerIdx, consumerIdx + 1)) {\n            array[consumerIdx and mask] = null\n            return task\n        }\n    }\n}\n</code></pre></p> <p>BlockingQueue: - \u5927\u591a\u6570\u5b9e\u73b0\u4f7f\u7528\u663e\u5f0f\u9501\uff08explicit locks\uff09\u6216\u5185\u90e8\u540c\u6b65\u673a\u5236 - \u4f8b\u5982ArrayBlockingQueue\u4f7f\u7528ReentrantLock\u6765\u4fdd\u62a4\u961f\u5217\u64cd\u4f5c - \u6e90\u7801\u793a\u4f8b\uff1a <pre><code>public E take() throws InterruptedException {\n    final ReentrantLock lock = this.lock;\n    lock.lockInterruptibly();\n    try {\n        while (count == 0)\n            notEmpty.await();  // \u6761\u4ef6\u53d8\u91cf\u7b49\u5f85\n        return dequeue();\n    } finally {\n        lock.unlock();\n    }\n}\n</code></pre></p>"},{"location":"020Kotlin/020Coroutines/#2-work-stealing","title":"2. \u4efb\u52a1\u76d7\u53d6\uff08work-stealing\uff09\u673a\u5236","text":"<p>WorkQueue: - \u5185\u7f6e\u4efb\u52a1\u76d7\u53d6\u673a\u5236\uff0c\u5141\u8bb8\u7a7a\u95f2Worker\u4ece\u5176\u4ed6Worker\u961f\u5217\"\u5077\u53d6\"\u4efb\u52a1 - \u66f4\u597d\u7684\u8d1f\u8f7d\u5e73\u8861\u80fd\u529b <pre><code>private fun trySteal(): Task? {\n    // \u968f\u673a\u9009\u62e9\u4e00\u4e2aWorker\u5c1d\u8bd5\u5077\u53d6\u4efb\u52a1\n    val victim = findRandomVictim() ?: return null\n    return victim.localQueue.steal()\n}\n</code></pre></p> <p>BlockingQueue: - \u901a\u5e38\u4e0d\u652f\u6301\u4efb\u52a1\u76d7\u53d6\uff08\u9664\u975e\u81ea\u884c\u5b9e\u73b0\uff09 - \u6bcf\u4e2a\u6d88\u8d39\u8005\u53ea\u4ece\u81ea\u5df1\u8d1f\u8d23\u7684\u961f\u5217\u83b7\u53d6\u4efb\u52a1</p>"},{"location":"020Kotlin/020Coroutines/#3_2","title":"3. \u5904\u7406\u65b9\u5f0f\u5dee\u5f02","text":"<p>WorkQueue: - \u961f\u5217\u4e3a\u7a7a\u65f6\u4e0d\u76f4\u63a5\u963b\u585e\uff0c\u800c\u662f\u901a\u8fc7\u5916\u90e8\u7684Worker.park()\u673a\u5236\u5904\u7406 - \u5206\u79bb\u4e86\"\u6ca1\u6709\u4efb\u52a1\"\u7684\u68c0\u6d4b\u548c\"\u7ebf\u7a0b\u4f11\u7720\"\u7684\u903b\u8f91 <pre><code>// WorkQueue\u672c\u8eab\u53ea\u8fd4\u56denull\u8868\u793a\u6ca1\u6709\u4efb\u52a1\nfun poll(): Task? {\n    // \u68c0\u67e5\u961f\u5217\u662f\u5426\u4e3a\u7a7a\n    if (consumerIndex - producerIndex == 0) return null\n    // ...\u83b7\u53d6\u4efb\u52a1\u7684\u903b\u8f91\n}\n\n// Worker\u8d1f\u8d23\u5904\u7406\u6ca1\u6709\u4efb\u52a1\u7684\u60c5\u51b5\nprivate fun park() {\n    state = WorkerState.PARKING\n    scheduler.parkedWorkersStackPush(this)\n    LockSupport.parkNanos(idleWorkerKeepAliveNs)\n    // ...\u88ab\u5524\u9192\u540e\u7684\u5904\u7406\n}\n</code></pre></p> <p>BlockingQueue: - \u76f4\u63a5\u5728\u961f\u5217\u64cd\u4f5c\u4e2d\u96c6\u6210\u4e86\u963b\u585e\u673a\u5236 - \u628a\"\u6ca1\u6709\u4efb\u52a1\"\u548c\"\u7ebf\u7a0b\u4f11\u7720\"\u7d27\u5bc6\u8026\u5408 <pre><code>public E take() throws InterruptedException {\n    // \u5728\u961f\u5217\u65b9\u6cd5\u5185\u90e8\u76f4\u63a5\u5904\u7406\u7b49\u5f85\u903b\u8f91\n    while (count == 0)\n        notEmpty.await();\n    // ...\u83b7\u53d6\u5143\u7d20\u7684\u903b\u8f91\n}\n</code></pre></p>"},{"location":"020Kotlin/020Coroutines/#4_3","title":"4. \u6027\u80fd\u7279\u6027","text":"<p>WorkQueue: - \u5728\u9ad8\u7ade\u4e89\u60c5\u51b5\u4e0b\u901a\u5e38\u6709\u66f4\u597d\u7684\u6027\u80fd\u8868\u73b0 - \u65e0\u9501\u8bbe\u8ba1\u51cf\u5c11\u4e86\u7ebf\u7a0b\u4e0a\u4e0b\u6587\u5207\u6362 - \u4efb\u52a1\u76d7\u53d6\u5b9e\u73b0\u66f4\u5747\u8861\u7684\u8d1f\u8f7d\u5206\u5e03</p> <p>BlockingQueue: - \u5728\u4f4e\u7ade\u4e89\u60c5\u51b5\u4e0b\u5b9e\u73b0\u7b80\u5355\uff0c\u529f\u80fd\u53ef\u9760 - \u9501\u673a\u5236\u5728\u9ad8\u7ade\u4e89\u4e0b\u53ef\u80fd\u5bfc\u81f4\u6027\u80fd\u74f6\u9888</p>"},{"location":"020Kotlin/020Coroutines/#5","title":"5. \u7ebf\u7a0b\u7ba1\u7406\u7b56\u7565","text":"<p>WorkQueue + CoroutineScheduler: - \u66f4\u7ec6\u7c92\u5ea6\u7684\u7ebf\u7a0b\u7ba1\u7406\u7b56\u7565 - \u53ef\u4ee5\u6839\u636e\u4efb\u52a1\u7c7b\u578b\uff08CPU\u5bc6\u96c6\u578b/IO\u963b\u585e\u578b\uff09\u533a\u5206\u5904\u7406 - \u52a8\u6001\u8c03\u6574\u6d3b\u8dc3\u7ebf\u7a0b\u6570\u91cf\uff0c\u66f4\u7075\u6d3b\u7684\u7ebf\u7a0b\u6c60\u5927\u5c0f\u7ba1\u7406</p> <p>BlockingQueue + ThreadPoolExecutor: - \u76f8\u5bf9\u7b80\u5355\u7684\u7ebf\u7a0b\u7ba1\u7406\u7b56\u7565 - \u7ebf\u7a0b\u6c60\u5927\u5c0f\u8c03\u6574\u8f83\u4e3a\u673a\u68b0\u5316</p>"},{"location":"020Kotlin/020Coroutines/#_41","title":"\u4f7f\u7528\u573a\u666f\u4e0a\u7684\u4f18\u52bf\u5bf9\u6bd4","text":"<ol> <li>\u9ad8\u5e76\u53d1\u3001\u4f4e\u5ef6\u8fdf\u7cfb\u7edf\uff1a</li> <li> <p>WorkQueue\u7684\u65e0\u9501\u8bbe\u8ba1\u548c\u4efb\u52a1\u76d7\u53d6\u673a\u5236\u66f4\u9002\u5408\u5904\u7406\u5927\u91cf\u77ed\u4efb\u52a1\u7684\u573a\u666f</p> </li> <li> <p>\u534f\u7a0b\u8c03\u5ea6\uff1a</p> </li> <li>WorkQueue\u4e13\u4e3a\u534f\u7a0b\u8c03\u5ea6\u8bbe\u8ba1\uff0c\u66f4\u597d\u5730\u652f\u6301\u534f\u7a0b\u6302\u8d77\u548c\u6062\u590d\u7684\u7279\u6b8a\u9700\u6c42</li> <li> <p>\u80fd\u66f4\u6709\u6548\u5730\u5728\u5c11\u91cf\u7ebf\u7a0b\u4e0a\u8c03\u5ea6\u5927\u91cf\u534f\u7a0b</p> </li> <li> <p>\u8d44\u6e90\u654f\u611f\u7cfb\u7edf\uff1a</p> </li> <li>WorkQueue\u4e0eCoroutineScheduler\u7ed3\u5408\u7684\u7ec6\u7c92\u5ea6\u7ebf\u7a0b\u7ba1\u7406\uff0c\u53ef\u4ee5\u66f4\u6709\u6548\u5730\u5229\u7528\u8ba1\u7b97\u8d44\u6e90</li> </ol>"},{"location":"020Kotlin/020Coroutines/#_42","title":"\u603b\u7ed3","text":"<p>\u867d\u7136WorkQueue\u548cBlockingQueue\u5728\u6ca1\u6709\u4efb\u52a1\u65f6\u90fd\u4f1a\u5bfc\u81f4\u7ebf\u7a0b\u4f11\u7720\uff0c\u4f46WorkQueue\u7684\u4f18\u52bf\u5728\u4e8e\uff1a</p> <ol> <li>\u65e0\u9501\u5b9e\u73b0\uff1a\u51cf\u5c11\u540c\u6b65\u5f00\u9500\uff0c\u63d0\u9ad8\u5e76\u53d1\u6027\u80fd</li> <li>\u4efb\u52a1\u76d7\u53d6\uff1a\u66f4\u597d\u7684\u8d1f\u8f7d\u5747\u8861\u80fd\u529b</li> <li>\u677e\u8026\u5408\u8bbe\u8ba1\uff1a\u5c06\u961f\u5217\u64cd\u4f5c\u4e0e\u7ebf\u7a0b\u4f11\u7720\u903b\u8f91\u5206\u79bb</li> <li>\u4e13\u4e3a\u534f\u7a0b\u4f18\u5316\uff1a\u66f4\u9002\u5408\u534f\u7a0b\u7684\u8f7b\u91cf\u7ea7\u3001\u5927\u89c4\u6a21\u5e76\u53d1\u6a21\u578b</li> </ol> <p>\u8fd9\u4e9b\u8bbe\u8ba1\u4f7f\u5f97\u534f\u7a0b\u8c03\u5ea6\u7cfb\u7edf\u80fd\u5728\u9ad8\u8d1f\u8f7d\u60c5\u51b5\u4e0b\u4fdd\u6301\u9ad8\u6548\u8fd0\u884c\uff0c\u540c\u65f6\u5728\u4f4e\u8d1f\u8f7d\u65f6\u6709\u6548\u8282\u7701\u8d44\u6e90\uff0c\u4e3aKotlin\u534f\u7a0b\u63d0\u4f9b\u4e86\u4e00\u4e2a\u65e2\u9ad8\u6548\u53c8\u7075\u6d3b\u7684\u6267\u884c\u73af\u5883\u3002</p>"},{"location":"020Kotlin/020Coroutines/#dispatchersmainimmediate-dispatchersmain","title":"Dispatchers.Main.immediate \u548c Dispatchers.Main\u6709\u4ec0\u4e48\u533a\u522b\uff0c\u539f\u7406\u662f\u4ec0\u4e48\uff1f","text":"\u7b54\u6848"},{"location":"020Kotlin/020Coroutines/#androiddispatchersmainimmediate","title":"Android\u534f\u7a0bDispatchers.Main.immediate\u539f\u7406\u5206\u6790","text":"<p><code>Dispatchers.Main.immediate</code>\u662fKotlin\u534f\u7a0b\u4e2d\u4e00\u4e2a\u7279\u6b8a\u7684\u8c03\u5ea6\u5668\uff0c\u5b83\u5141\u8bb8\u5728\u5f53\u524d\u5df2\u7ecf\u662f\u4e3b\u7ebf\u7a0b\u7684\u60c5\u51b5\u4e0b\u7acb\u5373\u6267\u884c\u534f\u7a0b\uff0c\u800c\u4e0d\u9700\u8981\u6392\u961f\u7b49\u5f85\u3002\u4e0b\u9762\u6211\u4ece\u6e90\u4ee3\u7801\u89d2\u5ea6\u5206\u6790\u5176\u5b9e\u73b0\u539f\u7406\u3002</p>"},{"location":"020Kotlin/020Coroutines/#_43","title":"\u57fa\u672c\u6982\u5ff5","text":"<p><code>Dispatchers.Main</code>\u662fAndroid\u4e0a\u7528\u4e8e\u4e3b\u7ebf\u7a0b\u8c03\u5ea6\u7684\u534f\u7a0b\u5206\u53d1\u5668\uff0c\u800c<code>.immediate</code>\u662f\u5176\u4e00\u4e2a\u6269\u5c55\u5c5e\u6027\uff0c\u63d0\u4f9b\u4e86\"\u7acb\u5373\u6267\u884c\"\u7684\u80fd\u529b\u3002</p>"},{"location":"020Kotlin/020Coroutines/#_44","title":"\u6e90\u4ee3\u7801\u5206\u6790","text":""},{"location":"020Kotlin/020Coroutines/#1-dispatchersmainimmediate","title":"1. Dispatchers.Main.immediate\u7684\u5b9a\u4e49","text":"<p>\u5728<code>MainCoroutineDispatcher.kt</code>\u4e2d\uff1a</p> <pre><code>public val MainCoroutineDispatcher.immediate: MainCoroutineDispatcher\n    get() = (this as? MainDispatcherLoader)?.immediate ?: this\n</code></pre> <p>\u5bf9\u4e8eAndroid\u5e73\u53f0\uff0c\u5b9e\u9645\u7684\u5b9e\u73b0\u662f\u5728<code>HandlerDispatcher.kt</code>\u4e2d\u7684<code>HandlerContext</code>\u7c7b\uff1a</p> <pre><code>override val immediate: HandlerContext = this[immediateKey] ?:\n    HandlerContext(handler, name + \".immediate\", true).also { this[immediateKey] = it }\n</code></pre>"},{"location":"020Kotlin/020Coroutines/#2-handlercontext","title":"2. \u5173\u952e\u5b9e\u73b0 - HandlerContext","text":"<p><code>HandlerContext</code>\u662f<code>Dispatchers.Main</code>\u5728Android\u4e0a\u7684\u5177\u4f53\u5b9e\u73b0\uff0c\u5b83\u5305\u88c5\u4e86\u4e00\u4e2a<code>Handler</code>\uff1a</p> <pre><code>internal class HandlerContext private constructor(\n    private val handler: Handler,\n    private val name: String?,\n    private val invokeImmediately: Boolean\n) : HandlerDispatcher(), Delay {\n    // ...\n\n    override fun dispatch(context: CoroutineContext, block: Runnable) {\n        if (invokeImmediately) {\n            // \u68c0\u67e5\u662f\u5426\u5df2\u7ecf\u5728\u6b63\u786e\u7684\u7ebf\u7a0b\n            val windowToken = try {\n                handler.looper.thread\n            } catch (e: UnsupportedOperationException) {\n                null\n            }\n            if (windowToken === Thread.currentThread()) {\n                // \u5982\u679c\u5df2\u7ecf\u5728\u4e3b\u7ebf\u7a0b\uff0c\u7acb\u5373\u6267\u884c\n                block.run()\n                return\n            }\n        }\n        // \u5426\u5219\u901a\u8fc7handler.post\n        handler.post(block)\n    }\n\n    // ...\n}\n</code></pre>"},{"location":"020Kotlin/020Coroutines/#3_3","title":"3. \u5173\u952e\u533a\u522b","text":"<p><code>Dispatchers.Main</code>\u548c<code>Dispatchers.Main.immediate</code>\u7684\u4e3b\u8981\u533a\u522b\u5728\u4e8e\uff1a</p> <ol> <li>\u666e\u901aMain\u8c03\u5ea6\u5668\uff1a</li> <li>\u603b\u662f\u901a\u8fc7<code>handler.post()</code>\u5c06\u4efb\u52a1\u653e\u5165\u4e3b\u7ebf\u7a0b\u6d88\u606f\u961f\u5217</li> <li> <p>\u5373\u4f7f\u5f53\u524d\u5df2\u7ecf\u5728\u4e3b\u7ebf\u7a0b\uff0c\u4e5f\u4f1a\u6392\u961f\u6267\u884c</p> </li> <li> <p>Main.immediate\u8c03\u5ea6\u5668\uff1a</p> </li> <li>\u9996\u5148\u68c0\u67e5\u5f53\u524d\u662f\u5426\u5df2\u7ecf\u5728\u4e3b\u7ebf\u7a0b</li> <li>\u5982\u679c\u662f\uff0c\u7acb\u5373\u6267\u884c\u4efb\u52a1</li> <li>\u5982\u679c\u4e0d\u662f\uff0c\u4ecd\u7136\u901a\u8fc7<code>handler.post()</code>\u6392\u961f</li> </ol>"},{"location":"020Kotlin/020Coroutines/#4_4","title":"4. \u6027\u80fd\u4f18\u52bf","text":"<p><code>immediate</code>\u6a21\u5f0f\u7684\u6027\u80fd\u4f18\u52bf\u5728\u4e8e\u907f\u514d\u4e86\u4e0d\u5fc5\u8981\u7684\u7ebf\u7a0b\u5207\u6362\u548c\u4efb\u52a1\u6392\u961f\uff1a</p> <ul> <li>\u907f\u514d\u4e86<code>post()</code>\u64cd\u4f5c\u7684\u5f00\u9500</li> <li>\u51cf\u5c11\u4e86\u4efb\u52a1\u5ef6\u8fdf\uff08\u4e0d\u9700\u8981\u7b49\u5f85\u6d88\u606f\u961f\u5217\u5904\u7406\uff09</li> <li>\u4fdd\u6301\u4e86\u66f4\u597d\u7684\u6267\u884c\u987a\u5e8f\uff08\u7acb\u5373\u6267\u884c\u53ef\u4ee5\u4fdd\u6301\u4ee3\u7801\u7684\u987a\u5e8f\u6027\uff09</li> </ul>"},{"location":"020Kotlin/020Coroutines/#_45","title":"\u4f7f\u7528\u573a\u666f","text":"<pre><code>// \u573a\u666f1\uff1a\u5982\u679c\u5df2\u7ecf\u5728\u4e3b\u7ebf\u7a0b\uff0c\u4f1a\u7acb\u5373\u6267\u884c\nlaunch(Dispatchers.Main.immediate) {\n    // \u8fd9\u6bb5\u4ee3\u7801\u4f1a\u7acb\u5373\u6267\u884c\uff08\u5982\u679c\u5df2\u7ecf\u5728\u4e3b\u7ebf\u7a0b\uff09\n}\n\n// \u573a\u666f2\uff1a\u5982\u679c\u4e0d\u5728\u4e3b\u7ebf\u7a0b\uff0c\u4f1apost\u5230\u4e3b\u7ebf\u7a0b\nlaunch(Dispatchers.Main.immediate) {\n    // \u8fd9\u6bb5\u4ee3\u7801\u4f1a\u901a\u8fc7handler.post\u6267\u884c\n}\n</code></pre>"},{"location":"020Kotlin/020Coroutines/#_46","title":"\u6ce8\u610f\u4e8b\u9879","text":"<ol> <li><code>immediate</code>\u53ea\u5e94\u5728\u660e\u786e\u77e5\u9053\u53ef\u80fd\u9700\u8981\u7acb\u5373\u6267\u884c\u7684\u573a\u666f\u4f7f\u7528</li> <li>\u8fc7\u5ea6\u4f7f\u7528\u53ef\u80fd\u5bfc\u81f4\u4e3b\u7ebf\u7a0b\u8fc7\u8f7d</li> <li>\u67d0\u4e9b\u5d4c\u5957\u8c03\u5ea6\u573a\u666f\u4e0b\u9700\u8981\u6ce8\u610f\u6267\u884c\u987a\u5e8f</li> </ol>"},{"location":"020Kotlin/020Coroutines/#_47","title":"\u603b\u7ed3","text":"<p><code>Dispatchers.Main.immediate</code>\u901a\u8fc7\u68c0\u67e5\u5f53\u524d\u7ebf\u7a0b\u5e76\u5728\u53ef\u80fd\u65f6\u7acb\u5373\u6267\u884c\u4efb\u52a1\uff0c\u4f18\u5316\u4e86\u4e3b\u7ebf\u7a0b\u8c03\u5ea6\u7684\u6027\u80fd\u3002\u5176\u6838\u5fc3\u5b9e\u73b0\u662f\u901a\u8fc7<code>HandlerContext</code>\u7c7b\u4e2d\u7684\u7ebf\u7a0b\u68c0\u67e5\u903b\u8f91\uff0c\u907f\u514d\u4e86\u4e0d\u5fc5\u8981\u7684\u4efb\u52a1\u6392\u961f\u3002</p> <p>isDispatchNeeded\u4f55\u65f6\u4f1a\u88ab\u8c03\u7528\uff1f</p> <p><code>isDispatchNeeded</code> \u65b9\u6cd5\u662f\u534f\u7a0b\u8c03\u5ea6\u6d41\u7a0b\u4e2d\u7684\u5173\u952e\u5224\u65ad\u70b9\uff0c\u5b83\u4f1a\u5728\u534f\u7a0b\u6846\u67b6\u7684 \u4efb\u52a1\u8c03\u5ea6\u6d41\u7a0b \u4e2d\u88ab\u8c03\u7528\u3002\u5177\u4f53\u8c03\u7528\u4f4d\u7f6e\u548c\u6d41\u7a0b\u5982\u4e0b\uff1a</p>"},{"location":"020Kotlin/020Coroutines/#1-coroutinedispatcher","title":"1. \u8c03\u7528\u5165\u53e3\uff1a<code>CoroutineDispatcher</code> \u7684\u8c03\u5ea6\u6d41\u7a0b","text":"<p>\u5728\u534f\u7a0b\u6846\u67b6\u4e2d\uff0c\u5f53\u9700\u8981\u8c03\u5ea6\u4e00\u4e2a\u4efb\u52a1\u65f6\uff0c\u4f1a\u901a\u8fc7\u4ee5\u4e0b\u8c03\u7528\u94fe\u89e6\u53d1\uff1a <pre><code>CoroutineDispatcher.dispatch() \n-&gt; DispatchedContinuation.resumeWith() \n-&gt; DispatchedTask.run() \n-&gt; \u5728\u51b3\u5b9a\u6267\u884c\u65b9\u5f0f\u524d\u8c03\u7528 isDispatchNeeded\n</code></pre></p> <p>\u5173\u952e\u6e90\u7801\u8def\u5f84\uff08\u7b80\u5316\u7248\uff09\uff1a <pre><code>// kotlinx.coroutines.internal.DispatchedContinuation.kt\noverride fun resumeWith(result: Result&lt;T&gt;) {\n    // ...\n    if (dispatcher.isDispatchNeeded(context)) { // \u8fd9\u91cc\u8c03\u7528\u5224\u65ad\n        dispatcher.dispatch(context, this)\n    } else {\n        runImmediately() // \u76f4\u63a5\u6267\u884c\n    }\n}\n</code></pre></p>"},{"location":"020Kotlin/020Coroutines/#2_2","title":"2. \u4f55\u65f6\u89e6\u53d1\u8c03\u7528\uff1f","text":"<p><code>isDispatchNeeded</code> \u4f1a\u5728\u4ee5\u4e0b\u573a\u666f\u88ab\u8c03\u7528\uff1a 1. \u534f\u7a0b\u6062\u590d\u65f6\uff08\u5982 <code>launch</code>\u3001<code>async</code> \u6216 <code>withContext</code> \u5207\u6362\u8c03\u5ea6\u5668\uff09 <pre><code>withContext(Dispatchers.Main.immediate) { ... } // \u5207\u6362\u65f6\u4f1a\u68c0\u67e5\n</code></pre> 2. \u6302\u8d77\u51fd\u6570\u8fd4\u56de\u540e\uff08\u5982 <code>delay</code> \u7ed3\u675f\u3001\u7f51\u7edc\u8bf7\u6c42\u5b8c\u6210\u7b49\uff09 3. \u5d4c\u5957\u534f\u7a0b\u5207\u6362\u7ebf\u7a0b\u65f6</p>"},{"location":"020Kotlin/020Coroutines/#3_4","title":"3. \u5224\u65ad\u903b\u8f91\u7684\u5b9e\u9645\u6548\u679c","text":"<p>\u4ee5 <code>Dispatchers.Main.immediate</code> \u4e3a\u4f8b\uff1a - \u5f53\u524d\u7ebf\u7a0b\u662f\u4e3b\u7ebf\u7a0b\uff1a <pre><code>isDispatchNeeded = false // \u76f4\u63a5\u6267\u884c\u4efb\u52a1\uff0c\u4e0d\u7ecf\u8fc7 handler.post\n</code></pre> - \u5f53\u524d\u7ebf\u7a0b\u975e\u4e3b\u7ebf\u7a0b\uff1a <pre><code>isDispatchNeeded = true  // \u901a\u8fc7 handler.post \u8c03\u5ea6\u5230\u4e3b\u7ebf\u7a0b\n</code></pre></p>"},{"location":"020Kotlin/020Coroutines/#4_5","title":"4. \u8c03\u8bd5\u9a8c\u8bc1\u65b9\u6cd5","text":"<p>\u4f60\u53ef\u4ee5\u5728\u4ee3\u7801\u4e2d\u901a\u8fc7\u8c03\u8bd5\u89c2\u5bdf\u8c03\u7528\u6808\uff1a 1. \u5728 <code>isDispatchNeeded</code> \u65b9\u6cd5\u5185\u8bbe\u7f6e\u65ad\u70b9 2. \u8fd0\u884c\u4ee5\u4e0b\u6d4b\u8bd5\u4ee3\u7801\uff1a <pre><code>// \u573a\u666f1\uff1a\u4e3b\u7ebf\u7a0b\u8c03\u7528\nrunBlocking(Dispatchers.Main.immediate) {\n    println(\"\u76f4\u63a5\u6267\u884c\")\n}\n\n// \u573a\u666f2\uff1a\u5b50\u7ebf\u7a0b\u8c03\u7528\nthread {\n    runBlocking(Dispatchers.Main.immediate) {\n        println(\"\u901a\u8fc7 post \u8c03\u5ea6\")\n    }\n}\n</code></pre> 3. \u89c2\u5bdf\u65ad\u70b9\u89e6\u53d1\u65f6\u7684\u8c03\u7528\u6808\uff0c\u4f1a\u770b\u5230\u7c7b\u4f3c\u8def\u5f84\uff1a <pre><code>DispatchedContinuation.resumeWith()\n-&gt; isDispatchNeeded()\n</code></pre></p>"},{"location":"020Kotlin/020Coroutines/#5_1","title":"5. \u4e0e\u5176\u4ed6\u8c03\u5ea6\u5668\u7684\u5bf9\u6bd4","text":"<ul> <li>\u9ed8\u8ba4\u8c03\u5ea6\u5668\uff08\u5982 <code>Dispatchers.IO</code>\uff09\uff1a <code>isDispatchNeeded</code> \u901a\u5e38\u76f4\u63a5\u8fd4\u56de <code>true</code>\uff0c\u5f3a\u5236\u5207\u6362\u7ebf\u7a0b\u3002</li> <li><code>Dispatchers.Unconfined</code>\uff1a \u76f4\u63a5\u8fd4\u56de <code>false</code>\uff0c\u8868\u793a\u4e0d\u7ea6\u675f\u7ebf\u7a0b\uff0c\u7acb\u5373\u6267\u884c\u3002</li> </ul>"},{"location":"020Kotlin/020Coroutines/#_48","title":"\u603b\u7ed3","text":"<p><code>isDispatchNeeded</code> \u662f\u534f\u7a0b\u8c03\u5ea6\u5668\u7684 \"\u4ea4\u901a\u8b66\u5bdf\"\uff0c\u5b83\u7684\u8c03\u7528\u65f6\u673a\u7531\u534f\u7a0b\u6846\u67b6\u5185\u90e8\u63a7\u5236\uff0c\u5728\u4efb\u52a1\u6267\u884c\u524d\u52a8\u6001\u51b3\u5b9a\u662f\u5426\u9700\u8981\u7ebf\u7a0b\u5207\u6362\u3002\u5bf9\u4e8e <code>Main.immediate</code>\uff0c\u8fd9\u79cd\u8bbe\u8ba1\u907f\u514d\u4e86\u4e3b\u7ebf\u7a0b\u7684\u5197\u4f59\u8c03\u5ea6\uff0c\u662f Android \u534f\u7a0b\u6027\u80fd\u4f18\u5316\u7684\u5173\u952e\u7ec6\u8282\u3002</p>"},{"location":"020Kotlin/020Coroutines/#dispatchers-","title":"\u534f\u7a0bDispatchers - \u534f\u7a0b\u8c03\u5ea6\u5668\uff0c\u662f\u5982\u4f55\u51b3\u5b9a\u534f\u7a0b\u5728\u54ea\u4e2a\u7ebf\u7a0b\u4e0a\u6267\u884c\u7684\uff1f","text":"\u7b54\u6848 <p>CoroutineDispatcher <pre><code>public abstract class CoroutineDispatcher : AbstractCoroutineContextElement(ContinuationInterceptor), ContinuationInterceptor {\n    public abstract fun dispatch(context: CoroutineContext, block: Runnable)\n\n    public open fun isDispatchNeeded(context: CoroutineContext): Boolean = true\n\n    public open fun dispatchYield(context: CoroutineContext, block: Runnable): Unit = dispatch(context, block)\n}\n</code></pre></p> <p>Main\u8c03\u5ea6\u5668\u7684\u5b9e\u73b0\u4f9d\u8d56\u4e8e\u5e73\u53f0\uff0c\u4f8b\u5982\u5728Android\u4e0a\uff1a <pre><code>internal class HandlerContext(\n    private val handler: Handler,\n    private val name: String?\n) : CoroutineDispatcher() {\n    override fun dispatch(context: CoroutineContext, block: Runnable) {\n        // \u5c06\u4efb\u52a1\u4ea4\u7ed9Handler\u5904\u7406\uff0c\u786e\u4fdd\u5728\u4e3b\u7ebf\u7a0b\u6267\u884c\n        handler.post(block)\n    }\n}\n</code></pre></p> <p>\u6700\u7b80\u5355\u6765\u8bf4\uff0c\u4e5f\u5c31\u662f\u901a\u8fc7\u4f20\u5165\u7684context\u76f4\u63a5\u8c03\u7528dispatch block\uff0c\u8bf7\u95ee\u6211\u8fd9\u6837\u7406\u89e3\u5bf9\u5417?</p> <p>\u662f\u7684\uff0c\u60a8\u7684\u7406\u89e3\u662f\u6b63\u786e\u7684\uff0c\u4ece\u6700\u7b80\u5355\u7684\u89d2\u5ea6\u6765\u8bf4\uff0c\u534f\u7a0b\u8c03\u5ea6\u5668(Dispatchers)\u51b3\u5b9a\u534f\u7a0b\u5728\u54ea\u4e2a\u7ebf\u7a0b\u4e0a\u6267\u884c\u5c31\u662f\u901a\u8fc7\u4f20\u5165\u7684CoroutineContext\u76f4\u63a5\u8c03\u7528dispatch\u65b9\u6cd5\u6765\u5206\u53d1\u6267\u884c\u5757(block)\u3002</p> <p>\u8fd9\u4e2a\u8fc7\u7a0b\u53ef\u4ee5\u7b80\u5316\u4e3a\uff1a</p> <ol> <li> <p>\u521b\u5efa\u534f\u7a0b\u65f6\uff0c\u5c06\u8c03\u5ea6\u5668\u4f5c\u4e3aCoroutineContext\u7684\u4e00\u90e8\u5206\u4f20\u5165\uff1a <pre><code>launch(Dispatchers.Default) {\n    // \u534f\u7a0b\u4ee3\u7801\n}\n</code></pre></p> </li> <li> <p>\u534f\u7a0b\u542f\u52a8\u6216\u4ece\u6302\u8d77\u70b9\u6062\u590d\u65f6\uff0c\u6846\u67b6\u4f1a\u8c03\u7528\u8c03\u5ea6\u5668\u7684dispatch\u65b9\u6cd5\uff1a <pre><code>dispatcher.dispatch(context, block)\n</code></pre></p> </li> <li> <p>\u8c03\u5ea6\u5668\u7684dispatch\u65b9\u6cd5\u51b3\u5b9a\u5c06\u8fd9\u4e2a\u6267\u884c\u5757(block)\u63d0\u4ea4\u5230\u54ea\u4e2a\u7ebf\u7a0b\u6267\u884c\uff1a</p> </li> <li>Dispatchers.Default\u53ef\u80fd\u5c06\u5b83\u63d0\u4ea4\u5230\u9ed8\u8ba4\u7ebf\u7a0b\u6c60</li> <li>Dispatchers.IO\u53ef\u80fd\u5c06\u5b83\u63d0\u4ea4\u5230IO\u7ebf\u7a0b\u6c60</li> <li>Dispatchers.Main\u5c06\u5b83\u63d0\u4ea4\u5230\u4e3b\u7ebf\u7a0b</li> </ol> <p>\u8fd9\u79cd\u7b80\u5355\u800c\u5f3a\u5927\u7684\u8bbe\u8ba1\u8ba9\u534f\u7a0b\u80fd\u591f\u8f7b\u677e\u5730\u5728\u4e0d\u540c\u7ebf\u7a0b\u95f4\u5207\u6362\uff0c\u800c\u5f00\u53d1\u8005\u53ea\u9700\u6307\u5b9a\u9002\u5f53\u7684\u8c03\u5ea6\u5668\uff0c\u65e0\u9700\u624b\u52a8\u5904\u7406\u590d\u6742\u7684\u7ebf\u7a0b\u7ba1\u7406\u903b\u8f91\u3002</p> \u8be6\u7ec6\u7b54\u6848"},{"location":"020Kotlin/020Coroutines/#kotlindispatchers","title":"Kotlin\u534f\u7a0b\u8c03\u5ea6\u5668(Dispatchers)\u7684\u7ebf\u7a0b\u51b3\u7b56\u673a\u5236","text":"<p>Kotlin\u534f\u7a0b\u7684\u8c03\u5ea6\u5668(Dispatchers)\u662f\u51b3\u5b9a\u534f\u7a0b\u5728\u54ea\u4e2a\u7ebf\u7a0b\u4e0a\u6267\u884c\u7684\u5173\u952e\u7ec4\u4ef6\u3002\u6211\u5c06\u4ece\u6e90\u7801\u5c42\u9762\u5206\u6790\u8c03\u5ea6\u5668\u5982\u4f55\u505a\u51fa\u8fd9\u4e00\u51b3\u7b56\u3002</p>"},{"location":"020Kotlin/020Coroutines/#_49","title":"\u8c03\u5ea6\u5668\u7684\u57fa\u672c\u67b6\u6784","text":"<p>Kotlin\u534f\u7a0b\u6846\u67b6\u63d0\u4f9b\u4e86\u51e0\u79cd\u5185\u7f6e\u7684\u8c03\u5ea6\u5668\uff1a</p> <ol> <li><code>Dispatchers.Default</code> - \u9002\u7528\u4e8eCPU\u5bc6\u96c6\u578b\u4efb\u52a1</li> <li><code>Dispatchers.IO</code> - \u9002\u7528\u4e8eIO\u5bc6\u96c6\u578b\u4efb\u52a1  </li> <li><code>Dispatchers.Main</code> - \u7528\u4e8eUI\u7ebf\u7a0b\u64cd\u4f5c</li> <li><code>Dispatchers.Unconfined</code> - \u7279\u6b8a\u8c03\u5ea6\u5668\uff0c\u4e0d\u5207\u6362\u7ebf\u7a0b</li> </ol> <p>\u8fd9\u4e9b\u8c03\u5ea6\u5668\u90fd\u5b9e\u73b0\u4e86<code>CoroutineDispatcher</code>\u62bd\u8c61\u7c7b\uff1a</p> <pre><code>public abstract class CoroutineDispatcher : AbstractCoroutineContextElement(ContinuationInterceptor), ContinuationInterceptor {\n    public abstract fun dispatch(context: CoroutineContext, block: Runnable)\n\n    public open fun isDispatchNeeded(context: CoroutineContext): Boolean = true\n\n    public open fun dispatchYield(context: CoroutineContext, block: Runnable): Unit = dispatch(context, block)\n}\n</code></pre>"},{"location":"020Kotlin/020Coroutines/#_50","title":"\u7ebf\u7a0b\u51b3\u7b56\u7684\u6838\u5fc3\u6d41\u7a0b","text":"<p>\u8c03\u5ea6\u5668\u51b3\u5b9a\u534f\u7a0b\u5728\u54ea\u4e2a\u7ebf\u7a0b\u4e0a\u6267\u884c\u7684\u8fc7\u7a0b\u4e3b\u8981\u6d89\u53ca\u4ee5\u4e0b\u6b65\u9aa4\uff1a</p>"},{"location":"020Kotlin/020Coroutines/#1_3","title":"1. \u534f\u7a0b\u521b\u5efa\u4e0e\u521d\u59cb\u8c03\u5ea6","text":"<p>\u5f53\u521b\u5efa\u534f\u7a0b\u65f6\uff0c\u8c03\u5ea6\u5668\u4f1a\u88ab\u4f5c\u4e3a\u4e0a\u4e0b\u6587\u5143\u7d20\u4f20\u5165\uff1a</p> <pre><code>launch(Dispatchers.Default) {\n    // \u534f\u7a0b\u4ee3\u7801\n}\n</code></pre> <p>\u5728\u534f\u7a0b\u542f\u52a8\u65f6\uff0c\u8c03\u5ea6\u5668\u901a\u8fc7<code>dispatch</code>\u65b9\u6cd5\u51b3\u5b9a\u5982\u4f55\u8c03\u5ea6\u534f\u7a0b\uff1a</p> <pre><code>// \u5728AbstractCoroutine.start\u65b9\u6cd5\u4e2d\nval start = startCoroutineCancellable(...)\n// \u901a\u8fc7\u8c03\u5ea6\u5668dispatch\u6267\u884c\ndispatcher.dispatch(context, start)\n</code></pre>"},{"location":"020Kotlin/020Coroutines/#2-dispatch","title":"2. dispatch\u65b9\u6cd5\u7684\u5b9e\u73b0","text":"<p>\u4ee5<code>DefaultScheduler</code>\uff08\u5373<code>Dispatchers.Default</code>\u7684\u5b9e\u73b0\uff09\u4e3a\u4f8b\uff1a</p> <pre><code>// ExperimentalCoroutineDispatcher\u7c7b\uff08DefaultScheduler\u7684\u7236\u7c7b\uff09\noverride fun dispatch(context: CoroutineContext, block: Runnable) {\n    // \u83b7\u53d6\u5f53\u524d\u6267\u884c\u7ebf\u7a0b\u7684Worker\uff08\u5982\u679c\u6709\uff09\n    val currentWorker = currentWorker()\n\n    // \u5982\u679c\u5df2\u7ecf\u5728CoroutineScheduler\u7684Worker\u7ebf\u7a0b\u4e2d\uff0c\u5c1d\u8bd5\u5c06\u4efb\u52a1\u63d0\u4ea4\u5230\u672c\u5730\u961f\u5217\n    if (currentWorker != null &amp;&amp; currentWorker.scheduler === coroutineScheduler) {\n        currentWorker.submitToLocalQueue(block, fair = true)\n        return\n    }\n\n    // \u5426\u5219\uff0c\u63d0\u4ea4\u5230\u5168\u5c40\u961f\u5217\n    coroutineScheduler.submitToGlobalQueue(block)\n}\n</code></pre> <p>\u8fd9\u91cc\u6709\u4e24\u4e2a\u5173\u952e\u51b3\u7b56\u70b9\uff1a 1. \u5982\u679c\u5f53\u524d\u7ebf\u7a0b\u5df2\u7ecf\u662f\u8c03\u5ea6\u5668\u7684\u5de5\u4f5c\u7ebf\u7a0b\uff0c\u4f18\u5148\u590d\u7528\u5f53\u524d\u7ebf\u7a0b 2. \u5426\u5219\u5c06\u4efb\u52a1\u63d0\u4ea4\u5230\u5168\u5c40\u961f\u5217\uff0c\u7531\u4efb\u610f\u53ef\u7528Worker\u6267\u884c</p>"},{"location":"020Kotlin/020Coroutines/#3_5","title":"3. \u534f\u7a0b\u6062\u590d\u65f6\u7684\u7ebf\u7a0b\u51b3\u7b56","text":"<p>\u5f53\u534f\u7a0b\u4ece\u6302\u8d77\u70b9\u6062\u590d\u65f6\uff0c\u540c\u6837\u4f1a\u4f7f\u7528\u8c03\u5ea6\u5668\u51b3\u5b9a\u5728\u54ea\u4e2a\u7ebf\u7a0b\u4e0a\u7ee7\u7eed\u6267\u884c\uff1a</p> <pre><code>// DispatchedContinuation.resumeWith\noverride fun resumeWith(result: Result&lt;T&gt;) {\n    // ...\u5904\u7406\u7ed3\u679c\n\n    // \u68c0\u67e5\u662f\u5426\u9700\u8981\u8c03\u5ea6\n    if (dispatcher.isDispatchNeeded(context)) {\n        // \u9700\u8981\u8c03\u5ea6\uff0c\u63d0\u4ea4\u5230\u8c03\u5ea6\u5668\n        dispatcher.dispatch(context, this)\n    } else {\n        // \u4e0d\u9700\u8981\u8c03\u5ea6\uff0c\u76f4\u63a5\u5728\u5f53\u524d\u7ebf\u7a0b\u6267\u884c\n        executeUnconfined(...)\n    }\n}\n</code></pre> <p>\u5173\u952e\u662f<code>isDispatchNeeded</code>\u65b9\u6cd5\uff0c\u4e0d\u540c\u8c03\u5ea6\u5668\u6709\u4e0d\u540c\u5b9e\u73b0\uff1a</p> <pre><code>// \u6807\u51c6\u8c03\u5ea6\u5668\uff08Default/IO\uff09\u603b\u662f\u8fd4\u56detrue\uff0c\u8868\u793a\u9700\u8981\u8c03\u5ea6\noverride fun isDispatchNeeded(context: CoroutineContext): Boolean = true\n\n// Unconfined\u8c03\u5ea6\u5668\u5219\u53ef\u80fd\u8fd4\u56defalse\uff0c\u4e0d\u8fdb\u884c\u8c03\u5ea6\n// Dispatchers.Unconfined\u7684\u5b9e\u73b0\noverride fun isDispatchNeeded(context: CoroutineContext): Boolean = false\n</code></pre>"},{"location":"020Kotlin/020Coroutines/#4_6","title":"4. \u5177\u4f53\u8c03\u5ea6\u5668\u7684\u7ebf\u7a0b\u9009\u62e9\u7b56\u7565","text":""},{"location":"020Kotlin/020Coroutines/#dispatchersdefault","title":"Dispatchers.Default","text":"<p>DefaultScheduler\u7531<code>CoroutineScheduler</code>\u5b9e\u73b0\uff0c\u6838\u5fc3\u7ebf\u7a0b\u6c60\u5927\u5c0f\u4e3aCPU\u6838\u5fc3\u6570\uff08\u6700\u5c0f2\u4e2a\uff09\uff0c\u6700\u5927\u4e3aCPU\u6838\u5fc3\u6570*128\uff1a</p> <pre><code>internal object DefaultScheduler : ExperimentalCoroutineDispatcher() {\n    // \u521d\u59cb\u5316\u65f6\u8bbe\u7f6e\u7ebf\u7a0b\u6c60\u53c2\u6570\n    init {\n        // CPU\u6838\u5fc3\u6570\uff0c\u6700\u5c0f2\n        val cores = systemProp(\n            COROUTINES_SCHEDULER_CORE_POOL_SIZE_PROPERTY_NAME,\n            AVAILABLE_PROCESSORS.coerceAtLeast(2)\n        )\n        // \u6700\u5927\u7ebf\u7a0b\u6570\uff0c\u9ed8\u8ba4\u662f\u6838\u5fc3\u6570\u7684128\u500d\n        val maxPoolSize = systemProp(\n            COROUTINES_SCHEDULER_MAX_POOL_SIZE_PROPERTY_NAME,\n            maxOf(cores, 64, AVAILABLE_PROCESSORS * 128)\n        )\n\n        // \u521b\u5efa\u8c03\u5ea6\u5668\n        coroutineScheduler = createScheduler(cores, maxPoolSize)\n    }\n}\n</code></pre> <p>\u5b83\u4e3b\u8981\u7528\u4e8eCPU\u5bc6\u96c6\u578b\u4efb\u52a1\uff0c\u7ebf\u7a0b\u4e3b\u8981\u6267\u884c\u8ba1\u7b97\u5de5\u4f5c\u3002</p>"},{"location":"020Kotlin/020Coroutines/#dispatchersio","title":"Dispatchers.IO","text":"<p>IO\u8c03\u5ea6\u5668\u662fDefaultScheduler\u7684\u4e00\u4e2a\u7279\u5316\u7248\u672c\uff0c\u901a\u8fc7<code>LimitingDispatcher</code>\u9650\u5236\u5e76\u53d1\u5ea6\uff1a</p> <pre><code>internal object DefaultScheduler : ExperimentalCoroutineDispatcher() {\n    val IO: CoroutineDispatcher = LimitingDispatcher(\n        this,\n        systemProp(IO_PARALLELISM_PROPERTY_NAME, 64.coerceAtLeast(AVAILABLE_PROCESSORS)),\n        \"Dispatchers.IO\",\n        TASK_PROBABLY_BLOCKING\n    )\n}\n</code></pre> <p>LimitingDispatcher\u4f1a\u9650\u5236\u5e76\u53d1\u6267\u884c\u7684\u4efb\u52a1\u6570\u91cf\uff0c\u4f46\u4e0d\u9650\u5236\u7ebf\u7a0b\u6570\u3002\u5b83\u6807\u8bb0\u4efb\u52a1\u4e3a\"\u53ef\u80fd\u963b\u585e\"\uff0c\u8fd9\u4f1a\u5f71\u54cdWorker\u7684\u884c\u4e3a\uff1a</p> <pre><code>override fun dispatch(context: CoroutineContext, block: Runnable) {\n    // \u5c1d\u8bd5\u83b7\u53d6\u8bb8\u53ef\u8bc1\n    var taskToSchedule = block\n    if (!acquirePermit()) {\n        // \u5982\u679c\u6ca1\u6709\u53ef\u7528\u8bb8\u53ef\u8bc1\uff0c\u5219\u5305\u88c5\u4efb\u52a1\n        taskToSchedule = SemaphoreAcquireTask(this, block)\n    }\n\n    // \u5c06\u4efb\u52a1\u59d4\u6258\u7ed9\u57fa\u7840\u8c03\u5ea6\u5668\uff0c\u4f46\u6807\u8bb0\u4e3a\u53ef\u80fd\u963b\u585e\n    dispatcher.dispatchWithContext(context, taskToSchedule, TASK_PROBABLY_BLOCKING)\n}\n</code></pre> <p>\u5f53Worker\u6267\u884c\u6807\u8bb0\u4e3a\"\u53ef\u80fd\u963b\u585e\"\u7684\u4efb\u52a1\u65f6\uff1a</p> <pre><code>fun beforeTask(taskMode: Int) {\n    if (taskMode == TASK_PROBABLY_BLOCKING) {\n        // \u6807\u8bb0Worker\u4e3a\u963b\u585e\u72b6\u6001\n        state = BLOCKING\n        // \u901a\u77e5\u8c03\u5ea6\u5668\u53ef\u80fd\u9700\u8981\u521b\u5efa\u65b0Worker\n        scheduler.signalCpuWork()\n    }\n}\n</code></pre> <p>\u8fd9\u786e\u4fddIO\u64cd\u4f5c\u4e0d\u4f1a\u963b\u585e\u5176\u4ed6\u8ba1\u7b97\u4efb\u52a1\u7684\u6267\u884c\u3002</p>"},{"location":"020Kotlin/020Coroutines/#dispatchersmain","title":"Dispatchers.Main","text":"<p>Main\u8c03\u5ea6\u5668\u7684\u5b9e\u73b0\u4f9d\u8d56\u4e8e\u5e73\u53f0\uff0c\u4f8b\u5982\u5728Android\u4e0a\uff1a</p> <pre><code>internal class HandlerContext(\n    private val handler: Handler,\n    private val name: String?\n) : CoroutineDispatcher() {\n    override fun dispatch(context: CoroutineContext, block: Runnable) {\n        // \u5c06\u4efb\u52a1\u4ea4\u7ed9Handler\u5904\u7406\uff0c\u786e\u4fdd\u5728\u4e3b\u7ebf\u7a0b\u6267\u884c\n        handler.post(block)\n    }\n}\n</code></pre> <p>\u5b83\u786e\u4fdd\u534f\u7a0b\u5728\u4e3b/UI\u7ebf\u7a0b\u4e0a\u6267\u884c\u3002</p>"},{"location":"020Kotlin/020Coroutines/#_51","title":"\u5177\u4f53\u573a\u666f\u4e0b\u7684\u7ebf\u7a0b\u51b3\u7b56","text":""},{"location":"020Kotlin/020Coroutines/#1_4","title":"1. \u534f\u7a0b\u521d\u6b21\u542f\u52a8","text":"<pre><code>launch(Dispatchers.Default) {\n    println(\"Running on thread: ${Thread.currentThread().name}\")\n}\n</code></pre> <p>\u6267\u884c\u6d41\u7a0b\uff1a 1. <code>launch</code>\u51fd\u6570\u521b\u5efa\u534f\u7a0b\u5e76\u83b7\u53d6\u4e0a\u4e0b\u6587\u4e2d\u7684\u8c03\u5ea6\u5668 2. \u8c03\u5ea6\u5668\u7684<code>dispatch</code>\u65b9\u6cd5\u88ab\u8c03\u7528 3. \u4efb\u52a1\u88ab\u63d0\u4ea4\u5230<code>CoroutineScheduler</code> 4. \u8c03\u5ea6\u5668\u4eceWorker\u6c60\u4e2d\u9009\u62e9\u4e00\u4e2aWorker\u6267\u884c\u4efb\u52a1</p>"},{"location":"020Kotlin/020Coroutines/#2_3","title":"2. \u534f\u7a0b\u6302\u8d77\u70b9\u6062\u590d","text":"<pre><code>launch(Dispatchers.Default) {\n    println(\"Before: ${Thread.currentThread().name}\")\n    delay(1000) // \u6302\u8d77\u70b9\n    println(\"After: ${Thread.currentThread().name}\")\n}\n</code></pre> <p>\u6267\u884c\u6d41\u7a0b\uff1a 1. \u534f\u7a0b\u5728\u67d0\u4e2aWorker\u7ebf\u7a0b\u5f00\u59cb\u6267\u884c 2. \u9047\u5230<code>delay</code>\u51fd\u6570\u6302\u8d77 3. \u6302\u8d77\u540e\uff0c\u7ecf\u8fc71000ms\u540e\uff0c\u5ef6\u8fdf\u4efb\u52a1\u5c06\u534f\u7a0b\u7684continuation\u63d0\u4ea4\u56de\u8c03\u5ea6\u5668 4. \u8c03\u5ea6\u5668\u9009\u62e9\u4e00\u4e2a\u53ef\u7528\u7684Worker\u7ebf\u7a0b\u6062\u590d\u534f\u7a0b\u6267\u884c 5. \u6ce8\u610f\uff1a\u6302\u8d77\u524d\u540e\u53ef\u80fd\u662f\u4e0d\u540c\u7684Worker\u7ebf\u7a0b</p>"},{"location":"020Kotlin/020Coroutines/#3-withcontext","title":"3. withContext\u5207\u6362\u4e0a\u4e0b\u6587","text":"<pre><code>launch(Dispatchers.Default) {\n    println(\"Default: ${Thread.currentThread().name}\")\n\n    withContext(Dispatchers.IO) {\n        println(\"IO: ${Thread.currentThread().name}\")\n    }\n\n    println(\"Back to Default: ${Thread.currentThread().name}\")\n}\n</code></pre> <p>\u6267\u884c\u6d41\u7a0b\uff1a 1. \u534f\u7a0b\u5728Default\u8c03\u5ea6\u5668\u7684Worker\u7ebf\u7a0b\u5f00\u59cb\u6267\u884c 2. \u9047\u5230<code>withContext</code>\u65f6\uff0c\u521b\u5efa\u65b0\u7684\u534f\u7a0b\u4e0a\u4e0b\u6587\uff0c\u5305\u542bIO\u8c03\u5ea6\u5668 3. IO\u8c03\u5ea6\u5668\u7684<code>dispatch</code>\u65b9\u6cd5\u88ab\u8c03\u7528\uff0c\u9009\u62e9\u53ef\u7528Worker\u6267\u884cIO\u4efb\u52a1 4. IO\u4efb\u52a1\u5b8c\u6210\u540e\uff0c\u534f\u7a0b\u901a\u8fc7Default\u8c03\u5ea6\u5668\u6062\u590d\u5230\u539f\u6765\u7684\u4e0a\u4e0b\u6587 5. Default\u8c03\u5ea6\u5668\u518d\u6b21\u9009\u62e9Worker\u7ebf\u7a0b\u7ee7\u7eed\u6267\u884c</p>"},{"location":"020Kotlin/020Coroutines/#_52","title":"\u603b\u7ed3","text":"<p>Kotlin\u534f\u7a0b\u8c03\u5ea6\u5668\u51b3\u5b9a\u534f\u7a0b\u5728\u54ea\u4e2a\u7ebf\u7a0b\u4e0a\u6267\u884c\u7684\u673a\u5236\u5982\u4e0b\uff1a</p> <ol> <li>\u8c03\u5ea6\u5668\u7c7b\u578b\u51b3\u5b9a\u57fa\u672c\u7b56\u7565\uff1a</li> <li>Default\uff1aCPU\u5bc6\u96c6\u578b\u4efb\u52a1\u7684\u7ebf\u7a0b\u6c60</li> <li>IO\uff1a\u9002\u7528\u4e8eIO\u64cd\u4f5c\u7684\u53d7\u9650\u7ebf\u7a0b\u6c60</li> <li>Main\uff1a\u7279\u5b9a\u5e73\u53f0\u7684\u4e3b\u7ebf\u7a0b</li> <li> <p>Unconfined\uff1a\u4e0d\u5207\u6362\u7ebf\u7a0b\uff0c\u5728\u5f53\u524d\u7ebf\u7a0b\u7ee7\u7eed\u6267\u884c</p> </li> <li> <p>\u7ebf\u7a0b\u9009\u62e9\u7b97\u6cd5\uff1a</p> </li> <li>\u5c1d\u8bd5\u590d\u7528\u5f53\u524dWorker\u7ebf\u7a0b\uff08\u5982\u679c\u9002\u7528\uff09</li> <li>\u5426\u5219\uff0c\u5c06\u4efb\u52a1\u63d0\u4ea4\u5230\u5168\u5c40\u961f\u5217</li> <li> <p>Worker\u7ebf\u7a0b\u4ece\u672c\u5730\u961f\u5217\u3001\u5168\u5c40\u961f\u5217\u6216\u901a\u8fc7\u4efb\u52a1\u76d7\u53d6\u83b7\u53d6\u4efb\u52a1</p> </li> <li> <p>\u4efb\u52a1\u7279\u6027\u7684\u8003\u91cf\uff1a</p> </li> <li>\u662f\u5426\u4e3a\u963b\u585e\u6027\u4efb\u52a1\uff08PROBABLY_BLOCKING\uff09</li> <li>\u662f\u5426\u9700\u8981\u7279\u5b9a\u7ebf\u7a0b\uff08\u5982UI\u64cd\u4f5c\uff09</li> <li> <p>\u662f\u5426\u6709\u7d27\u6025\u6027\uff08\u5982yield\u64cd\u4f5c\uff09</p> </li> <li> <p>\u534f\u7a0b\u72b6\u6001\u8f6c\u6362\u70b9\uff1a</p> </li> <li>\u534f\u7a0b\u521b\u5efa\u65f6\u7684\u521d\u59cb\u8c03\u5ea6</li> <li>\u534f\u7a0b\u4ece\u6302\u8d77\u70b9\u6062\u590d\u65f6\u7684\u8c03\u5ea6</li> <li>\u663e\u5f0f\u4e0a\u4e0b\u6587\u5207\u6362\uff08withContext\uff09\u65f6\u7684\u91cd\u65b0\u8c03\u5ea6</li> </ol> <p>\u8fd9\u5957\u673a\u5236\u4f7f\u5f97\u534f\u7a0b\u80fd\u591f\u9ad8\u6548\u5730\u5229\u7528\u7ebf\u7a0b\u8d44\u6e90\uff0c\u5b9e\u73b0\"\u7528\u5c11\u91cf\u7ebf\u7a0b\u5904\u7406\u5927\u91cf\u5e76\u53d1\u4efb\u52a1\"\u7684\u76ee\u6807\uff0c\u540c\u65f6\u4fdd\u6301\u4ee3\u7801\u7684\u7b80\u6d01\u6027\u548c\u53ef\u8bfb\u6027\u3002</p>"},{"location":"020Kotlin/020Coroutines/#dispatchersdefaultiomain","title":"Dispatchers.Default,IO,Main\u662f\u4ec0\u4e48\u65f6\u5019\u88ab\u521d\u59cb\u5316\u7684\uff1f","text":"\u7b54\u6848 <p>\u8c03\u5ea6\u5668(Dispatchers)\u91c7\u7528\u7684\u662f\u61d2\u52a0\u8f7d\u673a\u5236\uff0c\u53ea\u6709\u5728\u5b9e\u9645\u4f7f\u7528\u65f6\u624d\u4f1a\u521d\u59cb\u5316\u3002\u8fd9\u9002\u7528\u4e8e\u6240\u6709\u7684\u8c03\u5ea6\u5668\uff0c\u5305\u62ecAndroid\u5e73\u53f0\u4e0a\u7684Dispatchers.Main\u3002</p> <p>\u5177\u4f53\u6765\u8bf4\uff1a</p> <ol> <li>Dispatchers.Default \u548c Dispatchers.IO:</li> <li>\u8fd9\u4e9b\u8c03\u5ea6\u5668\u76f4\u5230\u7b2c\u4e00\u6b21\u8bbf\u95ee\u65f6\u624d\u4f1a\u521d\u59cb\u5316</li> <li>\u521d\u59cb\u5316\u65f6\u4f1a\u521b\u5efa\u8c03\u5ea6\u5668\u5bf9\u8c61\u548c\u914d\u7f6e\u7ebf\u7a0b\u6c60\u53c2\u6570</li> <li> <p>\u4f46\u5b9e\u9645\u7684\u5de5\u4f5c\u7ebf\u7a0b\u901a\u5e38\u8981\u7b49\u5230\u7b2c\u4e00\u4e2a\u4efb\u52a1\u63d0\u4ea4\u65f6\u624d\u4f1a\u521b\u5efa</p> </li> <li> <p>Dispatchers.Main (Android\u5e73\u53f0):</p> </li> <li>\u4f7f\u7528\u4e86ServiceLoader\u673a\u5236\uff0c\u5728\u9996\u6b21\u8bbf\u95ee\u65f6\u624d\u4f1a\u52a0\u8f7d\u5bf9\u5e94\u7684\u5b9e\u73b0</li> <li>\u5728Android\u4e0a\uff0c\u4f1a\u67e5\u627e\u5e76\u52a0\u8f7dAndroidDispatcherFactory\u6765\u521b\u5efaMain\u8c03\u5ea6\u5668</li> <li> <p>\u8fd9\u4f7f\u5f97\u534f\u7a0b\u5e93\u53ef\u4ee5\u5728\u591a\u5e73\u53f0\u73af\u5883\u4e2d\u4f7f\u7528\uff0c\u800c\u4e0d\u5fc5\u9884\u52a0\u8f7d\u6240\u6709\u5e73\u53f0\u7684\u5b9e\u73b0</p> </li> <li> <p>Dispatchers.Unconfined:</p> </li> <li>\u4f5c\u4e3a\u6700\u7b80\u5355\u7684\u8c03\u5ea6\u5668\uff0c\u4e5f\u662f\u5728\u9996\u6b21\u8bbf\u95ee\u65f6\u624d\u521d\u59cb\u5316</li> </ol> <p>\u8fd9\u79cd\u61d2\u52a0\u8f7d\u8bbe\u8ba1\u6709\u51e0\u4e2a\u91cd\u8981\u4f18\u52bf\uff1a</p> <ul> <li>\u8d44\u6e90\u8282\u7ea6: \u5982\u679c\u5e94\u7528\u7a0b\u5e8f\u4e0d\u4f7f\u7528\u534f\u7a0b\uff0c\u5c31\u4e0d\u4f1a\u6d88\u8017\u4efb\u4f55\u76f8\u5173\u8d44\u6e90</li> <li>\u542f\u52a8\u6027\u80fd: \u907f\u514d\u4e86\u5e94\u7528\u542f\u52a8\u65f6\u7684\u4e0d\u5fc5\u8981\u521d\u59cb\u5316\u5f00\u9500</li> <li>\u6309\u9700\u52a0\u8f7d: \u53ea\u521d\u59cb\u5316\u5b9e\u9645\u4f7f\u7528\u7684\u8c03\u5ea6\u5668\uff0c\u800c\u4e0d\u662f\u5168\u90e8</li> </ul> <p>\u4ece\u5b9e\u9645\u4f7f\u7528\u89d2\u5ea6\u770b\uff0c\u8fd9\u610f\u5473\u7740\u5982\u679c\u60a8\u7684\u5e94\u7528\u7a0b\u5e8f\u67d0\u4e9b\u6a21\u5757\u4e0d\u4f7f\u7528\u534f\u7a0b\uff0c\u90a3\u4e48\u8fd9\u4e9b\u6a21\u5757\u4e0d\u4f1a\u627f\u62c5\u534f\u7a0b\u8c03\u5ea6\u5668\u521d\u59cb\u5316\u7684\u5f00\u9500\uff0c\u8fd9\u5bf9\u4e8e\u5927\u578b\u5e94\u7528\u7684\u6027\u80fd\u4f18\u5316\u662f\u6709\u76ca\u7684\u3002</p> \u8be6\u7ec6\u7b54\u6848"},{"location":"020Kotlin/020Coroutines/#kotlindispatchers_1","title":"Kotlin\u534f\u7a0b\u8c03\u5ea6\u5668(Dispatchers)\u7684\u521d\u59cb\u5316\u6d41\u7a0b\u5206\u6790","text":"<p>\u8ba9\u6211\u4ece\u6e90\u7801\u89d2\u5ea6\u5206\u6790Kotlin\u4e2d\u5404\u79cd\u8c03\u5ea6\u5668(Dispatchers)\u7684\u521d\u59cb\u5316\u65f6\u673a\u548c\u8fc7\u7a0b\u3002</p>"},{"location":"020Kotlin/020Coroutines/#dispatchers","title":"Dispatchers\u7c7b\u7684\u7ed3\u6784","text":"<p>\u9996\u5148\uff0c<code>Dispatchers</code>\u662f\u4e00\u4e2a\u5305\u542b\u5404\u79cd\u8c03\u5ea6\u5668\u7684\u5355\u4f8b\u5bf9\u8c61\uff1a</p> <pre><code>public actual object Dispatchers {\n    @JvmStatic\n    public actual val Default: CoroutineDispatcher = DefaultScheduler\n\n    @JvmStatic\n    public actual val Main: MainCoroutineDispatcher get() = MainDispatcherLoader.dispatcher\n\n    @JvmStatic\n    public actual val Unconfined: CoroutineDispatcher = kotlinx.coroutines.Unconfined\n\n    @JvmStatic\n    public actual val IO: CoroutineDispatcher = DefaultIoScheduler\n\n    // \u5176\u4ed6\u6210\u5458...\n}\n</code></pre>"},{"location":"020Kotlin/020Coroutines/#_53","title":"\u5404\u8c03\u5ea6\u5668\u7684\u521d\u59cb\u5316\u65f6\u673a","text":""},{"location":"020Kotlin/020Coroutines/#1-dispatchersdefault-defaultscheduler","title":"1. Dispatchers.Default (DefaultScheduler)","text":"<p><code>DefaultScheduler</code>\u4f5c\u4e3a<code>Dispatchers.Default</code>\u7684\u5b9e\u73b0\uff0c\u662f\u4e00\u4e2a\u5355\u4f8b\u5bf9\u8c61\uff1a</p> <pre><code>internal object DefaultScheduler : ExperimentalCoroutineDispatcher() {\n    // \u521d\u59cb\u5316\u4ee3\u7801\u5728init\u5757\u4e2d\u6267\u884c\n    init {\n        // \u8ba1\u7b97\u6838\u5fc3\u7ebf\u7a0b\u6c60\u5927\u5c0f\n        val cores = systemProp(\n            COROUTINES_SCHEDULER_CORE_POOL_SIZE_PROPERTY_NAME,\n            AVAILABLE_PROCESSORS.coerceAtLeast(2)\n        )\n        // \u8ba1\u7b97\u6700\u5927\u7ebf\u7a0b\u6c60\u5927\u5c0f\n        val maxPoolSize = systemProp(\n            COROUTINES_SCHEDULER_MAX_POOL_SIZE_PROPERTY_NAME, \n            maxOf(cores, 64, AVAILABLE_PROCESSORS * 128)\n        )\n\n        // \u521b\u5efa\u8c03\u5ea6\u5668\n        coroutineScheduler = createScheduler(cores, maxPoolSize)\n    }\n\n    // \u5176\u4ed6\u4ee3\u7801...\n}\n</code></pre> <p>\u521d\u59cb\u5316\u65f6\u673a\uff1a\u5f53\u9996\u6b21\u8bbf\u95ee<code>Dispatchers.Default</code>\u65f6\uff0cJVM\u4f1a\u52a0\u8f7d<code>DefaultScheduler</code>\u7c7b\u5e76\u6267\u884c\u5176\u9759\u6001\u521d\u59cb\u5316\u5757\uff0c\u6b64\u65f6\u521b\u5efa<code>CoroutineScheduler</code>\u5b9e\u4f8b\u3002\u8fd9\u662f\u5178\u578b\u7684\u61d2\u52a0\u8f7d\u5355\u4f8b\u6a21\u5f0f\u3002</p>"},{"location":"020Kotlin/020Coroutines/#2-dispatchersio","title":"2. Dispatchers.IO","text":"<p><code>DefaultScheduler</code>\u5bf9\u8c61\u4e2d\u5b9a\u4e49\u4e86IO\u8c03\u5ea6\u5668\uff1a</p> <pre><code>internal object DefaultScheduler : ExperimentalCoroutineDispatcher() {\n    val IO: CoroutineDispatcher = LimitingDispatcher(\n        this,\n        systemProp(IO_PARALLELISM_PROPERTY_NAME, 64.coerceAtLeast(AVAILABLE_PROCESSORS)),\n        \"Dispatchers.IO\",\n        TASK_PROBABLY_BLOCKING\n    )\n}\n</code></pre> <p>\u521d\u59cb\u5316\u65f6\u673a\uff1a<code>Dispatchers.IO</code>\u5b9e\u9645\u4e0a\u5f15\u7528\u4e86<code>DefaultIoScheduler</code>\uff0c\u5b83\u662f\u4e00\u4e2a\u4ee3\u7406\u5bf9\u8c61\uff0c\u6307\u5411<code>DefaultScheduler.IO</code>\u3002\u5f53\u9996\u6b21\u8bbf\u95ee<code>Dispatchers.IO</code>\u65f6\uff0c\u4f1a\u89e6\u53d1<code>DefaultScheduler</code>\u7684\u521d\u59cb\u5316\uff0c\u540c\u65f6\u521b\u5efaIO\u8c03\u5ea6\u5668\u5b9e\u4f8b\u3002</p> <pre><code>internal object DefaultIoScheduler : CoroutineDispatcher(), Delay {\n    private val default = DefaultScheduler.IO\n\n    override fun dispatch(context: CoroutineContext, block: Runnable) =\n        default.dispatch(context, block)\n\n    // \u5176\u4ed6\u65b9\u6cd5...\n}\n</code></pre>"},{"location":"020Kotlin/020Coroutines/#3-dispatchersmain","title":"3. Dispatchers.Main","text":"<p><code>Dispatchers.Main</code>\u7684\u521d\u59cb\u5316\u8f83\u4e3a\u7279\u6b8a\uff0c\u4f7f\u7528\u4e86getter\u65b9\u6cd5\u548c<code>MainDispatcherLoader</code>\uff1a</p> <pre><code>public actual val Main: MainCoroutineDispatcher get() = MainDispatcherLoader.dispatcher\n</code></pre> <p><code>MainDispatcherLoader</code>\u4f7f\u7528\u4e86\u670d\u52a1\u52a0\u8f7d\u5668\u6a21\u5f0f\uff1a</p> <pre><code>internal object MainDispatcherLoader {\n    @JvmStatic\n    val dispatcher: MainCoroutineDispatcher = loadMainDispatcher()\n\n    private fun loadMainDispatcher(): MainCoroutineDispatcher {\n        // \u4f7f\u7528ServiceLoader\u52a0\u8f7dMainDispatcherFactory\u7684\u5b9e\u73b0\n        val factories = ServiceLoader.load(\n            MainDispatcherFactory::class.java, \n            MainDispatcherFactory::class.java.classLoader\n        ).iterator()\n\n        // \u9009\u62e9\u4f18\u5148\u7ea7\u6700\u9ad8\u7684\u5de5\u5382\u521b\u5efadispatcher\n        if (!factories.hasNext()) return MissingMainCoroutineDispatcher(null)\n\n        // ...\u521b\u5efa\u548c\u8fd4\u56deMainCoroutineDispatcher\n    }\n}\n</code></pre> <p>\u521d\u59cb\u5316\u65f6\u673a\uff1a<code>Dispatchers.Main</code>\u4f7f\u7528\u5c5e\u6027\u59d4\u6258\uff0c\u6bcf\u6b21\u8bbf\u95ee\u65f6\u90fd\u4f1a\u8c03\u7528getter\u3002\u4f46<code>MainDispatcherLoader.dispatcher</code>\u662f\u9759\u6001\u5b57\u6bb5\uff0c\u53ea\u4f1a\u5728\u9996\u6b21\u8bbf\u95ee\u65f6\u521d\u59cb\u5316\u4e00\u6b21\u3002\u8fd9\u79cd\u8bbe\u8ba1\u5141\u8bb8\u5728\u4e0d\u540c\u5e73\u53f0\u4e0a\u52a8\u6001\u9009\u62e9\u5408\u9002\u7684Main\u8c03\u5ea6\u5668\u5b9e\u73b0\u3002</p>"},{"location":"020Kotlin/020Coroutines/#4-dispatchersunconfined","title":"4. Dispatchers.Unconfined","text":"<p><code>Dispatchers.Unconfined</code>\u76f4\u63a5\u5f15\u7528\u4e86<code>kotlinx.coroutines.Unconfined</code>\u5bf9\u8c61\uff1a</p> <pre><code>public actual val Unconfined: CoroutineDispatcher = kotlinx.coroutines.Unconfined\n</code></pre> <p>\u800c<code>Unconfined</code>\u5b9a\u4e49\u5982\u4e0b\uff1a</p> <pre><code>internal object Unconfined : CoroutineDispatcher() {\n    override fun isDispatchNeeded(context: CoroutineContext): Boolean = false\n\n    override fun dispatch(context: CoroutineContext, block: Runnable) {\n        // \u5b9e\u73b0...\n    }\n}\n</code></pre> <p>\u521d\u59cb\u5316\u65f6\u673a\uff1a\u5f53\u9996\u6b21\u8bbf\u95ee<code>Dispatchers.Unconfined</code>\u65f6\uff0cJVM\u4f1a\u52a0\u8f7d\u5e76\u521d\u59cb\u5316<code>Unconfined</code>\u5bf9\u8c61\u3002\u7531\u4e8e\u5b83\u662f\u65e0\u72b6\u6001\u7684\u7b80\u5355\u5bf9\u8c61\uff0c\u521d\u59cb\u5316\u6210\u672c\u5f88\u4f4e\u3002</p>"},{"location":"020Kotlin/020Coroutines/#_54","title":"\u7ebf\u7a0b\u6c60\u7684\u5ef6\u8fdf\u521b\u5efa","text":"<p>\u5c3d\u7ba1\u8c03\u5ea6\u5668\u5bf9\u8c61\u5728\u9996\u6b21\u8bbf\u95ee\u65f6\u5c31\u4f1a\u521d\u59cb\u5316\uff0c\u4f46\u5b9e\u9645\u7684\u7ebf\u7a0b\u6c60\u901a\u5e38\u91c7\u7528\u5ef6\u8fdf\u521b\u5efa\u6a21\u5f0f\u3002\u4ee5<code>CoroutineScheduler</code>\u4e3a\u4f8b\uff1a</p> <pre><code>internal class CoroutineScheduler(\n    @JvmField val corePoolSize: Int,\n    @JvmField val maxPoolSize: Int,\n    @JvmField val idleWorkerKeepAliveNs: Long = IDLE_WORKER_KEEP_ALIVE_NS,\n    @JvmField val schedulerName: String = \"CoroutineScheduler\"\n) : Executor, Closeable {\n    // \u5de5\u4f5c\u7ebf\u7a0b\u6570\u7ec4\n    private val workers = AtomicReferenceArray&lt;Worker?&gt;(maxPoolSize + 1)\n\n    // \u5de5\u4f5c\u7ebf\u7a0b\u8ba1\u6570\u5668\n    private val _isTerminated = atomic(0)\n\n    // \u521b\u5efa\u7684\u5de5\u4f5c\u7ebf\u7a0b\u6570\u91cf\n    @Volatile\n    private var createdWorkers = 0\n\n    // \u63d0\u4ea4\u4efb\u52a1\u7684\u65b9\u6cd5\n    internal fun submitToGlobalQueue(task: Task) {\n        // ...\u63d0\u4ea4\u4efb\u52a1\u903b\u8f91\n\n        // \u786e\u4fdd\u6709\u8db3\u591f\u7684Worker\u6765\u5904\u7406\u4efb\u52a1\n        signalCpuWork()\n    }\n\n    private fun tryCreateWorker(): Boolean {\n        synchronized(workers) {\n            // \u68c0\u67e5\u662f\u5426\u8fbe\u5230\u6700\u5927\u7ebf\u7a0b\u6570\n            val created = createdWorkers\n            if (created &gt;= maxPoolSize) return false\n\n            // \u521b\u5efa\u65b0Worker\n            val newIndex = created + 1\n            createdWorkers = newIndex\n            val worker = Worker(newIndex)\n            workers[newIndex] = worker\n            worker.start() // \u542f\u52a8\u5de5\u4f5c\u7ebf\u7a0b\n            return true\n        }\n    }\n}\n</code></pre> <p>\u5ef6\u8fdf\u521b\u5efa\u673a\u5236\uff1a\u5c3d\u7ba1\u8c03\u5ea6\u5668\u5bf9\u8c61\u5728\u9996\u6b21\u8bbf\u95ee\u65f6\u5c31\u88ab\u521d\u59cb\u5316\uff0c\u4f46\u5b9e\u9645\u7684\u5de5\u4f5c\u7ebf\u7a0b\u662f\u5728\u63d0\u4ea4\u7b2c\u4e00\u4e2a\u4efb\u52a1\u65f6\u624d\u521b\u5efa\u7684\u3002\u8fd9\u79cd\u8bbe\u8ba1\u907f\u514d\u4e86\u4e0d\u5fc5\u8981\u7684\u7ebf\u7a0b\u8d44\u6e90\u6d88\u8017\u3002</p>"},{"location":"020Kotlin/020Coroutines/#_55","title":"\u521d\u59cb\u5316\u793a\u4f8b\u6d41\u7a0b","text":"<p>\u4ee5\u4e0b\u662f\u4e00\u4e2a\u5b8c\u6574\u7684\u521d\u59cb\u5316\u6d41\u7a0b\u793a\u4f8b\uff1a</p> <ol> <li>\u5e94\u7528\u7a0b\u5e8f\u542f\u52a8</li> <li>\u9996\u6b21\u8c03\u7528<code>launch(Dispatchers.Default) { ... }</code></li> <li>JVM\u52a0\u8f7d<code>Dispatchers</code>\u7c7b\u5e76\u521d\u59cb\u5316\u5176\u9759\u6001\u5b57\u6bb5</li> <li>\u52a0\u8f7d\u5e76\u521d\u59cb\u5316<code>DefaultScheduler</code>\u5bf9\u8c61</li> <li>\u521b\u5efa<code>CoroutineScheduler</code>\u5b9e\u4f8b\uff0c\u4f46\u5c1a\u672a\u521b\u5efa\u4efb\u4f55\u5de5\u4f5c\u7ebf\u7a0b</li> <li>\u534f\u7a0b\u4efb\u52a1\u88ab\u63d0\u4ea4\u5230\u8c03\u5ea6\u5668</li> <li>\u8c03\u5ea6\u5668\u53d1\u73b0\u6ca1\u6709\u6d3b\u8dc3\u7684\u5de5\u4f5c\u7ebf\u7a0b\uff0c\u521b\u5efa\u7b2c\u4e00\u4e2a\u5de5\u4f5c\u7ebf\u7a0b</li> <li>\u5de5\u4f5c\u7ebf\u7a0b\u6267\u884c\u63d0\u4ea4\u7684\u534f\u7a0b\u4efb\u52a1</li> </ol>"},{"location":"020Kotlin/020Coroutines/#_56","title":"\u603b\u7ed3","text":"<p>Kotlin\u534f\u7a0b\u7684\u8c03\u5ea6\u5668\u521d\u59cb\u5316\u91c7\u7528\u4e86\u591a\u5c42\u6b21\u7684\u5ef6\u8fdf\u52a0\u8f7d\u6a21\u5f0f\uff1a</p> <ol> <li>\u8c03\u5ea6\u5668\u5bf9\u8c61\u7684\u521d\u59cb\u5316\uff1a</li> <li>\u91c7\u7528JVM\u7c7b\u52a0\u8f7d\u673a\u5236\uff0c\u5728\u9996\u6b21\u8bbf\u95ee\u76f8\u5e94\u7684Dispatchers\u5b57\u6bb5\u65f6\u521d\u59cb\u5316</li> <li><code>Dispatchers.Default</code>\u548c<code>Dispatchers.IO</code>\u5171\u4eab\u5e95\u5c42\u7684<code>DefaultScheduler</code></li> <li><code>Dispatchers.Main</code>\u4f7f\u7528ServiceLoader\u52a8\u6001\u52a0\u8f7d\u5e73\u53f0\u7279\u5b9a\u5b9e\u73b0</li> <li> <p><code>Dispatchers.Unconfined</code>\u662f\u7b80\u5355\u7684\u65e0\u72b6\u6001\u5bf9\u8c61</p> </li> <li> <p>\u7ebf\u7a0b\u6c60\u7684\u521d\u59cb\u5316\uff1a</p> </li> <li>\u7ebf\u7a0b\u6c60\u914d\u7f6e\u5728\u8c03\u5ea6\u5668\u5bf9\u8c61\u521d\u59cb\u5316\u65f6\u786e\u5b9a</li> <li>\u5b9e\u9645\u7684\u5de5\u4f5c\u7ebf\u7a0b\u5728\u9996\u6b21\u63d0\u4ea4\u4efb\u52a1\u65f6\u624d\u521b\u5efa</li> <li>\u7ebf\u7a0b\u6570\u91cf\u4f1a\u6839\u636e\u5de5\u4f5c\u8d1f\u8f7d\u52a8\u6001\u8c03\u6574\uff0c\u76f4\u5230\u8fbe\u5230\u914d\u7f6e\u7684\u4e0a\u9650</li> </ol> <p>\u8fd9\u79cd\u8bbe\u8ba1\u786e\u4fdd\u4e86\u534f\u7a0b\u6846\u67b6\u7684\u9ad8\u6548\u542f\u52a8\u548c\u8d44\u6e90\u5229\u7528\uff0c\u53ea\u6709\u5728\u5b9e\u9645\u9700\u8981\u65f6\u624d\u4f1a\u521b\u5efa\u548c\u4f7f\u7528\u7ebf\u7a0b\u8d44\u6e90\u3002</p>"},{"location":"020Kotlin/020Coroutines/#kotlin_5","title":"Kotlin\u534f\u7a0b\u7684\u5e76\u53d1\u4e0e\u540c\u6b65\u673a\u5236","text":"\u7b54\u6848"},{"location":"020Kotlin/020Coroutines/#kotlin_6","title":"Kotlin\u534f\u7a0b\u7684\u5e76\u53d1\u4e0e\u540c\u6b65\u673a\u5236","text":"<p>Kotlin\u534f\u7a0b\u63d0\u4f9b\u4e86\u5f3a\u5927\u7684\u5e76\u53d1\u7f16\u7a0b\u80fd\u529b\uff0c\u540c\u65f6\u4e5f\u9700\u8981\u5408\u7406\u7684\u540c\u6b65\u673a\u5236\u6765\u4fdd\u8bc1\u7ebf\u7a0b\u5b89\u5168\u3002\u4e0b\u9762\u6211\u5c06\u8be6\u7ec6\u89e3\u6790\u534f\u7a0b\u4e2d\u7684\u5e76\u53d1\u63a7\u5236\u548c\u540c\u6b65\u6280\u672f\u3002</p>"},{"location":"020Kotlin/020Coroutines/#_57","title":"\u4e00\u3001\u534f\u7a0b\u5e76\u53d1\u57fa\u7840","text":""},{"location":"020Kotlin/020Coroutines/#1-vs_1","title":"1. \u5e76\u53d1 vs \u5e76\u884c","text":"<ul> <li>\u5e76\u53d1\uff1a\u591a\u4e2a\u4efb\u52a1\u4ea4\u66ff\u6267\u884c\uff0c\u770b\u8d77\u6765\u50cf\u662f\u540c\u65f6\u8fdb\u884c</li> <li>\u5e76\u884c\uff1a\u591a\u4e2a\u4efb\u52a1\u771f\u6b63\u540c\u65f6\u6267\u884c\uff08\u9700\u8981\u591a\u6838CPU\u652f\u6301\uff09</li> </ul>"},{"location":"020Kotlin/020Coroutines/#2_4","title":"2. \u534f\u7a0b\u5e76\u53d1\u5b9e\u73b0\u65b9\u5f0f","text":"<pre><code>// \u65b9\u5f0f1\uff1a\u4f7f\u7528\u591a\u4e2aasync\u5e76\u53d1\u6267\u884c\nsuspend fun fetchTwoThings() {\n    coroutineScope {\n        val deferred1 = async { fetchData1() }\n        val deferred2 = async { fetchData2() }\n        val result1 = deferred1.await()\n        val result2 = deferred2.await()\n        // \u5904\u7406\u7ed3\u679c\n    }\n}\n\n// \u65b9\u5f0f2\uff1a\u4f7f\u7528launch\u5e76\u53d1\u6267\u884c\u591a\u4e2a\u4efb\u52a1\nfun doMultipleTasks() {\n    CoroutineScope(Dispatchers.Default).launch {\n        val job1 = launch { task1() }\n        val job2 = launch { task2() }\n        job1.join()\n        job2.join()\n    }\n}\n</code></pre>"},{"location":"020Kotlin/020Coroutines/#_58","title":"\u4e8c\u3001\u534f\u7a0b\u540c\u6b65\u673a\u5236","text":""},{"location":"020Kotlin/020Coroutines/#1_5","title":"1. \u5171\u4eab\u72b6\u6001\u95ee\u9898","text":"<p>\u5f53\u591a\u4e2a\u534f\u7a0b\u8bbf\u95ee\u5171\u4eab\u53ef\u53d8\u72b6\u6001\u65f6\u4f1a\u51fa\u73b0\u7ade\u6001\u6761\u4ef6\uff1a</p> <pre><code>var counter = 0\n\nfun main() = runBlocking {\n    repeat(100) {\n        launch {\n            delay(10)\n            counter++\n        }\n    }\n    delay(1000)\n    println(\"Counter = $counter\") // \u53ef\u80fd\u5c0f\u4e8e100\n}\n</code></pre>"},{"location":"020Kotlin/020Coroutines/#2_5","title":"2. \u540c\u6b65\u89e3\u51b3\u65b9\u6848","text":""},{"location":"020Kotlin/020Coroutines/#1-mutex","title":"(1) \u4e92\u65a5\u9501\uff08Mutex\uff09","text":"<pre><code>val mutex = Mutex()\nvar counter = 0\n\nfun main() = runBlocking {\n    repeat(100) {\n        launch {\n            delay(10)\n            mutex.withLock {\n                counter++\n            }\n        }\n    }\n    delay(1000)\n    println(\"Counter = $counter\") // \u4fdd\u8bc1\u662f100\n}\n</code></pre> <p>\u7279\u70b9\uff1a - \u534f\u7a0b\u6302\u8d77\u800c\u975e\u963b\u585e - \u4e0d\u53ef\u91cd\u5165\uff08\u540c\u4e00\u534f\u7a0b\u4e0d\u80fd\u91cd\u590d\u83b7\u53d6\u9501\uff09 - \u6bd4Java\u7684synchronized\u66f4\u8f7b\u91cf</p>"},{"location":"020Kotlin/020Coroutines/#2-atomic","title":"(2) \u539f\u5b50\u53d8\u91cf\uff08Atomic\uff09","text":"<pre><code>val counter = AtomicInteger()\n\nfun main() = runBlocking {\n    repeat(100) {\n        launch {\n            delay(10)\n            counter.incrementAndGet()\n        }\n    }\n    delay(1000)\n    println(\"Counter = ${counter.get()}\") // \u4fdd\u8bc1\u662f100\n}\n</code></pre> <p>\u9002\u7528\u573a\u666f\uff1a - \u7b80\u5355\u8ba1\u6570\u5668 - \u5355\u4e00\u53d8\u91cf\u7684\u539f\u5b50\u64cd\u4f5c</p>"},{"location":"020Kotlin/020Coroutines/#3-actor","title":"(3) \u5355\u7ebf\u7a0b\u9650\u5236\uff08Actor\u6a21\u5f0f\uff09","text":"<pre><code>sealed class CounterMsg\nobject IncCounter : CounterMsg() // \u9012\u589e\u6d88\u606f\nclass GetCounter(val response: CompletableDeferred&lt;Int&gt;) : CounterMsg() // \u83b7\u53d6\u503c\u6d88\u606f\n\nfun counterActor() = CoroutineScope(Dispatchers.Default).actor&lt;CounterMsg&gt; {\n    var counter = 0\n    for (msg in channel) {\n        when (msg) {\n            is IncCounter -&gt; counter++\n            is GetCounter -&gt; msg.response.complete(counter)\n        }\n    }\n}\n\nsuspend fun main() {\n    val counter = counterActor()\n    repeat(100) {\n        counter.send(IncCounter)\n    }\n    val response = CompletableDeferred&lt;Int&gt;()\n    counter.send(GetCounter(response))\n    println(\"Counter = ${response.await()}\")\n    counter.close()\n}\n</code></pre> <p>\u7279\u70b9\uff1a - \u6240\u6709\u72b6\u6001\u4fee\u6539\u90fd\u901a\u8fc7\u6d88\u606f\u4f20\u9012 - \u72b6\u6001\u88ab\u9650\u5236\u5728\u5355\u4e2a\u534f\u7a0b\u4e2d\u8bbf\u95ee - \u907f\u514d\u4e86\u663e\u5f0f\u540c\u6b65</p>"},{"location":"020Kotlin/020Coroutines/#4_7","title":"(4) \u534f\u7a0b\u5b89\u5168\u7684\u6570\u636e\u7ed3\u6784","text":"<pre><code>val counterContext = newSingleThreadContext(\"CounterContext\")\nvar counter = 0\n\nfun main() = runBlocking {\n    repeat(100) {\n        launch(counterContext) { // \u6240\u6709\u4fee\u6539\u90fd\u5728\u540c\u4e00\u7ebf\u7a0b\n            counter++\n        }\n    }\n    delay(1000)\n    println(\"Counter = $counter\") // \u4fdd\u8bc1\u662f100\n}\n</code></pre>"},{"location":"020Kotlin/020Coroutines/#_59","title":"\u4e09\u3001\u9ad8\u7ea7\u5e76\u53d1\u6a21\u5f0f","text":""},{"location":"020Kotlin/020Coroutines/#1_6","title":"1. \u9650\u5236\u5e76\u53d1\u6570","text":"<pre><code>val limitedDispatcher = Dispatchers.IO.limitedParallelism(4) // \u9650\u5236\u6700\u591a4\u4e2a\u5e76\u53d1\n\nfun loadManyItems() = runBlocking {\n    val jobs = List(100) {\n        async(limitedDispatcher) {\n            loadItem(it)\n        }\n    }\n    jobs.awaitAll()\n}\n</code></pre>"},{"location":"020Kotlin/020Coroutines/#2-barrier","title":"2. \u534f\u7a0b\u540c\u6b65\u5c4f\u969c\uff08Barrier\uff09","text":"<pre><code>suspend fun concurrentTasks() = coroutineScope {\n    val barrier = CyclicBarrier(3)\n\n    launch { \n        task1()\n        barrier.await()\n    }\n    launch { \n        task2()\n        barrier.await()\n    }\n    launch { \n        task3()\n        barrier.await()\n    }\n\n    println(\"All tasks completed\")\n}\n</code></pre>"},{"location":"020Kotlin/020Coroutines/#3-channel","title":"3. \u751f\u4ea7\u8005-\u6d88\u8d39\u8005\u6a21\u5f0f\uff08Channel\uff09","text":"<pre><code>fun producerConsumer() = runBlocking {\n    val channel = Channel&lt;Int&gt;()\n\n    // \u751f\u4ea7\u8005\n    launch {\n        repeat(10) {\n            channel.send(it)\n            delay(100)\n        }\n        channel.close()\n    }\n\n    // \u6d88\u8d39\u8005\n    launch {\n        for (item in channel) {\n            println(\"Received: $item\")\n        }\n    }\n}\n</code></pre>"},{"location":"020Kotlin/020Coroutines/#_60","title":"\u56db\u3001\u6700\u4f73\u5b9e\u8df5","text":"<ol> <li>\u907f\u514d\u5171\u4eab\u53ef\u53d8\u72b6\u6001\uff1a\u4f18\u5148\u4f7f\u7528\u6d88\u606f\u4f20\u9012\u800c\u975e\u5171\u4eab\u72b6\u6001</li> <li>\u6700\u5c0f\u5316\u540c\u6b65\u8303\u56f4\uff1a\u53ea\u5728\u5fc5\u8981\u65f6\u4f7f\u7528\u540c\u6b65\u673a\u5236</li> <li>\u9009\u62e9\u5408\u9002\u7684\u540c\u6b65\u5de5\u5177\uff1a</li> <li>\u7b80\u5355\u8ba1\u6570\u5668 \u2192 \u539f\u5b50\u53d8\u91cf</li> <li>\u590d\u6742\u64cd\u4f5c \u2192 Mutex</li> <li>\u590d\u6742\u72b6\u6001 \u2192 Actor\u6216\u5355\u7ebf\u7a0b\u9650\u5236</li> <li>\u6ce8\u610f\u534f\u7a0b\u53d6\u6d88\uff1a\u540c\u6b65\u64cd\u4f5c\u5e94\u8003\u8651\u534f\u7a0b\u53d6\u6d88\u7684\u60c5\u51b5</li> <li>\u6027\u80fd\u8003\u91cf\uff1a</li> <li>\u9ad8\u9891\u64cd\u4f5c\u8003\u8651\u539f\u5b50\u53d8\u91cf</li> <li>\u4f4e\u9891\u590d\u6742\u64cd\u4f5c\u8003\u8651Mutex</li> <li>\u5927\u91cf\u5e76\u53d1\u8003\u8651\u9650\u5236\u5e76\u53d1\u6570</li> </ol>"},{"location":"020Kotlin/020Coroutines/#_61","title":"\u4e94\u3001\u5e38\u89c1\u95ee\u9898\u4e0e\u89e3\u51b3\u65b9\u6848","text":"<p>\u95ee\u98981\uff1a\u4e3a\u4ec0\u4e48\u6211\u7684\u8ba1\u6570\u5668\u7ed3\u679c\u4e0d\u51c6\u786e\uff1f \u89e3\u51b3\uff1a\u4f7f\u7528Mutex\u6216\u539f\u5b50\u53d8\u91cf\u4fdd\u62a4\u5171\u4eab\u72b6\u6001</p> <p>\u95ee\u98982\uff1a\u534f\u7a0b\u6b7b\u9501\u5982\u4f55\u907f\u514d\uff1f \u89e3\u51b3\uff1a - \u907f\u514d\u5728\u6301\u6709\u9501\u65f6\u8c03\u7528\u6302\u8d77\u51fd\u6570 - \u4f7f\u7528tryLock\u8bbe\u7f6e\u8d85\u65f6 - \u4fdd\u6301\u9501\u7684\u83b7\u53d6\u987a\u5e8f\u4e00\u81f4</p> <p>\u95ee\u98983\uff1a\u5982\u4f55\u63a7\u5236\u8d44\u6e90\u8bbf\u95ee\uff1f \u89e3\u51b3\uff1a\u4f7f\u7528Semaphore <pre><code>val semaphore = Semaphore(3) // \u5141\u8bb83\u4e2a\u5e76\u53d1\u8bbf\u95ee\n\nsuspend fun accessResource() {\n    semaphore.acquire()\n    try {\n        // \u8bbf\u95ee\u53d7\u9650\u8d44\u6e90\n    } finally {\n        semaphore.release()\n    }\n}\n</code></pre></p> <p>Kotlin\u534f\u7a0b\u901a\u8fc7\u63d0\u4f9b\u5404\u79cd\u540c\u6b65\u539f\u8bed\u548c\u5e76\u53d1\u6a21\u5f0f\uff0c\u4f7f\u5f97\u7f16\u5199\u5e76\u53d1\u4ee3\u7801\u66f4\u52a0\u7b80\u5355\u548c\u5b89\u5168\u3002\u7406\u89e3\u8fd9\u4e9b\u673a\u5236\u5e76\u6839\u636e\u5177\u4f53\u573a\u666f\u9009\u62e9\u5408\u9002\u7684\u65b9\u6848\uff0c\u53ef\u4ee5\u6784\u5efa\u51fa\u9ad8\u6548\u4e14\u6b63\u786e\u7684\u5e76\u53d1\u5e94\u7528\u7a0b\u5e8f\u3002</p>"},{"location":"020Kotlin/020Coroutines/#viewmodelscopelaunch-launch","title":"ViewModelScope.launch{} \u8fd9\u4e2alaunch\u662f\u54ea\u4e2a\u7ebf\u7a0b\uff1f","text":"\u7b54\u6848 <p>\u5728 Kotlin \u534f\u7a0b\u4e2d\uff0c<code>viewModelScope.launch {}</code> \u542f\u52a8\u7684\u534f\u7a0b\u9ed8\u8ba4\u8fd0\u884c\u5728\u4e3b\u7ebf\u7a0b\uff08UI \u7ebf\u7a0b\uff09\u4e0a\u3002\u8fd9\u662f\u56e0\u4e3a <code>viewModelScope</code> \u662f <code>ViewModel</code> \u7684\u4e00\u4e2a\u6269\u5c55\u5c5e\u6027\uff0c\u5b83\u4e0e <code>Dispatchers.Main</code> \u76f8\u5173\u8054\u3002</p>"},{"location":"020Kotlin/020Coroutines/#_62","title":"\u4e3a\u4ec0\u4e48\u662f\u4e3b\u7ebf\u7a0b\uff1f","text":"<ol> <li> <p>UI \u66f4\u65b0\u9700\u6c42\uff1a<code>ViewModel</code> \u901a\u5e38\u7528\u4e8e\u7ba1\u7406\u4e0e UI \u76f8\u5173\u7684\u6570\u636e\uff0c\u800c UI \u66f4\u65b0\u5fc5\u987b\u5728\u4e3b\u7ebf\u7a0b\u4e0a\u8fdb\u884c\u3002\u56e0\u6b64\uff0c<code>viewModelScope</code> \u9ed8\u8ba4\u4f7f\u7528 <code>Dispatchers.Main</code>\uff0c\u4ee5\u786e\u4fdd\u534f\u7a0b\u4e2d\u7684\u4ee3\u7801\u53ef\u4ee5\u76f4\u63a5\u64cd\u4f5c UI\u3002</p> </li> <li> <p>\u7b80\u5316\u5f00\u53d1\uff1a\u901a\u8fc7\u9ed8\u8ba4\u4f7f\u7528\u4e3b\u7ebf\u7a0b\uff0c\u5f00\u53d1\u8005\u65e0\u9700\u663e\u5f0f\u5207\u6362\u7ebf\u7a0b\u6765\u5904\u7406 UI \u66f4\u65b0\uff0c\u51cf\u5c11\u4e86\u4ee3\u7801\u590d\u6742\u6027\u3002</p> </li> </ol>"},{"location":"020Kotlin/020Coroutines/#_63","title":"\u5982\u4f55\u5207\u6362\u7ebf\u7a0b\uff1f","text":"<p>\u5982\u679c\u4f60\u9700\u8981\u5728\u534f\u7a0b\u4e2d\u6267\u884c\u8017\u65f6\u64cd\u4f5c\uff08\u5982\u7f51\u7edc\u8bf7\u6c42\u6216\u6570\u636e\u5e93\u67e5\u8be2\uff09\uff0c\u53ef\u4ee5\u4f7f\u7528 <code>withContext</code> \u5207\u6362\u5230\u5176\u4ed6\u8c03\u5ea6\u5668\uff08\u5982 <code>Dispatchers.IO</code>\uff09\uff1a</p> <pre><code>viewModelScope.launch {\n    // \u9ed8\u8ba4\u5728\u4e3b\u7ebf\u7a0b\u6267\u884c\n    val result = withContext(Dispatchers.IO) {\n        // \u5728 IO \u7ebf\u7a0b\u6267\u884c\u8017\u65f6\u64cd\u4f5c\n        performNetworkRequest()\n    }\n    // \u56de\u5230\u4e3b\u7ebf\u7a0b\u66f4\u65b0 UI\n    updateUI(result)\n}\n</code></pre>"},{"location":"020Kotlin/020Coroutines/#_64","title":"\u603b\u7ed3","text":"<ul> <li><code>viewModelScope.launch {}</code> \u9ed8\u8ba4\u5728\u4e3b\u7ebf\u7a0b\u8fd0\u884c\uff0c\u9002\u5408 UI \u66f4\u65b0\u3002</li> <li>\u8017\u65f6\u64cd\u4f5c\u5e94\u5207\u6362\u5230 <code>Dispatchers.IO</code> \u6216\u5176\u4ed6\u5408\u9002\u7684\u8c03\u5ea6\u5668\u3002</li> <li>\u4f7f\u7528 <code>withContext</code> \u53ef\u4ee5\u65b9\u4fbf\u5730\u5728\u4e0d\u540c\u7ebf\u7a0b\u95f4\u5207\u6362\u3002</li> </ul>"},{"location":"020Kotlin/020Coroutines/#job","title":"\u534f\u7a0b\u7236\u5b50job\u7684\u53d6\u6d88\u987a\u5e8f","text":"\u7b54\u6848"},{"location":"020Kotlin/020Coroutines/#job_1","title":"\u534f\u7a0b\u7236\u5b50 Job \u7684\u53d6\u6d88\u987a\u5e8f","text":"<p>\u5728 Kotlin \u534f\u7a0b\u4e2d\uff0c\u7236\u5b50 Job \u7684\u53d6\u6d88\u9075\u5faa\u7279\u5b9a\u7684\u987a\u5e8f\u89c4\u5219\uff1a</p>"},{"location":"020Kotlin/020Coroutines/#_65","title":"\u53d6\u6d88\u4f20\u64ad\u987a\u5e8f","text":"<ol> <li>\u7236 Job \u53d6\u6d88\u65f6\uff1a</li> <li>\u7236 Job \u53d6\u6d88\u4f1a\u81ea\u52a8\u53d6\u6d88\u6240\u6709\u5b50 Job</li> <li>\u53d6\u6d88\u662f\u4ece\u7236\u5411\u5b50\u4f20\u64ad\u7684\uff08\u81ea\u4e0a\u800c\u4e0b\uff09</li> <li> <p>\u7236 Job \u4f1a\u7b49\u5f85\u6240\u6709\u5b50 Job \u5b8c\u6210\u53d6\u6d88\u540e\uff0c\u81ea\u5df1\u624d\u6700\u7ec8\u5b8c\u6210\u53d6\u6d88</p> </li> <li> <p>\u5b50 Job \u53d6\u6d88\u65f6\uff1a</p> </li> <li>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u5b50 Job \u53d6\u6d88\u4e0d\u4f1a\u5f71\u54cd\u7236 Job</li> <li>\u4f46\u5982\u679c\u5b50 Job \u662f\u56e0\u5f02\u5e38\u800c\u53d6\u6d88\uff0c\u4e14\u6ca1\u6709\u88ab\u5904\u7406\uff0c\u5219\u5f02\u5e38\u4f1a\u4f20\u64ad\u5230\u7236 Job</li> </ol>"},{"location":"020Kotlin/020Coroutines/#_66","title":"\u4ee3\u7801\u793a\u4f8b","text":"<pre><code>val parentJob = launch {\n    val childJob1 = launch {\n        try {\n            delay(Long.MAX_VALUE)\n        } finally {\n            println(\"Child 1 cancelled\") // \u4f1a\u6267\u884c\n        }\n    }\n\n    val childJob2 = launch {\n        delay(100)\n        println(\"Child 2 throws exception\")\n        throw RuntimeException() // \u4f1a\u4f20\u64ad\u5230\u7236Job\n    }\n}\n\ndelay(200)\nparentJob.cancel() // \u4f1a\u5148\u53d6\u6d88childJob1\uff0c\u7136\u540e\u7b49\u5f85childJob2\u56e0\u5f02\u5e38\u53d6\u6d88\n</code></pre>"},{"location":"020Kotlin/020Coroutines/#_67","title":"\u91cd\u8981\u89c4\u5219","text":"<ul> <li>\u7ed3\u6784\u5316\u5e76\u53d1\u539f\u5219\uff1a\u7236\u534f\u7a0b\u603b\u662f\u4f1a\u7b49\u5f85\u6240\u6709\u5b50\u534f\u7a0b\u5b8c\u6210</li> <li>\u53d6\u6d88\u662f\u53cc\u5411\u7684\uff1a\u867d\u7136\u5b50Job\u53d6\u6d88\u9ed8\u8ba4\u4e0d\u5f71\u54cd\u7236Job\uff0c\u4f46\u901a\u8fc7\u5f02\u5e38\u53ef\u4ee5\u5b9e\u73b0\u5f71\u54cd</li> <li>\u5904\u7406\u5f02\u5e38\uff1a\u4f7f\u7528<code>SupervisorJob</code>\u6216<code>supervisorScope</code>\u53ef\u4ee5\u9632\u6b62\u5b50Job\u7684\u5f02\u5e38\u4f20\u64ad\u5230\u7236Job</li> </ul>"},{"location":"020Kotlin/020Coroutines/#_68","title":"\u6700\u4f73\u5b9e\u8df5","text":"<ul> <li>\u5728\u5b50\u534f\u7a0b\u7684<code>finally</code>\u5757\u4e2d\u6e05\u7406\u8d44\u6e90</li> <li>\u4f7f\u7528<code>NonCancellable</code>\u4e0a\u4e0b\u6587\u6267\u884c\u5fc5\u987b\u5b8c\u6210\u7684\u6e05\u7406\u64cd\u4f5c</li> <li>\u5bf9\u4e8e\u4e0d\u60f3\u88ab\u610f\u5916\u53d6\u6d88\u7684\u534f\u7a0b\uff0c\u4f7f\u7528<code>SupervisorJob</code></li> </ul>"},{"location":"020Kotlin/020Coroutines/#suspend","title":"Suspend\u5173\u952e\u5b57","text":"\u7b54\u6848"},{"location":"020Kotlin/020Coroutines/#kotlinsuspend","title":"Kotlin\u534f\u7a0b\u4e2d\u7684<code>suspend</code>\u5173\u952e\u5b57","text":"<p><code>suspend</code>\u662fKotlin\u534f\u7a0b\u4e2d\u4e00\u4e2a\u6838\u5fc3\u5173\u952e\u5b57\uff0c\u7528\u4e8e\u6807\u8bc6\u53ef\u6302\u8d77\u7684\u51fd\u6570\u3002\u4e0b\u9762\u6211\u5c06\u8be6\u7ec6\u4ecb\u7ecd\u5b83\u7684\u7528\u6cd5\u548c\u539f\u7406\u3002</p>"},{"location":"020Kotlin/020Coroutines/#_69","title":"\u57fa\u672c\u6982\u5ff5","text":"<ol> <li>\u6302\u8d77\u51fd\u6570(Suspend Function)</li> <li>\u7528<code>suspend</code>\u4fee\u9970\u7684\u51fd\u6570\u79f0\u4e3a\u6302\u8d77\u51fd\u6570</li> <li> <p>\u8fd9\u7c7b\u51fd\u6570\u53ef\u4ee5\u5728\u4e0d\u963b\u585e\u7ebf\u7a0b\u7684\u60c5\u51b5\u4e0b\u6682\u505c\u6267\u884c\uff0c\u5e76\u5728\u7a0d\u540e\u6062\u590d</p> </li> <li> <p>\u5173\u952e\u7279\u6027</p> </li> <li>\u53ea\u80fd\u5728\u534f\u7a0b\u6216\u5176\u4ed6\u6302\u8d77\u51fd\u6570\u4e2d\u8c03\u7528</li> <li>\u53ef\u4ee5\u8c03\u7528\u666e\u901a\u51fd\u6570\u6216\u5176\u4ed6\u6302\u8d77\u51fd\u6570</li> <li>\u6267\u884c\u65f6\u4e0d\u4f1a\u963b\u585e\u8c03\u7528\u5b83\u7684\u7ebf\u7a0b</li> </ol>"},{"location":"020Kotlin/020Coroutines/#_70","title":"\u57fa\u672c\u7528\u6cd5","text":"<pre><code>suspend fun fetchUserData(): User {\n    // \u6a21\u62df\u7f51\u7edc\u8bf7\u6c42\n    delay(1000) // delay\u4e5f\u662f\u4e00\u4e2a\u6302\u8d77\u51fd\u6570\n    return User(\"John\", 25)\n}\n</code></pre>"},{"location":"020Kotlin/020Coroutines/#_71","title":"\u5de5\u4f5c\u539f\u7406","text":"<ol> <li>\u72b6\u6001\u673a</li> <li>\u7f16\u8bd1\u5668\u4f1a\u5c06\u6302\u8d77\u51fd\u6570\u8f6c\u6362\u4e3a\u72b6\u6001\u673a</li> <li> <p>\u6bcf\u4e2a\u6302\u8d77\u70b9(suspension point)\u5bf9\u5e94\u4e00\u4e2a\u72b6\u6001</p> </li> <li> <p>Continuation</p> </li> <li>\u4f7f\u7528Continuation\u5bf9\u8c61\u4fdd\u5b58\u548c\u6062\u590d\u6267\u884c\u72b6\u6001</li> <li>\u6bcf\u6b21\u6302\u8d77\u65f6\u90fd\u4f1a\u4f20\u9012\u4e00\u4e2aContinuation\u53c2\u6570</li> </ol>"},{"location":"020Kotlin/020Coroutines/#_72","title":"\u5e38\u89c1\u4f7f\u7528\u573a\u666f","text":"<ol> <li> <p>\u7f51\u7edc\u8bf7\u6c42 <pre><code>suspend fun fetchDataFromApi(): Data {\n    return withContext(Dispatchers.IO) {\n        // \u7f51\u7edc\u8bf7\u6c42\u4ee3\u7801\n    }\n}\n</code></pre></p> </li> <li> <p>\u6570\u636e\u5e93\u64cd\u4f5c <pre><code>@Dao\ninterface UserDao {\n    @Insert\n    suspend fun insertUser(user: User)\n\n    @Query(\"SELECT * FROM user\")\n    suspend fun getAllUsers(): List&lt;User&gt;\n}\n</code></pre></p> </li> <li> <p>\u6587\u4ef6I/O\u64cd\u4f5c <pre><code>suspend fun readFile(file: File): String {\n    return withContext(Dispatchers.IO) {\n        file.readText()\n    }\n}\n</code></pre></p> </li> </ol>"},{"location":"020Kotlin/020Coroutines/#_73","title":"\u6ce8\u610f\u4e8b\u9879","text":"<ol> <li>\u8c03\u5ea6\u5668\u9009\u62e9</li> <li>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u6302\u8d77\u51fd\u6570\u4e0d\u4f1a\u81ea\u52a8\u5207\u6362\u5230\u5176\u4ed6\u7ebf\u7a0b</li> <li> <p>\u9700\u8981\u4f7f\u7528<code>withContext</code>\u660e\u786e\u6307\u5b9a\u8c03\u5ea6\u5668</p> </li> <li> <p>\u5f02\u5e38\u5904\u7406</p> </li> <li>\u53ef\u4ee5\u4f7f\u7528try-catch\u6355\u83b7\u6302\u8d77\u51fd\u6570\u4e2d\u7684\u5f02\u5e38</li> <li> <p>\u6216\u8005\u4f7f\u7528CoroutineExceptionHandler</p> </li> <li> <p>\u6027\u80fd\u8003\u8651</p> </li> <li>\u6302\u8d77\u64cd\u4f5c\u6bd4\u963b\u585e\u64cd\u4f5c\u66f4\u9ad8\u6548</li> <li>\u4f46\u9891\u7e41\u6302\u8d77/\u6062\u590d\u4e5f\u6709\u5f00\u9500\uff0c\u5e94\u5408\u7406\u8bbe\u8ba1</li> </ol>"},{"location":"020Kotlin/020Coroutines/#_74","title":"\u4e0e\u666e\u901a\u51fd\u6570\u5bf9\u6bd4","text":"\u7279\u6027 \u666e\u901a\u51fd\u6570 \u6302\u8d77\u51fd\u6570 \u963b\u585e\u6027 \u53ef\u80fd\u963b\u585e\u7ebf\u7a0b \u975e\u963b\u585e \u8c03\u7528\u9650\u5236 \u4efb\u4f55\u5730\u65b9\u53ef\u8c03\u7528 \u53ea\u80fd\u5728\u534f\u7a0b\u6216\u5176\u4ed6\u6302\u8d77\u51fd\u6570\u4e2d\u8c03\u7528 \u6267\u884c\u65b9\u5f0f \u7acb\u5373\u6267\u884c\u81f3\u5b8c\u6210 \u53ef\u6682\u505c\u548c\u6062\u590d \u7ebf\u7a0b\u4f7f\u7528 \u56fa\u5b9a\u5728\u4e00\u4e2a\u7ebf\u7a0b \u53ef\u5728\u4e0d\u540c\u7ebf\u7a0b\u95f4\u5207\u6362 <p><code>suspend</code>\u5173\u952e\u5b57\u662fKotlin\u534f\u7a0b\u5f3a\u5927\u80fd\u529b\u7684\u6838\u5fc3\uff0c\u5b83\u4f7f\u5f97\u5f02\u6b65\u4ee3\u7801\u53ef\u4ee5\u50cf\u540c\u6b65\u4ee3\u7801\u4e00\u6837\u7f16\u5199\uff0c\u5927\u5927\u7b80\u5316\u4e86\u5f02\u6b65\u7f16\u7a0b\u7684\u590d\u6742\u6027\u3002</p>"},{"location":"020Kotlin/020Coroutines/#suspend_1","title":"Suspend\u53cd\u7f16\u8bd1\uff0c\u4ee5\u53ca\u6e90\u7801\u5206\u6790","text":"\u7b80\u6d01\u7b54\u6848 \u8be6\u7ec6\u7b54\u6848 <p>suspend \u5173\u952e\u5b57\u662f Kotlin \u534f\u7a0b\u4e2d\u7684\u6838\u5fc3\u6982\u5ff5\uff0c\u5b83\u5141\u8bb8\u51fd\u6570\u6302\u8d77\u6267\u884c\u800c\u4e0d\u963b\u585e\u7ebf\u7a0b\u3002\u4ece\u6e90\u7801\u89d2\u5ea6\u770b\uff0c\u5176\u5b9e\u73b0\u76f8\u5f53\u7cbe\u5999\u3002</p> <p>suspend \u51fd\u6570\u5e95\u5c42\u5b9e\u73b0\u539f\u7406\u4e3b\u8981\u6d89\u53ca\u4ee5\u4e0b\u51e0\u4e2a\u65b9\u9762\uff1a</p> <ol> <li>\u7f16\u8bd1\u5668\u8f6c\u6362\uff1asuspend \u51fd\u6570\u5728\u7f16\u8bd1\u65f6\u4f1a\u88ab\u8f6c\u6362\u4e3a\u5e26\u6709 Continuation \u53c2\u6570\u7684\u666e\u901a\u51fd\u6570</li> <li>\u72b6\u6001\u673a\u5b9e\u73b0\uff1a\u7f16\u8bd1\u5668\u751f\u6210\u72b6\u6001\u673a\u4ee3\u7801\u6765\u7ba1\u7406\u6302\u8d77\u70b9\u548c\u6062\u590d\u6267\u884c</li> <li>CPS \u8f6c\u6362\uff1a\u91c7\u7528 Continuation-Passing Style \u7f16\u7a0b\u6a21\u5f0f</li> </ol>"},{"location":"020Kotlin/020Coroutines/#kotlin-suspend","title":"Kotlin suspend \u5173\u952e\u5b57\u5e95\u5c42\u539f\u7406","text":"<ol> <li> <p>\u7f16\u8bd1\u5668\u8f6c\u6362\uff1asuspend \u51fd\u6570\u88ab\u8f6c\u6362\u4e3a\u5e26\u6709\u989d\u5916 Continuation \u53c2\u6570\u7684\u666e\u901a\u51fd\u6570</p> </li> <li> <p>\u72b6\u6001\u673a\u751f\u6210\uff1a\u7f16\u8bd1\u5668\u4e3a\u6bcf\u4e2a suspend \u51fd\u6570\u751f\u6210\u72b6\u6001\u673a\uff0c\u6bcf\u4e2a\u6302\u8d77\u70b9\u5bf9\u5e94\u4e00\u4e2a\u72b6\u6001</p> </li> <li> <p>CPS \u53d8\u6362\uff1a\u91c7\u7528 Continuation-Passing Style \u6a21\u5f0f\uff0c\u5c06\u56de\u8c03\u8f6c\u6362\u4e3a\u987a\u5e8f\u4ee3\u7801</p> </li> <li> <p>\u6302\u8d77\u6807\u8bb0\uff1a\u901a\u8fc7\u8fd4\u56de COROUTINE_SUSPENDED \u7279\u6b8a\u5bf9\u8c61\u6765\u8868\u793a\u51fd\u6570\u5df2\u6302\u8d77</p> </li> <li> <p>\u72b6\u6001\u4fdd\u5b58\uff1a\u6302\u8d77\u524d\u4fdd\u5b58\u5f53\u524d\u6267\u884c\u72b6\u6001\u548c\u5c40\u90e8\u53d8\u91cf\u5230\u72b6\u6001\u673a\u5bf9\u8c61\u4e2d</p> </li> <li> <p>\u6062\u590d\u673a\u5236\uff1a\u5916\u90e8\u64cd\u4f5c\u5b8c\u6210\u540e\u901a\u8fc7 continuation.resume() \u6062\u590d\u6267\u884c\uff0c\u72b6\u6001\u673a\u6839\u636e\u4fdd\u5b58\u7684\u72b6\u6001\u8df3\u8f6c\u5230\u6b63\u786e\u4f4d\u7f6e\u7ee7\u7eed\u6267\u884c</p> </li> <li> <p>\u975e\u963b\u585e\uff1a\u6574\u4e2a\u8fc7\u7a0b\u4e0d\u4f1a\u963b\u585e\u7ebf\u7a0b\uff0c\u6302\u8d77\u51fd\u6570\u53ea\u662f\u6682\u505c\u6267\u884c\u5e76\u91ca\u653e\u7ebf\u7a0b\u8d44\u6e90</p> </li> </ol> <p>\u672c\u8d28\u4e0a\uff0csuspend \u662f\u4e00\u79cd\u7f16\u8bd1\u65f6\u8f6c\u6362\u6280\u672f\uff0c\u4f7f\u5f02\u6b65\u4ee3\u7801\u53ef\u4ee5\u7528\u987a\u5e8f\u65b9\u5f0f\u7f16\u5199\uff0c\u800c\u65e0\u9700\u4f7f\u7528\u56de\u8c03\u6216Promise\u94fe\u3002</p>"},{"location":"020Kotlin/020Coroutines/#_75","title":"\u7f16\u8bd1\u5668\u8f6c\u6362","text":"<p>\u5f53\u4f60\u5b9a\u4e49\u4e00\u4e2a suspend \u51fd\u6570\u65f6\uff1a</p> <pre><code>suspend fun doSomething(param: String): Result\n</code></pre> <p>Kotlin \u7f16\u8bd1\u5668\u4f1a\u5c06\u5b83\u8f6c\u6362\u4e3a\uff1a</p> <pre><code>fun doSomething(param: String, continuation: Continuation&lt;Result&gt;): Any?\n</code></pre> <p>\u6dfb\u52a0\u7684 <code>continuation</code> \u53c2\u6570\u7528\u4e8e\u6062\u590d\u6302\u8d77\u540e\u7684\u6267\u884c\uff0c\u8fd4\u56de\u7c7b\u578b <code>Any?</code> \u53ef\u80fd\u662f\u5b9e\u9645\u7ed3\u679c\u6216\u7279\u6b8a\u7684 <code>COROUTINE_SUSPENDED</code> \u6807\u8bb0\u5bf9\u8c61\u3002</p>"},{"location":"020Kotlin/020Coroutines/#_76","title":"\u72b6\u6001\u673a\u5b9e\u73b0","text":"<p>\u7f16\u8bd1\u5668\u4f1a\u4e3a\u6bcf\u4e2a suspend \u51fd\u6570\u751f\u6210\u4e00\u4e2a\u72b6\u6001\u673a\u3002\u6bcf\u4e2a\u6302\u8d77\u70b9\u5bf9\u5e94\u72b6\u6001\u673a\u7684\u4e00\u4e2a\u72b6\u6001\uff0c\u51fd\u6570\u6062\u590d\u65f6\u4f1a\u6839\u636e\u72b6\u6001\u8df3\u8f6c\u5230\u5bf9\u5e94\u4f4d\u7f6e\u7ee7\u7eed\u6267\u884c\u3002</p> <p>\u4f8b\u5982\uff0c\u8003\u8651\u4ee5\u4e0b\u51fd\u6570\uff1a</p> <pre><code>suspend fun complexFunction() {\n    val data1 = networkCall1() // \u6302\u8d77\u70b91\n    val data2 = networkCall2(data1) // \u6302\u8d77\u70b92\n    return processData(data1, data2)\n}\n</code></pre> <p>\u7f16\u8bd1\u5668\u4f1a\u5c06\u5176\u8f6c\u6362\u4e3a\u7c7b\u4f3c\u8fd9\u6837\u7684\u72b6\u6001\u673a\u4ee3\u7801\uff1a</p> <pre><code>fun complexFunction(continuation: Continuation&lt;Result&gt;): Any? {\n    val sm = continuation as? ComplexFunctionStateMachine ?: \n            ComplexFunctionStateMachine(continuation)\n\n    when (sm.label) {\n        0 -&gt; {\n            sm.label = 1\n            return networkCall1(sm) // \u53ef\u80fd\u8fd4\u56deCOROUTINE_SUSPENDED\n        }\n        1 -&gt; {\n            val data1 = sm.result as Data1\n            sm.data1 = data1\n            sm.label = 2\n            return networkCall2(data1, sm) // \u53ef\u80fd\u8fd4\u56deCOROUTINE_SUSPENDED\n        }\n        2 -&gt; {\n            val data1 = sm.data1\n            val data2 = sm.result as Data2\n            return processData(data1, data2) // \u6b63\u5e38\u8fd4\u56de\u7ed3\u679c\n        }\n        else -&gt; error(\"Invalid state\")\n    }\n}\n</code></pre>"},{"location":"020Kotlin/020Coroutines/#_77","title":"\u6838\u5fc3\u6e90\u7801\u5206\u6790","text":"<p>Kotlin \u534f\u7a0b\u7684\u6838\u5fc3\u7c7b\u5b9a\u4e49\u5728 <code>kotlinx.coroutines</code> \u5305\u4e2d\uff1a</p>"},{"location":"020Kotlin/020Coroutines/#continuation","title":"Continuation \u63a5\u53e3","text":"<pre><code>public interface Continuation&lt;in T&gt; {\n    public val context: CoroutineContext\n    public fun resumeWith(result: Result&lt;T&gt;)\n}\n</code></pre> <p>\u8fd9\u662f\u534f\u7a0b\u6062\u590d\u6267\u884c\u7684\u6838\u5fc3\u63a5\u53e3\uff0c\u4efb\u4f55\u6302\u8d77\u540e\u7684\u6062\u590d\u90fd\u901a\u8fc7\u5b83\u8fdb\u884c\u3002</p>"},{"location":"020Kotlin/020Coroutines/#suspendcoroutine","title":"suspendCoroutine \u51fd\u6570","text":"<p>\u5b9e\u9645\u6302\u8d77\u64cd\u4f5c\u901a\u5e38\u901a\u8fc7 <code>suspendCoroutine</code> \u51fd\u6570\u5b9e\u73b0\uff1a</p> <pre><code>public suspend inline fun &lt;T&gt; suspendCoroutine(\n    crossinline block: (Continuation&lt;T&gt;) -&gt; Unit\n): T = suspendCoroutineUninterceptedOrReturn { continuation -&gt;\n    block(continuation)\n    COROUTINE_SUSPENDED\n}\n</code></pre> <p>\u8fd9\u4e2a\u51fd\u6570\u5141\u8bb8\u83b7\u53d6\u5f53\u524d\u7684 Continuation \u5bf9\u8c61\uff0c\u5e76\u5728\u9002\u5f53\u65f6\u673a\u6062\u590d\u6267\u884c\u3002</p>"},{"location":"020Kotlin/020Coroutines/#coroutine_suspended","title":"COROUTINE_SUSPENDED \u6807\u8bb0","text":"<pre><code>@SinceKotlin(\"1.3\")\npublic val COROUTINE_SUSPENDED: Any = CoroutineSingletons.COROUTINE_SUSPENDED\n</code></pre> <p>\u8fd9\u662f\u4e00\u4e2a\u7279\u6b8a\u503c\uff0c\u7528\u4e8e\u8868\u793a\u51fd\u6570\u5df2\u6302\u8d77\u3002\u5f53\u51fd\u6570\u8fd4\u56de\u8fd9\u4e2a\u503c\u65f6\uff0c\u8c03\u5ea6\u5668\u77e5\u9053\u534f\u7a0b\u5df2\u6302\u8d77\uff0c\u5e76\u4e14\u4e4b\u540e\u9700\u8981\u901a\u8fc7 Continuation \u6765\u6062\u590d\u3002</p>"},{"location":"020Kotlin/020Coroutines/#_78","title":"\u5b9e\u9645\u4f8b\u5b50\u5206\u6790","text":"<p>\u8ba9\u6211\u4eec\u770b\u4e00\u4e2a\u5177\u4f53\u4f8b\u5b50\uff0c\u5206\u6790\u7f16\u8bd1\u5668\u5982\u4f55\u5c06 suspend \u51fd\u6570\u8f6c\u6362\u4e3a\u72b6\u6001\u673a\uff1a</p> <pre><code>suspend fun fetchUserData(userId: String): UserData {\n    val token = getAuthToken() // \u6302\u8d77\u70b91\n    val userData = apiService.fetchUser(userId, token) // \u6302\u8d77\u70b92\n    return userData\n}\n</code></pre> <p>\u7f16\u8bd1\u540e\u7684\u4ee3\u7801\u7c7b\u4f3c\u4e8e\uff1a</p> <pre><code>fun fetchUserData(userId: String, $completion: Continuation&lt;UserData&gt;): Any? {\n    class FetchUserDataSM(completion: Continuation&lt;UserData&gt;) : \n        ContinuationImpl(completion) {\n        var result: Any? = null\n        var label = 0\n        var userId: String? = null\n        var token: String? = null\n\n        override fun invokeSuspend(result: Any?): Any? {\n            this.result = result\n            return fetchUserData(userId!!, this)\n        }\n    }\n\n    // \u68c0\u67e5\u662f\u5426\u662f\u6062\u590d\u8c03\u7528\n    val sm = if ($completion is FetchUserDataSM) $completion \n            else FetchUserDataSM($completion)\n\n    var current: Any?\n\n    when (sm.label) {\n        0 -&gt; {\n            sm.userId = userId\n            sm.label = 1\n            current = getAuthToken(sm)\n            if (current === COROUTINE_SUSPENDED) return COROUTINE_SUSPENDED\n        }\n        1 -&gt; {\n            sm.token = sm.result as String\n            sm.label = 2\n            current = apiService.fetchUser(sm.userId!!, sm.token!!, sm)\n            if (current === COROUTINE_SUSPENDED) return COROUTINE_SUSPENDED\n        }\n        2 -&gt; {\n            return sm.result as UserData\n        }\n        else -&gt; throw IllegalStateException(\"Invalid state\")\n    }\n    // \u5904\u7406\u76f4\u63a5\u8fd4\u56de\u7684\u60c5\u51b5\uff08\u4e0d\u6302\u8d77\uff09\n    return current\n}\n</code></pre>"},{"location":"020Kotlin/020Coroutines/#_79","title":"\u603b\u7ed3","text":"<p>Kotlin \u4e2d suspend \u51fd\u6570\u7684\u6302\u8d77\u673a\u5236\u4e3b\u8981\u4f9d\u9760\uff1a</p> <ol> <li>\u7f16\u8bd1\u65f6\u8f6c\u6362\uff1asuspend \u51fd\u6570\u53d8\u6210\u5e26 Continuation \u53c2\u6570\u7684\u666e\u901a\u51fd\u6570</li> <li>\u72b6\u6001\u673a\uff1a\u7ba1\u7406\u51fd\u6570\u5185\u591a\u4e2a\u6302\u8d77\u70b9\u7684\u6267\u884c\u72b6\u6001</li> <li>CPS \u53d8\u6362\uff1a\u901a\u8fc7\u56de\u8c03\u5f0f\u7f16\u7a0b\u5b9e\u73b0\u63a7\u5236\u6d41\u7684\u8f6c\u79fb</li> <li>COROUTINE_SUSPENDED \u6807\u8bb0\uff1a\u8868\u793a\u51fd\u6570\u5df2\u6302\u8d77\u7b49\u5f85\u6062\u590d</li> </ol> <p>\u8fd9\u79cd\u8bbe\u8ba1\u4f7f\u5f97\u534f\u7a0b\u53ef\u4ee5\u5728\u4e0d\u963b\u585e\u7ebf\u7a0b\u7684\u60c5\u51b5\u4e0b\u5b9e\u73b0\u5f02\u6b65\u7f16\u7a0b\uff0c\u5927\u5927\u7b80\u5316\u4e86\u5f02\u6b65\u4ee3\u7801\u7684\u7f16\u5199\u548c\u7ef4\u62a4\u3002</p> <p>\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u8fd9\u4e9b\u8f6c\u6362\u90fd\u662f\u7531 Kotlin \u7f16\u8bd1\u5668\u81ea\u52a8\u5b8c\u6210\u7684\uff0c\u5f00\u53d1\u8005\u901a\u5e38\u4e0d\u9700\u8981\u76f4\u63a5\u4e0e\u8fd9\u4e9b\u5e95\u5c42\u673a\u5236\u4ea4\u4e92\u3002</p> <p>\u8bf7\u95eesuspend\u5e95\u5c42\u662f\u5982\u4f55\u5207\u6362when\u91cc\u9762\u7684\u6761\u4ef6\u7684\uff1f\u4ee5\u53ca\u5e95\u5c42\u5982\u4f55\u77e5\u9053\u4ec0\u4e48\u65f6\u5019\u6302\u8d77\uff1f\u6bd4\u5982\u4e00\u4e2aRetrofit\u7684\u8bf7\u6c42\u3002</p> <p>\u5f88\u597d\u7684\u95ee\u9898\uff01\u8ba9\u6211\u6765\u8be6\u7ec6\u89e3\u91ca suspend \u51fd\u6570\u5e95\u5c42\u662f\u5982\u4f55\u5b9e\u73b0\u72b6\u6001\u5207\u6362\u4ee5\u53ca\u5982\u4f55\u77e5\u9053\u4f55\u65f6\u6302\u8d77\u7684\uff0c\u7279\u522b\u662f\u5728 Retrofit \u7f51\u7edc\u8bf7\u6c42\u8fd9\u6837\u7684\u573a\u666f\u4e2d\u3002</p>"},{"location":"020Kotlin/020Coroutines/#suspend_2","title":"suspend \u51fd\u6570\u7684\u72b6\u6001\u5207\u6362\u673a\u5236","text":"<p>\u72b6\u6001\u673a\u4e2d <code>when</code> \u8bed\u53e5\u7684\u6761\u4ef6\u5207\u6362\u662f\u901a\u8fc7 <code>label</code> \u5b57\u6bb5\u5b9e\u73b0\u7684\uff1a</p> <ol> <li>\u6807\u7b7e\u66f4\u65b0\u673a\u5236\uff1a</li> <li>\u6bcf\u6b21\u6267\u884c\u5230\u6302\u8d77\u70b9\u524d\uff0c\u72b6\u6001\u673a\u4f1a\u5148\u5c06 <code>label</code> \u66f4\u65b0\u4e3a\u4e0b\u4e00\u4e2a\u72b6\u6001\u503c</li> <li> <p>\u8fd9\u6837\u5f53\u51fd\u6570\u6062\u590d\u6267\u884c\u65f6\uff0c\u5c31\u77e5\u9053\u4ece\u54ea\u4e2a\u72b6\u6001\u7ee7\u7eed</p> </li> <li> <p>\u6062\u590d\u6267\u884c\u6d41\u7a0b\uff1a</p> </li> <li>\u5f53\u6302\u8d77\u7684\u64cd\u4f5c\u5b8c\u6210\u65f6\uff0c\u4f1a\u8c03\u7528 <code>continuation.resume(result)</code> \u6216 <code>continuation.resumeWithException(error)</code></li> <li>\u8fd9\u4e9b\u8c03\u7528\u6700\u7ec8\u4f1a\u89e6\u53d1\u524d\u9762\u521b\u5efa\u7684\u72b6\u6001\u673a\u5bf9\u8c61\u7684 <code>invokeSuspend</code> \u65b9\u6cd5</li> <li><code>invokeSuspend</code> \u518d\u6b21\u8c03\u7528\u539f\u59cb\u51fd\u6570\uff0c\u4f46\u7531\u4e8e <code>label</code> \u5df2\u7ecf\u88ab\u66f4\u65b0\uff0c\u4f1a\u8fdb\u5165\u4e0d\u540c\u7684 <code>when</code> \u5206\u652f</li> </ol>"},{"location":"020Kotlin/020Coroutines/#_80","title":"\u6302\u8d77\u5224\u65ad\u673a\u5236","text":"<p>\u5173\u4e8e\u5982\u4f55\u77e5\u9053\u4f55\u65f6\u6302\u8d77\uff0c\u8fd9\u6d89\u53ca\u5230 <code>COROUTINE_SUSPENDED</code> \u6807\u8bb0\uff1a</p> <ol> <li>\u6302\u8d77\u70b9\u8bc6\u522b\uff1a</li> <li>\u5f53\u4e00\u4e2a\u51fd\u6570\u9700\u8981\u6302\u8d77\u65f6\uff0c\u5b83\u4f1a\u8fd4\u56de\u7279\u6b8a\u7684 <code>COROUTINE_SUSPENDED</code> \u5bf9\u8c61</li> <li> <p>\u72b6\u6001\u673a\u68c0\u67e5\u8fd4\u56de\u503c\uff0c\u5982\u679c\u662f\u8fd9\u4e2a\u7279\u6b8a\u6807\u8bb0\uff0c\u5c31\u77e5\u9053\u5f53\u524d\u64cd\u4f5c\u5df2\u6302\u8d77</p> </li> <li> <p>\u975e\u6302\u8d77\u60c5\u51b5\uff1a</p> </li> <li>\u5982\u679c\u64cd\u4f5c\u80fd\u7acb\u5373\u5b8c\u6210\uff08\u4f8b\u5982\u7f13\u5b58\u547d\u4e2d\uff09\uff0c\u6302\u8d77\u51fd\u6570\u53ef\u80fd\u76f4\u63a5\u8fd4\u56de\u7ed3\u679c\u800c\u4e0d\u662f <code>COROUTINE_SUSPENDED</code></li> <li>\u6b64\u65f6\uff0c\u72b6\u6001\u673a\u4f1a\u7acb\u5373\u5904\u7406\u7ed3\u679c\u5e76\u7ee7\u7eed\u6267\u884c\uff0c\u800c\u4e0d\u4f1a\u53d1\u751f\u5b9e\u9645\u7684\u6302\u8d77</li> </ol>"},{"location":"020Kotlin/020Coroutines/#retrofit","title":"Retrofit \u8bf7\u6c42\u7684\u6302\u8d77\u673a\u5236","text":"<p>\u4ee5 Retrofit \u7684\u534f\u7a0b\u652f\u6301\u4e3a\u4f8b\uff0c\u5f53\u4f60\u5b9a\u4e49\uff1a</p> <pre><code>interface ApiService {\n    @GET(\"users/{userId}\")\n    suspend fun getUser(@Path(\"userId\") userId: String): User\n}\n</code></pre> <p>\u5b9e\u9645\u7684\u6302\u8d77\u8fc7\u7a0b\u5982\u4e0b\uff1a</p> <ol> <li> <p>Retrofit \u9002\u914d\u5668\u8f6c\u6362\uff1a Retrofit \u7684 <code>CoroutineCallAdapterFactory</code> \u4f1a\u521b\u5efa\u4e00\u4e2a\u5c06\u666e\u901a <code>Call&lt;T&gt;</code> \u8f6c\u6362\u4e3a suspend \u51fd\u6570\u7684\u9002\u914d\u5668\u3002</p> </li> <li> <p>\u6302\u8d77\u5b9e\u73b0\uff1a \u5e95\u5c42\u5b9e\u73b0\u7c7b\u4f3c\u4e8e\uff1a</p> </li> </ol> <pre><code>suspend fun getUser(userId: String): User = suspendCancellableCoroutine { continuation -&gt;\n    // \u521b\u5efa\u666e\u901a\u7684 Retrofit Call \u5bf9\u8c61\n    val call = retrofitService.getUserCall(userId)\n\n    // \u8bbe\u7f6e\u56de\u8c03\n    call.enqueue(object : Callback&lt;User&gt; {\n        override fun onResponse(call: Call&lt;User&gt;, response: Response&lt;User&gt;) {\n            if (response.isSuccessful) {\n                // \u6210\u529f\u65f6\u6062\u590d\u534f\u7a0b\u6267\u884c\n                continuation.resume(response.body()!!)\n            } else {\n                // \u9519\u8bef\u54cd\u5e94\u65f6\u4ee5\u5f02\u5e38\u6062\u590d\n                continuation.resumeWithException(HttpException(response))\n            }\n        }\n\n        override fun onFailure(call: Call&lt;User&gt;, t: Throwable) {\n            // \u8bf7\u6c42\u5931\u8d25\u65f6\u4ee5\u5f02\u5e38\u6062\u590d\n            continuation.resumeWithException(t)\n        }\n    })\n\n    // \u6ce8\u518c\u53d6\u6d88\u56de\u8c03\n    continuation.invokeOnCancellation {\n        call.cancel()\n    }\n}\n</code></pre> <ol> <li>\u5173\u952e\u70b9\uff1a</li> <li><code>suspendCancellableCoroutine</code> \u51fd\u6570\u5185\u90e8\u4f1a\u8fd4\u56de <code>COROUTINE_SUSPENDED</code>\uff0c\u544a\u8bc9\u72b6\u6001\u673a\u5f53\u524d\u534f\u7a0b\u5df2\u6302\u8d77</li> <li>Retrofit \u5c06\u5f02\u6b65\u7684\u56de\u8c03\u673a\u5236\u8fde\u63a5\u5230\u534f\u7a0b\u7684 <code>Continuation</code></li> <li>\u7f51\u7edc\u8bf7\u6c42\u5b8c\u6210\u540e\uff0c\u901a\u8fc7 <code>continuation.resume()</code> \u6062\u590d\u534f\u7a0b\u6267\u884c</li> </ol>"},{"location":"020Kotlin/020Coroutines/#_81","title":"\u5b8c\u6574\u6d41\u7a0b\u793a\u4f8b","text":"<p>\u5047\u8bbe\u6211\u4eec\u6709\u4e00\u4e2a\u5305\u542b Retrofit \u8bf7\u6c42\u7684\u51fd\u6570\uff1a</p> <pre><code>suspend fun getUserData(id: String): UserProfile {\n    val token = authRepository.getToken() // \u6302\u8d77\u70b91\n    val user = apiService.getUser(id, token) // \u6302\u8d77\u70b92\n    return processUserData(user)\n}\n</code></pre> <p>\u7f16\u8bd1\u5668\u751f\u6210\u7684\u72b6\u6001\u673a\u5927\u81f4\u5982\u4e0b\uff1a</p> <pre><code>fun getUserData(id: String, continuation: Continuation&lt;UserProfile&gt;): Any? {\n    val sm = continuation as? GetUserDataSM ?: GetUserDataSM(continuation)\n\n    var current: Any?\n\n    when (sm.label) {\n        0 -&gt; {\n            // \u51c6\u5907\u8fdb\u5165\u6302\u8d77\u70b91\n            sm.id = id\n            sm.label = 1 // \u66f4\u65b0\u72b6\u6001\uff0c\u4e3a\u6062\u590d\u505a\u51c6\u5907\n            current = authRepository.getToken(sm)\n            if (current === COROUTINE_SUSPENDED) {\n                // \u771f\u7684\u6302\u8d77\u4e86\uff0c\u8fd4\u56de\u6807\u8bb0\n                return COROUTINE_SUSPENDED\n            }\n            // \u6ca1\u6302\u8d77\uff0c\u7ee7\u7eed\u6267\u884c\n        }\n        1 -&gt; {\n            // \u4ece\u6302\u8d77\u70b91\u6062\u590d\uff0c\u83b7\u53d6\u4e4b\u524d\u4fdd\u5b58\u7684id\n            id = sm.id\n            // \u83b7\u53d6\u6302\u8d77\u70b91\u7684\u7ed3\u679c\n            val token = sm.result as String\n            // \u51c6\u5907\u8fdb\u5165\u6302\u8d77\u70b92\n            sm.token = token\n            sm.label = 2 // \u66f4\u65b0\u72b6\u6001\n            current = apiService.getUser(id, token, sm)\n            if (current === COROUTINE_SUSPENDED) {\n                return COROUTINE_SUSPENDED\n            }\n            // \u6ca1\u6302\u8d77\uff0c\u7ee7\u7eed\u6267\u884c\n        }\n        2 -&gt; {\n            // \u4ece\u6302\u8d77\u70b92\u6062\u590d\uff0c\u83b7\u53d6\u7ed3\u679c\n            val user = sm.result as User\n            // \u6267\u884c\u6700\u540e\u7684\u5904\u7406\u5e76\u8fd4\u56de\u7ed3\u679c\n            return processUserData(user)\n        }\n    }\n\n    return current // \u5904\u7406\u975e\u6302\u8d77\u60c5\u51b5\u7684\u7ed3\u679c\n}\n</code></pre> <p>\u5f53 Retrofit \u8bf7\u6c42\u5b8c\u6210\u65f6\uff0c\u5b83\u4f1a\u8c03\u7528 <code>continuation.resume(user)</code>\uff0c\u8fd9\u4f1a\u89e6\u53d1\u72b6\u6001\u673a\u7684 <code>invokeSuspend</code> \u65b9\u6cd5\uff0c\u8fdb\u800c\u518d\u6b21\u8c03\u7528 <code>getUserData</code> \u51fd\u6570\uff0c\u4f46\u8fd9\u6b21\u4f1a\u8fdb\u5165 <code>label = 2</code> \u7684\u5206\u652f\u3002</p> <p>\u8fd9\u5c31\u662f Kotlin \u534f\u7a0b\u80fd\u591f\u5728\u4fdd\u6301\u987a\u5e8f\u4ee3\u7801\u98ce\u683c\u7684\u540c\u65f6\u5b9e\u73b0\u975e\u963b\u585e\u5f02\u6b65\u64cd\u4f5c\u7684\u6838\u5fc3\u539f\u7406\u3002</p> <p>\u90a3\u8bf7\u95ee\u5982\u4f55\u6211\u53ea\u662f\u5728suspend\u51fd\u6570\u91cc\u9762delay(1000) ,\u8fd9\u4e2a\u65f6\u5019\u53cd\u7f16\u8bd1\u540e\u7684\u4ee3\u7801\u662f\u4ec0\u4e48\u6837\u5b50\uff0c\u4ee5\u53ca\u5982\u4f55\u8fd4\u56de\u7684COROUTINE_SUSPENDED</p> <p>\u8ba9\u6211\u8be6\u7ec6\u89e3\u91ca <code>delay(1000)</code> \u5728 suspend \u51fd\u6570\u4e2d\u7684\u53cd\u7f16\u8bd1\u4ee3\u7801\u53ca\u5176\u6302\u8d77\u673a\u5236\u3002</p>"},{"location":"020Kotlin/020Coroutines/#suspend-delay","title":"suspend \u51fd\u6570\u4e2d delay \u7684\u53cd\u7f16\u8bd1\u4ee3\u7801","text":"<p>\u5047\u8bbe\u6211\u4eec\u6709\u8fd9\u6837\u4e00\u4e2a\u7b80\u5355\u7684\u6302\u8d77\u51fd\u6570\uff1a</p> <pre><code>suspend fun delayedGreeting(name: String): String {\n    println(\"Starting greeting for $name\")\n    delay(1000) // \u6302\u8d77\u70b9\n    return \"Hello, $name!\"\n}\n</code></pre> <p>\u53cd\u7f16\u8bd1\u540e\u7684\u4ee3\u7801\u5927\u81f4\u4f1a\u662f\u8fd9\u6837\u7684\u7ed3\u6784\uff1a</p> <pre><code>fun delayedGreeting(name: String, $completion: Continuation&lt;String&gt;): Any? {\n    // \u72b6\u6001\u673a\u5b9e\u73b0\u7c7b\n    class DelayedGreetingSM(completion: Continuation&lt;String&gt;) : ContinuationImpl(completion) {\n        // \u72b6\u6001\u53d8\u91cf\n        var result: Any? = null\n        var label = 0\n        var name: String? = null\n\n        override fun invokeSuspend(result: Object?): Any? {\n            this.result = result\n            return delayedGreeting(this.name!!, this)\n        }\n    }\n\n    // \u83b7\u53d6\u6216\u521b\u5efa\u72b6\u6001\u673a\u5b9e\u4f8b\n    val sm = if ($completion is DelayedGreetingSM) $completion else DelayedGreetingSM($completion)\n\n    var result: Any?\n\n    when (sm.label) {\n        0 -&gt; {\n            // \u9996\u6b21\u6267\u884c\n            sm.name = name  // \u4fdd\u5b58\u53c2\u6570\n            println(\"Starting greeting for $name\")\n            sm.label = 1    // \u66f4\u65b0\u72b6\u6001\u4e3a\u4e0b\u4e00\u4e2a\n            result = delay(1000, sm)  // \u8c03\u7528 delay \u51fd\u6570\n            if (result === COROUTINE_SUSPENDED) return COROUTINE_SUSPENDED\n            // \u5982\u679c\u6ca1\u6709\u6302\u8d77\uff0c\u7ee7\u7eed\u6267\u884c\uff08\u7f55\u89c1\u60c5\u51b5\uff09\n        }\n        1 -&gt; {\n            // \u4ece delay \u6062\u590d\u540e\u6267\u884c\n            name = sm.name as String  // \u6062\u590d\u4e4b\u524d\u4fdd\u5b58\u7684\u53c2\u6570\n            // \u7ee7\u7eed\u6267\u884c delay \u540e\u7684\u4ee3\u7801\n            return \"Hello, $name!\"\n        }\n        else -&gt; throw IllegalStateException(\"Invalid state\")\n    }\n\n    // \u5904\u7406 delay \u7acb\u5373\u8fd4\u56de\u7684\u60c5\u51b5\uff08\u5b9e\u9645\u4e0a\u51e0\u4e4e\u4e0d\u4f1a\u53d1\u751f\uff09\n    return \"Hello, $name!\"\n}\n</code></pre>"},{"location":"020Kotlin/020Coroutines/#delay-coroutine_suspended","title":"delay \u51fd\u6570\u5982\u4f55\u8fd4\u56de COROUTINE_SUSPENDED","text":"<p><code>delay</code> \u51fd\u6570\u662f\u534f\u7a0b\u5e93\u4e2d\u7684\u57fa\u7840\u6302\u8d77\u51fd\u6570\uff0c\u5b83\u5728\u5e95\u5c42\u5b9e\u73b0\u4e2d\u4f1a\u4f7f\u7528\u5b9a\u65f6\u5668\u6216\u8c03\u5ea6\u5668\u6765\u5b9e\u73b0\u5ef6\u8fdf\u3002\u8ba9\u6211\u4eec\u770b\u770b <code>delay</code> \u7684\u7b80\u5316\u5b9e\u73b0\uff1a</p> <pre><code>public suspend fun delay(timeMillis: Long): Unit = suspendCancellableCoroutine { cont -&gt;\n    // \u521b\u5efa\u5ef6\u8fdf\u4efb\u52a1\n    val timeoutCoroutine = DelayedCoroutine(cont)\n\n    // \u6ce8\u518c\u5ef6\u8fdf\u6267\u884c\u7684\u4efb\u52a1\n    if (timeMillis &lt;= 0) {\n        // \u5982\u679c\u65f6\u95f4\u4e3a0\u6216\u8d1f\u6570\uff0c\u7acb\u5373\u6062\u590d\n        timeoutCoroutine.resume(Unit)\n    } else {\n        // \u5426\u5219\uff0c\u6ce8\u518c\u4e00\u4e2a\u5b9a\u65f6\u5668\u4efb\u52a1\n        val timer = DefaultDelay.scheduleResumeAfterDelay(timeMillis, timeoutCoroutine)\n\n        // \u5728\u534f\u7a0b\u53d6\u6d88\u65f6\u53d6\u6d88\u5b9a\u65f6\u5668\n        cont.invokeOnCancellation { timer.cancel() }\n    }\n}\n</code></pre> <p>\u6838\u5fc3\u673a\u5236\u5728\u4e8e <code>suspendCancellableCoroutine</code> \u51fd\u6570\uff0c\u5b83\u505a\u4e86\u4ee5\u4e0b\u5de5\u4f5c\uff1a</p> <ol> <li>\u83b7\u53d6\u5f53\u524d\u7684 <code>Continuation</code> \u5bf9\u8c61</li> <li>\u5c06\u5b83\u5305\u88c5\u4e3a <code>CancellableContinuation</code></li> <li>\u5728\u5185\u90e8\u7acb\u5373\u8fd4\u56de <code>COROUTINE_SUSPENDED</code> \u6807\u8bb0</li> <li>\u63d0\u4f9b lambda \u5757\u8ba9\u4f60\u53ef\u4ee5\u63a7\u5236\u4f55\u65f6\u6062\u590d\u6267\u884c</li> </ol> <pre><code>public suspend inline fun &lt;T&gt; suspendCancellableCoroutine(\n    crossinline block: (CancellableContinuation&lt;T&gt;) -&gt; Unit\n): T = suspendCoroutineUninterceptedOrReturn { uCont -&gt;\n    // \u5c06\u666e\u901a Continuation \u5305\u88c5\u4e3a CancellableContinuation\n    val cancellable = CancellableContinuationImpl(uCont.intercepted(), resumeMode = MODE_CANCELLABLE)\n\n    // \u521d\u59cb\u5316\n    cancellable.initCancellability()\n\n    // \u8c03\u7528\u63d0\u4f9b\u7684\u4ee3\u7801\u5757\n    block(cancellable)\n\n    // \u8fd4\u56de\u6807\u8bb0\u6216\u7ed3\u679c\n    cancellable.getResult()\n}\n</code></pre> <p>\u800c <code>getResult()</code> \u5b9e\u73b0\u662f\uff1a</p> <pre><code>internal fun getResult(): Any? {\n    // \u68c0\u67e5\u662f\u5426\u5df2\u7ecf\u5b8c\u6210\n    if (trySuspend()) return COROUTINE_SUSPENDED\n    // \u5df2\u5b8c\u6210\u7684\u8bdd\u76f4\u63a5\u8fd4\u56de\u7ed3\u679c\n    return getSuccessfulResult(state)\n}\n</code></pre> <p><code>trySuspend()</code> \u4f1a\u68c0\u67e5\u5f53\u524d\u72b6\u6001\uff0c\u5982\u679c\u6302\u8d77\u64cd\u4f5c\u8fd8\u6ca1\u6709\u5b8c\u6210\uff0c\u5c31\u8fd4\u56de <code>true</code>\uff0c\u8fdb\u800c\u8ba9 <code>getResult()</code> \u8fd4\u56de <code>COROUTINE_SUSPENDED</code>\u3002</p>"},{"location":"020Kotlin/020Coroutines/#_82","title":"\u5b9a\u65f6\u5668\u5982\u4f55\u6062\u590d\u6267\u884c","text":"<p>\u5bf9\u4e8e <code>delay</code>\uff0c\u534f\u7a0b\u5e93\u4f1a\u4f7f\u7528\u5e73\u53f0\u7279\u5b9a\u7684\u5b9a\u65f6\u5668\u5b9e\u73b0\uff1a</p> <ol> <li>\u5728 JVM \u5e73\u53f0\u4e0a\uff1a\u4f7f\u7528 <code>ScheduledExecutorService</code> \u6216 <code>java.util.concurrent.Delay</code></li> <li>\u5728 JavaScript \u5e73\u53f0\uff1a\u4f7f\u7528 <code>setTimeout</code></li> <li>\u5728 Native \u5e73\u53f0\uff1a\u4f7f\u7528\u5e73\u53f0\u7279\u5b9a\u7684\u5b9a\u65f6\u5668\u5b9e\u73b0</li> </ol> <p>\u4ee5 JVM \u5e73\u53f0\u4e3a\u4f8b\uff0c<code>scheduleResumeAfterDelay</code> \u7684\u5b9e\u73b0\u7c7b\u4f3c\u4e8e\uff1a</p> <pre><code>fun scheduleResumeAfterDelay(delayMillis: Long, continuation: CancellableContinuation&lt;Unit&gt;) {\n    val timerTask = schedule(delayMillis) {\n        // \u5b9a\u65f6\u5668\u89e6\u53d1\u65f6\u6062\u590d\u534f\u7a0b\u6267\u884c\n        with(continuation) { \n            resumeUndispatched(Unit) \n        }\n    }\n    return timerTask\n}\n</code></pre> <p>\u5f53\u5b9a\u65f6\u5668\u89e6\u53d1\u65f6\uff0c\u5b83\u4f1a\u8c03\u7528 <code>continuation.resume(Unit)</code>\uff0c\u8fd9\u4f1a\uff1a</p> <ol> <li>\u5c06 continuation \u7684\u72b6\u6001\u8bbe\u4e3a\u5b8c\u6210</li> <li>\u91cd\u65b0\u5206\u6d3e\u534f\u7a0b\u7ee7\u7eed\u6267\u884c</li> <li>\u6700\u7ec8\u8c03\u7528\u72b6\u6001\u673a\u7684 <code>invokeSuspend</code> \u65b9\u6cd5</li> <li>\u72b6\u6001\u673a\u4f1a\u518d\u6b21\u8c03\u7528\u539f\u51fd\u6570\uff0c\u4f46\u8fd9\u6b21\u72b6\u6001\u503c\u662f <code>1</code>\uff0c\u56e0\u6b64\u4f1a\u8fdb\u5165 <code>when</code> \u8bed\u53e5\u7684\u7b2c\u4e8c\u4e2a\u5206\u652f</li> </ol>"},{"location":"020Kotlin/020Coroutines/#_83","title":"\u6574\u4f53\u6d41\u7a0b\u603b\u7ed3","text":"<p>\u5f53\u6267\u884c <code>delay(1000)</code> \u65f6\uff1a</p> <ol> <li>\u7f16\u8bd1\u8f6c\u6362\uff1a<code>delay(1000)</code> \u5b9e\u9645\u4e0a\u4f1a\u88ab\u8f6c\u6362\u4e3a\u5e26\u6709 continuation \u53c2\u6570\u7684\u8c03\u7528</li> <li>\u6302\u8d77\u8fc7\u7a0b\uff1a</li> <li><code>delay</code> \u5185\u90e8\u4f7f\u7528 <code>suspendCancellableCoroutine</code></li> <li>\u8be5\u51fd\u6570\u521b\u5efa\u5b9a\u65f6\u5668\u4efb\u52a1</li> <li>\u5e76\u7acb\u5373\u8fd4\u56de <code>COROUTINE_SUSPENDED</code> \u544a\u77e5\u72b6\u6001\u673a\u5df2\u6302\u8d77</li> <li>\u6062\u590d\u8fc7\u7a0b\uff1a</li> <li>1000\u6beb\u79d2\u540e\u5b9a\u65f6\u5668\u89e6\u53d1</li> <li>\u5b9a\u65f6\u5668\u8c03\u7528 <code>continuation.resume(Unit)</code></li> <li>\u534f\u7a0b\u8c03\u5ea6\u5668\u91cd\u65b0\u6fc0\u6d3b\u534f\u7a0b</li> <li>\u72b6\u6001\u673a\u4ece <code>label=1</code> \u7684\u5206\u652f\u7ee7\u7eed\u6267\u884c</li> </ol> <p>\u8fd9\u79cd\u673a\u5236\u4f7f <code>delay</code> \u51fd\u6570\u80fd\u591f\u5728\u4e0d\u963b\u585e\u7ebf\u7a0b\u7684\u60c5\u51b5\u4e0b\u5b9e\u73b0\u65f6\u95f4\u5ef6\u8fdf\uff0c\u540c\u65f6\u4fdd\u6301\u4ee3\u7801\u7684\u987a\u5e8f\u6027\u548c\u53ef\u8bfb\u6027\u3002</p>"},{"location":"020Kotlin/020Coroutines/#androidscope","title":"Android\u4e2d\u7684\u5404\u79cdScope","text":"\u7b54\u6848"},{"location":"020Kotlin/020Coroutines/#android-kotlin-scope","title":"Android Kotlin \u534f\u7a0b\u7684 Scope \u53ca\u7ebf\u7a0b\u5206\u5e03","text":"<p>\u5728 Android \u5f00\u53d1\u4e2d\uff0cKotlin \u534f\u7a0b\u7684\u4f5c\u7528\u57df(Scope)\u975e\u5e38\u91cd\u8981\uff0c\u5b83\u4eec\u51b3\u5b9a\u4e86\u534f\u7a0b\u7684\u751f\u547d\u5468\u671f\u548c\u8fd0\u884c\u7684\u7ebf\u7a0b\u4e0a\u4e0b\u6587\u3002\u4ee5\u4e0b\u662f\u4e3b\u8981\u7684\u534f\u7a0b Scope \u53ca\u5176\u7ebf\u7a0b\u7279\u6027\uff1a</p>"},{"location":"020Kotlin/020Coroutines/#1-scope-globalscope","title":"1. \u5168\u5c40 Scope (GlobalScope)","text":"<ul> <li>\u7279\u70b9\uff1a\u4e0e\u5e94\u7528\u8fdb\u7a0b\u540c\u751f\u547d\u5468\u671f\uff0c\u4e0d\u63a8\u8350\u5728\u5e38\u89c4 Android \u5f00\u53d1\u4e2d\u4f7f\u7528</li> <li>\u7ebf\u7a0b\uff1a\u53d6\u51b3\u4e8e\u542f\u52a8\u65f6\u6307\u5b9a\u7684 Dispatcher</li> <li>\u9ed8\u8ba4\u4f7f\u7528 <code>Dispatchers.Default</code>\uff08\u7ebf\u7a0b\u6c60\uff0c\u9002\u5408 CPU \u5bc6\u96c6\u578b\u4efb\u52a1\uff09</li> </ul> <pre><code>GlobalScope.launch { // \u8fd0\u884c\u5728 Dispatchers.Default\n    // \u534f\u7a0b\u4f53\n}\n</code></pre>"},{"location":"020Kotlin/020Coroutines/#2-viewmodel-scope-viewmodelscope","title":"2. ViewModel Scope (viewModelScope)","text":"<ul> <li>\u7279\u70b9\uff1a\u4e0e ViewModel \u751f\u547d\u5468\u671f\u7ed1\u5b9a\uff0cViewModel \u9500\u6bc1\u65f6\u81ea\u52a8\u53d6\u6d88</li> <li>\u7ebf\u7a0b\uff1a\u9ed8\u8ba4\u4f7f\u7528 <code>Dispatchers.Main</code>\uff08\u4e3b\u7ebf\u7a0b\uff09</li> </ul> <pre><code>viewModelScope.launch { // \u9ed8\u8ba4\u5728\u4e3b\u7ebf\u7a0b\n    // \u534f\u7a0b\u4f53\n}\n</code></pre>"},{"location":"020Kotlin/020Coroutines/#3-lifecycle-scope-lifecyclescope","title":"3. Lifecycle Scope (lifecycleScope)","text":"<ul> <li>\u7279\u70b9\uff1a\u4e0e LifecycleOwner\uff08\u5982 Activity\u3001Fragment\uff09\u751f\u547d\u5468\u671f\u7ed1\u5b9a</li> <li>\u7ebf\u7a0b\uff1a\u9ed8\u8ba4\u4f7f\u7528 <code>Dispatchers.Main</code>\uff08\u4e3b\u7ebf\u7a0b\uff09</li> </ul> <pre><code>lifecycleScope.launch { // \u9ed8\u8ba4\u5728\u4e3b\u7ebf\u7a0b\n    // \u534f\u7a0b\u4f53\n}\n</code></pre>"},{"location":"020Kotlin/020Coroutines/#4-livedata-scope-livedata","title":"4. LiveData Scope (liveData { ... })","text":"<ul> <li>\u7279\u70b9\uff1a\u4e0e LiveData \u751f\u547d\u5468\u671f\u7ed1\u5b9a</li> <li>\u7ebf\u7a0b\uff1a\u9ed8\u8ba4\u5728 <code>Dispatchers.Main.immediate</code> \u6267\u884c\uff0c\u4f46\u6784\u5efa\u5668\u5757\u5728\u4e3b\u7ebf\u7a0b\u5916\u6267\u884c</li> </ul> <pre><code>val data = liveData {\n    // \u8fd9\u6bb5\u4ee3\u7801\u5728\u540e\u53f0\u7ebf\u7a0b\u6267\u884c\n    emit(loadData()) \n}\n</code></pre>"},{"location":"020Kotlin/020Coroutines/#5-coroutinescope","title":"5. \u81ea\u5b9a\u4e49 CoroutineScope","text":"<p>\u53ef\u4ee5\u521b\u5efa\u81ea\u5b9a\u4e49 Scope \u5e76\u6307\u5b9a\u8c03\u5ea6\u5668\uff1a</p> <pre><code>val myScope = CoroutineScope(Dispatchers.IO + SupervisorJob())\n\nmyScope.launch { // \u8fd0\u884c\u5728 IO \u7ebf\u7a0b\u6c60\n    // \u534f\u7a0b\u4f53\n}\n</code></pre>"},{"location":"020Kotlin/020Coroutines/#dispatcher","title":"\u5e38\u7528 Dispatcher \u53ca\u5176\u7ebf\u7a0b","text":"Dispatcher \u7ebf\u7a0b\u7c7b\u578b \u9002\u7528\u573a\u666f Dispatchers.Main \u4e3b\u7ebf\u7a0b UI \u66f4\u65b0\u3001\u8f7b\u91cf\u7ea7\u64cd\u4f5c Dispatchers.Default CPU \u5bc6\u96c6\u578b\u7ebf\u7a0b\u6c60 \u8ba1\u7b97\u5bc6\u96c6\u578b\u4efb\u52a1 Dispatchers.IO IO \u4f18\u5316\u7ebf\u7a0b\u6c60 \u6587\u4ef6\u3001\u7f51\u7edc IO \u64cd\u4f5c Dispatchers.Unconfined \u4e0d\u9650\u5b9a\u7ebf\u7a0b \u4e0d\u63a8\u8350\u5e38\u89c4\u4f7f\u7528 <p>\u5728 Android \u5f00\u53d1\u4e2d\uff0c\u63a8\u8350\u4f7f\u7528 <code>viewModelScope</code> \u6216 <code>lifecycleScope</code> \u800c\u975e <code>GlobalScope</code>\uff0c\u4ee5\u907f\u514d\u5185\u5b58\u6cc4\u6f0f\u548c\u66f4\u597d\u7684\u751f\u547d\u5468\u671f\u7ba1\u7406\u3002</p>"},{"location":"020Kotlin/020Coroutines/#lifecyclescope","title":"LifeCycleScope\u6e90\u7801\u89e3\u6790","text":"\u7b54\u6848"},{"location":"020Kotlin/020Coroutines/#android-jetpack-lifecyclescope","title":"Android Jetpack lifecycleScope \u6e90\u7801\u5206\u6790","text":"<p><code>lifecycleScope</code> \u662f Android Jetpack \u4e2d Kotlin \u534f\u7a0b\u7684\u4e00\u4e2a\u91cd\u8981\u6269\u5c55\uff0c\u5b83\u5141\u8bb8\u5f00\u53d1\u8005\u5728\u7279\u5b9a\u7684\u751f\u547d\u5468\u671f\u8303\u56f4\u5185\u542f\u52a8\u534f\u7a0b\u3002\u4e0b\u9762\u6211\u5c06\u4ece\u6e90\u7801\u89d2\u5ea6\u6df1\u5165\u5206\u6790\u5176\u5b9e\u73b0\u539f\u7406\u3002</p>"},{"location":"020Kotlin/020Coroutines/#1_7","title":"1. \u57fa\u672c\u6982\u5ff5","text":"<p><code>lifecycleScope</code> \u662f <code>LifecycleOwner</code> \u7684\u4e00\u4e2a\u6269\u5c55\u5c5e\u6027\uff0c\u5b83\u4e3a\u6bcf\u4e2a <code>LifecycleOwner</code> \u63d0\u4f9b\u4e86\u4e00\u4e2a <code>CoroutineScope</code>\uff0c\u5f53 <code>Lifecycle</code> \u88ab\u9500\u6bc1\u65f6\uff0c\u6240\u6709\u5728\u6b64\u8303\u56f4\u5185\u542f\u52a8\u7684\u534f\u7a0b\u90fd\u4f1a\u81ea\u52a8\u53d6\u6d88\u3002</p>"},{"location":"020Kotlin/020Coroutines/#2_6","title":"2. \u6e90\u7801\u4f4d\u7f6e","text":"<p><code>lifecycleScope</code> \u7684\u4e3b\u8981\u5b9e\u73b0\u4f4d\u4e8e\uff1a - <code>androidx.lifecycle:lifecycle-runtime-ktx</code> \u5e93\u4e2d - \u4e3b\u8981\u7c7b\uff1a<code>LifecycleController.kt</code> \u548c <code>Lifecycle.kt</code></p>"},{"location":"020Kotlin/020Coroutines/#3_6","title":"3. \u6838\u5fc3\u5b9e\u73b0\u5206\u6790","text":""},{"location":"020Kotlin/020Coroutines/#31-lifecyclescope","title":"3.1 lifecycleScope \u6269\u5c55\u5c5e\u6027","text":"<pre><code>public val LifecycleOwner.lifecycleScope: LifecycleCoroutineScope\n    get() = lifecycle.coroutineScope\n</code></pre> <p>\u8fd9\u662f\u4e00\u4e2a\u6269\u5c55\u5c5e\u6027\uff0c\u901a\u8fc7 <code>LifecycleOwner</code> \u83b7\u53d6\u5176 <code>lifecycle</code> \u7684 <code>coroutineScope</code>\u3002</p>"},{"location":"020Kotlin/020Coroutines/#32-lifecyclecoroutinescope","title":"3.2 Lifecycle.coroutineScope \u5b9e\u73b0","text":"<pre><code>public val Lifecycle.coroutineScope: LifecycleCoroutineScope\n    get() {\n        while (true) {\n            val existing = mInternalScopeRef.get() as LifecycleCoroutineScopeImpl?\n            if (existing != null) {\n                return existing\n            }\n            val newScope = LifecycleCoroutineScopeImpl(\n                this,\n                SupervisorJob() + Dispatchers.Main.immediate\n            )\n            if (mInternalScopeRef.compareAndSet(null, newScope)) {\n                newScope.register()\n                return newScope\n            }\n        }\n    }\n</code></pre> <p>\u5173\u952e\u70b9\uff1a 1. \u4f7f\u7528\u539f\u5b50\u5f15\u7528 <code>mInternalScopeRef</code> \u786e\u4fdd\u7ebf\u7a0b\u5b89\u5168 2. \u5982\u679c\u5df2\u6709 scope \u5219\u76f4\u63a5\u8fd4\u56de 3. \u5426\u5219\u521b\u5efa\u65b0\u7684 <code>LifecycleCoroutineScopeImpl</code> - \u4f7f\u7528 <code>SupervisorJob()</code> \u9632\u6b62\u5b50\u534f\u7a0b\u5931\u8d25\u5f71\u54cd\u7236\u534f\u7a0b - \u9ed8\u8ba4\u4f7f\u7528 <code>Dispatchers.Main.immediate</code> \u8c03\u5ea6\u5668 4. \u901a\u8fc7 CAS (Compare-And-Swap) \u64cd\u4f5c\u786e\u4fdd\u53ea\u6709\u4e00\u4e2a scope \u88ab\u521b\u5efa 5. \u8c03\u7528 <code>register()</code> \u65b9\u6cd5\u6ce8\u518c\u751f\u547d\u5468\u671f\u89c2\u5bdf</p>"},{"location":"020Kotlin/020Coroutines/#33-lifecyclecoroutinescopeimpl","title":"3.3 LifecycleCoroutineScopeImpl \u7c7b","text":"<pre><code>internal class LifecycleCoroutineScopeImpl(\n    override val lifecycle: Lifecycle,\n    override val coroutineContext: CoroutineContext\n) : LifecycleCoroutineScope(), LifecycleEventObserver {\n\n    init {\n        // \u5982\u679c\u751f\u547d\u5468\u671f\u5df2\u7ecf\u9500\u6bc1\uff0c\u7acb\u5373\u53d6\u6d88scope\n        if (lifecycle.currentState == Lifecycle.State.DESTROYED) {\n            coroutineContext.cancel()\n        }\n    }\n\n    fun register() {\n        launch(Dispatchers.Main.immediate) {\n            if (lifecycle.currentState &gt;= Lifecycle.State.INITIALIZED) {\n                lifecycle.addObserver(this@LifecycleCoroutineScopeImpl)\n            } else {\n                coroutineContext.cancel()\n            }\n        }\n    }\n\n    override fun onStateChanged(source: LifecycleOwner, event: Lifecycle.Event) {\n        if (lifecycle.currentState &lt;= Lifecycle.State.DESTROYED) {\n            lifecycle.removeObserver(this)\n            coroutineContext.cancel()\n        }\n    }\n}\n</code></pre> <p>\u5173\u952e\u70b9\uff1a 1. \u5b9e\u73b0\u4e86 <code>LifecycleEventObserver</code> \u63a5\u53e3\u6765\u76d1\u542c\u751f\u547d\u5468\u671f\u53d8\u5316 2. \u5728\u521d\u59cb\u5316\u65f6\u68c0\u67e5\u5982\u679c\u5df2\u7ecf\u662f DESTROYED \u72b6\u6001\uff0c\u5219\u7acb\u5373\u53d6\u6d88\u534f\u7a0b\u4f5c\u7528\u57df 3. <code>register()</code> \u65b9\u6cd5\u5728 Main \u8c03\u5ea6\u5668\u4e0a\u6ce8\u518c\u751f\u547d\u5468\u671f\u89c2\u5bdf\u8005 4. \u5f53\u751f\u547d\u5468\u671f\u72b6\u6001\u53d8\u4e3a DESTROYED \u6216\u66f4\u4f4e\u65f6\uff1a - \u79fb\u9664\u89c2\u5bdf\u8005 - \u53d6\u6d88\u534f\u7a0b\u4f5c\u7528\u57df</p>"},{"location":"020Kotlin/020Coroutines/#34","title":"3.4 \u81ea\u52a8\u53d6\u6d88\u673a\u5236","text":"<p>\u5f53 <code>Lifecycle</code> \u8fdb\u5165 <code>DESTROYED</code> \u72b6\u6001\u65f6\uff1a 1. <code>onStateChanged</code> \u88ab\u8c03\u7528 2. \u8c03\u7528 <code>coroutineContext.cancel()</code> \u53d6\u6d88\u6240\u6709\u5b50\u534f\u7a0b 3. \u79fb\u9664\u81ea\u8eab\u89c2\u5bdf\u8005</p>"},{"location":"020Kotlin/020Coroutines/#4_8","title":"4. \u4f7f\u7528\u793a\u4f8b\u7684\u5e95\u5c42\u884c\u4e3a","text":"<p>\u5f53\u5f00\u53d1\u8005\u8fd9\u6837\u4f7f\u7528\uff1a</p> <pre><code>lifecycleScope.launch {\n    // \u505a\u4e00\u4e9b\u5de5\u4f5c\n}\n</code></pre> <p>\u5b9e\u9645\u53d1\u751f\uff1a 1. \u534f\u7a0b\u88ab\u7ed1\u5b9a\u5230 <code>lifecycleScope</code> \u7684 <code>Job</code> \u4e0a 2. \u534f\u7a0b\u9ed8\u8ba4\u5728 <code>Dispatchers.Main.immediate</code> \u4e0a\u8fd0\u884c 3. \u5f53 <code>Lifecycle</code> \u88ab\u9500\u6bc1\u65f6\uff0c\u6240\u6709\u5b50\u534f\u7a0b\u90fd\u4f1a\u88ab\u81ea\u52a8\u53d6\u6d88</p>"},{"location":"020Kotlin/020Coroutines/#5_2","title":"5. \u8bbe\u8ba1\u4f18\u52bf","text":"<ol> <li>\u751f\u547d\u5468\u671f\u611f\u77e5\uff1a\u81ea\u52a8\u4e0e\u7ec4\u4ef6\u751f\u547d\u5468\u671f\u7ed1\u5b9a</li> <li>\u5185\u5b58\u5b89\u5168\uff1a\u9632\u6b62\u751f\u547d\u5468\u671f\u7ed3\u675f\u540e\u534f\u7a0b\u6cc4\u6f0f</li> <li>\u7ebf\u7a0b\u5b89\u5168\uff1a\u4f7f\u7528\u539f\u5b50\u64cd\u4f5c\u786e\u4fdd\u6b63\u786e\u521d\u59cb\u5316</li> <li>\u7075\u6d3b\u7684\u8c03\u5ea6\uff1a\u9ed8\u8ba4\u5728\u4e3b\u7ebf\u7a0b\u4f46\u53ef\u4ee5\u8f7b\u677e\u5207\u6362</li> <li>\u7ed3\u6784\u5316\u5e76\u53d1\uff1a\u652f\u6301\u534f\u7a0b\u7684\u7236\u5b50\u5173\u7cfb</li> </ol>"},{"location":"020Kotlin/020Coroutines/#6","title":"6. \u6ce8\u610f\u4e8b\u9879","text":"<ol> <li><code>lifecycleScope</code> \u9ed8\u8ba4\u5728\u4e3b\u7ebf\u7a0b\u8c03\u5ea6\uff0cCPU \u5bc6\u96c6\u578b\u5de5\u4f5c\u5e94\u660e\u786e\u6307\u5b9a\u5176\u4ed6\u8c03\u5ea6\u5668</li> <li>\u5728 <code>DESTROYED</code> \u72b6\u6001\u540e\u5c1d\u8bd5\u542f\u52a8\u65b0\u534f\u7a0b\u4f1a\u629b\u51fa <code>CancellationException</code></li> <li>\u6bcf\u4e2a <code>LifecycleOwner</code> \u53ea\u6709\u4e00\u4e2a <code>lifecycleScope</code> \u5b9e\u4f8b</li> </ol> <p>\u901a\u8fc7\u8fd9\u79cd\u8bbe\u8ba1\uff0cAndroid \u56e2\u961f\u4e3a\u5f00\u53d1\u8005\u63d0\u4f9b\u4e86\u4e00\u79cd\u5b89\u5168\u3001\u4fbf\u6377\u7684\u65b9\u5f0f\u6765\u5728 Android \u751f\u547d\u5468\u671f\u4e2d\u7ba1\u7406\u534f\u7a0b\u3002</p>"},{"location":"020Kotlin/020Coroutines/#viewmodelscope","title":"ViewModelScope\u6e90\u7801\u89e3\u6790","text":"\u7b54\u6848"},{"location":"020Kotlin/020Coroutines/#android-jetpack-viewmodelscope","title":"Android Jetpack ViewModelScope \u6e90\u7801\u5206\u6790","text":"<p><code>viewModelScope</code> \u662f Android Jetpack \u4e2d\u4e0e ViewModel \u5173\u8054\u7684 Kotlin \u534f\u7a0b\u4f5c\u7528\u57df(CoroutineScope)\uff0c\u5b83\u4f1a\u5728 ViewModel \u6e05\u9664\u65f6\u81ea\u52a8\u53d6\u6d88\u6240\u6709\u5b50\u534f\u7a0b\uff0c\u9632\u6b62\u5185\u5b58\u6cc4\u6f0f\u3002\u4e0b\u9762\u4ece\u6e90\u7801\u89d2\u5ea6\u5206\u6790\u5176\u5b9e\u73b0\u539f\u7406\u3002</p>"},{"location":"020Kotlin/020Coroutines/#1_8","title":"1. \u57fa\u672c\u4f7f\u7528","text":"<pre><code>class MyViewModel : ViewModel() {\n    fun fetchData() {\n        viewModelScope.launch {\n            // \u5728\u8fd9\u91cc\u6267\u884c\u534f\u7a0b\u4ee3\u7801\n        }\n    }\n}\n</code></pre>"},{"location":"020Kotlin/020Coroutines/#2_7","title":"2. \u6e90\u7801\u5b9e\u73b0","text":""},{"location":"020Kotlin/020Coroutines/#21-viewmodelscope","title":"2.1 viewModelScope \u58f0\u660e","text":"<p>\u5728 <code>androidx.lifecycle.ViewModel</code> \u7c7b\u4e2d\uff1a</p> <pre><code>public abstract class ViewModel {\n    @Suppress(\"WeakerAccess\")\n    val viewModelScope: CoroutineScope\n}\n</code></pre>"},{"location":"020Kotlin/020Coroutines/#22-viewmodel","title":"2.2 \u5177\u4f53\u5b9e\u73b0 - ViewModel \u6269\u5c55","text":"<p>\u5b9e\u9645\u5b9e\u73b0\u5728 <code>androidx.lifecycle.viewmodel-ktx</code> \u5e93\u4e2d\uff0c\u901a\u8fc7 Kotlin \u6269\u5c55\u5c5e\u6027\u5b9e\u73b0\uff1a</p> <pre><code>val ViewModel.viewModelScope: CoroutineScope\n    get() {\n        val scope: CoroutineScope? = this.getTag(JOB_KEY)\n        if (scope != null) {\n            return scope\n        }\n        return setTagIfAbsent(\n            JOB_KEY,\n            CloseableCoroutineScope(SupervisorJob() + Dispatchers.Main.immediate)\n        )\n    }\n</code></pre>"},{"location":"020Kotlin/020Coroutines/#23","title":"2.3 \u5173\u952e\u7ec4\u4ef6","text":"<ol> <li>JOB_KEY: \u7528\u4e8e\u5728 ViewModel \u7684\u5b58\u50a8\u4e2d\u6807\u8bc6\u534f\u7a0b\u4f5c\u7528\u57df</li> </ol> <pre><code>private const val JOB_KEY = \"androidx.lifecycle.ViewModelCoroutineScope.JOB_KEY\"\n</code></pre> <ol> <li>CloseableCoroutineScope: \u4e00\u4e2a\u53ef\u5173\u95ed\u7684\u534f\u7a0b\u4f5c\u7528\u57df\u5b9e\u73b0</li> </ol> <pre><code>internal class CloseableCoroutineScope(context: CoroutineContext) : Closeable, CoroutineScope {\n    override val coroutineContext: CoroutineContext = context\n\n    override fun close() {\n        coroutineContext.cancel()\n    }\n}\n</code></pre>"},{"location":"020Kotlin/020Coroutines/#24-viewmodel","title":"2.4 \u4e0e ViewModel \u751f\u547d\u5468\u671f\u7ed1\u5b9a","text":"<p>\u5728 <code>ViewModel</code> \u7684 <code>clear()</code> \u65b9\u6cd5\u4e2d\uff1a</p> <pre><code>@MainThread\nfinal void clear() {\n    mCleared = true;\n    if (mBagOfTags != null) {\n        synchronized (mBagOfTags) {\n            for (Object value : mBagOfTags.values()) {\n                closeWithRuntimeException(value);\n            }\n        }\n    }\n    onCleared();\n}\n</code></pre> <p><code>closeWithRuntimeException()</code> \u65b9\u6cd5\u4f1a\u68c0\u67e5\u5bf9\u8c61\u662f\u5426\u5b9e\u73b0\u4e86 <code>Closeable</code> \u63a5\u53e3\uff0c\u5982\u679c\u662f\u5219\u8c03\u7528\u5176 <code>close()</code> \u65b9\u6cd5\uff1a</p> <pre><code>private static void closeWithRuntimeException(Object obj) {\n    if (obj instanceof Closeable) {\n        try {\n            ((Closeable) obj).close();\n        } catch (IOException e) {\n            throw new RuntimeException(e);\n        }\n    }\n}\n</code></pre> <p>\u7531\u4e8e\u6211\u4eec\u7684 <code>CloseableCoroutineScope</code> \u5b9e\u73b0\u4e86 <code>Closeable</code> \u63a5\u53e3\uff0c\u5f53 ViewModel \u88ab\u6e05\u9664\u65f6\uff0c\u534f\u7a0b\u4f5c\u7528\u57df\u4f1a\u88ab\u81ea\u52a8\u5173\u95ed\uff0c\u6240\u6709\u5b50\u534f\u7a0b\u90fd\u4f1a\u88ab\u53d6\u6d88\u3002</p>"},{"location":"020Kotlin/020Coroutines/#25","title":"2.5 \u534f\u7a0b\u4e0a\u4e0b\u6587\u914d\u7f6e","text":"<p><code>viewModelScope</code> \u4f7f\u7528\u4ee5\u4e0b\u534f\u7a0b\u4e0a\u4e0b\u6587\u914d\u7f6e\uff1a</p> <ul> <li>SupervisorJob(): \u5141\u8bb8\u5b50\u534f\u7a0b\u72ec\u7acb\u5931\u8d25\u800c\u4e0d\u5f71\u54cd\u5176\u4ed6\u5b50\u534f\u7a0b</li> <li>Dispatchers.Main.immediate: \u9ed8\u8ba4\u5728\u4e3b\u7ebf\u7a0b\u8c03\u5ea6\uff0cimmediate \u8868\u793a\u7acb\u5373\u6267\u884c\uff08\u5982\u679c\u5df2\u7ecf\u5728\u4e3b\u7ebf\u7a0b\uff09</li> </ul>"},{"location":"020Kotlin/020Coroutines/#3_7","title":"3. \u8bbe\u8ba1\u4f18\u52bf","text":"<ol> <li>\u81ea\u52a8\u751f\u547d\u5468\u671f\u7ba1\u7406: \u65e0\u9700\u624b\u52a8\u53d6\u6d88\u534f\u7a0b\uff0c\u907f\u514d\u5185\u5b58\u6cc4\u6f0f</li> <li>\u7ed3\u6784\u5316\u5e76\u53d1: \u6240\u6709\u542f\u52a8\u7684\u534f\u7a0b\u90fd\u662f ViewModel \u751f\u547d\u5468\u671f\u7684\u5b50\u534f\u7a0b</li> <li>\u9ed8\u8ba4\u4e3b\u7ebf\u7a0b\u8c03\u5ea6: \u9002\u5408 UI \u64cd\u4f5c</li> <li>\u72ec\u7acb\u5931\u8d25\u673a\u5236: \u4e00\u4e2a\u534f\u7a0b\u7684\u5931\u8d25\u4e0d\u4f1a\u5f71\u54cd\u5176\u4ed6\u534f\u7a0b</li> </ol>"},{"location":"020Kotlin/020Coroutines/#4_9","title":"4. \u6ce8\u610f\u4e8b\u9879","text":"<ol> <li>\u4e0d\u8981\u5728 <code>viewModelScope</code> \u4e2d\u542f\u52a8\u957f\u65f6\u95f4\u8fd0\u884c\u7684\u540e\u53f0\u4efb\u52a1\uff0c\u8003\u8651\u4f7f\u7528\u5176\u4ed6\u4f5c\u7528\u57df\u6216 <code>Dispatchers.IO</code></li> <li>\u534f\u7a0b\u53d6\u6d88\u662f\u534f\u4f5c\u5f0f\u7684\uff0c\u9700\u8981\u68c0\u67e5 <code>isActive</code> \u6216\u5904\u7406 <code>CancellationException</code></li> <li>\u5728\u6d4b\u8bd5\u4e2d\u9700\u8981\u66ff\u6362 <code>Dispatchers.Main</code>\uff0c\u53ef\u4ee5\u4f7f\u7528 <code>Dispatchers.setMain()</code> \u65b9\u6cd5</li> </ol> <p>\u901a\u8fc7\u8fd9\u79cd\u8bbe\u8ba1\uff0c<code>viewModelScope</code> \u4e3a ViewModel \u63d0\u4f9b\u4e86\u5b89\u5168\u3001\u4fbf\u6377\u7684\u534f\u7a0b\u96c6\u6210\u65b9\u6848\uff0c\u5927\u5927\u7b80\u5316\u4e86 Android \u5f00\u53d1\u4e2d\u7684\u5f02\u6b65\u7f16\u7a0b\u3002</p>"},{"location":"020Kotlin/020Coroutines/#livedatascope","title":"LiveDataScope\u6e90\u7801\u89e3\u6790","text":"\u7b54\u6848"},{"location":"020Kotlin/020Coroutines/#android-jetpack-livedatascope","title":"Android Jetpack LiveDataScope \u6e90\u7801\u5206\u6790","text":"<p>LiveDataScope \u662f Kotlin \u534f\u7a0b\u4e0e LiveData \u4e4b\u95f4\u7684\u6865\u6881\uff0c\u5c5e\u4e8e <code>androidx.lifecycle:lifecycle-livedata-ktx</code> \u5e93\u7684\u4e00\u90e8\u5206\u3002\u4e0b\u9762\u4ece\u6e90\u7801\u89d2\u5ea6\u5206\u6790\u5176\u5b9e\u73b0\u539f\u7406\u3002</p>"},{"location":"020Kotlin/020Coroutines/#_84","title":"\u57fa\u672c\u6982\u5ff5","text":"<p>LiveDataScope \u662f\u4e00\u4e2a\u63a5\u53e3\uff0c\u4e3b\u8981\u7528\u4e8e\u5728 <code>liveData { ... }</code> \u6784\u5efa\u5668\u5757\u4e2d\u4f7f\u7528\uff0c\u5141\u8bb8\u5f00\u53d1\u8005\u4ee5\u534f\u7a0b\u7684\u65b9\u5f0f\u751f\u6210 LiveData \u6570\u636e\u3002</p>"},{"location":"020Kotlin/020Coroutines/#_85","title":"\u6838\u5fc3\u6e90\u7801\u5206\u6790","text":""},{"location":"020Kotlin/020Coroutines/#1-livedatascope","title":"1. LiveDataScope \u63a5\u53e3","text":"<pre><code>public interface LiveDataScope&lt;T&gt; {\n    /**\n    * \u53d1\u5c04\u4e00\u4e2a\u503c\u5230LiveData\u4e2d\n    */\n    public suspend fun emit(value: T)\n\n    /**\n    * \u53d1\u5c04\u6700\u65b0\u503c\u5230LiveData\u4e2d\n    */\n    public suspend fun emitSource(source: LiveData&lt;T&gt;): DisposableHandle\n\n    /**\n    * \u83b7\u53d6\u6700\u540e\u53d1\u5c04\u7684\u503c\n    */\n    public val latestValue: T?\n}\n</code></pre>"},{"location":"020Kotlin/020Coroutines/#2-livedata","title":"2. liveData \u6784\u5efa\u5668\u51fd\u6570","text":"<p><code>liveData</code> \u662f\u521b\u5efa LiveData \u7684\u534f\u7a0b\u6784\u5efa\u5668\u51fd\u6570\uff1a</p> <pre><code>public fun &lt;T&gt; liveData(\n    context: CoroutineContext = EmptyCoroutineContext,\n    timeoutInMs: Long = DEFAULT_TIMEOUT,\n    @BuilderInference block: suspend LiveDataScope&lt;T&gt;.() -&gt; Unit\n): LiveData&lt;T&gt; = CoroutineLiveData(context, timeoutInMs, block)\n</code></pre>"},{"location":"020Kotlin/020Coroutines/#3-coroutinelivedata","title":"3. CoroutineLiveData \u5b9e\u73b0","text":"<p><code>CoroutineLiveData</code> \u662f\u5b9e\u9645\u5b9e\u73b0\u7c7b\uff0c\u7ee7\u627f\u81ea <code>MutableLiveData</code>\uff1a</p> <pre><code>internal class CoroutineLiveData&lt;T&gt;(\n    context: CoroutineContext,\n    timeoutInMs: Long,\n    private val block: suspend LiveDataScope&lt;T&gt;.() -&gt; Unit\n) : MutableLiveData&lt;T&gt;() {\n    private var blockRunner: BlockRunner&lt;T&gt;? = null\n\n    override fun onActive() {\n        super.onActive()\n        blockRunner?.maybeRun()\n    }\n\n    override fun onInactive() {\n        super.onInactive()\n        blockRunner?.cancel()\n    }\n\n    // \u5185\u90e8\u5b9e\u73b0 LiveDataScope \u63a5\u53e3\n    private inner class LiveDataScopeImpl : LiveDataScope&lt;T&gt; {\n        override suspend fun emit(value: T) {\n            // \u5207\u6362\u5230\u4e3b\u7ebf\u7a0b\u8bbe\u7f6e\u503c\n            withContext(Dispatchers.Main.immediate) {\n                setValue(value)\n            }\n        }\n\n        override suspend fun emitSource(source: LiveData&lt;T&gt;): DisposableHandle {\n            // \u5b9e\u73b0 emitSource \u903b\u8f91\n        }\n\n        override val latestValue: T?\n            get() = this@CoroutineLiveData.value\n    }\n}\n</code></pre>"},{"location":"020Kotlin/020Coroutines/#4-blockrunner","title":"4. BlockRunner \u5b9e\u73b0","text":"<p><code>BlockRunner</code> \u8d1f\u8d23\u7ba1\u7406\u534f\u7a0b\u7684\u6267\u884c\uff1a</p> <pre><code>private inner class BlockRunner&lt;T&gt;(\n    private val liveData: CoroutineLiveData&lt;T&gt;,\n    private val block: suspend LiveDataScope&lt;T&gt;.() -&gt; Unit,\n    private val timeoutInMs: Long,\n    private val scope: CoroutineScope\n) {\n    private var runningJob: Job? = null\n    private var source: LiveData&lt;T&gt;? = null\n    private var observer: Observer&lt;T&gt;? = null\n\n    @MainThread\n    fun maybeRun() {\n        // \u5982\u679c\u6ca1\u6709\u6d3b\u8dc3\u7684\u89c2\u5bdf\u8005\u6216\u5df2\u7ecf\u5728\u8fd0\u884c\uff0c\u5219\u8fd4\u56de\n        if (runningJob != null || !liveData.hasActiveObservers()) return\n\n        // \u542f\u52a8\u534f\u7a0b\u6267\u884c block\n        runningJob = scope.launch {\n            val scopeImpl = LiveDataScopeImpl()\n            try {\n                block.invoke(scopeImpl)\n            } finally {\n                // \u6e05\u7406\u5de5\u4f5c\n            }\n        }\n    }\n\n    @MainThread\n    fun cancel() {\n        // \u53d6\u6d88\u534f\u7a0b\n        runningJob?.cancel()\n        runningJob = null\n    }\n}\n</code></pre>"},{"location":"020Kotlin/020Coroutines/#_86","title":"\u5173\u952e\u673a\u5236\u5206\u6790","text":"<ol> <li>\u534f\u7a0b\u4e0eLiveData\u7684\u7ed1\u5b9a\uff1a</li> <li>\u5f53LiveData\u53d8\u4e3a\u6d3b\u8dc3\u72b6\u6001(\u6709\u6d3b\u8dc3\u89c2\u5bdf\u8005)\u65f6\uff0c\u542f\u52a8\u534f\u7a0b</li> <li> <p>\u5f53LiveData\u53d8\u4e3a\u975e\u6d3b\u8dc3\u72b6\u6001\u65f6\uff0c\u53d6\u6d88\u534f\u7a0b</p> </li> <li> <p>\u7ebf\u7a0b\u5b89\u5168\uff1a</p> </li> <li><code>emit()</code> \u65b9\u6cd5\u5185\u90e8\u4f7f\u7528 <code>Dispatchers.Main.immediate</code> \u786e\u4fdd\u5728\u4e3b\u7ebf\u7a0b\u8bbe\u7f6e\u503c</li> <li> <p>\u534f\u7a0b\u672c\u8eab\u53ef\u4ee5\u5728\u5176\u4ed6\u4e0a\u4e0b\u6587\u6267\u884c\uff0c\u4f46\u6700\u7ec8emit\u503c\u65f6\u4f1a\u5207\u6362\u5230\u4e3b\u7ebf\u7a0b</p> </li> <li> <p>\u8d85\u65f6\u673a\u5236\uff1a</p> </li> <li>\u9ed8\u8ba4\u8d85\u65f6\u65f6\u95f4\u4e3a5\u79d2(DEFAULT_TIMEOUT)</li> <li> <p>\u5982\u679c\u5728\u8d85\u65f6\u65f6\u95f4\u5185\u6ca1\u6709\u65b0\u7684\u89c2\u5bdf\u8005\uff0c\u534f\u7a0b\u5c06\u88ab\u53d6\u6d88</p> </li> <li> <p>\u8d44\u6e90\u7ba1\u7406\uff1a</p> </li> <li>\u4f7f\u7528DisposableHandle\u7ba1\u7406\u8d44\u6e90\u91ca\u653e</li> <li>\u534f\u7a0b\u53d6\u6d88\u65f6\u4f1a\u81ea\u52a8\u6e05\u7406\u8d44\u6e90</li> </ol>"},{"location":"020Kotlin/020Coroutines/#_87","title":"\u4f7f\u7528\u793a\u4f8b","text":"<pre><code>val user: LiveData&lt;User&gt; = liveData {\n    // \u5728IO\u7ebf\u7a0b\u6267\u884c\u8017\u65f6\u64cd\u4f5c\n    val data = database.loadUser() \n    // \u81ea\u52a8\u5207\u6362\u5230\u4e3b\u7ebf\u7a0bemit\u503c\n    emit(data)\n\n    // \u4e5f\u53ef\u4ee5emit\u53e6\u4e00\u4e2aLiveData\n    val disposable = emitSource(otherLiveData)\n    // \u9700\u8981\u65f6\u53d6\u6d88\u8ba2\u9605\n    disposable.dispose()\n}\n</code></pre>"},{"location":"020Kotlin/020Coroutines/#_88","title":"\u603b\u7ed3","text":"<p>LiveDataScope \u7684\u6838\u5fc3\u4ef7\u503c\u5728\u4e8e\uff1a 1. \u5c06\u534f\u7a0b\u7684\u5f02\u6b65\u80fd\u529b\u4e0eLiveData\u7684\u751f\u547d\u5468\u671f\u611f\u77e5\u80fd\u529b\u7ed3\u5408 2. \u7b80\u5316\u4e86\u5f02\u6b65\u6570\u636e\u52a0\u8f7d\u5230UI\u7684\u6d41\u7a0b 3. \u81ea\u52a8\u5904\u7406\u7ebf\u7a0b\u5207\u6362\u548c\u751f\u547d\u5468\u671f\u7ba1\u7406 4. \u63d0\u4f9b\u4e86\u66f4\u7075\u6d3b\u7684\u54cd\u5e94\u5f0f\u7f16\u7a0b\u65b9\u5f0f</p> <p>\u901a\u8fc7\u6e90\u7801\u5206\u6790\u53ef\u4ee5\u770b\u51fa\uff0cLiveDataScope \u7684\u5b9e\u73b0\u5145\u5206\u5229\u7528\u4e86Kotlin\u534f\u7a0b\u7684\u6302\u8d77\u51fd\u6570\u548cLiveData\u7684\u751f\u547d\u5468\u671f\u7279\u6027\uff0c\u4e3aAndroid\u5f00\u53d1\u63d0\u4f9b\u4e86\u4e00\u79cd\u66f4\u73b0\u4ee3\u7684\u5f02\u6b65\u6570\u636e\u5904\u7406\u65b9\u5f0f\u3002</p>"},{"location":"020Kotlin/020Coroutines/#livedatascope-coroutinescope","title":"LiveDataScope \u4e0e CoroutineScope \u7684\u5173\u7cfb\u5206\u6790","text":"<p>\u7ecf\u8fc7\u5bf9\u6e90\u7801\u7684\u4ed4\u7ec6\u68c0\u67e5\uff0c\u9700\u8981\u6f84\u6e05\u4e00\u4e2a\u91cd\u8981\u7684\u70b9\uff1aLiveDataScope \u672c\u8eab\u5e76\u6ca1\u6709\u76f4\u63a5\u5b9e\u73b0 CoroutineScope \u63a5\u53e3\u3002\u8fd9\u662f\u4e00\u4e2a\u5e38\u89c1\u7684\u8bef\u89e3\uff0c\u8ba9\u6211\u8be6\u7ec6\u89e3\u91ca\u5b83\u4eec\u4e4b\u95f4\u7684\u5173\u7cfb\u3002</p>"},{"location":"020Kotlin/020Coroutines/#_89","title":"\u5b9e\u9645\u60c5\u51b5\u5206\u6790","text":"<ol> <li> <p>LiveDataScope \u63a5\u53e3\u5b9a\u4e49\uff1a <pre><code>public interface LiveDataScope&lt;T&gt; {\n    suspend fun emit(value: T)\n    suspend fun emitSource(source: LiveData&lt;T&gt;): DisposableHandle\n    val latestValue: T?\n}\n</code></pre> \u8fd9\u4e2a\u63a5\u53e3\u786e\u5b9e\u6ca1\u6709\u7ee7\u627f\u6216\u5b9e\u73b0 <code>CoroutineScope</code>\u3002</p> </li> <li> <p>CoroutineLiveData \u7684\u5b9e\u73b0\uff1a \u771f\u6b63\u7684\u534f\u7a0b\u4f5c\u7528\u57df\u662f\u5728 <code>CoroutineLiveData</code> \u7684 <code>BlockRunner</code> \u4e2d\u901a\u8fc7 <code>scope.launch</code> \u4f7f\u7528\u7684\uff1a <pre><code>runningJob = scope.launch {\n    val scopeImpl = LiveDataScopeImpl()\n    block.invoke(scopeImpl)\n}\n</code></pre> \u8fd9\u91cc\u7684 <code>scope</code> \u662f\u6784\u5efa\u65f6\u4f20\u5165\u7684 <code>CoroutineContext</code> \u5305\u88c5\u6210\u7684 <code>CoroutineScope</code>\u3002</p> </li> </ol>"},{"location":"020Kotlin/020Coroutines/#_90","title":"\u4e3a\u4ec0\u4e48\u4f1a\u6709\u8fd9\u79cd\u6df7\u6dc6\uff1f","text":"<p>\u53ef\u80fd\u4ea7\u751f\u6df7\u6dc6\u7684\u539f\u56e0\u5728\u4e8e\uff1a</p> <ol> <li> <p><code>liveData</code> \u6784\u5efa\u5668\u51fd\u6570\u63a5\u6536\u4e00\u4e2a\u6302\u8d77 lambda\uff0c\u770b\u8d77\u6765\u50cf\u662f\u5728\u534f\u7a0b\u4f5c\u7528\u57df\u4e2d\u6267\u884c\uff1a <pre><code>liveData {\n    // \u8fd9\u91cc\u770b\u8d77\u6765\u50cf\u5728\u534f\u7a0b\u4f5c\u7528\u57df\u4e2d\n    emit(loadData())\n}\n</code></pre></p> </li> <li> <p>\u53ef\u4ee5\u8c03\u7528\u6302\u8d77\u51fd\u6570\uff1a\u5728 <code>liveData</code> \u5757\u5185\u53ef\u4ee5\u8c03\u7528\u5176\u4ed6\u6302\u8d77\u51fd\u6570\uff0c\u8fd9\u8ba9\u4eba\u8bef\u4ee5\u4e3a\u5b83\u63d0\u4f9b\u4e86\u534f\u7a0b\u4f5c\u7528\u57df\u3002</p> </li> </ol>"},{"location":"020Kotlin/020Coroutines/#_91","title":"\u5b9e\u9645\u673a\u5236","text":"<ol> <li>\u534f\u7a0b\u4f5c\u7528\u57df\u7684\u6765\u6e90\uff1a</li> <li><code>liveData</code> \u6784\u5efa\u5668\u5185\u90e8\u521b\u5efa\u4e86\u4e00\u4e2a <code>CoroutineLiveData</code> \u5b9e\u4f8b</li> <li>\u8fd9\u4e2a\u5b9e\u4f8b\u5185\u90e8\u4f7f\u7528 <code>BlockRunner</code> \u6765\u7ba1\u7406\u534f\u7a0b</li> <li> <p>\u771f\u6b63\u7684\u534f\u7a0b\u4f5c\u7528\u57df\u662f\u901a\u8fc7 <code>CoroutineScope(context)</code> \u521b\u5efa\u7684</p> </li> <li> <p>\u6267\u884c\u6d41\u7a0b\uff1a <pre><code>fun &lt;T&gt; liveData(\n    context: CoroutineContext = EmptyCoroutineContext,\n    timeoutInMs: Long = DEFAULT_TIMEOUT,\n    block: suspend LiveDataScope&lt;T&gt;.() -&gt; Unit\n): LiveData&lt;T&gt; {\n    return CoroutineLiveData(context, timeoutInMs, block)\n}\n</code></pre> \u5f53 LiveData \u53d8\u4e3a\u6d3b\u8dc3\u72b6\u6001\u65f6\uff0c<code>BlockRunner</code> \u4f1a\u4f7f\u7528\u4f20\u5165\u7684 context \u521b\u5efa\u4f5c\u7528\u57df\u5e76\u542f\u52a8\u534f\u7a0b\u3002</p> </li> </ol>"},{"location":"020Kotlin/020Coroutines/#_92","title":"\u8bbe\u8ba1\u610f\u56fe","text":"<p>\u8fd9\u79cd\u8bbe\u8ba1\u5b9e\u73b0\u4e86\uff1a</p> <ol> <li>\u5173\u6ce8\u70b9\u5206\u79bb\uff1a</li> <li><code>LiveDataScope</code> \u53ea\u8d1f\u8d23\u4e0e LiveData \u4ea4\u4e92\uff08emit \u503c\uff09</li> <li> <p>\u534f\u7a0b\u7ba1\u7406\u7531 <code>CoroutineLiveData</code> \u548c <code>BlockRunner</code> \u5904\u7406</p> </li> <li> <p>\u66f4\u5b89\u5168\u7684API\uff1a</p> </li> <li>\u907f\u514d\u66b4\u9732\u4e0d\u5fc5\u8981\u7684\u534f\u7a0b\u63a7\u5236\u80fd\u529b</li> <li>\u786e\u4fdd\u6240\u6709 emit \u64cd\u4f5c\u90fd\u7ecf\u8fc7\u4e3b\u7ebf\u7a0b\u8c03\u5ea6</li> </ol>"},{"location":"020Kotlin/020Coroutines/#_93","title":"\u5bf9\u6bd4\u5176\u4ed6\u534f\u7a0b\u6784\u5efa\u5668","text":"<p>\u4e0e <code>viewModelScope</code> \u6216 <code>lifecycleScope</code> \u4e0d\u540c\uff1a</p> \u7279\u6027 LiveDataScope viewModelScope/lifecycleScope \u662f\u5426\u5b9e\u73b0 CoroutineScope \u274c \u5426 \u2705 \u662f \u4e3b\u8981\u7528\u9014 \u53d1\u5c04\u503c\u5230 LiveData \u901a\u7528\u534f\u7a0b\u7ba1\u7406 \u751f\u547d\u5468\u671f\u5173\u8054 LiveData \u6d3b\u8dc3\u72b6\u6001 ViewModel/Lifecycle \u751f\u547d\u5468\u671f"},{"location":"020Kotlin/020Coroutines/#_94","title":"\u603b\u7ed3","text":"<p>\u867d\u7136 <code>LiveDataScope</code> \u5728\u534f\u7a0b\u73af\u5883\u4e2d\u4f7f\u7528\uff0c\u4f46\u5b83\u672c\u8eab\u5e76\u4e0d\u662f\u4e00\u4e2a <code>CoroutineScope</code>\u3002\u534f\u7a0b\u4f5c\u7528\u57df\u662f\u7531 <code>CoroutineLiveData</code> \u5185\u90e8\u7ba1\u7406\u7684\u3002\u8fd9\u79cd\u8bbe\u8ba1\u4f7f\u5f97\u5f00\u53d1\u8005\u53ef\u4ee5\u4e13\u6ce8\u4e8e\u6570\u636e\u53d1\u5c04\u800c\u4e0d\u5fc5\u62c5\u5fc3\u534f\u7a0b\u7ba1\u7406\uff0c\u540c\u65f6\u786e\u4fdd\u4e86\u4e0e LiveData \u751f\u547d\u5468\u671f\u7684\u6b63\u786e\u96c6\u6210\u3002</p>"},{"location":"020Kotlin/020Coroutines/#viewmodelscopelifecyclescope","title":"ViewModelScope\u548cLifeCycleScope\u7684\u5dee\u5f02\uff0c\u4e3a\u4ec0\u4e48\u4e0d\u7edf\u4e00\u8bbe\u8ba1\u6210\u4e00\u6837\u7684\u5e95\u5c42\u539f\u7406\u3002","text":"\u7b54\u6848"},{"location":"020Kotlin/020Coroutines/#viewmodelscope-lifecyclescope","title":"ViewModelScope \u4e0e LifecycleScope \u7684\u8bbe\u8ba1\u5dee\u5f02\u5206\u6790","text":"<p>Android Jetpack \u4e2d\u7684 <code>viewModelScope</code> \u548c <code>lifecycleScope</code> \u867d\u7136\u90fd\u662f\u4e0e\u751f\u547d\u5468\u671f\u5173\u8054\u7684\u534f\u7a0b\u4f5c\u7528\u57df\uff0c\u4f46\u5b83\u4eec\u7684\u8bbe\u8ba1\u786e\u5b9e\u5b58\u5728\u663e\u8457\u5dee\u5f02\u3002\u8fd9\u4e9b\u5dee\u5f02\u6e90\u4e8e\u5b83\u4eec\u5404\u81ea\u670d\u52a1\u7684\u7ec4\u4ef6\u751f\u547d\u5468\u671f\u6a21\u578b\u548c\u4f7f\u7528\u573a\u666f\u7684\u4e0d\u540c\u9700\u6c42\u3002</p>"},{"location":"020Kotlin/020Coroutines/#1_9","title":"1. \u6838\u5fc3\u8bbe\u8ba1\u5dee\u5f02\u5bf9\u6bd4","text":"\u7279\u6027 viewModelScope lifecycleScope \u5173\u8054\u7ec4\u4ef6 ViewModel LifecycleOwner (Activity/Fragment) \u53d6\u6d88\u89e6\u53d1\u65f6\u673a ViewModel.onCleared() Lifecycle ON_DESTROY \u4e8b\u4ef6 \u8c03\u5ea6\u5668\u9ed8\u8ba4\u914d\u7f6e Dispatchers.Main.immediate Dispatchers.Main (\u975eimmediate) \u4f5c\u7528\u57df\u5c42\u7ea7 \u6bcf\u4e2aViewModel\u5b9e\u4f8b\u72ec\u7acb\u4f5c\u7528\u57df \u6bcf\u4e2aLifecycleOwner\u5171\u4eab\u4f5c\u7528\u57df \u6700\u4f73\u4f7f\u7528\u573a\u666f \u4e1a\u52a1\u903b\u8f91\u64cd\u4f5c UI\u76f8\u5173\u64cd\u4f5c"},{"location":"020Kotlin/020Coroutines/#2_8","title":"2. \u8bbe\u8ba1\u5dee\u5f02\u7684\u6df1\u5c42\u539f\u56e0","text":""},{"location":"020Kotlin/020Coroutines/#21","title":"2.1 \u751f\u547d\u5468\u671f\u6a21\u578b\u4e0d\u540c","text":"<p>ViewModel\u7684\u751f\u547d\u5468\u671f\u7279\u70b9\uff1a - \u53ef\u80fd\u6bd4\u5173\u8054\u7684UI\u7ec4\u4ef6(Activity/Fragment)\u5b58\u6d3b\u66f4\u4e45 - \u53ea\u4f1a\u5728\u4e0d\u518d\u88ab\u9700\u8981\u65f6\u4e00\u6b21\u6027\u6e05\u9664(onCleared) - \u6ca1\u6709\u590d\u6742\u7684\u751f\u547d\u5468\u671f\u72b6\u6001\u53d8\u5316</p> <p>LifecycleOwner\u7684\u751f\u547d\u5468\u671f\u7279\u70b9\uff1a - \u6709\u590d\u6742\u7684\u751f\u547d\u5468\u671f\u72b6\u6001\u53d8\u5316(CREATED, STARTED, RESUMED\u7b49) - \u9700\u8981\u7cbe\u7ec6\u63a7\u5236\u4e0d\u540c\u751f\u547d\u5468\u671f\u9636\u6bb5\u7684\u534f\u7a0b\u884c\u4e3a - \u4e0eUI\u7ebf\u7a0b\u7d27\u5bc6\u5173\u8054</p>"},{"location":"020Kotlin/020Coroutines/#22","title":"2.2 \u4f7f\u7528\u573a\u666f\u9700\u6c42\u4e0d\u540c","text":"<p>viewModelScope\u7684\u8bbe\u8ba1\u8003\u8651\uff1a - \u9700\u8981\u652f\u6301\u53ef\u80fd\u8f83\u957f\u65f6\u95f4\u8fd0\u884c\u7684\u4e1a\u52a1\u903b\u8f91 - \u907f\u514d\u56e0\u914d\u7f6e\u53d8\u5316(\u5982\u5c4f\u5e55\u65cb\u8f6c)\u800c\u4e2d\u65ad\u91cd\u8981\u64cd\u4f5c - \u4e0eUI\u7ebf\u7a0b\u4ea4\u4e92\u4f46\u4e0d\u53d7UI\u751f\u547d\u5468\u671f\u7ec6\u5fae\u53d8\u5316\u5f71\u54cd</p> <p>lifecycleScope\u7684\u8bbe\u8ba1\u8003\u8651\uff1a - \u9700\u8981\u4e0eUI\u751f\u547d\u5468\u671f\u7cbe\u786e\u540c\u6b65 - \u9002\u5408\u6267\u884cUI\u66f4\u65b0\u64cd\u4f5c - \u9700\u8981\u5728\u7279\u5b9a\u751f\u547d\u5468\u671f\u72b6\u6001(\u5982STARTED)\u65f6\u6682\u505c\u534f\u7a0b</p>"},{"location":"020Kotlin/020Coroutines/#23_1","title":"2.3 \u5b9e\u73b0\u673a\u5236\u5dee\u5f02","text":"<p>viewModelScope\u5b9e\u73b0\u5173\u952e\u70b9\uff1a <pre><code>// \u7b80\u5316\u7684viewModelScope\u5b9e\u73b0\nval ViewModel.viewModelScope: CoroutineScope\n    get() = CloseableCoroutineScope(SupervisorJob() + Dispatchers.Main.immediate)\n\n// \u5728ViewModel\u6e05\u9664\u65f6\u53d6\u6d88\noverride fun onCleared() {\n    viewModelScope.cancel()\n}\n</code></pre></p> <p>lifecycleScope\u5b9e\u73b0\u5173\u952e\u70b9\uff1a <pre><code>// \u7b80\u5316\u7684lifecycleScope\u5b9e\u73b0\nval LifecycleOwner.lifecycleScope: LifecycleCoroutineScope\n    get() = LifecycleCoroutineScope(lifecycle, SupervisorJob() + Dispatchers.Main)\n\n// \u4f7f\u7528LifecycleEventObserver\u54cd\u5e94\u72b6\u6001\u53d8\u5316\nlifecycle.addObserver(object : LifecycleEventObserver {\n    override fun onStateChanged(source: LifecycleOwner, event: Event) {\n        if (event == Lifecycle.Event.ON_DESTROY) {\n            lifecycleScope.cancel()\n        }\n    }\n})\n</code></pre></p>"},{"location":"020Kotlin/020Coroutines/#3_8","title":"3. \u5177\u4f53\u5dee\u5f02\u4f53\u73b0","text":""},{"location":"020Kotlin/020Coroutines/#31","title":"3.1 \u53d6\u6d88\u65f6\u673a\u7684\u7cbe\u786e\u5ea6","text":"<ul> <li>viewModelScope\uff1a\u53ea\u5728ViewModel\u5b8c\u5168\u6e05\u9664\u65f6\u4e00\u6b21\u6027\u53d6\u6d88</li> <li>lifecycleScope\uff1a\u53ef\u4ee5\u4e0e\u7279\u5b9a\u751f\u547d\u5468\u671f\u72b6\u6001\u7ed1\u5b9a\uff0c\u63d0\u4f9b\u66f4\u7cbe\u7ec6\u63a7\u5236\uff1a <pre><code>lifecycleScope.launchWhenStarted { \n    // \u53ea\u5728STARTED\u53ca\u4ee5\u4e0a\u72b6\u6001\u6267\u884c\n}\n</code></pre></li> </ul>"},{"location":"020Kotlin/020Coroutines/#32","title":"3.2 \u8c03\u5ea6\u5668\u9009\u62e9","text":"<ul> <li>viewModelScope \u4f7f\u7528 <code>Dispatchers.Main.immediate</code>\uff1a</li> <li>\u5047\u8bbeViewModel\u64cd\u4f5c\u6700\u7ec8\u9700\u8981\u66f4\u65b0UI</li> <li> <p>\u4f18\u5316\u5d4c\u5957\u8c03\u5ea6\u573a\u666f</p> </li> <li> <p>lifecycleScope \u4f7f\u7528 <code>Dispatchers.Main</code>\uff1a</p> </li> <li>\u66f4\u6807\u51c6\u7684UI\u66f4\u65b0\u6a21\u5f0f</li> <li>\u907f\u514d\u4e0e\u590d\u6742\u751f\u547d\u5468\u671f\u72b6\u6001\u4ea4\u4e92\u65f6\u53ef\u80fd\u7684\u95ee\u9898</li> </ul>"},{"location":"020Kotlin/020Coroutines/#33","title":"3.3 \u4f5c\u7528\u57df\u7ed3\u6784","text":"<ul> <li>viewModelScope \u4f7f\u7528\u7b80\u5355\u7684 <code>SupervisorJob</code>\uff1a</li> <li> <p>\u4e1a\u52a1\u903b\u8f91\u53ef\u80fd\u9700\u8981\u72ec\u7acb\u5931\u8d25\u7684\u5b50\u534f\u7a0b</p> </li> <li> <p>lifecycleScope \u4f7f\u7528\u66f4\u590d\u6742\u7684 <code>LifecycleCoroutineScope</code>\uff1a</p> </li> <li>\u652f\u6301 <code>launchWhenX</code> \u7b49\u751f\u547d\u5468\u671f\u611f\u77e5\u64cd\u4f5c</li> <li>\u9700\u8981\u7ef4\u62a4\u4e0eLifecycle\u72b6\u6001\u7684\u6620\u5c04\u5173\u7cfb</li> </ul>"},{"location":"020Kotlin/020Coroutines/#4_10","title":"4. \u8bbe\u8ba1\u54f2\u5b66\u5dee\u5f02","text":"<p>ViewModelScope\u7684\u8bbe\u8ba1\u54f2\u5b66\uff1a - \"\u4e1a\u52a1\u903b\u8f91\u5bb9\u5668\"\u6a21\u5f0f - \u751f\u547d\u5468\u671f\u8fb9\u754c\u660e\u786e(\u5b58\u5728\u6216\u6e05\u9664) - \u5c3d\u91cf\u51cf\u5c11\u5bf9UI\u751f\u547d\u5468\u671f\u7684\u4f9d\u8d56</p> <p>LifecycleScope\u7684\u8bbe\u8ba1\u54f2\u5b66\uff1a - \"\u7cbe\u786e\u751f\u547d\u5468\u671f\u540c\u6b65\"\u6a21\u5f0f - \u7ec6\u7c92\u5ea6\u72b6\u6001\u54cd\u5e94 - \u6df1\u5ea6\u96c6\u6210UI\u7ebf\u7a0b\u548c\u751f\u547d\u5468\u671f</p>"},{"location":"020Kotlin/020Coroutines/#5_3","title":"5. \u5b9e\u9645\u5f71\u54cd\u793a\u4f8b","text":"<p>\u5c4f\u5e55\u65cb\u8f6c\u573a\u666f\uff1a - <code>viewModelScope</code> \u4e2d\u7684\u534f\u7a0b\u4f1a\u7ee7\u7eed\u8fd0\u884c - <code>lifecycleScope</code> \u4e2d\u7684\u534f\u7a0b\u4f1a\u88ab\u53d6\u6d88\u5e76\u91cd\u65b0\u521b\u5efa</p> <p>\u540e\u53f0\u72b6\u6001\u573a\u666f\uff1a <pre><code>// viewModelScope - \u7ee7\u7eed\u8fd0\u884c\nviewModelScope.launch {\n    fetchData() // \u5373\u4f7f\u5e94\u7528\u8fdb\u5165\u540e\u53f0\u4e5f\u7ee7\u7eed\n}\n\n// lifecycleScope - \u53ef\u6682\u505c\nlifecycleScope.launchWhenResumed {\n    updateUI() // \u53ea\u5728RESUMED\u72b6\u6001\u8fd0\u884c\n}\n</code></pre></p>"},{"location":"020Kotlin/020Coroutines/#6_1","title":"6. \u4e3a\u4ec0\u4e48\u4e0d\u80fd\u7edf\u4e00\u8bbe\u8ba1\uff1f","text":"<ol> <li>\u804c\u8d23\u5206\u79bb\u539f\u5219\uff1a</li> <li>ViewModel\u8d1f\u8d23\u4e1a\u52a1\u903b\u8f91\u7684\u6301\u4e45\u6027</li> <li> <p>LifecycleOwner\u8d1f\u8d23UI\u751f\u547d\u5468\u671f\u7684\u654f\u611f\u6027</p> </li> <li> <p>\u6027\u80fd\u8003\u91cf\uff1a</p> </li> <li>ViewModel\u9700\u8981\u66f4\u8f7b\u91cf\u7684\u751f\u547d\u5468\u671f\u5904\u7406</li> <li> <p>LifecycleOwner\u9700\u8981\u66f4\u7cbe\u786e\u7684\u72b6\u6001\u8ddf\u8e2a</p> </li> <li> <p>\u4f7f\u7528\u6a21\u5f0f\u5dee\u5f02\uff1a</p> </li> <li>\u4e1a\u52a1\u903b\u8f91\u901a\u5e38\u9700\u8981\u5b8c\u6210\u91cd\u8981\u64cd\u4f5c</li> <li>UI\u64cd\u4f5c\u901a\u5e38\u9700\u8981\u968f\u65f6\u54cd\u5e94\u751f\u547d\u5468\u671f\u53d8\u5316</li> </ol> <p>\u8fd9\u79cd\u5dee\u5f02\u5316\u7684\u8bbe\u8ba1\u4f7f\u5f97\u5f00\u53d1\u8005\u53ef\u4ee5\u6839\u636e\u5177\u4f53\u573a\u666f\u9009\u62e9\u6700\u5408\u9002\u7684\u534f\u7a0b\u4f5c\u7528\u57df\uff0c\u800c\u4e0d\u662f\u88ab\u8feb\u63a5\u53d7\"\u4e00\u5200\u5207\"\u7684\u89e3\u51b3\u65b9\u6848\u3002\u4e24\u79cd\u4f5c\u7528\u57df\u76f8\u4e92\u8865\u5145\uff0c\u5171\u540c\u6784\u6210\u4e86Android\u534f\u7a0b\u5f00\u53d1\u7684\u5b8c\u6574\u751f\u547d\u5468\u671f\u7ba1\u7406\u65b9\u6848\u3002</p>"},{"location":"020Kotlin/020Coroutines/#scope","title":"\u5404\u79cdScope\u7684\u4f7f\u7528\u573a\u666f","text":"\u7b54\u6848"},{"location":"020Kotlin/020Coroutines/#_95","title":"\u5404\u534f\u7a0b\u4f5c\u7528\u57df\u4f7f\u7528\u573a\u666f\u793a\u4f8b","text":"<p>\u5728Android\u5f00\u53d1\u4e2d\uff0c\u4e0d\u540c\u7684\u534f\u7a0b\u4f5c\u7528\u57df\u9002\u7528\u4e8e\u4e0d\u540c\u7684\u573a\u666f\u3002\u4e0b\u9762\u6211\u901a\u8fc7\u5177\u4f53\u793a\u4f8b\u6765\u8bf4\u660e\u4f55\u65f6\u4f7f\u7528<code>lifecycleScope</code>\u3001<code>viewModelScope</code>\u3001<code>GlobalScope</code>\u548c<code>liveDataScope</code>\u3002</p>"},{"location":"020Kotlin/020Coroutines/#1-lifecyclescope","title":"1. lifecycleScope","text":"<p>\u9002\u7528\u573a\u666f\uff1a\u4e0eUI\u751f\u547d\u5468\u671f\u7d27\u5bc6\u76f8\u5173\u7684\u64cd\u4f5c\uff0c\u7279\u522b\u662f\u9700\u8981\u5728\u7279\u5b9a\u751f\u547d\u5468\u671f\u72b6\u6001\u6682\u505c/\u6062\u590d\u7684\u64cd\u4f5c\u3002</p>"},{"location":"020Kotlin/020Coroutines/#_96","title":"\u4f7f\u7528\u793a\u4f8b\uff1a","text":"<pre><code>class MainActivity : AppCompatActivity() {\n\n    // \u793a\u4f8b1\uff1a\u53ea\u5728Activity\u53ef\u89c1\u65f6\u66f4\u65b0UI\n    fun updateUiWhenVisible() {\n        lifecycleScope.launchWhenResumed {\n            // \u53ea\u5728RESUMED\u72b6\u6001\u6267\u884c\uff08\u754c\u9762\u5b8c\u5168\u53ef\u89c1\uff09\n            updateHeaderView()\n        }\n    }\n\n    // \u793a\u4f8b2\uff1a\u6536\u96c6Flow\u6570\u636e\uff0c\u81ea\u52a8\u5728DESTROY\u65f6\u53d6\u6d88\n    fun collectData() {\n        lifecycleScope.launch {\n            dataFlow.collect { data -&gt;\n                // \u81ea\u52a8\u5728Activity\u9500\u6bc1\u65f6\u53d6\u6d88\u6536\u96c6\n                updateRecyclerView(data)\n            }\n        }\n    }\n\n    // \u793a\u4f8b3\uff1a\u6267\u884c\u77ed\u65f6UI\u52a8\u753b\n    fun startAnimation() {\n        lifecycleScope.launch {\n            // \u4e0eUI\u751f\u547d\u5468\u671f\u7ed1\u5b9a\u7684\u52a8\u753b\n            fadeInAnimation()\n        }\n    }\n}\n</code></pre>"},{"location":"020Kotlin/020Coroutines/#2-viewmodelscope","title":"2. viewModelScope","text":"<p>\u9002\u7528\u573a\u666f\uff1aViewModel\u4e2d\u7684\u4e1a\u52a1\u903b\u8f91\u64cd\u4f5c\uff0c\u9700\u8981\u8de8\u914d\u7f6e\u53d8\u5316\uff08\u5982\u5c4f\u5e55\u65cb\u8f6c\uff09\u4fdd\u6301\u8fd0\u884c\u3002</p>"},{"location":"020Kotlin/020Coroutines/#_97","title":"\u4f7f\u7528\u793a\u4f8b\uff1a","text":"<pre><code>class UserViewModel : ViewModel() {\n\n    // \u793a\u4f8b1\uff1a\u52a0\u8f7d\u7528\u6237\u6570\u636e\n    fun loadUserData(userId: String) {\n        viewModelScope.launch {\n            val user = repository.getUser(userId) // \u7f51\u7edc\u8bf7\u6c42\n            _userLiveData.value = user\n        }\n    }\n\n    // \u793a\u4f8b2\uff1a\u8868\u5355\u63d0\u4ea4\n    fun submitForm(formData: FormData) {\n        viewModelScope.launch {\n            try {\n                repository.submitForm(formData)\n                _submitStatus.value = SubmitStatus.SUCCESS\n            } catch (e: Exception) {\n                _submitStatus.value = SubmitStatus.ERROR\n            }\n        }\n    }\n\n    // \u793a\u4f8b3\uff1a\u5b9a\u671f\u5237\u65b0\u6570\u636e\n    fun startPeriodicRefresh() {\n        viewModelScope.launch {\n            while (true) {\n                refreshData()\n                delay(30_000) // \u6bcf30\u79d2\u5237\u65b0\n            }\n        }\n    }\n}\n</code></pre>"},{"location":"020Kotlin/020Coroutines/#3-globalscope","title":"3. GlobalScope","text":"<p>\u9002\u7528\u573a\u666f\uff1a\u5e94\u7528\u5168\u5c40\u7684\u3001\u4e0d\u7ed1\u5b9a\u4efb\u4f55\u751f\u547d\u5468\u671f\u7684\u957f\u65f6\u95f4\u8fd0\u884c\u4efb\u52a1\uff08\u8c28\u614e\u4f7f\u7528\uff01\uff09</p>"},{"location":"020Kotlin/020Coroutines/#_98","title":"\u4f7f\u7528\u793a\u4f8b\uff1a","text":"<pre><code>// \u793a\u4f8b1\uff1a\u5e94\u7528\u5168\u5c40\u7684\u65e5\u5fd7\u4e0a\u4f20\nobject LogUploader {\n    fun uploadLogs() {\n        GlobalScope.launch(Dispatchers.IO) {\n            // \u5373\u4f7f\u6240\u6709Activity\u90fd\u5173\u95ed\u4e5f\u7ee7\u7eed\u8fd0\u884c\n            while (true) {\n                uploadPendingLogs()\n                delay(60_000) // \u6bcf\u5206\u949f\u68c0\u67e5\u4e00\u6b21\n            }\n        }\n    }\n}\n\n// \u793a\u4f8b2\uff1aWebSocket\u5168\u5c40\u8fde\u63a5\nobject WebSocketManager {\n    private val scope = GlobalScope\n\n    fun connect() {\n        scope.launch {\n            // \u7ef4\u6301\u5168\u5c40WebSocket\u8fde\u63a5\n            establishWebSocketConnection()\n        }\n    }\n}\n\n// \u793a\u4f8b3\uff1a\u5e94\u7528\u5d29\u6e83\u76d1\u63a7\nclass CrashMonitor : Thread.UncaughtExceptionHandler {\n    init {\n        GlobalScope.launch(Dispatchers.IO) {\n            monitorCrashReports()\n        }\n    }\n\n    override fun uncaughtException(t: Thread, e: Throwable) {\n        // \u5904\u7406\u5d29\u6e83\n    }\n}\n</code></pre>"},{"location":"020Kotlin/020Coroutines/#4-livedatascope","title":"4. liveDataScope","text":"<p>\u9002\u7528\u573a\u666f\uff1a\u5728LiveData\u7684<code>transformations</code>\u6216\u6570\u636e\u6e90\u8f6c\u6362\u4e2d\u4f7f\u7528\u534f\u7a0b</p>"},{"location":"020Kotlin/020Coroutines/#_99","title":"\u4f7f\u7528\u793a\u4f8b\uff1a","text":"<pre><code>class MyViewModel : ViewModel() {\n\n    // \u793a\u4f8b1\uff1a\u8f6c\u6362LiveData\n    val formattedUser: LiveData&lt;String&gt; = liveData {\n        emit(\"Loading...\")\n        val user = repository.getUser() // \u6302\u8d77\u51fd\u6570\n        emit(\"User: ${user.name}\")\n    }\n\n    // \u793a\u4f8b2\uff1a\u5408\u5e76\u591a\u4e2aLiveData\n    val userAndPosts: LiveData&lt;Pair&lt;User, List&lt;Post&gt;&gt;&gt; = liveData {\n        val user = repository.getUser()\n        val posts = repository.getPosts(user.id)\n        emit(user to posts)\n    }\n\n    // \u793a\u4f8b3\uff1a\u5e26\u8d85\u65f6\u7684\u6570\u636e\u52a0\u8f7d\n    val timeoutData: LiveData&lt;Result&lt;Data&gt;&gt; = liveData {\n        try {\n            withTimeout(5_000) {\n                emit(Result.success(repository.loadData()))\n            }\n        } catch (e: TimeoutCancellationException) {\n            emit(Result.failure(e))\n        }\n    }\n}\n</code></pre>"},{"location":"020Kotlin/020Coroutines/#_100","title":"\u5404\u4f5c\u7528\u57df\u9009\u62e9\u51b3\u7b56\u6811","text":"<pre><code>\u662f\u5426\u9700\u8981\u534f\u7a0b\uff1f\n\u251c\u2500 \u662f \u2192 \u662f\u5426\u4e0eUI\u76f8\u5173\uff1f\n\u2502   \u251c\u2500 \u662f \u2192 \u4f7f\u7528lifecycleScope\n\u2502   \u2514\u2500 \u5426 \u2192 \u662f\u5426\u5728ViewModel\u4e2d\uff1f\n\u2502       \u251c\u2500 \u662f \u2192 \u4f7f\u7528viewModelScope\n\u2502       \u2514\u2500 \u5426 \u2192 \u662f\u5426\u662fLiveData\u8f6c\u6362\uff1f\n\u2502           \u251c\u2500 \u662f \u2192 \u4f7f\u7528liveDataScope\n\u2502           \u2514\u2500 \u5426 \u2192 \u662f\u5426\u5fc5\u987b\u5168\u5c40\u8fd0\u884c\uff1f\n\u2502               \u251c\u2500 \u662f \u2192 \u8c28\u614e\u4f7f\u7528GlobalScope\n\u2502               \u2514\u2500 \u5426 \u2192 \u8003\u8651\u81ea\u5b9a\u4e49CoroutineScope\n\u2514\u2500 \u5426 \u2192 \u4e0d\u9700\u8981\u534f\u7a0b\n</code></pre>"},{"location":"020Kotlin/020Coroutines/#_101","title":"\u5173\u952e\u9009\u62e9\u539f\u5219","text":"<ol> <li>\u4f18\u5148\u9009\u62e9\u6709\u9650\u751f\u547d\u5468\u671f\u7684\u4f5c\u7528\u57df\uff1a\u9ed8\u8ba4\u9996\u9009<code>viewModelScope</code>\u6216<code>lifecycleScope</code></li> <li>GlobalScope\u662f\u6700\u540e\u9009\u62e9\uff1a\u56e0\u4e3a\u5b83\u53ef\u80fd\u5bfc\u81f4\u5185\u5b58\u6cc4\u6f0f</li> <li>\u4f5c\u7528\u57df\u8d8a\u5c0f\u8d8a\u597d\uff1a\u5c3d\u91cf\u4f7f\u7528\u53d7\u9650\u7684\u4f5c\u7528\u57df</li> <li>\u8003\u8651\u534f\u7a0b\u7684\u751f\u5b58\u65f6\u95f4\uff1a\u534f\u7a0b\u5e94\u8be5\u6bd4\u8c03\u7528\u8005\u751f\u547d\u5468\u671f\u957f\u8fd8\u662f\u77ed\uff1f</li> </ol> <p>\u8fd9\u4e9b\u793a\u4f8b\u5c55\u793a\u4e86\u5982\u4f55\u6839\u636e\u5177\u4f53\u573a\u666f\u9009\u62e9\u5408\u9002\u7684\u4f5c\u7528\u57df\uff0c\u9075\u5faa\u8fd9\u4e9b\u539f\u5219\u53ef\u4ee5\u907f\u514d\u5e38\u89c1\u7684\u5185\u5b58\u6cc4\u6f0f\u548c\u751f\u547d\u5468\u671f\u95ee\u9898\u3002</p>"},{"location":"020Kotlin/020Coroutines/#_102","title":"\u534f\u7a0b\u5b9e\u73b0\u751f\u4ea7\u8005\u6d88\u8d39\u8005","text":"\u7b54\u6848 <p>\u4ee5\u4e0b\u662f\u4f7f\u7528Kotlin\u534f\u7a0b\u5b9e\u73b0\u7684\u751f\u4ea7\u8005\u6d88\u8d39\u8005\u6a21\u578b\uff0c\u529f\u80fd\u7c7b\u4f3c\u4e8e\u4f60\u63d0\u4f9b\u7684Java\u4ee3\u7801\uff1a</p> <pre><code>import kotlinx.coroutines.*\nimport kotlinx.coroutines.channels.Channel\nimport kotlin.random.Random\n\nfun main() = runBlocking {\n    val QUEUE_CAPACITY = 10 // \u901a\u9053\u5bb9\u91cf\n    val channel = Channel&lt;Int&gt;(QUEUE_CAPACITY)\n\n    // \u542f\u52a8\u751f\u4ea7\u8005\u534f\u7a0b\n    val producer = launch {\n        var value = 0\n        while (true) {\n            channel.send(value) // \u53d1\u9001\u6570\u636e\u5230\u901a\u9053\uff08\u5982\u679c\u901a\u9053\u6ee1\uff0c\u4f1a\u6302\u8d77\uff09\n            println(\"Produced: $value\")\n            value++\n            delay(100) // \u6a21\u62df\u751f\u4ea7\u65f6\u95f4\n        }\n    }\n\n    // \u542f\u52a8\u6d88\u8d39\u8005\u534f\u7a0b\n    val consumer = launch {\n        while (true) {\n            val value = channel.receive() // \u4ece\u901a\u9053\u63a5\u6536\u6570\u636e\uff08\u5982\u679c\u901a\u9053\u7a7a\uff0c\u4f1a\u6302\u8d77\uff09\n            println(\"Consumed: $value\")\n            delay(100) // \u6a21\u62df\u6d88\u8d39\u65f6\u95f4\n        }\n    }\n\n    // \u7b49\u5f85\u534f\u7a0b\u5b8c\u6210\uff08\u5b9e\u9645\u4e0a\u8fd9\u4e24\u4e2a\u534f\u7a0b\u4f1a\u4e00\u76f4\u8fd0\u884c\uff09\n    joinAll(producer, consumer)\n}\n</code></pre> <p>\u8fd9\u4e2aKotlin\u5b9e\u73b0\u6709\u4ee5\u4e0b\u7279\u70b9\uff1a</p> <ol> <li>\u4f7f\u7528<code>Channel</code>\u4ee3\u66ff<code>BlockingQueue</code>\uff0cChannel\u662f\u534f\u7a0b\u95f4\u7684\u901a\u4fe1\u539f\u8bed</li> <li><code>send</code>\u548c<code>receive</code>\u65b9\u6cd5\u5728\u901a\u9053\u6ee1/\u7a7a\u65f6\u4f1a\u6302\u8d77\u534f\u7a0b\u800c\u975e\u963b\u585e\u7ebf\u7a0b</li> <li>\u4f7f\u7528<code>delay</code>\u4ee3\u66ff<code>Thread.sleep</code>\uff0c\u8fd9\u662f\u534f\u7a0b\u7684\u6302\u8d77\u51fd\u6570\uff0c\u4e0d\u4f1a\u963b\u585e\u7ebf\u7a0b</li> <li>\u4f7f\u7528<code>launch</code>\u542f\u52a8\u534f\u7a0b\uff0c<code>runBlocking</code>\u521b\u5efa\u4e3b\u534f\u7a0b\u4f5c\u7528\u57df</li> <li>\u4ee3\u7801\u66f4\u52a0\u7b80\u6d01\uff0c\u4e0d\u9700\u8981\u5904\u7406InterruptedException</li> </ol> <p>\u5982\u679c\u4f60\u60f3\u8981\u66f4\u63a5\u8fd1\u539f\u59cbJava\u4ee3\u7801\u7684\u884c\u4e3a\uff08\u6bd4\u5982\u5728\u901a\u9053\u64cd\u4f5c\u65f6\u5904\u7406\u53d6\u6d88\uff09\uff0c\u53ef\u4ee5\u8fd9\u6837\u4fee\u6539\uff1a</p> <pre><code>fun main() = runBlocking {\n    val QUEUE_CAPACITY = 10\n    val channel = Channel&lt;Int&gt;(QUEUE_CAPACITY)\n\n    val producer = launch {\n        var value = 0\n        while (isActive) { // \u68c0\u67e5\u534f\u7a0b\u662f\u5426\u6d3b\u8dc3\n            try {\n                channel.send(value)\n                println(\"Produced: $value\")\n                value++\n                delay(100)\n            } catch (e: CancellationException) {\n                println(\"Producer cancelled\")\n                throw e\n            }\n        }\n    }\n\n    val consumer = launch {\n        while (isActive) {\n            try {\n                val value = channel.receive()\n                println(\"Consumed: $value\")\n                delay(100)\n            } catch (e: CancellationException) {\n                println(\"Consumer cancelled\")\n                throw e\n            }\n        }\n    }\n\n    // 10\u79d2\u540e\u53d6\u6d88\u534f\u7a0b\n    delay(10_000)\n    producer.cancel()\n    consumer.cancel()\n}\n</code></pre> <p>\u8fd9\u4e2a\u7248\u672c\u6dfb\u52a0\u4e86\u5bf9\u534f\u7a0b\u53d6\u6d88\u7684\u5904\u7406\uff0c\u66f4\u52a0\u5065\u58ee\u3002</p>"},{"location":"020Kotlin/020Coroutines/#viewmodelmutablestateflowasstateflowcollectasstate","title":"ViewModel\uff0cMutableStateFlow\uff0casStateFlow\uff0ccollectAsState()\u4e4b\u95f4\u7684\u8054\u52a8\u3002","text":"\u7b54\u6848"},{"location":"020Kotlin/020Coroutines/#mutablestateflow-asstateflow-kotlin","title":"MutableStateFlow \u548c asStateFlow() \u5728 Kotlin \u4e2d\u7684\u5de5\u4f5c\u539f\u7406","text":""},{"location":"020Kotlin/020Coroutines/#1_10","title":"\u56de\u7b541","text":""},{"location":"020Kotlin/020Coroutines/#_103","title":"\u57fa\u672c\u6982\u5ff5","text":""},{"location":"020Kotlin/020Coroutines/#mutablestateflow","title":"MutableStateFlow","text":"<p><code>MutableStateFlow</code> \u662f Kotlin \u534f\u7a0b Flow API \u4e2d\u7684\u4e00\u4e2a\u7279\u6b8a\u5b9e\u73b0\uff0c\u5b83\u5177\u6709\u4ee5\u4e0b\u7279\u70b9\uff1a - \u662f\u4e00\u4e2a\u53ef\u53d8\u7684\u3001\u6709\u72b6\u6001\u7684 Flow - \u603b\u662f\u6301\u6709\u5f53\u524d\u503c\uff08\u9700\u8981\u521d\u59cb\u503c\uff09 - \u53ea\u4fdd\u7559\u6700\u65b0\u503c\uff0c\u65b0\u8ba2\u9605\u8005\u4f1a\u7acb\u5373\u83b7\u53d6\u5f53\u524d\u503c - \u662f\u7ebf\u7a0b\u5b89\u5168\u7684</p>"},{"location":"020Kotlin/020Coroutines/#asstateflow","title":"asStateFlow()","text":"<p><code>asStateFlow()</code> \u662f\u4e00\u4e2a\u6269\u5c55\u51fd\u6570\uff0c\u5b83\u5c06 <code>MutableStateFlow</code> \u8f6c\u6362\u4e3a\u4e0d\u53ef\u53d8\u7684 <code>StateFlow</code>\uff1a - \u8fd4\u56de\u4e00\u4e2a\u53ea\u8bfb\u7684 <code>StateFlow</code> \u63a5\u53e3 - \u9632\u6b62\u5916\u90e8\u76f4\u63a5\u4fee\u6539\u72b6\u6001 - \u4fdd\u6301\u4e86\u4e0e\u539f\u59cb <code>MutableStateFlow</code> \u76f8\u540c\u7684\u503c\u548c\u66f4\u65b0</p>"},{"location":"020Kotlin/020Coroutines/#_104","title":"\u5e95\u5c42\u539f\u7406","text":""},{"location":"020Kotlin/020Coroutines/#stateflow","title":"StateFlow \u7684\u5de5\u4f5c\u539f\u7406","text":"<ol> <li>\u72b6\u6001\u4fdd\u6301\uff1aStateFlow \u59cb\u7ec8\u6301\u6709\u6700\u65b0\u53d1\u51fa\u7684\u503c</li> <li>\u503c\u6bd4\u8f83\uff1a\u4f7f\u7528 <code>Any.equals</code> \u6bd4\u8f83\u65b0\u65e7\u503c\uff0c\u53ea\u6709\u4e0d\u540c\u65f6\u624d\u901a\u77e5\u6536\u96c6\u8005</li> <li>\u5e76\u53d1\u5b89\u5168\uff1a\u4f7f\u7528\u539f\u5b50\u64cd\u4f5c\u4fdd\u8bc1\u7ebf\u7a0b\u5b89\u5168</li> <li>\u8ba2\u9605\u673a\u5236\uff1a\u65b0\u8ba2\u9605\u8005\u4f1a\u7acb\u5373\u83b7\u5f97\u5f53\u524d\u503c</li> </ol>"},{"location":"020Kotlin/020Coroutines/#mutablestateflow-stateflow","title":"MutableStateFlow \u4e0e StateFlow \u5173\u7cfb","text":"<ul> <li><code>MutableStateFlow</code> \u5b9e\u73b0\u4e86 <code>StateFlow</code> \u63a5\u53e3</li> <li><code>asStateFlow()</code> \u53ea\u662f\u8fd4\u56de\u76f8\u540c\u7684\u5b9e\u4f8b\uff0c\u4f46\u7c7b\u578b\u8f6c\u6362\u4e3a\u53ea\u8bfb\u63a5\u53e3</li> </ul>"},{"location":"020Kotlin/020Coroutines/#compose-ui","title":"\u66f4\u65b0\u5230 Compose UI \u7684\u6d41\u7a0b","text":"<ol> <li> <p>ViewModel \u5185\u90e8\uff1a <pre><code>private val _walletUiState = MutableStateFlow&lt;UiState&lt;WalletOverviewUiModel&gt;&gt;(UiState.Loading)\nval walletUiState = _walletUiState.asStateFlow()\n\n// \u66f4\u65b0\u72b6\u6001\nfun updateState(newState: UiState&lt;WalletOverviewUiModel&gt;) {\n    _walletUiState.value = newState\n}\n</code></pre></p> </li> <li> <p>Compose UI \u6536\u96c6\u72b6\u6001\uff1a <pre><code>val walletUiState by viewModel.walletUiState.collectAsState()\n</code></pre></p> </li> <li><code>collectAsState()</code> \u662f Compose \u7684\u6269\u5c55\u51fd\u6570</li> <li>\u5b83\u5728 Compose \u5185\u90e8\u521b\u5efa\u4e86\u4e00\u4e2a <code>State</code> \u5bf9\u8c61</li> <li> <p>\u5f53 Flow \u53d1\u51fa\u65b0\u503c\u65f6\uff0c\u4f1a\u89e6\u53d1 Compose \u91cd\u7ec4</p> </li> <li> <p>\u5b8c\u6574\u66f4\u65b0\u6d41\u7a0b\uff1a</p> </li> <li>ViewModel \u4fee\u6539 <code>_walletUiState.value</code></li> <li><code>walletUiState</code> (StateFlow) \u901a\u77e5\u6240\u6709\u6536\u96c6\u8005</li> <li><code>collectAsState()</code> \u6536\u5230\u66f4\u65b0</li> <li>Compose \u7684 <code>State</code> \u5bf9\u8c61\u503c\u6539\u53d8</li> <li>\u4f7f\u7528\u8be5\u72b6\u6001\u7684 Composable \u51fd\u6570\u88ab\u6807\u8bb0\u4e3a\u9700\u8981\u91cd\u7ec4</li> <li>\u5728\u4e0b\u4e00\u4e2a\u6e32\u67d3\u5e27\u4e2d\uff0cUI \u66f4\u65b0\u53cd\u6620\u6700\u65b0\u72b6\u6001</li> </ol>"},{"location":"020Kotlin/020Coroutines/#_105","title":"\u6027\u80fd\u4f18\u5316","text":"<ol> <li>\u76f8\u7b49\u6027\u68c0\u67e5\uff1aStateFlow \u53ea\u5728\u503c\u5b9e\u9645\u6539\u53d8\u65f6\u901a\u77e5\u6536\u96c6\u8005</li> <li>\u6700\u5c0f\u5316\u91cd\u7ec4\uff1aCompose \u53ea\u91cd\u7ec4\u4f9d\u8d56\u7279\u5b9a\u72b6\u6001\u7684\u90e8\u5206 UI</li> <li>\u751f\u547d\u5468\u671f\u611f\u77e5\uff1a<code>collectAsState()</code> \u81ea\u52a8\u7ba1\u7406\u8ba2\u9605\uff0c\u5f53 Composable \u9000\u51fa\u7ec4\u5408\u65f6\u53d6\u6d88</li> </ol> <p>\u8fd9\u79cd\u6a21\u5f0f\u63d0\u4f9b\u4e86\u9ad8\u6548\u7684\u3001\u54cd\u5e94\u5f0f\u7684 UI \u66f4\u65b0\u673a\u5236\uff0c\u540c\u65f6\u4fdd\u6301\u4e86\u826f\u597d\u7684\u67b6\u6784\u5206\u79bb\uff08ViewModel \u7ba1\u7406\u72b6\u6001\uff0cUI \u53ea\u662f\u89c2\u5bdf\u548c\u663e\u793a\uff09\u3002</p> <p>\u60a8\u7684\u95ee\u9898\u6d89\u53ca\u5230Android Kotlin\u9879\u76ee\u4e2dViewModel\u4e0eCompose UI\u901a\u4fe1\u7684\u5173\u952e\u673a\u5236\u3002\u6211\u6765\u89e3\u91caMutableStateFlow\u3001asStateFlow()\u4ee5\u53ca\u5b83\u4eec\u5982\u4f55\u4e0eCompose UI\u66f4\u65b0\u76f8\u5173\u7684\u539f\u7406\u3002</p>"},{"location":"020Kotlin/020Coroutines/#2_9","title":"\u56de\u7b542","text":""},{"location":"020Kotlin/020Coroutines/#mutablestateflow-asstateflow","title":"MutableStateFlow \u4e0e asStateFlow()","text":"<p>MutableStateFlow: - MutableStateFlow\u662fKotlin Flow API\u7684\u4e00\u90e8\u5206\uff0c\u662f\u4e00\u4e2a\u53ef\u53d8\u7684\u72b6\u6001\u5bb9\u5668 - \u5b83\u6301\u6709\u4e00\u4e2a\u5355\u4e00\u503c\uff0c\u5e76\u5728\u503c\u53d8\u5316\u65f6\u901a\u77e5\u6240\u6709\u6536\u96c6\u8005 - \u5b83\u5b9e\u73b0\u4e86MutableState\u63a5\u53e3\uff0c\u5141\u8bb8\u901a\u8fc7<code>.value</code>\u5c5e\u6027\u66f4\u65b0\u5176\u72b6\u6001 - \u521d\u59cb\u5316\u65f6\u5fc5\u987b\u63d0\u4f9b\u4e00\u4e2a\u521d\u59cb\u503c(\u5728\u60a8\u7684\u4f8b\u5b50\u4e2d\u662f<code>UiState.Loading</code>)</p> <p>asStateFlow(): - \u662f\u4e00\u4e2a\u8f6c\u6362\u51fd\u6570\uff0c\u5c06MutableStateFlow\u8f6c\u6362\u4e3a\u53ea\u8bfb\u7684StateFlow - \u4e3b\u8981\u76ee\u7684\u662f\u9075\u5faa\u5c01\u88c5\u539f\u5219\uff0c\u5bf9\u5916\u90e8\u516c\u5f00\u53ea\u8bfb\u89c6\u56fe\uff0c\u9632\u6b62\u5916\u90e8\u76f4\u63a5\u4fee\u6539\u72b6\u6001 - \u5bf9\u6027\u80fd\u6ca1\u6709\u5f71\u54cd\uff0c\u672c\u8d28\u4e0a\u662f\u540c\u4e00\u4e2aFlow\u5bf9\u8c61\uff0c\u53ea\u662f\u63a5\u53e3\u9650\u5236\u4e86\u64cd\u4f5c</p>"},{"location":"020Kotlin/020Coroutines/#_106","title":"\u5e95\u5c42\u539f\u7406","text":"<p>MutableStateFlow\u7684\u5b9e\u73b0\u539f\u7406: 1. \u5185\u90e8\u7ef4\u62a4\u4e00\u4e2a\u539f\u5b50\u5f15\u7528(AtomicReference)\u5b58\u50a8\u5f53\u524d\u503c 2. \u4f7f\u7528ConcurrentLinkedQueue\u7ba1\u7406\u8ba2\u9605\u8005(collectors) 3. \u5f53\u8c03\u7528<code>value = newValue</code>\u65f6\uff0c\u4f1a: - \u66f4\u65b0\u5185\u90e8\u5b58\u50a8\u7684\u503c - \u68c0\u67e5\u503c\u662f\u5426\u53d1\u751f\u53d8\u5316(\u9ed8\u8ba4\u4f7f\u7528\u7ed3\u6784\u76f8\u7b49==\u68c0\u67e5) - \u5982\u679c\u53d8\u5316\uff0c\u901a\u77e5\u6240\u6709\u8ba2\u9605\u8005</p> <p>StateFlow\u7684\u7279\u70b9: - \u70ed\u6d41(Hot Flow)\uff1a\u5373\u4f7f\u6ca1\u6709\u6536\u96c6\u8005\u4e5f\u4f1a\u4fdd\u6301\u6d3b\u8dc3 - \u72b6\u6001\u6027(Statefulness)\uff1a\u603b\u662f\u4fdd\u6301\u6700\u65b0\u503c\uff0c\u65b0\u8ba2\u9605\u8005\u7acb\u5373\u83b7\u5f97\u5f53\u524d\u503c - \u53bb\u91cd(Distinctiveness)\uff1a\u53ea\u6709\u503c\u53d8\u5316\u65f6\u624d\u4f1a\u53d1\u51fa\u901a\u77e5 - \u7ebf\u7a0b\u5b89\u5168\uff1a\u53ef\u4ee5\u5728\u4efb\u4f55\u534f\u7a0b\u4e0a\u4e0b\u6587\u4e2d\u4f7f\u7528</p>"},{"location":"020Kotlin/020Coroutines/#compose-ui_1","title":"\u4e0eCompose UI\u7684\u96c6\u6210\u673a\u5236","text":"<p>collectAsState(): 1. \u662fCompose\u4e0eFlow\u96c6\u6210\u7684\u6865\u6881 2. \u521b\u5efa\u5e76\u8fd4\u56de\u4e00\u4e2aCompose\u7684State\u5bf9\u8c61 3. \u5728\u5185\u90e8\u542f\u52a8\u4e00\u4e2a\u534f\u7a0b\u6536\u96c6Flow\u7684\u503c 4. \u5f53Flow\u53d1\u51fa\u65b0\u503c\u65f6\uff0c\u66f4\u65b0State\u5bf9\u8c61\uff0c\u89e6\u53d1\u91cd\u7ec4 <p>\u66f4\u65b0\u6d41\u7a0b: 1. ViewModel\u4e2d\uff0c\u901a\u8fc7<code>_walletUiState.value = newState</code>\u66f4\u65b0\u72b6\u6001 2. MutableStateFlow\u68c0\u6d4b\u5230\u503c\u53d8\u5316\uff0c\u901a\u77e5\u6240\u6709\u8ba2\u9605\u8005 3. Compose\u4e2d\u7684collectAsState()\u6536\u5230\u901a\u77e5\uff0c\u66f4\u65b0\u5176State\u503c 4. Compose\u68c0\u6d4b\u5230State\u53d8\u5316\uff0c\u89e6\u53d1\u4f7f\u7528\u8be5State\u7684UI\u90e8\u5206\u91cd\u7ec4 5. UI\u4f7f\u7528\u65b0\u503c\u91cd\u65b0\u6e32\u67d3</p> <p>\u751f\u547d\u5468\u671f\u7ba1\u7406: - collectAsState()\u5185\u90e8\u7684\u534f\u7a0b\u4e0e\u5f53\u524d\u7ec4\u5408(composition)\u7684\u751f\u547d\u5468\u671f\u7ed1\u5b9a - \u5f53\u7ec4\u4ef6\u79bb\u5f00\u7ec4\u5408\u65f6\uff0c\u534f\u7a0b\u81ea\u52a8\u53d6\u6d88\uff0c\u9632\u6b62\u5185\u5b58\u6cc4\u6f0f - \u5f53\u7ec4\u4ef6\u91cd\u65b0\u8fdb\u5165\u7ec4\u5408\u65f6\uff0c\u4f1a\u91cd\u65b0\u5f00\u59cb\u6536\u96c6</p> <p>\u8fd9\u79cd\u67b6\u6784\u5b9e\u73b0\u4e86\u5355\u5411\u6570\u636e\u6d41\uff0c\u4f7f\u72b6\u6001\u7ba1\u7406\u53d8\u5f97\u53ef\u9884\u6d4b\u548c\u9ad8\u6548\uff0c\u662fJetpack Compose\u63a8\u8350\u7684\u72b6\u6001\u7ba1\u7406\u6a21\u5f0f\u3002</p>"},{"location":"020Kotlin/020Coroutines/#mutablestateflow_1","title":"MutableStateFlow \u5e95\u5c42\u539f\u7406","text":"\u7b54\u6848"},{"location":"020Kotlin/020Coroutines/#asstateflow_1","title":"asStateFlow \u5e95\u5c42\u539f\u7406","text":"\u7b54\u6848"},{"location":"020Kotlin/020Coroutines/#collectasstate","title":"collectAsState()\u5e95\u5c42\u539f\u7406","text":"\u7b54\u6848"},{"location":"020Kotlin/020Coroutines/#collectasstatexml-ui","title":"collectAsState\u80fd\u5426\u901a\u8fc7XML UI\u4f7f\u7528\uff1f","text":"\u7b54\u6848 <p><code>collectAsState()</code> \u662f Jetpack Compose \u4e13\u5c5e \u7684\u6269\u5c55\u51fd\u6570\uff0c\u5b83 \u4e0d\u80fd\u5728\u4f20\u7edf\u7684 XML-based UI \u7cfb\u7edf\uff08\u5982 Activity/Fragment + View \u4f53\u7cfb\uff09\u4e2d\u76f4\u63a5\u4f7f\u7528\u3002\u5b83\u7684\u8bbe\u8ba1\u76ee\u7684\u662f\u5c06 Flow \u8f6c\u6362\u4e3a Compose \u7684 <code>State</code> \u5bf9\u8c61\uff0c\u4ee5\u4fbf\u5728 Composable \u51fd\u6570\u4e2d\u54cd\u5e94\u5f0f\u5730\u89c2\u5bdf\u6570\u636e\u53d8\u5316\u3002</p>"},{"location":"020Kotlin/020Coroutines/#xml-ui","title":"\u5728\u4f20\u7edf XML UI \u4e2d\u7684\u66ff\u4ee3\u65b9\u6848","text":"<p>\u5982\u679c\u4f60\u5728\u975e Compose \u9879\u76ee\uff08\u5982\u57fa\u4e8e XML \u7684 Android \u89c6\u56fe\u7cfb\u7edf\uff09\u4e2d\u60f3\u8981\u89c2\u5bdf <code>StateFlow</code> \u6216 <code>Flow</code> \u7684\u6570\u636e\u53d8\u5316\uff0c\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u66ff\u4ee3\u65b9\u6848\uff1a</p>"},{"location":"020Kotlin/020Coroutines/#1-lifecyclecoroutinescope-flow","title":"1. \u4f7f\u7528 <code>LifecycleCoroutineScope</code> \u6536\u96c6 Flow","text":"<p>\u5728 Activity/Fragment \u4e2d\uff0c\u4f60\u53ef\u4ee5\u901a\u8fc7 <code>lifecycleScope</code> \u542f\u52a8\u4e00\u4e2a\u534f\u7a0b\u6765\u6536\u96c6 Flow\uff1a</p> <pre><code>// \u5728 Activity/Fragment \u4e2d\noverride fun onCreate(savedInstanceState: Bundle?) {\n    super.onCreate(savedInstanceState)\n    setContentView(R.layout.activity_main) // \u52a0\u8f7d XML UI\n\n    lifecycleScope.launch {\n        viewModel.walletUiState.collect { uiState -&gt;\n            // \u66f4\u65b0 UI\uff08\u4f8b\u5982 TextView\u3001RecyclerView\uff09\n            updateUi(uiState)\n        }\n    }\n}\n\nprivate fun updateUi(uiState: UiState&lt;WalletOverviewUiModel&gt;) {\n    when (uiState) {\n        is UiState.Loading -&gt; {\n            progressBar.visibility = View.VISIBLE\n        }\n        is UiState.Success -&gt; {\n            progressBar.visibility = View.GONE\n            textView.text = uiState.data.balance.toString()\n        }\n        is UiState.Error -&gt; {\n            progressBar.visibility = View.GONE\n            Toast.makeText(this, uiState.message, Toast.LENGTH_SHORT).show()\n        }\n    }\n}\n</code></pre>"},{"location":"020Kotlin/020Coroutines/#2-flowaslivedata-livedata","title":"2. \u4f7f\u7528 <code>Flow.asLiveData()</code> \u8f6c\u6362\u4e3a LiveData","text":"<p>\u5982\u679c\u4f60\u66f4\u559c\u6b22\u4f7f\u7528 <code>LiveData</code>\uff08\u4f8b\u5982\u5728 XML + ViewModel + LiveData \u67b6\u6784\u4e2d\uff09\uff0c\u53ef\u4ee5\u4f7f\u7528 <code>androidx.lifecycle:lifecycle-livedata-ktx</code> \u63d0\u4f9b\u7684\u6269\u5c55\u51fd\u6570\uff1a</p> <pre><code>// \u5728 ViewModel \u4e2d\nval walletUiState: LiveData&lt;UiState&lt;WalletOverviewUiModel&gt;&gt; = \n    _walletUiState.asLiveData()\n\n// \u5728 Activity/Fragment \u4e2d\u89c2\u5bdf\nviewModel.walletUiState.observe(this) { uiState -&gt;\n    updateUi(uiState)\n}\n</code></pre>"},{"location":"020Kotlin/020Coroutines/#collectasstate-vs-collect-vs-livedata","title":"<code>collectAsState</code> vs. <code>collect</code> vs. <code>LiveData</code>","text":"\u7279\u6027 <code>collectAsState</code> (Compose) <code>collect</code> (XML + Coroutines) <code>LiveData</code> (XML) \u9002\u7528\u573a\u666f \u4ec5\u9650 Jetpack Compose \u4f20\u7edf XML UI + \u534f\u7a0b \u4f20\u7edf XML UI \u751f\u547d\u5468\u671f\u611f\u77e5 \u2705 \u81ea\u52a8\u7ba1\u7406\uff08Compose \u751f\u547d\u5468\u671f\uff09 \u2705 \u9700\u7528 <code>lifecycleScope</code> \u2705 \u539f\u751f\u652f\u6301 \u7ebf\u7a0b\u8c03\u5ea6 \u81ea\u52a8\u5207\u5230 UI \u7ebf\u7a0b\uff08\u901a\u8fc7 <code>Dispatchers.Main</code>\uff09 \u9700\u624b\u52a8\u786e\u4fdd UI \u66f4\u65b0\u5728\u4e3b\u7ebf\u7a0b \u81ea\u52a8\u5728\u4e3b\u7ebf\u7a0b\u901a\u77e5 \u662f\u5426\u9700\u8981\u53d6\u6d88 \u274c \u81ea\u52a8\u53d6\u6d88 \u2705 \u9700\u4f9d\u8d56 <code>lifecycleScope</code> \u2705 \u81ea\u52a8\u53d6\u6d88"},{"location":"020Kotlin/020Coroutines/#_107","title":"\u603b\u7ed3","text":"<ul> <li>\u2705 \u5728 Compose \u4e2d\uff1a\u4f7f\u7528 <code>collectAsState()</code> \u662f\u6700\u4f73\u5b9e\u8df5\u3002</li> <li>\u2705 \u5728 XML UI \u4e2d\uff1a</li> <li>\u5982\u679c\u4f7f\u7528 \u534f\u7a0b\uff0c\u7528 <code>lifecycleScope.launch { flow.collect { ... } }</code>\u3002</li> <li>\u5982\u679c\u4f7f\u7528 LiveData\uff0c\u7528 <code>flow.asLiveData()</code> \u8f6c\u6362\u540e\u89c2\u5bdf\u3002</li> <li>\u274c \u4e0d\u8981\u5728 XML UI \u4e2d\u4f7f\u7528 <code>collectAsState()</code>\uff0c\u56e0\u4e3a\u5b83\u662f Compose \u7279\u6709\u7684 API\uff0c\u65e0\u6cd5\u76f4\u63a5\u9a71\u52a8\u4f20\u7edf\u89c6\u56fe\u7cfb\u7edf\u7684 UI \u66f4\u65b0\u3002</li> </ul>"},{"location":"020Kotlin/020Coroutines/#_108","title":"Kotlin\u534f\u7a0b","text":"\u7b54\u6848"},{"location":"020Kotlin/020Coroutines/#_109","title":"Kotlin\u534f\u7a0b","text":"\u7b54\u6848"},{"location":"020Kotlin/020Coroutines/#_110","title":"Kotlin\u534f\u7a0b","text":"\u7b54\u6848"},{"location":"020Kotlin/020Coroutines/#_111","title":"Kotlin\u534f\u7a0b","text":"\u7b54\u6848"},{"location":"030Android/010Basic/","title":"Android\u57fa\u7840","text":""},{"location":"030Android/010Basic/#activity","title":"Activity\u7684\u751f\u547d\u5468\u671f","text":"\u7b54\u6848 <p>\u5728 Android \u5f00\u53d1\u4e2d\uff0cActivity \u662f\u5e94\u7528\u7a0b\u5e8f\u7684\u6838\u5fc3\u7ec4\u4ef6\u4e4b\u4e00\uff0c\u8d1f\u8d23\u7ba1\u7406\u7528\u6237\u754c\u9762\u548c\u7528\u6237\u4ea4\u4e92\u3002Activity \u7684\u751f\u547d\u5468\u671f\u7531\u4e00\u7cfb\u5217\u56de\u8c03\u65b9\u6cd5\u7ec4\u6210\uff0c\u5f00\u53d1\u8005\u53ef\u4ee5\u901a\u8fc7\u91cd\u5199\u8fd9\u4e9b\u65b9\u6cd5\u6765\u7ba1\u7406 Activity \u7684\u72b6\u6001\u548c\u884c\u4e3a\u3002\u4ee5\u4e0b\u662f Activity \u751f\u547d\u5468\u671f\u7684\u4e3b\u8981\u65b9\u6cd5\uff1a</p>"},{"location":"030Android/010Basic/#1-oncreate","title":"1. onCreate()","text":"<ul> <li>\u8c03\u7528\u65f6\u673a\uff1aActivity \u9996\u6b21\u521b\u5efa\u65f6\u8c03\u7528\u3002</li> <li>\u4f5c\u7528\uff1a\u901a\u5e38\u7528\u4e8e\u6267\u884c\u4e00\u6b21\u6027\u521d\u59cb\u5316\u64cd\u4f5c\uff0c\u5982\u8bbe\u7f6e\u5e03\u5c40 (<code>setContentView</code>)\u3001\u521d\u59cb\u5316\u53d8\u91cf\u3001\u7ed1\u5b9a\u6570\u636e\u7b49\u3002</li> <li>\u53c2\u6570\uff1a<code>Bundle savedInstanceState</code> \u4fdd\u5b58\u4e86 Activity \u4e4b\u524d\u7684\u72b6\u6001\uff08\u5982\u679c\u6709\uff09\u3002</li> </ul>"},{"location":"030Android/010Basic/#2-onstart","title":"2. onStart()","text":"<ul> <li>\u8c03\u7528\u65f6\u673a\uff1aActivity \u5373\u5c06\u53d8\u4e3a\u53ef\u89c1\u72b6\u6001\u65f6\u8c03\u7528\u3002</li> <li>\u4f5c\u7528\uff1aActivity \u8fdb\u5165\u524d\u53f0\uff0c\u4f46\u7528\u6237\u8fd8\u4e0d\u80fd\u4e0e\u4e4b\u4ea4\u4e92\u3002\u901a\u5e38\u7528\u4e8e\u51c6\u5907 UI \u6216\u542f\u52a8\u540e\u53f0\u4efb\u52a1\u3002</li> </ul>"},{"location":"030Android/010Basic/#3-onresume","title":"3. onResume()","text":"<ul> <li>\u8c03\u7528\u65f6\u673a\uff1aActivity \u8fdb\u5165\u524d\u53f0\u5e76\u53ef\u4ee5\u4e0e\u7528\u6237\u4ea4\u4e92\u65f6\u8c03\u7528\u3002</li> <li>\u4f5c\u7528\uff1aActivity \u5904\u4e8e\u6d3b\u52a8\u72b6\u6001\uff0c\u7528\u6237\u53ef\u4ee5\u4e0e\u4e4b\u4ea4\u4e92\u3002\u901a\u5e38\u7528\u4e8e\u542f\u52a8\u52a8\u753b\u3001\u4f20\u611f\u5668\u3001\u6444\u50cf\u5934\u7b49\u8d44\u6e90\u3002</li> </ul>"},{"location":"030Android/010Basic/#4-onpause","title":"4. onPause()","text":"<ul> <li>\u8c03\u7528\u65f6\u673a\uff1aActivity \u5931\u53bb\u7126\u70b9\u4f46\u4ecd\u90e8\u5206\u53ef\u89c1\u65f6\u8c03\u7528\uff08\u4f8b\u5982\uff0c\u5f39\u51fa\u5bf9\u8bdd\u6846\u6216\u53e6\u4e00\u4e2a Activity \u8986\u76d6\uff09\u3002</li> <li>\u4f5c\u7528\uff1a\u901a\u5e38\u7528\u4e8e\u91ca\u653e\u8d44\u6e90\u3001\u4fdd\u5b58\u6570\u636e\u6216\u505c\u6b62\u52a8\u753b\u7b49\u64cd\u4f5c\u3002\u6b64\u65b9\u6cd5\u5e94\u5feb\u901f\u6267\u884c\uff0c\u56e0\u4e3a\u4e0b\u4e00\u4e2a Activity \u7684 <code>onResume()</code> \u4f1a\u7b49\u5f85\u6b64\u65b9\u6cd5\u5b8c\u6210\u3002</li> </ul>"},{"location":"030Android/010Basic/#5-onstop","title":"5. onStop()","text":"<ul> <li>\u8c03\u7528\u65f6\u673a\uff1aActivity \u5b8c\u5168\u4e0d\u53ef\u89c1\u65f6\u8c03\u7528\uff08\u4f8b\u5982\uff0c\u7528\u6237\u5207\u6362\u5230\u5176\u4ed6\u5e94\u7528\u6216\u53e6\u4e00\u4e2a Activity \u5b8c\u5168\u8986\u76d6\u5f53\u524d Activity\uff09\u3002</li> <li>\u4f5c\u7528\uff1a\u91ca\u653e\u4e0d\u518d\u9700\u8981\u7684\u8d44\u6e90\uff0c\u6216\u6267\u884c\u8f83\u8017\u65f6\u7684\u64cd\u4f5c\uff08\u5982\u4fdd\u5b58\u6570\u636e\u5230\u6570\u636e\u5e93\uff09\u3002</li> </ul>"},{"location":"030Android/010Basic/#6-ondestroy","title":"6. onDestroy()","text":"<ul> <li>\u8c03\u7528\u65f6\u673a\uff1aActivity \u88ab\u9500\u6bc1\u524d\u8c03\u7528\uff08\u4f8b\u5982\uff0c\u7528\u6237\u6309\u4e0b\u8fd4\u56de\u952e\u6216\u8c03\u7528 <code>finish()</code> \u65b9\u6cd5\uff09\u3002</li> <li>\u4f5c\u7528\uff1a\u91ca\u653e\u6240\u6709\u8d44\u6e90\uff0c\u786e\u4fdd\u6ca1\u6709\u5185\u5b58\u6cc4\u6f0f\u3002</li> </ul>"},{"location":"030Android/010Basic/#7-onrestart","title":"7. onRestart()","text":"<ul> <li>\u8c03\u7528\u65f6\u673a\uff1aActivity \u4ece\u505c\u6b62\u72b6\u6001\u91cd\u65b0\u542f\u52a8\u65f6\u8c03\u7528\uff08\u4f8b\u5982\uff0c\u7528\u6237\u4ece\u5176\u4ed6\u5e94\u7528\u8fd4\u56de\uff09\u3002</li> <li>\u4f5c\u7528\uff1a\u901a\u5e38\u7528\u4e8e\u91cd\u65b0\u521d\u59cb\u5316\u5728 <code>onStop()</code> \u4e2d\u91ca\u653e\u7684\u8d44\u6e90\u3002</li> </ul>"},{"location":"030Android/010Basic/#_1","title":"\u751f\u547d\u5468\u671f\u56fe\u793a","text":"<p>\u4ee5\u4e0b\u662f Activity \u751f\u547d\u5468\u671f\u7684\u5178\u578b\u6d41\u7a0b\uff1a</p> <pre><code>onCreate() -&gt; onStart() -&gt; onResume() -&gt; Activity \u8fd0\u884c\u4e2d\n    \u2191          |               |\n    |          |               |\n    |       onStop()        onPause()\n    |          |               |\n    |          \u2193               \u2193\nonDestroy() &lt;- onRestart() &lt;- onStop()\n</code></pre>"},{"location":"030Android/010Basic/#_2","title":"\u7279\u6b8a\u60c5\u51b5","text":"<ol> <li>\u914d\u7f6e\u66f4\u6539\uff08\u5982\u5c4f\u5e55\u65cb\u8f6c\uff09\uff1a</li> <li>Activity \u4f1a\u88ab\u9500\u6bc1\u5e76\u91cd\u65b0\u521b\u5efa\uff0c\u8c03\u7528 <code>onDestroy()</code> \u548c <code>onCreate()</code>\u3002</li> <li> <p>\u53ef\u4ee5\u901a\u8fc7 <code>onSaveInstanceState()</code> \u4fdd\u5b58\u4e34\u65f6\u6570\u636e\uff0c\u5e76\u5728 <code>onCreate()</code> \u6216 <code>onRestoreInstanceState()</code> \u4e2d\u6062\u590d\u3002</p> </li> <li> <p>\u540e\u53f0\u88ab\u7cfb\u7edf\u56de\u6536\uff1a</p> </li> <li>\u5982\u679c\u7cfb\u7edf\u5185\u5b58\u4e0d\u8db3\uff0c\u540e\u53f0\u7684 Activity \u53ef\u80fd\u4f1a\u88ab\u9500\u6bc1\u3002\u6b64\u65f6\u53ef\u4ee5\u901a\u8fc7 <code>onSaveInstanceState()</code> \u4fdd\u5b58\u72b6\u6001\uff0c\u5e76\u5728\u91cd\u65b0\u521b\u5efa\u65f6\u6062\u590d\u3002</li> </ol>"},{"location":"030Android/010Basic/#_3","title":"\u5e38\u7528\u573a\u666f","text":"<ul> <li>\u521d\u59cb\u5316\u64cd\u4f5c\uff1a\u5728 <code>onCreate()</code> \u4e2d\u5b8c\u6210\u3002</li> <li>\u8d44\u6e90\u91ca\u653e\uff1a\u5728 <code>onPause()</code> \u6216 <code>onStop()</code> \u4e2d\u5b8c\u6210\u3002</li> <li>\u6570\u636e\u4fdd\u5b58\uff1a\u5728 <code>onPause()</code> \u6216 <code>onSaveInstanceState()</code> \u4e2d\u5b8c\u6210\u3002</li> <li>\u6062\u590d\u6570\u636e\uff1a\u5728 <code>onCreate()</code> \u6216 <code>onRestoreInstanceState()</code> \u4e2d\u5b8c\u6210\u3002</li> </ul> <p>\u7406\u89e3 Activity \u7684\u751f\u547d\u5468\u671f\u5bf9\u4e8e\u5f00\u53d1\u7a33\u5b9a\u3001\u9ad8\u6548\u7684 Android \u5e94\u7528\u81f3\u5173\u91cd\u8981\u3002</p>"},{"location":"030Android/010Basic/#fragment","title":"Fragment\u7684\u751f\u547d\u5468\u671f","text":"\u7b54\u6848 <p>\u5728 Android \u5f00\u53d1\u4e2d\uff0cFragment \u662f\u4e00\u4e2a\u53ef\u4ee5\u5d4c\u5165\u5230 Activity \u4e2d\u7684\u6a21\u5757\u5316\u7ec4\u4ef6\uff0c\u7528\u4e8e\u6784\u5efa\u7075\u6d3b\u7684\u7528\u6237\u754c\u9762\u3002Fragment \u7684\u751f\u547d\u5468\u671f\u4e0e Activity \u7684\u751f\u547d\u5468\u671f\u5bc6\u5207\u76f8\u5173\uff0c\u4f46\u4e5f\u6709\u5176\u72ec\u7279\u7684\u56de\u8c03\u65b9\u6cd5\u3002\u4ee5\u4e0b\u662f Fragment \u751f\u547d\u5468\u671f\u7684\u4e3b\u8981\u65b9\u6cd5\uff1a</p>"},{"location":"030Android/010Basic/#1-onattach","title":"1. onAttach()","text":"<ul> <li>\u8c03\u7528\u65f6\u673a\uff1aFragment \u4e0e Activity \u5173\u8054\u65f6\u8c03\u7528\u3002</li> <li>\u4f5c\u7528\uff1a\u53ef\u4ee5\u83b7\u53d6\u4e0e Fragment \u5173\u8054\u7684 Activity \u5f15\u7528\uff0c\u901a\u5e38\u7528\u4e8e\u521d\u59cb\u5316\u4e0e Activity \u7684\u4ea4\u4e92\u3002</li> </ul>"},{"location":"030Android/010Basic/#2-oncreate","title":"2. onCreate()","text":"<ul> <li>\u8c03\u7528\u65f6\u673a\uff1aFragment \u521b\u5efa\u65f6\u8c03\u7528\u3002</li> <li>\u4f5c\u7528\uff1a\u7528\u4e8e\u521d\u59cb\u5316 Fragment \u7684\u53d8\u91cf\u548c\u72b6\u6001\u3002\u6b64\u65f6 Fragment \u7684\u89c6\u56fe\u5c1a\u672a\u521b\u5efa\u3002</li> </ul>"},{"location":"030Android/010Basic/#3-oncreateview","title":"3. onCreateView()","text":"<ul> <li>\u8c03\u7528\u65f6\u673a\uff1aFragment \u521b\u5efa\u5176\u89c6\u56fe\u5c42\u6b21\u7ed3\u6784\u65f6\u8c03\u7528\u3002</li> <li>\u4f5c\u7528\uff1a\u8fd4\u56de Fragment \u7684\u89c6\u56fe\uff08\u901a\u8fc7 <code>LayoutInflater</code> \u52a0\u8f7d\u5e03\u5c40\uff09\u3002\u5982\u679c Fragment \u6ca1\u6709 UI\uff0c\u53ef\u4ee5\u8fd4\u56de <code>null</code>\u3002</li> <li>\u53c2\u6570\uff1a<ul> <li><code>LayoutInflater inflater</code>\uff1a\u7528\u4e8e\u52a0\u8f7d\u5e03\u5c40\u3002</li> <li><code>ViewGroup container</code>\uff1a\u7236\u5bb9\u5668\u3002</li> <li><code>Bundle savedInstanceState</code>\uff1a\u4fdd\u5b58\u7684\u72b6\u6001\u6570\u636e\u3002</li> </ul> </li> </ul>"},{"location":"030Android/010Basic/#4-onviewcreated","title":"4. onViewCreated()","text":"<ul> <li>\u8c03\u7528\u65f6\u673a\uff1a<code>onCreateView()</code> \u8fd4\u56de\u540e\u8c03\u7528\uff0c\u89c6\u56fe\u5df2\u7ecf\u521b\u5efa\u5b8c\u6210\u3002</li> <li>\u4f5c\u7528\uff1a\u53ef\u4ee5\u5728\u6b64\u65b9\u6cd5\u4e2d\u5bf9\u89c6\u56fe\u8fdb\u884c\u521d\u59cb\u5316\u64cd\u4f5c\uff08\u5982\u67e5\u627e\u89c6\u56fe\u3001\u8bbe\u7f6e\u76d1\u542c\u5668\u7b49\uff09\u3002</li> </ul>"},{"location":"030Android/010Basic/#5-onactivitycreated","title":"5. onActivityCreated()","text":"<ul> <li>\u8c03\u7528\u65f6\u673a\uff1a\u5173\u8054\u7684 Activity \u7684 <code>onCreate()</code> \u65b9\u6cd5\u5b8c\u6210\u540e\u8c03\u7528\u3002</li> <li>\u4f5c\u7528\uff1a\u53ef\u4ee5\u5728\u6b64\u65b9\u6cd5\u4e2d\u6267\u884c\u4e0e Activity \u76f8\u5173\u7684\u521d\u59cb\u5316\u64cd\u4f5c\uff08\u4f8b\u5982\uff0c\u4f9d\u8d56 Activity \u7684\u89c6\u56fe\u6216\u6570\u636e\uff09\u3002</li> </ul>"},{"location":"030Android/010Basic/#6-onstart","title":"6. onStart()","text":"<ul> <li>\u8c03\u7528\u65f6\u673a\uff1aFragment \u53d8\u4e3a\u53ef\u89c1\u72b6\u6001\u65f6\u8c03\u7528\u3002</li> <li>\u4f5c\u7528\uff1aFragment \u8fdb\u5165\u524d\u53f0\uff0c\u4f46\u7528\u6237\u8fd8\u4e0d\u80fd\u4e0e\u4e4b\u4ea4\u4e92\u3002</li> </ul>"},{"location":"030Android/010Basic/#7-onresume","title":"7. onResume()","text":"<ul> <li>\u8c03\u7528\u65f6\u673a\uff1aFragment \u53ef\u4ee5\u4e0e\u7528\u6237\u4ea4\u4e92\u65f6\u8c03\u7528\u3002</li> <li>\u4f5c\u7528\uff1aFragment \u5904\u4e8e\u6d3b\u52a8\u72b6\u6001\uff0c\u7528\u6237\u53ef\u4ee5\u4e0e\u4e4b\u4ea4\u4e92\u3002</li> </ul>"},{"location":"030Android/010Basic/#8-onpause","title":"8. onPause()","text":"<ul> <li>\u8c03\u7528\u65f6\u673a\uff1aFragment \u5931\u53bb\u7126\u70b9\u4f46\u4ecd\u90e8\u5206\u53ef\u89c1\u65f6\u8c03\u7528\u3002</li> <li>\u4f5c\u7528\uff1a\u901a\u5e38\u7528\u4e8e\u91ca\u653e\u8d44\u6e90\u6216\u4fdd\u5b58\u6570\u636e\u3002</li> </ul>"},{"location":"030Android/010Basic/#9-onstop","title":"9. onStop()","text":"<ul> <li>\u8c03\u7528\u65f6\u673a\uff1aFragment \u5b8c\u5168\u4e0d\u53ef\u89c1\u65f6\u8c03\u7528\u3002</li> <li>\u4f5c\u7528\uff1a\u91ca\u653e\u4e0d\u518d\u9700\u8981\u7684\u8d44\u6e90\u3002</li> </ul>"},{"location":"030Android/010Basic/#10-ondestroyview","title":"10. onDestroyView()","text":"<ul> <li>\u8c03\u7528\u65f6\u673a\uff1aFragment \u7684\u89c6\u56fe\u88ab\u9500\u6bc1\u65f6\u8c03\u7528\u3002</li> <li>\u4f5c\u7528\uff1a\u6e05\u7406\u4e0e\u89c6\u56fe\u76f8\u5173\u7684\u8d44\u6e90\u3002</li> </ul>"},{"location":"030Android/010Basic/#11-ondestroy","title":"11. onDestroy()","text":"<ul> <li>\u8c03\u7528\u65f6\u673a\uff1aFragment \u88ab\u9500\u6bc1\u65f6\u8c03\u7528\u3002</li> <li>\u4f5c\u7528\uff1a\u91ca\u653e\u6240\u6709\u8d44\u6e90\u3002</li> </ul>"},{"location":"030Android/010Basic/#12-ondetach","title":"12. onDetach()","text":"<ul> <li>\u8c03\u7528\u65f6\u673a\uff1aFragment \u4e0e Activity \u89e3\u9664\u5173\u8054\u65f6\u8c03\u7528\u3002</li> <li>\u4f5c\u7528\uff1a\u6e05\u7406\u4e0e Activity \u7684\u5f15\u7528\u3002</li> </ul>"},{"location":"030Android/010Basic/#_4","title":"\u751f\u547d\u5468\u671f\u56fe\u793a","text":"<p>\u4ee5\u4e0b\u662f Fragment \u751f\u547d\u5468\u671f\u7684\u5178\u578b\u6d41\u7a0b\uff1a</p> <pre><code>onAttach() -&gt; onCreate() -&gt; onCreateView() -&gt; onViewCreated() -&gt; onActivityCreated()\n    \u2191                                                                 |\n    |                                                                 \u2193\nonDetach() &lt;- onDestroy() &lt;- onDestroyView() &lt;- onStop() &lt;- onPause()\n</code></pre>"},{"location":"030Android/010Basic/#fragment-activity","title":"Fragment \u4e0e Activity \u751f\u547d\u5468\u671f\u7684\u5173\u7cfb","text":"<p>Fragment \u7684\u751f\u547d\u5468\u671f\u53d7\u5176\u5bbf\u4e3b Activity \u7684\u751f\u547d\u5468\u671f\u5f71\u54cd\u3002\u4f8b\u5982\uff1a - \u5f53 Activity \u7684 <code>onCreate()</code> \u88ab\u8c03\u7528\u65f6\uff0cFragment \u7684 <code>onAttach()</code>\u3001<code>onCreate()</code> \u548c <code>onCreateView()</code> \u4f1a\u88ab\u8c03\u7528\u3002 - \u5f53 Activity \u7684 <code>onDestroy()</code> \u88ab\u8c03\u7528\u65f6\uff0cFragment \u7684 <code>onDestroyView()</code>\u3001<code>onDestroy()</code> \u548c <code>onDetach()</code> \u4f1a\u88ab\u8c03\u7528\u3002</p>"},{"location":"030Android/010Basic/#_5","title":"\u7279\u6b8a\u60c5\u51b5","text":"<ol> <li>Fragment \u7684 <code>setRetainInstance(true)</code>\uff1a</li> <li>\u5f53 Activity \u56e0\u914d\u7f6e\u66f4\u6539\uff08\u5982\u5c4f\u5e55\u65cb\u8f6c\uff09\u88ab\u9500\u6bc1\u5e76\u91cd\u65b0\u521b\u5efa\u65f6\uff0cFragment \u4e0d\u4f1a\u88ab\u9500\u6bc1\uff0c\u800c\u662f\u4fdd\u7559\u5b9e\u4f8b\u3002</li> <li> <p>\u9002\u7528\u4e8e\u9700\u8981\u5728\u914d\u7f6e\u66f4\u6539\u65f6\u4fdd\u7559\u6570\u636e\u7684\u573a\u666f\u3002</p> </li> <li> <p>Fragment \u7684 <code>onSaveInstanceState()</code>\uff1a</p> </li> <li>\u7528\u4e8e\u4fdd\u5b58 Fragment \u7684\u4e34\u65f6\u72b6\u6001\uff08\u7c7b\u4f3c\u4e8e Activity \u7684 <code>onSaveInstanceState()</code>\uff09\u3002</li> <li>\u5728 <code>onCreate()</code>\u3001<code>onCreateView()</code> \u6216 <code>onViewCreated()</code> \u4e2d\u53ef\u4ee5\u901a\u8fc7 <code>savedInstanceState</code> \u6062\u590d\u72b6\u6001\u3002</li> </ol>"},{"location":"030Android/010Basic/#_6","title":"\u5e38\u7528\u573a\u666f","text":"<ul> <li>\u521d\u59cb\u5316\u89c6\u56fe\uff1a\u5728 <code>onCreateView()</code> \u6216 <code>onViewCreated()</code> \u4e2d\u5b8c\u6210\u3002</li> <li>\u91ca\u653e\u8d44\u6e90\uff1a\u5728 <code>onPause()</code>\u3001<code>onStop()</code> \u6216 <code>onDestroyView()</code> \u4e2d\u5b8c\u6210\u3002</li> <li>\u4fdd\u5b58\u72b6\u6001\uff1a\u5728 <code>onSaveInstanceState()</code> \u4e2d\u5b8c\u6210\u3002</li> <li>\u6062\u590d\u72b6\u6001\uff1a\u5728 <code>onCreate()</code>\u3001<code>onCreateView()</code> \u6216 <code>onViewCreated()</code> \u4e2d\u5b8c\u6210\u3002</li> </ul> <p>\u7406\u89e3 Fragment \u7684\u751f\u547d\u5468\u671f\u5bf9\u4e8e\u6784\u5efa\u7075\u6d3b\u3001\u9ad8\u6548\u7684 Android \u5e94\u7528\u81f3\u5173\u91cd\u8981\uff0c\u5c24\u5176\u662f\u5728\u4f7f\u7528\u591a\u4e2a Fragment \u6784\u5efa\u590d\u6742 UI \u65f6\u3002</p>"},{"location":"030Android/010Basic/#android-fragmentargs","title":"Android Fragment\u4e3a\u4ec0\u4e48\u4e0d\u80fd\u76f4\u63a5\u521d\u59cb\u5316\u4f20\u9012\u53c2\u6570\uff0c\u800c\u662f\u8981\u7528\u4ec0\u4e48args","text":"\u7b54\u6848 <p>\u5728 Android \u5f00\u53d1\u4e2d\uff0cFragment \u4e0d\u80fd\u76f4\u63a5\u901a\u8fc7\u6784\u9020\u51fd\u6570\u4f20\u9012\u53c2\u6570\uff0c\u4e3b\u8981\u662f\u56e0\u4e3a\u7cfb\u7edf\u5728\u91cd\u5efa Fragment \u65f6\u53ef\u80fd\u4f1a\u8c03\u7528\u9ed8\u8ba4\u7684\u65e0\u53c2\u6784\u9020\u51fd\u6570\u3002\u4e3a\u4e86\u786e\u4fdd Fragment \u5728\u91cd\u5efa\u65f6\u80fd\u591f\u6b63\u786e\u6062\u590d\u72b6\u6001\uff0cAndroid \u63a8\u8350\u4f7f\u7528 <code>Bundle</code> \u548c <code>arguments</code> \u6765\u4f20\u9012\u53c2\u6570\u3002arguments\u7c7b\u578b\u5c31\u662fBundle\u3002</p>"},{"location":"030Android/010Basic/#_7","title":"\u539f\u56e0","text":"<ol> <li>\u7cfb\u7edf\u91cd\u5efa Fragment\uff1a\u5f53\u7cfb\u7edf\u91cd\u5efa Fragment\uff08\u5982\u5c4f\u5e55\u65cb\u8f6c\u3001\u5185\u5b58\u56de\u6536\u7b49\uff09\u65f6\uff0c\u4f1a\u8c03\u7528\u9ed8\u8ba4\u7684\u65e0\u53c2\u6784\u9020\u51fd\u6570\u3002\u5982\u679c\u4f9d\u8d56\u6784\u9020\u51fd\u6570\u4f20\u9012\u53c2\u6570\uff0c\u8fd9\u4e9b\u53c2\u6570\u4f1a\u5728\u91cd\u5efa\u65f6\u4e22\u5931\u3002</li> <li>\u751f\u547d\u5468\u671f\u7ba1\u7406\uff1aFragment \u7684\u751f\u547d\u5468\u671f\u7531\u7cfb\u7edf\u7ba1\u7406\uff0c\u76f4\u63a5\u901a\u8fc7\u6784\u9020\u51fd\u6570\u4f20\u9012\u53c2\u6570\u53ef\u80fd\u5bfc\u81f4\u4e0d\u53ef\u9884\u89c1\u7684\u9519\u8bef\u3002</li> </ol>"},{"location":"030Android/010Basic/#bundle-arguments","title":"\u63a8\u8350\u65b9\u5f0f\uff1a\u4f7f\u7528 <code>Bundle</code> \u548c <code>arguments</code>","text":"<p>\u901a\u8fc7 <code>Bundle</code> \u4f20\u9012\u53c2\u6570\u53ef\u4ee5\u786e\u4fdd\u5728 Fragment \u91cd\u5efa\u65f6\u53c2\u6570\u80fd\u591f\u6b63\u786e\u6062\u590d\u3002</p>"},{"location":"030Android/010Basic/#_8","title":"\u793a\u4f8b","text":"<ol> <li> <p>\u521b\u5efa Fragment \u5e76\u8bbe\u7f6e\u53c2\u6570\uff1a <pre><code>public static MyFragment newInstance(String param1, int param2) {\n    MyFragment fragment = new MyFragment();\n    Bundle args = new Bundle();\n    args.putString(\"key1\", param1);\n    args.putInt(\"key2\", param2);\n    fragment.setArguments(args);\n    return fragment;\n}\n</code></pre></p> </li> <li> <p>\u5728 Fragment \u4e2d\u83b7\u53d6\u53c2\u6570\uff1a <pre><code>@Override\npublic void onCreate(Bundle savedInstanceState) {\n    super.onCreate(savedInstanceState);\n    if (getArguments() != null) {\n        String param1 = getArguments().getString(\"key1\");\n        int param2 = getArguments().getInt(\"key2\");\n    }\n}\n</code></pre></p> </li> </ol>"},{"location":"030Android/010Basic/#_9","title":"\u603b\u7ed3","text":"<p>\u4f7f\u7528 <code>Bundle</code> \u548c <code>arguments</code> \u4f20\u9012\u53c2\u6570\u662f Android \u63a8\u8350\u7684\u65b9\u5f0f\uff0c\u80fd\u591f\u786e\u4fdd Fragment \u5728\u91cd\u5efa\u65f6\u53c2\u6570\u4e0d\u4f1a\u4e22\u5931\uff0c\u540c\u65f6\u907f\u514d\u76f4\u63a5\u901a\u8fc7\u6784\u9020\u51fd\u6570\u4f20\u9012\u53c2\u6570\u5e26\u6765\u7684\u95ee\u9898\u3002</p>"},{"location":"030Android/010Basic/#bundle-arguments_1","title":"\u5173\u4e8e <code>Bundle</code> \u548c <code>arguments</code> \u7684\u5177\u4f53\u5b58\u50a8\u4f4d\u7f6e\u3001\u5b58\u50a8\u6d41\u7a0b\u4ee5\u53ca\u6062\u590d\u6570\u636e\u7684\u6d41\u7a0b\u3002","text":""},{"location":"030Android/010Basic/#1","title":"1. \u5b58\u50a8\u4f4d\u7f6e","text":"<p><code>Bundle</code> \u548c <code>arguments</code> \u7684\u6570\u636e\u6700\u7ec8\u4f1a\u88ab\u5b58\u50a8\u5230\u4ee5\u4e0b\u4e24\u4e2a\u5730\u65b9\u4e4b\u4e00\uff1a 1. \u5185\u5b58\uff1a\u5982\u679c Activity \u6216 Fragment \u53ea\u662f\u88ab\u6682\u65f6\u9500\u6bc1\uff08\u4f8b\u5982\u5c4f\u5e55\u65cb\u8f6c\uff09\uff0c\u6570\u636e\u4f1a\u4fdd\u5b58\u5728\u5185\u5b58\u4e2d\u3002 2. \u78c1\u76d8\uff1a\u5982\u679c\u7cfb\u7edf\u5185\u5b58\u4e0d\u8db3\uff0cActivity \u6216 Fragment \u88ab\u5b8c\u5168\u9500\u6bc1\uff0c\u6570\u636e\u4f1a\u88ab\u5e8f\u5217\u5316\u5e76\u4fdd\u5b58\u5230\u78c1\u76d8\uff08\u5177\u4f53\u6765\u8bf4\u662f\u4fdd\u5b58\u5230 <code>Activity</code> \u7684 <code>onSaveInstanceState</code> \u751f\u6210\u7684 <code>Bundle</code> \u4e2d\uff09\u3002</p>"},{"location":"030Android/010Basic/#2","title":"2. \u5b58\u50a8\u6d41\u7a0b","text":"<p>\u5f53\u7cfb\u7edf\u9700\u8981\u9500\u6bc1\u5e76\u91cd\u5efa Fragment \u65f6\uff0c\u6570\u636e\u7684\u5b58\u50a8\u6d41\u7a0b\u5982\u4e0b\uff1a</p>"},{"location":"030Android/010Basic/#1fragment-onsaveinstancestate","title":"\u6b65\u9aa4 1\uff1aFragment \u7684 <code>onSaveInstanceState</code> \u88ab\u8c03\u7528","text":"<ul> <li>\u5f53 Fragment \u5373\u5c06\u88ab\u9500\u6bc1\u65f6\uff0c\u7cfb\u7edf\u4f1a\u8c03\u7528 <code>onSaveInstanceState(Bundle outState)</code> \u65b9\u6cd5\u3002</li> <li>\u5982\u679c Fragment \u6709\u901a\u8fc7 <code>setArguments()</code> \u8bbe\u7f6e\u7684 <code>arguments</code>\uff0c\u7cfb\u7edf\u4f1a\u5c06\u8fd9\u4e9b <code>arguments</code> \u4fdd\u5b58\u5230 <code>outState</code> \u4e2d\u3002</li> </ul>"},{"location":"030Android/010Basic/#2-bundle","title":"\u6b65\u9aa4 2\uff1a\u6570\u636e\u5199\u5165 <code>Bundle</code>","text":"<ul> <li><code>Bundle</code> \u662f\u4e00\u4e2a\u952e\u503c\u5bf9\u5bb9\u5668\uff0c\u5185\u90e8\u4f7f\u7528 <code>ArrayMap</code> \u5b58\u50a8\u6570\u636e\u3002</li> <li>\u6570\u636e\u4f1a\u88ab\u5e8f\u5217\u5316\u4e3a\u5b57\u8282\u6d41\uff08\u901a\u8fc7 <code>Parcel</code> \u5b9e\u73b0\uff09\uff0c\u5e76\u5199\u5165 <code>Bundle</code>\u3002</li> </ul>"},{"location":"030Android/010Basic/#3bundle","title":"\u6b65\u9aa4 3\uff1a<code>Bundle</code> \u4fdd\u5b58\u5230\u5185\u5b58\u6216\u78c1\u76d8","text":"<ul> <li>\u5982\u679c Activity \u6216 Fragment \u53ea\u662f\u6682\u65f6\u9500\u6bc1\uff08\u4f8b\u5982\u5c4f\u5e55\u65cb\u8f6c\uff09\uff0c<code>Bundle</code> \u4f1a\u4fdd\u5b58\u5728\u5185\u5b58\u4e2d\u3002</li> <li>\u5982\u679c\u7cfb\u7edf\u5185\u5b58\u4e0d\u8db3\uff0cActivity \u6216 Fragment \u88ab\u5b8c\u5168\u9500\u6bc1\uff0c<code>Bundle</code> \u4f1a\u88ab\u5e8f\u5217\u5316\u5e76\u4fdd\u5b58\u5230\u78c1\u76d8\uff08\u901a\u8fc7 <code>Activity</code> \u7684 <code>onSaveInstanceState</code> \u673a\u5236\uff09\u3002</li> </ul>"},{"location":"030Android/010Basic/#3","title":"3. \u6062\u590d\u6570\u636e\u7684\u6d41\u7a0b","text":"<p>\u5f53 Fragment \u88ab\u91cd\u5efa\u65f6\uff0c\u6570\u636e\u7684\u6062\u590d\u6d41\u7a0b\u5982\u4e0b\uff1a</p>"},{"location":"030Android/010Basic/#1fragment","title":"\u6b65\u9aa4 1\uff1aFragment \u7684\u9ed8\u8ba4\u6784\u9020\u51fd\u6570\u88ab\u8c03\u7528","text":"<ul> <li>\u7cfb\u7edf\u4f1a\u8c03\u7528 Fragment \u7684\u65e0\u53c2\u6784\u9020\u51fd\u6570\u521b\u5efa\u4e00\u4e2a\u65b0\u7684 Fragment \u5b9e\u4f8b\u3002</li> </ul>"},{"location":"030Android/010Basic/#2bundle","title":"\u6b65\u9aa4 2\uff1a<code>Bundle</code> \u6570\u636e\u6062\u590d","text":"<ul> <li>\u7cfb\u7edf\u4f1a\u5c06\u4e4b\u524d\u4fdd\u5b58\u7684 <code>Bundle</code> \u6570\u636e\u901a\u8fc7 <code>setArguments(Bundle args)</code> \u65b9\u6cd5\u4f20\u9012\u7ed9\u65b0\u7684 Fragment \u5b9e\u4f8b\u3002</li> <li>\u8fd9\u4e2a <code>Bundle</code> \u5c31\u662f\u4e4b\u524d\u901a\u8fc7 <code>onSaveInstanceState</code> \u4fdd\u5b58\u7684\u6570\u636e\u3002</li> </ul>"},{"location":"030Android/010Basic/#3fragment-oncreate","title":"\u6b65\u9aa4 3\uff1aFragment \u7684 <code>onCreate</code> \u88ab\u8c03\u7528","text":"<ul> <li>\u5728 <code>onCreate(Bundle savedInstanceState)</code> \u65b9\u6cd5\u4e2d\uff0c\u53ef\u4ee5\u901a\u8fc7 <code>getArguments()</code> \u83b7\u53d6\u5230\u4e4b\u524d\u4fdd\u5b58\u7684 <code>arguments</code>\u3002</li> <li>\u5982\u679c <code>savedInstanceState</code> \u4e0d\u4e3a\u7a7a\uff0c\u4e5f\u53ef\u4ee5\u901a\u8fc7\u5b83\u83b7\u53d6\u5176\u4ed6\u72b6\u6001\u6570\u636e\u3002</li> </ul>"},{"location":"030Android/010Basic/#4","title":"4. \u5177\u4f53\u5b58\u50a8\u548c\u6062\u590d\u7684\u4ee3\u7801\u793a\u4f8b","text":""},{"location":"030Android/010Basic/#_10","title":"\u5b58\u50a8\u6570\u636e","text":"<pre><code>@Override\npublic void onSaveInstanceState(Bundle outState) {\n    super.onSaveInstanceState(outState);\n    // \u4fdd\u5b58\u989d\u5916\u7684\u6570\u636e\u5230 outState\n    outState.putString(\"key\", \"value\");\n}\n</code></pre>"},{"location":"030Android/010Basic/#_11","title":"\u6062\u590d\u6570\u636e","text":"<pre><code>@Override\npublic void onCreate(Bundle savedInstanceState) {\n    super.onCreate(savedInstanceState);\n    if (savedInstanceState != null) {\n        // \u4ece savedInstanceState \u4e2d\u6062\u590d\u6570\u636e\n        String value = savedInstanceState.getString(\"key\");\n    }\n    if (getArguments() != null) {\n        // \u4ece arguments \u4e2d\u6062\u590d\u6570\u636e\n        String param1 = getArguments().getString(\"key1\");\n    }\n}\n</code></pre>"},{"location":"030Android/010Basic/#5","title":"5. \u5b58\u50a8\u548c\u6062\u590d\u7684\u5e95\u5c42\u6d41\u7a0b","text":""},{"location":"030Android/010Basic/#_12","title":"\u5b58\u50a8\u6d41\u7a0b","text":"<ol> <li>\u7cfb\u7edf\u8c03\u7528 <code>Fragment.onSaveInstanceState(Bundle outState)</code>\u3002</li> <li><code>arguments</code> \u88ab\u5199\u5165 <code>outState</code>\u3002</li> <li><code>outState</code> \u88ab\u5e8f\u5217\u5316\u4e3a\u5b57\u8282\u6d41\uff08\u901a\u8fc7 <code>Parcel</code>\uff09\u3002</li> <li>\u5b57\u8282\u6d41\u88ab\u4fdd\u5b58\u5230\u5185\u5b58\u6216\u78c1\u76d8\u3002</li> </ol>"},{"location":"030Android/010Basic/#_13","title":"\u6062\u590d\u6d41\u7a0b","text":"<ol> <li>\u7cfb\u7edf\u8c03\u7528 Fragment \u7684\u65e0\u53c2\u6784\u9020\u51fd\u6570\u521b\u5efa\u65b0\u5b9e\u4f8b\u3002</li> <li>\u7cfb\u7edf\u5c06\u4e4b\u524d\u4fdd\u5b58\u7684 <code>Bundle</code> \u6570\u636e\u901a\u8fc7 <code>setArguments(Bundle args)</code> \u4f20\u9012\u7ed9\u65b0\u5b9e\u4f8b\u3002</li> <li>\u5728 <code>onCreate(Bundle savedInstanceState)</code> \u4e2d\uff0c\u53ef\u4ee5\u901a\u8fc7 <code>getArguments()</code> \u6216 <code>savedInstanceState</code> \u83b7\u53d6\u6570\u636e\u3002</li> </ol>"},{"location":"030Android/010Basic/#6","title":"6. \u603b\u7ed3","text":"<ul> <li>\u5b58\u50a8\u4f4d\u7f6e\uff1a<code>Bundle</code> \u548c <code>arguments</code> \u7684\u6570\u636e\u6700\u7ec8\u5b58\u50a8\u5728\u5185\u5b58\u6216\u78c1\u76d8\u4e2d\u3002</li> <li>\u5b58\u50a8\u6d41\u7a0b\uff1a\u901a\u8fc7 <code>onSaveInstanceState</code> \u5c06\u6570\u636e\u5199\u5165 <code>Bundle</code>\uff0c\u7136\u540e\u5e8f\u5217\u5316\u5e76\u4fdd\u5b58\u3002</li> <li>\u6062\u590d\u6d41\u7a0b\uff1a\u7cfb\u7edf\u901a\u8fc7 <code>setArguments</code> \u5c06\u4fdd\u5b58\u7684 <code>Bundle</code> \u4f20\u9012\u7ed9\u65b0\u7684 Fragment \u5b9e\u4f8b\uff0c\u5e76\u5728 <code>onCreate</code> \u4e2d\u6062\u590d\u6570\u636e\u3002</li> </ul> <p>\u8fd9\u79cd\u673a\u5236\u786e\u4fdd\u4e86 Fragment \u5728\u91cd\u5efa\u65f6\u80fd\u591f\u6b63\u786e\u6062\u590d\u72b6\u6001\uff0c\u907f\u514d\u4e86\u6570\u636e\u4e22\u5931\u3002</p>"},{"location":"030Android/010Basic/#activity_1","title":"Activity\u7684\u542f\u52a8\u6a21\u5f0f\uff0c\u4ee5\u53ca\u5b83\u4eec\u4e4b\u95f4\u7684\u533a\u522b\uff1f","text":"\u7b54\u6848 <p>\u5728Android\u5f00\u53d1\u4e2d\uff0cActivity\u7684\u542f\u52a8\u6a21\u5f0f\uff08Launch Mode\uff09\u51b3\u5b9a\u4e86Activity\u7684\u5b9e\u4f8b\u5982\u4f55\u4e0e\u4efb\u52a1\u6808\uff08Task\uff09\u5173\u8054\u3002Android\u63d0\u4f9b\u4e86\u56db\u79cd\u542f\u52a8\u6a21\u5f0f\uff0c\u6bcf\u79cd\u6a21\u5f0f\u9002\u7528\u4e8e\u4e0d\u540c\u7684\u573a\u666f\u3002</p>"},{"location":"030Android/010Basic/#1-standard","title":"1. standard\uff08\u6807\u51c6\u6a21\u5f0f\uff09","text":"<ul> <li>\u9ed8\u8ba4\u6a21\u5f0f\uff1a\u6bcf\u6b21\u542f\u52a8Activity\u90fd\u4f1a\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u5b9e\u4f8b\uff0c\u5e76\u653e\u5165\u5f53\u524d\u4efb\u52a1\u6808\u4e2d\u3002</li> <li>\u7279\u70b9\uff1a</li> <li>\u6bcf\u6b21\u542f\u52a8\u90fd\u4f1a\u521b\u5efa\u65b0\u5b9e\u4f8b\u3002</li> <li>\u540c\u4e00\u4e2aActivity\u53ef\u4ee5\u6709\u591a\u4e2a\u5b9e\u4f8b\u5b58\u5728\u4e8e\u4e0d\u540c\u7684\u4efb\u52a1\u6808\u4e2d\u3002</li> <li>\u9002\u7528\u573a\u666f\uff1a</li> <li>\u5927\u591a\u6570\u666e\u901aActivity\u3002</li> <li>\u4e0d\u9700\u8981\u7279\u6b8a\u5904\u7406\u7684\u4efb\u52a1\u6808\u7ba1\u7406\u3002</li> </ul>"},{"location":"030Android/010Basic/#2-singletop","title":"2. singleTop\uff08\u6808\u9876\u590d\u7528\u6a21\u5f0f\uff09","text":"<ul> <li>\u7279\u70b9\uff1a</li> <li>\u5982\u679cActivity\u5df2\u7ecf\u4f4d\u4e8e\u4efb\u52a1\u6808\u7684\u6808\u9876\uff0c\u5219\u4e0d\u4f1a\u521b\u5efa\u65b0\u5b9e\u4f8b\uff0c\u800c\u662f\u590d\u7528\u6808\u9876\u7684\u5b9e\u4f8b\uff0c\u5e76\u8c03\u7528<code>onNewIntent()</code>\u65b9\u6cd5\u3002</li> <li>\u5982\u679cActivity\u4e0d\u5728\u6808\u9876\uff0c\u5219\u4f1a\u521b\u5efa\u65b0\u5b9e\u4f8b\u3002</li> <li>\u9002\u7528\u573a\u666f\uff1a</li> <li>\u907f\u514d\u91cd\u590d\u521b\u5efa\u540c\u4e00\u4e2aActivity\u7684\u5b9e\u4f8b\u3002</li> <li>\u4f8b\u5982\uff0c\u901a\u77e5\u680f\u70b9\u51fb\u6253\u5f00\u540c\u4e00\u4e2aActivity\u65f6\uff0c\u907f\u514d\u91cd\u590d\u521b\u5efa\u3002</li> </ul>"},{"location":"030Android/010Basic/#3-singletask","title":"3. singleTask\uff08\u6808\u5185\u5355\u4f8b\u6a21\u5f0f\uff09","text":"<ul> <li>\u7279\u70b9\uff1a</li> <li>\u7cfb\u7edf\u4f1a\u68c0\u67e5\u4efb\u52a1\u6808\u4e2d\u662f\u5426\u5df2\u5b58\u5728\u8be5Activity\u7684\u5b9e\u4f8b\u3002\u5982\u679c\u5b58\u5728\uff0c\u5219\u5c06\u8be5\u5b9e\u4f8b\u4e4b\u4e0a\u7684\u6240\u6709Activity\u51fa\u6808\uff0c\u4f7f\u5176\u6210\u4e3a\u6808\u9876\uff0c\u5e76\u8c03\u7528<code>onNewIntent()</code>\u65b9\u6cd5\u3002</li> <li>\u5982\u679c\u4e0d\u5b58\u5728\uff0c\u5219\u521b\u5efa\u65b0\u5b9e\u4f8b\u5e76\u653e\u5165\u4efb\u52a1\u6808\u3002</li> <li>\u8be5\u6a21\u5f0f\u901a\u5e38\u4f1a\u5728\u4e00\u4e2a\u65b0\u7684\u4efb\u52a1\u6808\u4e2d\u521b\u5efaActivity\uff08\u901a\u8fc7<code>taskAffinity</code>\u5c5e\u6027\u6307\u5b9a\uff09\u3002</li> <li>\u9002\u7528\u573a\u666f\uff1a</li> <li>\u9700\u8981\u4fdd\u8bc1\u67d0\u4e2aActivity\u5728\u4efb\u52a1\u6808\u4e2d\u53ea\u6709\u4e00\u4e2a\u5b9e\u4f8b\u3002</li> <li>\u4f8b\u5982\uff0c\u5e94\u7528\u7684\u4e3b\u9875\uff08Home Activity\uff09\u901a\u5e38\u4f7f\u7528\u6b64\u6a21\u5f0f\uff0c\u786e\u4fdd\u7528\u6237\u8fd4\u56de\u5230\u4e3b\u9875\u65f6\uff0c\u5176\u4ed6Activity\u90fd\u88ab\u6e05\u9664\u3002</li> </ul>"},{"location":"030Android/010Basic/#4-singleinstance","title":"4. singleInstance\uff08\u5355\u5b9e\u4f8b\u6a21\u5f0f\uff09","text":"<ul> <li>\u7279\u70b9\uff1a</li> <li>\u8be5Activity\u4f1a\u5355\u72ec\u8fd0\u884c\u5728\u4e00\u4e2a\u65b0\u7684\u4efb\u52a1\u6808\u4e2d\uff0c\u4e14\u8be5\u4efb\u52a1\u6808\u4e2d\u53ea\u80fd\u6709\u8fd9\u4e00\u4e2aActivity\u3002</li> <li>\u5982\u679c\u518d\u6b21\u542f\u52a8\u8be5Activity\uff0c\u5219\u4f1a\u590d\u7528\u5df2\u6709\u7684\u5b9e\u4f8b\uff0c\u5e76\u8c03\u7528<code>onNewIntent()</code>\u65b9\u6cd5\u3002</li> <li>\u9002\u7528\u573a\u666f\uff1a</li> <li>\u9700\u8981\u5b8c\u5168\u72ec\u7acb\u8fd0\u884c\u7684Activity\u3002</li> <li>\u4f8b\u5982\uff0c\u6765\u7535\u754c\u9762\u6216\u95f9\u949f\u754c\u9762\uff0c\u786e\u4fdd\u5b83\u4eec\u72ec\u7acb\u4e8e\u5176\u4ed6\u4efb\u52a1\u6808\u3002</li> </ul>"},{"location":"030Android/010Basic/#_14","title":"\u542f\u52a8\u6a21\u5f0f\u7684\u8bbe\u7f6e\u65b9\u5f0f","text":"<ol> <li>\u5728<code>AndroidManifest.xml</code>\u4e2d\u58f0\u660e\uff1a <pre><code>&lt;activity android:name=\".MyActivity\"\n    android:launchMode=\"singleTask\" /&gt;\n</code></pre></li> <li>\u901a\u8fc7Intent\u6807\u5fd7\u8bbe\u7f6e\uff1a <pre><code>Intent intent = new Intent(this, MyActivity.class);\nintent.addFlags(Intent.FLAG_ACTIVITY_SINGLE_TOP);\nstartActivity(intent);\n</code></pre></li> </ol>"},{"location":"030Android/010Basic/#_15","title":"\u603b\u7ed3\u5bf9\u6bd4","text":"\u542f\u52a8\u6a21\u5f0f \u662f\u5426\u521b\u5efa\u65b0\u5b9e\u4f8b \u662f\u5426\u590d\u7528\u5b9e\u4f8b \u4efb\u52a1\u6808\u7ba1\u7406 \u9002\u7528\u573a\u666f standard \u603b\u662f\u521b\u5efa \u5426 \u653e\u5165\u5f53\u524d\u4efb\u52a1\u6808 \u666e\u901aActivity singleTop \u6808\u9876\u65f6\u4e0d\u521b\u5efa \u6808\u9876\u65f6\u590d\u7528 \u653e\u5165\u5f53\u524d\u4efb\u52a1\u6808 \u907f\u514d\u6808\u9876\u91cd\u590d\u521b\u5efa\uff08\u5982\u901a\u77e5\u8df3\u8f6c\uff09 singleTask \u6808\u5185\u65e0\u65f6\u521b\u5efa \u6808\u5185\u65f6\u590d\u7528 \u53ef\u80fd\u521b\u5efa\u65b0\u4efb\u52a1\u6808 \u4e3b\u9875\u6216\u552f\u4e00\u5b9e\u4f8b\uff08\u5982\u4e3b\u754c\u9762\uff09 singleInstance \u65b0\u4efb\u52a1\u6808\u4e2d\u521b\u5efa \u603b\u662f\u590d\u7528 \u5355\u72ec\u4efb\u52a1\u6808\uff0c\u4ec5\u4e00\u4e2aActivity \u5b8c\u5168\u72ec\u7acb\u8fd0\u884c\uff08\u5982\u6765\u7535\u754c\u9762\uff09"},{"location":"030Android/010Basic/#_16","title":"\u5b9e\u9645\u5e94\u7528\u573a\u666f","text":"<ol> <li>standard\uff1a\u666e\u901a\u9875\u9762\u8df3\u8f6c\uff0c\u5982\u5217\u8868\u9875\u8df3\u8f6c\u5230\u8be6\u60c5\u9875\u3002</li> <li>singleTop\uff1a\u907f\u514d\u91cd\u590d\u6253\u5f00\u540c\u4e00\u4e2a\u9875\u9762\uff0c\u5982\u901a\u77e5\u680f\u70b9\u51fb\u6253\u5f00\u540c\u4e00\u4e2a\u9875\u9762\u3002</li> <li>singleTask\uff1a\u5e94\u7528\u4e3b\u9875\uff0c\u786e\u4fdd\u7528\u6237\u8fd4\u56de\u65f6\u56de\u5230\u4e3b\u9875\u5e76\u6e05\u9664\u5176\u4ed6\u9875\u9762\u3002</li> <li>singleInstance\uff1a\u72ec\u7acb\u8fd0\u884c\u7684\u9875\u9762\uff0c\u5982\u6765\u7535\u754c\u9762\u6216\u95f9\u949f\u754c\u9762\u3002</li> </ol> <p>\u901a\u8fc7\u5408\u7406\u4f7f\u7528\u542f\u52a8\u6a21\u5f0f\uff0c\u53ef\u4ee5\u6709\u6548\u7ba1\u7406Activity\u7684\u5b9e\u4f8b\u548c\u4efb\u52a1\u6808\uff0c\u63d0\u5347\u7528\u6237\u4f53\u9a8c\u548c\u5e94\u7528\u6027\u80fd\u3002</p>"},{"location":"030Android/010Basic/#android-handler","title":"Android Handler\u6d88\u606f\u673a\u5236\u539f\u7406\uff1f","text":"\u7b54\u6848 <p>Android \u7684 Handler \u6d88\u606f\u673a\u5236\u7528\u4e8e\u7ebf\u7a0b\u95f4\u901a\u4fe1\uff0c\u4e3b\u8981\u7531 Handler\u3001Message\u3001MessageQueue \u548c Looper \u56db\u4e2a\u6838\u5fc3\u7ec4\u4ef6\u6784\u6210\u3002</p>"},{"location":"030Android/010Basic/#1-handler","title":"1. Handler","text":"<ul> <li>\u4f5c\u7528\uff1a\u53d1\u9001\u548c\u5904\u7406\u6d88\u606f\u3002</li> <li>\u529f\u80fd\uff1a</li> <li>\u53d1\u9001\u6d88\u606f\u5230 MessageQueue\u3002</li> <li>\u4ece MessageQueue \u4e2d\u53d6\u51fa\u6d88\u606f\u5e76\u5904\u7406\u3002</li> </ul>"},{"location":"030Android/010Basic/#2-message","title":"2. Message","text":"<ul> <li>\u4f5c\u7528\uff1a\u6d88\u606f\u7684\u8f7d\u4f53\u3002</li> <li>\u5185\u5bb9\uff1a\u5305\u542b\u6d88\u606f\u6807\u8bc6\uff08what\uff09\u3001\u6570\u636e\uff08obj\uff09\u3001\u5904\u7406\u65f6\u95f4\uff08when\uff09\u7b49\u3002</li> </ul>"},{"location":"030Android/010Basic/#3-messagequeue","title":"3. MessageQueue","text":"<ul> <li>\u4f5c\u7528\uff1a\u6d88\u606f\u961f\u5217\uff0c\u5b58\u50a8\u5f85\u5904\u7406\u7684\u6d88\u606f\u3002</li> <li>\u7279\u70b9\uff1a\u6309\u65f6\u95f4\u987a\u5e8f\u6392\u5217\uff0cLooper \u4ece\u4e2d\u53d6\u51fa\u6d88\u606f\u3002</li> </ul>"},{"location":"030Android/010Basic/#4-looper","title":"4. Looper","text":"<ul> <li>\u4f5c\u7528\uff1a\u6d88\u606f\u5faa\u73af\uff0c\u4e0d\u65ad\u4ece MessageQueue \u4e2d\u53d6\u51fa\u6d88\u606f\u5e76\u5206\u53d1\u7ed9 Handler\u3002</li> <li>\u7279\u70b9\uff1a</li> <li>\u6bcf\u4e2a\u7ebf\u7a0b\u53ea\u80fd\u6709\u4e00\u4e2a Looper\u3002</li> <li>\u901a\u8fc7 <code>Looper.prepare()</code> \u521b\u5efa\uff0c<code>Looper.loop()</code> \u542f\u52a8\u5faa\u73af\u3002</li> </ul>"},{"location":"030Android/010Basic/#_17","title":"\u5de5\u4f5c\u6d41\u7a0b","text":"<ol> <li>\u521b\u5efa Looper\uff1a<code>Looper.prepare()</code> \u521b\u5efa Looper \u5e76\u7ed1\u5b9a\u5230\u5f53\u524d\u7ebf\u7a0b\u3002</li> <li>\u542f\u52a8\u6d88\u606f\u5faa\u73af\uff1a<code>Looper.loop()</code> \u5f00\u59cb\u5faa\u73af\uff0c\u4ece MessageQueue \u4e2d\u53d6\u51fa\u6d88\u606f\u3002</li> <li>\u53d1\u9001\u6d88\u606f\uff1aHandler \u53d1\u9001\u6d88\u606f\u5230 MessageQueue\u3002</li> <li>\u5904\u7406\u6d88\u606f\uff1aLooper \u5c06\u6d88\u606f\u5206\u53d1\u7ed9 Handler \u7684 <code>handleMessage()</code> \u65b9\u6cd5\u5904\u7406\u3002</li> </ol>"},{"location":"030Android/010Basic/#_18","title":"\u793a\u4f8b\u4ee3\u7801","text":"<pre><code>// \u521b\u5efa Looper \u5e76\u542f\u52a8\u6d88\u606f\u5faa\u73af\nnew Thread(() -&gt; {\n    Looper.prepare();\n    Handler handler = new Handler() {\n        @Override\n        public void handleMessage(Message msg) {\n            // \u5904\u7406\u6d88\u606f\n        }\n    };\n    Looper.loop();\n}).start();\n\n// \u53d1\u9001\u6d88\u606f\nhandler.sendMessage(handler.obtainMessage(1, \"Hello\"));\n</code></pre>"},{"location":"030Android/010Basic/#_19","title":"\u603b\u7ed3","text":"<ul> <li>Handler\uff1a\u53d1\u9001\u548c\u5904\u7406\u6d88\u606f\u3002</li> <li>Message\uff1a\u6d88\u606f\u8f7d\u4f53\u3002</li> <li>MessageQueue\uff1a\u5b58\u50a8\u6d88\u606f\u3002</li> <li>Looper\uff1a\u5faa\u73af\u53d6\u51fa\u6d88\u606f\u5e76\u5206\u53d1\u3002</li> </ul> <p>\u8be5\u673a\u5236\u5b9e\u73b0\u4e86\u7ebf\u7a0b\u95f4\u7684\u5f02\u6b65\u901a\u4fe1\uff0c\u5e7f\u6cdb\u5e94\u7528\u4e8e Android \u5f00\u53d1\u3002</p>"},{"location":"030Android/010Basic/#messagequene","title":"MessageQuene\u662f\u4ec0\u4e48\u6570\u636e\u7ed3\u6784\uff0c\u4e3a\u4ec0\u4e48\u53ef\u4ee5\u63d2\u5165\uff1f\u4ec0\u4e48\u60c5\u51b5\u4f1a\u63d2\u5165\uff1f","text":"\u7b54\u6848"},{"location":"030Android/010Basic/#messagequeue","title":"MessageQueue \u7684\u6570\u636e\u7ed3\u6784","text":"<p><code>MessageQueue</code> \u662f\u4e00\u4e2a\u57fa\u4e8e\u5355\u5411\u94fe\u8868\u7684\u4f18\u5148\u7ea7\u961f\u5217\uff0c\u6d88\u606f\u6309\u65f6\u95f4\u987a\u5e8f\u6392\u5217\uff0c\u65f6\u95f4\u6700\u65e9\u7684\u6d88\u606f\u5728\u94fe\u8868\u5934\u90e8\u3002</p> <p>\u6e90\u7801\u5165\u4e0b <pre><code>public final class MessageQueue {\n    private static final String TAG = \"MessageQueue\";\n    private static final boolean DEBUG = false;\n\n    // True if the message queue can be quit.\n    @UnsupportedAppUsage\n    private final boolean mQuitAllowed;\n\n    @UnsupportedAppUsage\n    @SuppressWarnings(\"unused\")\n    private long mPtr; // used by native code\n\n    @UnsupportedAppUsage\n    Message mMessages;\n    private Message mLast;\n    @UnsupportedAppUsage\n    private final ArrayList&lt;IdleHandler&gt; mIdleHandlers = new ArrayList&lt;IdleHandler&gt;();\n    private SparseArray&lt;FileDescriptorRecord&gt; mFileDescriptorRecords;\n    private IdleHandler[] mPendingIdleHandlers;\n    private boolean mQuitting;\n</code></pre></p>"},{"location":"030Android/010Basic/#_20","title":"\u4e3a\u4ec0\u4e48\u53ef\u4ee5\u63d2\u5165\uff1f","text":"<p><code>MessageQueue</code> \u63d0\u4f9b\u4e86 <code>enqueueMessage()</code> \u65b9\u6cd5\uff0c\u7528\u4e8e\u63d2\u5165\u6d88\u606f\u3002\u63d2\u5165\u65f6\uff0c\u4f1a\u6839\u636e\u6d88\u606f\u7684 <code>when</code>\uff08\u5904\u7406\u65f6\u95f4\uff09\u5c06\u5176\u63d2\u5165\u5230\u5408\u9002\u7684\u4f4d\u7f6e\uff0c\u786e\u4fdd\u961f\u5217\u6309\u65f6\u95f4\u987a\u5e8f\u6392\u5217\u3002</p>"},{"location":"030Android/010Basic/#_21","title":"\u63d2\u5165\u64cd\u4f5c","text":"<ol> <li>\u63d2\u5165\u5230\u94fe\u8868\u5934\u90e8\uff1a\u5982\u679c\u961f\u5217\u4e3a\u7a7a\u6216\u65b0\u6d88\u606f\u7684\u5904\u7406\u65f6\u95f4\u65e9\u4e8e\u5f53\u524d\u5934\u90e8\u6d88\u606f\u3002</li> <li>\u63d2\u5165\u5230\u94fe\u8868\u4e2d\u95f4\uff1a\u5982\u679c\u65b0\u6d88\u606f\u7684\u5904\u7406\u65f6\u95f4\u4ecb\u4e8e\u5df2\u6709\u6d88\u606f\u4e4b\u95f4\u3002</li> <li>\u63d2\u5165\u5230\u94fe\u8868\u5c3e\u90e8\uff1a\u5982\u679c\u65b0\u6d88\u606f\u7684\u5904\u7406\u65f6\u95f4\u6700\u665a\u3002</li> </ol>"},{"location":"030Android/010Basic/#_22","title":"\u63d2\u5165\u7684\u65f6\u673a","text":"<ol> <li>Handler \u53d1\u9001\u6d88\u606f\uff1a</li> <li><code>sendMessage(Message msg)</code></li> <li><code>sendMessageDelayed(Message msg, long delayMillis)</code></li> <li><code>post(Runnable r)</code></li> <li> <p><code>postDelayed(Runnable r, long delayMillis)</code></p> </li> <li> <p>\u5b9a\u65f6\u4efb\u52a1\uff1a</p> </li> <li> <p>\u4f7f\u7528 <code>Handler</code> \u7684 <code>sendMessageDelayed()</code> \u6216 <code>postDelayed()</code> \u65b9\u6cd5\u53d1\u9001\u5ef6\u8fdf\u6d88\u606f\u3002</p> </li> <li> <p>IdleHandler\uff1a</p> </li> <li>\u5f53 <code>MessageQueue</code> \u7a7a\u95f2\u65f6\uff0c\u63d2\u5165 <code>IdleHandler</code> \u4efb\u52a1\u3002</li> </ol>"},{"location":"030Android/010Basic/#_23","title":"\u793a\u4f8b\u4ee3\u7801","text":"<pre><code>Handler handler = new Handler(Looper.getMainLooper()) {\n    @Override\n    public void handleMessage(Message msg) {\n        // \u5904\u7406\u6d88\u606f\n    }\n};\n\n// \u53d1\u9001\u5373\u65f6\u6d88\u606f\nhandler.sendMessage(handler.obtainMessage(1, \"Hello\"));\n\n// \u53d1\u9001\u5ef6\u8fdf\u6d88\u606f\nhandler.sendMessageDelayed(handler.obtainMessage(2, \"Delayed Hello\"), 1000);\n\n// \u4f7f\u7528 post \u65b9\u6cd5\u53d1\u9001 Runnable\nhandler.post(() -&gt; {\n    // \u6267\u884c\u4efb\u52a1\n});\n\n// \u4f7f\u7528 postDelayed \u65b9\u6cd5\u53d1\u9001\u5ef6\u8fdf Runnable\nhandler.postDelayed(() -&gt; {\n    // \u6267\u884c\u5ef6\u8fdf\u4efb\u52a1\n}, 1000);\n</code></pre>"},{"location":"030Android/010Basic/#_24","title":"\u603b\u7ed3","text":"<ul> <li>\u6570\u636e\u7ed3\u6784\uff1a\u57fa\u4e8e\u5355\u5411\u94fe\u8868\u7684\u4f18\u5148\u7ea7\u961f\u5217\u3002</li> <li>\u63d2\u5165\u64cd\u4f5c\uff1a\u901a\u8fc7 <code>enqueueMessage()</code> \u65b9\u6cd5\u6309\u65f6\u95f4\u987a\u5e8f\u63d2\u5165\u3002</li> <li>\u63d2\u5165\u65f6\u673a\uff1aHandler \u53d1\u9001\u6d88\u606f\u3001\u5b9a\u65f6\u4efb\u52a1\u3001IdleHandler \u7b49\u573a\u666f\u3002</li> </ul> <p>\u8fd9\u79cd\u8bbe\u8ba1\u786e\u4fdd\u4e86\u6d88\u606f\u6309\u65f6\u95f4\u987a\u5e8f\u5904\u7406\uff0c\u9002\u5408\u5f02\u6b65\u4efb\u52a1\u8c03\u5ea6\u3002</p>"},{"location":"030Android/010Basic/#android-handlermessagequeue","title":"Android Handler\u7684MessageQueue\u63d2\u5165\u673a\u5236\u8be6\u89e3","text":""},{"location":"030Android/010Basic/#messagequeue_1","title":"MessageQueue\u57fa\u672c\u7ed3\u6784","text":"<p>MessageQueue\u662fAndroid\u4e2dHandler\u673a\u5236\u7684\u6838\u5fc3\u7ec4\u4ef6\u4e4b\u4e00\uff0c\u5b83\u4f7f\u7528\u5355\u94fe\u8868\u7ed3\u6784\u6765\u7ef4\u62a4\u6d88\u606f\u961f\u5217\u3002\u6bcf\u4e2aMessage\u5bf9\u8c61\u90fd\u5305\u542b\u4e00\u4e2a<code>when</code>\u5b57\u6bb5\u8868\u793a\u6267\u884c\u65f6\u95f4\uff0c\u4ee5\u53ca<code>next</code>\u6307\u9488\u6307\u5411\u4e0b\u4e00\u4e2a\u6d88\u606f\u3002</p>"},{"location":"030Android/010Basic/#_25","title":"\u666e\u901a\u6d88\u606f\u7684\u63d2\u5165\u8fc7\u7a0b","text":"<p>\u5f53\u8c03\u7528<code>Handler.sendMessage()</code>\u6216\u76f8\u5173\u65b9\u6cd5\u65f6\uff0c\u6d88\u606f\u6700\u7ec8\u4f1a\u901a\u8fc7<code>MessageQueue.enqueueMessage()</code>\u65b9\u6cd5\u63d2\u5165\u961f\u5217\uff1a</p> <ol> <li>\u83b7\u53d6\u9501\uff1a\u9996\u5148\u83b7\u53d6MessageQueue\u7684\u5bf9\u8c61\u9501\uff0c\u4fdd\u8bc1\u7ebf\u7a0b\u5b89\u5168</li> <li>\u8bbe\u7f6e\u6d88\u606f\u65f6\u95f4\uff1a\u5982\u679c\u6d88\u606f\u6ca1\u6709\u660e\u786e\u5ef6\u8fdf\uff0c<code>when</code>\u8bbe\u7f6e\u4e3a\u5f53\u524d\u65f6\u95f4(SystemClock.uptimeMillis())</li> <li>\u67e5\u627e\u63d2\u5165\u4f4d\u7f6e\uff1a</li> <li>\u5982\u679c\u961f\u5217\u4e3a\u7a7a(<code>mMessages == null</code>)\u6216\u65b0\u6d88\u606f\u7684\u6267\u884c\u65f6\u95f4\u6700\u65e9\uff0c\u5219\u63d2\u5165\u961f\u5217\u5934\u90e8</li> <li>\u5426\u5219\u904d\u5386\u94fe\u8868\uff0c\u627e\u5230\u7b2c\u4e00\u4e2a\u6267\u884c\u65f6\u95f4\u665a\u4e8e\u65b0\u6d88\u606f\u7684\u4f4d\u7f6e\uff0c\u63d2\u5165\u5230\u5b83\u524d\u9762</li> <li>\u5524\u9192\u961f\u5217\uff1a\u5982\u679c\u9700\u8981\u5524\u9192\u961f\u5217(\u5982\u63d2\u5165\u4e86\u65b0\u7684\u961f\u9996\u6d88\u606f)\uff0c\u5219\u8c03\u7528<code>nativeWake()</code></li> </ol> <pre><code>boolean enqueueMessage(Message msg, long when) {\n    synchronized (this) {\n        msg.when = when;\n        Message p = mMessages;\n        boolean needWake;\n        if (p == null || when == 0 || when &lt; p.when) {\n            // \u63d2\u5165\u961f\u9996\n            msg.next = p;\n            mMessages = msg;\n            needWake = mBlocked;\n        } else {\n            // \u63d2\u5165\u961f\u5217\u4e2d\u95f4\u6216\u5c3e\u90e8\n            needWake = mBlocked &amp;&amp; p.target == null &amp;&amp; msg.isAsynchronous();\n            Message prev;\n            for (;;) {\n                prev = p;\n                p = p.next;\n                if (p == null || when &lt; p.when) {\n                    break;\n                }\n                if (needWake &amp;&amp; p.isAsynchronous()) {\n                    needWake = false;\n                }\n            }\n            msg.next = p;\n            prev.next = msg;\n        }\n        if (needWake) {\n            nativeWake(mPtr);\n        }\n    }\n    return true;\n}\n</code></pre>"},{"location":"030Android/010Basic/#_26","title":"\u9ad8\u4f18\u5148\u7ea7\u6d88\u606f\u7684\u5904\u7406","text":"<p>Android\u4e2d\u9ad8\u4f18\u5148\u7ea7\u6d88\u606f\u4e3b\u8981\u901a\u8fc7\u4e24\u79cd\u673a\u5236\u5b9e\u73b0\uff1a</p>"},{"location":"030Android/010Basic/#1-asynchronous-messages","title":"1. \u5f02\u6b65\u6d88\u606f(Asynchronous Messages)","text":"<ul> <li>\u901a\u8fc7<code>Message.setAsynchronous(true)</code>\u6807\u8bb0</li> <li>\u5728\u540c\u6b65\u5c4f\u969c(Sync Barrier)\u4e0b\u4f1a\u4f18\u5148\u5904\u7406</li> </ul> <pre><code>public void setAsynchronous(boolean async) {\n    if (async) {\n        flags |= FLAG_ASYNCHRONOUS;\n    } else {\n        flags &amp;= ~FLAG_ASYNCHRONOUS;\n    }\n}\n</code></pre>"},{"location":"030Android/010Basic/#2-sync-barrier","title":"2. \u540c\u6b65\u5c4f\u969c(Sync Barrier)","text":"<ul> <li>\u901a\u8fc7<code>postSyncBarrier()</code>\u63d2\u5165\u4e00\u4e2a\u7279\u6b8a\u6d88\u606f(target\u4e3anull)</li> <li>\u5c4f\u969c\u540e\u7684\u540c\u6b65\u6d88\u606f\u4f1a\u88ab\u963b\u585e\uff0c\u53ea\u5904\u7406\u5f02\u6b65\u6d88\u606f</li> <li>\u5e38\u7528\u4e8eUI\u5237\u65b0\u7b49\u7d27\u6025\u4efb\u52a1</li> </ul> <pre><code>private int postSyncBarrier(long when) {\n    synchronized (this) {\n        final int token = mNextBarrierToken++;\n        final Message msg = Message.obtain();\n        msg.when = when;\n        msg.arg1 = token;\n\n        Message prev = null;\n        Message p = mMessages;\n        if (when != 0) {\n            while (p != null &amp;&amp; p.when &lt;= when) {\n                prev = p;\n                p = p.next;\n            }\n        }\n        if (prev != null) {\n            msg.next = p;\n            prev.next = msg;\n        } else {\n            msg.next = p;\n            mMessages = msg;\n        }\n        return token;\n    }\n}\n</code></pre>"},{"location":"030Android/010Basic/#_27","title":"\u9ad8\u4f18\u5148\u7ea7\u6d88\u606f\u5904\u7406\u6d41\u7a0b","text":"<ol> <li>\u8bbe\u7f6e\u540c\u6b65\u5c4f\u969c\uff1aViewRootImpl\u7b49\u7cfb\u7edf\u7ec4\u4ef6\u5728\u9700\u8981\u7d27\u6025\u66f4\u65b0UI\u65f6\u4f1a\u8bbe\u7f6e\u540c\u6b65\u5c4f\u969c</li> <li>\u63d2\u5165\u5f02\u6b65\u6d88\u606f\uff1a\u52a8\u753b\u3001\u8f93\u5165\u4e8b\u4ef6\u7b49\u9ad8\u4f18\u5148\u7ea7\u4efb\u52a1\u4f1a\u88ab\u6807\u8bb0\u4e3a\u5f02\u6b65</li> <li>\u6d88\u606f\u5faa\u73af\u5904\u7406\uff1a<code>MessageQueue.next()</code>\u9047\u5230\u5c4f\u969c\u65f6\u4f1a\u8df3\u8fc7\u540c\u6b65\u6d88\u606f\uff0c\u53ea\u5904\u7406\u5f02\u6b65\u6d88\u606f</li> <li>\u79fb\u9664\u5c4f\u969c\uff1a\u9ad8\u4f18\u5148\u7ea7\u4efb\u52a1\u5b8c\u6210\u540e\u79fb\u9664\u5c4f\u969c\uff0c\u6062\u590d\u6b63\u5e38\u6d88\u606f\u5904\u7406</li> </ol> <pre><code>Message next() {\n    // ...\n    for (;;) {\n        // ...\n        synchronized (this) {\n            // \u5904\u7406\u540c\u6b65\u5c4f\u969c\n            if (msg != null &amp;&amp; msg.target == null) {\n                // \u5c4f\u969c\u6d88\u606f\uff0c\u53ea\u5904\u7406\u5f02\u6b65\u6d88\u606f\n                do {\n                    prevMsg = msg;\n                    msg = msg.next;\n                } while (msg != null &amp;&amp; !msg.isAsynchronous());\n            }\n            // ...\n        }\n        // ...\n    }\n}\n</code></pre>"},{"location":"030Android/010Basic/#_28","title":"\u6d88\u606f\u63d2\u5165\u7684\u6027\u80fd\u8003\u8651","text":"<ol> <li>\u65f6\u95f4\u590d\u6742\u5ea6\uff1a\u666e\u901a\u63d2\u5165\u662fO(n)\uff0c\u56e0\u4e3a\u9700\u8981\u904d\u5386\u94fe\u8868\u627e\u5230\u5408\u9002\u4f4d\u7f6e</li> <li>\u9501\u673a\u5236\uff1a\u4f7f\u7528synchronized\u4fdd\u8bc1\u7ebf\u7a0b\u5b89\u5168</li> <li>\u5524\u9192\u673a\u5236\uff1a\u53ea\u6709\u5728\u5fc5\u8981\u65f6\u624d\u5524\u9192\u961f\u5217\uff0c\u51cf\u5c11\u4e0d\u5fc5\u8981\u7684\u7ebf\u7a0b\u5207\u6362</li> </ol>"},{"location":"030Android/010Basic/#_29","title":"\u5b9e\u9645\u5e94\u7528\u573a\u666f","text":"<ol> <li>UI\u66f4\u65b0\uff1aView.post()\u7b49\u64cd\u4f5c\u4f7f\u7528\u540c\u6b65\u5c4f\u969c\u4fdd\u8bc1UI\u4f18\u5148\u66f4\u65b0</li> <li>\u52a8\u753b\u5904\u7406\uff1a\u52a8\u753b\u6d88\u606f\u901a\u5e38\u6807\u8bb0\u4e3a\u5f02\u6b65\uff0c\u907f\u514d\u88ab\u5361\u987f\u5f71\u54cd</li> <li>\u8f93\u5165\u4e8b\u4ef6\uff1a\u8f93\u5165\u4e8b\u4ef6\u5904\u7406\u5177\u6709\u9ad8\u4f18\u5148\u7ea7\uff0c\u786e\u4fdd\u54cd\u5e94\u901f\u5ea6</li> </ol> <p>\u7406\u89e3MessageQueue\u7684\u63d2\u5165\u673a\u5236\u5bf9\u4e8e\u4f18\u5316Android\u5e94\u7528\u6027\u80fd\u3001\u89e3\u51b3\u5361\u987f\u95ee\u9898\u975e\u5e38\u91cd\u8981\uff0c\u7279\u522b\u662f\u5728\u5904\u7406\u590d\u6742UI\u548c\u52a8\u753b\u65f6\u3002</p>"},{"location":"030Android/010Basic/#handler","title":"\u54ea\u4e9b\u7cfb\u7edf\u7c7b\u6709Handler\uff1f","text":"\u7b54\u6848 <p>\u5728 Android \u4e2d\uff0c<code>Handler</code> \u662f\u4e00\u4e2a\u7528\u4e8e\u5728\u4e0d\u540c\u7ebf\u7a0b\u95f4\u4f20\u9012\u548c\u5904\u7406\u6d88\u606f\u7684\u7c7b\u3002\u4ee5\u4e0b\u662f\u4e00\u4e9b\u5e38\u89c1\u7684\u7cfb\u7edf\u7c7b\u4f1a\u4f7f\u7528 <code>Handler</code>\uff1a</p>"},{"location":"030Android/010Basic/#1-activity","title":"1. Activity","text":"<ul> <li>\u7528\u9014: \u7528\u4e8e\u5728\u4e3b\u7ebf\u7a0b\u4e2d\u66f4\u65b0 UI\u3002</li> <li>\u539f\u56e0: Android \u89c4\u5b9a UI \u64cd\u4f5c\u5fc5\u987b\u5728\u4e3b\u7ebf\u7a0b\uff08UI \u7ebf\u7a0b\uff09\u4e2d\u8fdb\u884c\uff0c<code>Handler</code> \u53ef\u4ee5\u5e2e\u52a9\u5c06\u4efb\u52a1\u4ece\u540e\u53f0\u7ebf\u7a0b\u4f20\u9012\u5230\u4e3b\u7ebf\u7a0b\u6267\u884c\u3002</li> </ul>"},{"location":"030Android/010Basic/#2-service","title":"2. Service","text":"<ul> <li>\u7528\u9014: \u7528\u4e8e\u5728\u540e\u53f0\u7ebf\u7a0b\u4e2d\u5904\u7406\u8017\u65f6\u64cd\u4f5c\uff0c\u5e76\u901a\u8fc7 <code>Handler</code> \u5c06\u7ed3\u679c\u4f20\u9012\u56de\u4e3b\u7ebf\u7a0b\u3002</li> <li>\u539f\u56e0: \u670d\u52a1\u53ef\u80fd\u8fd0\u884c\u5728\u540e\u53f0\u7ebf\u7a0b\uff0c\u4f46\u7ed3\u679c\u53ef\u80fd\u9700\u8981\u66f4\u65b0 UI \u6216\u901a\u77e5\u7528\u6237\u3002</li> </ul>"},{"location":"030Android/010Basic/#3-asynctask","title":"3. AsyncTask","text":"<ul> <li>\u7528\u9014: \u5185\u90e8\u4f7f\u7528 <code>Handler</code> \u5c06\u540e\u53f0\u4efb\u52a1\u7684\u7ed3\u679c\u4f20\u9012\u56de\u4e3b\u7ebf\u7a0b\u3002</li> <li>\u539f\u56e0: <code>AsyncTask</code> \u7528\u4e8e\u7b80\u5316\u540e\u53f0\u4efb\u52a1\u4e0e UI \u66f4\u65b0\u7684\u4ea4\u4e92\uff0c<code>Handler</code> \u662f\u5176\u5b9e\u73b0\u673a\u5236\u7684\u4e00\u90e8\u5206\u3002</li> </ul>"},{"location":"030Android/010Basic/#4-handlerthread","title":"4. HandlerThread","text":"<ul> <li>\u7528\u9014: \u63d0\u4f9b\u4e00\u4e2a\u5e26\u6709 <code>Looper</code> \u7684\u7ebf\u7a0b\uff0c\u65b9\u4fbf\u4f7f\u7528 <code>Handler</code> \u8fdb\u884c\u6d88\u606f\u5904\u7406\u3002</li> <li>\u539f\u56e0: \u9002\u7528\u4e8e\u9700\u8981\u5728\u72ec\u7acb\u7ebf\u7a0b\u4e2d\u5904\u7406\u6d88\u606f\u7684\u573a\u666f\u3002</li> </ul>"},{"location":"030Android/010Basic/#5-viewrootimpl","title":"5. ViewRootImpl","text":"<ul> <li>\u7528\u9014: \u7528\u4e8e\u5904\u7406 UI \u4e8b\u4ef6\u548c\u66f4\u65b0\u3002</li> <li>\u539f\u56e0: \u786e\u4fdd UI \u66f4\u65b0\u64cd\u4f5c\u5728\u4e3b\u7ebf\u7a0b\u4e2d\u6267\u884c\u3002</li> </ul>"},{"location":"030Android/010Basic/#6-inputmethodmanager","title":"6. InputMethodManager","text":"<ul> <li>\u7528\u9014: \u7ba1\u7406\u8f93\u5165\u6cd5\u76f8\u5173\u64cd\u4f5c\u3002</li> <li>\u539f\u56e0: \u8f93\u5165\u6cd5\u4e8b\u4ef6\u9700\u8981\u5728\u4e3b\u7ebf\u7a0b\u4e2d\u5904\u7406\uff0c<code>Handler</code> \u7528\u4e8e\u786e\u4fdd\u8fd9\u4e00\u70b9\u3002</li> </ul>"},{"location":"030Android/010Basic/#7-choreographer","title":"7. Choreographer","text":"<ul> <li>\u7528\u9014: \u534f\u8c03\u52a8\u753b\u3001\u8f93\u5165\u548c\u7ed8\u5236\u64cd\u4f5c\u3002</li> <li>\u539f\u56e0: \u786e\u4fdd\u8fd9\u4e9b\u64cd\u4f5c\u5728\u4e3b\u7ebf\u7a0b\u4e2d\u6309\u6b63\u786e\u7684\u987a\u5e8f\u6267\u884c\u3002</li> </ul>"},{"location":"030Android/010Basic/#8-windowmanager","title":"8. WindowManager","text":"<ul> <li>\u7528\u9014: \u7ba1\u7406\u7a97\u53e3\u7684\u521b\u5efa\u3001\u66f4\u65b0\u548c\u9500\u6bc1\u3002</li> <li>\u539f\u56e0: \u7a97\u53e3\u64cd\u4f5c\u901a\u5e38\u6d89\u53ca UI \u66f4\u65b0\uff0c\u9700\u8981\u5728\u4e3b\u7ebf\u7a0b\u4e2d\u5904\u7406\u3002</li> </ul>"},{"location":"030Android/010Basic/#handler_1","title":"\u4e3a\u4ec0\u4e48\u8981\u4f7f\u7528 <code>Handler</code>\uff1f","text":"<ol> <li>\u7ebf\u7a0b\u95f4\u901a\u4fe1: <code>Handler</code> \u5141\u8bb8\u5728\u4e0d\u540c\u7ebf\u7a0b\u95f4\u4f20\u9012\u6d88\u606f\uff0c\u786e\u4fdd UI \u66f4\u65b0\u5728\u4e3b\u7ebf\u7a0b\u4e2d\u6267\u884c\u3002</li> <li>\u4efb\u52a1\u8c03\u5ea6: \u53ef\u4ee5\u5ef6\u8fdf\u6267\u884c\u4efb\u52a1\u6216\u5b9a\u671f\u6267\u884c\u4efb\u52a1\u3002</li> <li>\u7b80\u5316\u4ee3\u7801: \u63d0\u4f9b\u4e86\u4e00\u79cd\u7b80\u5355\u7684\u65b9\u5f0f\u6765\u5904\u7406\u5f02\u6b65\u4efb\u52a1\u548c UI \u66f4\u65b0\u3002</li> <li>\u6d88\u606f\u961f\u5217\u7ba1\u7406: \u901a\u8fc7 <code>Looper</code> \u548c <code>MessageQueue</code> \u7ba1\u7406\u6d88\u606f\uff0c\u786e\u4fdd\u6309\u987a\u5e8f\u5904\u7406\u3002</li> </ol> <p>\u603b\u7ed3\u6765\u8bf4\uff0c<code>Handler</code> \u662f Android \u4e2d\u5b9e\u73b0\u7ebf\u7a0b\u95f4\u901a\u4fe1\u548c\u4efb\u52a1\u8c03\u5ea6\u7684\u6838\u5fc3\u5de5\u5177\uff0c\u5e7f\u6cdb\u5e94\u7528\u4e8e\u9700\u8981\u66f4\u65b0 UI \u6216\u5904\u7406\u5f02\u6b65\u4efb\u52a1\u7684\u573a\u666f\u3002</p>"},{"location":"030Android/010Basic/#handler_2","title":"Handler\u5982\u4f55\u5b9e\u73b0\u7684\u5ef6\u65f6\u64cd\u4f5c\uff1f","text":"\u7b54\u6848 <p>\u4e3b\u8981\u662fMQ\u7ba1\u7406\uff0cpostDelay\u4e0a\u53bb\u4e00\u4e2amsg\u3002mq\u4f1a\u653e\u5230\u524d\u9762\u5224\u65ad\u4e00\u5c42\uff0c\u7136\u540e\u963b\u585eMQ,\u5b9a\u65f6\u5524\u9192MQ\u3002 \u5982\u679c\u6b64\u65f6\u6709\u522b\u7684post\u4e8b\u4ef6\uff0c\u4f1a\u5524\u9192MQ\uff0c\u76f4\u63a5\u5c06delay\u653e\u5230\u540e\u9762\u3002\u6267\u884cpost\u4e8b\u4ef6\u3002</p> <p><code>Handler</code> \u7684\u5ef6\u65f6\u64cd\u4f5c\u901a\u8fc7 <code>MessageQueue</code> \u4e2d\u6d88\u606f\u7684 <code>when</code> \u5b57\u6bb5\u5b9e\u73b0\u3002<code>when</code> \u8868\u793a\u6d88\u606f\u5e94\u88ab\u5904\u7406\u7684\u65f6\u95f4\u6233\uff0c<code>Handler</code> \u6839\u636e\u8be5\u5b57\u6bb5\u51b3\u5b9a\u4f55\u65f6\u5904\u7406\u6d88\u606f\u3002</p>"},{"location":"030Android/010Basic/#_30","title":"\u5b9e\u73b0\u539f\u7406","text":"<ol> <li><code>when</code> \u5b57\u6bb5\uff1a</li> <li>\u6bcf\u4e2a <code>Message</code> \u90fd\u6709\u4e00\u4e2a <code>when</code> \u5b57\u6bb5\uff0c\u8868\u793a\u6d88\u606f\u7684\u5904\u7406\u65f6\u95f4\u3002</li> <li> <p><code>when</code> \u7684\u503c\u662f\u7cfb\u7edf\u542f\u52a8\u65f6\u95f4\uff08<code>SystemClock.uptimeMillis()</code>\uff09\u52a0\u4e0a\u5ef6\u65f6\u65f6\u95f4\u3002</p> </li> <li> <p><code>MessageQueue</code> \u7684\u6392\u5e8f\uff1a</p> </li> <li><code>MessageQueue</code> \u662f\u4e00\u4e2a\u6309 <code>when</code> \u6392\u5e8f\u7684\u4f18\u5148\u7ea7\u961f\u5217\u3002</li> <li> <p>\u65b0\u6d88\u606f\u63d2\u5165\u65f6\uff0c\u4f1a\u6839\u636e <code>when</code> \u63d2\u5165\u5230\u5408\u9002\u7684\u4f4d\u7f6e\uff0c\u786e\u4fdd\u961f\u5217\u6309\u65f6\u95f4\u987a\u5e8f\u6392\u5217\u3002</p> </li> <li> <p><code>Looper</code> \u7684\u5904\u7406\uff1a</p> </li> <li><code>Looper</code> \u4e0d\u65ad\u4ece <code>MessageQueue</code> \u4e2d\u53d6\u51fa\u6d88\u606f\u3002</li> <li>\u5982\u679c\u5f53\u524d\u65f6\u95f4\u5c0f\u4e8e\u6d88\u606f\u7684 <code>when</code>\uff0c<code>Looper</code> \u4f1a\u4f11\u7720\uff0c\u76f4\u5230\u65f6\u95f4\u5230\u8fbe\u3002</li> </ol>"},{"location":"030Android/010Basic/#_31","title":"\u5ef6\u65f6\u64cd\u4f5c\u7684\u5b9e\u73b0\u6b65\u9aa4","text":"<ol> <li>\u53d1\u9001\u5ef6\u65f6\u6d88\u606f\uff1a</li> <li>\u4f7f\u7528 <code>Handler</code> \u7684 <code>sendMessageDelayed(Message msg, long delayMillis)</code> \u6216 <code>postDelayed(Runnable r, long delayMillis)</code> \u65b9\u6cd5\u3002</li> <li> <p>\u8fd9\u4e9b\u65b9\u6cd5\u4f1a\u8ba1\u7b97 <code>when</code> \u5b57\u6bb5\u7684\u503c\uff0c\u5e76\u5c06\u5176\u63d2\u5165 <code>MessageQueue</code>\u3002</p> </li> <li> <p>\u8ba1\u7b97 <code>when</code>\uff1a</p> </li> <li><code>when = SystemClock.uptimeMillis() + delayMillis</code>\u3002</li> <li> <p><code>SystemClock.uptimeMillis()</code> \u8fd4\u56de\u7cfb\u7edf\u542f\u52a8\u5230\u73b0\u5728\u7684\u6beb\u79d2\u6570\uff0c\u4e0d\u53d7\u7cfb\u7edf\u65f6\u95f4\u4fee\u6539\u5f71\u54cd\u3002</p> </li> <li> <p>\u63d2\u5165 <code>MessageQueue</code>\uff1a</p> </li> <li> <p><code>MessageQueue</code> \u6839\u636e <code>when</code> \u7684\u503c\u5c06\u6d88\u606f\u63d2\u5165\u5230\u5408\u9002\u7684\u4f4d\u7f6e\u3002</p> </li> <li> <p><code>Looper</code> \u5904\u7406\u6d88\u606f\uff1a</p> </li> <li><code>Looper</code> \u4ece <code>MessageQueue</code> \u4e2d\u53d6\u51fa\u6d88\u606f\u65f6\uff0c\u5982\u679c\u5f53\u524d\u65f6\u95f4\u5c0f\u4e8e <code>when</code>\uff0c\u4f1a\u4f11\u7720\u76f4\u5230\u65f6\u95f4\u5230\u8fbe\u3002</li> <li>\u65f6\u95f4\u5230\u8fbe\u540e\uff0c<code>Looper</code> \u5c06\u6d88\u606f\u5206\u53d1\u7ed9 <code>Handler</code> \u5904\u7406\u3002</li> </ol>"},{"location":"030Android/010Basic/#_32","title":"\u793a\u4f8b\u4ee3\u7801","text":"<pre><code>Handler handler = new Handler(Looper.getMainLooper()) {\n    @Override\n    public void handleMessage(Message msg) {\n        // \u5904\u7406\u6d88\u606f\n        Log.d(\"Handler\", \"Message received: \" + msg.obj);\n    }\n};\n\n// \u53d1\u9001\u5373\u65f6\u6d88\u606f\nhandler.sendMessage(handler.obtainMessage(1, \"Hello\"));\n\n// \u53d1\u9001\u5ef6\u65f6\u6d88\u606f\uff081\u79d2\u540e\u5904\u7406\uff09\nhandler.sendMessageDelayed(handler.obtainMessage(2, \"Delayed Hello\"), 1000);\n\n// \u4f7f\u7528 postDelayed \u53d1\u9001\u5ef6\u65f6 Runnable\nhandler.postDelayed(() -&gt; {\n    Log.d(\"Handler\", \"Runnable executed\");\n}, 2000);\n</code></pre>"},{"location":"030Android/010Basic/#_33","title":"\u5173\u952e\u70b9","text":"<ul> <li><code>when</code> \u5b57\u6bb5\uff1a\u51b3\u5b9a\u6d88\u606f\u7684\u5904\u7406\u65f6\u95f4\u3002</li> <li><code>MessageQueue</code> \u6392\u5e8f\uff1a\u6309 <code>when</code> \u6392\u5e8f\uff0c\u786e\u4fdd\u6d88\u606f\u6309\u65f6\u95f4\u987a\u5e8f\u5904\u7406\u3002</li> <li><code>Looper</code> \u7684\u4f11\u7720\u673a\u5236\uff1a\u5982\u679c\u5f53\u524d\u65f6\u95f4\u672a\u5230\uff0c<code>Looper</code> \u4f1a\u4f11\u7720\uff0c\u907f\u514d\u5fd9\u7b49\u5f85\u3002</li> </ul>"},{"location":"030Android/010Basic/#_34","title":"\u603b\u7ed3","text":"<p><code>Handler</code> \u7684\u5ef6\u65f6\u64cd\u4f5c\u901a\u8fc7 <code>Message</code> \u7684 <code>when</code> \u5b57\u6bb5\u548c <code>MessageQueue</code> \u7684\u6392\u5e8f\u673a\u5236\u5b9e\u73b0\u3002<code>Looper</code> \u6839\u636e <code>when</code> \u51b3\u5b9a\u4f55\u65f6\u5904\u7406\u6d88\u606f\uff0c\u4ece\u800c\u5b9e\u73b0\u7cbe\u786e\u7684\u5ef6\u65f6\u64cd\u4f5c\u3002\u8fd9\u79cd\u673a\u5236\u9ad8\u6548\u4e14\u8282\u7701\u8d44\u6e90\uff0c\u9002\u5408 Android \u7684\u5f02\u6b65\u4efb\u52a1\u8c03\u5ea6\u3002</p>"},{"location":"030Android/010Basic/#handler_3","title":"Handler \u540c\u6b65\u5c4f\u969c\u76f8\u5173","text":"\u7b54\u6848 <p>Android \u7684 Handler \u673a\u5236\u786e\u5b9e\u6d89\u53ca\u4f18\u5148\u7ea7\u95ee\u9898\uff0c\u4f46\u5b83\u7684\u4f18\u5148\u7ea7\u89c4\u5219\u76f8\u5bf9\u7b80\u5355\uff0c\u4e3b\u8981\u4f53\u73b0\u5728\u6d88\u606f\u63d2\u5165\u548c\u5904\u7406\u987a\u5e8f\u4e0a\u3002\u4e0b\u9762\u8be6\u7ec6\u8bf4\u660e <code>postDelayed</code> \u6d88\u606f\u7684\u63d2\u5165\u903b\u8f91\u548c Handler \u7684\u4f18\u5148\u7ea7\u673a\u5236\uff1a</p>"},{"location":"030Android/010Basic/#1-messagequeue","title":"1. MessageQueue \u7684\u4f18\u5148\u7ea7\u89c4\u5219","text":"<ul> <li> <p>\u57fa\u672c\u987a\u5e8f\uff1a<code>MessageQueue</code> \u672c\u8d28\u662f\u4e00\u4e2a\u6309 \u6267\u884c\u65f6\u95f4\uff08<code>when</code>\uff09\u6392\u5e8f\u7684\u4f18\u5148\u7ea7\u961f\u5217\uff0c\u9075\u5faa\u4ee5\u4e0b\u89c4\u5219\uff1a</p> </li> <li> <p>\u65f6\u95f4\u4f18\u5148\uff1a\u6d88\u606f\u6309 <code>when</code>\uff08\u89e6\u53d1\u65f6\u95f4\u6233\uff09\u5347\u5e8f\u6392\u5217\uff0c\u65f6\u95f4\u5c0f\u7684\u5148\u6267\u884c\u3002</p> </li> <li>\u540c\u6b65\u5c4f\u969c\uff1a\u82e5\u5b58\u5728\u540c\u6b65\u5c4f\u969c\uff08<code>sync barrier</code>\uff09\uff0c\u5219\u8df3\u8fc7\u666e\u901a\u6d88\u606f\uff0c\u4f18\u5148\u6267\u884c\u5f02\u6b65\u6d88\u606f\uff08\u5982 UI \u7ed8\u5236\u76f8\u5173\u6d88\u606f\uff09\u3002</li> <li> <p>\u540c\u65f6\u95f4\u987a\u5e8f\uff1a\u82e5\u591a\u4e2a\u6d88\u606f\u7684 <code>when</code> \u76f8\u540c\uff0c\u5219 \u540e\u63d2\u5165\u7684\u6d88\u606f\u6392\u5728\u540e\u9762\uff08\u5373\u540c\u65f6\u95f4\u6309\u63d2\u5165\u987a\u5e8f\u6392\u961f\uff09\u3002</p> </li> <li> <p>\u5173\u952e\u70b9\uff1a</p> </li> <li>\u65e0\u7edd\u5bf9\u4f18\u5148\u7ea7\u5b57\u6bb5\uff1a\u6d88\u606f\u6ca1\u6709\u7c7b\u4f3c\u7ebf\u7a0b\u7684 <code>priority</code> \u5b57\u6bb5\uff0c\u4ec5\u4f9d\u8d56\u65f6\u95f4\u6233\u548c\u63d2\u5165\u987a\u5e8f\u3002</li> <li>\u5ef6\u8fdf\u6d88\u606f\uff1a<code>postDelayed(msg, delay)</code> \u7684\u6d88\u606f\u4f1a\u6839\u636e <code>SystemClock.uptimeMillis() + delay</code> \u8ba1\u7b97 <code>when</code>\uff0c\u63d2\u5165\u5230\u961f\u5217\u4e2d\u5408\u9002\u7684\u4f4d\u7f6e\u3002</li> </ul>"},{"location":"030Android/010Basic/#2-postdelayed","title":"2. <code>postDelayed</code> \u7684\u63d2\u5165\u903b\u8f91","text":"<p>\u5f53\u8c03\u7528 <code>handler.postDelayed(msg, 1000)</code> \u65f6\uff1a</p> <ol> <li> <p>\u8ba1\u7b97\u89e6\u53d1\u65f6\u95f4\uff1a <code>when = SystemClock.uptimeMillis() + 1000</code>\uff08\u5f53\u524d\u65f6\u95f4 + \u5ef6\u8fdf\uff09\u3002</p> </li> <li> <p>\u63d2\u5165\u961f\u5217\uff1a  </p> </li> <li>\u904d\u5386 <code>MessageQueue</code>\uff0c\u627e\u5230\u7b2c\u4e00\u4e2a <code>when &gt; \u5f53\u524d\u6d88\u606f when</code> \u7684\u4f4d\u7f6e\u3002</li> <li> <p>\u5c06\u6d88\u606f\u63d2\u5165\u5230\u8be5\u4f4d\u7f6e\u4e4b\u524d\uff0c\u4fdd\u8bc1\u961f\u5217\u6309 <code>when</code> \u6709\u5e8f\u3002</p> </li> <li> <p>\u5524\u9192\u961f\u5217\uff08\u82e5\u9700\u8981\uff09\uff1a  </p> </li> <li>\u5982\u679c\u63d2\u5165\u7684\u6d88\u606f\u662f\u65b0\u7684\u961f\u9996\uff08\u5373\u6bd4\u539f\u961f\u9996\u6d88\u606f\u66f4\u65e9\u89e6\u53d1\uff09\uff0c\u4f1a\u5524\u9192 <code>Looper</code> \u91cd\u65b0\u68c0\u67e5\u7b49\u5f85\u65f6\u95f4\u3002</li> </ol>"},{"location":"030Android/010Basic/#3_1","title":"3. \u793a\u4f8b\u573a\u666f","text":"<p>\u5047\u8bbe\u5f53\u524d\u65f6\u95f4 <code>t=0</code>\uff0c\u961f\u5217\u4e2d\u6709\u4ee5\u4e0b\u6d88\u606f\uff1a - <code>msgA</code>\uff08<code>when=1000</code>\uff09 - <code>msgB</code>\uff08<code>when=3000</code>\uff09</p> <p>\u8c03\u7528 <code>postDelayed(msgC, 1500)</code> \u540e\uff1a 1. <code>msgC</code> \u7684 <code>when = 0 + 1500 = 1500</code>\u3002 2. \u63d2\u5165\u4f4d\u7f6e\u5728 <code>msgA</code> \u4e4b\u540e\u3001<code>msgB</code> \u4e4b\u524d\u3002 3. \u6700\u7ec8\u987a\u5e8f\uff1a<code>msgA</code>\uff081000\uff09\u2192 <code>msgC</code>\uff081500\uff09\u2192 <code>msgB</code>\uff083000\uff09\u3002</p>"},{"location":"030Android/010Basic/#4_1","title":"4. \u7279\u6b8a\u4f18\u5148\u7ea7\u60c5\u51b5","text":"<ul> <li> <p>\u540c\u6b65\u5c4f\u969c\uff08Sync Barrier\uff09\uff1a \u901a\u8fc7 <code>postSyncBarrier()</code> \u63d2\u5165\u7684\u5c4f\u969c\u4f1a\u963b\u585e\u666e\u901a\u540c\u6b65\u6d88\u606f\uff0c\u76f4\u5230\u5c4f\u969c\u88ab\u79fb\u9664\u3002\u6b64\u65f6\uff0c\u5f02\u6b65\u6d88\u606f\uff08\u5982 UI \u7ed8\u5236\uff09\u4f1a\u4f18\u5148\u6267\u884c\uff0c\u5373\u4f7f\u5ef6\u8fdf\u65f6\u95f4\u6bd4\u540c\u6b65\u6d88\u606f\u665a\u3002 <pre><code>// \u5f02\u6b65\u6d88\u606f\u793a\u4f8b\nMessage msg = Message.obtain();\nmsg.setAsynchronous(true);\nhandler.sendMessageDelayed(msg, delay);\n</code></pre></p> </li> <li> <p>\u5373\u65f6\u6d88\u606f vs \u5ef6\u8fdf\u6d88\u606f\uff1a <code>sendMessage()</code> \u6216 <code>post()</code> \u7684\u5373\u65f6\u6d88\u606f\uff08<code>when=\u5f53\u524d\u65f6\u95f4</code>\uff09\u4f1a\u6392\u5728\u6240\u6709\u5ef6\u8fdf\u65f6\u95f4\u76f8\u540c\u7684\u5ef6\u8fdf\u6d88\u606f\u4e4b\u524d\u3002</p> </li> </ul>"},{"location":"030Android/010Basic/#5_1","title":"5. \u6ce8\u610f\u4e8b\u9879","text":"<ul> <li>\u65f6\u6548\u6027\u4e0d\u7edd\u5bf9\uff1a<code>postDelayed</code> \u7684\u5ef6\u8fdf\u65f6\u95f4\u5e76\u975e\u4e25\u683c\u5b9e\u65f6\uff0c\u53ef\u80fd\u56e0\u4e3b\u7ebf\u7a0b\u7e41\u5fd9\u6216 Looper \u5904\u7406\u8017\u65f6\u6d88\u606f\u800c\u63a8\u8fdf\u3002</li> <li>\u907f\u514d\u4f18\u5148\u7ea7\u4f9d\u8d56\uff1a\u4e0d\u5e94\u4f9d\u8d56\u6d88\u606f\u63d2\u5165\u987a\u5e8f\u5b9e\u73b0\u4e1a\u52a1\u903b\u8f91\u4f18\u5148\u7ea7\uff0c\u590d\u6742\u573a\u666f\u5efa\u8bae\u4f7f\u7528\u660e\u786e\u7684\u4efb\u52a1\u961f\u5217\uff08\u5982 <code>PriorityBlockingQueue</code>\uff09\u3002</li> </ul>"},{"location":"030Android/010Basic/#_35","title":"\u603b\u7ed3","text":"<ul> <li>\u4f18\u5148\u7ea7\u89c4\u5219\uff1a\u6309\u65f6\u95f4\u6233 <code>when</code> \u6392\u5e8f\uff0c\u540c\u65f6\u95f4\u6309\u63d2\u5165\u987a\u5e8f\u3002</li> <li><code>postDelayed</code> \u63d2\u5165\uff1a\u6839\u636e <code>\u5f53\u524d\u65f6\u95f4 + delay</code> \u8ba1\u7b97 <code>when</code>\uff0c\u63d2\u5165\u5230\u961f\u5217\u7684\u5408\u9002\u4f4d\u7f6e\u3002</li> <li>\u5f02\u6b65\u6d88\u606f\uff1a\u901a\u8fc7\u540c\u6b65\u5c4f\u969c\u53ef\u5b9e\u73b0\u66f4\u9ad8\u4f18\u5148\u7ea7\uff0c\u4f46\u9700\u8c28\u614e\u4f7f\u7528\u3002</li> </ul> <p>\u5728 Android \u7684 Handler \u6d88\u606f\u673a\u5236 \u4e2d\uff0c\u540c\u6b65\u5c4f\u969c\uff08Sync Barrier\uff09 \u662f\u4e00\u79cd\u7279\u6b8a\u7684\u673a\u5236\uff0c\u7528\u4e8e\u4e34\u65f6\u963b\u585e\u666e\u901a\u7684\u540c\u6b65\u6d88\u606f\uff0c\u4f18\u5148\u5904\u7406\u5f02\u6b65\u6d88\u606f\uff08\u5982 UI \u7ed8\u5236\u3001Vsync \u4fe1\u53f7\u7b49\uff09\u3002\u5b83\u7684\u6838\u5fc3\u76ee\u7684\u662f\u786e\u4fdd\u9ad8\u4f18\u5148\u7ea7\u7684\u4efb\u52a1\uff08\u5982\u754c\u9762\u6e32\u67d3\uff09\u80fd\u591f\u53ca\u65f6\u6267\u884c\uff0c\u907f\u514d\u88ab\u4f4e\u4f18\u5148\u7ea7\u7684\u540c\u6b65\u6d88\u606f\u963b\u585e\u3002</p>"},{"location":"030Android/010Basic/#1_1","title":"1. \u540c\u6b65\u5c4f\u969c\u7684\u4f5c\u7528","text":"<ul> <li>\u963b\u585e\u666e\u901a\u540c\u6b65\u6d88\u606f\uff1a\u5f53\u63d2\u5165\u4e00\u4e2a\u540c\u6b65\u5c4f\u969c\u540e\uff0c<code>MessageQueue</code> \u4f1a\u8df3\u8fc7\u6240\u6709\u666e\u901a\u7684\u540c\u6b65\u6d88\u606f\uff08<code>isAsync = false</code>\uff09\uff0c\u53ea\u5904\u7406\u5f02\u6b65\u6d88\u606f\uff08<code>isAsync = true</code>\uff09\u6216\u5c4f\u969c\u79fb\u9664\u6d88\u606f\u3002</li> <li>\u786e\u4fdd\u9ad8\u4f18\u5148\u7ea7\u4efb\u52a1\u6267\u884c\uff1aAndroid \u7684 UI \u6e32\u67d3\uff08<code>Choreographer</code>\uff09\u3001\u8f93\u5165\u4e8b\u4ef6\uff08<code>InputEvent</code>\uff09\u7b49\u5173\u952e\u4efb\u52a1\u4f7f\u7528\u5f02\u6b65\u6d88\u606f\uff0c\u907f\u514d\u88ab\u4e1a\u52a1\u903b\u8f91\u963b\u585e\u3002</li> </ul>"},{"location":"030Android/010Basic/#2_1","title":"2. \u540c\u6b65\u5c4f\u969c\u7684\u5de5\u4f5c\u539f\u7406","text":""},{"location":"030Android/010Basic/#1_2","title":"(1) \u540c\u6b65\u5c4f\u969c\u7684\u8868\u793a","text":"<p>\u540c\u6b65\u5c4f\u969c\u672c\u8eab\u662f\u4e00\u4e2a\u7279\u6b8a\u7684 <code>Message</code>\uff0c\u5176 <code>target</code>\uff08\u5373 <code>Handler</code>\uff09\u4e3a <code>null</code>\uff0c\u5e76\u8bbe\u7f6e <code>arg1 = token</code>\uff08\u7528\u4e8e\u79fb\u9664\u5c4f\u969c\uff09\uff1a <pre><code>// MessageQueue.java\nprivate int postSyncBarrier(long when) {\n    synchronized (this) {\n        final int token = mNextBarrierToken++;\n        final Message msg = Message.obtain();\n        msg.markInUse();\n        msg.when = when;\n        msg.arg1 = token; // \u5c4f\u969c\u7684 token\uff0c\u7528\u4e8e\u79fb\u9664\n\n        Message prev = null;\n        Message p = mMessages;\n        // \u6309\u65f6\u95f4\u987a\u5e8f\u63d2\u5165\u5c4f\u969c\n        if (when != 0) {\n            while (p != null &amp;&amp; p.when &lt;= when) {\n                prev = p;\n                p = p.next;\n            }\n        }\n        if (prev != null) {\n            msg.next = p;\n            prev.next = msg;\n        } else {\n            msg.next = p;\n            mMessages = msg;\n        }\n        return token;\n    }\n}\n</code></pre></p>"},{"location":"030Android/010Basic/#2_2","title":"(2) \u6d88\u606f\u5904\u7406\u65f6\u8df3\u8fc7\u540c\u6b65\u6d88\u606f","text":"<p><code>MessageQueue.next()</code> \u5728\u83b7\u53d6\u4e0b\u4e00\u6761\u6d88\u606f\u65f6\uff0c\u5982\u679c\u9047\u5230\u540c\u6b65\u5c4f\u969c\uff0c\u4f1a\u8df3\u8fc7\u6240\u6709\u540c\u6b65\u6d88\u606f\uff0c\u53ea\u5904\u7406\u5f02\u6b65\u6d88\u606f\uff1a <pre><code>// MessageQueue.java\nMessage next() {\n    for (;;) {\n        // ...\n        synchronized (this) {\n            final long now = SystemClock.uptimeMillis();\n            Message prevMsg = null;\n            Message msg = mMessages;\n            if (msg != null &amp;&amp; msg.target == null) { // \u9047\u5230\u540c\u6b65\u5c4f\u969c\n                // \u53ea\u627e\u5f02\u6b65\u6d88\u606f\n                do {\n                    prevMsg = msg;\n                    msg = msg.next;\n                } while (msg != null &amp;&amp; !msg.isAsynchronous());\n            }\n            // \u5904\u7406\u627e\u5230\u7684\u6d88\u606f...\n        }\n    }\n}\n</code></pre></p>"},{"location":"030Android/010Basic/#3_2","title":"(3) \u79fb\u9664\u540c\u6b65\u5c4f\u969c","text":"<p>\u5f53\u4e0d\u518d\u9700\u8981\u5c4f\u969c\u65f6\uff0c\u5fc5\u987b\u624b\u52a8\u79fb\u9664\uff0c\u5426\u5219\u540c\u6b65\u6d88\u606f\u4f1a\u4e00\u76f4\u88ab\u963b\u585e\uff1a <pre><code>// MessageQueue.java\npublic void removeSyncBarrier(int token) {\n    synchronized (this) {\n        Message prev = null;\n        Message p = mMessages;\n        // \u627e\u5230\u5bf9\u5e94\u7684\u5c4f\u969c\n        while (p != null &amp;&amp; (p.target != null || p.arg1 != token)) {\n            prev = p;\n            p = p.next;\n        }\n        if (p == null) {\n            throw new IllegalStateException(\"The specified barrier token was not found.\");\n        }\n        // \u79fb\u9664\u5c4f\u969c\n        if (prev != null) {\n            prev.next = p.next;\n        } else {\n            mMessages = p.next;\n        }\n        p.recycle();\n    }\n}\n</code></pre></p>"},{"location":"030Android/010Basic/#3_3","title":"3. \u540c\u6b65\u5c4f\u969c\u7684\u4f7f\u7528\u573a\u666f","text":""},{"location":"030Android/010Basic/#1-ui-choreographer","title":"(1) UI \u6e32\u67d3\uff08Choreographer\uff09","text":"<p>Android \u7684 <code>Choreographer</code> \u4f7f\u7528\u540c\u6b65\u5c4f\u969c\u786e\u4fdd <code>VSYNC</code> \u4fe1\u53f7\uff08\u5782\u76f4\u540c\u6b65\uff09\u4f18\u5148\u5904\u7406\uff0c\u907f\u514d UI \u5361\u987f\uff1a <pre><code>// Choreographer.java\nvoid scheduleFrameLocked(long now) {\n    if (!mFrameScheduled) {\n        mFrameScheduled = true;\n        // \u63d2\u5165\u540c\u6b65\u5c4f\u969c\n        if (USE_VSYNC) {\n            mDisplayEventReceiver.scheduleVsync();\n        } else {\n            // \u53d1\u9001\u5f02\u6b65\u6d88\u606f\n            Message msg = mHandler.obtainMessage(MSG_DO_FRAME);\n            msg.setAsynchronous(true); // \u8bbe\u7f6e\u4e3a\u5f02\u6b65\u6d88\u606f\n            mHandler.sendMessageAtFrontOfQueue(msg);\n        }\n    }\n}\n</code></pre></p>"},{"location":"030Android/010Basic/#2-inputevent","title":"(2) \u8f93\u5165\u4e8b\u4ef6\uff08InputEvent\uff09","text":"<p>\u8f93\u5165\u4e8b\u4ef6\uff08\u5982\u89e6\u6478\u3001\u6309\u952e\uff09\u4e5f\u4f1a\u4f7f\u7528\u5f02\u6b65\u6d88\u606f\uff0c\u786e\u4fdd\u7528\u6237\u4ea4\u4e92\u7684\u6d41\u7545\u6027\u3002</p>"},{"location":"030Android/010Basic/#4_2","title":"4. \u624b\u52a8\u4f7f\u7528\u540c\u6b65\u5c4f\u969c\uff08\u793a\u4f8b\uff09","text":"<p>\u867d\u7136\u7cfb\u7edf\u5185\u90e8\u5e7f\u6cdb\u4f7f\u7528\u540c\u6b65\u5c4f\u969c\uff0c\u4f46\u5f00\u53d1\u8005\u4e00\u822c\u4e0d\u76f4\u63a5\u4f7f\u7528\uff0c\u56e0\u4e3a\u9519\u8bef\u4f7f\u7528\u53ef\u80fd\u5bfc\u81f4\u6d88\u606f\u961f\u5217\u963b\u585e\u3002\u4e0d\u8fc7\uff0c\u6211\u4eec\u53ef\u4ee5\u6a21\u62df\u5b83\u7684\u884c\u4e3a\uff1a <pre><code>// 1. \u63d2\u5165\u540c\u6b65\u5c4f\u969c\nint token = Looper.getMainLooper().getQueue().postSyncBarrier();\n\n// 2. \u53d1\u9001\u5f02\u6b65\u6d88\u606f\uff08\u4f18\u5148\u6267\u884c\uff09\nHandler handler = new Handler(Looper.getMainLooper());\nMessage asyncMsg = Message.obtain(handler, () -&gt; Log.d(\"Test\", \"Async Msg\"));\nasyncMsg.setAsynchronous(true); // \u5173\u952e\uff01\nhandler.sendMessageDelayed(asyncMsg, 1000);\n\n// 3. \u53d1\u9001\u666e\u901a\u540c\u6b65\u6d88\u606f\uff08\u4f1a\u88ab\u963b\u585e\uff09\nhandler.postDelayed(() -&gt; Log.d(\"Test\", \"Sync Msg\"), 1000);\n\n// 4. \u79fb\u9664\u5c4f\u969c\uff08\u5426\u5219\u540c\u6b65\u6d88\u606f\u6c38\u8fdc\u4e0d\u6267\u884c\uff09\nhandler.postDelayed(() -&gt; {\n    Looper.getMainLooper().getQueue().removeSyncBarrier(token);\n}, 2000);\n</code></pre> \u8f93\u51fa\uff1a <pre><code>Async Msg  // \u5f02\u6b65\u6d88\u606f\u4f18\u5148\u6267\u884c\nSync Msg   // \u5c4f\u969c\u79fb\u9664\u540e\uff0c\u540c\u6b65\u6d88\u606f\u624d\u6267\u884c\n</code></pre></p>"},{"location":"030Android/010Basic/#5_2","title":"5. \u6ce8\u610f\u4e8b\u9879","text":"<ol> <li>\u5c4f\u969c\u5fc5\u987b\u624b\u52a8\u79fb\u9664\uff0c\u5426\u5219\u540c\u6b65\u6d88\u606f\u4f1a\u4e00\u76f4\u963b\u585e\uff0c\u5bfc\u81f4 ANR\u3002</li> <li>\u8c28\u614e\u4f7f\u7528\uff0c\u9519\u8bef\u4f7f\u7528\u53ef\u80fd\u5bfc\u81f4\u6d88\u606f\u8c03\u5ea6\u5f02\u5e38\u3002</li> <li>\u5f02\u6b65\u6d88\u606f\u9700\u663e\u5f0f\u8bbe\u7f6e\uff1a<code>msg.setAsynchronous(true)</code>\u3002</li> <li>\u4e3b\u8981\u7528\u4e8e\u7cfb\u7edf\u7ea7\u4efb\u52a1\uff0c\u666e\u901a\u4e1a\u52a1\u903b\u8f91\u4e0d\u9700\u8981\u3002</li> </ol>"},{"location":"030Android/010Basic/#_36","title":"\u603b\u7ed3","text":"\u7279\u6027 \u540c\u6b65\u5c4f\u969c \u666e\u901a\u6d88\u606f \u5f02\u6b65\u6d88\u606f <code>target</code> <code>null</code> <code>Handler</code> <code>Handler</code> \u662f\u5426\u963b\u585e\u540c\u6b65\u6d88\u606f \u2705 \u662f \u274c \u5426 \u274c \u5426 \u6267\u884c\u4f18\u5148\u7ea7 \u6700\u9ad8\uff08\u8df3\u8fc7\u540c\u6b65\u6d88\u606f\uff09 \u666e\u901a \u9ad8\uff08\u5c4f\u969c\u5b58\u5728\u65f6\u4f18\u5148\uff09 \u5178\u578b\u7528\u9014 UI \u6e32\u67d3\uff08<code>Choreographer</code>\uff09 \u666e\u901a\u4e1a\u52a1\u903b\u8f91 \u9ad8\u4f18\u5148\u7ea7\u4efb\u52a1 <p>\u540c\u6b65\u5c4f\u969c\u662f Android \u6d88\u606f\u673a\u5236\u7684\u9ad8\u9636\u7279\u6027\uff0c\u4e3b\u8981\u7528\u4e8e\u7cfb\u7edf\u7ea7\u4f18\u5316\uff0c\u5f00\u53d1\u8005\u901a\u5e38\u65e0\u9700\u76f4\u63a5\u4f7f\u7528\uff0c\u4f46\u7406\u89e3\u5176\u539f\u7406\u6709\u52a9\u4e8e\u4f18\u5316 UI \u6027\u80fd\u3002</p> <p>\u5728 Android \u7cfb\u7edf\u4e2d\uff0c\u540c\u6b65\u5c4f\u969c\uff08Sync Barrier\uff09 \u4e3b\u8981\u7528\u4e8e\u786e\u4fdd\u9ad8\u4f18\u5148\u7ea7\u7684\u7cfb\u7edf\u4efb\u52a1\uff08\u5982 UI \u6e32\u67d3\u3001\u8f93\u5165\u4e8b\u4ef6\u3001\u52a8\u753b\u7b49\uff09\u80fd\u591f\u53ca\u65f6\u6267\u884c\uff0c\u907f\u514d\u88ab\u666e\u901a\u540c\u6b65\u6d88\u606f\u963b\u585e\u3002\u4ee5\u4e0b\u662f\u5e7f\u6cdb\u4f7f\u7528\u540c\u6b65\u5c4f\u969c\u7684\u6838\u5fc3\u7cfb\u7edf\u7c7b\u53ca\u5176\u573a\u666f\uff1a</p>"},{"location":"030Android/010Basic/#1-choreographerui-vsync","title":"1. Choreographer\uff08UI \u6e32\u67d3 &amp; Vsync \u540c\u6b65\uff09","text":"<p>\u4f5c\u7528\uff1a\u534f\u8c03 UI \u7ed8\u5236\u3001\u52a8\u753b\u548c\u89e6\u6478\u4e8b\u4ef6\uff0c\u786e\u4fdd\u5b83\u4eec\u6309 <code>VSYNC</code> \u4fe1\u53f7\uff08\u5c4f\u5e55\u5237\u65b0\u7387\uff09\u6267\u884c\u3002 \u540c\u6b65\u5c4f\u969c\u4f7f\u7528\u573a\u666f\uff1a - \u5728 <code>scheduleFrameLocked()</code> \u4e2d\u63d2\u5165\u540c\u6b65\u5c4f\u969c\uff0c\u786e\u4fdd <code>VSYNC</code> \u4fe1\u53f7\u89e6\u53d1\u7684 <code>MSG_DO_FRAME</code> \u6d88\u606f\uff08\u5f02\u6b65\u6d88\u606f\uff09\u4f18\u5148\u6267\u884c\u3002 - \u907f\u514d\u666e\u901a\u6d88\u606f\u963b\u585e UI \u6e32\u67d3\uff08\u5982 <code>View.draw()</code>\u3001\u52a8\u753b\u8ba1\u7b97\u7b49\uff09\u3002  </p> <p>\u5173\u952e\u4ee3\u7801\uff1a <pre><code>// Choreographer.java\nvoid scheduleFrameLocked(long now) {\n    if (!mFrameScheduled) {\n        mFrameScheduled = true;\n        if (USE_VSYNC) {\n            // \u63d2\u5165\u540c\u6b65\u5c4f\u969c\uff0c\u7b49\u5f85VSYNC\u4fe1\u53f7\n            mDisplayEventReceiver.scheduleVsync();\n        } else {\n            // \u76f4\u63a5\u53d1\u9001\u5f02\u6b65\u6d88\u606f\uff08\u6d4b\u8bd5\u73af\u5883\uff09\n            Message msg = mHandler.obtainMessage(MSG_DO_FRAME);\n            msg.setAsynchronous(true); // \u5173\u952e\uff01\n            mHandler.sendMessageAtFrontOfQueue(msg);\n        }\n    }\n}\n</code></pre></p>"},{"location":"030Android/010Basic/#2-viewrootimplui","title":"2. ViewRootImpl\uff08UI \u7ed8\u5236\u6d41\u7a0b\uff09","text":"<p>\u4f5c\u7528\uff1a\u7ba1\u7406 <code>View</code> \u6811\u7684\u6d4b\u91cf\u3001\u5e03\u5c40\u548c\u7ed8\u5236\u3002 \u540c\u6b65\u5c4f\u969c\u4f7f\u7528\u573a\u666f\uff1a - \u5728 <code>scheduleTraversals()</code> \u4e2d\uff0c\u901a\u8fc7 <code>Choreographer</code> \u8bf7\u6c42 <code>VSYNC</code> \u4fe1\u53f7\uff0c\u95f4\u63a5\u4f7f\u7528\u540c\u6b65\u5c4f\u969c\u3002 - \u786e\u4fdd <code>performTraversals()</code>\uff08UI \u7ed8\u5236\u7684\u6838\u5fc3\u903b\u8f91\uff09\u4e0d\u88ab\u4e1a\u52a1\u903b\u8f91\u963b\u585e\u3002  </p> <p>\u5173\u952e\u4ee3\u7801\uff1a <pre><code>// ViewRootImpl.java\nvoid scheduleTraversals() {\n    if (!mTraversalScheduled) {\n        mTraversalScheduled = true;\n        // \u901a\u8fc7Choreographer\u63d2\u5165\u540c\u6b65\u5c4f\u969c\n        mChoreographer.postCallback(\n            Choreographer.CALLBACK_TRAVERSAL, mTraversalRunnable, null);\n    }\n}\n</code></pre></p>"},{"location":"030Android/010Basic/#3-inputdispatcher","title":"3. InputDispatcher\uff08\u8f93\u5165\u4e8b\u4ef6\u5904\u7406\uff09","text":"<p>\u4f5c\u7528\uff1a\u5c06\u89e6\u6478\u3001\u6309\u952e\u7b49\u8f93\u5165\u4e8b\u4ef6\u5206\u53d1\u7ed9\u5e94\u7528\u3002 \u540c\u6b65\u5c4f\u969c\u4f7f\u7528\u573a\u666f\uff1a - \u8f93\u5165\u4e8b\u4ef6\u9700\u8981\u4f4e\u5ef6\u8fdf\u5904\u7406\uff0c\u7cfb\u7edf\u4f1a\u4f18\u5148\u5206\u53d1 <code>InputEvent</code> \u5f02\u6b65\u6d88\u606f\u3002 - \u907f\u514d\u666e\u901a\u6d88\u606f\u961f\u5217\u963b\u585e\u7528\u6237\u4ea4\u4e92\u3002  </p> <p>\u5173\u8054\u673a\u5236\uff1a - <code>InputChannel</code> \u548c <code>WindowInputEventReceiver</code> \u4f7f\u7528\u5f02\u6b65\u6d88\u606f\u4f20\u9012\u4e8b\u4ef6\u3002</p>"},{"location":"030Android/010Basic/#4-windowmanagerservice","title":"4. WindowManagerService\uff08\u7a97\u53e3\u7ba1\u7406\uff09","text":"<p>\u4f5c\u7528\uff1a\u7ba1\u7406\u7a97\u53e3\u7684\u6dfb\u52a0\u3001\u5220\u9664\u548c\u5e03\u5c40\u3002 \u540c\u6b65\u5c4f\u969c\u4f7f\u7528\u573a\u666f\uff1a - \u7a97\u53e3\u72b6\u6001\u53d8\u66f4\uff08\u5982 <code>Activity</code> \u5207\u6362\u3001\u5bf9\u8bdd\u6846\u5f39\u51fa\uff09\u9700\u8981\u5373\u65f6\u54cd\u5e94\uff0c\u90e8\u5206\u64cd\u4f5c\u4f1a\u89e6\u53d1\u5f02\u6b65\u6d88\u606f\u3002  </p>"},{"location":"030Android/010Basic/#5-animationhandler","title":"5. AnimationHandler\uff08\u5c5e\u6027\u52a8\u753b\uff09","text":"<p>\u4f5c\u7528\uff1a\u9a71\u52a8\u5c5e\u6027\u52a8\u753b\uff08\u5982 <code>ValueAnimator</code>\uff09\u7684\u6bcf\u4e00\u5e27\u66f4\u65b0\u3002 \u540c\u6b65\u5c4f\u969c\u4f7f\u7528\u573a\u666f\uff1a - \u52a8\u753b\u5e27\u66f4\u65b0\u9700\u4e25\u683c\u6309 <code>VSYNC</code> \u4fe1\u53f7\u6267\u884c\uff0c\u901a\u8fc7 <code>Choreographer</code> \u95f4\u63a5\u4f7f\u7528\u540c\u6b65\u5c4f\u969c\u3002  </p> <p>\u5173\u952e\u4ee3\u7801\uff1a <pre><code>// AnimationHandler.java\nprivate final Choreographer.FrameCallback mFrameCallback = new Choreographer.FrameCallback() {\n    @Override\n    public void doFrame(long frameTimeNanos) {\n        // \u52a8\u753b\u5e27\u66f4\u65b0\u903b\u8f91\n        doAnimationFrame(frameTimeNanos);\n    }\n};\n</code></pre></p>"},{"location":"030Android/010Basic/#6-surfaceflinger","title":"6. SurfaceFlinger\uff08\u56fe\u5f62\u5408\u6210\uff09","text":"<p>\u4f5c\u7528\uff1a\u5c06\u591a\u4e2a <code>Surface</code> \u5408\u6210\u6700\u7ec8\u5c4f\u5e55\u56fe\u50cf\u3002 \u540c\u6b65\u5c4f\u969c\u4f7f\u7528\u573a\u666f\uff1a - \u5408\u6210\u64cd\u4f5c\u9700\u4e25\u683c\u6309 <code>VSYNC</code> \u4fe1\u53f7\u540c\u6b65\uff0c\u907f\u514d\u753b\u9762\u6495\u88c2\u3002 - \u901a\u8fc7 <code>EventThread</code> \u548c <code>MessageQueue</code> \u7684\u5f02\u6b65\u6d88\u606f\u673a\u5236\u5b9e\u73b0\u3002  </p>"},{"location":"030Android/010Basic/#_37","title":"\u603b\u7ed3\uff1a\u54ea\u4e9b\u7cfb\u7edf\u7c7b\u4f9d\u8d56\u540c\u6b65\u5c4f\u969c\uff1f","text":"\u7cfb\u7edf\u7c7b \u7528\u9014 \u540c\u6b65\u5c4f\u969c\u7684\u4f5c\u7528 <code>Choreographer</code> UI \u6e32\u67d3\u3001VSYNC \u540c\u6b65 \u786e\u4fdd <code>MSG_DO_FRAME</code> \u4f18\u5148\u6267\u884c <code>ViewRootImpl</code> View \u6811\u7684\u6d4b\u91cf\u3001\u5e03\u5c40\u3001\u7ed8\u5236 \u901a\u8fc7 <code>Choreographer</code> \u95f4\u63a5\u4f7f\u7528 <code>InputDispatcher</code> \u8f93\u5165\u4e8b\u4ef6\u5206\u53d1 \u4f18\u5148\u5904\u7406\u89e6\u6478/\u6309\u952e\u4e8b\u4ef6 <code>WindowManagerService</code> \u7a97\u53e3\u7ba1\u7406 \u9ad8\u4f18\u5148\u7ea7\u7a97\u53e3\u64cd\u4f5c\uff08\u5982 <code>Activity</code> \u5207\u6362\uff09 <code>AnimationHandler</code> \u5c5e\u6027\u52a8\u753b\u9a71\u52a8 \u786e\u4fdd\u52a8\u753b\u5e27\u6309 <code>VSYNC</code> \u66f4\u65b0 <code>SurfaceFlinger</code> \u56fe\u5f62\u5408\u6210 \u5408\u6210\u64cd\u4f5c\u4e0e <code>VSYNC</code> \u540c\u6b65"},{"location":"030Android/010Basic/#_38","title":"\u4e3a\u4ec0\u4e48\u8fd9\u4e9b\u573a\u666f\u9700\u8981\u540c\u6b65\u5c4f\u969c\uff1f","text":"<ol> <li>\u907f\u514d\u5361\u987f\uff1a\u9632\u6b62\u666e\u901a\u6d88\u606f\uff08\u5982\u4e1a\u52a1\u903b\u8f91\uff09\u963b\u585e UI \u6e32\u67d3\u6216\u8f93\u5165\u4e8b\u4ef6\u3002  </li> <li>\u4e25\u683c\u65f6\u5e8f\uff1a<code>VSYNC</code> \u4fe1\u53f7\u8981\u6c42\u4efb\u52a1\u5728 16.6ms\uff0860Hz\uff09\u5185\u5b8c\u6210\uff0c\u540c\u6b65\u5c4f\u969c\u786e\u4fdd\u9ad8\u4f18\u5148\u7ea7\u4efb\u52a1\u62a2\u5360\u6267\u884c\u3002  </li> <li>\u4f4e\u5ef6\u8fdf\uff1a\u7528\u6237\u4ea4\u4e92\uff08\u5982\u89e6\u6478\uff09\u9700\u8981\u6beb\u79d2\u7ea7\u54cd\u5e94\uff0c\u5f02\u6b65\u6d88\u606f\u53ef\u8df3\u8fc7\u961f\u5217\u6392\u961f\u3002  </li> </ol>"},{"location":"030Android/010Basic/#_39","title":"\u5f00\u53d1\u8005\u6ce8\u610f\u4e8b\u9879","text":"<ul> <li>\u4e0d\u8981\u6ee5\u7528\u540c\u6b65\u5c4f\u969c\uff1a\u9519\u8bef\u4f7f\u7528\u53ef\u80fd\u5bfc\u81f4\u6d88\u606f\u961f\u5217\u963b\u585e\uff08ANR\uff09\u3002  </li> <li>\u4f18\u5148\u4f7f\u7528\u6807\u51c6 API\uff1a\u5982 <code>Choreographer</code>\u3001<code>View.post()</code>\uff0c\u800c\u975e\u76f4\u63a5\u64cd\u4f5c\u5c4f\u969c\u3002  </li> <li>\u5f02\u6b65\u6d88\u606f\u9700\u663e\u5f0f\u6807\u8bb0\uff1a<code>msg.setAsynchronous(true)</code>\u3002  </li> </ul> <p>\u540c\u6b65\u5c4f\u969c\u662f Android \u6d41\u7545\u6027\u7684\u6838\u5fc3\u673a\u5236\u4e4b\u4e00\uff0c\u4f46\u5b83\u7684\u4f7f\u7528\u88ab\u4e25\u683c\u9650\u5236\u5728\u7cfb\u7edf\u5c42\uff0c\u666e\u901a\u5e94\u7528\u65e0\u9700\uff08\u4e5f\u4e0d\u5e94\uff09\u76f4\u63a5\u8c03\u7528\u3002</p> <p>\u4f60\u4e4b\u6240\u4ee5\u6ca1\u6709\u5728 Android \u6e90\u7801\u4e2d\u76f4\u63a5\u770b\u5230 <code>Looper.getMainLooper().getQueue().postSyncBarrier()</code> \u8fd9\u6837\u7684\u663e\u5f0f\u8c03\u7528\uff0c\u662f\u56e0\u4e3a \u7cfb\u7edf\u5bf9\u540c\u6b65\u5c4f\u969c\u7684\u4f7f\u7528\u8fdb\u884c\u4e86\u9ad8\u5ea6\u5c01\u88c5\uff0c\u901a\u5e38\u901a\u8fc7\u66f4\u9ad8\u7ea7\u7684 API\uff08\u5982 <code>Choreographer</code>\u3001<code>Handler</code> \u5f02\u6b65\u6d88\u606f\u7b49\uff09\u95f4\u63a5\u5b9e\u73b0\u3002\u4ee5\u4e0b\u662f\u5177\u4f53\u539f\u56e0\u548c\u5e95\u5c42\u903b\u8f91\uff1a</p>"},{"location":"030Android/010Basic/#1_3","title":"1. \u540c\u6b65\u5c4f\u969c\u7684\u8c03\u7528\u88ab\u5c01\u88c5\u5728\u5e95\u5c42","text":"<p>\u7cfb\u7edf\u6838\u5fc3\u7c7b\uff08\u5982 <code>Choreographer</code>\u3001<code>ViewRootImpl</code>\uff09\u5e76\u4e0d\u4f1a\u76f4\u63a5\u8c03\u7528 <code>postSyncBarrier()</code>\uff0c\u800c\u662f\u901a\u8fc7\u4ee5\u4e0b\u65b9\u5f0f\u95f4\u63a5\u4f7f\u7528\uff1a</p>"},{"location":"030Android/010Basic/#1-choreographer-vsync","title":"(1) \u901a\u8fc7 <code>Choreographer</code> \u89e6\u53d1 VSYNC \u4fe1\u53f7","text":"<ul> <li><code>Choreographer</code> \u901a\u8fc7 <code>DisplayEventReceiver</code> \u8bf7\u6c42 <code>VSYNC</code> \u4fe1\u53f7\u65f6\uff0c\u5185\u90e8\u4f1a\u63d2\u5165\u540c\u6b65\u5c4f\u969c\u3002</li> <li>\u5173\u952e\u4ee3\u7801\uff08\u7b80\u5316\u903b\u8f91\uff09\uff1a <pre><code>// Choreographer.java\nvoid scheduleFrameLocked() {\n    if (USE_VSYNC) {\n        // \u901a\u8fc7 Native \u5c42\u6ce8\u518c VSYNC \u4fe1\u53f7\u76d1\u542c\uff0c\u5e95\u5c42\u4f1a\u81ea\u52a8\u63d2\u5165\u540c\u6b65\u5c4f\u969c\n        mDisplayEventReceiver.scheduleVsync();\n    } else {\n        // \u6d4b\u8bd5\u73af\u5883\uff1a\u76f4\u63a5\u53d1\u9001\u5f02\u6b65\u6d88\u606f\n        Message msg = mHandler.obtainMessage(MSG_DO_FRAME);\n        msg.setAsynchronous(true); // \u6807\u8bb0\u4e3a\u5f02\u6b65\u6d88\u606f\n        mHandler.sendMessageAtFrontOfQueue(msg);\n    }\n}\n</code></pre></li> <li>\u5c4f\u969c\u7684\u63d2\u5165\u5b9e\u9645\u53d1\u751f\u5728 Native \u5c42\uff08\u5982 <code>DisplayEventDispatcher</code>\uff09\uff0c\u800c\u975e Java \u5c42\u7684\u663e\u5f0f\u8c03\u7528\u3002</li> </ul>"},{"location":"030Android/010Basic/#2-messagequeue","title":"(2) \u901a\u8fc7 <code>MessageQueue</code> \u5185\u90e8\u65b9\u6cd5","text":"<ul> <li>\u7cfb\u7edf\u4f1a\u76f4\u63a5\u8c03\u7528 <code>MessageQueue</code> \u7684 Native \u65b9\u6cd5\uff08\u5982 <code>nativePostSyncBarrier</code>\uff09\uff0c\u800c\u975e\u901a\u8fc7 <code>Looper</code> \u7684\u516c\u5f00 API\u3002</li> <li>\u4f8b\u5982 <code>ViewRootImpl</code> \u7684 UI \u7ed8\u5236\u6d41\u7a0b\u4e2d\uff0c\u540c\u6b65\u5c4f\u969c\u7684\u63d2\u5165\u7531 <code>Choreographer</code> \u7684 VSYNC \u673a\u5236\u89e6\u53d1\uff0c\u800c\u975e\u624b\u52a8\u8c03\u7528\u3002</li> </ul>"},{"location":"030Android/010Basic/#2-postsyncbarrier","title":"2. \u4e3a\u4ec0\u4e48\u7cfb\u7edf\u907f\u514d\u76f4\u63a5\u8c03\u7528 <code>postSyncBarrier()</code>\uff1f","text":""},{"location":"030Android/010Basic/#1_4","title":"(1) \u5b89\u5168\u6027\u548c\u5c01\u88c5\u6027","text":"<ul> <li>\u540c\u6b65\u5c4f\u969c\u82e5\u4f7f\u7528\u4e0d\u5f53\uff08\u5982\u672a\u79fb\u9664\uff09\u4f1a\u5bfc\u81f4 \u6d88\u606f\u961f\u5217\u6c38\u4e45\u963b\u585e\uff08ANR\uff09\u3002</li> <li>\u7cfb\u7edf\u901a\u8fc7\u5c01\u88c5\uff08\u5982 <code>Choreographer</code>\uff09\u786e\u4fdd\u5c4f\u969c\u7684\u63d2\u5165\u548c\u79fb\u9664\u4e25\u683c\u914d\u5bf9\u3002</li> </ul>"},{"location":"030Android/010Basic/#2_3","title":"(2) \u6027\u80fd\u4f18\u5316","text":"<ul> <li>\u76f4\u63a5\u8c03\u7528 Java \u5c42\u7684 <code>postSyncBarrier()</code> \u4f1a\u6709\u6027\u80fd\u5f00\u9500\uff0c\u800c Native \u5c42\u5b9e\u73b0\u66f4\u9ad8\u6548\u3002</li> <li>\u4f8b\u5982 <code>VSYNC</code> \u4fe1\u53f7\u7684\u5904\u7406\u9700\u8981\u7eb3\u79d2\u7ea7\u7cbe\u5ea6\uff0cNative \u5c42\u66f4\u9002\u5408\u3002</li> </ul>"},{"location":"030Android/010Basic/#3_4","title":"(3) \u517c\u5bb9\u6027","text":"<ul> <li>\u540c\u6b65\u5c4f\u969c\u662f\u4f4e\u5c42\u673a\u5236\uff0cAndroid \u901a\u8fc7\u9ad8\u5c42 API\uff08\u5982 <code>Handler#sendMessageAtFrontOfQueue()</code> + \u5f02\u6b65\u6d88\u606f\uff09\u5bf9\u5f00\u53d1\u8005\u9690\u85cf\u7ec6\u8282\u3002</li> </ul>"},{"location":"030Android/010Basic/#3_5","title":"3. \u5982\u4f55\u9a8c\u8bc1\u7cfb\u7edf\u786e\u5b9e\u4f7f\u7528\u4e86\u540c\u6b65\u5c4f\u969c\uff1f","text":"<p>\u867d\u7136\u4ee3\u7801\u4e2d\u6ca1\u6709\u663e\u5f0f\u8c03\u7528 <code>postSyncBarrier()</code>\uff0c\u4f46\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u65b9\u5f0f\u9a8c\u8bc1\uff1a</p>"},{"location":"030Android/010Basic/#1_5","title":"(1) \u6253\u5370\u6d88\u606f\u961f\u5217","text":"<p>\u5728 Android \u6e90\u7801\u4e2d\u4fee\u6539 <code>MessageQueue</code> \u7684 <code>next()</code> \u65b9\u6cd5\uff0c\u6253\u5370\u5c4f\u969c\u4fe1\u606f\uff1a <pre><code>Message next() {\n    for (;;) {\n        if (msg != null &amp;&amp; msg.target == null) {\n            Log.d(\"SyncBarrier\", \"\u5c4f\u969c\u5b58\u5728\uff01\u8df3\u8fc7\u540c\u6b65\u6d88\u606f\");\n            // \u53ea\u5904\u7406\u5f02\u6b65\u6d88\u606f\n        }\n    }\n}\n</code></pre> \u8fd0\u884c\u540e\u89c2\u5bdf\u65e5\u5fd7\uff0c\u5f53 UI \u7ed8\u5236\u6216\u52a8\u753b\u6267\u884c\u65f6\uff0c\u4f1a\u770b\u5230\u540c\u6b65\u5c4f\u969c\u751f\u6548\u3002</p>"},{"location":"030Android/010Basic/#2-systrace","title":"(2) \u4f7f\u7528 Systrace \u5de5\u5177","text":"<p>\u901a\u8fc7 <code>systrace</code> \u6293\u53d6 UI \u7ebf\u7a0b\u7684\u6267\u884c\u60c5\u51b5\uff1a <pre><code>$ python systrace.py -a com.example.app sched gfx view -o trace.html\n</code></pre> \u5728 <code>trace.html</code> \u4e2d\u641c\u7d22 <code>sync barrier</code>\uff0c\u53ef\u770b\u5230\u5c4f\u969c\u7684\u63d2\u5165\u548c\u79fb\u9664\u4e8b\u4ef6\u3002</p>"},{"location":"030Android/010Basic/#4_3","title":"4. \u5f00\u53d1\u8005\u80fd\u5426\u76f4\u63a5\u4f7f\u7528\u540c\u6b65\u5c4f\u969c\uff1f","text":"<p>\u6280\u672f\u4e0a\u53ef\u4ee5\uff0c\u4f46\u5f3a\u70c8\u4e0d\u5efa\u8bae\uff01 \u82e5\u5fc5\u987b\u4f7f\u7528\uff0c\u9700\u4e25\u683c\u9075\u5faa\u4ee5\u4e0b\u89c4\u5219\uff1a <pre><code>// 1. \u63d2\u5165\u5c4f\u969c\nint token = Looper.getMainLooper().getQueue().postSyncBarrier();\n\n// 2. \u53d1\u9001\u5f02\u6b65\u6d88\u606f\uff08\u786e\u4fdd\u6267\u884c\uff09\nHandler handler = new Handler(Looper.getMainLooper());\nMessage asyncMsg = handler.obtainMessage(() -&gt; {\n    Log.d(\"Test\", \"\u5f02\u6b65\u6d88\u606f\u6267\u884c\");\n    // 3. \u79fb\u9664\u5c4f\u969c\uff08\u5426\u5219\u540c\u6b65\u6d88\u606f\u6c38\u8fdc\u963b\u585e\uff01\uff09\n    Looper.getMainLooper().getQueue().removeSyncBarrier(token);\n});\nasyncMsg.setAsynchronous(true);\nhandler.sendMessageDelayed(asyncMsg, 1000);\n\n// 4. \u540c\u6b65\u6d88\u606f\u4f1a\u88ab\u963b\u585e\nhandler.post(() -&gt; Log.d(\"Test\", \"\u666e\u901a\u6d88\u606f\u6267\u884c\")); // \u53ef\u80fd\u4e0d\u4f1a\u6267\u884c\n</code></pre> \u98ce\u9669\uff1a - \u82e5\u5fd8\u8bb0\u79fb\u9664\u5c4f\u969c\uff0c\u4e3b\u7ebf\u7a0b\u4f1a ANR\u3002 - \u5f02\u6b65\u6d88\u606f\u672a\u6b63\u786e\u6807\u8bb0\uff08<code>setAsynchronous(true)</code>\uff09\u4f1a\u5bfc\u81f4\u5c4f\u969c\u5931\u6548\u3002</p>"},{"location":"030Android/010Basic/#5_3","title":"5. \u603b\u7ed3\uff1a\u4e3a\u4f55\u770b\u4e0d\u5230\u663e\u5f0f\u8c03\u7528\uff1f","text":"\u539f\u56e0 \u8bf4\u660e \u5c01\u88c5\u6027 \u7cfb\u7edf\u901a\u8fc7 <code>Choreographer</code>\u3001<code>VSYNC</code> \u7b49\u9ad8\u5c42 API \u9690\u85cf\u7ec6\u8282\u3002 Native \u5c42\u5b9e\u73b0 \u5c4f\u969c\u7684\u63d2\u5165\u66f4\u591a\u7531 Native \u4ee3\u7801\uff08\u5982 <code>DisplayEventReceiver</code>\uff09\u89e6\u53d1\u3002 \u5b89\u5168\u9650\u5236 \u907f\u514d\u5f00\u53d1\u8005\u8bef\u7528\u5bfc\u81f4\u6d88\u606f\u961f\u5217\u963b\u585e\u3002 \u6027\u80fd\u4f18\u5316 \u76f4\u63a5\u64cd\u4f5c <code>MessageQueue</code> \u7684 Java \u65b9\u6cd5\u4e0d\u5982 Native \u5c42\u9ad8\u6548\u3002 <p>\u7ed3\u8bba\uff1a \u540c\u6b65\u5c4f\u969c\u662f Android \u6d88\u606f\u673a\u5236\u7684\u5e95\u5c42\u80fd\u529b\uff0c\u7cfb\u7edf\u901a\u8fc7\u8bbe\u8ba1\u6a21\u5f0f\uff08\u5982\u5c01\u88c5\u3001\u56de\u8c03\uff09\u5c06\u5176\u9690\u85cf\uff0c\u666e\u901a\u5f00\u53d1\u65e0\u9700\u63a5\u89e6\uff0c\u4f46\u7406\u89e3\u5176\u539f\u7406\u6709\u52a9\u4e8e\u4f18\u5316 UI \u6027\u80fd\u3002</p> <p>\u5728 Android \u7684 Handler \u6d88\u606f\u673a\u5236 \u4e2d\uff0c<code>setAsynchronous(true)</code>\uff08\u8bbe\u7f6e\u5f02\u6b65\u6d88\u606f\uff09\u548c\u540c\u6b65\u5c4f\u969c\uff08Sync Barrier\uff09\u7684\u5173\u7cfb \u662f\u4e00\u4e2a\u5173\u952e\u95ee\u9898\u3002\u4ee5\u4e0b\u662f\u8be6\u7ec6\u89e3\u7b54\uff1a</p>"},{"location":"030Android/010Basic/#1_6","title":"1. \u6838\u5fc3\u7ed3\u8bba","text":"<ul> <li>\u4e0d\u9700\u8981\u5148\u5f00\u542f\u540c\u6b65\u5c4f\u969c\uff0c\u4e5f\u80fd\u4f7f\u7528 <code>setAsynchronous(true)</code> \u5f02\u6b65\u6d88\u606f\u53ef\u4ee5\u6b63\u5e38\u53d1\u9001\u548c\u5904\u7406\uff0c\u65e0\u8bba\u662f\u5426\u5b58\u5728\u540c\u6b65\u5c4f\u969c\u3002</li> <li>\u4f46\u5f02\u6b65\u6d88\u606f\u7684\u201c\u4f18\u5148\u7ea7\u4f18\u52bf\u201d\u53ea\u6709\u5728\u540c\u6b65\u5c4f\u969c\u5b58\u5728\u65f6\u624d\u4f1a\u751f\u6548 \u82e5\u65e0\u540c\u6b65\u5c4f\u969c\uff0c\u5f02\u6b65\u6d88\u606f\u548c\u666e\u901a\u6d88\u606f\u7684\u5904\u7406\u987a\u5e8f\u76f8\u540c\uff08\u6309\u65f6\u95f4\u6392\u5e8f\uff09\u3002</li> </ul>"},{"location":"030Android/010Basic/#2-vs","title":"2. \u5f02\u6b65\u6d88\u606f vs \u540c\u6b65\u5c4f\u969c\u7684\u5173\u7cfb","text":""},{"location":"030Android/010Basic/#1_7","title":"(1) \u65e0\u540c\u6b65\u5c4f\u969c\u65f6","text":"<ul> <li>\u5f02\u6b65\u6d88\u606f\u548c\u666e\u901a\u6d88\u606f\u5e73\u7b49\uff1a\u5747\u6309 <code>when</code>\uff08\u89e6\u53d1\u65f6\u95f4\uff09\u6392\u5e8f\uff0c\u65e0\u4f18\u5148\u7ea7\u533a\u522b\u3002 <pre><code>Handler handler = new Handler(Looper.getMainLooper());\n\n// \u5f02\u6b65\u6d88\u606f\uff08\u65e0\u5c4f\u969c\u65f6\uff0c\u548c\u666e\u901a\u6d88\u606f\u884c\u4e3a\u4e00\u81f4\uff09\nMessage asyncMsg = handler.obtainMessage(() -&gt; Log.d(\"Test\", \"Async Msg\"));\nasyncMsg.setAsynchronous(true);\nhandler.sendMessageDelayed(asyncMsg, 1000);\n\n// \u666e\u901a\u6d88\u606f\nhandler.postDelayed(() -&gt; Log.d(\"Test\", \"Sync Msg\"), 1000);\n</code></pre> \u8f93\u51fa\u987a\u5e8f\uff1a\u53d6\u51b3\u4e8e <code>when</code>\uff0c\u82e5\u65f6\u95f4\u76f8\u540c\u5219\u6309\u63d2\u5165\u987a\u5e8f\uff08\u53ef\u80fd\u5148\u8f93\u51fa <code>Async Msg</code> \u6216 <code>Sync Msg</code>\uff09\u3002</li> </ul>"},{"location":"030Android/010Basic/#2_4","title":"(2) \u6709\u540c\u6b65\u5c4f\u969c\u65f6","text":"<ul> <li>\u5f02\u6b65\u6d88\u606f\u4f18\u5148\u6267\u884c\uff1a\u540c\u6b65\u5c4f\u969c\u4f1a\u963b\u585e\u666e\u901a\u6d88\u606f\uff0c\u4ec5\u5904\u7406\u5f02\u6b65\u6d88\u606f\u3002 <pre><code>// \u63d2\u5165\u540c\u6b65\u5c4f\u969c\nint token = Looper.getMainLooper().getQueue().postSyncBarrier();\n\n// \u5f02\u6b65\u6d88\u606f\uff08\u4f18\u5148\u6267\u884c\uff09\nMessage asyncMsg = handler.obtainMessage(() -&gt; {\n    Log.d(\"Test\", \"Async Msg\");\n    // \u79fb\u9664\u5c4f\u969c\uff08\u5426\u5219\u540c\u6b65\u6d88\u606f\u6c38\u8fdc\u4e0d\u6267\u884c\uff09\n    Looper.getMainLooper().getQueue().removeSyncBarrier(token);\n});\nasyncMsg.setAsynchronous(true);\nhandler.sendMessageDelayed(asyncMsg, 1000);\n\n// \u666e\u901a\u6d88\u606f\uff08\u88ab\u963b\u585e\uff0c\u76f4\u5230\u5c4f\u969c\u79fb\u9664\uff09\nhandler.postDelayed(() -&gt; Log.d(\"Test\", \"Sync Msg\"), 1000);\n</code></pre> \u8f93\u51fa\u987a\u5e8f\uff1a <code>Async Msg</code> \u2192 <code>Sync Msg</code>\uff08\u5c4f\u969c\u79fb\u9664\u540e\uff09\u3002</li> </ul>"},{"location":"030Android/010Basic/#3_6","title":"3. \u7cfb\u7edf\u5982\u4f55\u5229\u7528\u8fd9\u4e00\u673a\u5236\uff1f","text":"<p>\u7cfb\u7edf\u7c7b\uff08\u5982 <code>Choreographer</code>\uff09\u7684\u5178\u578b\u6d41\u7a0b\uff1a 1. \u63d2\u5165\u540c\u6b65\u5c4f\u969c\uff08\u901a\u8fc7 VSYNC \u4fe1\u53f7\u6216\u76f4\u63a5\u8c03\u7528\uff09\u3002 2. \u53d1\u9001\u5f02\u6b65\u6d88\u606f\uff08\u5982 <code>MSG_DO_FRAME</code>\uff09\uff0c\u6807\u8bb0\u4e3a <code>setAsynchronous(true)</code>\u3002 3. \u6d88\u606f\u961f\u5217\u8df3\u8fc7\u666e\u901a\u6d88\u606f\uff0c\u4f18\u5148\u6267\u884c\u5f02\u6b65\u6d88\u606f\uff08\u5982 UI \u6e32\u67d3\uff09\u3002 4. \u5c4f\u969c\u79fb\u9664\uff0c\u6062\u590d\u666e\u901a\u6d88\u606f\u5904\u7406\u3002</p> <p>\u5173\u952e\u4ee3\u7801\u7247\u6bb5\uff1a <pre><code>// Choreographer.java\nvoid scheduleFrameLocked() {\n    // 1. \u901a\u8fc7 VSYNC \u4fe1\u53f7\u63d2\u5165\u540c\u6b65\u5c4f\u969c\uff08Native \u5c42\u5b9e\u73b0\uff09\n    mDisplayEventReceiver.scheduleVsync(); \n\n    // 2. \u53d1\u9001\u5f02\u6b65\u6d88\u606f\n    Message msg = mHandler.obtainMessage(MSG_DO_FRAME);\n    msg.setAsynchronous(true); // \u5fc5\u987b\u6807\u8bb0\u4e3a\u5f02\u6b65\n    mHandler.sendMessageAtFrontOfQueue(msg);\n}\n</code></pre></p>"},{"location":"030Android/010Basic/#4_4","title":"4. \u6ce8\u610f\u4e8b\u9879","text":"<ol> <li>\u5f02\u6b65\u6d88\u606f\u4e0d\u4f9d\u8d56\u5c4f\u969c\u5b58\u5728\uff1a \u5373\u4f7f\u6ca1\u6709\u5c4f\u969c\uff0c\u5f02\u6b65\u6d88\u606f\u4e5f\u80fd\u6b63\u5e38\u53d1\u9001\u548c\u5904\u7406\uff0c\u53ea\u662f\u65e0\u4f18\u5148\u7ea7\u4f18\u52bf\u3002</li> <li>\u5c4f\u969c\u662f\u5f02\u6b65\u6d88\u606f\u751f\u6548\u7684\u524d\u63d0\uff1a \u82e5\u9700\u8ba9\u5f02\u6b65\u6d88\u606f\u201c\u63d2\u961f\u201d\u6267\u884c\uff0c\u5fc5\u987b\u914d\u5408\u540c\u6b65\u5c4f\u969c\u3002</li> <li>\u5c4f\u969c\u5fc5\u987b\u624b\u52a8\u79fb\u9664\uff1a \u5426\u5219\u666e\u901a\u6d88\u606f\u4f1a\u6c38\u4e45\u963b\u585e\uff08\u5bfc\u81f4 ANR\uff09\u3002</li> <li>Android 4.0+ \u9650\u5236\uff1a \u666e\u901a\u5e94\u7528\u65e0\u6cd5\u76f4\u63a5\u8c03\u7528 <code>postSyncBarrier()</code>\uff08\u9700\u7cfb\u7edf\u6743\u9650\uff09\uff0c\u4f46\u53ef\u901a\u8fc7 <code>Choreographer</code> \u7b49\u7cfb\u7edf API \u95f4\u63a5\u4f7f\u7528\u3002</li> </ol>"},{"location":"030Android/010Basic/#5_4","title":"5. \u793a\u4f8b\u9a8c\u8bc1","text":"<pre><code>// \u573a\u666f1\uff1a\u65e0\u5c4f\u969c\uff0c\u5f02\u6b65\u6d88\u606f\u548c\u666e\u901a\u6d88\u606f\u5e73\u7b49\nhandler.post(() -&gt; {\n    Message asyncMsg = handler.obtainMessage(() -&gt; Log.d(\"Test\", \"Async Msg\"));\n    asyncMsg.setAsynchronous(true);\n    handler.sendMessage(asyncMsg); // \u53ef\u80fd\u665a\u4e8e\u666e\u901a\u6d88\u606f\u6267\u884c\n\n    handler.post(() -&gt; Log.d(\"Test\", \"Sync Msg\")); // \u53ef\u80fd\u5148\u6267\u884c\n});\n\n// \u573a\u666f2\uff1a\u6709\u5c4f\u969c\uff0c\u5f02\u6b65\u6d88\u606f\u4f18\u5148\nint token = Looper.getMainLooper().getQueue().postSyncBarrier();\nhandler.post(() -&gt; {\n    Message asyncMsg = handler.obtainMessage(() -&gt; {\n        Log.d(\"Test\", \"Async Msg\");\n        Looper.getMainLooper().getQueue().removeSyncBarrier(token);\n    });\n    asyncMsg.setAsynchronous(true);\n    handler.sendMessage(asyncMsg); // \u4e00\u5b9a\u5148\u6267\u884c\n\n    handler.post(() -&gt; Log.d(\"Test\", \"Sync Msg\")); // \u5c4f\u969c\u79fb\u9664\u540e\u6267\u884c\n});\n</code></pre>"},{"location":"030Android/010Basic/#_40","title":"\u603b\u7ed3","text":"\u573a\u666f <code>setAsynchronous(true)</code> \u662f\u5426\u6709\u6548 \u662f\u5426\u9700\u8981\u540c\u6b65\u5c4f\u969c \u8bf4\u660e \u65e0\u5c4f\u969c \u2705 \u662f \u274c \u5426 \u5f02\u6b65\u6d88\u606f\u548c\u666e\u901a\u6d88\u606f\u5e73\u7b49\u5904\u7406\u3002 \u6709\u5c4f\u969c \u2705 \u662f \u2705 \u662f \u5f02\u6b65\u6d88\u606f\u4f18\u5148\u6267\u884c\u3002 \u7cfb\u7edf\u7ea7\u4efb\u52a1 \u2705 \u662f \u2705 \u662f\uff08\u9690\u5f0f\uff09 \u5982 <code>Choreographer</code> \u81ea\u52a8\u89e6\u53d1\u3002 <p>\u6700\u7ec8\u7b54\u6848\uff1a \u5f02\u6b65\u6d88\u606f\u53ef\u4ee5\u72ec\u7acb\u4f7f\u7528\uff0c\u4f46\u82e5\u60f3\u8ba9\u5b83\u201c\u8df3\u8fc7\u961f\u5217\u4f18\u5148\u6267\u884c\u201d\uff0c\u5fc5\u987b\u914d\u5408\u540c\u6b65\u5c4f\u969c\u3002\u7cfb\u7edf\u901a\u8fc7\u5c01\u88c5\uff08\u5982 <code>Choreographer</code>\uff09\u81ea\u52a8\u7ba1\u7406\u8fd9\u4e00\u8fc7\u7a0b\uff0c\u5f00\u53d1\u8005\u901a\u5e38\u65e0\u9700\u76f4\u63a5\u64cd\u4f5c\u3002</p>"},{"location":"030Android/010Basic/#handlerthreadhandlerthread","title":"Handler,Thread\u548cHandlerThread\u7684\u5dee\u522b","text":"\u7b54\u6848 <p>\u5728Android\u5f00\u53d1\u4e2d\uff0c<code>Handler</code>\u3001<code>Thread</code>\u548c<code>HandlerThread</code>\u662f\u5e38\u7528\u7684\u591a\u7ebf\u7a0b\u5904\u7406\u5de5\u5177\uff0c\u5b83\u4eec\u5404\u81ea\u6709\u4e0d\u540c\u7684\u7528\u9014\u548c\u7279\u70b9\u3002\u4ee5\u4e0b\u662f\u5b83\u4eec\u7684\u533a\u522b\uff1a</p>"},{"location":"030Android/010Basic/#1-thread","title":"1. Thread","text":"<ul> <li>\u5b9a\u4e49\uff1a<code>Thread</code>\u662fJava\u4e2d\u7684\u57fa\u672c\u591a\u7ebf\u7a0b\u5b9e\u73b0\u7c7b\uff0c\u7528\u4e8e\u521b\u5efa\u5e76\u6267\u884c\u5f02\u6b65\u4efb\u52a1\u3002</li> <li>\u7279\u70b9\uff1a</li> <li>\u76f4\u63a5\u7ee7\u627f<code>Thread</code>\u7c7b\u6216\u5b9e\u73b0<code>Runnable</code>\u63a5\u53e3\u6765\u521b\u5efa\u7ebf\u7a0b\u3002</li> <li>\u9002\u7528\u4e8e\u6267\u884c\u8017\u65f6\u64cd\u4f5c\uff08\u5982\u7f51\u7edc\u8bf7\u6c42\u3001\u6587\u4ef6\u8bfb\u5199\u7b49\uff09\u3002</li> <li>\u7ebf\u7a0b\u6267\u884c\u5b8c\u6210\u540e\u4f1a\u81ea\u52a8\u9500\u6bc1\u3002</li> <li>\u7f3a\u70b9\uff1a</li> <li>\u65e0\u6cd5\u76f4\u63a5\u66f4\u65b0UI\uff08Android\u7684UI\u7ebf\u7a0b\u662f\u5355\u7ebf\u7a0b\u6a21\u578b\uff0c\u975eUI\u7ebf\u7a0b\u4e0d\u80fd\u76f4\u63a5\u64cd\u4f5cUI\uff09\u3002</li> <li>\u9700\u8981\u624b\u52a8\u7ba1\u7406\u7ebf\u7a0b\u7684\u751f\u547d\u5468\u671f\u548c\u8d44\u6e90\u91ca\u653e\u3002</li> <li>\u793a\u4f8b\uff1a <pre><code>new Thread(new Runnable() {\n    @Override\n    public void run() {\n        // \u6267\u884c\u8017\u65f6\u64cd\u4f5c\n    }\n}).start();\n</code></pre></li> </ul>"},{"location":"030Android/010Basic/#2-handler","title":"2. Handler","text":"<ul> <li>\u5b9a\u4e49\uff1a<code>Handler</code>\u662fAndroid\u4e2d\u7528\u4e8e\u7ebf\u7a0b\u95f4\u901a\u4fe1\u7684\u5de5\u5177\uff0c\u901a\u5e38\u4e0e<code>Looper</code>\u548c<code>MessageQueue</code>\u914d\u5408\u4f7f\u7528\u3002</li> <li>\u7279\u70b9\uff1a</li> <li>\u4e3b\u8981\u7528\u4e8e\u5728\u4e3b\u7ebf\u7a0b\u548c\u5b50\u7ebf\u7a0b\u4e4b\u95f4\u4f20\u9012\u6d88\u606f\u6216\u4efb\u52a1\u3002</li> <li>\u53ef\u4ee5\u5c06\u4efb\u52a1\uff08<code>Runnable</code>\uff09\u6216\u6d88\u606f\uff08<code>Message</code>\uff09\u53d1\u9001\u5230\u4e0e<code>Handler</code>\u5173\u8054\u7684\u7ebf\u7a0b\u4e2d\u6267\u884c\u3002</li> <li>\u901a\u5e38\u7528\u4e8e\u66f4\u65b0UI\uff08\u56e0\u4e3a<code>Handler</code>\u53ef\u4ee5\u7ed1\u5b9a\u5230\u4e3b\u7ebf\u7a0b\u7684<code>Looper</code>\uff09\u3002</li> <li>\u4f7f\u7528\u573a\u666f\uff1a</li> <li>\u5728\u5b50\u7ebf\u7a0b\u4e2d\u6267\u884c\u8017\u65f6\u64cd\u4f5c\u540e\uff0c\u901a\u8fc7<code>Handler</code>\u5c06\u7ed3\u679c\u53d1\u9001\u5230\u4e3b\u7ebf\u7a0b\u66f4\u65b0UI\u3002</li> <li>\u793a\u4f8b\uff1a <pre><code>Handler handler = new Handler(Looper.getMainLooper());\nnew Thread(new Runnable() {\n    @Override\n    public void run() {\n        // \u6267\u884c\u8017\u65f6\u64cd\u4f5c\n        handler.post(new Runnable() {\n            @Override\n            public void run() {\n                // \u5728\u4e3b\u7ebf\u7a0b\u66f4\u65b0UI\n            }\n        });\n    }\n}).start();\n</code></pre></li> </ul>"},{"location":"030Android/010Basic/#3-handlerthread","title":"3. HandlerThread","text":"<ul> <li>\u5b9a\u4e49\uff1a<code>HandlerThread</code>\u662fAndroid\u63d0\u4f9b\u7684\u4e00\u4e2a\u5e26\u6709<code>Looper</code>\u7684\u7ebf\u7a0b\u7c7b\uff0c\u7ed3\u5408\u4e86<code>Thread</code>\u548c<code>Handler</code>\u7684\u529f\u80fd\u3002</li> <li>\u7279\u70b9\uff1a</li> <li>\u7ee7\u627f\u81ea<code>Thread</code>\uff0c\u5185\u90e8\u5b9e\u73b0\u4e86<code>Looper</code>\uff0c\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528<code>Handler</code>\u3002</li> <li>\u9002\u7528\u4e8e\u9700\u8981\u957f\u65f6\u95f4\u8fd0\u884c</li> </ul>"},{"location":"030Android/010Basic/#handlerthread","title":"HandlerThread\u7279\u5f81","text":"\u7b54\u6848 <ol> <li>HandlerThread\u5176\u5b9e\u662fHandler+Thread+Looper\u7684\u7ec4\u5408\uff0c\u5b83\u672c\u8d28\u4e0a\u662f\u4e00\u4e2aThread\uff0c\u56e0\u4e3a\u5b83\u7ee7\u627f\u4e86Thread\uff0c\u76f8\u6bd4\u666e\u901a\u7684Thread\uff0c\u4ed6\u4e0d\u4f1a\u963b\u585e\uff0c\u56e0\u4e3a\u5b83\u5185\u90e8\u901a\u8fc7Looper\u5b9e\u73b0\u4e86\u6d88\u606f\u5faa\u73af\u673a\u5236\uff0c\u4fdd\u8bc1\u4e86\u591a\u4e2a\u4efb\u52a1\u7684\u4e32\u884c\u6267\u884c\u3002\u7f3a\u70b9\uff1a\u6548\u7387\u4f4e\u3002</li> <li>HandlerThread\u9700\u8981\u642d\u914dHandler\u4f7f\u7528\uff0c\u5355\u72ec\u4f7f\u7528\u7684\u610f\u4e49\u4e0d\u5927\u3002HandlerThread\u7ebf\u7a0b\u4e2d\u4f5c\u5177\u4f53\u7684\u4e8b\u60c5\uff0c\u5fc5\u987b\u8981\u5728Handler\u7684callback\u63a5\u53e3\u4e2d\u8fdb\u884c\uff0c\u4ed6\u81ea\u5df1\u7684run\u65b9\u6cd5\u88ab\u5199\u6b7b\u4e86\u3002</li> <li>\u5b50\u7ebf\u7a0b\u4e2d\u7684Handler\u4e0eHandlerThread\u7684\u8054\u7cfb\u662f\u901a\u8fc7childHandler=new Handler(handlerThread.getLooper(),mSubCallback)\u6267\u884c\u7684\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0cchildHandler\u83b7\u5f97HandlerThread\u7ebf\u7a0b\u7684Looper\uff0c\u8fd9\u6837\u4ed6\u4eec\u4e24\u4e2a\u5c31\u5728\u540c\u4e00\u4e2a\u9635\u8425\u4e86\uff0c\u8fd9\u4e5f\u5c31\u662f\u521b\u5efaHandler\u4f5c\u4e3aHandlerThread\u7ebf\u7a0b\u6d88\u606f\u6267\u884c\u8005\uff0c\u5fc5\u987b\u5728\u8c03\u7528start()\u65b9\u6cd5\u4e4b\u540e\u7684\u539f\u56e0 \u2014\u2014 HandlerThread.start()\u4e4b\u540e\uff0crun\u65b9\u6cd5\u624d\u80fd\u8dd1\u8d77\u6765\uff0cLooper\u624d\u5f97\u4ee5\u521b\u5efa\uff0chandlerThread.getLooper()\u624d\u4e0d\u4f1a\u51fa\u9519\u3002</li> <li>HandlerThread\u4f1a\u5c06\u901a\u8fc7handleMessage\u4f20\u9012\u8fdb\u6765\u7684\u4efb\u52a1\u8fdb\u884c\u4e32\u884c\u6267\u884c\uff0c\u7531messageQueue\u7684\u7279\u6027\u51b3\u5b9a\u7684\uff0c\u4ece\u800c\u4e5f\u8bf4\u660e\u4e86HandlerThread\u6548\u7387\u76f8\u5bf9\u6bd4\u8f83\u4f4e\u3002</li> </ol>"},{"location":"030Android/010Basic/#android_1","title":"Android\u5e73\u53f0\uff0c\u54ea\u4e9b\u60c5\u51b5\u4e0b\u4f1a\u5bfc\u81f4\u5185\u5b58\u6cc4\u6f0f\uff1f","text":"\u7b54\u6848 <p>\u5728Android\u5e73\u53f0\u4e0a\uff0c\u5185\u5b58\u6cc4\u6f0f\u901a\u5e38\u53d1\u751f\u5728\u4ee5\u4e0b\u60c5\u51b5\u4e0b\uff1a</p>"},{"location":"030Android/010Basic/#1_8","title":"1. \u9759\u6001\u5f15\u7528","text":"<ul> <li>\u9759\u6001\u53d8\u91cf\uff1a\u9759\u6001\u53d8\u91cf\u6301\u6709Activity\u6216Context\u7684\u5f15\u7528\uff0c\u5bfc\u81f4\u5176\u65e0\u6cd5\u88ab\u56de\u6536\u3002</li> <li>\u5355\u4f8b\u6a21\u5f0f\uff1a\u5355\u4f8b\u7c7b\u6301\u6709Context\u5f15\u7528\uff0c\u4e14\u672a\u53ca\u65f6\u91ca\u653e\u3002</li> </ul>"},{"location":"030Android/010Basic/#2_5","title":"2. \u975e\u9759\u6001\u5185\u90e8\u7c7b","text":"<ul> <li>Handler\uff1a\u975e\u9759\u6001\u5185\u90e8\u7c7bHandler\u6301\u6709\u5916\u90e8\u7c7b\uff08\u5982Activity\uff09\u7684\u5f15\u7528\uff0c\u82e5Handler\u672a\u5904\u7406\u5b8c\u6d88\u606f\uff0cActivity\u65e0\u6cd5\u88ab\u56de\u6536\u3002</li> <li>AsyncTask\uff1a\u975e\u9759\u6001\u5185\u90e8\u7c7bAsyncTask\u6301\u6709\u5916\u90e8\u7c7b\u5f15\u7528\uff0c\u82e5\u4efb\u52a1\u672a\u5b8c\u6210\uff0c\u5916\u90e8\u7c7b\u65e0\u6cd5\u88ab\u56de\u6536\u3002</li> </ul>"},{"location":"030Android/010Basic/#3_7","title":"3. \u8d44\u6e90\u672a\u91ca\u653e","text":"<ul> <li>\u672a\u5173\u95ed\u7684Cursor\uff1a\u6570\u636e\u5e93\u67e5\u8be2\u540e\u672a\u5173\u95edCursor\u3002</li> <li>\u672a\u91ca\u653e\u7684Bitmap\uff1aBitmap\u4f7f\u7528\u540e\u672a\u8c03\u7528<code>recycle()</code>\u65b9\u6cd5\u3002</li> <li>\u672a\u53d6\u6d88\u7684\u76d1\u542c\u5668\uff1a\u6ce8\u518c\u7684\u76d1\u542c\u5668\u672a\u53ca\u65f6\u53d6\u6d88\u3002</li> </ul>"},{"location":"030Android/010Basic/#4_5","title":"4. \u533f\u540d\u5185\u90e8\u7c7b","text":"<ul> <li>\u533f\u540d\u5185\u90e8\u7c7b\uff1a\u533f\u540d\u5185\u90e8\u7c7b\u9690\u5f0f\u6301\u6709\u5916\u90e8\u7c7b\u5f15\u7528\uff0c\u82e5\u5176\u751f\u547d\u5468\u671f\u957f\u4e8e\u5916\u90e8\u7c7b\uff0c\u4f1a\u5bfc\u81f4\u5185\u5b58\u6cc4\u6f0f\u3002</li> </ul>"},{"location":"030Android/010Basic/#5-context","title":"5. Context\u5f15\u7528","text":"<ul> <li>\u9519\u8bef\u7684Context\u4f7f\u7528\uff1a\u4f7f\u7528Activity Context\u4ee3\u66ffApplication Context\uff0c\u5bfc\u81f4Activity\u65e0\u6cd5\u88ab\u56de\u6536\u3002</li> </ul>"},{"location":"030Android/010Basic/#6_1","title":"6. \u96c6\u5408\u7c7b","text":"<ul> <li>\u672a\u6e05\u7406\u7684\u96c6\u5408\uff1a\u96c6\u5408\u7c7b\u6301\u6709\u5bf9\u8c61\u5f15\u7528\uff0c\u672a\u53ca\u65f6\u6e05\u7406\u4f1a\u5bfc\u81f4\u5bf9\u8c61\u65e0\u6cd5\u88ab\u56de\u6536\u3002</li> </ul>"},{"location":"030Android/010Basic/#7","title":"7. \u7ebf\u7a0b","text":"<ul> <li>\u672a\u7ec8\u6b62\u7684\u7ebf\u7a0b\uff1a\u7ebf\u7a0b\u6301\u6709Activity\u5f15\u7528\u4e14\u672a\u7ec8\u6b62\uff0c\u5bfc\u81f4Activity\u65e0\u6cd5\u88ab\u56de\u6536\u3002</li> </ul>"},{"location":"030Android/010Basic/#8-webview","title":"8. WebView","text":"<ul> <li>WebView\u672a\u9500\u6bc1\uff1aWebView\u6301\u6709Context\u5f15\u7528\uff0c\u672a\u8c03\u7528<code>destroy()</code>\u65b9\u6cd5\u4f1a\u5bfc\u81f4\u5185\u5b58\u6cc4\u6f0f\u3002</li> </ul>"},{"location":"030Android/010Basic/#9","title":"9. \u52a8\u753b","text":"<ul> <li>\u672a\u53d6\u6d88\u7684\u52a8\u753b\uff1a\u65e0\u9650\u5faa\u73af\u7684\u52a8\u753b\u672a\u53ca\u65f6\u53d6\u6d88\uff0c\u4f1a\u5bfc\u81f4Activity\u65e0\u6cd5\u88ab\u56de\u6536\u3002</li> </ul>"},{"location":"030Android/010Basic/#10","title":"10. \u7b2c\u4e09\u65b9\u5e93","text":"<ul> <li>\u7b2c\u4e09\u65b9\u5e93\u95ee\u9898\uff1a\u67d0\u4e9b\u7b2c\u4e09\u65b9\u5e93\u53ef\u80fd\u5b58\u5728\u5185\u5b58\u6cc4\u6f0f\u95ee\u9898\uff0c\u9700\u53ca\u65f6\u66f4\u65b0\u6216\u4fee\u590d\u3002</li> </ul>"},{"location":"030Android/010Basic/#_41","title":"\u9884\u9632\u63aa\u65bd","text":"<ul> <li>\u4f7f\u7528\u5f31\u5f15\u7528\uff08WeakReference\uff09\u907f\u514d\u5f3a\u5f15\u7528\u3002</li> <li>\u53ca\u65f6\u91ca\u653e\u8d44\u6e90\uff0c\u5982\u5173\u95edCursor\u3001\u91ca\u653eBitmap\u7b49\u3002</li> <li>\u4f7f\u7528Application Context\u4ee3\u66ffActivity Context\u3002</li> <li>\u907f\u514d\u5728\u975e\u9759\u6001\u5185\u90e8\u7c7b\u4e2d\u6301\u6709\u5916\u90e8\u7c7b\u5f15\u7528\u3002</li> <li>\u4f7f\u7528\u5de5\u5177\u5982LeakCanary\u68c0\u6d4b\u5185\u5b58\u6cc4\u6f0f\u3002</li> </ul> <p>\u901a\u8fc7\u8fd9\u4e9b\u63aa\u65bd\uff0c\u53ef\u4ee5\u6709\u6548\u51cf\u5c11\u5185\u5b58\u6cc4\u6f0f\u7684\u53d1\u751f\u3002</p>"},{"location":"030Android/010Basic/#android_2","title":"Android\u5e73\u53f0\u7684\u7f51\u7edc\u8bf7\u6c42\u5bfc\u81f4\u5185\u5b58\u6cc4\u6f0f","text":"\u7b54\u6848 <p>Android\u5e73\u53f0\u7f51\u7edc\u8bf7\u6c42\u5f15\u8d77\u7684\u5185\u5b58\u6cc4\u6f0f \u662f\u7684\uff0c\u5728Android\u5e73\u53f0\u4e0a\uff0c\u7f51\u7edc\u8bf7\u6c42\u786e\u5b9e\u53ef\u80fd\u5f15\u8d77\u5185\u5b58\u6cc4\u6f0f\u3002\u4ee5\u4e0b\u662f\u51e0\u79cd\u5e38\u89c1\u7684\u60c5\u51b5\uff1a</p> <p>\u5e38\u89c1\u7684\u5185\u5b58\u6cc4\u6f0f\u6848\u4f8b 1. \u6301\u6709Activity/Fragment\u5f15\u7528\u7684\u56de\u8c03 \u6848\u4f8b\uff1a</p> <p>java \u590d\u5236 public class MyActivity extends AppCompatActivity {     @Override     protected void onCreate(Bundle savedInstanceState) {         super.onCreate(savedInstanceState);</p> <pre><code>    ApiClient.getUserData(new Callback() {\n        @Override\n        public void onSuccess(UserData data) {\n            // \u66f4\u65b0UI\n            updateUI(data);\n        }\n\n        @Override\n        public void onFailure(Error error) {\n            showError(error);\n        }\n    });\n}\n\nprivate void updateUI(UserData data) {\n    // \u66f4\u65b0UI\u4ee3\u7801\n}\n</code></pre> <p>} \u6cc4\u6f0f\u5bf9\u8c61\uff1aActivity\u5b9e\u4f8b</p> <p>\u539f\u56e0\uff1a\u533f\u540d\u5185\u90e8\u7c7bCallback\u9690\u5f0f\u6301\u6709\u5916\u90e8\u7c7bMyActivity\u7684\u5f15\u7528\u3002\u5982\u679c\u7f51\u7edc\u8bf7\u6c42\u8017\u65f6\u8f83\u957f\uff0c\u800c\u7528\u6237\u5728\u8bf7\u6c42\u5b8c\u6210\u524d\u65cb\u8f6c\u5c4f\u5e55\u6216\u9000\u51faActivity\uff0cActivity\u5b9e\u4f8b\u5c06\u56e0\u4e3a\u88abCallback\u6301\u6709\u800c\u65e0\u6cd5\u88abGC\u56de\u6536\u3002</p> <p>\u89e3\u51b3\u65b9\u6848 1 \u4f7f\u7528\u5f31\u5f15\u7528\uff1a</p> <p>java WeakReference weakActivity = new WeakReference&lt;&gt;(this); <p>2 \u53ca\u65f6\u53d6\u6d88\u8bf7\u6c42\uff1a</p> <p>java @Override protected void onDestroy() {     super.onDestroy();     if (disposable != null &amp;&amp; !disposable.isDisposed()) {         disposable.dispose();     }     // \u6216\u8005\u53d6\u6d88Retrofit Call     call.cancel(); } 3 \u4f7f\u7528ViewModel+LiveData\u67b6\u6784\uff0c\u5c06\u7f51\u7edc\u8bf7\u6c42\u4e0eUI\u751f\u547d\u5468\u671f\u5206\u79bb</p> <p>4 \u4f7f\u7528\u9759\u6001\u5185\u90e8\u7c7b+\u5f31\u5f15\u7528\u5904\u7406Handler</p> <p>5 \u4f7f\u7528Android Jetpack\u7684Lifecycle-aware\u7ec4\u4ef6\uff0c\u5982\u534f\u7a0b\u7684lifecycleScope</p>"},{"location":"030Android/010Basic/#handlerui","title":"\u5982\u4f55\u4f7f\u7528Handler\u64cd\u4f5cUI\u624d\u4e0d\u4f1a\u5bfc\u81f4\u5185\u5b58\u6cc4\u6f0f\uff1f","text":"\u7b54\u6848 <p>\u5728Android\u4e2d\u4f7f\u7528<code>Handler</code>\u64cd\u4f5cUI\u65f6\uff0c\u5982\u679c\u4e0d\u6ce8\u610f\uff0c\u5f88\u5bb9\u6613\u5bfc\u81f4\u5185\u5b58\u6cc4\u6f0f\u3002\u4ee5\u4e0b\u662f\u6b63\u786e\u4f7f\u7528<code>Handler</code>\u4ee5\u907f\u514d\u5185\u5b58\u6cc4\u6f0f\u7684\u65b9\u6cd5\uff1a</p>"},{"location":"030Android/010Basic/#1_9","title":"1. \u4f7f\u7528\u9759\u6001\u5185\u90e8\u7c7b + \u5f31\u5f15\u7528","text":"<ul> <li>\u5c06<code>Handler</code>\u5b9a\u4e49\u4e3a\u9759\u6001\u5185\u90e8\u7c7b\uff0c\u907f\u514d\u9690\u5f0f\u6301\u6709\u5916\u90e8\u7c7b\uff08\u5982Activity\uff09\u7684\u5f15\u7528\u3002</li> <li>\u4f7f\u7528<code>WeakReference</code>\u5f15\u7528\u5916\u90e8\u7c7b\uff0c\u786e\u4fdd\u5728\u5916\u90e8\u7c7b\u88ab\u9500\u6bc1\u65f6\u53ef\u4ee5\u88ab\u5783\u573e\u56de\u6536\u3002</li> </ul> <pre><code>public class MyActivity extends AppCompatActivity {\n    private MyHandler mHandler = new MyHandler(this);\n\n    private static class MyHandler extends Handler {\n        private final WeakReference&lt;MyActivity&gt; mActivity;\n\n        MyHandler(MyActivity activity) {\n            mActivity = new WeakReference&lt;&gt;(activity);\n        }\n\n        @Override\n        public void handleMessage(Message msg) {\n            MyActivity activity = mActivity.get();\n            if (activity != null) {\n                // \u64cd\u4f5cUI\n                activity.updateUI();\n            }\n        }\n    }\n\n    private void updateUI() {\n        // \u66f4\u65b0UI\u7684\u903b\u8f91\n    }\n}\n</code></pre>"},{"location":"030Android/010Basic/#2-ondestroy","title":"2. \u5728<code>onDestroy()</code>\u4e2d\u79fb\u9664\u56de\u8c03","text":"<ul> <li>\u5728Activity\u6216Fragment\u9500\u6bc1\u65f6\uff0c\u8c03\u7528<code>Handler</code>\u7684<code>removeCallbacksAndMessages(null)</code>\u65b9\u6cd5\uff0c\u79fb\u9664\u6240\u6709\u672a\u5904\u7406\u7684\u6d88\u606f\u548c\u56de\u8c03\u3002</li> </ul> <pre><code>@Override\nprotected void onDestroy() {\n    super.onDestroy();\n    mHandler.removeCallbacksAndMessages(null); // \u79fb\u9664\u6240\u6709\u6d88\u606f\n}\n</code></pre>"},{"location":"030Android/010Basic/#3-lifecyclehandler","title":"3. \u4f7f\u7528<code>Lifecycle</code>\u611f\u77e5\u7684Handler","text":"<ul> <li>\u5728Android\u4e2d\uff0c\u53ef\u4ee5\u4f7f\u7528<code>Lifecycle</code>\u76f8\u5173\u7684\u7ec4\u4ef6\uff08\u5982<code>LiveData</code>\u6216<code>ViewModel</code>\uff09\u6765\u66ff\u4ee3<code>Handler</code>\uff0c\u907f\u514d\u76f4\u63a5\u64cd\u4f5cUI\u3002</li> <li>\u5982\u679c\u9700\u8981\u4f7f\u7528<code>Handler</code>\uff0c\u53ef\u4ee5\u7ed3\u5408<code>LifecycleObserver</code>\uff0c\u5728\u751f\u547d\u5468\u671f\u7ed3\u675f\u65f6\u81ea\u52a8\u79fb\u9664\u56de\u8c03\u3002</li> </ul> <pre><code>public class MyLifecycleHandler implements LifecycleObserver {\n    private Handler mHandler = new Handler(Looper.getMainLooper());\n    private Runnable mRunnable;\n\n    public MyLifecycleHandler(Lifecycle lifecycle, Runnable runnable) {\n        mRunnable = runnable;\n        lifecycle.addObserver(this);\n    }\n\n    @OnLifecycleEvent(Lifecycle.Event.ON_START)\n    void start() {\n        mHandler.postDelayed(mRunnable, 1000); // \u5ef6\u8fdf\u6267\u884c\n    }\n\n    @OnLifecycleEvent(Lifecycle.Event.ON_STOP)\n    void stop() {\n        mHandler.removeCallbacks(mRunnable); // \u79fb\u9664\u56de\u8c03\n    }\n}\n</code></pre>"},{"location":"030Android/010Basic/#4-handlerthread_1","title":"4. \u4f7f\u7528<code>HandlerThread</code>","text":"<ul> <li>\u5982\u679c\u9700\u8981\u540e\u53f0\u7ebf\u7a0b\u5904\u7406\u4efb\u52a1\u5e76\u66f4\u65b0UI\uff0c\u53ef\u4ee5\u4f7f\u7528<code>HandlerThread</code>\uff0c\u5b83\u7ed3\u5408\u4e86<code>Handler</code>\u548c<code>Thread</code>\u7684\u4f18\u70b9\u3002</li> <li>\u5728<code>HandlerThread</code>\u4e2d\u5904\u7406\u8017\u65f6\u4efb\u52a1\uff0c\u901a\u8fc7<code>Handler</code>\u5c06\u7ed3\u679c\u53d1\u9001\u5230\u4e3b\u7ebf\u7a0b\u66f4\u65b0UI\u3002</li> </ul> <pre><code>HandlerThread handlerThread = new HandlerThread(\"MyHandlerThread\");\nhandlerThread.start();\nHandler backgroundHandler = new Handler(handlerThread.getLooper());\n\nbackgroundHandler.post(() -&gt; {\n    // \u540e\u53f0\u4efb\u52a1\n    // \u5b8c\u6210\u540e\u901a\u8fc7\u4e3b\u7ebf\u7a0bHandler\u66f4\u65b0UI\n    mainHandler.post(() -&gt; {\n        // \u66f4\u65b0UI\n    });\n});\n</code></pre>"},{"location":"030Android/010Basic/#5_5","title":"5. \u907f\u514d\u533f\u540d\u5185\u90e8\u7c7b\u6216\u975e\u9759\u6001\u5185\u90e8\u7c7b","text":"<ul> <li>\u907f\u514d\u76f4\u63a5\u4f7f\u7528\u533f\u540d\u5185\u90e8\u7c7b\u6216\u975e\u9759\u6001\u5185\u90e8\u7c7b\u521b\u5efa<code>Handler</code>\uff0c\u56e0\u4e3a\u5b83\u4eec\u4f1a\u9690\u5f0f\u6301\u6709\u5916\u90e8\u7c7b\u7684\u5f15\u7528\uff0c\u5bfc\u81f4\u5185\u5b58\u6cc4\u6f0f\u3002</li> </ul> <pre><code>// \u9519\u8bef\u793a\u4f8b\uff1a\u533f\u540d\u5185\u90e8\u7c7b\u5bfc\u81f4\u5185\u5b58\u6cc4\u6f0f\nHandler leakyHandler = new Handler() {\n    @Override\n    public void handleMessage(Message msg) {\n        // \u64cd\u4f5cUI\n    }\n};\n</code></pre>"},{"location":"030Android/010Basic/#6-viewpostactivityrunonuithread","title":"6. \u4f7f\u7528<code>View.post()</code>\u6216<code>Activity.runOnUiThread()</code>","text":"<ul> <li>\u5982\u679c\u53ea\u662f\u7b80\u5355\u5730\u5728\u4e3b\u7ebf\u7a0b\u66f4\u65b0UI\uff0c\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528<code>View.post()</code>\u6216<code>Activity.runOnUiThread()</code>\uff0c\u907f\u514d\u624b\u52a8\u521b\u5efa<code>Handler</code>\u3002</li> </ul> <pre><code>// \u4f7f\u7528View.post()\nmyView.post(() -&gt; {\n    // \u66f4\u65b0UI\n});\n\n// \u4f7f\u7528runOnUiThread()\nrunOnUiThread(() -&gt; {\n    // \u66f4\u65b0UI\n});\n</code></pre>"},{"location":"030Android/010Basic/#_42","title":"\u603b\u7ed3","text":"<p>\u4e3a\u4e86\u907f\u514d<code>Handler</code>\u5bfc\u81f4\u7684\u5185\u5b58\u6cc4\u6f0f\uff0c\u53ef\u4ee5\u91c7\u53d6\u4ee5\u4e0b\u63aa\u65bd\uff1a 1. \u4f7f\u7528\u9759\u6001\u5185\u90e8\u7c7b + \u5f31\u5f15\u7528\u3002 2. \u5728<code>onDestroy()</code>\u4e2d\u79fb\u9664\u6240\u6709\u56de\u8c03\u3002 3. \u4f7f\u7528<code>Lifecycle</code>\u611f\u77e5\u7684\u7ec4\u4ef6\u3002 4. \u907f\u514d\u533f\u540d\u5185\u90e8\u7c7b\u6216\u975e\u9759\u6001\u5185\u90e8\u7c7b\u3002 5. \u4f7f\u7528<code>View.post()</code>\u6216<code>runOnUiThread()</code>\u7b80\u5316UI\u66f4\u65b0\u3002</p> <p>\u901a\u8fc7\u8fd9\u4e9b\u65b9\u6cd5\uff0c\u53ef\u4ee5\u786e\u4fdd<code>Handler</code>\u4e0d\u4f1a\u6301\u6709Activity\u6216Fragment\u7684\u5f15\u7528\uff0c\u4ece\u800c\u907f\u514d\u5185\u5b58\u6cc4\u6f0f\u3002</p>"},{"location":"030Android/010Basic/#looper","title":"Looper\u5982\u4f55\u4fdd\u8bc1\u7ebf\u7a0b\u5185\u53ea\u6709\u4e00\u4e2a\uff1f","text":"\u7b54\u6848 <p>\u5728 Android \u4e2d\uff0c<code>Looper</code> \u7528\u4e8e\u7ba1\u7406\u7ebf\u7a0b\u7684\u6d88\u606f\u961f\u5217\uff0c\u786e\u4fdd\u7ebf\u7a0b\u80fd\u591f\u5904\u7406\u6d88\u606f\u548c\u4efb\u52a1\u3002\u4e3a\u4e86\u4fdd\u8bc1\u4e00\u4e2a\u7ebf\u7a0b\u5185\u53ea\u6709\u4e00\u4e2a <code>Looper</code>\uff0c<code>Looper</code> \u7c7b\u4f7f\u7528\u4e86\u4ee5\u4e0b\u673a\u5236\uff1a</p>"},{"location":"030Android/010Basic/#1-threadlocal","title":"1. <code>ThreadLocal</code> \u5b58\u50a8","text":"<p><code>Looper</code> \u4f7f\u7528 <code>ThreadLocal</code> \u6765\u5b58\u50a8\u6bcf\u4e2a\u7ebf\u7a0b\u7684 <code>Looper</code> \u5b9e\u4f8b\u3002<code>ThreadLocal</code> \u662f\u7ebf\u7a0b\u5c40\u90e8\u53d8\u91cf\uff0c\u6bcf\u4e2a\u7ebf\u7a0b\u90fd\u6709\u72ec\u7acb\u7684\u526f\u672c\uff0c\u4e92\u4e0d\u5e72\u6270\u3002</p> <pre><code>static final ThreadLocal&lt;Looper&gt; sThreadLocal = new ThreadLocal&lt;Looper&gt;();\n</code></pre>"},{"location":"030Android/010Basic/#2-prepare","title":"2. <code>prepare()</code> \u65b9\u6cd5","text":"<p>\u5728\u521b\u5efa <code>Looper</code> \u65f6\uff0c\u5fc5\u987b\u8c03\u7528 <code>Looper.prepare()</code>\uff0c\u8be5\u65b9\u6cd5\u4f1a\u68c0\u67e5\u5f53\u524d\u7ebf\u7a0b\u662f\u5426\u5df2\u7ecf\u6709\u4e00\u4e2a <code>Looper</code>\uff0c\u5982\u679c\u6709\u5219\u629b\u51fa\u5f02\u5e38\uff0c\u786e\u4fdd\u6bcf\u4e2a\u7ebf\u7a0b\u53ea\u6709\u4e00\u4e2a <code>Looper</code>\u3002</p> <pre><code>public static void prepare() {\n    prepare(true);\n}\n\nprivate static void prepare(boolean quitAllowed) {\n    if (sThreadLocal.get() != null) {\n        throw new RuntimeException(\"Only one Looper may be created per thread\");\n    }\n    sThreadLocal.set(new Looper(quitAllowed));\n}\n</code></pre>"},{"location":"030Android/010Basic/#3-mylooper","title":"3. <code>myLooper()</code> \u65b9\u6cd5","text":"<p>\u901a\u8fc7 <code>Looper.myLooper()</code> \u53ef\u4ee5\u83b7\u53d6\u5f53\u524d\u7ebf\u7a0b\u7684 <code>Looper</code> \u5b9e\u4f8b\uff0c\u5b83\u4ece <code>ThreadLocal</code> \u4e2d\u8bfb\u53d6\u3002</p> <pre><code>public static @Nullable Looper myLooper() {\n    return sThreadLocal.get();\n}\n</code></pre>"},{"location":"030Android/010Basic/#4-quit-quitsafely","title":"4. <code>quit()</code> \u548c <code>quitSafely()</code> \u65b9\u6cd5","text":"<p><code>Looper</code> \u63d0\u4f9b\u4e86\u9000\u51fa\u65b9\u6cd5\uff0c\u8c03\u7528\u540e <code>Looper</code> \u4f1a\u505c\u6b62\u5904\u7406\u6d88\u606f\uff0c\u5e76\u4ece <code>ThreadLocal</code> \u4e2d\u79fb\u9664\u3002</p> <pre><code>public void quit() {\n    mQueue.quit(false);\n}\n\npublic void quitSafely() {\n    mQueue.quit(true);\n}\n</code></pre>"},{"location":"030Android/010Basic/#_43","title":"\u603b\u7ed3","text":"<p><code>Looper</code> \u901a\u8fc7 <code>ThreadLocal</code> \u548c <code>prepare()</code> \u65b9\u6cd5\u7684\u68c0\u67e5\u673a\u5236\uff0c\u786e\u4fdd\u6bcf\u4e2a\u7ebf\u7a0b\u53ea\u80fd\u6709\u4e00\u4e2a <code>Looper</code> \u5b9e\u4f8b\u3002\u8fd9\u79cd\u8bbe\u8ba1\u4fdd\u8bc1\u4e86\u7ebf\u7a0b\u6d88\u606f\u961f\u5217\u7684\u552f\u4e00\u6027\u548c\u4e00\u81f4\u6027\u3002</p>"},{"location":"030Android/010Basic/#threadlocal","title":"ThreadLocal\u4e3a\u4ec0\u4e48\u80fd\u4fdd\u8bc1\u591a\u4e2a\u7ebf\u7a0b\u5185\u5bb9\u76f8\u4e92\u9694\u79bb\uff1f","text":"\u7b54\u6848 <p><code>ThreadLocal</code> \u80fd\u591f\u4fdd\u8bc1\u53ea\u6709\u5f53\u524d\u7ebf\u7a0b\u53ef\u4ee5\u8bbf\u95ee\u5176\u5b58\u50a8\u7684\u503c\uff0c\u5e76\u4e0d\u4ec5\u4ec5\u662f\u56e0\u4e3a\u5b83\u5b9a\u4e49\u5728 <code>Thread</code> \u7c7b\u91cc\u9762\uff0c\u800c\u662f\u901a\u8fc7\u7ed3\u5408 <code>Thread</code> \u7c7b\u7684\u5185\u90e8\u8bbe\u8ba1\u548c <code>ThreadLocal</code> \u7684\u7279\u6b8a\u5b9e\u73b0\u673a\u5236\u5171\u540c\u5b9e\u73b0\u7684\u3002JVM \u5e76\u6ca1\u6709\u9488\u5bf9 <code>ThreadLocal</code> \u505a\u7279\u6b8a\u7684\u4f18\u5316\uff0c\u800c\u662f\u4f9d\u9760 Java \u7684\u7ebf\u7a0b\u6a21\u578b\u548c <code>ThreadLocal</code> \u7684\u5de7\u5999\u8bbe\u8ba1\u6765\u4fdd\u8bc1\u7ebf\u7a0b\u9694\u79bb\u3002</p>"},{"location":"030Android/010Basic/#1-threadlocal_1","title":"1. <code>ThreadLocal</code> \u7684\u6838\u5fc3\u5b9e\u73b0\u539f\u7406","text":"<p><code>ThreadLocal</code> \u7684\u6838\u5fc3\u5728\u4e8e\uff1a - \u6bcf\u4e2a <code>Thread</code> \u5bf9\u8c61\u5185\u90e8\u7ef4\u62a4\u4e86\u4e00\u4e2a <code>ThreadLocalMap</code>\uff08\u7c7b\u4f3c\u4e8e\u4e00\u4e2a\u5b9a\u5236\u5316\u7684 <code>HashMap</code>\uff09\uff0c\u7528\u4e8e\u5b58\u50a8\u7ebf\u7a0b\u672c\u5730\u53d8\u91cf\u3002 - <code>ThreadLocalMap</code> \u7684 key \u662f <code>ThreadLocal</code> \u5b9e\u4f8b\u672c\u8eab\uff08\u5f31\u5f15\u7528\uff09\uff0cvalue \u662f\u7ebf\u7a0b\u5b58\u50a8\u7684\u503c\u3002 - \u5f53\u8c03\u7528 <code>ThreadLocal.set(value)</code> \u65f6\uff0c\u5b9e\u9645\u4e0a\u662f\u5c06\u5f53\u524d <code>ThreadLocal</code> \u5b9e\u4f8b\u4f5c\u4e3a key\uff0c<code>value</code> \u4f5c\u4e3a\u503c\uff0c\u5b58\u5165\u5f53\u524d\u7ebf\u7a0b\u7684 <code>ThreadLocalMap</code> \u4e2d\u3002 - \u5f53\u8c03\u7528 <code>ThreadLocal.get()</code> \u65f6\uff0c\u4f1a\u4ece\u5f53\u524d\u7ebf\u7a0b\u7684 <code>ThreadLocalMap</code> \u4e2d\u53d6\u51fa\u4e0e\u5f53\u524d <code>ThreadLocal</code> \u5b9e\u4f8b\u5173\u8054\u7684\u503c\u3002</p> <p>\u5173\u952e\u4ee3\u7801\u903b\u8f91\uff08\u7b80\u5316\u7248\uff09\uff1a <pre><code>public void set(T value) {\n    Thread t = Thread.currentThread();  // \u83b7\u53d6\u5f53\u524d\u7ebf\u7a0b\n    ThreadLocalMap map = t.threadLocals; // \u83b7\u53d6\u7ebf\u7a0b\u7684 ThreadLocalMap\n    if (map != null) {\n        map.set(this, value);  // this \u6307\u5f53\u524d ThreadLocal \u5b9e\u4f8b\n    } else {\n        createMap(t, value);  // \u521d\u59cb\u5316 ThreadLocalMap\n    }\n}\n\npublic T get() {\n    Thread t = Thread.currentThread();\n    ThreadLocalMap map = t.threadLocals;\n    if (map != null) {\n        ThreadLocalMap.Entry e = map.getEntry(this);  // \u7528\u5f53\u524d ThreadLocal \u5b9e\u4f8b\u4f5c\u4e3a key \u67e5\u627e\n        if (e != null) {\n            return (T)e.value;\n        }\n    }\n    return setInitialValue();\n}\n</code></pre></p>"},{"location":"030Android/010Basic/#2_6","title":"2. \u4e3a\u4ec0\u4e48\u53ea\u6709\u5f53\u524d\u7ebf\u7a0b\u80fd\u8bbf\u95ee\uff1f","text":"<ul> <li>\u6570\u636e\u5b58\u50a8\u5728\u7ebf\u7a0b\u5bf9\u8c61\u4e2d\uff1a\u6bcf\u4e2a\u7ebf\u7a0b\u7684 <code>ThreadLocalMap</code> \u662f\u7ebf\u7a0b\u79c1\u6709\u7684\uff08<code>Thread.threadLocals</code> \u5b57\u6bb5\uff09\uff0c\u5176\u4ed6\u7ebf\u7a0b\u65e0\u6cd5\u76f4\u63a5\u8bbf\u95ee\u3002</li> <li>\u901a\u8fc7 <code>ThreadLocal</code> \u5b9e\u4f8b\u4f5c\u4e3a key \u533a\u5206\u6570\u636e\uff1a\u5373\u4f7f\u591a\u4e2a\u7ebf\u7a0b\u4f7f\u7528\u540c\u4e00\u4e2a <code>ThreadLocal</code> \u5b9e\u4f8b\uff0c\u7531\u4e8e\u6bcf\u4e2a\u7ebf\u7a0b\u7684 <code>ThreadLocalMap</code> \u662f\u72ec\u7acb\u7684\uff0c\u5b83\u4eec\u5b58\u50a8\u7684\u503c\u4e92\u4e0d\u5f71\u54cd\u3002</li> <li>\u6ca1\u6709\u5168\u5c40\u5171\u4eab\u72b6\u6001\uff1a<code>ThreadLocal</code> \u672c\u8eab\u4e0d\u5b58\u50a8\u4efb\u4f55\u6570\u636e\uff0c\u5b83\u53ea\u662f\u4e00\u4e2a\u8bbf\u95ee\u7ebf\u7a0b\u672c\u5730\u6570\u636e\u7684\u201c\u5de5\u5177\u7c7b\u201d\u3002</li> </ul>"},{"location":"030Android/010Basic/#3_8","title":"3. \u5173\u952e\u8bbe\u8ba1\u70b9","text":"<ol> <li><code>ThreadLocalMap</code> \u662f <code>Thread</code> \u7684\u5b57\u6bb5 </li> <li>\u6bcf\u4e2a <code>Thread</code> \u5bf9\u8c61\u5728\u7b2c\u4e00\u6b21\u8c03\u7528 <code>ThreadLocal.set()</code> \u6216 <code>get()</code> \u65f6\u4f1a\u521d\u59cb\u5316\u81ea\u5df1\u7684 <code>ThreadLocalMap</code>\u3002</li> <li> <p>\u7531\u4e8e\u7ebf\u7a0b\u4e4b\u95f4\u4e0d\u5171\u4eab <code>Thread</code> \u5bf9\u8c61\uff0c\u81ea\u7136\u65e0\u6cd5\u8bbf\u95ee\u5f7c\u6b64\u7684 <code>ThreadLocalMap</code>\u3002</p> </li> <li> <p><code>ThreadLocal</code> \u4f5c\u4e3a key \u7684\u5f31\u5f15\u7528 </p> </li> <li> <p><code>ThreadLocalMap</code> \u7684 key \u662f\u5f31\u5f15\u7528\uff08<code>WeakReference&lt;ThreadLocal&gt;</code>\uff09\uff0c\u8fd9\u662f\u4e3a\u4e86\u907f\u514d\u5185\u5b58\u6cc4\u6f0f\uff08\u5f53 <code>ThreadLocal</code> \u5b9e\u4f8b\u88ab\u56de\u6536\u65f6\uff0c\u5bf9\u5e94\u7684 entry \u80fd\u81ea\u52a8\u88ab\u6e05\u7406\uff09\u3002</p> </li> <li> <p>\u54c8\u5e0c\u51b2\u7a81\u89e3\u51b3 </p> </li> <li><code>ThreadLocalMap</code> \u4f7f\u7528\u7ebf\u6027\u63a2\u6d4b\u6cd5\u89e3\u51b3\u54c8\u5e0c\u51b2\u7a81\uff08\u800c\u975e\u94fe\u5730\u5740\u6cd5\uff09\uff0c\u8fd9\u662f\u4e3a\u4e86\u7b80\u5316\u5b9e\u73b0\u5e76\u51cf\u5c11\u5185\u5b58\u5360\u7528\u3002</li> </ol>"},{"location":"030Android/010Basic/#4_6","title":"4. \u5e38\u89c1\u8bef\u89e3\u6f84\u6e05","text":"<ul> <li> <p>\u8bef\u89e31\uff1a<code>ThreadLocal</code> \u7684\u503c\u5b58\u50a8\u5728 <code>ThreadLocal</code> \u7c7b\u4e2d \u5b9e\u9645\u4e0a\uff0c\u503c\u5b58\u50a8\u5728\u7ebf\u7a0b\u5bf9\u8c61\u7684 <code>ThreadLocalMap</code> \u4e2d\uff0c<code>ThreadLocal</code> \u53ea\u662f\u63d0\u4f9b\u8bbf\u95ee\u5165\u53e3\u3002</p> </li> <li> <p>\u8bef\u89e32\uff1aJVM \u505a\u4e86\u7279\u6b8a\u4f18\u5316 JVM \u6ca1\u6709\u5bf9 <code>ThreadLocal</code> \u505a\u7279\u6b8a\u5904\u7406\uff0c\u5b83\u7684\u7ebf\u7a0b\u9694\u79bb\u5b8c\u5168\u901a\u8fc7 Java \u4ee3\u7801\u7684\u8bbe\u8ba1\u5b9e\u73b0\u3002</p> </li> <li> <p>\u8bef\u89e33\uff1a<code>ThreadLocal</code> \u662f\u7ebf\u7a0b\u5b89\u5168\u7684 <code>ThreadLocal</code> \u7684\u7ebf\u7a0b\u9694\u79bb\u662f\u5929\u7136\u7684\uff0c\u4f46\u5b83\u5b58\u50a8\u7684\u5bf9\u8c61\u672c\u8eab\u5982\u679c\u4e0d\u662f\u7ebf\u7a0b\u5b89\u5168\u7684\uff0c\u4ecd\u9700\u989d\u5916\u540c\u6b65\uff08\u4f8b\u5982\uff0c\u591a\u4e2a\u7ebf\u7a0b\u901a\u8fc7 <code>ThreadLocal</code> \u5171\u4eab\u540c\u4e00\u4e2a <code>ArrayList</code> \u65f6\u4ecd\u9700\u52a0\u9501\uff09\u3002</p> </li> </ul>"},{"location":"030Android/010Basic/#5_6","title":"5. \u603b\u7ed3","text":"<p><code>ThreadLocal</code> \u7684\u7ebf\u7a0b\u9694\u79bb\u80fd\u529b\u4f9d\u8d56\u4e8e\uff1a 1. \u6570\u636e\u5b58\u50a8\u5728\u7ebf\u7a0b\u79c1\u6709\u7684 <code>ThreadLocalMap</code> \u4e2d\u3002 2. \u901a\u8fc7 <code>ThreadLocal</code> \u5b9e\u4f8b\u4f5c\u4e3a key \u533a\u5206\u4e0d\u540c\u53d8\u91cf\u3002 3. \u7ebf\u7a0b\u65e0\u6cd5\u8bbf\u95ee\u5176\u4ed6\u7ebf\u7a0b\u7684 <code>Thread</code> \u5bf9\u8c61\u5185\u90e8\u6570\u636e\u3002</p> <p>\u8fd9\u79cd\u8bbe\u8ba1\u907f\u514d\u4e86\u540c\u6b65\u5f00\u9500\uff0c\u540c\u65f6\u4fdd\u8bc1\u4e86\u7ebf\u7a0b\u5b89\u5168\uff0c\u662f\u5178\u578b\u7684 \u201c\u7a7a\u95f4\u6362\u65f6\u95f4\u201d \u601d\u60f3\u7684\u5e94\u7528\u3002</p>"},{"location":"030Android/010Basic/#looperloopappanr","title":"\u4e3a\u4ec0\u4e48Looper.loop()\u65b9\u6cd5\u4e00\u76f4\u5728\u5faa\u73af\uff0cApp\u4e0d\u4f1aANR?","text":"\u7b54\u6848 <p>Android\u9762\u8bd5\u4e2d\uff0c\u4f60\u4e5f\u8bb8\u4f1a\u88ab\u95ee\u5230\u9898\u76ee\u4e2d\u7684\u95ee\u9898\uff0c\u8fd9\u91cc\u6211\u4eec\u57fa\u4e8e\u4ee5\u4e0b\u51e0\u70b9\u6765\u5ef6\u4f38\u89e3\u8bfb\u5176\u4e2d\u539f\u56e0\uff1a</p> <p>1\u3001\u4ec0\u4e48\u662fANR?ANR\u53d1\u751f\u7684\u539f\u56e0\u662f\u4ec0\u4e48\uff1f</p> <p>2\u3001Looper\u4e3a\u4ec0\u4e48\u8981\u65e0\u9650\u5faa\u73af\uff1f</p> <p>3\u3001\u7ebf\u7a0b\u7684\u51e0\u79cd\u72b6\u6001</p> <p>4\u3001\u4e3b\u7ebf\u7a0b\u4e2d\u7684Looper.loop()\u4e00\u76f4\u65e0\u9650\u5faa\u73af\u4e3a\u4ec0\u4e48\u4e0d\u4f1a\u9020\u6210ANR\uff1f</p>"},{"location":"030Android/010Basic/#1anranr","title":"1\u3001\u4ec0\u4e48\u662fANR?ANR\u53d1\u751f\u7684\u539f\u56e0\u662f\u4ec0\u4e48\uff1f","text":"<p>ANR\u5373Application Not Responding\uff0c\u987e\u540d\u601d\u4e49\u5c31\u662f\u5e94\u7528\u7a0b\u5e8f\u65e0\u54cd\u5e94\u3002</p> <p>\u5728Android\u4e2d\uff0c\u4e00\u822c\u60c5\u51b5\u4e0b\uff0c\u56db\u5927\u7ec4\u4ef6\u5747\u662f\u5de5\u4f5c\u5728\u4e3b\u7ebf\u7a0b\u4e2d\u7684\uff0cAndroid\u4e2d\u7684Activity Manager\u548cWindow Manager\u4f1a\u968f\u65f6\u76d1\u63a7\u5e94\u7528\u7a0b\u5e8f\u7684\u54cd\u5e94\u60c5\u51b5\uff0c\u5982\u679c\u56e0\u4e3a\u4e00\u4e9b\u8017\u65f6\u64cd\u4f5c\uff08\u7f51\u7edc\u8bf7\u6c42\u6216\u8005IO\u64cd\u4f5c\uff09\u9020\u6210\u4e3b\u7ebf\u7a0b\u963b\u585e\u4e00\u5b9a\u65f6\u95f4\uff08\u4f8b\u5982\u9020\u62105s\u5185\u4e0d\u80fd\u54cd\u5e94\u7528\u6237\u4e8b\u4ef6\u6216\u8005BroadcastReceiver\u7684onReceive\u65b9\u6cd5\u6267\u884c\u65f6\u95f4\u8d85\u8fc710s\uff09\uff0c\u90a3\u4e48\u7cfb\u7edf\u5c31\u4f1a\u663e\u793aANR\u5bf9\u8bdd\u6846\u63d0\u793a\u7528\u6237\u5bf9\u5e94\u7684\u5e94\u7528\u5904\u4e8e\u65e0\u54cd\u5e94\u72b6\u6001\u3002</p> <p>\u7b80\u5355\u603b\u7ed3\u5c31\u662f\u4ee5\u4e0b\u4e24\u70b9\uff1a</p> <ol> <li> <p>\u4e0d\u8981\u8ba9\u4e3b\u7ebf\u7a0b\u5e72\u8017\u65f6\u7684\u5de5\u4f5c</p> </li> <li> <p>\u4e0d\u8981\u8ba9\u5176\u4ed6\u7ebf\u7a0b\u963b\u585e\u4e3b\u7ebf\u7a0b\u7684\u6267\u884c</p> </li> </ol>"},{"location":"030Android/010Basic/#2looper","title":"2\u3001Looper\u4e3a\u4ec0\u4e48\u8981\u65e0\u9650\u5faa\u73af\uff1f","text":"<p>Looper\u4e2d\u91cd\u8981\u7684\u4e24\u4e2a\u65b9\u6cd5\u4e3aprepare()\u3001loop()</p> <p>prepare()\u6e90\u7801</p> <p>Looper\u5728prepare\u4e2d\u901a\u8fc7ThreadLocal\u4fdd\u8bc1\u4e86\u6bcf\u4e2a\u7ebf\u7a0bLooper\u5bf9\u8c61\u7684\u552f\u4e00\u6027\uff0c\u5373\u5bf9\u4e8e\u6bcf\u4e2a\u7ebf\u7a0b\uff0c\u6709\u552f\u4e00\u7684Looper\u5bf9\u8c61\u548cMessageQueue\u961f\u5217</p> <p>loop()\u6e90\u7801</p> <p>\u663e\u800c\u6613\u89c1\u7684\uff0c\u4e3b\u7ebf\u7a0b\u4e2d\u5982\u679c\u6ca1\u6709looper\u8fdb\u884c\u5faa\u73af\uff0c\u90a3\u4e48\u4e3b\u7ebf\u7a0b\u4e00\u8fd0\u884c\u5b8c\u6bd5\u5c31\u4f1a\u9000\u51fa\u3002\u90a3\u4e48\u6211\u4eec\u8fd8\u80fd\u8fd0\u884cAPP\u5417\uff0c\u663e\u7136\uff0c\u8fd9\u662f\u4e0d\u53ef\u80fd\u7684\uff0cLooper\u4e3b\u8981\u5c31\u662f\u505a\u6d88\u606f\u5faa\u73af\uff0c\u7136\u540e\u7531Handler\u8fdb\u884c\u6d88\u606f\u5206\u53d1\u5904\u7406\uff0c\u4e00\u65e6\u9000\u51fa\u6d88\u606f\u5faa\u73af\uff0c\u90a3\u4e48\u4f60\u7684\u5e94\u7528\u4e5f\u5c31\u9000\u51fa\u4e86\u3002</p> <p>\u603b\u7ed3\uff1aLooper\u7684\u65e0\u9650\u5faa\u73af\u5fc5\u4e0d\u53ef\u5c11</p>"},{"location":"030Android/010Basic/#3_9","title":"3\u3001\u7ebf\u7a0b\u7684\u51e0\u79cd\u72b6\u6001","text":"<p>\u5f88\u591a\u8bfb\u8005\u4f1a\u95ee\uff0c\u4f60\u8bf4\u7684\u597d\u597d\u5730Looper\uff0c\u5e72\u561b\u7a81\u7136\u8f6c\u5230\u7ebf\u7a0b\u72b6\u6001\u7684\u77e5\u8bc6\u70b9\u4e86\u5462\uff1f</p> <p>\u522b\u6025\u522b\u6025\uff0c\u8bf7\u5141\u8bb8\u8001\u8872\u7ec6\u7ec6\u9053\u6765\u3002</p> <p>\u4f17\u6240\u5468\u77e5\uff0c\u7ebf\u7a0b\u7684\u4e94\u5927\u72b6\u6001\u4e3a\uff1aNew\u3001Runnable\u3001Running\u3001Blocked\u3001Dead\uff0c\u800c\u4ed6\u4eec\u4e4b\u95f4\u6709\u8005\u5343\u4e1d\u4e07\u7f15\u7684\u5173\u7cfb\uff0c\u4e3a\u4e86\u4fbf\u4e8e\u5927\u5bb6\u7406\u89e3\uff0c\u770b\u56fe\u8bf4\u8bdd</p> <p>\u7ebf\u7a0b\u72b6\u6001\u56fe</p> <p>\u5f88\u591a\u4eba\u4f1a\u95ee\uff0c\u4e3a\u4ec0\u4e48\u6709\u8fd9\u4e48\u591aBlocked?</p> <p>\uff081\uff09\u65b0\u5efa\u72b6\u6001\uff08New\uff09\uff1a\u65b0\u521b\u5efa\u4e86\u4e00\u4e2a\u7ebf\u7a0b\u5bf9\u8c61\u3002</p> <p>\uff082\uff09\u5c31\u7eea\u72b6\u6001\uff08Runnable\uff09\uff1a\u7ebf\u7a0b\u5bf9\u8c61\u521b\u5efa\u540e\uff0c\u5176\u4ed6\u7ebf\u7a0b\u8c03\u7528\u4e86\u8be5\u5bf9\u8c61\u7684start()\u65b9\u6cd5\u3002\u8be5\u72b6\u6001\u7684\u7ebf\u7a0b\u4f4d\u4e8e\u53ef\u8fd0\u884c\u7ebf\u7a0b\u6c60\u4e2d\uff0c\u53d8\u5f97\u53ef\u8fd0\u884c\uff0c\u7b49\u5f85\u83b7\u53d6CPU\u7684\u4f7f\u7528\u6743\u3002</p> <p>\uff083\uff09\u8fd0\u884c\u72b6\u6001\uff08Running\uff09\uff1a\u5c31\u7eea\u72b6\u6001\u7684\u7ebf\u7a0b\u83b7\u53d6\u4e86CPU\uff0c\u6267\u884c\u7a0b\u5e8f\u4ee3\u7801\u3002</p> <p>\uff084\uff09\u963b\u585e\u72b6\u6001\uff08Blocked\uff09\uff1a\u963b\u585e\u72b6\u6001\u662f\u7ebf\u7a0b\u56e0\u4e3a\u67d0\u79cd\u539f\u56e0\u653e\u5f03CPU\u4f7f\u7528\u6743\uff0c\u6682\u65f6\u505c\u6b62\u8fd0\u884c\u3002\u76f4\u5230\u7ebf\u7a0b\u8fdb\u5165\u5c31\u7eea\u72b6\u6001\uff0c\u624d\u6709\u673a\u4f1a\u8f6c\u5230\u8fd0\u884c\u72b6\u6001\u3002\u963b\u585e\u7684\u60c5\u51b5\u5206\u4e09\u79cd\uff1a</p> <p>\u7b49\u5f85\u963b\u585e\uff1a\u8fd0\u884c\u7684\u7ebf\u7a0b\u6267\u884cwait()\u65b9\u6cd5\uff0cJVM\u4f1a\u628a\u8be5\u7ebf\u7a0b\u653e\u5165\u7b49\u5f85\u6c60\u4e2d\u3002</p> <p>\u540c\u6b65\u963b\u585e\uff1a\u8fd0\u884c\u7684\u7ebf\u7a0b\u5728\u83b7\u53d6\u5bf9\u8c61\u7684\u540c\u6b65\u9501\u65f6\uff0c\u82e5\u8be5\u540c\u6b65\u9501\u88ab\u522b\u7684\u7ebf\u7a0b\u5360\u7528\uff0c\u5219JVM\u4f1a\u628a\u8be5\u7ebf\u7a0b\u653e\u5165\u9501\u6c60\u4e2d\u3002</p> <p>\u5176\u4ed6\u963b\u585e\uff1a\u8fd0\u884c\u7684\u7ebf\u7a0b\u6267\u884csleep()\u6216join()\u65b9\u6cd5\uff0c\u6216\u8005\u53d1\u51fa\u4e86I/O\u8bf7\u6c42\u65f6\uff0cJVM\u4f1a\u628a\u8be5\u7ebf\u7a0b\u7f6e\u4e3a\u963b\u585e\u72b6\u6001\u3002\u5f53sleep()\u72b6\u6001\u8d85\u65f6\u3001join()\u7b49\u5f85\u7ebf\u7a0b\u7ec8\u6b62\u6216\u8005\u8d85\u65f6\u3001\u6216\u8005I/O\u5904\u7406\u5b8c\u6bd5\u65f6\uff0c\u7ebf\u7a0b\u91cd\u65b0\u8f6c\u5165\u5c31\u7eea\u72b6\u6001\u3002</p> <p>\u4e0d\u7ba1\u7ebf\u7a0b\u8fdb\u5165\u54ea\u79cd\u963b\u585e\u72b6\u6001\uff0c\u90fd\u5f97\u7b49\u6240\u7b49\u5f85\u7684\u4e8b\u4ef6\uff08wait\u3001sleep\u3001join\u3001synchronized\u3001I/O\uff09\u5b8c\u6210\u540e\uff0c\u624d\u53ef\u4ee5\u8fdb\u5165\u5c31\u7eea\u961f\u5217\uff0c\u6392\u961f\u7b49\u5f85CPU\u8d44\u6e90</p> <p>\uff085\uff09\u6b7b\u4ea1\u72b6\u6001\uff08Dead\uff09\uff1a\u7ebf\u7a0b\u6267\u884c\u5b8c\u4e86\u6216\u8005\u56e0\u5f02\u5e38\u9000\u51fa\u4e86run()\u65b9\u6cd5\uff0c\u8be5\u7ebf\u7a0b\u7ed3\u675f\u751f\u547d\u5468\u671f\u3002</p>"},{"location":"030Android/010Basic/#4looperloopanr","title":"4\u3001\u4e3b\u7ebf\u7a0b\u4e2d\u7684Looper.loop()\u4e00\u76f4\u65e0\u9650\u5faa\u73af\u4e3a\u4ec0\u4e48\u4e0d\u4f1a\u9020\u6210ANR\uff1f","text":"<p>\u4e5f\u8bb8\u8bb2\u5230\u8fd9\u91cc\uff0c\u5f88\u591a\u4eba\u5df2\u7ecf\u77e5\u9053\u539f\u56e0\u4e86\u5427\uff01\u4e0d\u8fc7\u4e60\u60ef\u4f7f\u7136\uff0c\u6211\u8fd8\u662f\u8981\u603b\u7ed3\u4e00\u4e0b\u3002</p> <p>\u4e3b\u7ebf\u7a0bLooper\u4ece\u6d88\u606f\u961f\u5217\u8bfb\u53d6\u6d88\u606f\uff0c\u5f53\u8bfb\u5b8c\u6240\u6709\u6d88\u606f\u65f6\uff0c\u4e3b\u7ebf\u7a0b\u963b\u585e\u3002\u5b50\u7ebf\u7a0b\u5f80\u6d88\u606f\u961f\u5217\u53d1\u9001\u6d88\u606f\uff0c\u5e76\u4e14\u5f80\u7ba1\u9053\u6587\u4ef6\u5199\u6570\u636e\uff0c\u4e3b\u7ebf\u7a0b\u5373\u88ab\u5524\u9192\uff0c\u4ece\u7ba1\u9053\u6587\u4ef6\u8bfb\u53d6\u6570\u636e\uff0c\u4e3b\u7ebf\u7a0b\u88ab\u5524\u9192\u53ea\u662f\u4e3a\u4e86\u8bfb\u53d6\u6d88\u606f\uff0c\u5f53\u6d88\u606f\u8bfb\u53d6\u5b8c\u6bd5\uff0c\u518d\u6b21\u7761\u7720\u3002\u56e0\u6b64loop\u7684\u5faa\u73af\u5e76\u4e0d\u4f1a\u5bf9CPU\u6027\u80fd\u6709\u8fc7\u591a\u7684\u6d88\u8017\u3002</p> <p>\u8bb2\u5230\u8fd9\u91cc\uff0c\u5404\u4f4d\u770b\u5b98\u5e94\u8be5\u77e5\u9053\u4e3a\u4ec0\u4e48\u4e0a\u9762\u8981\u5f15\u5165\u7ebf\u7a0b\u72b6\u6001\u7684\u4e86\u89e3\u4e86\u5427\u3002</p> <p>\u5bf9\u4e8e\u7ebf\u7a0b\u5373\u662f\u4e00\u6bb5\u53ef\u6267\u884c\u7684\u4ee3\u7801\uff0c\u5f53\u53ef\u6267\u884c\u4ee3\u7801\u6267\u884c\u5b8c\u6210\u540e\uff0c\u7ebf\u7a0b\u751f\u547d\u5468\u671f\u4fbf\u8be5\u7ec8\u6b62\u4e86\uff0c\u7ebf\u7a0b\u9000\u51fa\u3002\u800c\u5bf9\u4e8e\u4e3b\u7ebf\u7a0b\uff0c\u6211\u4eec\u662f\u7edd\u4e0d\u5e0c\u671b\u4f1a\u88ab\u8fd0\u884c\u4e00\u6bb5\u65f6\u95f4\uff0c\u81ea\u5df1\u5c31\u9000\u51fa\uff0c\u90a3\u4e48\u5982\u4f55\u4fdd\u8bc1\u80fd\u4e00\u76f4\u5b58\u6d3b\u5462\uff1f\u7b80\u5355\u505a\u6cd5\u5c31\u662f\u53ef\u6267\u884c\u4ee3\u7801\u662f\u80fd\u4e00\u76f4\u6267\u884c\u4e0b\u53bb\u7684\uff0c\u6b7b\u5faa\u73af\u4fbf\u80fd\u4fdd\u8bc1\u4e0d\u4f1a\u88ab\u9000\u51fa\uff0c\u4f8b\u5982\uff0cbinder\u7ebf\u7a0b\u4e5f\u662f\u91c7\u7528\u6b7b\u5faa\u73af\u7684\u65b9\u6cd5\uff0c\u901a\u8fc7\u5faa\u73af\u65b9\u5f0f\u4e0d\u540c\u4e0eBinder\u9a71\u52a8\u8fdb\u884c\u8bfb\u5199\u64cd\u4f5c\uff0c\u5f53\u7136\u5e76\u975e\u7b80\u5355\u5730\u6b7b\u5faa\u73af\uff0c\u65e0\u6d88\u606f\u65f6\u4f1a\u4f11\u7720\u3002\u4f46\u8fd9\u91cc\u53ef\u80fd\u53c8\u5f15\u53d1\u4e86\u53e6\u4e00\u4e2a\u95ee\u9898\uff0c\u65e2\u7136\u662f\u6b7b\u5faa\u73af\u53c8\u5982\u4f55\u53bb\u5904\u7406\u5176\u4ed6\u4e8b\u52a1\u5462\uff1f\u901a\u8fc7\u521b\u5efa\u65b0\u7ebf\u7a0b\u7684\u65b9\u5f0f\u3002\u771f\u6b63\u4f1a\u5361\u6b7b\u4e3b\u7ebf\u7a0b\u7684\u64cd\u4f5c\u662f\u5728\u56de\u8c03\u65b9\u6cd5onCreate/onStart/onResume\u7b49\u64cd\u4f5c\u65f6\u95f4\u8fc7\u957f\uff0c\u4f1a\u5bfc\u81f4\u6389\u5e27\uff0c\u751a\u81f3\u53d1\u751fANR\uff0clooper.loop\u672c\u8eab\u4e0d\u4f1a\u5bfc\u81f4\u5e94\u7528\u5361\u6b7b\u3002</p> <p>\u4e3b\u7ebf\u7a0b\u7684\u6b7b\u5faa\u73af\u4e00\u76f4\u8fd0\u884c\u662f\u4e0d\u662f\u7279\u522b\u6d88\u8017CPU\u8d44\u6e90\u5462\uff1f \u5176\u5b9e\u4e0d\u7136\uff0c\u8fd9\u91cc\u5c31\u6d89\u53ca\u5230Linux pipe/epoll\u673a\u5236\uff0c\u7b80\u5355\u8bf4\u5c31\u662f\u5728\u4e3b\u7ebf\u7a0b\u7684MessageQueue\u6ca1\u6709\u6d88\u606f\u65f6\uff0c\u4fbf\u963b\u585e\u5728loop\u7684queue.next()\u4e2d\u7684nativePollOnce()\u65b9\u6cd5\u91cc\uff0c\u6b64\u65f6\u4e3b\u7ebf\u7a0b\u4f1a\u91ca\u653eCPU\u8d44\u6e90\u8fdb\u5165\u4f11\u7720\u72b6\u6001\uff0c\u76f4\u5230\u4e0b\u4e2a\u6d88\u606f\u5230\u8fbe\u6216\u8005\u6709\u4e8b\u52a1\u53d1\u751f\uff0c\u901a\u8fc7\u5f80pipe\u7ba1\u9053\u5199\u7aef\u5199\u5165\u6570\u636e\u6765\u5524\u9192\u4e3b\u7ebf\u7a0b\u5de5\u4f5c\u3002\u8fd9\u91cc\u91c7\u7528\u7684epoll\u673a\u5236\uff0c\u662f\u4e00\u79cdIO\u591a\u8def\u590d\u7528\u673a\u5236\uff0c\u53ef\u4ee5\u540c\u65f6\u76d1\u63a7\u591a\u4e2a\u63cf\u8ff0\u7b26\uff0c\u5f53\u67d0\u4e2a\u63cf\u8ff0\u7b26\u5c31\u7eea(\u8bfb\u6216\u5199\u5c31\u7eea)\uff0c\u5219\u7acb\u523b\u901a\u77e5\u76f8\u5e94\u7a0b\u5e8f\u8fdb\u884c\u8bfb\u6216\u5199\u64cd\u4f5c\uff0c\u672c\u8d28\u540c\u6b65I/O\uff0c\u5373\u8bfb\u5199\u662f\u963b\u585e\u7684\u3002 \u6240\u4ee5\u8bf4\uff0c\u4e3b\u7ebf\u7a0b\u5927\u591a\u6570\u65f6\u5019\u90fd\u662f\u5904\u4e8e\u4f11\u7720\u72b6\u6001\uff0c\u5e76\u4e0d\u4f1a\u6d88\u8017\u5927\u91cfCPU\u8d44\u6e90\u3002</p>"},{"location":"030Android/010Basic/#looper_1","title":"Looper\u7ec6\u8282","text":"\u7b54\u6848 <p><code>Looper</code> \u662f Android \u4e2d\u7528\u4e8e\u7ba1\u7406\u7ebf\u7a0b\u6d88\u606f\u5faa\u73af\u7684\u6838\u5fc3\u7c7b\uff0c\u5b83\u4e0e <code>Handler</code> \u548c <code>MessageQueue</code> \u5171\u540c\u6784\u6210\u4e86 Android \u7684\u6d88\u606f\u673a\u5236\u3002\u4ee5\u4e0b\u662f <code>Looper</code> \u7684\u6e90\u4ee3\u7801\u89e3\u6790\uff0c\u5e2e\u52a9\u4f60\u7406\u89e3\u5176\u5de5\u4f5c\u539f\u7406\u3002</p>"},{"location":"030Android/010Basic/#1_10","title":"1. \u6838\u5fc3\u6210\u5458\u53d8\u91cf","text":"<p><code>Looper</code> \u7684\u6838\u5fc3\u6210\u5458\u53d8\u91cf\u5982\u4e0b\uff1a</p> <pre><code>public final class Looper {\n    // ThreadLocal \u5b58\u50a8\u6bcf\u4e2a\u7ebf\u7a0b\u7684 Looper \u5b9e\u4f8b\n    static final ThreadLocal&lt;Looper&gt; sThreadLocal = new ThreadLocal&lt;Looper&gt;();\n\n    // \u4e3b\u7ebf\u7a0b\u7684 Looper\n    private static Looper sMainLooper;\n\n    // \u6d88\u606f\u961f\u5217\n    final MessageQueue mQueue;\n\n    // \u5f53\u524d\u7ebf\u7a0b\n    final Thread mThread;\n\n    // \u662f\u5426\u5141\u8bb8\u9000\u51fa\n    private boolean mQuitAllowed;\n\n    // \u662f\u5426\u5df2\u7ecf\u9000\u51fa\n    private boolean mQuitting;\n}\n</code></pre> <ul> <li><code>sThreadLocal</code>\uff1a\u4f7f\u7528 <code>ThreadLocal</code> \u5b58\u50a8\u6bcf\u4e2a\u7ebf\u7a0b\u7684 <code>Looper</code> \u5b9e\u4f8b\uff0c\u786e\u4fdd\u7ebf\u7a0b\u552f\u4e00\u6027\u3002</li> <li><code>mQueue</code>\uff1a<code>Looper</code> \u7ba1\u7406\u7684\u6d88\u606f\u961f\u5217\uff0c\u7528\u4e8e\u5b58\u50a8\u548c\u5206\u53d1\u6d88\u606f\u3002</li> <li><code>mThread</code>\uff1a\u5f53\u524d\u7ebf\u7a0b\u7684\u5f15\u7528\u3002</li> <li><code>mQuitAllowed</code>\uff1a\u6807\u8bc6\u662f\u5426\u5141\u8bb8\u9000\u51fa\uff08\u4e3b\u7ebf\u7a0b\u7684 <code>Looper</code> \u4e0d\u5141\u8bb8\u9000\u51fa\uff09\u3002</li> <li><code>mQuitting</code>\uff1a\u6807\u8bc6 <code>Looper</code> \u662f\u5426\u5df2\u7ecf\u9000\u51fa\u3002</li> </ul>"},{"location":"030Android/010Basic/#2_7","title":"2. \u6838\u5fc3\u65b9\u6cd5\u89e3\u6790","text":""},{"location":"030Android/010Basic/#1-prepare","title":"(1) <code>prepare()</code> \u65b9\u6cd5","text":"<p><code>prepare()</code> \u662f\u521d\u59cb\u5316 <code>Looper</code> \u7684\u5173\u952e\u65b9\u6cd5\uff0c\u6bcf\u4e2a\u7ebf\u7a0b\u53ea\u80fd\u8c03\u7528\u4e00\u6b21\u3002</p> <pre><code>public static void prepare() {\n    prepare(true);\n}\n\nprivate static void prepare(boolean quitAllowed) {\n    // \u68c0\u67e5\u5f53\u524d\u7ebf\u7a0b\u662f\u5426\u5df2\u7ecf\u6709\u4e00\u4e2a Looper\n    if (sThreadLocal.get() != null) {\n        throw new RuntimeException(\"Only one Looper may be created per thread\");\n    }\n    // \u521b\u5efa Looper \u5e76\u5b58\u50a8\u5230 ThreadLocal \u4e2d\n    sThreadLocal.set(new Looper(quitAllowed));\n}\n</code></pre> <ul> <li>\u5982\u679c\u5f53\u524d\u7ebf\u7a0b\u5df2\u7ecf\u6709\u4e00\u4e2a <code>Looper</code>\uff0c\u5219\u629b\u51fa\u5f02\u5e38\u3002</li> <li>\u5426\u5219\uff0c\u521b\u5efa\u4e00\u4e2a\u65b0\u7684 <code>Looper</code> \u5e76\u5b58\u50a8\u5230 <code>ThreadLocal</code> \u4e2d\u3002</li> </ul>"},{"location":"030Android/010Basic/#2-looper","title":"(2) <code>Looper</code> \u6784\u9020\u51fd\u6570","text":"<p><code>Looper</code> \u7684\u6784\u9020\u51fd\u6570\u662f\u79c1\u6709\u7684\uff0c\u53ea\u80fd\u901a\u8fc7 <code>prepare()</code> \u65b9\u6cd5\u521b\u5efa\u5b9e\u4f8b\u3002</p> <pre><code>private Looper(boolean quitAllowed) {\n    // \u521b\u5efa\u6d88\u606f\u961f\u5217\n    mQueue = new MessageQueue(quitAllowed);\n    // \u8bb0\u5f55\u5f53\u524d\u7ebf\u7a0b\n    mThread = Thread.currentThread();\n}\n</code></pre> <ul> <li>\u521d\u59cb\u5316 <code>MessageQueue</code>\uff0c\u7528\u4e8e\u5b58\u50a8\u6d88\u606f\u3002</li> <li>\u8bb0\u5f55\u5f53\u524d\u7ebf\u7a0b\u3002</li> </ul>"},{"location":"030Android/010Basic/#3-loop","title":"(3) <code>loop()</code> \u65b9\u6cd5","text":"<p><code>loop()</code> \u662f <code>Looper</code> \u7684\u6838\u5fc3\u65b9\u6cd5\uff0c\u7528\u4e8e\u542f\u52a8\u6d88\u606f\u5faa\u73af\u3002</p> <pre><code>public static void loop() {\n    // \u83b7\u53d6\u5f53\u524d\u7ebf\u7a0b\u7684 Looper\n    final Looper me = myLooper();\n    if (me == null) {\n        throw new RuntimeException(\"No Looper; Looper.prepare() wasn't called on this thread.\");\n    }\n    // \u83b7\u53d6\u6d88\u606f\u961f\u5217\n    final MessageQueue queue = me.mQueue;\n\n    // \u65e0\u9650\u5faa\u73af\uff0c\u5904\u7406\u6d88\u606f\n    for (;;) {\n        // \u4ece\u6d88\u606f\u961f\u5217\u4e2d\u53d6\u51fa\u6d88\u606f\n        Message msg = queue.next();\n        if (msg == null) {\n            // \u6ca1\u6709\u6d88\u606f\u65f6\u9000\u51fa\u5faa\u73af\n            return;\n        }\n\n        // \u5206\u53d1\u6d88\u606f\u7ed9\u76ee\u6807 Handler\n        msg.target.dispatchMessage(msg);\n\n        // \u56de\u6536\u6d88\u606f\n        msg.recycleUnchecked();\n    }\n}\n</code></pre> <ul> <li>\u4ece <code>MessageQueue</code> \u4e2d\u53d6\u51fa\u6d88\u606f\u3002</li> <li>\u5c06\u6d88\u606f\u5206\u53d1\u7ed9\u76ee\u6807 <code>Handler</code> \u5904\u7406\u3002</li> <li>\u56de\u6536\u6d88\u606f\u5bf9\u8c61\uff0c\u907f\u514d\u91cd\u590d\u521b\u5efa\u3002</li> </ul>"},{"location":"030Android/010Basic/#4-quit-quitsafely_1","title":"(4) <code>quit()</code> \u548c <code>quitSafely()</code> \u65b9\u6cd5","text":"<p>\u8fd9\u4e24\u4e2a\u65b9\u6cd5\u7528\u4e8e\u9000\u51fa <code>Looper</code> \u7684\u6d88\u606f\u5faa\u73af\u3002</p> <pre><code>public void quit() {\n    mQueue.quit(false); // \u7acb\u5373\u9000\u51fa\n}\n\npublic void quitSafely() {\n    mQueue.quit(true); // \u5b89\u5168\u9000\u51fa\uff0c\u5904\u7406\u5b8c\u6240\u6709\u672a\u5904\u7406\u7684\u6d88\u606f\n}\n</code></pre> <ul> <li><code>quit()</code>\uff1a\u7acb\u5373\u9000\u51fa\uff0c\u4e22\u5f03\u672a\u5904\u7406\u7684\u6d88\u606f\u3002</li> <li><code>quitSafely()</code>\uff1a\u5b89\u5168\u9000\u51fa\uff0c\u5904\u7406\u5b8c\u6240\u6709\u672a\u5904\u7406\u7684\u6d88\u606f\u540e\u518d\u9000\u51fa\u3002</li> </ul>"},{"location":"030Android/010Basic/#5-mylooper","title":"(5) <code>myLooper()</code> \u65b9\u6cd5","text":"<p><code>myLooper()</code> \u7528\u4e8e\u83b7\u53d6\u5f53\u524d\u7ebf\u7a0b\u7684 <code>Looper</code> \u5b9e\u4f8b\u3002</p> <pre><code>public static @Nullable Looper myLooper() {\n    return sThreadLocal.get();\n}\n</code></pre> <ul> <li>\u4ece <code>ThreadLocal</code> \u4e2d\u83b7\u53d6\u5f53\u524d\u7ebf\u7a0b\u7684 <code>Looper</code>\u3002</li> </ul>"},{"location":"030Android/010Basic/#6-getmainlooper","title":"(6) <code>getMainLooper()</code> \u65b9\u6cd5","text":"<p><code>getMainLooper()</code> \u7528\u4e8e\u83b7\u53d6\u4e3b\u7ebf\u7a0b\u7684 <code>Looper</code>\u3002</p> <pre><code>public static Looper getMainLooper() {\n    synchronized (Looper.class) {\n        return sMainLooper;\n    }\n}\n</code></pre> <ul> <li>\u8fd4\u56de\u4e3b\u7ebf\u7a0b\u7684 <code>Looper</code> \u5b9e\u4f8b\u3002</li> </ul>"},{"location":"030Android/010Basic/#3-looper","title":"3. \u4e3b\u7ebf\u7a0b\u7684 Looper \u521d\u59cb\u5316","text":"<p>\u4e3b\u7ebf\u7a0b\u7684 <code>Looper</code> \u662f\u5728 <code>ActivityThread</code> \u4e2d\u521d\u59cb\u5316\u7684\u3002</p> <pre><code>public static void main(String[] args) {\n    // \u521d\u59cb\u5316\u4e3b\u7ebf\u7a0b\u7684 Looper\n    Looper.prepareMainLooper();\n\n    // \u521b\u5efa ActivityThread \u5b9e\u4f8b\n    ActivityThread thread = new ActivityThread();\n    thread.attach(false);\n\n    // \u542f\u52a8\u6d88\u606f\u5faa\u73af\n    Looper.loop();\n}\n</code></pre> <ul> <li><code>prepareMainLooper()</code> \u4f1a\u8c03\u7528 <code>prepare(false)</code>\uff0c\u8868\u793a\u4e3b\u7ebf\u7a0b\u7684 <code>Looper</code> \u4e0d\u5141\u8bb8\u9000\u51fa\u3002</li> <li>\u7136\u540e\u8c03\u7528 <code>loop()</code> \u542f\u52a8\u6d88\u606f\u5faa\u73af\u3002</li> </ul>"},{"location":"030Android/010Basic/#4_7","title":"4. \u603b\u7ed3","text":"<ul> <li><code>Looper</code> \u901a\u8fc7 <code>ThreadLocal</code> \u786e\u4fdd\u6bcf\u4e2a\u7ebf\u7a0b\u53ea\u6709\u4e00\u4e2a\u5b9e\u4f8b\u3002</li> <li><code>prepare()</code> \u65b9\u6cd5\u7528\u4e8e\u521d\u59cb\u5316 <code>Looper</code>\uff0c<code>loop()</code> \u65b9\u6cd5\u7528\u4e8e\u542f\u52a8\u6d88\u606f\u5faa\u73af\u3002</li> <li><code>MessageQueue</code> \u662f <code>Looper</code> \u7684\u6838\u5fc3\uff0c\u8d1f\u8d23\u5b58\u50a8\u548c\u5206\u53d1\u6d88\u606f\u3002</li> <li>\u4e3b\u7ebf\u7a0b\u7684 <code>Looper</code> \u5728\u5e94\u7528\u542f\u52a8\u65f6\u81ea\u52a8\u521d\u59cb\u5316\uff0c\u5176\u4ed6\u7ebf\u7a0b\u9700\u8981\u624b\u52a8\u8c03\u7528 <code>prepare()</code> \u548c <code>loop()</code>\u3002</li> </ul> <p>\u901a\u8fc7\u4ee5\u4e0a\u89e3\u6790\uff0c\u4f60\u53ef\u4ee5\u6df1\u5165\u7406\u89e3 <code>Looper</code> \u7684\u5de5\u4f5c\u539f\u7406\u53ca\u5176\u5728 Android \u6d88\u606f\u673a\u5236\u4e2d\u7684\u4f5c\u7528\u3002</p>"},{"location":"030Android/010Basic/#_44","title":"\u5982\u4f55\u5728\u5f53\u524d\u7ebf\u7a0b\u4e2d\u5224\u65ad\u662f\u5426\u662f\u4e3b\u7ebf\u7a0b?","text":"\u7b54\u6848 <p>Looper.getMainLooper();</p>"},{"location":"030Android/010Basic/#messagequeueidlehandler","title":"MessageQueue.IdleHandler\u539f\u7406\uff0c\u4ee5\u53ca\u7528\u9014\u3002","text":"\u7b54\u6848 <p><code>MessageQueue.IdleHandler</code> \u662f Android \u4e2d <code>MessageQueue</code> \u7684\u4e00\u4e2a\u63a5\u53e3\uff0c\u7528\u4e8e\u5728\u6d88\u606f\u961f\u5217\u7a7a\u95f2\u65f6\u6267\u884c\u4efb\u52a1\u3002\u4ee5\u4e0b\u662f\u5176\u539f\u7406\u548c\u7528\u9014\u7684\u8be6\u7ec6\u8bf4\u660e\uff1a</p>"},{"location":"030Android/010Basic/#_45","title":"\u539f\u7406","text":"<ol> <li>\u6d88\u606f\u961f\u5217\u673a\u5236\uff1a</li> <li>Android \u7684\u4e3b\u7ebf\u7a0b\u901a\u8fc7 <code>Looper</code> \u548c <code>MessageQueue</code> \u5904\u7406\u6d88\u606f\u3002</li> <li> <p><code>MessageQueue</code> \u5b58\u50a8\u5f85\u5904\u7406\u7684\u6d88\u606f\uff0c<code>Looper</code> \u4e0d\u65ad\u4ece\u961f\u5217\u4e2d\u53d6\u51fa\u6d88\u606f\u5e76\u5206\u53d1\u7ed9\u5bf9\u5e94\u7684 <code>Handler</code> \u5904\u7406\u3002</p> </li> <li> <p>\u7a7a\u95f2\u65f6\u673a\uff1a</p> </li> <li>\u5f53 <code>MessageQueue</code> \u4e2d\u6ca1\u6709\u6d88\u606f\u6216\u4e0b\u4e00\u4e2a\u6d88\u606f\u7684\u6267\u884c\u65f6\u95f4\u672a\u5230\u65f6\uff0c\u7cfb\u7edf\u5904\u4e8e\u7a7a\u95f2\u72b6\u6001\u3002</li> <li> <p>\u6b64\u65f6\uff0c<code>MessageQueue</code> \u4f1a\u68c0\u67e5\u662f\u5426\u6709\u6ce8\u518c\u7684 <code>IdleHandler</code>\uff0c\u5e76\u8c03\u7528\u5176 <code>queueIdle()</code> \u65b9\u6cd5\u3002</p> </li> <li> <p>IdleHandler \u63a5\u53e3\uff1a</p> </li> <li><code>IdleHandler</code> \u662f\u4e00\u4e2a\u63a5\u53e3\uff0c\u53ea\u6709\u4e00\u4e2a\u65b9\u6cd5 <code>boolean queueIdle()</code>\u3002</li> <li>\u8be5\u65b9\u6cd5\u5728\u6d88\u606f\u961f\u5217\u7a7a\u95f2\u65f6\u88ab\u8c03\u7528\uff0c\u8fd4\u56de <code>true</code> \u8868\u793a\u7ee7\u7eed\u4fdd\u7559\u8be5 <code>IdleHandler</code>\uff0c<code>false</code> \u8868\u793a\u79fb\u9664\u3002</li> </ol>"},{"location":"030Android/010Basic/#_46","title":"\u7528\u9014","text":"<ol> <li>\u5ef6\u8fdf\u4efb\u52a1\uff1a</li> <li> <p>\u9002\u7528\u4e8e\u4e0d\u9700\u8981\u7acb\u5373\u6267\u884c\u7684\u4efb\u52a1\uff0c\u53ef\u4ee5\u5728\u4e3b\u7ebf\u7a0b\u7a7a\u95f2\u65f6\u5904\u7406\uff0c\u907f\u514d\u5f71\u54cd UI \u54cd\u5e94\u3002</p> </li> <li> <p>\u8d44\u6e90\u91ca\u653e\uff1a</p> </li> <li> <p>\u5728\u5e94\u7528\u7a7a\u95f2\u65f6\u91ca\u653e\u4e0d\u518d\u9700\u8981\u7684\u8d44\u6e90\uff0c\u5982\u7f13\u5b58\u6e05\u7406\u7b49\u3002</p> </li> <li> <p>\u6027\u80fd\u4f18\u5316\uff1a</p> </li> <li>\u5c06\u975e\u7d27\u6025\u4efb\u52a1\u63a8\u8fdf\u5230\u7a7a\u95f2\u65f6\u6267\u884c\uff0c\u63d0\u5347\u7528\u6237\u4f53\u9a8c\u3002</li> </ol>"},{"location":"030Android/010Basic/#_47","title":"\u793a\u4f8b\u4ee3\u7801","text":"<pre><code>Looper.myQueue().addIdleHandler(new MessageQueue.IdleHandler() {\n    @Override\n    public boolean queueIdle() {\n        // \u7a7a\u95f2\u65f6\u6267\u884c\u7684\u4efb\u52a1\n        return false; // \u8fd4\u56de false \u8868\u793a\u53ea\u6267\u884c\u4e00\u6b21\n    }\n});\n</code></pre>"},{"location":"030Android/010Basic/#_48","title":"\u603b\u7ed3","text":"<p><code>MessageQueue.IdleHandler</code> \u63d0\u4f9b\u4e86\u4e00\u79cd\u5728\u4e3b\u7ebf\u7a0b\u7a7a\u95f2\u65f6\u6267\u884c\u4efb\u52a1\u7684\u673a\u5236\uff0c\u9002\u7528\u4e8e\u5ef6\u8fdf\u4efb\u52a1\u3001\u8d44\u6e90\u91ca\u653e\u548c\u6027\u80fd\u4f18\u5316\u7b49\u573a\u666f\u3002</p> <p>Android\u4e0a\u4ec0\u4e48\u573a\u666f\u4f1a\u7528\u5230IdleHandler\uff1f\u662f\u5426\u53ef\u80fdMessgeQueue\u4e00\u76f4\u4e0d\u4f11\u606f\u7684\u60c5\u51b5\uff1f</p> <p>\u5728 Android \u5f00\u53d1\u4e2d\uff0c<code>IdleHandler</code> \u4e3b\u8981\u7528\u4e8e\u5728\u4e3b\u7ebf\u7a0b\u7a7a\u95f2\u65f6\u6267\u884c\u4e00\u4e9b\u4f4e\u4f18\u5148\u7ea7\u7684\u4efb\u52a1\u3002\u4ee5\u4e0b\u662f\u4e00\u4e9b\u5178\u578b\u7684\u4f7f\u7528\u573a\u666f\uff0c\u4ee5\u53ca <code>MessageQueue</code> \u662f\u5426\u4f1a\u4e00\u76f4\u4e0d\u4f11\u606f\u7684\u53ef\u80fd\u6027\u5206\u6790\u3002</p>"},{"location":"030Android/010Basic/#idlehandler","title":"IdleHandler \u7684\u4f7f\u7528\u573a\u666f","text":"<ol> <li>\u5ef6\u8fdf\u521d\u59cb\u5316\uff1a</li> <li>\u5bf9\u4e8e\u4e00\u4e9b\u975e\u7d27\u6025\u7684\u521d\u59cb\u5316\u4efb\u52a1\uff08\u5982\u67d0\u4e9b\u6a21\u5757\u7684\u61d2\u52a0\u8f7d\uff09\uff0c\u53ef\u4ee5\u5728\u4e3b\u7ebf\u7a0b\u7a7a\u95f2\u65f6\u6267\u884c\uff0c\u907f\u514d\u5f71\u54cd\u5e94\u7528\u7684\u542f\u52a8\u901f\u5ea6\u6216 UI \u6e32\u67d3\u3002</li> <li> <p>\u793a\u4f8b\uff1a\u5ef6\u8fdf\u52a0\u8f7d\u67d0\u4e9b\u89c6\u56fe\u6216\u6570\u636e\u3002</p> </li> <li> <p>\u8d44\u6e90\u91ca\u653e\uff1a</p> </li> <li>\u5728\u5e94\u7528\u7a7a\u95f2\u65f6\u91ca\u653e\u4e0d\u518d\u9700\u8981\u7684\u8d44\u6e90\uff0c\u4f8b\u5982\u6e05\u7406\u7f13\u5b58\u3001\u5173\u95ed\u6570\u636e\u5e93\u8fde\u63a5\u7b49\u3002</li> <li> <p>\u793a\u4f8b\uff1a\u5728 <code>Activity</code> \u6216 <code>Fragment</code> \u7a7a\u95f2\u65f6\u91ca\u653e\u4e34\u65f6\u8d44\u6e90\u3002</p> </li> <li> <p>\u6027\u80fd\u4f18\u5316\uff1a</p> </li> <li>\u5c06\u4e00\u4e9b\u975e\u5173\u952e\u4efb\u52a1\u63a8\u8fdf\u5230\u4e3b\u7ebf\u7a0b\u7a7a\u95f2\u65f6\u6267\u884c\uff0c\u907f\u514d\u963b\u585e UI \u7ebf\u7a0b\u3002</li> <li> <p>\u793a\u4f8b\uff1a\u5ef6\u8fdf\u6267\u884c\u4e00\u4e9b\u7edf\u8ba1\u4e0a\u62a5\u3001\u65e5\u5fd7\u8bb0\u5f55\u7b49\u64cd\u4f5c\u3002</p> </li> <li> <p>\u5e03\u5c40\u4f18\u5316\uff1a</p> </li> <li>\u5728 <code>View</code> \u7ed8\u5236\u5b8c\u6210\u540e\u6267\u884c\u4e00\u4e9b\u64cd\u4f5c\uff0c\u4f8b\u5982\u5ef6\u8fdf\u52a0\u8f7d\u67d0\u4e9b\u590d\u6742\u7684\u89c6\u56fe\u6216\u52a8\u753b\u3002</li> <li> <p>\u793a\u4f8b\uff1a\u5728 <code>RecyclerView</code> \u6ed1\u52a8\u505c\u6b62\u540e\u52a0\u8f7d\u66f4\u591a\u6570\u636e\u3002</p> </li> <li> <p>\u4efb\u52a1\u8c03\u5ea6\uff1a</p> </li> <li>\u5c06\u4e00\u4e9b\u4f4e\u4f18\u5148\u7ea7\u7684\u4efb\u52a1\u8c03\u5ea6\u5230\u4e3b\u7ebf\u7a0b\u7a7a\u95f2\u65f6\u6267\u884c\uff0c\u907f\u514d\u5f71\u54cd\u7528\u6237\u4f53\u9a8c\u3002</li> <li>\u793a\u4f8b\uff1a\u5ef6\u8fdf\u6267\u884c\u4e00\u4e9b\u540e\u53f0\u4efb\u52a1\u7684\u56de\u8c03\u3002</li> </ol>"},{"location":"030Android/010Basic/#messagequeue_2","title":"MessageQueue \u662f\u5426\u4f1a\u4e00\u76f4\u4e0d\u4f11\u606f\uff1f","text":"<p><code>MessageQueue</code> \u662f\u5426\u4f1a\u4e00\u76f4\u4e0d\u4f11\u606f\uff0c\u53d6\u51b3\u4e8e\u4e3b\u7ebf\u7a0b\u7684\u6d88\u606f\u961f\u5217\u4e2d\u662f\u5426\u6709\u6301\u7eed\u7684\u6d88\u606f\u9700\u8981\u5904\u7406\u3002\u4ee5\u4e0b\u662f\u53ef\u80fd\u5bfc\u81f4 <code>MessageQueue</code> \u4e00\u76f4\u4e0d\u4f11\u606f\u7684\u60c5\u51b5\uff1a</p> <ol> <li>\u9891\u7e41\u7684 UI \u66f4\u65b0\uff1a</li> <li> <p>\u5982\u679c\u5e94\u7528\u4e2d\u6709\u5927\u91cf\u7684\u52a8\u753b\u3001\u9891\u7e41\u7684\u89c6\u56fe\u66f4\u65b0\u6216\u9ad8\u9891\u7387\u7684 <code>Handler</code> \u6d88\u606f\u53d1\u9001\uff0c<code>MessageQueue</code> \u53ef\u80fd\u4f1a\u4e00\u76f4\u5904\u4e8e\u5fd9\u788c\u72b6\u6001\uff0c\u5bfc\u81f4 <code>IdleHandler</code> \u65e0\u6cd5\u6267\u884c\u3002</p> </li> <li> <p>\u963b\u585e\u64cd\u4f5c\uff1a</p> </li> <li> <p>\u5982\u679c\u5728\u4e3b\u7ebf\u7a0b\u4e2d\u6267\u884c\u4e86\u8017\u65f6\u64cd\u4f5c\uff08\u5982\u7f51\u7edc\u8bf7\u6c42\u3001\u6570\u636e\u5e93\u67e5\u8be2\u7b49\uff09\uff0c\u4f1a\u5bfc\u81f4 <code>MessageQueue</code> \u957f\u65f6\u95f4\u65e0\u6cd5\u5904\u7406\u5176\u4ed6\u6d88\u606f\uff0c<code>IdleHandler</code> \u4e5f\u65e0\u6cd5\u6267\u884c\u3002</p> </li> <li> <p>\u6b7b\u5faa\u73af\u6216\u5bc6\u96c6\u8ba1\u7b97\uff1a</p> </li> <li> <p>\u5982\u679c\u4e3b\u7ebf\u7a0b\u4e2d\u6709\u4e00\u4e2a\u6b7b\u5faa\u73af\u6216\u5bc6\u96c6\u8ba1\u7b97\u4efb\u52a1\uff0c<code>MessageQueue</code> \u5c06\u65e0\u6cd5\u5904\u7406\u5176\u4ed6\u6d88\u606f\uff0c<code>IdleHandler</code> \u4e5f\u4e0d\u4f1a\u88ab\u8c03\u7528\u3002</p> </li> <li> <p>\u9ad8\u4f18\u5148\u7ea7\u6d88\u606f\uff1a</p> </li> <li>\u5982\u679c\u6d88\u606f\u961f\u5217\u4e2d\u4e00\u76f4\u6709\u9ad8\u4f18\u5148\u7ea7\u7684\u6d88\u606f\uff08\u5982\u7528\u6237\u8f93\u5165\u4e8b\u4ef6\u3001UI \u7ed8\u5236\u4e8b\u4ef6\uff09\uff0c<code>IdleHandler</code> \u53ef\u80fd\u6ca1\u6709\u673a\u4f1a\u6267\u884c\u3002</li> </ol>"},{"location":"030Android/010Basic/#messagequeue_3","title":"\u5982\u4f55\u907f\u514d MessageQueue \u4e00\u76f4\u4e0d\u4f11\u606f\uff1f","text":"<ol> <li>\u907f\u514d\u4e3b\u7ebf\u7a0b\u963b\u585e\uff1a</li> <li> <p>\u5c06\u8017\u65f6\u64cd\u4f5c\uff08\u5982\u7f51\u7edc\u8bf7\u6c42\u3001\u6587\u4ef6\u8bfb\u5199\u7b49\uff09\u653e\u5230\u5b50\u7ebf\u7a0b\u4e2d\u6267\u884c\uff0c\u907f\u514d\u963b\u585e\u4e3b\u7ebf\u7a0b\u3002</p> </li> <li> <p>\u4f18\u5316 UI \u66f4\u65b0\uff1a</p> </li> <li> <p>\u51cf\u5c11\u4e0d\u5fc5\u8981\u7684 UI \u66f4\u65b0\uff0c\u5408\u5e76\u591a\u6b21\u66f4\u65b0\u64cd\u4f5c\uff0c\u907f\u514d\u9891\u7e41\u89e6\u53d1 <code>View</code> \u7684\u91cd\u7ed8\u3002</p> </li> <li> <p>\u5408\u7406\u4f7f\u7528 Handler\uff1a</p> </li> <li> <p>\u907f\u514d\u5728\u4e3b\u7ebf\u7a0b\u4e2d\u53d1\u9001\u8fc7\u591a\u7684 <code>Handler</code> \u6d88\u606f\uff0c\u5c24\u5176\u662f\u9ad8\u9891\u7387\u7684\u6d88\u606f\u3002</p> </li> <li> <p>\u76d1\u63a7\u4e3b\u7ebf\u7a0b\u72b6\u6001\uff1a</p> </li> <li>\u4f7f\u7528\u5de5\u5177\uff08\u5982 <code>Systrace</code> \u6216 <code>BlockCanary</code>\uff09\u76d1\u63a7\u4e3b\u7ebf\u7a0b\u7684\u5361\u987f\u60c5\u51b5\uff0c\u53ca\u65f6\u53d1\u73b0\u5e76\u89e3\u51b3\u95ee\u9898\u3002</li> </ol>"},{"location":"030Android/010Basic/#_49","title":"\u603b\u7ed3","text":"<ul> <li>\u4f7f\u7528\u573a\u666f\uff1a<code>IdleHandler</code> \u9002\u7528\u4e8e\u5ef6\u8fdf\u521d\u59cb\u5316\u3001\u8d44\u6e90\u91ca\u653e\u3001\u6027\u80fd\u4f18\u5316\u7b49\u573a\u666f\u3002</li> <li>MessageQueue \u4e0d\u4f11\u606f\u7684\u53ef\u80fd\u6027\uff1a\u5982\u679c\u4e3b\u7ebf\u7a0b\u4e2d\u6709\u9891\u7e41\u7684\u6d88\u606f\u5904\u7406\u6216\u963b\u585e\u64cd\u4f5c\uff0c<code>MessageQueue</code> \u53ef\u80fd\u4f1a\u4e00\u76f4\u4e0d\u4f11\u606f\uff0c\u5bfc\u81f4 <code>IdleHandler</code> \u65e0\u6cd5\u6267\u884c\u3002</li> <li>\u4f18\u5316\u5efa\u8bae\uff1a\u907f\u514d\u4e3b\u7ebf\u7a0b\u963b\u585e\uff0c\u4f18\u5316 UI \u66f4\u65b0\uff0c\u5408\u7406\u4f7f\u7528 <code>Handler</code>\uff0c\u786e\u4fdd\u4e3b\u7ebf\u7a0b\u6709\u673a\u4f1a\u8fdb\u5165\u7a7a\u95f2\u72b6\u6001\u3002</li> </ul>"},{"location":"030Android/010Basic/#view-viewgroup","title":"View &amp; Viewgroup\u7684\u4e8b\u4ef6\u5206\u53d1\u673a\u5236","text":"\u7b54\u6848 <p><pre><code>public boolean dispatchTouchEvent(MotionEvent ev){\n    boolean consume = false;\n    if(onInterceptTouchEvent(ev)){\n        consume = onTouchEvent(ev);\n    } else {\n        consume = child.dispatchTouchEvent(ev);\n    }\n    return consume;\n}\n</code></pre> 1 ViewGroup\uff1a\u6240\u4ee5dispatch\u5c31\u662f\u5206\u53d1\uff0c\u6ca1\u6709\u5176\u4ed6\u7684\u4f5c\u7528\uff0conIntercept\u5c31\u662f\u62e6\u622a\uff0conTouchEvent\u5c31\u662f\u641e\u4f60\u60f3\u641e\u7684\u4e8b\u60c5\u3002</p> <p>2 View\uff1aondispatchTouchEvent, onTouch, onTouchEvent, </p>"},{"location":"030Android/010Basic/#_50","title":"\u624b\u6307\u6ed1\u51fa\u4e86\u8be5\u63a7\u4ef6\u7684\u8303\u56f4\u4f1a\u6709\u4ec0\u4e48\u4e8b\u4ef6\uff1f","text":"\u7b54\u6848 <p>\u4e0d\u4f1a\u6709ACTION_CANCEL\u4e8b\u4ef6\u3002\u5982\u679c\u7236\u5e03\u5c40\u6ca1\u6709\u62e6\u622a\uff0c\u90a3\u4e48\u7ee7\u7eed\u4f1a\u6709MOVE UP\u4e8b\u4ef6\u3002</p> <p>\u7ecf\u8fc7\u6211\u81ea\u5df1\u7684\u6d4b\u8bd5\uff0c\u4e8b\u5b9e\u786e\u5b9e\u5982\u6b64\uff0c\u90a3\u6211\u4e4b\u524d\u7684\u7ecf\u9a8c\u662f\u54ea\u91cc\u6765\u7684\uff1f\uff1f</p> <pre><code>class CustomView @JvmOverloads constructor(\n    context: Context, attrs: AttributeSet? = null, defStyleAttr: Int = 0\n) : View(context, attrs, defStyleAttr) {\n\n    init {\n        // \u8bbe\u7f6e\u80cc\u666f\u989c\u8272\u4e3a\u7ea2\u8272\n        setBackgroundColor(Color.RED)\n    }\n    override fun onTouchEvent(event: MotionEvent): Boolean {\n        when (event.action) {\n            MotionEvent.ACTION_DOWN -&gt; {\n                Log.d(\"CustomView\", \"ACTION_DOWN\")\n            }\n            MotionEvent.ACTION_MOVE -&gt; {\n                Log.d(\"CustomView\", \"ACTION_MOVE\")\n            }\n            MotionEvent.ACTION_UP -&gt; {\n                Log.d(\"CustomView\", \"ACTION_UP\")\n            }\n            MotionEvent.ACTION_CANCEL -&gt; {\n                Log.d(\"CustomView\", \"ACTION_CANCEL\")\n            }\n        }\n        return true\n    }\n}\n</code></pre> <p>2025-03-21 16:19:01.346 26696-26696 CustomView              com.perryzhang.example               D  ACTION_DOWN 2025-03-21 16:19:01.375 26696-26696 CustomView              com.perryzhang.example               D  ACTION_MOVE 2025-03-21 16:19:01.391 26696-26696 CustomView              com.perryzhang.example               D  ACTION_MOVE 2025-03-21 16:19:01.410 26696-26696 CustomView              com.perryzhang.example               D  ACTION_MOVE 2025-03-21 16:19:03.106 26696-26696 CustomView              com.perryzhang.example               D  ACTION_MOVE  // \u79fb\u51faView\u8303\u56f4\u540e\u4f9d\u7136\u662fACTION_MOVE 2025-03-21 16:19:03.117 26696-26696 CustomView              com.perryzhang.example               D  ACTION_UP // VIEW\u8303\u56f4\u5916\u62ac\u624b\u6307\uff0c\u89e6\u53d1UP/</p>"},{"location":"030Android/010Basic/#action_cancel","title":"ACTION_CANCEL\u4e8b\u4ef6\u4f55\u65f6\u89e6\u53d1\uff1f","text":"\u7b54\u6848 <p>\u5728 Android \u4e2d\uff0c<code>ACTION_CANCEL</code> \u4e8b\u4ef6\u901a\u5e38\u5728\u4ee5\u4e0b\u60c5\u51b5\u4e0b\u89e6\u53d1\uff1a</p> <ol> <li>\u7236\u89c6\u56fe\u62e6\u622a\u89e6\u6478\u4e8b\u4ef6\uff1a</li> <li> <p>\u5f53\u5b50\u89c6\u56fe\u6b63\u5728\u5904\u7406\u89e6\u6478\u4e8b\u4ef6\u65f6\uff0c\u5982\u679c\u7236\u89c6\u56fe\u51b3\u5b9a\u62e6\u622a\u4e8b\u4ef6\uff08\u4f8b\u5982\u901a\u8fc7 <code>onInterceptTouchEvent()</code> \u8fd4\u56de <code>true</code>\uff09\uff0c\u5b50\u89c6\u56fe\u4f1a\u6536\u5230 <code>ACTION_CANCEL</code>\uff0c\u8868\u793a\u4e8b\u4ef6\u88ab\u53d6\u6d88\u3002</p> </li> <li> <p>\u89e6\u6478\u4e8b\u4ef6\u88ab\u7cfb\u7edf\u4e2d\u65ad\uff1a</p> </li> <li> <p>\u5f53\u7cfb\u7edf\u4e2d\u65ad\u5f53\u524d\u89e6\u6478\u4e8b\u4ef6\uff08\u5982\u6765\u7535\u6216\u5f39\u51fa\u7cfb\u7edf\u5bf9\u8bdd\u6846\uff09\uff0c\u6b63\u5728\u5904\u7406\u4e8b\u4ef6\u7684\u89c6\u56fe\u4f1a\u6536\u5230 <code>ACTION_CANCEL</code>\u3002</p> </li> <li> <p>\u624b\u52bf\u8bc6\u522b\u5668\u53d6\u6d88\u4e8b\u4ef6\uff1a</p> </li> <li> <p>\u5982\u679c\u624b\u52bf\u8bc6\u522b\u5668\uff08\u5982 <code>GestureDetector</code>\uff09\u51b3\u5b9a\u53d6\u6d88\u5f53\u524d\u624b\u52bf\uff0c\u89c6\u56fe\u4e5f\u4f1a\u6536\u5230 <code>ACTION_CANCEL</code>\u3002</p> </li> <li> <p>\u89c6\u56fe\u72b6\u6001\u53d8\u5316\uff1a</p> </li> <li>\u5f53\u89c6\u56fe\u7684\u72b6\u6001\u53d1\u751f\u53d8\u5316\uff08\u5982\u88ab\u79fb\u9664\u6216\u4e0d\u53ef\u89c1\uff09\uff0c\u6b63\u5728\u5904\u7406\u7684\u4e8b\u4ef6\u4f1a\u88ab\u53d6\u6d88\uff0c\u5e76\u89e6\u53d1 <code>ACTION_CANCEL</code>\u3002</li> </ol>"},{"location":"030Android/010Basic/#_51","title":"\u793a\u4f8b\u4ee3\u7801","text":"<pre><code>@Override\npublic boolean onTouchEvent(MotionEvent event) {\n    switch (event.getAction()) {\n        case MotionEvent.ACTION_DOWN:\n            // \u5904\u7406\u6309\u4e0b\u4e8b\u4ef6\n            break;\n        case MotionEvent.ACTION_MOVE:\n            // \u5904\u7406\u79fb\u52a8\u4e8b\u4ef6\n            break;\n        case MotionEvent.ACTION_UP:\n            // \u5904\u7406\u62ac\u8d77\u4e8b\u4ef6\n            break;\n        case MotionEvent.ACTION_CANCEL:\n            // \u5904\u7406\u53d6\u6d88\u4e8b\u4ef6\n            break;\n    }\n    return true;\n}\n</code></pre>"},{"location":"030Android/010Basic/#_52","title":"\u603b\u7ed3","text":"<p><code>ACTION_CANCEL</code> \u7528\u4e8e\u901a\u77e5\u89c6\u56fe\u4e8b\u4ef6\u88ab\u53d6\u6d88\uff0c\u901a\u5e38\u7531\u7236\u89c6\u56fe\u62e6\u622a\u3001\u7cfb\u7edf\u4e2d\u65ad\u6216\u89c6\u56fe\u72b6\u6001\u53d8\u5316\u5f15\u8d77\u3002</p> <p>ACTION_CANCEL\u7684\u89e6\u53d1\u65f6\u673a \u6ed1\u51fa\u5b50View\u533a\u57df\u4f1a\u53d1\u751f\u4ec0\u4e48\uff1f\u4e3a\u4ec0\u4e48\u4e0d\u54cd\u5e94onClick()\u4e8b\u4ef6</p> <p>\u9996\u5148\u770b\u4e00\u4e0b\u5b98\u65b9\u7684\u89e3\u91ca\uff1a java \u4ee3\u7801\u89e3\u8bfb\u590d\u5236\u4ee3\u7801/* * Constant for {@link #getActionMasked}: The current gesture has been aborted. * You will not receive any more points in it.  You should treat this as * an up event, but not perform any action that you normally would. / public static final int ACTION_CANCEL           = 3;</p> <p>\u8bf4\u4eba\u8bdd\u5c31\u662f\uff1a\u5f53\u524d\u7684\u624b\u52bf\u88ab\u4e2d\u6b62\u4e86\uff0c\u4f60\u4e0d\u4f1a\u518d\u6536\u5230\u4efb\u4f55\u4e8b\u4ef6\u4e86\uff0c\u4f60\u53ef\u4ee5\u628a\u5b83\u5f53\u505a\u4e00\u4e2aACTION_UP\u4e8b\u4ef6\uff0c\u4f46\u662f\u4e0d\u8981\u6267\u884c\u6b63\u5e38\u60c5\u51b5\u4e0b\u7684\u903b\u8f91\u3002 ACTION_CANCEL\u7684\u89e6\u53d1\u65f6\u673a \u6709\u56db\u79cd\u60c5\u51b5\u4f1a\u89e6\u53d1ACTION_CANCEL:</p> <p>\u5728\u5b50View\u5904\u7406\u4e8b\u4ef6\u7684\u8fc7\u7a0b\u4e2d\uff0c\u7236View\u5bf9\u4e8b\u4ef6\u62e6\u622a ACTION_DOWN\u521d\u59cb\u5316\u64cd\u4f5c \u5728\u5b50View\u5904\u7406\u4e8b\u4ef6\u7684\u8fc7\u7a0b\u4e2d\u88ab\u4ece\u7236View\u4e2d\u79fb\u9664\u65f6 \u5b50View\u88ab\u8bbe\u7f6e\u4e86PFLAG_CANCEL_NEXT_UP_EVENT\u6807\u8bb0\u65f6</p> <p>1\uff0c\u7236view\u62e6\u622a\u4e8b\u4ef6 \u9996\u5148\u8981\u4e86\u89e3ViewGroup\u4ec0\u4e48\u60c5\u51b5\u4e0b\u4f1a\u62e6\u622a\u4e8b\u4ef6\uff0cLook the Fuck Resource Code\uff1a java \u4ee3\u7801\u89e3\u8bfb\u590d\u5236\u4ee3\u7801/* * {@inheritDoc} / @Override public boolean dispatchTouchEvent(MotionEvent ev) {     ...</p> <pre><code>boolean handled = false;\nif (onFilterTouchEventForSecurity(ev)) {\n    final int action = ev.getAction();\n    final int actionMasked = action &amp; MotionEvent.ACTION_MASK;\n    ...\n    // Check for interception.\n    final boolean intercepted;\n    // \u5224\u65ad\u6761\u4ef6\u4e00\n    if (actionMasked == MotionEvent.ACTION_DOWN\n            || mFirstTouchTarget != null) {\n        final boolean disallowIntercept = (mGroupFlags &amp; FLAG_DISALLOW_INTERCEPT) != 0;\n        // \u5224\u65ad\u6761\u4ef6\u4e8c\n        if (!disallowIntercept) {\n            intercepted = onInterceptTouchEvent(ev);\n            ev.setAction(action); // restore action in case it was changed\n        } else {\n            intercepted = false;\n        }\n    } else {\n        // There are no touch targets and this action is not an initial down\n        // so this view group continues to intercept touches.\n        intercepted = true;\n    }\n    ...\n}\n...\n</code></pre> <p>}</p> <p>\u6709\u4e24\u4e2a\u6761\u4ef6</p> <p>MotionEvent.ACTION_DOWN\u4e8b\u4ef6\u6216\u8005mFirstTouchTarget\u975e\u7a7a\u4e5f\u5c31\u662f\u6709\u5b50view\u5728\u5904\u7406\u4e8b\u4ef6 \u5b50view\u6ca1\u6709\u505a\u62e6\u622a\uff0c\u4e5f\u5c31\u662f\u6ca1\u6709\u8c03\u7528ViewParent#requestDisallowInterceptTouchEvent(true)</p> <p>\u5982\u679c\u6ee1\u8db3\u4e0a\u9762\u7684\u4e24\u4e2a\u6761\u4ef6\u624d\u4f1a\u6267\u884conInterceptTouchEvent(ev)\u3002 \u5982\u679cViewGroup\u62e6\u622a\u4e86\u4e8b\u4ef6\uff0c\u5219intercepted\u53d8\u91cf\u4e3atrue\uff0c\u63a5\u7740\u5f80\u4e0b\u770b\uff1a java \u4ee3\u7801\u89e3\u8bfb\u590d\u5236\u4ee3\u7801@Override public boolean dispatchTouchEvent(MotionEvent ev) {</p> <pre><code>boolean handled = false;\nif (onFilterTouchEventForSecurity(ev)) {\n    ...\n\n    // Check for interception.\n    final boolean intercepted;\n    if (actionMasked == MotionEvent.ACTION_DOWN\n            || mFirstTouchTarget != null) {\n        final boolean disallowIntercept = (mGroupFlags &amp; FLAG_DISALLOW_INTERCEPT) != 0;\n        if (!disallowIntercept) {\n            // \u5f53mFirstTouchTarget != null\uff0c\u4e5f\u5c31\u662f\u5b50view\u5904\u7406\u4e86\u4e8b\u4ef6\n            // \u6b64\u65f6\u5982\u679c\u7236ViewGroup\u62e6\u622a\u4e86\u4e8b\u4ef6\uff0cintercepted==true\n            intercepted = onInterceptTouchEvent(ev);\n            ev.setAction(action); // restore action in case it was changed\n        } else {\n            intercepted = false;\n        }\n    } else {\n        // There are no touch targets and this action is not an initial down\n        // so this view group continues to intercept touches.\n        intercepted = true;\n    }\n\n    ...\n\n    // Dispatch to touch targets.\n    if (mFirstTouchTarget == null) {\n        ...\n    } else {\n        // Dispatch to touch targets, excluding the new touch target if we already\n        // dispatched to it.  Cancel touch targets if necessary.\n        TouchTarget predecessor = null;\n        TouchTarget target = mFirstTouchTarget;\n        while (target != null) {\n            final TouchTarget next = target.next;\n            if (alreadyDispatchedToNewTouchTarget &amp;&amp; target == newTouchTarget) {\n                ...\n            } else {\n                // \u5224\u65ad\u4e00\uff1a\u6b64\u65f6cancelChild == true\n                final boolean cancelChild = resetCancelNextUpFlag(target.child)\n                        || intercepted;\n\n                // \u5224\u65ad\u4e8c\uff1a\u7ed9child\u53d1\u9001cancel\u4e8b\u4ef6\n                if (dispatchTransformedTouchEvent(ev, cancelChild,\n                        target.child, target.pointerIdBits)) {\n                    handled = true;\n                }\n                ...\n            }\n            ...\n        }\n    }\n    ...\n}\n...\nreturn handled;\n</code></pre> <p>}</p> <p>\u4ee5\u4e0a\u5224\u65ad\u4e00\u5904cancelChild\u4e3atrue\uff0c\u7136\u540e\u8fdb\u5165\u5224\u65ad\u4e8c\u4e2d\u4e00\u770b\u7a76\u7adf\uff1a java \u4ee3\u7801\u89e3\u8bfb\u590d\u5236\u4ee3\u7801private boolean dispatchTransformedTouchEvent(MotionEvent event, boolean cancel,             View child, int desiredPointerIdBits) {     final boolean handled;</p> <pre><code>// Canceling motions is a special case.  We don't need to perform any transformations\n// or filtering.  The important part is the action, not the contents.\nfinal int oldAction = event.getAction();\nif (cancel || oldAction == MotionEvent.ACTION_CANCEL) {\n    // \u5c06event\u8bbe\u7f6e\u6210ACTION_CANCEL\n    event.setAction(MotionEvent.ACTION_CANCEL);\n    if (child == null) {\n        ...\n    } else {\n        // \u5206\u53d1\u7ed9child\n        handled = child.dispatchTouchEvent(event);\n    }\n    event.setAction(oldAction);\n    return handled;\n}\n...\n</code></pre> <p>}</p> <p>\u5f53\u53c2\u6570cancel\u4e3ature\u65f6\u4f1a\u5c06event\u8bbe\u7f6e\u4e3aMotionEvent.ACTION_CANCEL\uff0c\u7136\u540e\u5206\u53d1\u7ed9child\u3002 2\uff0cACTION_DOWN\u521d\u59cb\u5316\u64cd\u4f5c java \u4ee3\u7801\u89e3\u8bfb\u590d\u5236\u4ee3\u7801public boolean dispatchTouchEvent(MotionEvent ev) {</p> <pre><code>boolean handled = false;\nif (onFilterTouchEventForSecurity(ev)) {\n    final int action = ev.getAction();\n    final int actionMasked = action &amp; MotionEvent.ACTION_MASK;\n\n    // Handle an initial down.\n    if (actionMasked == MotionEvent.ACTION_DOWN) {\n        // Throw away all previous state when starting a new touch gesture.\n        // The framework may have dropped the up or cancel event for the previous gesture\n        // due to an app switch, ANR, or some other state change.\n        // \u53d6\u6d88\u5e76\u6e05\u9664\u6240\u6709\u7684Touch\u76ee\u6807\n        cancelAndClearTouchTargets(ev);\n        resetTouchState();\n    }\n    ...\n}\n...\n</code></pre> <p>}</p> <p>\u7cfb\u7edf\u53ef\u80fd\u4f1a\u7531\u4e8eApp\u5207\u6362\u3001ANR\u7b49\u539f\u56e0\u4e22\u5931\u4e86up\uff0ccancel\u4e8b\u4ef6\u3002 \u56e0\u6b64\u9700\u8981\u5728ACTION_DOWN\u65f6\u4e22\u5f03\u6389\u6240\u6709\u524d\u9762\u7684\u72b6\u6001\uff0c\u5177\u4f53\u4ee3\u7801\u5982\u4e0b\uff1a java \u4ee3\u7801\u89e3\u8bfb\u590d\u5236\u4ee3\u7801private void cancelAndClearTouchTargets(MotionEvent event) {     if (mFirstTouchTarget != null) {         boolean syntheticEvent = false;         if (event == null) {             final long now = SystemClock.uptimeMillis();             event = MotionEvent.obtain(now, now,                     MotionEvent.ACTION_CANCEL, 0.0f, 0.0f, 0);             event.setSource(InputDevice.SOURCE_TOUCHSCREEN);             syntheticEvent = true;         }</p> <pre><code>    for (TouchTarget target = mFirstTouchTarget; target != null; target = target.next) {\n        resetCancelNextUpFlag(target.child);\n        // \u5206\u53d1\u4e8b\u4ef6\u540c\u60c5\u51b5\u4e00\n        dispatchTransformedTouchEvent(event, true, target.child, target.pointerIdBits);\n    }\n    ...\n}\n</code></pre> <p>}</p> <p>PS\uff1a\u5728dispatchDetachedFromWindow()\u4e2d\u4e5f\u4f1a\u8c03\u7528cancelAndClearTouchTargets() 3\uff0c\u5728\u5b50View\u5904\u7406\u4e8b\u4ef6\u7684\u8fc7\u7a0b\u4e2d\u88ab\u4ece\u7236View\u4e2d\u79fb\u9664\u65f6 java \u4ee3\u7801\u89e3\u8bfb\u590d\u5236\u4ee3\u7801public void removeView(View view) {     if (removeViewInternal(view)) {         requestLayout();         invalidate(true);     } }</p> <p>private boolean removeViewInternal(View view) {     final int index = indexOfChild(view);     if (index &gt;= 0) {         removeViewInternal(index, view);         return true;     }     return false; }</p> <p>private void removeViewInternal(int index, View view) {</p> <pre><code>...\ncancelTouchTarget(view);\n...\n</code></pre> <p>}</p> <p>private void cancelTouchTarget(View view) {     TouchTarget predecessor = null;     TouchTarget target = mFirstTouchTarget;     while (target != null) {         final TouchTarget next = target.next;         if (target.child == view) {             ...             // \u521b\u5efaACTION_CANCEL\u4e8b\u4ef6             MotionEvent event = MotionEvent.obtain(now, now,                     MotionEvent.ACTION_CANCEL, 0.0f, 0.0f, 0);             event.setSource(InputDevice.SOURCE_TOUCHSCREEN);             \u5206\u53d1\u7ed9\u76ee\u6807view             view.dispatchTouchEvent(event);             event.recycle();             return;         }         predecessor = target;         target = next;     } }</p> <p>4\uff0c\u5b50View\u88ab\u8bbe\u7f6e\u4e86PFLAG_CANCEL_NEXT_UP_EVENT\u6807\u8bb0\u65f6 \u5728\u60c5\u51b5\u4e00\u79cd\u7684\u4e24\u4e2a\u5224\u65ad\u5904\uff1a java \u4ee3\u7801\u89e3\u8bfb\u590d\u5236\u4ee3\u7801// \u5224\u65ad\u4e00\uff1a\u6b64\u65f6cancelChild == true final boolean cancelChild = resetCancelNextUpFlag(target.child) || intercepted;</p> <p>// \u5224\u65ad\u4e8c\uff1a\u7ed9child\u53d1\u9001cancel\u4e8b\u4ef6 if (dispatchTransformedTouchEvent(ev, cancelChild,     target.child, target.pointerIdBits)) {     handled = true; }</p> <p>\u5f53resetCancelNextUpFlag(target.child)\u4e3atrue\u65f6\u540c\u6837\u4e5f\u4f1a\u5bfc\u81f4cancel\uff0c\u67e5\u770b\u4ee3\u7801\uff1a java \u4ee3\u7801\u89e3\u8bfb\u590d\u5236\u4ee3\u7801/* * Indicates whether the view is temporarily detached. * * @hide / static final int PFLAG_CANCEL_NEXT_UP_EVENT        = 0x04000000;</p> <p>private static boolean resetCancelNextUpFlag(View view) {     if ((view.mPrivateFlags &amp; PFLAG_CANCEL_NEXT_UP_EVENT) != 0) {         view.mPrivateFlags &amp;= ~PFLAG_CANCEL_NEXT_UP_EVENT;         return true;     }     return false; }</p> <p>\u6839\u636e\u6ce8\u91ca\u5927\u6982\u610f\u601d\u662f\uff0c\u8be5view\u6682\u65f6detached\uff0cdetached\u662f\u4ec0\u4e48\u610f\u601d\uff1f\u5c31\u662f\u548cattached\u76f8\u53cd\u7684\u90a3\u4e2a\uff0c\u5177\u4f53\u4ec0\u4e48\u65f6\u5019\u6253\u4e86\u8fd9\u4e2a\u6807\u8bb0\uff0c\u6211\u89c9\u5f97\u6ca1\u5fc5\u8981\u6df1\u7a76\u3002 \u4ee5\u4e0a\u56db\u79cd\u60c5\u51b5\u6700\u91cd\u8981\u7684\u5c31\u662f\u7b2c\u4e00\u79cd\uff0c\u540e\u9762\u7684\u53ea\u9700\u4e86\u89e3\u5373\u53ef\u3002 \u6ed1\u51fa\u5b50View\u533a\u57df\u4f1a\u53d1\u751f\u4ec0\u4e48\uff1f \u4e86\u89e3\u4e86\u4ec0\u4e48\u60c5\u51b5\u4e0b\u4f1a\u89e6\u53d1ACTION_CANCEL\uff0c\u90a3\u4e48\u9488\u5bf9\u95ee\u9898\uff1a\u6ed1\u51fa\u5b50View\u533a\u57df\u4f1a\u89e6\u53d1ACTION_CANCEL\u5417\uff1f\u8fd9\u4e2a\u95ee\u9898\u5c31\u5f88\u660e\u786e\u4e86\uff1a\u4e0d\u4f1a\u3002 \u5b9e\u8df5\u662f\u68c0\u9a8c\u771f\u7406\u7684\u552f\u4e00\u6807\u51c6\uff0c\u4ee3\u7801\u64b8\u8d77\u6765\uff1a java \u4ee3\u7801\u89e3\u8bfb\u590d\u5236\u4ee3\u7801public class MyButton extends androidx.appcompat.widget.AppCompatButton {</p> <pre><code>@Override\npublic boolean onTouchEvent(MotionEvent event) {\n    switch (event.getAction()) {\n        case MotionEvent.ACTION_DOWN:\n            LogUtil.d(\"ACTION_DOWN\");\n            break;\n        case MotionEvent.ACTION_MOVE:\n            LogUtil.d(\"ACTION_MOVE\");\n            break;\n        case MotionEvent.ACTION_UP:\n            LogUtil.d(\"ACTION_UP\");\n            break;\n        case MotionEvent.ACTION_CANCEL:\n            LogUtil.d(\"ACTION_CANCEL\");\n            break;\n    }\n    return super.onTouchEvent(event);\n}\n</code></pre> <p>}</p> <p>\u4e00\u6ce2\u64cd\u4f5c\u4ee5\u540e\u65e5\u5fd7\u5982\u4e0b\uff1a</p> <p>(MyButton.java:32) --&gt;ACTION_DOWN (MyButton.java:36) --&gt;ACTION_MOVE (MyButton.java:36) --&gt;ACTION_MOVE (MyButton.java:36) --&gt;ACTION_MOVE (MyButton.java:36) --&gt;ACTION_MOVE (MyButton.java:36) --&gt;ACTION_MOVE (MyButton.java:39) --&gt;ACTION_UP</p> <p>\u6ed1\u51faview\u540e\u4f9d\u7136\u53ef\u4ee5\u6536\u5230ACTION_MOVE\u548cACTION_UP\u4e8b\u4ef6\u3002 \u4e3a\u4ec0\u4e48\u6709\u4eba\u4f1a\u8ba4\u4e3a\u6ed1\u51faview\u540e\u4f1a\u6536\u5230ACTION_CANCEL\u5462\uff1f \u6211\u60f3\u662f\u56e0\u4e3a\u6ed1\u51faview\u540e\uff0cview\u7684onClick()\u4e0d\u4f1a\u89e6\u53d1\u4e86\uff0c\u6240\u4ee5\u6709\u4eba\u5c31\u4ee5\u4e3a\u662f\u89e6\u53d1\u4e86ACTION_CANCEL\u3002 \u90a3\u4e48\u4e3a\u4ec0\u4e48\u6ed1\u51faview\u540e\u4e0d\u4f1a\u89e6\u53d1onClick\u5462\uff1f\u518d\u6765\u770b\u770bView\u7684\u6e90\u7801\uff1a \u5728view\u7684onTouchEvent()\u4e2d\uff1a java \u4ee3\u7801\u89e3\u8bfb\u590d\u5236\u4ee3\u7801case MotionEvent.ACTION_MOVE:     // Be lenient about moving outside of buttons     // \u5224\u65ad\u662f\u5426\u8d85\u51faview\u7684\u8fb9\u754c     if (!pointInView(x, y, mTouchSlop)) {         // Outside button         if ((mPrivateFlags &amp; PRESSED) != 0) {             // \u8fd9\u91cc\u6539\u53d8\u72b6\u6001\u4e3a not PRESSED             // Need to switch from pressed to not pressed             mPrivateFlags &amp;= ~PRESSED;         }     }     break;</p> <p>case MotionEvent.ACTION_UP:     boolean prepressed = (mPrivateFlags &amp; PFLAG_PREPRESSED) != 0;     // \u53ef\u4ee5\u770b\u5230\u5f53move\u51faview\u8303\u56f4\u540e\uff0c\u8fd9\u91cc\u8d70\u4e0d\u8fdb\u53bb\u4e86     if ((mPrivateFlags &amp; PFLAG_PRESSED) != 0 || prepressed) {         ...         performClick();         ...     }     mIgnoreNextUpEvent = false;     break;</p> <p>1\uff0c\u5728ACTION_MOVE\u4e2d\u4f1a\u5224\u65ad\u4e8b\u4ef6\u7684\u4f4d\u7f6e\u662f\u5426\u8d85\u51faview\u7684\u8fb9\u754c\uff0c\u5982\u679c\u8d85\u51fa\u8fb9\u754c\u5219\u5c06mPrivateFlags\u7f6e\u4e3anot PRESSED\u72b6\u6001\u3002 2\uff0c\u5728ACTION_UP\u4e2d\u5224\u65ad\u53ea\u6709\u5f53mPrivateFlags\u5305\u542bPRESSED\u72b6\u6001\u65f6\u624d\u4f1a\u6267\u884cperformClick()\u7b49\u3002 \u56e0\u6b64\u6ed1\u51faview\u540e\u4e0d\u4f1a\u6267\u884conClick()\u3002 \u7ed3\u8bba\uff1a</p> <p>\u6ed1\u51faview\u8303\u56f4\u540e\uff0c\u5982\u679c\u7236view\u6ca1\u6709\u62e6\u622a\u4e8b\u4ef6\uff0c\u5219\u4f1a\u7ee7\u7eed\u53d7\u5230ACTION_MOVE\u548cACTION_UP\u7b49\u4e8b\u4ef6\u3002 \u4e00\u65e6\u6ed1\u51faview\u8303\u56f4\uff0cview\u4f1a\u88ab\u79fb\u9664PRESSED\u6807\u8bb0\uff0c\u8fd9\u4e2a\u662f\u4e0d\u53ef\u9006\u7684\uff0c\u7136\u540e\u5728ACTION_UP\u4e2d\u4e0d\u4f1a\u6267\u884cperformClick()\u7b49\u903b\u8f91\u3002</p> <p>\u4f5c\u8005\uff1agiswangsj \u94fe\u63a5\uff1ahttps://juejin.cn/post/7004794729237856287 \u6765\u6e90\uff1a\u7a00\u571f\u6398\u91d1 \u8457\u4f5c\u6743\u5f52\u4f5c\u8005\u6240\u6709\u3002\u5546\u4e1a\u8f6c\u8f7d\u8bf7\u8054\u7cfb\u4f5c\u8005\u83b7\u5f97\u6388\u6743\uff0c\u975e\u5546\u4e1a\u8f6c\u8f7d\u8bf7\u6ce8\u660e\u51fa\u5904\u3002</p>"},{"location":"030Android/010Basic/#android_3","title":"Android\u89e3\u51b3\u6ed1\u52a8\u51b2\u7a81\u7684\u65b9\u5f0f\u6709\u54ea\u4e9b","text":"\u7b54\u6848 <p>\u5728Android\u5f00\u53d1\u4e2d\uff0c\u5e38\u89c1\u7684\u6ed1\u52a8\u51b2\u7a81\u89e3\u51b3\u65b9\u5f0f\u6709\u4ee5\u4e0b\u51e0\u79cd\uff1a</p>"},{"location":"030Android/010Basic/#1_11","title":"1. \u5916\u90e8\u62e6\u622a\u6cd5","text":"<p>\u5728\u7236\u5bb9\u5668\u7684<code>onInterceptTouchEvent</code>\u65b9\u6cd5\u4e2d\u51b3\u5b9a\u662f\u5426\u62e6\u622a\u4e8b\u4ef6\u3002\u82e5\u9700\u8981\u7236\u5bb9\u5668\u5904\u7406\uff0c\u5219\u62e6\u622a\uff1b\u5426\u5219\u4e0d\u62e6\u622a\u3002</p> <p>\u5b9e\u73b0\u6b65\u9aa4\uff1a - \u91cd\u5199<code>onInterceptTouchEvent</code>\u65b9\u6cd5\u3002 - \u6839\u636e\u6761\u4ef6\u5224\u65ad\u662f\u5426\u62e6\u622a\u4e8b\u4ef6\u3002</p> <p>\u793a\u4f8b\u4ee3\u7801\uff1a <pre><code>@Override\npublic boolean onInterceptTouchEvent(MotionEvent ev) {\n    boolean intercepted = false;\n    switch (ev.getAction()) {\n        case MotionEvent.ACTION_DOWN:\n            intercepted = false;\n            break;\n        case MotionEvent.ACTION_MOVE:\n            if (\u6ee1\u8db3\u62e6\u622a\u6761\u4ef6) {\n                intercepted = true;\n            } else {\n                intercepted = false;\n            }\n            break;\n        case MotionEvent.ACTION_UP:\n            intercepted = false;\n            break;\n        default:\n            break;\n    }\n    return intercepted;\n}\n</code></pre></p>"},{"location":"030Android/010Basic/#2_8","title":"2. \u5185\u90e8\u62e6\u622a\u6cd5","text":"<p>\u5728\u5b50View\u7684<code>dispatchTouchEvent</code>\u65b9\u6cd5\u4e2d\u901a\u8fc7<code>requestDisallowInterceptTouchEvent</code>\u63a7\u5236\u7236\u5bb9\u5668\u662f\u5426\u62e6\u622a\u4e8b\u4ef6\u3002</p> <p>\u5b9e\u73b0\u6b65\u9aa4\uff1a - \u91cd\u5199\u5b50View\u7684<code>dispatchTouchEvent</code>\u65b9\u6cd5\u3002 - \u6839\u636e\u6761\u4ef6\u8c03\u7528<code>requestDisallowInterceptTouchEvent</code>\u3002</p> <p>\u793a\u4f8b\u4ee3\u7801\uff1a <pre><code>@Override\npublic boolean dispatchTouchEvent(MotionEvent event) {\n    switch (event.getAction()) {\n        case MotionEvent.ACTION_DOWN:\n            getParent().requestDisallowInterceptTouchEvent(true);\n            break;\n        case MotionEvent.ACTION_MOVE:\n            if (\u9700\u8981\u7236\u5bb9\u5668\u5904\u7406) {\n                getParent().requestDisallowInterceptTouchEvent(false);\n            }\n            break;\n        case MotionEvent.ACTION_UP:\n            break;\n        default:\n            break;\n    }\n    return super.dispatchTouchEvent(event);\n}\n</code></pre></p>"},{"location":"030Android/010Basic/#3-layout","title":"3. \u81ea\u5b9a\u4e49Layout","text":"<p>\u901a\u8fc7\u81ea\u5b9a\u4e49\u5e03\u5c40\uff0c\u91cd\u5199<code>onInterceptTouchEvent</code>\u548c<code>onTouchEvent</code>\u65b9\u6cd5\uff0c\u624b\u52a8\u5904\u7406\u4e8b\u4ef6\u5206\u53d1\u3002</p> <p>\u5b9e\u73b0\u6b65\u9aa4\uff1a - \u521b\u5efa\u81ea\u5b9a\u4e49\u5e03\u5c40\u7c7b\u3002 - \u91cd\u5199<code>onInterceptTouchEvent</code>\u548c<code>onTouchEvent</code>\u65b9\u6cd5\u3002 - \u6839\u636e\u9700\u6c42\u5904\u7406\u4e8b\u4ef6\u5206\u53d1\u903b\u8f91\u3002</p> <p>\u793a\u4f8b\u4ee3\u7801\uff1a <pre><code>public class CustomLayout extends ViewGroup {\n    // \u6784\u9020\u65b9\u6cd5\u7b49\n\n    @Override\n    public boolean onInterceptTouchEvent(MotionEvent ev) {\n        // \u62e6\u622a\u903b\u8f91\n        return super.onInterceptTouchEvent(ev);\n    }\n\n    @Override\n    public boolean onTouchEvent(MotionEvent event) {\n        // \u5904\u7406\u903b\u8f91\n        return super.onTouchEvent(event);\n    }\n}\n</code></pre></p>"},{"location":"030Android/010Basic/#4-nestedscrolling","title":"4. \u4f7f\u7528NestedScrolling\u673a\u5236","text":"<p>\u901a\u8fc7<code>NestedScrollingParent</code>\u548c<code>NestedScrollingChild</code>\u63a5\u53e3\u5904\u7406\u5d4c\u5957\u6ed1\u52a8\uff0c\u9002\u7528\u4e8e\u590d\u6742\u7684\u5d4c\u5957\u6ed1\u52a8\u573a\u666f\u3002</p> <p>\u5b9e\u73b0\u6b65\u9aa4\uff1a - \u5b9e\u73b0<code>NestedScrollingParent</code>\u548c<code>NestedScrollingChild</code>\u63a5\u53e3\u3002 - \u5728\u76f8\u5173\u65b9\u6cd5\u4e2d\u5904\u7406\u5d4c\u5957\u6ed1\u52a8\u903b\u8f91\u3002</p> <p>\u793a\u4f8b\u4ee3\u7801\uff1a <pre><code>public class NestedScrollLayout extends ViewGroup implements NestedScrollingParent {\n    // \u5b9e\u73b0NestedScrollingParent\u63a5\u53e3\u65b9\u6cd5\n}\n\npublic class NestedScrollChild extends View implements NestedScrollingChild {\n    // \u5b9e\u73b0NestedScrollingChild\u63a5\u53e3\u65b9\u6cd5\n}\n</code></pre></p>"},{"location":"030Android/010Basic/#5-viewpager2","title":"5. \u4f7f\u7528ViewPager2","text":"<p><code>ViewPager2</code>\u5185\u7f6e\u4e86\u6ed1\u52a8\u51b2\u7a81\u5904\u7406\u673a\u5236\uff0c\u9002\u5408\u5904\u7406ViewPager\u4e0eRecyclerView\u7b49\u7ec4\u4ef6\u7684\u6ed1\u52a8\u51b2\u7a81\u3002</p> <p>\u5b9e\u73b0\u6b65\u9aa4\uff1a - \u4f7f\u7528<code>ViewPager2</code>\u66ff\u4ee3<code>ViewPager</code>\u3002 - \u5728<code>ViewPager2</code>\u4e2d\u5d4c\u5957\u5176\u4ed6\u53ef\u6ed1\u52a8\u7ec4\u4ef6\u3002</p> <p>\u793a\u4f8b\u4ee3\u7801\uff1a <pre><code>ViewPager2 viewPager = findViewById(R.id.view_pager);\nviewPager.setAdapter(new MyAdapter());\n</code></pre></p>"},{"location":"030Android/010Basic/#_53","title":"\u603b\u7ed3","text":"<ul> <li>\u5916\u90e8\u62e6\u622a\u6cd5\uff1a\u5728\u7236\u5bb9\u5668\u4e2d\u62e6\u622a\u4e8b\u4ef6\u3002</li> <li>\u5185\u90e8\u62e6\u622a\u6cd5\uff1a\u5728\u5b50View\u4e2d\u63a7\u5236\u7236\u5bb9\u5668\u662f\u5426\u62e6\u622a\u3002</li> <li>\u81ea\u5b9a\u4e49Layout\uff1a\u624b\u52a8\u5904\u7406\u4e8b\u4ef6\u5206\u53d1\u3002</li> <li>NestedScrolling\u673a\u5236\uff1a\u5904\u7406\u590d\u6742\u5d4c\u5957\u6ed1\u52a8\u3002</li> <li>ViewPager2\uff1a\u5185\u7f6e\u6ed1\u52a8\u51b2\u7a81\u5904\u7406\u3002</li> </ul> <p>\u6839\u636e\u5177\u4f53\u9700\u6c42\u9009\u62e9\u5408\u9002\u7684\u89e3\u51b3\u65b9\u6848\u3002</p>"},{"location":"030Android/010Basic/#contextappcontext","title":"\u4ec0\u4e48\u662fContext\uff0c\u4e00\u4e2aApp\u6709\u51e0\u4e2aContext","text":"\u7b54\u6848 <p>\u5230\u8fd9\u91cc\uff0c\u6211\u4eec\u56de\u5f52\u5f00\u5934\u63d0\u51fa\u7684\u95ee\u9898\uff0c\u7ed3\u8bba\u662f\uff1aContext\u4e2a\u6570 = Service\u4e2a\u6570 + Activity\u4e2a\u6570 + Application\u4e2a\u6570 + ContextImpl\u4e2a\u6570\u3002 \u8003\u8651\u5230<code>Application</code>\u7b49\u4e0e<code>ContextImpl</code>\u95f4\u7684\u4ee3\u7406\u5173\u7cfb\uff0c\u4e5f\u53ef\u4ee5\u5199\u4e3a\uff1aContext \u4e2a\u6570 = 2 x\uff08Service \u4e2a\u6570 + Activity \u4e2a\u6570 + Application \u4e2a\u6570\uff09 + \u5176\u4ed6 ContextImpl \u4e2a\u6570</p> <p>Android\u5e94\u7528\u6a21\u578b\u662f\u57fa\u4e8e\u7ec4\u4ef6\u7684\u5e94\u7528\u8bbe\u8ba1\u6a21\u5f0f\uff0c\u7ec4\u4ef6\u7684\u8fd0\u884c\u8981\u6709\u4e00\u4e2a\u5b8c\u6574\u7684Android\u5de5\u7a0b\u73af\u5883\u3002\u5728\u8fd9\u4e2a\u5de5\u7a0b\u73af\u5883\u4e0b\uff0cActivity\u3001Service\u7b49\u7cfb\u7edf\u7ec4\u4ef6\u624d\u80fd\u591f\u6b63\u5e38\u5de5\u4f5c\uff0c\u800c\u8fd9\u4e9b\u7ec4\u4ef6\u5e76\u4e0d\u80fd\u91c7\u7528\u666e\u901a\u7684Java\u5bf9\u8c61\u521b\u5efa\u65b9\u5f0f\uff0cnew\u4e00\u4e0b\u5c31\u80fd\u521b\u5efa\u5b9e\u4f8b\u4e86\uff0c\u800c\u662f\u8981\u6709\u5b83\u4eec\u5404\u81ea\u7684\u4e0a\u4e0b\u6587\u73af\u5883\uff0c\u4e5f\u5c31\u662fContext\uff0cContext\u662f\u7ef4\u6301Android\u7a0b\u5e8f\u4e2d\u5404\u7ec4\u4ef6\u80fd\u591f\u6b63\u5e38\u5de5\u4f5c\u7684\u4e00\u4e2a\u6838\u5fc3\u529f\u80fd\u7c7b\u3002</p> <p>\u5982\u4f55\u751f\u52a8\u5f62\u8c61\u7684\u7406\u89e3Context\uff1f</p> <p>\u4e00\u4e2aAndroid\u7a0b\u5e8f\u53ef\u4ee5\u7406\u89e3\u4e3a\u4e00\u90e8\u7535\u5f71\uff0cActivity\u3001Service\u3001BroadcastReceiver\u548cContentProvider\u8fd9\u56db\u5927\u7ec4\u4ef6\u5c31\u597d\u6bd4\u620f\u4e86\u7684\u56db\u4e2a\u4e3b\u89d2\uff0c\u5b83\u4eec\u662f\u5267\u7ec4\uff08\u7cfb\u7edf\uff09\u4e00\u5f00\u59cb\u5b9a\u597d\u7684\uff0c\u4e3b\u89d2\u5e76\u4e0d\u662f\u5927\u8857\u4e0a\u968f\u4fbf\u62c9\u4e2a\u4eba\uff08new \u4e00\u4e2a\u5bf9\u8c61\uff09\u90fd\u80fd\u6f14\u7684\u3002\u6709\u4e86\u6f14\u5458\u5f53\u7136\u4e5f\u5f97\u6709\u6444\u50cf\u673a\u62cd\u6444\u554a\uff0c\u5b83\u4eec\u5fc5\u987b\u901a\u8fc7\u955c\u5934\uff08Context\uff09\u624d\u80fd\u5c06\u620f\u4f20\u7ed9\u89c2\u4f17\uff0c\u8fd9\u4e5f\u5c31\u6b63\u5bf9\u5e94\u8bf4\u56db\u5927\u7ec4\u4ef6\u5fc5\u987b\u5de5\u4f5c\u5728Context\u73af\u5883\u4e0b\u3002\u90a3\u4e48Button\u3001TextView\u7b49\u7b49\u63a7\u4ef6\u5c31\u76f8\u5f53\u4e8e\u7fa4\u6f14\uff0c\u663e\u7136\u6ca1\u90a3\u4e48\u91cd\u7528\uff0c\u968f\u4fbf\u4e00\u4e2a\u8def\u4eba\u7532\u90fd\u80fd\u6f14\uff08\u53ef\u4ee5new\u4e00\u4e2a\u5bf9\u8c61\uff09\uff0c\u4f46\u662f\u5b83\u4eec\u4e5f\u5fc5\u987b\u5728\u9762\u5bf9\u955c\u5934\uff08\u5de5\u4f5c\u5728Context\u73af\u5883\u4e0b\uff09\uff0c\u6240\u4ee5Button mButtom = new Button(context) \u662f\u53ef\u4ee5\u7684\u3002</p> <p>\u6e90\u7801\u4e2d\u7684Context</p> <p>public abstract class Context { } \u5b83\u662f\u4e00\u4e2a\u7eaf\u62bd\u8c61\u7c7b\uff0c\u90a3\u5c31\u770b\u770b\u5b83\u7684\u5b9e\u73b0\u7c7b\u3002</p> <p></p> <p>\u5b83\u6709\u4e24\u4e2a\u5177\u4f53\u5b9e\u73b0\u7c7b\uff1aContextImpl\u548cContextWrapper\u3002</p> <p>\u5176\u4e2dContextWrapper\u7c7b\uff0c\u662f\u4e00\u4e2a\u5305\u88c5\u7c7b\u800c\u5df2\uff0cContextWrapper\u6784\u9020\u51fd\u6570\u4e2d\u5fc5\u987b\u5305\u542b\u4e00\u4e2a\u771f\u6b63\u7684Context\u5f15\u7528\uff0c\u540c\u65f6ContextWrapper\u4e2d\u63d0\u4f9b\u4e86attachBaseContext()\u7528\u4e8e\u7ed9ContextWrapper\u5bf9\u8c61\u6307\u5b9a\u771f\u6b63\u7684Context\u5bf9\u8c61\uff0c\u8c03\u7528ContextWrapper\u7684\u65b9\u6cd5\u90fd\u4f1a\u88ab\u8f6c\u5411\u5176\u5305\u542b\u7684\u771f\u6b63\u7684Context\u5bf9\u8c61\u3002ContextThemeWrapper\u7c7b\uff0c\u5176\u5185\u90e8\u5305\u542b\u4e86\u4e0e\u4e3b\u9898Theme\u76f8\u5173\u7684\u63a5\u53e3\uff0c\u8fd9\u91cc\u6240\u8bf4\u7684\u4e3b\u9898\u5c31\u662f\u6307\u5728AndroidManifest,xml\u4e2d\u901a\u8fc7android:theme\u4e3aApplication\u5143\u7d20\u6216\u8005Activity\u5143\u7d20\u6307\u5b9a\u7684\u4e3b\u9898\u3002\u5f53\u7136\uff0c\u53ea\u6709Activity\u624d\u9700\u8981\u4e3b\u9898\uff0cService\u662f\u4e0d\u9700\u8981\u4e3b\u9898\u7684\uff0c\u6240\u4ee5Service\u76f4\u63a5\u7ee7\u627f\u4e0eContextWrapper\uff0cApplication\u540c\u7406\u3002\u800cContextImpl\u7c7b\u5219\u771f\u6b63\u5b9e\u73b0\u4e86Context\u4e2d\u7684\u6240\u6709\u51fd\u6570\uff0c\u5e94\u7528\u7a0b\u5e8f\u4e2d\u6240\u8c03\u7528\u7684\u5404\u79cdContext\u7c7b\u7684\u65b9\u6cd5\uff0c\u5176\u5b9e\u73b0\u5747\u6765\u6e90\u4e8e\u8be5\u7c7b\u3002Context\u5f97\u4e24\u4e2a\u5b50\u7c7b\u5206\u5de5\u660e\u786e\uff0c\u5176\u4e2dContextImpl\u662fContext\u7684\u5177\u4f53\u5b9e\u73b0\u7c7b\uff0cContextWrapper\u662fContext\u7684\u5305\u88c5\u7c7b\u3002 Activity\u3001Application\u3001Service\u867d\u90fd\u7ee7\u627f\u81eaContextWrapper\uff08Activity\u7ee7\u627f\u81eaContextWrapper\u7684\u5b50\u7c7bContextThemeWrapper\uff09\uff0c\u4f46\u5b83\u4eec\u521d\u59cb\u5316\u7684\u8fc7\u7a0b\u4e2d\u90fd\u4f1a\u521b\u5efaContextImpl\u5bf9\u8c61\uff0c\u7531ContextImpl\u5b9e\u73b0Context\u4e2d\u7684\u65b9\u6cd5\u3002</p> <p>\u4e00\u4e2a\u5e94\u7528\u7a0b\u5e8f\u6709\u51e0\u4e2aContext\uff1f</p> <p>\u5728\u5e94\u7528\u7a0b\u5e8f\u4e2dContext\u7684\u5177\u4f53\u5b9e\u73b0\u5b50\u7c7b\u5c31\u662f\uff1aActivity\u3001Service\u548cApplication\u3002\u90a3\u4e48Context\u6570\u91cf=Activity\u6570\u91cf+Service\u6570\u91cf+1\u3002\u90a3\u4e48\u4e3a\u4ec0\u4e48\u56db\u5927\u7ec4\u4ef6\u4e2d\u53ea\u6709Activity\u548cService\u6301\u6709Context\u5462\uff1fBroadcastReceiver\u548cContextPrivider\u5e76\u4e0d\u662fContext\u7684\u5b50\u7c7b\uff0c\u5b83\u4eec\u6240\u6301\u6709\u7684Context\u90fd\u662f\u5176\u4ed6\u5730\u65b9\u4f20\u8fc7\u53bb\u7684\uff0c\u6240\u4ee5\u5e76\u4e0d\u8ba1\u5165Context\u603b\u6570\u3002</p> <p>Context\u80fd\u5e72\u4ec0\u4e48\uff1f</p> <p>Context\u80fd\u5b9e\u73b0\u7684\u529f\u80fd\u592a\u591a\u4e86\uff0c\u5f39\u51faToast\u3001\u542f\u52a8Activity\u3001\u542f\u52a8Service\u3001\u53d1\u9001\u5e7f\u64ad\u3001\u542f\u52a8\u6570\u636e\u5e93\u7b49\u7b49\u90fd\u8981\u7528\u5230Context\u3002</p> <p>TextView tv = new TextView(getContext());</p> <p>ListAdapter adapter = new SimpleCursorAdapter(getApplicationContext(), ...);</p> <p>AudioManager am = (AudioManager) getContext().getSystemService(Context.AUDIO_SERVICE);getApplicationContext().getSharedPreferences(name, mode);</p> <p>getApplicationContext().getContentResolver().query(uri, ...);</p> <p>getContext().getResources().getDisplayMetrics().widthPixels * 5 / 8;</p> <p>getContext().startActivity(intent);</p> <p>getContext().startService(intent);</p> <p>getContext().sendBroadcast(intent); Context\u7684\u4f5c\u7528\u57df</p> <p>\u867d\u7136Context\u795e\u901a\u5e7f\u5927\uff0c\u4f46\u5e76\u4e0d\u662f\u968f\u4fbf\u62ff\u5230\u4e00\u4e2aContext\u5b9e\u4f8b\u5c31\u53ef\u4ee5\u4e3a\u6240\u6b32\u4e3a\uff0c\u5b83\u7684\u4f7f\u7528\u8fd8\u662f\u6709\u4e00\u4e9b\u89c4\u5219\u9650\u5236\u7684\u3002\u7531\u4e8eContext\u7684\u5177\u4f53\u5b9e\u4f8b\u662f\u7531ContextImpl\u7c7b\u53bb\u5b9e\u73b0\u7684\uff0c\u56e0\u6b64\u5728\u7edd\u5927\u591a\u6570\u573a\u666f\u4e0b\uff0cActivity\u3001Service\u548cApplication\u8fd9\u4e09\u79cd\u7c7b\u578b\u7684Context\u90fd\u662f\u53ef\u4ee5\u901a\u7528\u7684\u3002\u4e0d\u8fc7\u6709\u51e0\u79cd\u573a\u666f\u6bd4\u8f83\u7279\u6b8a\uff0c\u6bd4\u5982\u542f\u52a8Activity\uff0c\u8fd8\u6709\u5f39\u51faDialog\u3002\u51fa\u4e8e\u5b89\u5168\u539f\u56e0\u7684\u8003\u8651\uff0cAndroid\u662f\u4e0d\u5141\u8bb8Activity\u6216Dialog\u51ed\u7a7a\u51fa\u73b0\u7684\uff0c\u4e00\u4e2aActivity\u7684\u542f\u52a8\u5fc5\u987b\u8981\u5efa\u7acb\u5728\u53e6\u4e00\u4e2aActivity\u7684\u57fa\u7840\u4e4b\u4e0a\uff0c\u4e5f\u5c31\u662f\u4ee5\u6b64\u5f62\u6210\u8fd4\u56de\u6808\u3002\u800cDialog\u5219\u5fc5\u987b\u5728\u4e00\u4e2aActivity\u4e0a\u9762\u5f39\u51fa\uff08\u9664\u975e\u662fSystem Alert\u7c7b\u578b\u7684Dialog\uff09\uff0c\u56e0\u6b64\u5728\u8fd9\u79cd\u573a\u666f\u4e0b\uff0c\u6211\u4eec\u53ea\u80fd\u4f7f\u7528Activity\u7c7b\u578b\u7684Context\uff0c\u5426\u5219\u5c06\u4f1a\u62a5\u9519\u3002</p> <p></p> <p>\u4ece\u4e0a\u56fe\u6211\u4eec\u53ef\u4ee5\u53d1\u73b0Activity\u6240\u6301\u6709\u7684Context\u7684\u4f5c\u7528\u57df\u6700\u5e7f\uff0c\u65e0\u6240\u4e0d\u80fd\uff0c\u56e0\u6b64Activity\u7ee7\u627f\u81f3ContextThemeWrapper\uff0c\u800cApplication\u548cService\u7ee7\u627f\u81f3ContextWrapper\uff0c\u5f88\u663e\u7136ContextThemeWrapper\u5728ContextWrapper\u7684\u57fa\u7840\u4e0a\u53c8\u505a\u4e86\u4e00\u4e9b\u64cd\u4f5c\u4f7f\u5f97Activity\u53d8\u5f97\u66f4\u5f3a\u5927\u3002\u7740\u91cd\u8bb2\u4e00\u4e0b\u4e0d\u63a8\u8350\u4f7f\u7528\u7684\u4e24\u79cd\u60c5\u51b5\uff1a</p> <p>\u5982\u679c\u6211\u4eec\u7528ApplicationContext\u53bb\u542f\u52a8\u4e00\u4e2aLaunchMode\u4e3astandard\u7684Activity\u7684\u65f6\u5019\u4f1a\u62a5\u9519\uff1a</p> <p>android.util.AndroidRuntimeException: Calling startActivity from outside of an Activity context requires the FLAG_ACTIVITY_NEW_TASK flag. Is this really what you want?</p> <p>\u8fd9\u662f\u56e0\u4e3a\u975eActivity\u7c7b\u578b\u7684Context\u5e76\u6ca1\u6709\u6240\u8c13\u7684\u4efb\u52a1\u6808\uff0c\u6240\u4ee5\u5f85\u542f\u52a8\u7684Activity\u5c31\u627e\u4e0d\u5230\u6808\u4e86\u3002\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u7684\u65b9\u6cd5\u5c31\u662f\u4e3a\u5f85\u542f\u52a8\u7684Activity\u6307\u5b9aFLAG_ACTIVITY_NEW_TASK\u6807\u8bb0\u4f4d\uff0c\u8fd9\u6837\u542f\u52a8\u7684\u65f6\u5019\u5c31\u4e3a\u5b83\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u4efb\u52a1\u6808\uff0c\u800c\u6b64\u65f6Activity\u662f\u4ee5singleTask\u6a21\u5f0f\u542f\u52a8\u7684\u3002\u6240\u6709\u8fd9\u79cd\u7528Application\u542f\u52a8Activity\u7684\u65b9\u5f0f\u90fd\u4e0d\u63a8\u8350\uff0cService\u540cApplication\u3002</p> <p>\u5728Application\u548cService\u4e2d\u53bbLayoutInflate\u4e5f\u662f\u5408\u6cd5\u7684\uff0c\u4f46\u662f\u4f1a\u4f7f\u7528\u7cfb\u7edf\u9ed8\u8ba4\u7684\u4e3b\u9898\u6837\u5f0f\uff0c\u5982\u679c\u4f60\u81ea\u5b9a\u4e49\u4e86\u67d0\u4e9b\u6837\u5f0f\u53ef\u80fd\u4e0d\u4f1a\u88ab\u4f7f\u7528\uff0c\u8fd9\u79cd\u65b9\u5f0f\u4e5f\u4e0d\u63a8\u8350\u4f7f\u7528\u3002</p> <p>\u4e00\u53e5\u8bdd\u603b\u7ed3\uff1a\u51e1\u662f\u8ddfUI\u76f8\u5173\u7684\uff0c\u90fd\u5e94\u8be5\u4f7f\u7528Activity\u4f5c\u4e3aContext\u6765\u5904\u7406\uff1b\u5176\u4ed6\u7684\u4e00\u4e9b\u64cd\u4f5c\uff0cService\u3001Activity\u3001Application\u7b49\u5b9e\u4f8b\u90fd\u53ef\u4ee5\uff0c\u5f53\u7136\u4e86\u6ce8\u610fContext\u5f15\u7528\u7684\u6301\u6709\uff0c\u9632\u6b62\u5185\u5b58\u6cc4\u9732\u3002</p> <p>\u5982\u4f55\u83b7\u53d6Context\uff1f</p> <p>\u6709\u56db\u79cd\u65b9\u6cd5\uff1a</p> <p>View.getContext \u8fd4\u56de\u5f53\u524dView\u5bf9\u8c61\u7684Context\u5bf9\u8c61\uff0c\u901a\u5e38\u662f\u5f53\u524d\u6b63\u5728\u5c55\u793a\u7684Activity\u5bf9\u8c61\u3002 Activity.getApplicationContext \u83b7\u53d6\u5f53\u524dActivity\u6240\u5728\u7684\u8fdb\u7a0b\u7684Context\u5bf9\u8c61\uff0c\u901a\u5e38\u6211\u4eec\u4f7f\u7528Context\u5bf9\u8c61\u65f6\uff0c\u8981\u4f18\u5148\u8003\u8651\u8fd9\u4e2a\u5168\u5c40\u7684\u8fdb\u7a0bContext\u3002 ContextWrapper.getBaseContext() \u7528\u6765\u83b7\u53d6\u4e00\u4e2aContextWrapper\u8fdb\u884c\u88c5\u9970\u4e4b\u524d\u7684Context\uff0c\u53ef\u4ee5\u4f7f\u7528\u8fd9\u4e2a\u65b9\u6cd5\uff0c\u8fd9\u4e2a\u65b9\u6cd5\u5728\u5b9e\u9645\u5f00\u53d1\u4e2d\u4f7f\u7528\u7684\u4e0d\u591a\uff0c\u4e5f\u4e0d\u5efa\u8bae\u4f7f\u7528\u3002 Activity.this \u8fd4\u56de\u5f53\u524dActivity\u5b9e\u4f8b\uff0c\u5982\u679c\u662fUI\u63a7\u4ef6\u9700\u8981\u4f7f\u7528Activity\u4f5c\u4e3aContext\u5bf9\u8c61\uff0c\u4f46\u662f\u9ed8\u8ba4\u7684Toast\u5b9e\u9645\u4e0a\u4f7f\u7528ApplicationContext\u4e5f\u53ef\u4ee5\u3002 getApplication()\u548cgetApplicationContext()\u7684\u533a\u522b\uff1f</p> <p>\u5176\u5185\u5b58\u5730\u5740\u662f\u4e00\u6837\u7684\u3002Application\u672c\u8eab\u5c31\u662f\u4e00\u4e2aContext\uff0c\u8fd9\u91cc\u83b7\u53d6getApplicationContext\u5f97\u5230\u7684\u7ed3\u679c\u5c31\u662fApplication\u672c\u8eab\u7684\u5b9e\u4f8b\u3002getApplication\u65b9\u6cd5\u7684\u8bed\u4e49\u6027\u5f88\u5f3a\uff0c\u5c31\u662f\u7528\u6765\u83b7\u53d6Application\u5b9e\u4f8b\u7684\uff0c\u4f46\u662f\u8fd9\u4e2a\u65b9\u6cd5\u53ea\u6709\u5728Activity\u548cService\u4e2d\u624d\u80fd\u8c03\u7528\u7684\u5230\u3002\u90a3\u4e48\u4e5f\u8bb8\u5728\u7edd\u5927\u591a\u6570\u60c5\u51b5\u4e0b\u6211\u4eec\u90fd\u662f\u5728Activity\u6216\u8005Service\u4e2d\u4f7f\u7528Application\uff0c\u4f46\u662f\u5982\u679c\u5728\u4e00\u4e9b\u5176\u4ed6\u7684\u573a\u666f\uff0c\u6bd4\u5982BroadcastReceiver\u4e2d\u4e5f\u60f3\u83b7\u53d6Application\u5b9e\u4f8b\uff0c\u8fd9\u65f6\u5c31\u53ef\u4ee5\u501f\u52a9getApplicationContext\u65b9\u6cd5\u4e86\u3002</p> <p>public class MyReceiver extends BroadcastReceiver{ @Override public void onReceive(Contextcontext,Intentintent){     Application myApp= (Application)context.getApplicationContext(); } }</p>"},{"location":"030Android/010Basic/#android-view","title":"Android View\u7ed8\u5236\u539f\u7406","text":"\u7b54\u6848 <p>Android \u4e2d\u7684 View \u7ed8\u5236\u539f\u7406\u662f\u7406\u89e3 Android UI \u6e32\u67d3\u673a\u5236\u7684\u6838\u5fc3\u3002View \u7684\u7ed8\u5236\u8fc7\u7a0b\u4e3b\u8981\u5206\u4e3a\u4e09\u4e2a\u6b65\u9aa4\uff1a\u6d4b\u91cf\uff08Measure\uff09\u3001\u5e03\u5c40\uff08Layout\uff09 \u548c \u7ed8\u5236\uff08Draw\uff09\u3002\u8fd9\u4e9b\u6b65\u9aa4\u7531 ViewRootImpl \u9a71\u52a8\uff0c\u5e76\u901a\u8fc7 View \u6811\u7684\u904d\u5386\u6765\u5b8c\u6210\u3002</p>"},{"location":"030Android/010Basic/#1-measure","title":"1. \u6d4b\u91cf\uff08Measure\uff09","text":"<p>\u6d4b\u91cf\u9636\u6bb5\u7684\u4e3b\u8981\u4efb\u52a1\u662f\u786e\u5b9a\u6bcf\u4e2a View \u7684\u5927\u5c0f\u3002View \u7684\u6d4b\u91cf\u8fc7\u7a0b\u662f\u901a\u8fc7 <code>measure()</code> \u65b9\u6cd5\u6765\u5b8c\u6210\u7684\u3002</p> <ul> <li>MeasureSpec: \u6d4b\u91cf\u8fc7\u7a0b\u4e2d\u4f7f\u7528 <code>MeasureSpec</code> \u6765\u4f20\u9012\u7236 View \u5bf9\u5b50 View \u7684\u5c3a\u5bf8\u8981\u6c42\u3002<code>MeasureSpec</code> \u662f\u4e00\u4e2a 32 \u4f4d\u7684 int \u503c\uff0c\u9ad8 2 \u4f4d\u8868\u793a\u6d4b\u91cf\u6a21\u5f0f\uff0c\u4f4e 30 \u4f4d\u8868\u793a\u6d4b\u91cf\u5c3a\u5bf8\u3002</li> <li>EXACTLY: \u7236 View \u5df2\u7ecf\u786e\u5b9a\u4e86\u5b50 View \u7684\u7cbe\u786e\u5c3a\u5bf8\u3002</li> <li>AT_MOST: \u5b50 View \u7684\u5c3a\u5bf8\u4e0d\u80fd\u8d85\u8fc7\u6307\u5b9a\u7684\u6700\u5927\u503c\u3002</li> <li> <p>UNSPECIFIED: \u7236 View \u6ca1\u6709\u5bf9\u5b50 View \u65bd\u52a0\u4efb\u4f55\u9650\u5236\uff0c\u5b50 View \u53ef\u4ee5\u4efb\u610f\u5927\u5c0f\u3002</p> </li> <li> <p>onMeasure(): \u6bcf\u4e2a View \u90fd\u9700\u8981\u5b9e\u73b0 <code>onMeasure()</code> \u65b9\u6cd5\uff0c\u6839\u636e\u7236 View \u4f20\u9012\u7684 <code>MeasureSpec</code> \u6765\u8ba1\u7b97\u81ea\u5df1\u7684\u5c3a\u5bf8\u3002\u901a\u5e38\uff0cView \u4f1a\u6839\u636e\u81ea\u8eab\u7684\u5e03\u5c40\u53c2\u6570\uff08\u5982 <code>wrap_content</code> \u6216 <code>match_parent</code>\uff09\u6765\u51b3\u5b9a\u6700\u7ec8\u7684\u5c3a\u5bf8\u3002</p> </li> </ul>"},{"location":"030Android/010Basic/#2-layout","title":"2. \u5e03\u5c40\uff08Layout\uff09","text":"<p>\u5e03\u5c40\u9636\u6bb5\u7684\u4e3b\u8981\u4efb\u52a1\u662f\u786e\u5b9a\u6bcf\u4e2a View \u5728\u5c4f\u5e55\u4e0a\u7684\u4f4d\u7f6e\u3002\u5e03\u5c40\u8fc7\u7a0b\u662f\u901a\u8fc7 <code>layout()</code> \u65b9\u6cd5\u6765\u5b8c\u6210\u7684\u3002</p> <ul> <li>onLayout(): \u5728 <code>layout()</code> \u65b9\u6cd5\u4e2d\uff0cView \u4f1a\u8c03\u7528 <code>onLayout()</code> \u65b9\u6cd5\u6765\u786e\u5b9a\u5b50 View \u7684\u4f4d\u7f6e\u3002\u5bf9\u4e8e ViewGroup \u6765\u8bf4\uff0c\u5b83\u9700\u8981\u904d\u5386\u6240\u6709\u7684\u5b50 View\uff0c\u5e76\u6839\u636e\u5e03\u5c40\u89c4\u5219\uff08\u5982 LinearLayout\u3001RelativeLayout \u7b49\uff09\u6765\u8bbe\u7f6e\u6bcf\u4e2a\u5b50 View \u7684\u4f4d\u7f6e\u3002</li> </ul>"},{"location":"030Android/010Basic/#3-draw","title":"3. \u7ed8\u5236\uff08Draw\uff09","text":"<p>\u7ed8\u5236\u9636\u6bb5\u7684\u4e3b\u8981\u4efb\u52a1\u662f\u5c06 View \u7684\u5185\u5bb9\u7ed8\u5236\u5230\u5c4f\u5e55\u4e0a\u3002\u7ed8\u5236\u8fc7\u7a0b\u662f\u901a\u8fc7 <code>draw()</code> \u65b9\u6cd5\u6765\u5b8c\u6210\u7684\u3002</p> <ul> <li>onDraw(): \u5728 <code>draw()</code> \u65b9\u6cd5\u4e2d\uff0cView \u4f1a\u8c03\u7528 <code>onDraw()</code> \u65b9\u6cd5\u6765\u7ed8\u5236\u81ea\u5df1\u7684\u5185\u5bb9\u3002\u5f00\u53d1\u8005\u53ef\u4ee5\u91cd\u5199 <code>onDraw()</code> \u65b9\u6cd5\u6765\u81ea\u5b9a\u4e49 View \u7684\u7ed8\u5236\u884c\u4e3a\u3002</li> <li>\u7ed8\u5236\u987a\u5e8f: View \u7684\u7ed8\u5236\u987a\u5e8f\u9075\u5faa\u4ee5\u4e0b\u6b65\u9aa4\uff1a</li> <li>\u7ed8\u5236\u80cc\u666f\uff08<code>drawBackground()</code>\uff09</li> <li>\u7ed8\u5236\u5185\u5bb9\uff08<code>onDraw()</code>\uff09</li> <li>\u7ed8\u5236\u5b50 View\uff08<code>dispatchDraw()</code>\uff09</li> <li>\u7ed8\u5236\u88c5\u9970\uff08\u5982\u6eda\u52a8\u6761\u3001\u524d\u666f\u7b49\uff09</li> </ul>"},{"location":"030Android/010Basic/#view","title":"View \u6811\u7684\u904d\u5386","text":"<p>View \u7684\u7ed8\u5236\u8fc7\u7a0b\u662f\u901a\u8fc7 View \u6811\u7684\u904d\u5386\u6765\u5b8c\u6210\u7684\u3002ViewRootImpl \u4f1a\u4ece\u6839 View \u5f00\u59cb\uff0c\u4f9d\u6b21\u904d\u5386\u6574\u4e2a View \u6811\uff0c\u6267\u884c\u6d4b\u91cf\u3001\u5e03\u5c40\u548c\u7ed8\u5236\u64cd\u4f5c\u3002</p> <ul> <li>ViewRootImpl: \u662f\u8fde\u63a5 WindowManager \u548c View \u7cfb\u7edf\u7684\u6865\u6881\u3002\u5b83\u8d1f\u8d23\u7ba1\u7406 View \u6811\u7684\u7ed8\u5236\u8fc7\u7a0b\uff0c\u5e76\u4e0e SurfaceFlinger \u4ea4\u4e92\uff0c\u5c06\u6700\u7ec8\u7684\u7ed8\u5236\u5185\u5bb9\u663e\u793a\u5230\u5c4f\u5e55\u4e0a\u3002</li> <li>Choreographer: \u8d1f\u8d23\u534f\u8c03 UI \u7684\u7ed8\u5236\u3001\u52a8\u753b\u548c\u8f93\u5165\u4e8b\u4ef6\u3002\u5b83\u901a\u8fc7 VSYNC \u4fe1\u53f7\u6765\u540c\u6b65 UI \u7684\u5237\u65b0\uff0c\u786e\u4fdd\u7ed8\u5236\u7684\u6d41\u7545\u6027\u3002</li> </ul>"},{"location":"030Android/010Basic/#_54","title":"\u53cc\u7f13\u51b2\u673a\u5236","text":"<p>\u4e3a\u4e86\u51cf\u5c11\u7ed8\u5236\u65f6\u7684\u95ea\u70c1\u548c\u63d0\u9ad8\u6027\u80fd\uff0cAndroid \u4f7f\u7528\u4e86\u53cc\u7f13\u51b2\u673a\u5236\u3002\u6bcf\u4e2a Surface \u90fd\u6709\u4e00\u4e2a\u524d\u7aef\u7f13\u51b2\u533a\u548c\u4e00\u4e2a\u540e\u7aef\u7f13\u51b2\u533a\u3002\u5f53 View \u8fdb\u884c\u7ed8\u5236\u65f6\uff0c\u5185\u5bb9\u4f1a\u88ab\u7ed8\u5236\u5230\u540e\u7aef\u7f13\u51b2\u533a\uff0c\u7ed8\u5236\u5b8c\u6210\u540e\uff0c\u540e\u7aef\u7f13\u51b2\u533a\u4f1a\u4e0e\u524d\u7aef\u7f13\u51b2\u533a\u4ea4\u6362\uff0c\u663e\u793a\u5230\u5c4f\u5e55\u4e0a\u3002</p>"},{"location":"030Android/010Basic/#_55","title":"\u786c\u4ef6\u52a0\u901f","text":"<p>Android 4.0 \u5f15\u5165\u4e86\u786c\u4ef6\u52a0\u901f\uff0c\u901a\u8fc7 GPU \u6765\u52a0\u901f View \u7684\u7ed8\u5236\u8fc7\u7a0b\u3002\u786c\u4ef6\u52a0\u901f\u53ef\u4ee5\u663e\u8457\u63d0\u9ad8\u7ed8\u5236\u7684\u6027\u80fd\uff0c\u5c24\u5176\u662f\u5728\u5904\u7406\u590d\u6742\u7684\u52a8\u753b\u548c\u56fe\u5f62\u65f6\u3002</p>"},{"location":"030Android/010Basic/#_56","title":"\u603b\u7ed3","text":"<p>Android View \u7684\u7ed8\u5236\u539f\u7406\u6d89\u53ca\u6d4b\u91cf\u3001\u5e03\u5c40\u548c\u7ed8\u5236\u4e09\u4e2a\u4e3b\u8981\u6b65\u9aa4\uff0c\u6574\u4e2a\u8fc7\u7a0b\u7531 ViewRootImpl \u9a71\u52a8\uff0c\u5e76\u901a\u8fc7 View \u6811\u7684\u904d\u5386\u6765\u5b8c\u6210\u3002\u7406\u89e3\u8fd9\u4e9b\u539f\u7406\u6709\u52a9\u4e8e\u5f00\u53d1\u8005\u4f18\u5316 UI \u6027\u80fd\uff0c\u5e76\u5b9e\u73b0\u81ea\u5b9a\u4e49\u7684 View \u548c\u52a8\u753b\u6548\u679c\u3002</p>"},{"location":"030Android/010Basic/#view_1","title":"View\u7684\u7ed8\u5236\u6d41\u7a0b","text":"<p>\u89c6\u56fe\u7ed8\u5236\u7684\u8d77\u70b9\u5728 ViewRootImpl \u7c7b\u7684 performTraversals()\u65b9\u6cd5\uff0c\u5728\u8fd9\u4e2a\u65b9\u6cd5\u5185\u5176\u5b9e\u662f\u6309\u7167\u987a\u5e8f\u4f9d\u6b21\u8c03\u7528\u4e86 mView.measure()\u3001mView.layout()\u3001mView.draw()</p> <p>View\u7684\u7ed8\u5236\u6d41\u7a0b\u5206\u4e3a3\u6b65\uff1a\u6d4b\u91cf\u3001\u5e03\u5c40\u3001\u7ed8\u5236\uff0c\u5206\u522b\u5bf9\u5e943\u4e2a\u65b9\u6cd5 measure\u3001layout\u3001draw\u3002</p> <p>\u6d4b\u91cf\u9636\u6bb5\u3002 measure \u65b9\u6cd5\u4f1a\u88ab\u7236 View \u8c03\u7528\uff0c\u5728measure \u65b9\u6cd5\u4e2d\u505a\u4e00\u4e9b\u4f18\u5316\u548c\u51c6\u5907\u5de5\u4f5c\u540e\u4f1a\u8c03\u7528 onMeasure \u65b9\u6cd5\u8fdb\u884c\u5b9e\u9645\u7684\u81ea\u6211\u6d4b\u91cf\u3002onMeasure\u65b9\u6cd5\u5728View\u548cViewGroup\u505a\u7684\u4e8b\u60c5\u662f\u4e0d\u4e00\u6837\u7684\uff1a</p> <pre><code>View\u3002 View \u4e2d\u7684 onMeasure \u65b9\u6cd5\u4f1a\u8ba1\u7b97\u81ea\u5df1\u7684\u5c3a\u5bf8\u5e76\u901a\u8fc7 setMeasureDimension \u4fdd\u5b58\u3002\n\nViewGroup\u3002 ViewGroup \u4e2d\u7684 onMeasure \u65b9\u6cd5\u4f1a\u8c03\u7528\u6240\u6709\u5b50 iew\u7684measure \u65b9\u6cd5\u8fdb\u884c\u81ea\u6211\u6d4b\u91cf\u5e76\u4fdd\u5b58\u3002\u7136\u540e\u901a\u8fc7\u5b50View\u7684\u5c3a\u5bf8\u548c\u4f4d\u7f6e\u8ba1\u7b97\u51fa\u81ea\u5df1\u7684\u5c3a\u5bf8\u5e76\u4fdd\u5b58\u3002\n</code></pre> <p>\u5e03\u5c40\u9636\u6bb5\u3002 layout \u65b9\u6cd5\u4f1a\u88ab\u7236View\u8c03\u7528\uff0clayout \u65b9\u6cd5\u4f1a\u4fdd\u5b58\u7236 View \u4f20\u8fdb\u6765\u7684\u5c3a\u5bf8\u548c\u4f4d\u7f6e\uff0c\u5e76\u8c03\u7528 onLayout \u8fdb\u884c\u5b9e\u9645\u7684\u5185\u90e8\u5e03\u5c40\u3002onLayout \u5728 View \u548c ViewGroup \u4e2d\u505a\u7684\u4e8b\u60c5\u4e5f\u662f\u4e0d\u4e00\u6837\u7684\uff1a</p> <pre><code>View\u3002 \u56e0\u4e3a View \u662f\u6ca1\u6709\u5b50 View \u7684\uff0c\u6240\u4ee5View\u7684onLayout\u91cc\u9762\u4ec0\u4e48\u90fd\u4e0d\u505a\u3002\n\nViewGroup\u3002 ViewGroup \u4e2d\u7684 onLayout \u65b9\u6cd5\u4f1a\u8c03\u7528\u6240\u6709\u5b50 View \u7684 layout \u65b9\u6cd5\uff0c\u628a\u5c3a\u5bf8\u548c\u4f4d\u7f6e\u4f20\u7ed9\u4ed6\u4eec\uff0c\u8ba9\u4ed6\u4eec\u5b8c\u6210\u81ea\u6211\u7684\u5185\u90e8\u5e03\u5c40\u3002\n</code></pre> <p>\u7ed8\u5236\u9636\u6bb5\u3002 draw \u65b9\u6cd5\u4f1a\u505a\u4e00\u4e9b\u8c03\u5ea6\u5de5\u4f5c\uff0c\u7136\u540e\u4f1a\u8c03\u7528 onDraw \u65b9\u6cd5\u8fdb\u884c View \u7684\u81ea\u6211\u7ed8\u5236\u3002draw \u65b9\u6cd5\u7684\u8c03\u5ea6\u6d41\u7a0b\u5927\u81f4\u662f\u8fd9\u6837\u7684\uff1a</p> <pre><code>\u7ed8\u5236\u80cc\u666f\u3002 \u5bf9\u5e94 drawBackground(Canvas)\u65b9\u6cd5\u3002\n\n\u7ed8\u5236\u4e3b\u4f53\u3002 \u5bf9\u5e94 onDraw(Canvas)\u65b9\u6cd5\u3002\n\n\u7ed8\u5236\u5b50View\u3002 \u5bf9\u5e94 dispatchDraw(Canvas)\u65b9\u6cd5\u3002\n\n\u7ed8\u5236\u6ed1\u52a8\u76f8\u5173\u548c\u524d\u666f\u3002 \u5bf9\u5e94 onDrawForeground(Canvas)\u3002\n</code></pre>"},{"location":"030Android/010Basic/#android-viewtextviewsettext","title":"Android View\u7ed8\u5236\u6d41\u7a0b\uff0c\u5f53\u4e00\u4e2aTextView\u7684\u5b9e\u4f8b\u8c03\u7528setText()\u65b9\u6cd5\u540e\u6267\u884c\u4e86\u4ec0\u4e48","text":"\u7b54\u6848 <p>\u5f53\u4e00\u4e2a <code>TextView</code> \u5b9e\u4f8b\u8c03\u7528 <code>setText()</code> \u65b9\u6cd5\u540e\uff0c\u4f1a\u89e6\u53d1\u4e00\u7cfb\u5217\u7684\u6d41\u7a0b\u6765\u66f4\u65b0 UI \u5e76\u6700\u7ec8\u5c06\u65b0\u7684\u6587\u672c\u5185\u5bb9\u663e\u793a\u5728\u5c4f\u5e55\u4e0a\u3002\u4ee5\u4e0b\u662f\u8be6\u7ec6\u7684\u6267\u884c\u8fc7\u7a0b\uff1a</p>"},{"location":"030Android/010Basic/#1-settext","title":"1. <code>setText()</code> \u65b9\u6cd5\u8c03\u7528","text":"<ul> <li><code>setText()</code> \u662f <code>TextView</code> \u7684\u65b9\u6cd5\uff0c\u7528\u4e8e\u8bbe\u7f6e\u663e\u793a\u7684\u6587\u672c\u5185\u5bb9\u3002</li> <li>\u8be5\u65b9\u6cd5\u4f1a\u66f4\u65b0 <code>TextView</code> \u7684\u5185\u90e8\u72b6\u6001\uff08\u5982 <code>mText</code> \u53d8\u91cf\uff09\uff0c\u5e76\u6807\u8bb0\u5f53\u524d View \u9700\u8981\u91cd\u65b0\u6d4b\u91cf\u548c\u7ed8\u5236\u3002</li> </ul>"},{"location":"030Android/010Basic/#2-requestlayout","title":"2. \u89e6\u53d1 <code>requestLayout()</code>","text":"<ul> <li>\u5728 <code>setText()</code> \u65b9\u6cd5\u5185\u90e8\uff0c\u5982\u679c\u6587\u672c\u5185\u5bb9\u53d1\u751f\u53d8\u5316\uff0c<code>TextView</code> \u4f1a\u8c03\u7528 <code>requestLayout()</code> \u65b9\u6cd5\u3002</li> <li><code>requestLayout()</code> \u7684\u4f5c\u7528\u662f\u901a\u77e5 View \u7cfb\u7edf\u5f53\u524d View \u7684\u5c3a\u5bf8\u53ef\u80fd\u53d1\u751f\u4e86\u53d8\u5316\uff0c\u9700\u8981\u91cd\u65b0\u6d4b\u91cf\u548c\u5e03\u5c40\u3002</li> </ul>"},{"location":"030Android/010Basic/#3-invalidate","title":"3. \u89e6\u53d1 <code>invalidate()</code>","text":"<ul> <li>\u9664\u4e86\u8c03\u7528 <code>requestLayout()</code>\uff0c<code>setText()</code> \u8fd8\u4f1a\u8c03\u7528 <code>invalidate()</code> \u65b9\u6cd5\u3002</li> <li><code>invalidate()</code> \u7684\u4f5c\u7528\u662f\u6807\u8bb0\u5f53\u524d View \u7684\u5185\u5bb9\u5df2\u7ecf\u5931\u6548\uff0c\u9700\u8981\u91cd\u65b0\u7ed8\u5236\u3002</li> </ul>"},{"location":"030Android/010Basic/#4-viewrootimpl","title":"4. ViewRootImpl \u7684\u8c03\u5ea6","text":"<ul> <li><code>requestLayout()</code> \u548c <code>invalidate()</code> \u7684\u8c03\u7528\u4f1a\u89e6\u53d1 <code>ViewRootImpl</code> \u7684\u8c03\u5ea6\u3002</li> <li><code>ViewRootImpl</code> \u662f\u8fde\u63a5 WindowManager \u548c View \u7cfb\u7edf\u7684\u6865\u6881\uff0c\u8d1f\u8d23\u7ba1\u7406 View \u6811\u7684\u6d4b\u91cf\u3001\u5e03\u5c40\u548c\u7ed8\u5236\u3002</li> </ul>"},{"location":"030Android/010Basic/#5-measure","title":"5. \u6d4b\u91cf\uff08Measure\uff09","text":"<ul> <li><code>ViewRootImpl</code> \u4f1a\u4ece\u6839 View \u5f00\u59cb\uff0c\u904d\u5386\u6574\u4e2a View \u6811\uff0c\u6267\u884c\u6d4b\u91cf\u64cd\u4f5c\u3002</li> <li>\u5bf9\u4e8e <code>TextView</code>\uff0c\u6d4b\u91cf\u8fc7\u7a0b\u4f1a\u8ba1\u7b97\u6587\u672c\u7684\u5bbd\u5ea6\u548c\u9ad8\u5ea6\uff0c\u8003\u8651\u5b57\u4f53\u5927\u5c0f\u3001\u884c\u95f4\u8ddd\u3001Padding \u7b49\u56e0\u7d20\u3002</li> <li>\u6d4b\u91cf\u7ed3\u679c\u4f1a\u4fdd\u5b58\u5728 <code>TextView</code> \u7684 <code>mMeasuredWidth</code> \u548c <code>mMeasuredHeight</code> \u4e2d\u3002</li> </ul>"},{"location":"030Android/010Basic/#6-layout","title":"6. \u5e03\u5c40\uff08Layout\uff09","text":"<ul> <li>\u6d4b\u91cf\u5b8c\u6210\u540e\uff0c<code>ViewRootImpl</code> \u4f1a\u6267\u884c\u5e03\u5c40\u64cd\u4f5c\u3002</li> <li>\u5e03\u5c40\u8fc7\u7a0b\u4f1a\u786e\u5b9a <code>TextView</code> \u5728\u7236\u5bb9\u5668\u4e2d\u7684\u4f4d\u7f6e\uff08\u901a\u8fc7 <code>layout()</code> \u65b9\u6cd5\uff09\u3002</li> <li>\u5982\u679c <code>TextView</code> \u7684\u5c3a\u5bf8\u6216\u4f4d\u7f6e\u53d1\u751f\u4e86\u53d8\u5316\uff0c\u7236\u5bb9\u5668\u4f1a\u91cd\u65b0\u8c03\u6574\u5b50 View \u7684\u5e03\u5c40\u3002</li> </ul>"},{"location":"030Android/010Basic/#7-draw","title":"7. \u7ed8\u5236\uff08Draw\uff09","text":"<ul> <li>\u5e03\u5c40\u5b8c\u6210\u540e\uff0c<code>ViewRootImpl</code> \u4f1a\u6267\u884c\u7ed8\u5236\u64cd\u4f5c\u3002</li> <li><code>TextView</code> \u7684 <code>onDraw()</code> \u65b9\u6cd5\u4f1a\u88ab\u8c03\u7528\uff0c\u5c06\u6587\u672c\u5185\u5bb9\u7ed8\u5236\u5230 Canvas \u4e0a\u3002</li> <li>\u7ed8\u5236\u8fc7\u7a0b\u5305\u62ec\uff1a<ol> <li>\u7ed8\u5236\u80cc\u666f\uff08\u5982\u679c\u6709\uff09\u3002</li> <li>\u7ed8\u5236\u6587\u672c\u5185\u5bb9\uff08\u901a\u8fc7 <code>TextLayout</code> \u6216 <code>StaticLayout</code> \u8ba1\u7b97\u6587\u672c\u7684\u5e03\u5c40\u548c\u6e32\u67d3\uff09\u3002</li> <li>\u7ed8\u5236\u5176\u4ed6\u88c5\u9970\uff08\u5982\u5149\u6807\u3001\u9ad8\u4eae\u7b49\uff09\u3002</li> </ol> </li> </ul>"},{"location":"030Android/010Basic/#8","title":"8. \u540c\u6b65\u5230\u5c4f\u5e55","text":"<ul> <li>\u7ed8\u5236\u5b8c\u6210\u540e\uff0c<code>ViewRootImpl</code> \u4f1a\u5c06\u7ed8\u5236\u7ed3\u679c\u63d0\u4ea4\u5230 SurfaceFlinger\u3002</li> <li>SurfaceFlinger \u8d1f\u8d23\u5c06\u591a\u4e2a Surface \u5408\u6210\uff0c\u5e76\u6700\u7ec8\u663e\u793a\u5230\u5c4f\u5e55\u4e0a\u3002</li> </ul>"},{"location":"030Android/010Basic/#9_1","title":"9. \u786c\u4ef6\u52a0\u901f\uff08\u5982\u679c\u542f\u7528\uff09","text":"<ul> <li>\u5982\u679c\u786c\u4ef6\u52a0\u901f\u5df2\u542f\u7528\uff0c<code>TextView</code> \u7684\u7ed8\u5236\u4f1a\u901a\u8fc7 GPU \u52a0\u901f\u3002</li> <li>\u6587\u672c\u7684\u7ed8\u5236\u4f1a\u4f7f\u7528 OpenGL \u6216 Vulkan \u8fdb\u884c\u6e32\u67d3\uff0c\u4ee5\u63d0\u9ad8\u6027\u80fd\u3002</li> </ul>"},{"location":"030Android/010Basic/#_57","title":"\u603b\u7ed3","text":"<p>\u8c03\u7528 <code>TextView</code> \u7684 <code>setText()</code> \u65b9\u6cd5\u540e\uff0c\u4f1a\u89e6\u53d1\u4ee5\u4e0b\u6d41\u7a0b\uff1a 1. \u66f4\u65b0\u6587\u672c\u5185\u5bb9\u3002 2. \u8c03\u7528 <code>requestLayout()</code> \u548c <code>invalidate()</code>\uff0c\u6807\u8bb0 View \u9700\u8981\u91cd\u65b0\u6d4b\u91cf\u3001\u5e03\u5c40\u548c\u7ed8\u5236\u3002 3. <code>ViewRootImpl</code> \u8c03\u5ea6\u6d4b\u91cf\u3001\u5e03\u5c40\u548c\u7ed8\u5236\u6d41\u7a0b\u3002 4. <code>TextView</code> \u91cd\u65b0\u6d4b\u91cf\u6587\u672c\u5c3a\u5bf8\uff0c\u786e\u5b9a\u5e03\u5c40\u4f4d\u7f6e\uff0c\u5e76\u7ed8\u5236\u6587\u672c\u5185\u5bb9\u3002 5. \u6700\u7ec8\u7ed3\u679c\u901a\u8fc7 SurfaceFlinger \u663e\u793a\u5230\u5c4f\u5e55\u4e0a\u3002</p> <p>\u8fd9\u4e2a\u8fc7\u7a0b\u786e\u4fdd\u4e86 <code>TextView</code> \u7684\u5185\u5bb9\u80fd\u591f\u6b63\u786e\u66f4\u65b0\u5e76\u663e\u793a\u5728\u5c4f\u5e55\u4e0a\u3002</p>"},{"location":"030Android/010Basic/#activity-window-view","title":"Activity window view\u4e09\u8005\u7684\u5173\u7cfb","text":"\u7b54\u6848 <p>\u5728Android\u5f00\u53d1\u4e2d\uff0cActivity\u3001Window\u548cView\u662f\u4e09\u4e2a\u6838\u5fc3\u7ec4\u4ef6\uff0c\u5b83\u4eec\u4e4b\u95f4\u7684\u5173\u7cfb\u5982\u4e0b\uff1a</p>"},{"location":"030Android/010Basic/#1-activity_1","title":"1. Activity","text":"<ul> <li>Activity\u662fAndroid\u5e94\u7528\u7684\u57fa\u672c\u7ec4\u4ef6\uff0c\u4ee3\u8868\u4e00\u4e2a\u7528\u6237\u754c\u9762\uff08UI\uff09\u5c4f\u5e55\u3002</li> <li>\u5b83\u8d1f\u8d23\u7ba1\u7406\u5e94\u7528\u7684\u751f\u547d\u5468\u671f\u548c\u7528\u6237\u4ea4\u4e92\u3002</li> <li>\u6bcf\u4e2aActivity\u90fd\u5305\u542b\u4e00\u4e2aWindow\u5bf9\u8c61\uff0c\u7528\u4e8e\u7ba1\u7406UI\u7684\u663e\u793a\u3002</li> </ul>"},{"location":"030Android/010Basic/#2-window","title":"2. Window","text":"<ul> <li>Window\u662f\u4e00\u4e2a\u62bd\u8c61\u7c7b\uff0c\u4ee3\u8868Activity\u7684\u7a97\u53e3\uff0c\u8d1f\u8d23\u7ba1\u7406UI\u7684\u663e\u793a\u548c\u5e03\u5c40\u3002</li> <li>\u6bcf\u4e2aActivity\u90fd\u6709\u4e00\u4e2a\u5bf9\u5e94\u7684Window\u5bf9\u8c61\uff0c\u901a\u5e38\u7531PhoneWindow\u5b9e\u73b0\u3002</li> <li>Window\u5185\u90e8\u5305\u542b\u4e00\u4e2aDecorView\uff0c\u5b83\u662f\u6574\u4e2a\u89c6\u56fe\u6811\u7684\u6839\u3002</li> </ul>"},{"location":"030Android/010Basic/#3-view","title":"3. View","text":"<ul> <li>View\u662fUI\u7684\u57fa\u672c\u5355\u5143\uff0c\u8d1f\u8d23\u7ed8\u5236\u548c\u4e8b\u4ef6\u5904\u7406\u3002</li> <li>ViewGroup\u662fView\u7684\u5b50\u7c7b\uff0c\u7528\u4e8e\u7ba1\u7406\u5b50\u89c6\u56fe\u7684\u5e03\u5c40\u3002</li> <li>\u6240\u6709UI\u7ec4\u4ef6\uff08\u5982\u6309\u94ae\u3001\u6587\u672c\u6846\uff09\u90fd\u662fView\u6216\u5176\u5b50\u7c7b\u3002</li> </ul>"},{"location":"030Android/010Basic/#_58","title":"\u4e09\u8005\u5173\u7cfb","text":"<ul> <li>Activity\u5305\u542b\u4e00\u4e2aWindow\u5bf9\u8c61\u3002</li> <li>Window\u5305\u542b\u4e00\u4e2aDecorView\uff0c\u5b83\u662f\u89c6\u56fe\u6811\u7684\u6839\u3002</li> <li>DecorView\u5305\u542b\u5e94\u7528\u7684\u5b9e\u9645UI\u5185\u5bb9\uff0c\u7531\u591a\u4e2aView\u548cViewGroup\u7ec4\u6210\u3002</li> </ul>"},{"location":"030Android/010Basic/#_59","title":"\u5de5\u4f5c\u6d41\u7a0b","text":"<ol> <li>Activity\u521b\u5efa\u65f6\uff0c\u4f1a\u521d\u59cb\u5316\u4e00\u4e2aWindow\u5bf9\u8c61\u3002</li> <li>Window\u52a0\u8f7dDecorView\uff0c\u5e76\u5c06\u5176\u6dfb\u52a0\u5230\u5c4f\u5e55\u4e0a\u3002</li> <li>DecorView\u5305\u542b\u5e94\u7528\u7684UI\u5e03\u5c40\uff0c\u7531\u591a\u4e2aView\u548cViewGroup\u6784\u6210\u3002</li> <li>\u7528\u6237\u4e0eUI\u4ea4\u4e92\u65f6\uff0c\u4e8b\u4ef6\u901a\u8fc7View\u4f20\u9012\u5230Activity\u5904\u7406\u3002</li> </ol>"},{"location":"030Android/010Basic/#_60","title":"\u603b\u7ed3","text":"<ul> <li>Activity\u7ba1\u7406\u5e94\u7528\u7684\u751f\u547d\u5468\u671f\u548c\u7528\u6237\u4ea4\u4e92\u3002</li> <li>Window\u7ba1\u7406UI\u7684\u663e\u793a\u548c\u5e03\u5c40\u3002</li> <li>View\u8d1f\u8d23\u5177\u4f53\u7684UI\u7ed8\u5236\u548c\u4e8b\u4ef6\u5904\u7406\u3002</li> </ul> <p>\u5b83\u4eec\u5171\u540c\u534f\u4f5c\uff0c\u6784\u5efa\u5e76\u7ba1\u7406Android\u5e94\u7528\u7684\u754c\u9762\u3002</p>"},{"location":"030Android/010Basic/#windowactivitydecorviewviewroot","title":"Window\u3001Activity\u3001DecorView\u4ee5\u53caViewRoot\u4e4b\u95f4\u7684\u5173\u7cfb","text":"\u7b54\u6848"},{"location":"030Android/010Basic/#_61","title":"\u804c\u80fd\u7b80\u4ecb","text":"<p>Activity</p> <p>Activity\u5e76\u4e0d\u8d1f\u8005\u89c6\u56fe\u63a7\u5236\uff0c\u5b83\u53ea\u662f\u63a7\u5236\u751f\u547d\u5468\u671f\u548c\u5904\u7406\u4e8b\u4ef6\u3002\u771f\u6b63\u63a7\u5236\u89c6\u56fe\u7684\u662fWindow\u3002\u4e00\u4e2aActivity\u5305\u542b\u4e86\u4e00\u4e2aWindow\uff0cWindow\u624d\u662f\u771f\u6b63\u4ee3\u8868\u4e00\u4e2a\u7a97\u53e3\u3002Activity\u5c31\u50cf\u4e00\u4e2a\u63a7\u5236\u5668\uff0c\u7edf\u7b79\u89c6\u56fe\u7684\u6dfb\u52a0\u4e0e\u663e\u793a\uff0c\u4ee5\u53ca\u901a\u8fc7\u5176\u4ed6\u56de\u8c03\u65b9\u6cd5\uff0c\u6765\u4e0eWindow\u4ee5\u53caView\u8fdb\u884c\u4ea4\u4e92\u3002</p> <p>Window</p> <p>Window\u662f\u89c6\u56fe\u7684\u627f\u8f7d\u5668\uff0c\u5185\u90e8\u6301\u6709\u4e00\u4e2aDecorView\uff0c\u800c\u8fd9\u4e2aDecorView\u624d\u662fview\u7684\u8ddf\u5e03\u5c40\u3002Window\u662f\u4e00\u4e2a\u62bd\u8c61\u7c7b\uff0c\u5b9e\u9645\u5728Activity\u4e2d\u6301\u6709\u7684\u662f\u5176\u5b50\u7c7bPhoneWindow\u3002PhoneWindow\u4e2d\u6709\u4e2a\u5185\u90e8\u7c7bDecorView\uff0c\u901a\u8fc7\u521b\u5efaDecorView\u6765\u52a0\u8f7dActivity\u4e2d\u8bbe\u7f6e\u7684\u5e03\u5c40\u3002Window\u901a\u8fc7WindowManager\u5c06DecorView\u52a0\u8f7d\u5176\u4e2d\uff0c\u5e76\u5c06DecorView\u4ea4\u7ed9ViewRoot\uff0c\u8fdb\u884c\u89c6\u56fe\u7ed8\u5236\u4ee5\u53ca\u5176\u4ed6\u4ea4\u4e92\u3002</p> <p>DecorView</p> <p>DecorView\u662fFrameLayout\u7684\u5b50\u7c7b\uff0c\u5b83\u53ef\u4ee5\u88ab\u8ba4\u4e3a\u662fAndroid\u89c6\u56fe\u6811\u7684\u6839\u8282\u70b9\u89c6\u56fe\u3002</p> <p>DecorView\u4f5c\u4e3a\u9876\u7ea7View\uff0c\u4e00\u822c\u60c5\u51b5\u4e0b\u5b83\u5185\u90e8\u5305\u542b\u4e00\u4e2a\u7ad6\u76f4\u65b9\u5411\u7684LinearLayout\uff0c\u5728\u8fd9\u4e2aLinearLayout\u91cc\u9762\u6709\u4e0a\u4e0b\u4e09\u4e2a\u90e8\u5206\uff0c\u4e0a\u9762\u662f\u4e2aViewStub\uff0c\u5ef6\u8fdf\u52a0\u8f7d\u7684\u89c6\u56fe\uff08\u5e94\u8be5\u662f\u8bbe\u7f6eActionBar\uff0c\u6839\u636eTheme\u8bbe\u7f6e\uff09\uff0c\u4e2d\u95f4\u7684\u662f\u6807\u9898\u680f\uff08\u6839\u636eTheme\u8bbe\u7f6e\uff0c\u6709\u7684\u5e03\u5c40\u6ca1\u6709\uff09\uff0c\u4e0b\u9762\u662f\u5185\u5bb9\u680f\u3002\u5728Activity\u4e2d\u901a\u8fc7setContentView\u6240\u8bbe\u7f6e\u7684\u5e03\u5c40\u6587\u4ef6\u5176\u5b9e\u5c31\u662f\u88ab\u52a0\u5230\u5185\u5bb9\u680f\u4e4b\u4e2d\u7684\uff0c\u6210\u4e3a\u5176\u552f\u4e00\u5b50View\u3002</p> <p>ViewRoot</p> <p>ViewRoot\u53ef\u80fd\u6bd4\u8f83\u964c\u751f\uff0c\u4f46\u662f\u5176\u4f5c\u7528\u975e\u5e38\u91cd\u5927\u3002\u6240\u6709View\u7684\u7ed8\u5236\u4ee5\u53ca\u4e8b\u4ef6\u5206\u53d1\u7b49\u4ea4\u4e92\u90fd\u662f\u901a\u8fc7\u5b83\u6765\u6267\u884c\u6216\u4f20\u9012\u7684\u3002</p> <p>ViewRoot\u5bf9\u5e94ViewRootImpl\u7c7b\uff0c\u5b83\u662f\u8fde\u63a5WindowManagerService\u548cDecorView\u7684\u7ebd\u5e26\uff0cView\u7684\u4e09\u5927\u6d41\u7a0b\uff08\u6d4b\u91cf\u3001\u5e03\u5c40\u3001\u7ed8\u5236\uff09\u5747\u901a\u8fc7ViewRoot\u6765\u5b8c\u6210\u3002</p> <p>ViewRoot\u5e76\u4e0d\u5c5e\u4e8eView\u6811\u7684\u4e00\u4efd\u5b50\u3002\u4ece\u6e90\u7801\u5b9e\u73b0\u4e0a\u6765\u770b\uff0c\u5b83\u65e2\u662f\u975eView\u7684\u5b50\u7c7b\uff0c\u4e5f\u662f\u975eView\u7684\u7236\u7c7b\uff0c\u4f46\u662f\uff0c\u5b83\u5b9e\u73b0\u4e86ViewParent\u63a5\u53e3\uff0c\u8fd9\u8ba9\u5b83\u53ef\u4ee5\u4f5c\u4e3aView\u7684\u540d\u4e49\u4e0a\u7684\u7236\u89c6\u56fe\u3002RootView\u7ee7\u627f\u4e86Handler\u7c7b\uff0c\u53ef\u4ee5\u63a5\u6536\u4e8b\u4ef6\u5e76\u5206\u53d1\uff0cAndroid\u7684\u6240\u6709\u89e6\u5c4f\u4e8b\u4ef6\uff0c\u6309\u952e\u4e8b\u4ef6\u3001\u754c\u9762\u5237\u65b0\u7b49\u4e8b\u4ef6\u90fd\u662f\u901a\u8fc7ViewRoot\u6765\u8fdb\u884c\u5206\u53d1\u7684\u3002</p> <p></p>"},{"location":"030Android/010Basic/#_62","title":"\u603b\u7ed3","text":"<p>Activity\u5c31\u50cf\u4e2a\u63a7\u5236\u5668\uff0c\u4e0d\u8d1f\u8d23\u89c6\u56fe\u90e8\u5206\u3002Window\u50cf\u4e2a\u627f\u8f7d\u5668\uff0c\u88c5\u7740\u5185\u90e8\u89c6\u56fe\u3002DecorView\u5c31\u662f\u4e2a\u9876\u7ea7\u89c6\u56fe\uff0c\u662f\u6240\u6709View\u7684\u6700\u5916\u5c42\u5e03\u5c40\u3002ViewRoot\u50cf\u4e2a\u8fde\u63a5\u5668\uff0c\u8d1f\u8005\u6c9f\u901a\uff0c\u901a\u8fc7\u786c\u4ef6\u611f\u77e5\u6765\u901a\u77e5\u89c6\u56fe\uff0c\u8fdb\u884c\u7528\u6237\u4e4b\u95f4\u7684\u4ea4\u4e92\u3002</p>"},{"location":"030Android/010Basic/#service","title":"Service\u7684\u542f\u52a8\u65b9\u5f0f\uff0c\u4ee5\u53ca\u5b83\u4eec\u7684\u5dee\u5f02","text":"\u7b54\u6848 <p>\u5728Android\u4e2d\uff0cService\u662f\u4e00\u79cd\u53ef\u4ee5\u5728\u540e\u53f0\u6267\u884c\u957f\u65f6\u95f4\u8fd0\u884c\u64cd\u4f5c\u7684\u7ec4\u4ef6\u3002Service\u7684\u542f\u52a8\u65b9\u5f0f\u4e3b\u8981\u6709\u4e24\u79cd\uff1a<code>startService()</code> \u548c <code>bindService()</code>\u3002\u8fd9\u4e24\u79cd\u65b9\u5f0f\u6709\u4e0d\u540c\u7684\u4f7f\u7528\u573a\u666f\u548c\u751f\u547d\u5468\u671f\u3002</p>"},{"location":"030Android/010Basic/#1-startservice","title":"1. <code>startService()</code> \u542f\u52a8\u65b9\u5f0f","text":""},{"location":"030Android/010Basic/#_63","title":"\u4f7f\u7528\u573a\u666f\uff1a","text":"<ul> <li>\u5f53\u4f60\u5e0c\u671bService\u5728\u540e\u53f0\u6267\u884c\u4e00\u4e9b\u64cd\u4f5c\uff0c\u800c\u4e0d\u9700\u8981\u4e0e\u7ec4\u4ef6\uff08\u5982Activity\uff09\u8fdb\u884c\u4ea4\u4e92\u65f6\uff0c\u53ef\u4ee5\u4f7f\u7528<code>startService()</code>\u3002</li> <li>\u4f8b\u5982\uff0c\u64ad\u653e\u97f3\u4e50\u3001\u4e0b\u8f7d\u6587\u4ef6\u7b49\u3002</li> </ul>"},{"location":"030Android/010Basic/#_64","title":"\u751f\u547d\u5468\u671f\uff1a","text":"<ul> <li><code>onCreate()</code>\uff1aService\u7b2c\u4e00\u6b21\u521b\u5efa\u65f6\u8c03\u7528\u3002</li> <li><code>onStartCommand()</code>\uff1a\u6bcf\u6b21\u901a\u8fc7<code>startService()</code>\u542f\u52a8Service\u65f6\u8c03\u7528\u3002</li> <li><code>onDestroy()</code>\uff1aService\u88ab\u9500\u6bc1\u65f6\u8c03\u7528\u3002</li> </ul>"},{"location":"030Android/010Basic/#_65","title":"\u7279\u70b9\uff1a","text":"<ul> <li>Service\u4f1a\u4e00\u76f4\u8fd0\u884c\uff0c\u76f4\u5230\u8c03\u7528<code>stopSelf()</code>\u6216<code>stopService()</code>\u3002</li> <li>\u5373\u4f7f\u542f\u52a8Service\u7684\u7ec4\u4ef6\uff08\u5982Activity\uff09\u88ab\u9500\u6bc1\uff0cService\u4ecd\u7136\u53ef\u4ee5\u7ee7\u7eed\u8fd0\u884c\u3002</li> <li>Service\u4e0e\u542f\u52a8\u5b83\u7684\u7ec4\u4ef6\u4e4b\u95f4\u6ca1\u6709\u76f4\u63a5\u7684\u901a\u4fe1\u6e20\u9053\u3002</li> </ul>"},{"location":"030Android/010Basic/#_66","title":"\u793a\u4f8b\u4ee3\u7801\uff1a","text":"<pre><code>Intent intent = new Intent(this, MyService.class);\nstartService(intent);\n</code></pre>"},{"location":"030Android/010Basic/#2-bindservice","title":"2. <code>bindService()</code> \u542f\u52a8\u65b9\u5f0f","text":""},{"location":"030Android/010Basic/#_67","title":"\u4f7f\u7528\u573a\u666f\uff1a","text":"<ul> <li>\u5f53\u4f60\u5e0c\u671bService\u4e0e\u7ec4\u4ef6\uff08\u5982Activity\uff09\u8fdb\u884c\u4ea4\u4e92\u65f6\uff0c\u53ef\u4ee5\u4f7f\u7528<code>bindService()</code>\u3002</li> <li>\u4f8b\u5982\uff0c\u83b7\u53d6Service\u4e2d\u7684\u6570\u636e\u3001\u8c03\u7528Service\u4e2d\u7684\u65b9\u6cd5\u7b49\u3002</li> </ul>"},{"location":"030Android/010Basic/#_68","title":"\u751f\u547d\u5468\u671f\uff1a","text":"<ul> <li><code>onCreate()</code>\uff1aService\u7b2c\u4e00\u6b21\u521b\u5efa\u65f6\u8c03\u7528\u3002</li> <li><code>onBind()</code>\uff1a\u5f53\u7ec4\u4ef6\u901a\u8fc7<code>bindService()</code>\u7ed1\u5b9a\u5230Service\u65f6\u8c03\u7528\u3002</li> <li><code>onUnbind()</code>\uff1a\u5f53\u6240\u6709\u7ec4\u4ef6\u90fd\u89e3\u7ed1\u65f6\u8c03\u7528\u3002</li> <li><code>onDestroy()</code>\uff1aService\u88ab\u9500\u6bc1\u65f6\u8c03\u7528\u3002</li> </ul>"},{"location":"030Android/010Basic/#_69","title":"\u7279\u70b9\uff1a","text":"<ul> <li>Service\u4e0e\u7ed1\u5b9a\u5b83\u7684\u7ec4\u4ef6\u4e4b\u95f4\u5b58\u5728\u901a\u4fe1\u6e20\u9053\uff0c\u53ef\u4ee5\u901a\u8fc7<code>IBinder</code>\u63a5\u53e3\u8fdb\u884c\u4ea4\u4e92\u3002</li> <li>\u5f53\u6240\u6709\u7ed1\u5b9a\u5230Service\u7684\u7ec4\u4ef6\u90fd\u89e3\u7ed1\u540e\uff0cService\u4f1a\u81ea\u52a8\u505c\u6b62\uff08\u9664\u975e\u5b83\u4e5f\u88ab<code>startService()</code>\u542f\u52a8\uff09\u3002</li> <li>\u9002\u7528\u4e8e\u9700\u8981\u4e0eService\u8fdb\u884c\u4ea4\u4e92\u7684\u573a\u666f\u3002</li> </ul>"},{"location":"030Android/010Basic/#_70","title":"\u793a\u4f8b\u4ee3\u7801\uff1a","text":"<pre><code>Intent intent = new Intent(this, MyService.class);\nbindService(intent, serviceConnection, Context.BIND_AUTO_CREATE);\n</code></pre>"},{"location":"030Android/010Basic/#3_10","title":"3. \u4e24\u79cd\u542f\u52a8\u65b9\u5f0f\u7684\u5dee\u5f02","text":"\u7279\u6027 <code>startService()</code> <code>bindService()</code> \u542f\u52a8\u65b9\u5f0f \u901a\u8fc7<code>startService()</code>\u542f\u52a8 \u901a\u8fc7<code>bindService()</code>\u7ed1\u5b9a \u751f\u547d\u5468\u671f <code>onCreate()</code> -&gt; <code>onStartCommand()</code> -&gt; <code>onDestroy()</code> <code>onCreate()</code> -&gt; <code>onBind()</code> -&gt; <code>onUnbind()</code> -&gt; <code>onDestroy()</code> \u901a\u4fe1\u65b9\u5f0f \u65e0\u76f4\u63a5\u901a\u4fe1 \u901a\u8fc7<code>IBinder</code>\u63a5\u53e3\u8fdb\u884c\u901a\u4fe1 \u505c\u6b62\u65b9\u5f0f \u8c03\u7528<code>stopSelf()</code>\u6216<code>stopService()</code> \u6240\u6709\u7ec4\u4ef6\u89e3\u7ed1\u540e\u81ea\u52a8\u505c\u6b62 \u9002\u7528\u573a\u666f \u540e\u53f0\u4efb\u52a1\uff0c\u65e0\u9700\u4e0e\u7ec4\u4ef6\u4ea4\u4e92 \u9700\u8981\u4e0e\u7ec4\u4ef6\u4ea4\u4e92\u7684\u573a\u666f"},{"location":"030Android/010Basic/#4_8","title":"4. \u6df7\u5408\u4f7f\u7528","text":"<p>\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\uff0cService\u53ef\u80fd\u540c\u65f6\u88ab<code>startService()</code>\u548c<code>bindService()</code>\u542f\u52a8\u3002\u4f8b\u5982\uff0c\u4e00\u4e2a\u97f3\u4e50\u64ad\u653e\u5668Service\u53ef\u80fd\u901a\u8fc7<code>startService()</code>\u542f\u52a8\u4ee5\u64ad\u653e\u97f3\u4e50\uff0c\u540c\u65f6\u901a\u8fc7<code>bindService()</code>\u7ed1\u5b9a\u4ee5\u5141\u8bb8Activity\u63a7\u5236\u64ad\u653e\u3002</p> <p>\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0cService\u7684\u751f\u547d\u5468\u671f\u4f1a\u7ed3\u5408\u4e24\u79cd\u65b9\u5f0f\u7684\u7279\u70b9\uff1a - Service\u4f1a\u4e00\u76f4\u8fd0\u884c\uff0c\u76f4\u5230\u8c03\u7528<code>stopSelf()</code>\u6216<code>stopService()</code>\uff0c\u5e76\u4e14\u6240\u6709\u7ed1\u5b9a\u90fd\u89e3\u7ed1\u3002</p>"},{"location":"030Android/010Basic/#_71","title":"\u603b\u7ed3","text":"<ul> <li>\u4f7f\u7528<code>startService()</code>\u9002\u7528\u4e8e\u4e0d\u9700\u8981\u4e0e\u7ec4\u4ef6\u4ea4\u4e92\u7684\u540e\u53f0\u4efb\u52a1\u3002</li> <li>\u4f7f\u7528<code>bindService()</code>\u9002\u7528\u4e8e\u9700\u8981\u4e0e\u7ec4\u4ef6\u4ea4\u4e92\u7684\u573a\u666f\u3002</li> <li>\u6839\u636e\u5177\u4f53\u9700\u6c42\u9009\u62e9\u5408\u9002\u7684\u542f\u52a8\u65b9\u5f0f\uff0c\u6216\u6df7\u5408\u4f7f\u7528\u4e24\u79cd\u65b9\u5f0f\u3002</li> </ul>"},{"location":"030Android/010Basic/#serviceactivity","title":"Service\u4e0eActivity\u4e4b\u95f4\u901a\u4fe1\u7684\u51e0\u79cd\u65b9\u5f0f","text":"\u7b54\u6848 <p>\u5728Android\u4e2d\uff0cService\u4e0eActivity\u4e4b\u95f4\u7684\u901a\u4fe1\u662f\u5f00\u53d1\u4e2d\u5e38\u89c1\u7684\u9700\u6c42\u3002\u4ee5\u4e0b\u662f\u51e0\u79cd\u5e38\u7528\u7684\u901a\u4fe1\u65b9\u5f0f\uff1a</p>"},{"location":"030Android/010Basic/#1-intent","title":"1. \u901a\u8fc7 <code>Intent</code> \u4f20\u9012\u6570\u636e","text":"<ul> <li>\u9002\u7528\u573a\u666f\uff1a\u7b80\u5355\u7684\u6570\u636e\u4f20\u9012\uff0c\u4e0d\u9700\u8981\u9891\u7e41\u901a\u4fe1\u3002</li> <li>\u5b9e\u73b0\u65b9\u5f0f\uff1a<ul> <li>Activity\u901a\u8fc7<code>Intent</code>\u542f\u52a8Service\uff0c\u5e76\u5c06\u6570\u636e\u653e\u5165<code>Intent</code>\u4e2d\u3002</li> <li>Service\u901a\u8fc7<code>onStartCommand()</code>\u6216<code>onBind()</code>\u65b9\u6cd5\u63a5\u6536\u6570\u636e\u3002</li> </ul> </li> <li>\u7279\u70b9\uff1a<ul> <li>\u7b80\u5355\u6613\u7528\uff0c\u9002\u5408\u4e00\u6b21\u6027\u6570\u636e\u4f20\u9012\u3002</li> <li>\u65e0\u6cd5\u5b9e\u73b0\u53cc\u5411\u901a\u4fe1\u3002</li> </ul> </li> </ul> <p>\u793a\u4f8b\u4ee3\u7801\uff1a <pre><code>// Activity \u4e2d\u542f\u52a8 Service \u5e76\u4f20\u9012\u6570\u636e\nIntent intent = new Intent(this, MyService.class);\nintent.putExtra(\"key\", \"value\");\nstartService(intent); // \u6216 bindService(intent, ...)\n</code></pre></p> <pre><code>// Service \u4e2d\u63a5\u6536\u6570\u636e\n@Override\npublic int onStartCommand(Intent intent, int flags, int startId) {\n    String value = intent.getStringExtra(\"key\");\n    return START_STICKY;\n}\n</code></pre>"},{"location":"030Android/010Basic/#2-binder-bindservice","title":"2. \u901a\u8fc7 <code>Binder</code> \u548c <code>bindService()</code> \u5b9e\u73b0\u53cc\u5411\u901a\u4fe1","text":"<ul> <li>\u9002\u7528\u573a\u666f\uff1a\u9700\u8981\u9891\u7e41\u4ea4\u4e92\u7684\u573a\u666f\uff0c\u4f8b\u5982\u63a7\u5236Service\u6216\u83b7\u53d6Service\u7684\u72b6\u6001\u3002</li> <li>\u5b9e\u73b0\u65b9\u5f0f\uff1a<ul> <li>\u5728Service\u4e2d\u521b\u5efa\u4e00\u4e2a<code>Binder</code>\u5b50\u7c7b\uff0c\u63d0\u4f9b\u516c\u5171\u65b9\u6cd5\u4f9bActivity\u8c03\u7528\u3002</li> <li>Activity\u901a\u8fc7<code>bindService()</code>\u7ed1\u5b9aService\uff0c\u5e76\u901a\u8fc7<code>ServiceConnection</code>\u83b7\u53d6<code>Binder</code>\u5b9e\u4f8b\u3002</li> </ul> </li> <li>\u7279\u70b9\uff1a<ul> <li>\u652f\u6301\u53cc\u5411\u901a\u4fe1\u3002</li> <li>\u9002\u7528\u4e8e\u9700\u8981\u6301\u7eed\u4ea4\u4e92\u7684\u573a\u666f\u3002</li> </ul> </li> </ul> <p>\u793a\u4f8b\u4ee3\u7801\uff1a <pre><code>// Service \u4e2d\u5b9a\u4e49 Binder\npublic class MyService extends Service {\n    private final IBinder binder = new LocalBinder();\n\n    public class LocalBinder extends Binder {\n        MyService getService() {\n            return MyService.this;\n        }\n    }\n\n    @Override\n    public IBinder onBind(Intent intent) {\n        return binder;\n    }\n\n    // \u516c\u5171\u65b9\u6cd5\u4f9b Activity \u8c03\u7528\n    public void doSomething() {\n        // \u6267\u884c\u64cd\u4f5c\n    }\n}\n</code></pre></p> <pre><code>// Activity \u4e2d\u7ed1\u5b9a Service \u5e76\u8c03\u7528\u65b9\u6cd5\nprivate MyService myService;\nprivate boolean isBound = false;\n\nprivate ServiceConnection connection = new ServiceConnection() {\n    @Override\n    public void onServiceConnected(ComponentName name, IBinder service) {\n        MyService.LocalBinder binder = (MyService.LocalBinder) service;\n        myService = binder.getService();\n        isBound = true;\n        myService.doSomething(); // \u8c03\u7528 Service \u4e2d\u7684\u65b9\u6cd5\n    }\n\n    @Override\n    public void onServiceDisconnected(ComponentName name) {\n        isBound = false;\n    }\n};\n\n@Override\nprotected void onStart() {\n    super.onStart();\n    Intent intent = new Intent(this, MyService.class);\n    bindService(intent, connection, Context.BIND_AUTO_CREATE);\n}\n\n@Override\nprotected void onStop() {\n    super.onStop();\n    if (isBound) {\n        unbindService(connection);\n        isBound = false;\n    }\n}\n</code></pre>"},{"location":"030Android/010Basic/#3-broadcastreceiver","title":"3. \u901a\u8fc7 <code>BroadcastReceiver</code> \u5b9e\u73b0\u901a\u4fe1","text":"<ul> <li>\u9002\u7528\u573a\u666f\uff1aService\u9700\u8981\u5411Activity\u53d1\u9001\u901a\u77e5\u6216\u6570\u636e\uff0c\u4f46\u4e0d\u9002\u5408\u9891\u7e41\u901a\u4fe1\u3002</li> <li>\u5b9e\u73b0\u65b9\u5f0f\uff1a<ul> <li>Service\u53d1\u9001\u5e7f\u64ad\uff0cActivity\u6ce8\u518c<code>BroadcastReceiver</code>\u63a5\u6536\u5e7f\u64ad\u3002</li> </ul> </li> <li>\u7279\u70b9\uff1a<ul> <li>\u9002\u5408\u5355\u5411\u901a\u4fe1\uff08Service -&gt; Activity\uff09\u3002</li> <li>\u5e7f\u64ad\u662f\u5168\u5c40\u7684\uff0c\u53ef\u80fd\u4f1a\u88ab\u5176\u4ed6\u7ec4\u4ef6\u63a5\u6536\u3002</li> </ul> </li> </ul> <p>\u793a\u4f8b\u4ee3\u7801\uff1a <pre><code>// Service \u4e2d\u53d1\u9001\u5e7f\u64ad\nIntent broadcastIntent = new Intent(\"com.example.MY_ACTION\");\nbroadcastIntent.putExtra(\"data\", \"Hello from Service\");\nsendBroadcast(broadcastIntent);\n</code></pre></p> <pre><code>// Activity \u4e2d\u6ce8\u518c BroadcastReceiver\nprivate BroadcastReceiver receiver = new BroadcastReceiver() {\n    @Override\n    public void onReceive(Context context, Intent intent) {\n        String data = intent.getStringExtra(\"data\");\n        // \u5904\u7406\u63a5\u6536\u5230\u7684\u6570\u636e\n    }\n};\n\n@Override\nprotected void onResume() {\n    super.onResume();\n    IntentFilter filter = new IntentFilter(\"com.example.MY_ACTION\");\n    registerReceiver(receiver, filter);\n}\n\n@Override\nprotected void onPause() {\n    super.onPause();\n    unregisterReceiver(receiver);\n}\n</code></pre>"},{"location":"030Android/010Basic/#4-handler-messenger","title":"4. \u901a\u8fc7 <code>Handler</code> \u548c <code>Messenger</code> \u5b9e\u73b0\u901a\u4fe1","text":"<ul> <li>\u9002\u7528\u573a\u666f\uff1a\u8de8\u8fdb\u7a0b\u901a\u4fe1\uff08IPC\uff09\u6216\u9700\u8981\u66f4\u590d\u6742\u7684\u6d88\u606f\u4f20\u9012\u673a\u5236\u3002</li> <li>\u5b9e\u73b0\u65b9\u5f0f\uff1a<ul> <li>Service\u521b\u5efa\u4e00\u4e2a<code>Handler</code>\uff0c\u5e76\u901a\u8fc7<code>Messenger</code>\u5c06\u5176\u5c01\u88c5\u3002</li> <li>Activity\u901a\u8fc7<code>bindService()</code>\u7ed1\u5b9aService\uff0c\u5e76\u901a\u8fc7<code>Messenger</code>\u53d1\u9001\u6d88\u606f\u3002</li> </ul> </li> <li>\u7279\u70b9\uff1a<ul> <li>\u652f\u6301\u8de8\u8fdb\u7a0b\u901a\u4fe1\u3002</li> <li>\u9002\u5408\u9700\u8981\u53d1\u9001\u6d88\u606f\u7684\u573a\u666f\u3002</li> </ul> </li> </ul> <p>\u793a\u4f8b\u4ee3\u7801\uff1a <pre><code>// Service \u4e2d\u521b\u5efa Messenger\npublic class MyService extends Service {\n    private final Messenger messenger = new Messenger(new IncomingHandler());\n\n    private static class IncomingHandler extends Handler {\n        @Override\n        public void handleMessage(Message msg) {\n            // \u5904\u7406\u6765\u81ea Activity \u7684\u6d88\u606f\n        }\n    }\n\n    @Override\n    public IBinder onBind(Intent intent) {\n        return messenger.getBinder();\n    }\n}\n</code></pre></p> <pre><code>// Activity \u4e2d\u7ed1\u5b9a Service \u5e76\u53d1\u9001\u6d88\u606f\nprivate Messenger serviceMessenger;\nprivate boolean isBound = false;\n\nprivate ServiceConnection connection = new ServiceConnection() {\n    @Override\n    public void onServiceConnected(ComponentName name, IBinder service) {\n        serviceMessenger = new Messenger(service);\n        isBound = true;\n\n        // \u53d1\u9001\u6d88\u606f\u5230 Service\n        Message msg = Message.obtain();\n        Bundle data = new Bundle();\n        data.putString(\"key\", \"value\");\n        msg.setData(data);\n        try {\n            serviceMessenger.send(msg);\n        } catch (RemoteException e) {\n            e.printStackTrace();\n        }\n    }\n\n    @Override\n    public void onServiceDisconnected(ComponentName name) {\n        isBound = false;\n    }\n};\n\n@Override\nprotected void onStart() {\n    super.onStart();\n    Intent intent = new Intent(this, MyService.class);\n    bindService(intent, connection, Context.BIND_AUTO_CREATE);\n}\n\n@Override\nprotected void onStop() {\n    super.onStop();\n    if (isBound) {\n        unbindService(connection);\n        isBound = false;\n    }\n}\n</code></pre>"},{"location":"030Android/010Basic/#5-livedata-flow","title":"5. \u901a\u8fc7 <code>LiveData</code> \u6216 <code>Flow</code> \u5b9e\u73b0\u901a\u4fe1","text":"<ul> <li>\u9002\u7528\u573a\u666f\uff1a\u57fa\u4e8e\u89c2\u5bdf\u8005\u6a21\u5f0f\u7684\u901a\u4fe1\uff0c\u9002\u5408\u73b0\u4ee3Android\u5f00\u53d1\uff08\u5982MVVM\u67b6\u6784\uff09\u3002</li> <li>\u5b9e\u73b0\u65b9\u5f0f\uff1a<ul> <li>\u5728Service\u4e2d\u4f7f\u7528<code>LiveData</code>\u6216<code>Flow</code>\u53d1\u5e03\u6570\u636e\u3002</li> <li>Activity\u89c2\u5bdf<code>LiveData</code>\u6216<code>Flow</code>\u4ee5\u63a5\u6536\u6570\u636e\u3002</li> </ul> </li> <li>\u7279\u70b9\uff1a<ul> <li>\u9002\u5408\u54cd\u5e94\u5f0f\u7f16\u7a0b\u3002</li> <li>\u9700\u8981\u7ed3\u5408<code>ViewModel</code>\u6216<code>Lifecycle</code>\u4f7f\u7528\u3002</li> </ul> </li> </ul> <p>\u793a\u4f8b\u4ee3\u7801\uff1a <pre><code>// Service \u4e2d\u4f7f\u7528 LiveData\npublic class MyService extends Service {\n    private final MutableLiveData&lt;String&gt; data = new MutableLiveData&lt;&gt;();\n\n    public LiveData&lt;String&gt; getData() {\n        return data;\n    }\n\n    private void updateData(String newData) {\n        data.postValue(newData);\n    }\n}\n</code></pre></p> <pre><code>// Activity \u4e2d\u89c2\u5bdf LiveData\nmyService.getData().observe(this, newData -&gt; {\n    // \u5904\u7406\u63a5\u6536\u5230\u7684\u6570\u636e\n});\n</code></pre>"},{"location":"030Android/010Basic/#_72","title":"\u603b\u7ed3","text":"\u901a\u4fe1\u65b9\u5f0f \u9002\u7528\u573a\u666f \u7279\u70b9 <code>Intent</code> \u7b80\u5355\u6570\u636e\u4f20\u9012 \u7b80\u5355\u6613\u7528\uff0c\u9002\u5408\u4e00\u6b21\u6027\u6570\u636e\u4f20\u9012 <code>Binder</code> \u548c <code>bindService()</code> \u9891\u7e41\u4ea4\u4e92\u3001\u53cc\u5411\u901a\u4fe1 \u652f\u6301\u53cc\u5411\u901a\u4fe1\uff0c\u9002\u5408\u6301\u7eed\u4ea4\u4e92 <code>BroadcastReceiver</code> \u5355\u5411\u901a\u77e5\uff08Service -&gt; Activity\uff09 \u5168\u5c40\u5e7f\u64ad\uff0c\u9002\u5408\u901a\u77e5\u7c7b\u901a\u4fe1 <code>Messenger</code> \u8de8\u8fdb\u7a0b\u901a\u4fe1\u3001\u590d\u6742\u6d88\u606f\u4f20\u9012 \u652f\u6301\u8de8\u8fdb\u7a0b\uff0c\u9002\u5408\u6d88\u606f\u4f20\u9012 <code>LiveData</code> \u6216 <code>Flow</code> \u54cd\u5e94\u5f0f\u7f16\u7a0b\u3001\u73b0\u4ee3\u67b6\u6784 \u9002\u5408\u89c2\u5bdf\u8005\u6a21\u5f0f\uff0c\u7ed3\u5408MVVM\u4f7f\u7528 <p>\u6839\u636e\u5177\u4f53\u9700\u6c42\u9009\u62e9\u5408\u9002\u7684\u901a\u4fe1\u65b9\u5f0f\u3002</p>"},{"location":"030Android/010Basic/#intentservice","title":"intentService\u4f5c\u7528\u662f\u4ec0\u4e48\uff1f","text":"\u7b54\u6848 <p>IntentService\u662f\u7ee7\u627f\u5e76\u5904\u7406\u5f02\u6b65\u8bf7\u6c42\u7684\u4e00\u4e2a\u7c7b\uff0c\u5176\u672c\u8d28\u4e0a\u662f\u4e00\u4e2aService\uff0c\u56e0\u4e3a\u5b83\u662f\u7ee7\u627f\u81f3Service\uff0c\u6240\u4ee5\u5f00\u542fIntentService\u548c\u666e\u901a\u7684Service\u4e00\u81f4\u3002\u4f46\u662f\u4ed6\u548c\u666e\u901a\u7684Service\u4e0d\u540c\u4e4b\u5904\u5728\u4e8e\u5b83\u53ef\u4ee5\u5904\u7406\u5f02\u6b65\u4efb\u52a1\uff0c\u5728\u4efb\u52a1\u5904\u7406\u5b8c\u4e4b\u540e\u4f1a\u81ea\u52a8\u7ed3\u675f\u3002\u53e6\u5916\uff0c\u6211\u4eec\u53ef\u4ee5\u542f\u52a8\u591a\u6b21IntentService\uff0c\u800c\u6bcf\u4e00\u4e2a\u8017\u65f6\u4efb\u52a1\u4f1a\u4ee5\u5de5\u4f5c\u961f\u5217\u7684\u65b9\u5f0f\u5728IntentService\u7684onHandleIntent\u56de\u8c03\u65b9\u6cd5\u4e2d\u6267\u884c\uff0c\u5e76\u4e14\u662f\u4e32\u884c\u6267\u884c\u3002\u5176\u5b9eIntentService\u7684\u5185\u90e8\u662f\u901a\u8fc7HandleThread\u548cHandle\u6765\u5b9e\u73b0\u5f02\u6b65\u64cd\u4f5c\u7684\u3002</p>"},{"location":"030Android/010Basic/#aidl","title":"AIDL\u89e3\u51b3\u4e86\u4ec0\u4e48\u95ee\u9898\uff1f","text":"\u7b54\u6848 <p>AIDL\uff08Android Interface Definition Language\uff09\u5728Android\u4e2d\u4e3b\u8981\u89e3\u51b3\u4e86\u4ee5\u4e0b\u95ee\u9898\uff1a</p> <p>\u8de8\u8fdb\u7a0b\u901a\u4fe1\uff08IPC\uff09\uff1a</p> <p>Android\u5e94\u7528\u901a\u5e38\u8fd0\u884c\u5728\u72ec\u7acb\u8fdb\u7a0b\u4e2d\uff0c\u65e0\u6cd5\u76f4\u63a5\u5171\u4eab\u5185\u5b58\u3002AIDL\u5141\u8bb8\u4e0d\u540c\u8fdb\u7a0b\u95f4\u901a\u8fc7\u5b9a\u4e49\u63a5\u53e3\u8fdb\u884c\u901a\u4fe1\uff0c\u5b9e\u73b0\u6570\u636e\u4ea4\u6362\u548c\u65b9\u6cd5\u8c03\u7528\u3002</p> <p>\u63a5\u53e3\u6807\u51c6\u5316\uff1a</p> <p>AIDL\u901a\u8fc7\u5b9a\u4e49\u63a5\u53e3\uff0c\u786e\u4fdd\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u4f7f\u7528\u76f8\u540c\u7684\u901a\u4fe1\u534f\u8bae\uff0c\u51cf\u5c11\u901a\u4fe1\u9519\u8bef\u3002</p> <p>\u652f\u6301\u590d\u6742\u6570\u636e\u7c7b\u578b\uff1a</p> <p>AIDL\u4e0d\u4ec5\u652f\u6301\u57fa\u672c\u6570\u636e\u7c7b\u578b\uff0c\u8fd8\u80fd\u5904\u7406\u81ea\u5b9a\u4e49\u5bf9\u8c61\uff08\u9700\u5b9e\u73b0Parcelable\u63a5\u53e3\uff09\uff0c\u6ee1\u8db3\u590d\u6742\u6570\u636e\u4f20\u9012\u7684\u9700\u6c42\u3002</p> <p>\u5f02\u6b65\u901a\u4fe1\uff1a</p> <p>AIDL\u652f\u6301\u540c\u6b65\u548c\u5f02\u6b65\u8c03\u7528\uff0c\u5f02\u6b65\u8c03\u7528\u901a\u8fc7oneway\u5173\u952e\u5b57\u5b9e\u73b0\uff0c\u907f\u514d\u963b\u585e\u4e3b\u7ebf\u7a0b\u3002</p> <p>\u5b89\u5168\u6027\uff1a</p> <p>AIDL\u5141\u8bb8\u8bbe\u7f6e\u6743\u9650\u63a7\u5236\uff0c\u786e\u4fdd\u53ea\u6709\u6388\u6743\u5e94\u7528\u624d\u80fd\u8bbf\u95ee\u670d\u52a1\uff0c\u63d0\u5347\u5b89\u5168\u6027\u3002</p> <p>\u89e3\u8026\uff1a</p> <p>AIDL\u5c06\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u89e3\u8026\uff0c\u5ba2\u6237\u7aef\u53ea\u9700\u5173\u6ce8\u63a5\u53e3\uff0c\u670d\u52a1\u7aef\u8d1f\u8d23\u5b9e\u73b0\uff0c\u4fbf\u4e8e\u7ef4\u62a4\u548c\u6269\u5c55\u3002</p> <p>\u591a\u7ebf\u7a0b\u652f\u6301\uff1a</p> <p>AIDL\u81ea\u52a8\u5904\u7406\u591a\u7ebf\u7a0b\uff0c\u670d\u52a1\u7aef\u65b9\u6cd5\u5728\u4e0d\u540c\u7ebf\u7a0b\u4e2d\u6267\u884c\uff0c\u63d0\u5347\u5e76\u53d1\u6027\u80fd\u3002</p> <p>\u603b\u7ed3\uff1aAIDL\u89e3\u51b3\u4e86Android\u4e2d\u8de8\u8fdb\u7a0b\u901a\u4fe1\u3001\u63a5\u53e3\u6807\u51c6\u5316\u3001\u590d\u6742\u6570\u636e\u4f20\u9012\u3001\u5f02\u6b65\u8c03\u7528\u3001\u5b89\u5168\u6027\u3001\u89e3\u8026\u548c\u591a\u7ebf\u7a0b\u652f\u6301\u7b49\u95ee\u9898\uff0c\u662fAndroid IPC\u7684\u6838\u5fc3\u5de5\u5177\u3002</p>"},{"location":"030Android/010Basic/#application","title":"\u8c08\u8c08\u5bf9Application\u7c7b\u7684\u7406\u89e3","text":"\u7b54\u6848 <p>\u9996\u5148\uff0cApplication \u5728\u4e00\u4e2a Dalvik \u865a\u62df\u673a\u91cc\u9762\u53ea\u4f1a\u5b58\u5728\u4e00\u4e2a\u5b9e\u4f8b\u3002\u4e3a\u4ec0\u4e48\u5f3a\u8c03\u8bf4\u662f\u4e00\u4e2aDalvik\u865a\u62df\u673a\uff0c\u800c\u4e0d\u662f\u4e00\u4e2aAPP\u5462\uff1f\u90a3\u662f\u56e0\u4e3a\uff0c\u4e00\u4e2aApp\u6709\u53ef\u80fd\u6709\u591a\u4e2aDalvik\u865a\u62df\u673a\uff0c\u4e5f\u5c31\u662f\u4f20\u8bf4\u4e2d\u7684\u591a\u8fdb\u7a0b\u6a21\u5f0f\u3002\u5728\u8fd9\u79cd\u6a21\u5f0f\u4e0b\uff0c\u6bcf\u4e00\u4e2aDalvik\u90fd\u4f1a\u5b58\u5728\u4e00\u4e2aApplication\u5b9e\u4f8b\uff0c\u5b83\u4eec\u4e4b\u95f4\u6ca1\u6709\u5173\u7cfb\uff0c\u5728A\u8fdb\u7a0bApplication\u91cc\u9762\u4fdd\u5b58\u7684\u6570\u636e\u4e0d\u80fd\u5728B\u8fdb\u7a0b\u7684Application\u83b7\u53d6\uff0c\u56e0\u4e3a\u5b83\u4eec\u6839\u672c\u4e0d\u662f\u4e00\u4e2a\u5bf9\u8c61\u3002\u800c\u4e14\u88ab\u9694\u79bb\u5728\u4e24\u4e2a\u8fdb\u7a0b\u91cc\u9762\uff0c\u6240\u4ee5\u8fd9\u91cc\u5f3a\u8c03\u7684\u662f\u4e00\u4e2aDalvik\u865a\u62df\u673a\uff0c\u800c\u4e0d\u662f\u4e00\u4e2aApp\u3002</p> <p>Application\u6709\u4e24\u4e2a\u5b50\u7c7b\uff0c\u4e00\u4e2a\u662fMultiDexApplication\uff0c\u5982\u679c\u4f60\u9047\u5230\u4e8665535\u95ee\u9898\uff0c\u53ef\u4ee5\u9009\u62e9\u7ee7\u627f\u81f3\u5b83\uff0c\u5b8c\u6210\u76f8\u5173\u7684\u5de5\u4f5c\u3002\u53e6\u5916\u4e00\u4e2a\u662f\u5728TDD\uff08\u6d4b\u8bd5\u7528\u4f8b\u9a71\u52a8\uff09\u5f00\u53d1\u6a21\u5f0f\u4e2d\u4f7f\u7528Moke\u8fdb\u884c\u6d4b\u8bd5\u7684\u65f6\u5019\u7528\u5230\u7684\uff0c\u53ef\u4ee5\u6765\u66ff\u4ee3Application\u7684Moke\u7c7bMokeApplication\u3002</p> <p>\u5728\u5e94\u7528\u542f\u52a8\u7684\u65f6\u5019\uff0c\u4f1a\u9996\u5148\u8c03\u7528Application.attach()\uff0c\u5f53\u7136\uff0c\u8fd9\u4e2a\u65b9\u6cd5\u662f\u9690\u85cf\u7684\uff0c\u5f00\u53d1\u8005\u80fd\u63a5\u89e6\u5230\u7684\u7b2c\u4e00\u4e2a\u88ab\u8c03\u7528\u7684\u65b9\u6cd5\u5176\u5b9e\u662fApplication.onCreate()\uff0c\u6211\u4eec\u901a\u5e38\u4f1a\u5728\u8fd9\u4e2a\u65b9\u6cd5\u91cc\u9762\u5b8c\u6210\u5404\u79cd\u521d\u59cb\u5316\uff0c\u6bd4\u5982\u56fe\u7247\u52a0\u8f7d\u5e93\u3001\u7f51\u7edc\u8bf7\u6c42\u5e93\u7b49\u521d\u59cb\u5316\u64cd\u4f5c\u3002\u4f46\u662f\u6700\u597d\u522b\u5728\u8fd9\u4e2a\u65b9\u6cd5\u91cc\u9762\u8fdb\u884c\u592a\u591a\u7684\u8017\u65f6\u64cd\u4f5c\uff0c\u56e0\u4e3a\u8fd9\u4f1a\u5f71\u54cdApp\u7684\u542f\u52a8\u901f\u5ea6\uff0c\u6240\u4ee5\u5bf9\u4e8e\u4e0d\u5fc5\u8981\u7684\u64cd\u4f5c\u53ef\u4ee5\u4f7f\u7528\u5f02\u6b65\u64cd\u4f5c\u3001\u61d2\u52a0\u8f7d\u3001\u5ef6\u65f6\u52a0\u8f7d\u7b49\u7b56\u7565\u6765\u51cf\u5c11\u5bf9UI\u7ebf\u7a0b\u7684\u5f71\u54cd\u3002</p> <p>\u9664\u6b64\u4e4b\u5916\uff0c\u7531\u4e8e\u5728Context\u4e2d\u53ef\u4ee5\u901a\u8fc7getApplicationContext()\u83b7\u53d6\u5230Application\u5bf9\u8c61\uff0c\u6216\u8005\u662f\u901a\u8fc7Activity.getApplication()\u3001Service.getApplication()\u83b7\u53d6\u5230Application\uff0c\u6240\u4ee5\u53ef\u4ee5\u5728Application\u4fdd\u5b58\u5168\u5c40\u7684\u6570\u636e\uff0c\u4f9b\u6240\u6709\u7684Activity\u6216\u8005Service\u4f7f\u7528\u3002</p> <p>\u4f7f\u7528\u4e0a\u9762\u7684\u4e09\u79cd\u65b9\u6cd5\u83b7\u53d6\u5230\u7684\u90fd\u662f\u540c\u4e00\u4e2aApplication\u5bf9\u8c61\uff0cgetApplicationContext()\u662f\u5728Context\u7684\u5b9e\u73b0\u7c7bContextImpl\u4e2d\u5177\u4f53\u5b9e\u73b0\u7684\uff0c\u800cgetApplication()\u5219\u662f\u5728Activity\u548cService\u4e2d\u5355\u72ec\u5b9e\u73b0\u7684\uff0c\u6240\u4ee5\u4ed6\u4eec\u7684\u4f5c\u7528\u57df\u4e0d\u540c\uff0c\u4f46\u662f\u83b7\u53d6\u5230\u7684\u90fd\u662f\u540c\u4e00\u4e2aApplication\u5bf9\u8c61\uff0c\u56e0\u4e3a\u4e00\u4e2aDalvik\u865a\u62df\u673a\u53ea\u6709\u4e00\u4e2aApplication\u5bf9\u8c61\u3002</p> <p>\u4f46\u662f\u8fd9\u91cc\u5b58\u5728\u4e00\u4e2a\u5751\uff0c\u90a3\u5c31\u662f\u5728\u4f4e\u5185\u5b58\u60c5\u51b5\u4e0b\uff0cApplication\u6709\u53ef\u80fd\u88ab\u9500\u6bc1\uff0c\u4ece\u800c\u5bfc\u81f4\u4fdd\u5b58\u5728Application\u91cc\u9762\u7684\u6570\u636e\u88ab\u9500\u6bc1\uff0c\u6700\u540e\u7a0b\u5e8f\u9519\u4e71\uff0c\u751a\u81f3Crash\u3002</p> <p>\u6240\u4ee5\u5f53\u4f60\u60f3\u5728Application\u4fdd\u5b58\u6570\u636e\u7684\u65f6\u5019\uff0c\u8bf7\u505a\u597d\u5224null\uff0c\u6216\u8005\u9009\u62e9\u5176\u4ed6\u65b9\u5f0f\u4fdd\u5b58\u4f60\u7684\u6570\u636e\uff0c\u6bd4\u5982\u5b58\u50a8\u5728\u786c\u76d8\u4e0a\u7b49\u7b49\u3002</p> <p>\u53e6\u5916\uff0c\u5728Application\u4e2d\u5b58\u5728\u51e0\u4e2a\u6709\u7528\u7684\u65b9\u6cd5\uff0c\u6bd4\u5982onLowMemory()\u548conTrimMemory()\uff08Activity\u91cc\u9762\u4e5f\u5b58\u5728\u8fd9\u4e24\u4e2a\u65b9\u6cd5\uff09\uff0c\u5728\u8fd9\u4e24\u4e2a\u65b9\u6cd5\u91cc\u9762\uff0c\u6211\u4eec\u53ef\u4ee5\u5b9e\u73b0\u81ea\u5df1\u7684\u5185\u5b58\u56de\u6536\u903b\u8f91\uff0c\u6bd4\u5982\u5173\u95ed\u6570\u636e\u5e93\u94fe\u63a5\u3001\u79fb\u9664\u56fe\u7247\u5185\u5b58\u7f13\u5b58\u7b49\u64cd\u4f5c\u6765\u964d\u4f4e\u5185\u5b58\u6d88\u8017\uff0c\u4ece\u800c\u964d\u4f4e\u88ab\u7cfb\u7edf\u56de\u6536\u7684\u98ce\u9669\u3002</p> <p>\u6700\u540e\uff0c\u5c31\u662f\u8981\u6ce8\u610fApplication\u7684\u751f\u547d\u5468\u671f\uff0c\u4ed6\u548cDalvik\u865a\u62df\u673a\u751f\u547d\u5468\u671f\u4e00\u6837\u957f\uff0c\u6240\u4ee5\u5728\u8fdb\u884c\u5355\u4f8b\u6216\u8005\u9759\u6001\u53d8\u91cf\u7684\u521d\u59cb\u5316\u64cd\u4f5c\u65f6\uff0c\u4e00\u5b9a\u8981\u7528Application\u4f5c\u4e3aContext\u8fdb\u884c\u521d\u59cb\u5316\uff0c\u5426\u5219\u4f1a\u9020\u6210\u5185\u5b58\u6cc4\u6f0f\u7684\u53d1\u751f\u3002\u4f7f\u7528Dialog\u7684\u65f6\u5019\u4e00\u822c\u4f7f\u7528Activity\u7684Context\u3002\u4f46\u662f\u4e5f\u53ef\u4ee5\u4f7f\u7528Application\u4f5c\u4e3a\u4e0a\u4e0b\u6587\uff0c\u524d\u63d0\u662f\u4f60\u5fc5\u987b\u8bbe\u7f6eWindow\u7c7b\u578b\u4e3aTYPE_SYSTME_DAILOG\uff0c\u5e76\u4e14\u7533\u8bf7\u76f8\u5173\u6743\u9650\u3002\u8fd9\u4e2a\u65f6\u5019\u5f39\u51fa\u7684Dialog\u662f\u5c5e\u4e8e\u6574\u4e2aApplication\u7684\uff0c\u5f39\u51fa\u8fd9\u4e2aDialog\u7684Activty\u9500\u6bc1\u65f6\u4e5f\u4e0d\u4f1a\u56de\u6536Dialog\uff0c\u53ea\u6709\u5728Application\u9500\u6bc1\u65f6\uff0c\u8fd9\u4e2aDialog\u624d\u4f1a\u81ea\u52a8\u6d88\u5931\u3002</p>"},{"location":"030Android/010Basic/#android_4","title":"Android \u7cfb\u7edf\u67b6\u6784","text":"\u7b54\u6848 <p>\u5e94\u7528\u5c42 \u5e94\u7528\u6846\u67b6\u5c42 \u7cfb\u7edf\u8fd0\u884c\u5e93\u5c42 \u786c\u4ef6\u62bd\u8c61\u5c42 Linux \u5185\u6838\u5c42</p>"},{"location":"030Android/010Basic/#androidservicekill","title":"Android\u5982\u4f55\u4fdd\u8bc1service\u5728\u540e\u53f0\u4e0d\u88abKill","text":"\u7b54\u6848 <p>\u5728Android\u4e2d\uff0c\u786e\u4fddService\u5728\u540e\u53f0\u4e0d\u88ab\u7cfb\u7edf\u6740\u6b7b\u662f\u4e00\u4e2a\u5e38\u89c1\u7684\u9700\u6c42\uff0c\u5c24\u5176\u662f\u5728\u9700\u8981\u957f\u65f6\u95f4\u8fd0\u884c\u4efb\u52a1\u7684\u573a\u666f\u4e2d\u3002\u4ee5\u4e0b\u662f\u4e00\u4e9b\u5e38\u7528\u7684\u65b9\u6cd5\u6765\u63d0\u9ad8Service\u7684\u5b58\u6d3b\u7387\uff1a</p> <p>\u53ea\u63a8\u8350\u8fd9\u79cd\u65b9\u6848\uff0c\u56e0\u4e3a\u662f\u5bf9\u7528\u6237\u548c\u7cfb\u7edf\u90fd\u597d\u7684\u65b9\u6848\u3002Android\u5e73\u53f0\u652f\u6301\u3002</p>"},{"location":"030Android/010Basic/#1-startforeground","title":"1. \u4f7f\u7528<code>startForeground()</code>\u65b9\u6cd5","text":"<ul> <li>\u524d\u53f0Service\uff1a\u901a\u8fc7\u8c03\u7528<code>startForeground()</code>\u65b9\u6cd5\uff0c\u53ef\u4ee5\u5c06Service\u63d0\u5347\u4e3a\u524d\u53f0Service\u3002\u524d\u53f0Service\u4f1a\u663e\u793a\u4e00\u4e2a\u6301\u7eed\u7684\u901a\u77e5\uff0c\u7cfb\u7edf\u901a\u5e38\u4e0d\u4f1a\u8f7b\u6613\u6740\u6b7b\u524d\u53f0Service\u3002</li> <li>\u793a\u4f8b\u4ee3\u7801\uff1a     <pre><code>public class MyService extends Service {\n    @Override\n    public int onStartCommand(Intent intent, int flags, int startId) {\n        Notification notification = new NotificationCompat.Builder(this, CHANNEL_ID)\n            .setContentTitle(\"Service Running\")\n            .setContentText(\"Service is running in the foreground\")\n            .setSmallIcon(R.drawable.ic_notification)\n            .build();\n        startForeground(1, notification);\n        return START_STICKY;\n    }\n\n    @Override\n    public IBinder onBind(Intent intent) {\n        return null;\n    }\n}\n</code></pre></li> </ul>"},{"location":"030Android/010Basic/#2-start_sticky","title":"2. \u4f7f\u7528<code>START_STICKY</code>\u6807\u5fd7","text":"<ul> <li>START_STICKY\uff1a\u5728<code>onStartCommand()</code>\u65b9\u6cd5\u4e2d\u8fd4\u56de<code>START_STICKY</code>\uff0c\u8868\u793a\u5982\u679cService\u88ab\u7cfb\u7edf\u6740\u6b7b\uff0c\u7cfb\u7edf\u4f1a\u5c1d\u8bd5\u91cd\u65b0\u521b\u5efaService\u3002</li> <li>\u793a\u4f8b\u4ee3\u7801\uff1a     <pre><code>@Override\npublic int onStartCommand(Intent intent, int flags, int startId) {\n    // Your code here\n    return START_STICKY;\n}\n</code></pre></li> </ul>"},{"location":"030Android/010Basic/#3-alarmmanagerworkmanager","title":"3. \u4f7f\u7528<code>AlarmManager</code>\u6216<code>WorkManager</code>","text":"<ul> <li>AlarmManager\uff1a\u53ef\u4ee5\u8bbe\u7f6e\u5b9a\u65f6\u4efb\u52a1\uff0c\u5b9a\u671f\u5524\u9192Service\u6216\u91cd\u65b0\u542f\u52a8Service\u3002</li> <li>WorkManager\uff1a\u9002\u7528\u4e8e\u9700\u8981\u5b9a\u671f\u6267\u884c\u7684\u4efb\u52a1\uff0cWorkManager\u4f1a\u6839\u636e\u8bbe\u5907\u7684\u72b6\u6001\u9009\u62e9\u5408\u9002\u7684\u65f6\u673a\u6267\u884c\u4efb\u52a1\uff0c\u5e76\u4e14\u53ef\u4ee5\u4fdd\u8bc1\u4efb\u52a1\u6700\u7ec8\u4f1a\u88ab\u6267\u884c\u3002</li> <li>\u793a\u4f8b\u4ee3\u7801\uff08AlarmManager\uff09\uff1a     <pre><code>AlarmManager alarmManager = (AlarmManager) getSystemService(Context.ALARM_SERVICE);\nIntent intent = new Intent(this, MyService.class);\nPendingIntent pendingIntent = PendingIntent.getService(this, 0, intent, 0);\nalarmManager.setRepeating(AlarmManager.ELAPSED_REALTIME_WAKEUP, SystemClock.elapsedRealtime(), 60000, pendingIntent);\n</code></pre></li> </ul>"},{"location":"030Android/010Basic/#4-wakelock","title":"4. \u4f7f\u7528<code>WakeLock</code>","text":"<ul> <li>WakeLock\uff1a\u901a\u8fc7\u83b7\u53d6<code>WakeLock</code>\u53ef\u4ee5\u9632\u6b62\u8bbe\u5907\u8fdb\u5165\u4f11\u7720\u72b6\u6001\uff0c\u4ece\u800c\u4fdd\u8bc1Service\u5728\u540e\u53f0\u8fd0\u884c\u3002\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u4f7f\u7528<code>WakeLock</code>\u4f1a\u6d88\u8017\u66f4\u591a\u7535\u91cf\uff0c\u5e94\u8c28\u614e\u4f7f\u7528\u3002</li> <li>\u793a\u4f8b\u4ee3\u7801\uff1a     <pre><code>PowerManager powerManager = (PowerManager) getSystemService(POWER_SERVICE);\nPowerManager.WakeLock wakeLock = powerManager.newWakeLock(PowerManager.PARTIAL_WAKE_LOCK, \"MyApp::MyWakelockTag\");\nwakeLock.acquire();\n// \u91ca\u653eWakeLock\nwakeLock.release();\n</code></pre></li> </ul>"},{"location":"030Android/010Basic/#5-jobscheduler","title":"5. \u4f7f\u7528<code>JobScheduler</code>","text":"<ul> <li>JobScheduler\uff1a\u9002\u7528\u4e8e\u9700\u8981\u5b9a\u671f\u6267\u884c\u7684\u4efb\u52a1\uff0cJobScheduler\u4f1a\u6839\u636e\u8bbe\u5907\u7684\u72b6\u6001\uff08\u5982\u7f51\u7edc\u8fde\u63a5\u3001\u5145\u7535\u72b6\u6001\u7b49\uff09\u6765\u8c03\u5ea6\u4efb\u52a1\uff0c\u4ece\u800c\u51cf\u5c11Service\u88ab\u6740\u6b7b\u7684\u673a\u4f1a\u3002</li> <li>\u793a\u4f8b\u4ee3\u7801\uff1a     <pre><code>JobScheduler jobScheduler = (JobScheduler) getSystemService(Context.JOB_SCHEDULER_SERVICE);\nJobInfo jobInfo = new JobInfo.Builder(1, new ComponentName(this, MyJobService.class))\n    .setRequiredNetworkType(JobInfo.NETWORK_TYPE_ANY)\n    .setPersisted(true)\n    .build();\njobScheduler.schedule(jobInfo);\n</code></pre></li> </ul>"},{"location":"030Android/010Basic/#6-sticky","title":"6. \u4f7f\u7528<code>Sticky</code>\u5e7f\u64ad","text":"<ul> <li>Sticky\u5e7f\u64ad\uff1a\u901a\u8fc7\u53d1\u9001Sticky\u5e7f\u64ad\uff0c\u53ef\u4ee5\u5728\u5e7f\u64ad\u63a5\u6536\u5668\u4e2d\u91cd\u65b0\u542f\u52a8Service\u3002\u8fd9\u79cd\u65b9\u6cd5\u9002\u7528\u4e8e\u67d0\u4e9b\u7279\u5b9a\u573a\u666f\uff0c\u4f46\u4e0d\u5982\u5176\u4ed6\u65b9\u6cd5\u5e38\u89c1\u3002</li> </ul>"},{"location":"030Android/010Basic/#7-service","title":"7. \u4f18\u5316Service\u903b\u8f91","text":"<ul> <li>\u51cf\u5c11\u8d44\u6e90\u5360\u7528\uff1a\u786e\u4fddService\u4e0d\u4f1a\u5360\u7528\u8fc7\u591a\u7684\u7cfb\u7edf\u8d44\u6e90\uff08\u5982CPU\u3001\u5185\u5b58\u7b49\uff09\uff0c\u8fd9\u6837\u53ef\u4ee5\u51cf\u5c11\u7cfb\u7edf\u6740\u6b7bService\u7684\u6982\u7387\u3002</li> <li>\u5408\u7406\u4f7f\u7528\u7ebf\u7a0b\uff1a\u907f\u514d\u5728Service\u4e2d\u6267\u884c\u8017\u65f6\u64cd\u4f5c\uff0c\u53ef\u4ee5\u4f7f\u7528<code>IntentService</code>\u6216<code>HandlerThread</code>\u6765\u5904\u7406\u8017\u65f6\u4efb\u52a1\u3002</li> </ul>"},{"location":"030Android/010Basic/#8-persistent","title":"8. \u4f7f\u7528<code>Persistent</code>\u5c5e\u6027\uff08\u4ec5\u9650\u7cfb\u7edf\u5e94\u7528\uff09","text":"<ul> <li>Persistent\u5c5e\u6027\uff1a\u5bf9\u4e8e\u7cfb\u7edf\u5e94\u7528\uff0c\u53ef\u4ee5\u5728<code>AndroidManifest.xml</code>\u4e2d\u8bbe\u7f6e<code>android:persistent=\"true\"</code>\uff0c\u4f7f\u5e94\u7528\u59cb\u7ec8\u4fdd\u6301\u8fd0\u884c\u72b6\u6001\u3002\u4f46\u8fd9\u79cd\u65b9\u6cd5\u4e0d\u9002\u7528\u4e8e\u666e\u901a\u5e94\u7528\u3002</li> </ul>"},{"location":"030Android/010Basic/#9-sticky-service","title":"9. \u4f7f\u7528<code>Sticky</code> Service","text":"<ul> <li>Sticky Service\uff1a\u901a\u8fc7\u8fd4\u56de<code>START_STICKY</code>\uff0cService\u5728\u88ab\u7cfb\u7edf\u6740\u6b7b\u540e\u4f1a\u5c1d\u8bd5\u91cd\u65b0\u542f\u52a8\u3002\u867d\u7136\u4e0d\u80fd\u4fdd\u8bc1100%\u4e0d\u88ab\u6740\u6b7b\uff0c\u4f46\u53ef\u4ee5\u63d0\u9ad8Service\u7684\u5b58\u6d3b\u7387\u3002</li> </ul>"},{"location":"030Android/010Basic/#10-stopself","title":"10. \u907f\u514d\u4f7f\u7528<code>stopSelf()</code>","text":"<ul> <li>\u907f\u514d\u8fc7\u65e9\u505c\u6b62Service\uff1a\u5728Service\u4e2d\u907f\u514d\u8fc7\u65e9\u8c03\u7528<code>stopSelf()</code>\uff0c\u786e\u4fddService\u5728\u5b8c\u6210\u4efb\u52a1\u540e\u624d\u505c\u6b62\u3002</li> </ul>"},{"location":"030Android/010Basic/#_73","title":"\u603b\u7ed3","text":"<p>\u867d\u7136\u53ef\u4ee5\u901a\u8fc7\u4e0a\u8ff0\u65b9\u6cd5\u63d0\u9ad8Service\u7684\u5b58\u6d3b\u7387\uff0c\u4f46Android\u7cfb\u7edf\u4e3a\u4e86\u4f18\u5316\u8d44\u6e90\u7ba1\u7406\u548c\u7535\u6c60\u5bff\u547d\uff0c\u4ecd\u7136\u53ef\u80fd\u4f1a\u5728\u6781\u7aef\u60c5\u51b5\u4e0b\u6740\u6b7b\u540e\u53f0Service\u3002\u56e0\u6b64\uff0c\u5728\u8bbe\u8ba1\u540e\u53f0\u4efb\u52a1\u65f6\uff0c\u5e94\u5c3d\u91cf\u9075\u5faaAndroid\u7684\u6700\u4f73\u5b9e\u8df5\uff0c\u5408\u7406\u4f7f\u7528\u524d\u53f0Service\u3001JobScheduler\u3001WorkManager\u7b49\u673a\u5236\uff0c\u4ee5\u786e\u4fdd\u4efb\u52a1\u7684\u53ef\u9760\u6267\u884c\u3002</p>"},{"location":"030Android/010Basic/#android-invalidatepostinvalidate","title":"Android invalidate\u548cpostInvalidate\u7684\u533a\u522b\u53ca\u4f7f\u7528","text":"\u7b54\u6848 <p>\u5728 Android \u5f00\u53d1\u4e2d\uff0c<code>invalidate()</code> \u548c <code>postInvalidate()</code> \u90fd\u662f\u7528\u4e8e\u8bf7\u6c42\u91cd\u7ed8\u89c6\u56fe\u7684\u65b9\u6cd5\uff0c\u4f46\u5b83\u4eec\u7684\u8c03\u7528\u573a\u666f\u548c\u7ebf\u7a0b\u4f7f\u7528\u6709\u6240\u4e0d\u540c\u3002</p>"},{"location":"030Android/010Basic/#1-invalidate","title":"1. <code>invalidate()</code>","text":"<ul> <li>\u8c03\u7528\u7ebf\u7a0b\uff1a\u5fc5\u987b\u5728 UI \u7ebf\u7a0b\uff08\u4e3b\u7ebf\u7a0b\uff09\u4e2d\u8c03\u7528\u3002</li> <li>\u4f5c\u7528\uff1a\u6807\u8bb0\u89c6\u56fe\u7684\u67d0\u4e00\u90e8\u5206\u4e3a\u65e0\u6548\uff0c\u8bf7\u6c42\u7cfb\u7edf\u5728\u4e0b\u4e00\u6b21\u7ed8\u5236\u5468\u671f\u4e2d\u91cd\u7ed8\u8be5\u90e8\u5206\u3002</li> <li>\u4f7f\u7528\u573a\u666f\uff1a\u901a\u5e38\u5728 UI \u7ebf\u7a0b\u4e2d\u76f4\u63a5\u64cd\u4f5c\u89c6\u56fe\u65f6\u4f7f\u7528\u3002</li> </ul> <pre><code>// \u5728 UI \u7ebf\u7a0b\u4e2d\u8c03\u7528\nview.invalidate();\n</code></pre>"},{"location":"030Android/010Basic/#2-postinvalidate","title":"2. <code>postInvalidate()</code>","text":"<ul> <li>\u8c03\u7528\u7ebf\u7a0b\uff1a\u53ef\u4ee5\u5728\u975e UI \u7ebf\u7a0b\uff08\u5b50\u7ebf\u7a0b\uff09\u4e2d\u8c03\u7528\u3002</li> <li>\u4f5c\u7528\uff1a\u4e0e <code>invalidate()</code> \u7c7b\u4f3c\uff0c\u6807\u8bb0\u89c6\u56fe\u7684\u67d0\u4e00\u90e8\u5206\u4e3a\u65e0\u6548\uff0c\u8bf7\u6c42\u7cfb\u7edf\u5728\u4e0b\u4e00\u6b21\u7ed8\u5236\u5468\u671f\u4e2d\u91cd\u7ed8\u8be5\u90e8\u5206\u3002\u4f46\u5b83\u5185\u90e8\u901a\u8fc7 Handler \u673a\u5236\u5c06\u91cd\u7ed8\u8bf7\u6c42\u53d1\u9001\u5230 UI \u7ebf\u7a0b\u6267\u884c\u3002</li> <li>\u4f7f\u7528\u573a\u666f\uff1a\u5728\u5b50\u7ebf\u7a0b\u4e2d\u66f4\u65b0\u89c6\u56fe\u65f6\u4f7f\u7528\u3002</li> </ul> <pre><code>// \u5728\u975e UI \u7ebf\u7a0b\u4e2d\u8c03\u7528\nview.postInvalidate();\n</code></pre>"},{"location":"030Android/010Basic/#3_11","title":"3. \u533a\u522b\u603b\u7ed3","text":"\u7279\u6027 <code>invalidate()</code> <code>postInvalidate()</code> \u8c03\u7528\u7ebf\u7a0b \u5fc5\u987b\u5728 UI \u7ebf\u7a0b\u4e2d\u8c03\u7528 \u53ef\u4ee5\u5728\u975e UI \u7ebf\u7a0b\u4e2d\u8c03\u7528 \u5185\u90e8\u673a\u5236 \u76f4\u63a5\u8bf7\u6c42\u91cd\u7ed8 \u901a\u8fc7 Handler \u5c06\u8bf7\u6c42\u53d1\u9001\u5230 UI \u7ebf\u7a0b \u4f7f\u7528\u573a\u666f UI \u7ebf\u7a0b\u4e2d\u76f4\u63a5\u64cd\u4f5c\u89c6\u56fe\u65f6\u4f7f\u7528 \u5b50\u7ebf\u7a0b\u4e2d\u66f4\u65b0\u89c6\u56fe\u65f6\u4f7f\u7528"},{"location":"030Android/010Basic/#4_9","title":"4. \u793a\u4f8b\u4ee3\u7801","text":"<pre><code>public class CustomView extends View {\n    private int mValue;\n\n    public CustomView(Context context) {\n        super(context);\n    }\n\n    @Override\n    protected void onDraw(Canvas canvas) {\n        super.onDraw(canvas);\n        // \u7ed8\u5236\u903b\u8f91\n        canvas.drawText(\"Value: \" + mValue, 50, 50, new Paint());\n    }\n\n    public void updateValue(int newValue) {\n        mValue = newValue;\n        // \u5728 UI \u7ebf\u7a0b\u4e2d\u8c03\u7528\n        invalidate();\n    }\n\n    public void updateValueInBackground(final int newValue) {\n        new Thread(new Runnable() {\n            @Override\n            public void run() {\n                mValue = newValue;\n                // \u5728\u975e UI \u7ebf\u7a0b\u4e2d\u8c03\u7528\n                postInvalidate();\n            }\n        }).start();\n    }\n}\n</code></pre>"},{"location":"030Android/010Basic/#5_7","title":"5. \u603b\u7ed3","text":"<ul> <li><code>invalidate()</code>\uff1a\u9002\u7528\u4e8e\u5728 UI \u7ebf\u7a0b\u4e2d\u76f4\u63a5\u64cd\u4f5c\u89c6\u56fe\u65f6\u4f7f\u7528\u3002</li> <li><code>postInvalidate()</code>\uff1a\u9002\u7528\u4e8e\u5728\u5b50\u7ebf\u7a0b\u4e2d\u66f4\u65b0\u89c6\u56fe\u65f6\u4f7f\u7528\uff0c\u786e\u4fdd\u91cd\u7ed8\u8bf7\u6c42\u80fd\u591f\u5728 UI \u7ebf\u7a0b\u4e2d\u6267\u884c\u3002</li> </ul> <p>\u6839\u636e\u5177\u4f53\u7684\u573a\u666f\u9009\u62e9\u5408\u9002\u7684\u65b9\u6cd5\uff0c\u53ef\u4ee5\u907f\u514d\u7ebf\u7a0b\u5b89\u5168\u95ee\u9898\u5e76\u63d0\u9ad8\u4ee3\u7801\u7684\u53ef\u7ef4\u62a4\u6027\u3002</p>"},{"location":"030Android/010Basic/#android-javanative","title":"Android Java\u5d29\u6e83\u539f\u7406\uff0cNative\u5c42\u5d29\u6e83\u539f\u7406","text":"\u7b54\u6848 <p>\u5728Android\u5f00\u53d1\u4e2d\uff0c\u5d29\u6e83\u901a\u5e38\u53d1\u751f\u5728Java\u5c42\u6216Native\u5c42\uff08C/C++\uff09\u3002\u4ee5\u4e0b\u662f\u4e24\u8005\u7684\u5d29\u6e83\u539f\u7406\uff1a</p>"},{"location":"030Android/010Basic/#1-java","title":"1. Java\u5c42\u5d29\u6e83\u539f\u7406","text":"<p>Java\u5c42\u5d29\u6e83\u901a\u5e38\u7531\u672a\u6355\u83b7\u7684\u5f02\u5e38\u5f15\u53d1\uff0c\u5e38\u89c1\u7684\u5f02\u5e38\u5305\u62ec\uff1a - NullPointerException\uff1a\u7a7a\u5bf9\u8c61\u5f15\u7528\u3002 - ArrayIndexOutOfBoundsException\uff1a\u6570\u7ec4\u8d8a\u754c\u3002 - IllegalStateException\uff1a\u5bf9\u8c61\u72b6\u6001\u975e\u6cd5\u3002 - ClassCastException\uff1a\u7c7b\u578b\u8f6c\u6362\u9519\u8bef\u3002</p>"},{"location":"030Android/010Basic/#_74","title":"\u5d29\u6e83\u6d41\u7a0b\uff1a","text":"<ol> <li>\u5f02\u5e38\u629b\u51fa\uff1a\u4ee3\u7801\u629b\u51fa\u5f02\u5e38\u3002</li> <li>\u5f02\u5e38\u4f20\u64ad\uff1a\u82e5\u672a\u6355\u83b7\uff0c\u5f02\u5e38\u6cbf\u8c03\u7528\u6808\u5411\u4e0a\u4f20\u64ad\u3002</li> <li>\u9ed8\u8ba4\u5904\u7406\uff1a\u82e5\u672a\u6355\u83b7\uff0c\u6700\u7ec8\u7531\u9ed8\u8ba4\u5f02\u5e38\u5904\u7406\u5668\u5904\u7406\u3002</li> <li>\u5e94\u7528\u5d29\u6e83\uff1a\u9ed8\u8ba4\u5904\u7406\u5668\u7ec8\u6b62\u5e94\u7528\uff0c\u663e\u793a\u5d29\u6e83\u5bf9\u8bdd\u6846\u3002</li> </ol>"},{"location":"030Android/010Basic/#_75","title":"\u793a\u4f8b\uff1a","text":"<pre><code>public void crash() {\n    String str = null;\n    str.length(); // \u629b\u51faNullPointerException\n}\n</code></pre>"},{"location":"030Android/010Basic/#2-native","title":"2. Native\u5c42\u5d29\u6e83\u539f\u7406","text":"<p>Native\u5c42\u5d29\u6e83\u901a\u5e38\u7531\u4ee5\u4e0b\u539f\u56e0\u5f15\u53d1\uff1a - \u6bb5\u9519\u8bef\uff08Segmentation Fault\uff09\uff1a\u8bbf\u95ee\u975e\u6cd5\u5185\u5b58\u3002 - \u9664\u96f6\u9519\u8bef\uff1a\u6574\u6570\u9664\u4ee5\u96f6\u3002 - \u6808\u6ea2\u51fa\uff1a\u9012\u5f52\u8fc7\u6df1\u6216\u6808\u7a7a\u95f4\u4e0d\u8db3\u3002 - \u672a\u5b9a\u4e49\u884c\u4e3a\uff1a\u5982\u4f7f\u7528\u672a\u521d\u59cb\u5316\u53d8\u91cf\u3002</p>"},{"location":"030Android/010Basic/#_76","title":"\u5d29\u6e83\u6d41\u7a0b\uff1a","text":"<ol> <li>\u4fe1\u53f7\u89e6\u53d1\uff1a\u53d1\u751f\u9519\u8bef\u65f6\uff0c\u64cd\u4f5c\u7cfb\u7edf\u53d1\u9001\u4fe1\u53f7\uff08\u5982SIGSEGV\uff09\u3002</li> <li>\u4fe1\u53f7\u5904\u7406\uff1a\u82e5\u672a\u5904\u7406\uff0c\u9ed8\u8ba4\u884c\u4e3a\u662f\u7ec8\u6b62\u8fdb\u7a0b\u3002</li> <li>\u751f\u6210\u65e5\u5fd7\uff1a\u7cfb\u7edf\u751f\u6210tombstone\u6587\u4ef6\uff0c\u8bb0\u5f55\u5d29\u6e83\u4fe1\u606f\u3002</li> </ol>"},{"location":"030Android/010Basic/#_77","title":"\u793a\u4f8b\uff1a","text":"<pre><code>#include &lt;jni.h&gt;\n\nvoid crash() {\n    int* ptr = nullptr;\n    *ptr = 1; // \u6bb5\u9519\u8bef\n}\n\nextern \"C\"\nJNIEXPORT void JNICALL\nJava_com_example_MainActivity_nativeCrash(JNIEnv *env, jobject thiz) {\n    crash();\n}\n</code></pre>"},{"location":"030Android/010Basic/#3_12","title":"3. \u5d29\u6e83\u65e5\u5fd7\u5206\u6790","text":"<ul> <li>Java\u5d29\u6e83\u65e5\u5fd7\uff1a\u5305\u542b\u5f02\u5e38\u7c7b\u578b\u3001\u8c03\u7528\u6808\u7b49\u4fe1\u606f\u3002</li> <li>Native\u5d29\u6e83\u65e5\u5fd7\uff1a\u5305\u542b\u4fe1\u53f7\u7c7b\u578b\u3001\u5bc4\u5b58\u5668\u72b6\u6001\u3001\u8c03\u7528\u6808\u7b49\u3002</li> </ul>"},{"location":"030Android/010Basic/#4_10","title":"4. \u8c03\u8bd5\u5de5\u5177","text":"<ul> <li>Java\u5c42\uff1aAndroid Studio\u3001Logcat\u3002</li> <li>Native\u5c42\uff1aGDB\u3001LLDB\u3001addr2line\u3001ndk-stack\u3002</li> </ul>"},{"location":"030Android/010Basic/#5_8","title":"5. \u9884\u9632\u63aa\u65bd","text":"<ul> <li>Java\u5c42\uff1a\u6355\u83b7\u5f02\u5e38\u3001\u4ee3\u7801\u5ba1\u67e5\u3001\u5355\u5143\u6d4b\u8bd5\u3002</li> <li>Native\u5c42\uff1a\u5185\u5b58\u7ba1\u7406\u68c0\u67e5\u3001\u4f7f\u7528\u667a\u80fd\u6307\u9488\u3001\u4ee3\u7801\u5ba1\u67e5\u3001\u5355\u5143\u6d4b\u8bd5\u3002</li> </ul>"},{"location":"030Android/010Basic/#_78","title":"\u603b\u7ed3","text":"<ul> <li>Java\u5c42\u5d29\u6e83\uff1a\u7531\u672a\u6355\u83b7\u5f02\u5e38\u5f15\u53d1\uff0c\u8c03\u7528\u6808\u4f20\u64ad\u81f3\u9ed8\u8ba4\u5904\u7406\u5668\u3002</li> <li>Native\u5c42\u5d29\u6e83\uff1a\u7531\u5185\u5b58\u9519\u8bef\u7b49\u5f15\u53d1\uff0c\u64cd\u4f5c\u7cfb\u7edf\u53d1\u9001\u4fe1\u53f7\u7ec8\u6b62\u8fdb\u7a0b\u3002</li> </ul> <p>\u901a\u8fc7\u7406\u89e3\u5d29\u6e83\u539f\u7406\u548c\u4f7f\u7528\u8c03\u8bd5\u5de5\u5177\uff0c\u53ef\u4ee5\u6709\u6548\u5b9a\u4f4d\u548c\u4fee\u590d\u95ee\u9898\u3002</p> <p>\u5728Android\u5f00\u53d1\u4e2d\uff0c\u6355\u83b7Java\u5c42\u548cNative\u5c42\u7684\u5d29\u6e83\u4fe1\u606f\u662f\u5b9a\u4f4d\u95ee\u9898\u7684\u5173\u952e\u3002\u4ee5\u4e0b\u662f\u5177\u4f53\u7684\u6355\u83b7\u65b9\u6cd5\u548c\u5de5\u5177\uff1a</p>"},{"location":"030Android/010Basic/#1-java_1","title":"1. \u6355\u83b7Java\u5c42\u5d29\u6e83","text":"<p>Java\u5c42\u7684\u5d29\u6e83\u901a\u5e38\u7531\u672a\u6355\u83b7\u7684\u5f02\u5e38\u5f15\u53d1\uff0c\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u65b9\u5f0f\u6355\u83b7\uff1a</p>"},{"location":"030Android/010Basic/#1-uncaughtexceptionhandler","title":"(1) \u5168\u5c40\u5f02\u5e38\u6355\u83b7\uff08UncaughtExceptionHandler\uff09","text":"<p>\u901a\u8fc7\u8bbe\u7f6e<code>Thread.setDefaultUncaughtExceptionHandler</code>\uff0c\u53ef\u4ee5\u6355\u83b7\u6240\u6709\u672a\u5904\u7406\u7684\u5f02\u5e38\u3002</p> <pre><code>public class MyApplication extends Application {\n    @Override\n    public void onCreate() {\n        super.onCreate();\n        Thread.setDefaultUncaughtExceptionHandler(new Thread.UncaughtExceptionHandler() {\n            @Override\n            public void uncaughtException(Thread thread, Throwable throwable) {\n                // \u8bb0\u5f55\u5d29\u6e83\u4fe1\u606f\n                Log.e(\"Crash\", \"Thread: \" + thread.getName(), throwable);\n                // \u5c06\u5d29\u6e83\u4fe1\u606f\u4fdd\u5b58\u5230\u6587\u4ef6\u6216\u4e0a\u4f20\u5230\u670d\u52a1\u5668\n                saveCrashLog(throwable);\n                // \u9000\u51fa\u5e94\u7528\n                System.exit(1);\n            }\n        });\n    }\n\n    private void saveCrashLog(Throwable throwable) {\n        String log = Log.getStackTraceString(throwable);\n        // \u5c06log\u4fdd\u5b58\u5230\u6587\u4ef6\u6216\u4e0a\u4f20\u5230\u670d\u52a1\u5668\n    }\n}\n</code></pre>"},{"location":"030Android/010Basic/#2_9","title":"(2) \u4f7f\u7528\u7b2c\u4e09\u65b9\u5d29\u6e83\u76d1\u63a7\u5de5\u5177","text":"<p>\u8bb8\u591a\u7b2c\u4e09\u65b9\u5de5\u5177\u53ef\u4ee5\u81ea\u52a8\u6355\u83b7\u5d29\u6e83\u4fe1\u606f\u5e76\u4e0a\u4f20\u5230\u670d\u52a1\u5668\uff0c\u4f8b\u5982\uff1a - Firebase Crashlytics - Sentry - Bugsnag - \u817e\u8bafBugly</p> <p>\u8fd9\u4e9b\u5de5\u5177\u901a\u5e38\u53ea\u9700\u7b80\u5355\u96c6\u6210\uff0c\u5373\u53ef\u81ea\u52a8\u6355\u83b7\u5d29\u6e83\u4fe1\u606f\u5e76\u63d0\u4f9b\u8be6\u7ec6\u7684\u5206\u6790\u62a5\u544a\u3002</p>"},{"location":"030Android/010Basic/#2-native_1","title":"2. \u6355\u83b7Native\u5c42\u5d29\u6e83","text":"<p>Native\u5c42\u7684\u5d29\u6e83\u901a\u5e38\u7531\u4fe1\u53f7\uff08\u5982SIGSEGV\u3001SIGABRT\uff09\u5f15\u53d1\uff0c\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u65b9\u5f0f\u6355\u83b7\uff1a</p>"},{"location":"030Android/010Basic/#1-signal-handler","title":"(1) \u4fe1\u53f7\u6355\u83b7\uff08Signal Handler\uff09","text":"<p>\u901a\u8fc7\u8bbe\u7f6e\u4fe1\u53f7\u5904\u7406\u5668\uff0c\u53ef\u4ee5\u6355\u83b7Native\u5c42\u7684\u5d29\u6e83\u4fe1\u53f7\u3002</p> <pre><code>#include &lt;signal.h&gt;\n#include &lt;android/log.h&gt;\n#include &lt;unistd.h&gt;\n\n#define TAG \"NativeCrash\"\n\nvoid signalHandler(int signal, siginfo_t* info, void* context) {\n    const char* signalName = \"\";\n    switch (signal) {\n        case SIGSEGV:\n            signalName = \"SIGSEGV\";\n            break;\n        case SIGABRT:\n            signalName = \"SIGABRT\";\n            break;\n        case SIGILL:\n            signalName = \"SIGILL\";\n            break;\n        case SIGFPE:\n            signalName = \"SIGFPE\";\n            break;\n        default:\n            signalName = \"Unknown\";\n            break;\n    }\n    __android_log_print(ANDROID_LOG_ERROR, TAG, \"Received signal %d (%s), code %d, fault address %p\",\n                        signal, signalName, info-&gt;si_code, info-&gt;si_addr);\n\n    // \u6253\u5370\u8c03\u7528\u6808\n    printStackTrace();\n\n    // \u9000\u51fa\u7a0b\u5e8f\n    _exit(1);\n}\n\nvoid setupSignalHandler() {\n    struct sigaction sa;\n    sa.sa_flags = SA_SIGINFO;\n    sa.sa_sigaction = signalHandler;\n    sigemptyset(&amp;sa.sa_mask);\n\n    sigaction(SIGSEGV, &amp;sa, nullptr); // \u6bb5\u9519\u8bef\n    sigaction(SIGABRT, &amp;sa, nullptr); // \u5f02\u5e38\u7ec8\u6b62\n    sigaction(SIGILL, &amp;sa, nullptr);  // \u975e\u6cd5\u6307\u4ee4\n    sigaction(SIGFPE, &amp;sa, nullptr);  // \u6d6e\u70b9\u5f02\u5e38\n}\n\nvoid printStackTrace() {\n    // \u4f7f\u7528libunwind\u6216Android\u81ea\u5e26\u7684\u5de5\u5177\u6253\u5370\u8c03\u7528\u6808\n    // \u4f8b\u5982\uff1a__android_log_print(ANDROID_LOG_ERROR, TAG, \"Stack trace: %s\", stackTrace);\n}\n</code></pre> <p>\u5728JNI\u521d\u59cb\u5316\u65f6\u8c03\u7528<code>setupSignalHandler</code>\uff1a</p> <pre><code>JNIEXPORT jint JNI_OnLoad(JavaVM* vm, void* reserved) {\n    setupSignalHandler();\n    return JNI_VERSION_1_6;\n}\n</code></pre>"},{"location":"030Android/010Basic/#2-breakpad","title":"(2) \u4f7f\u7528Breakpad","text":"<p>Google Breakpad \u662f\u4e00\u4e2a\u8de8\u5e73\u53f0\u7684\u5d29\u6e83\u6355\u83b7\u5de5\u5177\uff0c\u652f\u6301Android Native\u5c42\u5d29\u6e83\u6355\u83b7\u3002</p> <p>\u6b65\u9aa4\uff1a 1. \u4e0b\u8f7d\u5e76\u7f16\u8bd1Breakpad\u3002 2. \u96c6\u6210Breakpad\u5230\u9879\u76ee\u4e2d\u3002 3. \u521d\u59cb\u5316Breakpad\u5e76\u8bbe\u7f6e\u5d29\u6e83\u6587\u4ef6\u8f93\u51fa\u8def\u5f84\u3002</p> <pre><code>#include \"client/linux/handler/exception_handler.h\"\n\nbool dumpCallback(const google_breakpad::MinidumpDescriptor&amp; descriptor, void* context, bool succeeded) {\n    __android_log_print(ANDROID_LOG_ERROR, TAG, \"Minidump saved to %s\", descriptor.path());\n    return succeeded;\n}\n\nvoid setupBreakpad() {\n    static google_breakpad::MinidumpDescriptor descriptor(\"/sdcard/crash_dumps\");\n    static google_breakpad::ExceptionHandler eh(descriptor, nullptr, dumpCallback, nullptr, true, -1);\n}\n</code></pre> <p>\u5728JNI\u521d\u59cb\u5316\u65f6\u8c03\u7528<code>setupBreakpad</code>\u3002</p>"},{"location":"030Android/010Basic/#3_13","title":"(3) \u4f7f\u7528\u7b2c\u4e09\u65b9\u5de5\u5177","text":"<p>\u8bb8\u591a\u7b2c\u4e09\u65b9\u5de5\u5177\u4e5f\u652f\u6301Native\u5c42\u5d29\u6e83\u6355\u83b7\uff0c\u4f8b\u5982\uff1a - Firebase Crashlytics - Sentry - \u817e\u8bafBugly</p> <p>\u8fd9\u4e9b\u5de5\u5177\u901a\u5e38\u63d0\u4f9b\u7b80\u5355\u7684API\u6765\u6355\u83b7Native\u5d29\u6e83\uff0c\u5e76\u81ea\u52a8\u4e0a\u4f20\u5d29\u6e83\u65e5\u5fd7\u3002</p>"},{"location":"030Android/010Basic/#3_14","title":"3. \u5206\u6790\u5d29\u6e83\u65e5\u5fd7","text":"<p>\u6355\u83b7\u5d29\u6e83\u4fe1\u606f\u540e\uff0c\u9700\u8981\u5206\u6790\u65e5\u5fd7\u4ee5\u5b9a\u4f4d\u95ee\u9898\u3002</p>"},{"location":"030Android/010Basic/#1-java_2","title":"(1) Java\u5c42\u5d29\u6e83\u65e5\u5fd7","text":"<ul> <li>\u65e5\u5fd7\u4e2d\u5305\u542b\u5f02\u5e38\u7c7b\u578b\u3001\u8c03\u7528\u6808\u7b49\u4fe1\u606f\u3002</li> <li>\u4f7f\u7528Android Studio\u7684Logcat\u67e5\u770b\u65e5\u5fd7\u3002</li> </ul>"},{"location":"030Android/010Basic/#2-native_2","title":"(2) Native\u5c42\u5d29\u6e83\u65e5\u5fd7","text":"<ul> <li>\u5982\u679c\u4f7f\u7528\u4fe1\u53f7\u6355\u83b7\uff0c\u65e5\u5fd7\u4e2d\u4f1a\u5305\u542b\u4fe1\u53f7\u7c7b\u578b\u3001\u5bc4\u5b58\u5668\u72b6\u6001\u7b49\u4fe1\u606f\u3002</li> <li>\u5982\u679c\u4f7f\u7528Breakpad\uff0c\u751f\u6210\u7684minidump\u6587\u4ef6\u9700\u8981\u4f7f\u7528<code>minidump_stackwalk</code>\u5de5\u5177\u89e3\u6790\uff1a <pre><code>minidump_stackwalk crash.dmp &gt; crash.log\n</code></pre></li> <li>\u4f7f\u7528<code>addr2line</code>\u6216<code>ndk-stack</code>\u5c06\u5730\u5740\u8f6c\u6362\u4e3a\u6e90\u7801\u884c\u53f7\uff1a <pre><code>ndk-stack -sym &lt;so\u6587\u4ef6\u8def\u5f84&gt; -dump crash.log\n</code></pre></li> </ul>"},{"location":"030Android/010Basic/#4_11","title":"4. \u8c03\u8bd5\u5de5\u5177","text":"<ul> <li>Java\u5c42\uff1aAndroid Studio\u3001Logcat\u3002</li> <li>Native\u5c42\uff1aGDB\u3001LLDB\u3001addr2line\u3001ndk-stack\u3002</li> </ul>"},{"location":"030Android/010Basic/#_79","title":"\u603b\u7ed3","text":"<ul> <li>Java\u5c42\u5d29\u6e83\uff1a\u901a\u8fc7<code>UncaughtExceptionHandler</code>\u6216\u7b2c\u4e09\u65b9\u5de5\u5177\u6355\u83b7\u3002</li> <li>Native\u5c42\u5d29\u6e83\uff1a\u901a\u8fc7\u4fe1\u53f7\u5904\u7406\u5668\u3001Breakpad\u6216\u7b2c\u4e09\u65b9\u5de5\u5177\u6355\u83b7\u3002</li> <li>\u65e5\u5fd7\u5206\u6790\uff1a\u4f7f\u7528\u5de5\u5177\u89e3\u6790\u65e5\u5fd7\uff0c\u5b9a\u4f4d\u95ee\u9898\u3002</li> </ul> <p>\u901a\u8fc7\u4ee5\u4e0a\u65b9\u6cd5\uff0c\u53ef\u4ee5\u6709\u6548\u6355\u83b7\u548c\u5206\u6790\u5d29\u6e83\u4fe1\u606f\uff0c\u5feb\u901f\u5b9a\u4f4d\u548c\u4fee\u590d\u95ee\u9898\u3002</p>"},{"location":"030Android/010Basic/#bugly","title":"Bugly\u6355\u83b7\u5d29\u6e83\u7684\u539f\u7406","text":"\u7b54\u6848 <p>\u662f\u7684\uff0cBugly \u6355\u83b7\u5d29\u6e83\u7684\u539f\u7406\u4e0e\u4e0a\u8ff0\u65b9\u6848\u7c7b\u4f3c\uff0c\u4f46\u5b83\u662f\u4e00\u4e2a\u66f4\u4e3a\u6210\u719f\u548c\u5168\u9762\u7684\u89e3\u51b3\u65b9\u6848\uff0c\u96c6\u6210\u4e86Java\u5c42\u548cNative\u5c42\u7684\u5d29\u6e83\u6355\u83b7\u80fd\u529b\uff0c\u5e76\u63d0\u4f9b\u4e86\u4e30\u5bcc\u7684\u5206\u6790\u548c\u4e0a\u62a5\u529f\u80fd\u3002\u4ee5\u4e0b\u662f Bugly \u6355\u83b7\u5d29\u6e83\u7684\u539f\u7406\u53ca\u5176\u4e0e\u4e0a\u8ff0\u65b9\u6848\u7684\u5bf9\u6bd4\uff1a</p>"},{"location":"030Android/010Basic/#1-java_3","title":"1. Java\u5c42\u5d29\u6e83\u6355\u83b7","text":"<p>Bugly \u5728 Java \u5c42\u7684\u5d29\u6e83\u6355\u83b7\u539f\u7406\u4e0e <code>UncaughtExceptionHandler</code> \u7c7b\u4f3c\uff0c\u4f46\u66f4\u52a0\u5b8c\u5584\u3002</p>"},{"location":"030Android/010Basic/#_80","title":"\u539f\u7406\uff1a","text":"<ul> <li>\u5168\u5c40\u5f02\u5e38\u6355\u83b7\uff1a Bugly \u901a\u8fc7 <code>Thread.setDefaultUncaughtExceptionHandler</code> \u8bbe\u7f6e\u5168\u5c40\u5f02\u5e38\u5904\u7406\u5668\uff0c\u6355\u83b7\u6240\u6709\u672a\u5904\u7406\u7684\u5f02\u5e38\u3002</li> <li>ANR \u76d1\u63a7\uff1a Bugly \u8fd8\u4f1a\u76d1\u63a7\u4e3b\u7ebf\u7a0b\u7684\u5361\u987f\u60c5\u51b5\uff0c\u68c0\u6d4b ANR\uff08Application Not Responding\uff09\u95ee\u9898\u3002</li> </ul>"},{"location":"030Android/010Basic/#_81","title":"\u4e0e\u624b\u52a8\u65b9\u6848\u7684\u5bf9\u6bd4\uff1a","text":"<ul> <li>\u624b\u52a8\u65b9\u6848\uff1a\u9700\u8981\u81ea\u5df1\u5b9e\u73b0 <code>UncaughtExceptionHandler</code>\uff0c\u5e76\u624b\u52a8\u4fdd\u5b58\u6216\u4e0a\u4f20\u65e5\u5fd7\u3002</li> <li>Bugly\uff1a\u81ea\u52a8\u6355\u83b7\u5f02\u5e38\uff0c\u5e76\u63d0\u4f9b\u4e86\u65e5\u5fd7\u4e0a\u4f20\u3001\u7b26\u53f7\u8868\u89e3\u6790\u3001\u5d29\u6e83\u5206\u6790\u7b49\u529f\u80fd\u3002</li> </ul>"},{"location":"030Android/010Basic/#2-native_3","title":"2. Native\u5c42\u5d29\u6e83\u6355\u83b7","text":"<p>Bugly \u5728 Native \u5c42\u7684\u5d29\u6e83\u6355\u83b7\u539f\u7406\u4e0e\u4fe1\u53f7\u5904\u7406\u5668\u548c Breakpad \u7c7b\u4f3c\uff0c\u4f46\u66f4\u52a0\u6613\u7528\u548c\u7a33\u5b9a\u3002</p>"},{"location":"030Android/010Basic/#_82","title":"\u539f\u7406\uff1a","text":"<ul> <li>\u4fe1\u53f7\u6355\u83b7\uff1a Bugly \u901a\u8fc7\u8bbe\u7f6e\u4fe1\u53f7\u5904\u7406\u5668\uff08\u5982 <code>SIGSEGV</code>\u3001<code>SIGABRT</code> \u7b49\uff09\u6355\u83b7 Native \u5c42\u7684\u5d29\u6e83\u4fe1\u53f7\u3002</li> <li>Breakpad \u96c6\u6210\uff1a Bugly \u57fa\u4e8e Google Breakpad \u5b9e\u73b0\u4e86\u8de8\u5e73\u53f0\u7684 Native \u5d29\u6e83\u6355\u83b7\uff0c\u80fd\u591f\u751f\u6210 minidump \u6587\u4ef6\u5e76\u4e0a\u4f20\u5230\u670d\u52a1\u5668\u3002</li> <li>\u7b26\u53f7\u8868\u89e3\u6790\uff1a Bugly \u652f\u6301\u4e0a\u4f20 so \u6587\u4ef6\u7684\u7b26\u53f7\u8868\uff0c\u81ea\u52a8\u89e3\u6790\u5d29\u6e83\u5806\u6808\uff0c\u5b9a\u4f4d\u5230\u5177\u4f53\u7684\u4ee3\u7801\u884c\u3002</li> </ul>"},{"location":"030Android/010Basic/#_83","title":"\u4e0e\u624b\u52a8\u65b9\u6848\u7684\u5bf9\u6bd4\uff1a","text":"<ul> <li>\u624b\u52a8\u65b9\u6848\uff1a\u9700\u8981\u81ea\u5df1\u5b9e\u73b0\u4fe1\u53f7\u5904\u7406\u5668\u6216\u96c6\u6210 Breakpad\uff0c\u5e76\u624b\u52a8\u89e3\u6790 minidump \u6587\u4ef6\u3002</li> <li>Bugly\uff1a\u81ea\u52a8\u6355\u83b7 Native \u5d29\u6e83\uff0c\u751f\u6210 minidump \u6587\u4ef6\u5e76\u4e0a\u4f20\uff0c\u652f\u6301\u7b26\u53f7\u8868\u89e3\u6790\u548c\u5d29\u6e83\u5206\u6790\u3002</li> </ul>"},{"location":"030Android/010Basic/#3-bugly","title":"3. Bugly \u7684\u6838\u5fc3\u529f\u80fd","text":"<p>Bugly \u4e0d\u4ec5\u63d0\u4f9b\u4e86\u5d29\u6e83\u6355\u83b7\u529f\u80fd\uff0c\u8fd8\u96c6\u6210\u4e86\u4ee5\u4e0b\u7279\u6027\uff1a - \u5b9e\u65f6\u4e0a\u62a5\uff1a\u5d29\u6e83\u4fe1\u606f\u5b9e\u65f6\u4e0a\u4f20\u5230\u670d\u52a1\u5668\uff0c\u5f00\u53d1\u8005\u53ef\u4ee5\u5feb\u901f\u67e5\u770b\u3002 - \u591a\u7ef4\u5ea6\u5206\u6790\uff1a\u63d0\u4f9b\u5d29\u6e83\u6b21\u6570\u3001\u5f71\u54cd\u7528\u6237\u6570\u3001\u8bbe\u5907\u5206\u5e03\u7b49\u591a\u7ef4\u5ea6\u5206\u6790\u3002 - \u7b26\u53f7\u8868\u89e3\u6790\uff1a\u652f\u6301\u4e0a\u4f20 so \u6587\u4ef6\u7684\u7b26\u53f7\u8868\uff0c\u89e3\u6790 Native \u5d29\u6e83\u5806\u6808\u3002 - ANR \u76d1\u63a7\uff1a\u81ea\u52a8\u68c0\u6d4b\u4e3b\u7ebf\u7a0b\u5361\u987f\u548c ANR \u95ee\u9898\u3002 - \u81ea\u5b9a\u4e49\u65e5\u5fd7\uff1a\u652f\u6301\u5f00\u53d1\u8005\u4e0a\u4f20\u81ea\u5b9a\u4e49\u65e5\u5fd7\uff0c\u8f85\u52a9\u5b9a\u4f4d\u95ee\u9898\u3002</p>"},{"location":"030Android/010Basic/#4-bugly","title":"4. Bugly \u7684\u4f7f\u7528","text":""},{"location":"030Android/010Basic/#1-bugly","title":"(1) \u96c6\u6210 Bugly","text":"<p>\u5728 <code>build.gradle</code> \u4e2d\u6dfb\u52a0\u4f9d\u8d56\uff1a <pre><code>dependencies {\n    implementation 'com.tencent.bugly:crashreport:latest.version'\n}\n</code></pre></p>"},{"location":"030Android/010Basic/#2-bugly","title":"(2) \u521d\u59cb\u5316 Bugly","text":"<p>\u5728 <code>Application</code> \u4e2d\u521d\u59cb\u5316 Bugly\uff1a <pre><code>public class MyApplication extends Application {\n    @Override\n    public void onCreate() {\n        super.onCreate();\n        Bugly.init(this, \"YOUR_APP_ID\", false);\n    }\n}\n</code></pre></p>"},{"location":"030Android/010Basic/#3-native","title":"(3) \u914d\u7f6e\u7b26\u53f7\u8868\uff08Native \u5d29\u6e83\uff09","text":"<ul> <li>\u5c06 so \u6587\u4ef6\u4e0a\u4f20\u5230 Bugly \u540e\u53f0\uff0c\u751f\u6210\u7b26\u53f7\u8868\u3002</li> <li>\u4f7f\u7528 Bugly \u63d0\u4f9b\u7684\u5de5\u5177\u89e3\u6790 Native \u5d29\u6e83\u5806\u6808\u3002</li> </ul>"},{"location":"030Android/010Basic/#5-bugly","title":"5. Bugly \u4e0e\u624b\u52a8\u65b9\u6848\u7684\u5bf9\u6bd4","text":"\u7279\u6027 \u624b\u52a8\u65b9\u6848 Bugly Java \u5d29\u6e83\u6355\u83b7 \u9700\u8981\u5b9e\u73b0 <code>UncaughtExceptionHandler</code> \u81ea\u52a8\u6355\u83b7\uff0c\u652f\u6301 ANR \u76d1\u63a7 Native \u5d29\u6e83\u6355\u83b7 \u9700\u8981\u5b9e\u73b0\u4fe1\u53f7\u5904\u7406\u5668\u6216\u96c6\u6210 Breakpad \u81ea\u52a8\u6355\u83b7\uff0c\u57fa\u4e8e Breakpad \u5d29\u6e83\u4e0a\u62a5 \u9700\u8981\u624b\u52a8\u5b9e\u73b0 \u81ea\u52a8\u4e0a\u62a5\uff0c\u5b9e\u65f6\u67e5\u770b \u7b26\u53f7\u8868\u89e3\u6790 \u9700\u8981\u624b\u52a8\u89e3\u6790 minidump \u81ea\u52a8\u89e3\u6790\uff0c\u652f\u6301\u4e0a\u4f20\u7b26\u53f7\u8868 ANR \u76d1\u63a7 \u9700\u8981\u624b\u52a8\u5b9e\u73b0 \u81ea\u52a8\u76d1\u63a7 \u591a\u7ef4\u5ea6\u5206\u6790 \u4e0d\u652f\u6301 \u652f\u6301\u5d29\u6e83\u6b21\u6570\u3001\u8bbe\u5907\u5206\u5e03\u7b49 \u81ea\u5b9a\u4e49\u65e5\u5fd7 \u9700\u8981\u624b\u52a8\u5b9e\u73b0 \u652f\u6301\u4e0a\u4f20\u81ea\u5b9a\u4e49\u65e5\u5fd7"},{"location":"030Android/010Basic/#6_2","title":"6. \u603b\u7ed3","text":"<p>Bugly \u7684\u5d29\u6e83\u6355\u83b7\u539f\u7406\u4e0e\u624b\u52a8\u65b9\u6848\u7c7b\u4f3c\uff0c\u4f46\u5b83\u662f\u4e00\u4e2a\u66f4\u6210\u719f\u3001\u66f4\u5168\u9762\u7684\u89e3\u51b3\u65b9\u6848\uff1a - Java \u5c42\uff1a\u57fa\u4e8e <code>UncaughtExceptionHandler</code>\uff0c\u652f\u6301 ANR \u76d1\u63a7\u3002 - Native \u5c42\uff1a\u57fa\u4e8e\u4fe1\u53f7\u5904\u7406\u5668\u548c Breakpad\uff0c\u652f\u6301\u7b26\u53f7\u8868\u89e3\u6790\u3002 - \u989d\u5916\u529f\u80fd\uff1a\u5b9e\u65f6\u4e0a\u62a5\u3001\u591a\u7ef4\u5ea6\u5206\u6790\u3001\u81ea\u5b9a\u4e49\u65e5\u5fd7\u7b49\u3002</p> <p>\u5982\u679c\u4f60\u7684\u9879\u76ee\u9700\u8981\u5feb\u901f\u96c6\u6210\u5d29\u6e83\u76d1\u63a7\u529f\u80fd\uff0c\u63a8\u8350\u4f7f\u7528 Bugly \u6216\u7c7b\u4f3c\u7684\u7b2c\u4e09\u65b9\u5de5\u5177\uff08\u5982 Firebase Crashlytics\u3001Sentry\uff09\u3002\u5982\u679c\u5bf9\u6027\u80fd\u6216\u9690\u79c1\u6709\u7279\u6b8a\u8981\u6c42\uff0c\u53ef\u4ee5\u9009\u62e9\u624b\u52a8\u5b9e\u73b0\u5d29\u6e83\u6355\u83b7\u65b9\u6848\u3002</p>"},{"location":"030Android/010Basic/#android_5","title":"Android\u6709\u54ea\u4e9b\u7279\u6709\u6570\u636e\u7ed3\u6784\uff1f\u5b83\u4eec\u89e3\u51b3\u7684\u662f\u4ec0\u4e48\u95ee\u9898\uff1f","text":"\u7b54\u6848 <p>https://www.jianshu.com/p/b59dfdcdef2f - ArrayMap - ArraySet - SparseArray - SparseIntArray - SparseBooleanArray - SparseLongArray</p>"},{"location":"030Android/010Basic/#arraymaphashmapandroidarraymaparraymap","title":"ArrayMap\u5bf9\u6bd4HashMap\uff0c\u4e3a\u4ec0\u4e48Android\u9700\u8981\u5f04\u4e00\u4e2aArrayMap\uff0cArrayMap\u7684\u5177\u4f53\u5b9e\u73b0\u3002","text":"\u7b54\u6848"},{"location":"030Android/010Basic/#arraymap-hashmap","title":"ArrayMap \u5bf9\u6bd4 HashMap","text":""},{"location":"030Android/010Basic/#1-android-arraymap","title":"1. \u4e3a\u4ec0\u4e48 Android \u9700\u8981 ArrayMap\uff1f","text":"<p>\u5728 Android \u5f00\u53d1\u4e2d\uff0c<code>ArrayMap</code> \u662f\u4e3a\u4e86\u89e3\u51b3 <code>HashMap</code> \u5728\u67d0\u4e9b\u573a\u666f\u4e0b\u7684\u6027\u80fd\u95ee\u9898\u800c\u8bbe\u8ba1\u7684\u3002<code>HashMap</code> \u867d\u7136\u5728\u5927\u6570\u636e\u91cf\u4e0b\u8868\u73b0\u4f18\u5f02\uff0c\u4f46\u5728\u5c0f\u6570\u636e\u91cf\u65f6\uff0c\u5176\u5185\u5b58\u5f00\u9500\u548c\u6027\u80fd\u8868\u73b0\u5e76\u4e0d\u7406\u60f3\u3002<code>ArrayMap</code> \u7684\u4e3b\u8981\u4f18\u52bf\u5728\u4e8e\uff1a</p> <ul> <li>\u5185\u5b58\u6548\u7387\uff1a<code>ArrayMap</code> \u4f7f\u7528\u4e24\u4e2a\u6570\u7ec4\u6765\u5b58\u50a8\u952e\u548c\u503c\uff0c\u907f\u514d\u4e86 <code>HashMap</code> \u4e2d <code>Entry</code> \u5bf9\u8c61\u7684\u989d\u5916\u5185\u5b58\u5f00\u9500\u3002</li> <li>\u5c0f\u6570\u636e\u91cf\u6027\u80fd\uff1a\u5728\u5c0f\u6570\u636e\u91cf\uff08\u5982\u51e0\u5341\u4e2a\u5143\u7d20\uff09\u65f6\uff0c<code>ArrayMap</code> \u7684\u67e5\u627e\u548c\u63d2\u5165\u6027\u80fd\u4f18\u4e8e <code>HashMap</code>\u3002</li> <li>\u7f13\u5b58\u53cb\u597d\uff1a<code>ArrayMap</code> \u7684\u6570\u636e\u7ed3\u6784\u66f4\u7d27\u51d1\uff0c\u80fd\u66f4\u597d\u5730\u5229\u7528 CPU \u7f13\u5b58\u3002</li> </ul>"},{"location":"030Android/010Basic/#2-arraymap","title":"2. ArrayMap \u7684\u5177\u4f53\u5b9e\u73b0","text":"<p><code>ArrayMap</code> \u7684\u6838\u5fc3\u5b9e\u73b0\u57fa\u4e8e\u4e24\u4e2a\u6570\u7ec4\uff1a\u4e00\u4e2a\u7528\u4e8e\u5b58\u50a8\u952e\uff0c\u53e6\u4e00\u4e2a\u7528\u4e8e\u5b58\u50a8\u503c\u3002\u4ee5\u4e0b\u662f <code>ArrayMap</code> \u7684\u4e3b\u8981\u5b9e\u73b0\u7ec6\u8282\uff1a</p>"},{"location":"030Android/010Basic/#_84","title":"\u6570\u636e\u7ed3\u6784","text":"<ul> <li><code>int[] mHashes</code>\uff1a\u5b58\u50a8\u952e\u7684\u54c8\u5e0c\u503c\u3002</li> <li><code>Object[] mArray</code>\uff1a\u4ea4\u66ff\u5b58\u50a8\u952e\u548c\u503c\uff0c\u5373 <code>[key1, value1, key2, value2, ...]</code>\u3002</li> </ul>"},{"location":"030Android/010Basic/#_85","title":"\u67e5\u627e\u64cd\u4f5c","text":"<ol> <li>\u8ba1\u7b97\u54c8\u5e0c\u503c\uff1a\u9996\u5148\u8ba1\u7b97\u952e\u7684\u54c8\u5e0c\u503c\u3002</li> <li>\u4e8c\u5206\u67e5\u627e\uff1a\u5728 <code>mHashes</code> \u6570\u7ec4\u4e2d\u4f7f\u7528\u4e8c\u5206\u67e5\u627e\u6765\u786e\u5b9a\u952e\u7684\u4f4d\u7f6e\u3002</li> <li>\u8fd4\u56de\u7ed3\u679c\uff1a\u5982\u679c\u627e\u5230\u5339\u914d\u7684\u54c8\u5e0c\u503c\uff0c\u518d\u68c0\u67e5 <code>mArray</code> \u4e2d\u5bf9\u5e94\u7684\u952e\u662f\u5426\u76f8\u7b49\uff0c\u5982\u679c\u76f8\u7b49\u5219\u8fd4\u56de\u5bf9\u5e94\u7684\u503c\u3002</li> </ol>"},{"location":"030Android/010Basic/#_86","title":"\u63d2\u5165\u64cd\u4f5c","text":"<ol> <li>\u8ba1\u7b97\u54c8\u5e0c\u503c\uff1a\u8ba1\u7b97\u952e\u7684\u54c8\u5e0c\u503c\u3002</li> <li>\u4e8c\u5206\u67e5\u627e\uff1a\u5728 <code>mHashes</code> \u6570\u7ec4\u4e2d\u4f7f\u7528\u4e8c\u5206\u67e5\u627e\u786e\u5b9a\u63d2\u5165\u4f4d\u7f6e\u3002</li> <li>\u63d2\u5165\u6570\u636e\uff1a\u5982\u679c\u952e\u5df2\u5b58\u5728\uff0c\u5219\u66f4\u65b0\u503c\uff1b\u5426\u5219\uff0c\u5728 <code>mHashes</code> \u548c <code>mArray</code> \u4e2d\u63d2\u5165\u65b0\u7684\u54c8\u5e0c\u503c\u548c\u952e\u503c\u5bf9\u3002</li> <li>\u6269\u5bb9\uff1a\u5982\u679c\u6570\u7ec4\u5df2\u6ee1\uff0c\u5219\u8fdb\u884c\u6269\u5bb9\u64cd\u4f5c\u3002</li> </ol>"},{"location":"030Android/010Basic/#_87","title":"\u5220\u9664\u64cd\u4f5c","text":"<ol> <li>\u8ba1\u7b97\u54c8\u5e0c\u503c\uff1a\u8ba1\u7b97\u952e\u7684\u54c8\u5e0c\u503c\u3002</li> <li>\u4e8c\u5206\u67e5\u627e\uff1a\u5728 <code>mHashes</code> \u6570\u7ec4\u4e2d\u4f7f\u7528\u4e8c\u5206\u67e5\u627e\u786e\u5b9a\u952e\u7684\u4f4d\u7f6e\u3002</li> <li>\u5220\u9664\u6570\u636e\uff1a\u5982\u679c\u627e\u5230\u5339\u914d\u7684\u952e\uff0c\u5219\u4ece <code>mHashes</code> \u548c <code>mArray</code> \u4e2d\u5220\u9664\u5bf9\u5e94\u7684\u54c8\u5e0c\u503c\u548c\u952e\u503c\u5bf9\u3002</li> <li>\u7f29\u5bb9\uff1a\u5982\u679c\u6570\u7ec4\u4e2d\u7684\u5143\u7d20\u6570\u91cf\u51cf\u5c11\u5230\u4e00\u5b9a\u7a0b\u5ea6\uff0c\u5219\u8fdb\u884c\u7f29\u5bb9\u64cd\u4f5c\u3002</li> </ol>"},{"location":"030Android/010Basic/#_88","title":"\u6269\u5bb9\u4e0e\u7f29\u5bb9","text":"<ul> <li>\u6269\u5bb9\uff1a\u5f53\u6570\u7ec4\u5df2\u6ee1\u65f6\uff0c<code>ArrayMap</code> \u4f1a\u521b\u5efa\u4e00\u4e2a\u66f4\u5927\u7684\u6570\u7ec4\uff0c\u5e76\u5c06\u539f\u6709\u6570\u636e\u590d\u5236\u5230\u65b0\u6570\u7ec4\u4e2d\u3002</li> <li>\u7f29\u5bb9\uff1a\u5f53\u6570\u7ec4\u4e2d\u7684\u5143\u7d20\u6570\u91cf\u51cf\u5c11\u5230\u4e00\u5b9a\u7a0b\u5ea6\u65f6\uff0c<code>ArrayMap</code> \u4f1a\u521b\u5efa\u4e00\u4e2a\u66f4\u5c0f\u7684\u6570\u7ec4\uff0c\u5e76\u5c06\u6570\u636e\u590d\u5236\u5230\u65b0\u6570\u7ec4\u4e2d\uff0c\u4ee5\u51cf\u5c11\u5185\u5b58\u5360\u7528\u3002</li> </ul>"},{"location":"030Android/010Basic/#3_15","title":"3. \u9002\u7528\u573a\u666f","text":"<ul> <li>\u5c0f\u6570\u636e\u91cf\uff1a<code>ArrayMap</code> \u9002\u7528\u4e8e\u5b58\u50a8\u5c11\u91cf\u6570\u636e\uff08\u5982\u51e0\u5341\u4e2a\u5143\u7d20\uff09\u7684\u573a\u666f\u3002</li> <li>\u5185\u5b58\u654f\u611f\uff1a\u5728\u5185\u5b58\u8d44\u6e90\u6709\u9650\u7684\u8bbe\u5907\u4e0a\uff0c<code>ArrayMap</code> \u7684\u5185\u5b58\u6548\u7387\u66f4\u9ad8\u3002</li> <li>\u9891\u7e41\u63d2\u5165\u5220\u9664\uff1a<code>ArrayMap</code> \u5728\u5c0f\u6570\u636e\u91cf\u4e0b\u7684\u63d2\u5165\u548c\u5220\u9664\u64cd\u4f5c\u6027\u80fd\u4f18\u4e8e <code>HashMap</code>\u3002</li> </ul>"},{"location":"030Android/010Basic/#4_12","title":"4. \u603b\u7ed3","text":"<p><code>ArrayMap</code> \u662f Android \u4e3a\u4f18\u5316\u5c0f\u6570\u636e\u91cf\u4e0b\u7684\u5185\u5b58\u4f7f\u7528\u548c\u6027\u80fd\u800c\u8bbe\u8ba1\u7684\u6570\u636e\u7ed3\u6784\u3002\u5b83\u901a\u8fc7\u4f7f\u7528\u4e24\u4e2a\u6570\u7ec4\u6765\u5b58\u50a8\u952e\u548c\u503c\uff0c\u907f\u514d\u4e86 <code>HashMap</code> \u4e2d <code>Entry</code> \u5bf9\u8c61\u7684\u989d\u5916\u5185\u5b58\u5f00\u9500\uff0c\u5e76\u5728\u5c0f\u6570\u636e\u91cf\u4e0b\u63d0\u4f9b\u4e86\u66f4\u597d\u7684\u6027\u80fd\u8868\u73b0\u3002\u7136\u800c\uff0c\u5728\u5927\u6570\u636e\u91cf\u4e0b\uff0c<code>HashMap</code> \u7684\u6027\u80fd\u4ecd\u7136\u4f18\u4e8e <code>ArrayMap</code>\u3002\u56e0\u6b64\uff0c\u5f00\u53d1\u8005\u5e94\u6839\u636e\u5177\u4f53\u573a\u666f\u9009\u62e9\u5408\u9002\u7684\u6570\u636e\u7ed3\u6784\u3002</p> <p>\u597d\u7684\uff0c\u6211\u4eec\u7ed3\u5408 <code>ArrayMap</code> \u7684\u6e90\u7801\u6765\u8be6\u7ec6\u8bb2\u89e3 Key \u548c Value \u662f\u5982\u4f55\u5b58\u50a8\u7684\uff0c\u4ee5\u53ca\u5b83\u7684\u5177\u4f53\u5b9e\u73b0\u903b\u8f91\u3002</p>"},{"location":"030Android/010Basic/#1-arraymap","title":"1. ArrayMap \u7684\u6838\u5fc3\u6570\u636e\u7ed3\u6784","text":"<p><code>ArrayMap</code> \u4f7f\u7528\u4e24\u4e2a\u6570\u7ec4\u6765\u5b58\u50a8\u6570\u636e\uff1a</p> <ul> <li><code>int[] mHashes</code>\uff1a\u5b58\u50a8\u6240\u6709 Key \u7684\u54c8\u5e0c\u503c\uff0c\u7528\u4e8e\u5feb\u901f\u67e5\u627e\u3002</li> <li><code>Object[] mArray</code>\uff1a\u4ea4\u66ff\u5b58\u50a8 Key \u548c Value\uff0c\u7ed3\u6784\u4e3a <code>[key1, value1, key2, value2, ...]</code>\u3002</li> </ul> <p>\u8fd9\u79cd\u8bbe\u8ba1\u907f\u514d\u4e86 <code>HashMap</code> \u4e2d <code>Entry</code> \u5bf9\u8c61\u7684\u989d\u5916\u5185\u5b58\u5f00\u9500\uff0c\u540c\u65f6\u4fdd\u6301\u4e86\u6570\u636e\u7684\u7d27\u51d1\u6027\u3002</p>"},{"location":"030Android/010Basic/#2_10","title":"2. \u6e90\u7801\u5206\u6790","text":"<p>\u4ee5\u4e0b\u662f <code>ArrayMap</code> \u7684\u6838\u5fc3\u6e90\u7801\u7247\u6bb5\uff08\u57fa\u4e8e Android SDK \u4e2d\u7684\u5b9e\u73b0\uff09\uff1a</p>"},{"location":"030Android/010Basic/#1-key-value","title":"\uff081\uff09\u5b58\u50a8 Key \u548c Value","text":"<pre><code>public V put(K key, V value) {\n    final int hash;\n    int index;\n    if (key == null) {\n        hash = 0;\n        index = indexOfNull();\n    } else {\n        hash = key.hashCode();\n        index = indexOf(key, hash);\n    }\n    if (index &gt;= 0) {\n        // Key \u5df2\u5b58\u5728\uff0c\u66f4\u65b0 Value\n        index = (index &lt;&lt; 1) + 1;\n        final V old = (V) mArray[index];\n        mArray[index] = value;\n        return old;\n    }\n    // Key \u4e0d\u5b58\u5728\uff0c\u63d2\u5165\u65b0\u7684 Key-Value\n    index = ~index;\n    if (mSize &gt;= mHashes.length) {\n        // \u6269\u5bb9\n        growSize();\n    }\n    if (index &lt; mSize) {\n        // \u63d2\u5165\u5230\u4e2d\u95f4\u4f4d\u7f6e\uff0c\u9700\u8981\u79fb\u52a8\u6570\u636e\n        System.arraycopy(mHashes, index, mHashes, index + 1, mSize - index);\n        System.arraycopy(mArray, index &lt;&lt; 1, mArray, (index + 1) &lt;&lt; 1, (mSize - index) &lt;&lt; 1);\n    }\n    // \u5b58\u50a8\u54c8\u5e0c\u503c\n    mHashes[index] = hash;\n    // \u5b58\u50a8 Key \u548c Value\n    mArray[index &lt;&lt; 1] = key;\n    mArray[(index &lt;&lt; 1) + 1] = value;\n    mSize++;\n    return null;\n}\n</code></pre>"},{"location":"030Android/010Basic/#_89","title":"\u5173\u952e\u70b9\uff1a","text":"<ol> <li>\u54c8\u5e0c\u503c\u5b58\u50a8\uff1a</li> <li>\u8ba1\u7b97 Key \u7684\u54c8\u5e0c\u503c\uff08<code>key.hashCode()</code>\uff09\uff0c\u5e76\u5c06\u5176\u5b58\u50a8\u5728 <code>mHashes</code> \u6570\u7ec4\u4e2d\u3002</li> <li> <p>\u5982\u679c Key \u4e3a <code>null</code>\uff0c\u5219\u54c8\u5e0c\u503c\u4e3a <code>0</code>\u3002</p> </li> <li> <p>Key \u548c Value \u5b58\u50a8\uff1a</p> </li> <li>Key \u548c Value \u4ea4\u66ff\u5b58\u50a8\u5728 <code>mArray</code> \u4e2d\uff0c\u7ed3\u6784\u4e3a <code>[key1, value1, key2, value2, ...]</code>\u3002</li> <li> <p>Key \u7684\u7d22\u5f15\u4e3a <code>index &lt;&lt; 1</code>\uff0cValue \u7684\u7d22\u5f15\u4e3a <code>(index &lt;&lt; 1) + 1</code>\u3002</p> </li> <li> <p>\u63d2\u5165\u903b\u8f91\uff1a</p> </li> <li>\u5982\u679c Key \u5df2\u5b58\u5728\uff0c\u5219\u66f4\u65b0\u5bf9\u5e94\u7684 Value\u3002</li> <li>\u5982\u679c Key \u4e0d\u5b58\u5728\uff0c\u5219\u5c06\u54c8\u5e0c\u503c\u3001Key \u548c Value \u63d2\u5165\u5230\u5408\u9002\u7684\u4f4d\u7f6e\uff0c\u5e76\u79fb\u52a8\u540e\u7eed\u6570\u636e\u3002</li> </ol>"},{"location":"030Android/010Basic/#2-key","title":"\uff082\uff09\u67e5\u627e Key \u7684\u7d22\u5f15","text":"<pre><code>int indexOf(Object key, int hash) {\n    final int N = mSize;\n    if (N == 0) {\n        return ~0;\n    }\n    // \u4e8c\u5206\u67e5\u627e\u54c8\u5e0c\u503c\n    int index = binarySearchHashes(mHashes, N, hash);\n    if (index &lt; 0) {\n        return index;\n    }\n    // \u54c8\u5e0c\u503c\u5339\u914d\uff0c\u68c0\u67e5 Key \u662f\u5426\u76f8\u7b49\n    if (key.equals(mArray[index &lt;&lt; 1])) {\n        return index;\n    }\n    // \u5904\u7406\u54c8\u5e0c\u51b2\u7a81\n    int end;\n    for (end = index + 1; end &lt; N &amp;&amp; mHashes[end] == hash; end++) {\n        if (key.equals(mArray[end &lt;&lt; 1])) return end;\n    }\n    for (int i = index - 1; i &gt;= 0 &amp;&amp; mHashes[i] == hash; i--) {\n        if (key.equals(mArray[i &lt;&lt; 1])) return i;\n    }\n    return ~end;\n}\n</code></pre>"},{"location":"030Android/010Basic/#_90","title":"\u5173\u952e\u70b9\uff1a","text":"<ol> <li>\u4e8c\u5206\u67e5\u627e\uff1a</li> <li>\u5728 <code>mHashes</code> \u6570\u7ec4\u4e2d\u4f7f\u7528\u4e8c\u5206\u67e5\u627e\uff0c\u5feb\u901f\u5b9a\u4f4d\u54c8\u5e0c\u503c\u7684\u4f4d\u7f6e\u3002</li> <li> <p>\u5982\u679c\u54c8\u5e0c\u503c\u4e0d\u5b58\u5728\uff0c\u5219\u8fd4\u56de <code>~index</code>\uff0c\u8868\u793a\u63d2\u5165\u4f4d\u7f6e\u3002</p> </li> <li> <p>\u54c8\u5e0c\u51b2\u7a81\u5904\u7406\uff1a</p> </li> <li>\u5982\u679c\u54c8\u5e0c\u503c\u5339\u914d\uff0c\u4f46 Key \u4e0d\u76f8\u7b49\uff08\u54c8\u5e0c\u51b2\u7a81\uff09\uff0c\u5219\u7ebf\u6027\u67e5\u627e\u76f8\u90bb\u4f4d\u7f6e\u3002</li> </ol>"},{"location":"030Android/010Basic/#3_16","title":"\uff083\uff09\u6269\u5bb9\u673a\u5236","text":"<pre><code>void growSize() {\n    final int n = mSize;\n    if (n &gt;= mHashes.length) {\n        // \u8ba1\u7b97\u65b0\u7684\u5bb9\u91cf\n        final int[] ohashes = mHashes;\n        final Object[] oarray = mArray;\n        // \u6269\u5bb9\u7b56\u7565\uff1a\u5bb9\u91cf\u5c0f\u4e8e BASE_SIZE*2 \u65f6\uff0c\u6269\u5bb9\u5230 BASE_SIZE*2\uff1b\u5426\u5219\u6269\u5bb9 1.5 \u500d\n        final int newSize = n + (n &lt; (BASE_SIZE * 2) ? (BASE_SIZE * 2) : (n &gt;&gt; 1));\n        mHashes = new int[newSize];\n        mArray = new Object[newSize &lt;&lt; 1];\n        // \u590d\u5236\u6570\u636e\n        System.arraycopy(ohashes, 0, mHashes, 0, ohashes.length);\n        System.arraycopy(oarray, 0, mArray, 0, oarray.length);\n    }\n}\n</code></pre>"},{"location":"030Android/010Basic/#_91","title":"\u5173\u952e\u70b9\uff1a","text":"<ol> <li>\u6269\u5bb9\u7b56\u7565\uff1a</li> <li>\u5982\u679c\u5f53\u524d\u5bb9\u91cf\u5c0f\u4e8e <code>BASE_SIZE * 2</code>\uff08\u9ed8\u8ba4 <code>BASE_SIZE</code> \u4e3a 4\uff09\uff0c\u5219\u6269\u5bb9\u5230 <code>BASE_SIZE * 2</code>\u3002</li> <li> <p>\u5426\u5219\uff0c\u6269\u5bb9\u4e3a\u5f53\u524d\u5bb9\u91cf\u7684 1.5 \u500d\u3002</p> </li> <li> <p>\u6570\u636e\u590d\u5236\uff1a</p> </li> <li>\u5c06\u65e7\u6570\u7ec4\u4e2d\u7684\u6570\u636e\u590d\u5236\u5230\u65b0\u6570\u7ec4\u4e2d\u3002</li> </ol>"},{"location":"030Android/010Basic/#3_17","title":"3. \u5b58\u50a8\u793a\u4f8b","text":"<p>\u5047\u8bbe\u6211\u4eec\u6709\u4ee5\u4e0b\u6570\u636e\uff1a</p> Key Value \"a\" 1 \"b\" 2 \"c\" 3 <p>\u5b58\u50a8\u7ed3\u6784\u5982\u4e0b\uff1a</p> <ul> <li><code>mHashes</code>\uff1a<code>[hash(\"a\"), hash(\"b\"), hash(\"c\")]</code></li> <li><code>mArray</code>\uff1a<code>[\"a\", 1, \"b\", 2, \"c\", 3]</code></li> </ul>"},{"location":"030Android/010Basic/#4_13","title":"4. \u603b\u7ed3","text":"<ul> <li>\u5b58\u50a8\u65b9\u5f0f\uff1a</li> <li><code>mHashes</code> \u5b58\u50a8\u6240\u6709 Key \u7684\u54c8\u5e0c\u503c\uff0c\u7528\u4e8e\u5feb\u901f\u67e5\u627e\u3002</li> <li> <p><code>mArray</code> \u4ea4\u66ff\u5b58\u50a8 Key \u548c Value\uff0c\u7ed3\u6784\u4e3a <code>[key1, value1, key2, value2, ...]</code>\u3002</p> </li> <li> <p>\u4f18\u70b9\uff1a</p> </li> <li>\u5185\u5b58\u7d27\u51d1\uff0c\u907f\u514d\u4e86 <code>HashMap</code> \u4e2d <code>Entry</code> \u5bf9\u8c61\u7684\u989d\u5916\u5f00\u9500\u3002</li> <li> <p>\u5728\u5c0f\u6570\u636e\u91cf\u4e0b\u6027\u80fd\u4f18\u5f02\u3002</p> </li> <li> <p>\u9002\u7528\u573a\u666f\uff1a</p> </li> <li>\u9002\u5408\u5b58\u50a8\u5c11\u91cf\u6570\u636e\uff08\u5982\u51e0\u5341\u4e2a\u5143\u7d20\uff09\u3002</li> <li>\u5728\u5185\u5b58\u654f\u611f\u7684\u573a\u666f\u4e0b\u8868\u73b0\u66f4\u597d\u3002</li> </ul> <p>\u901a\u8fc7\u6e90\u7801\u5206\u6790\uff0c\u6211\u4eec\u53ef\u4ee5\u6e05\u6670\u5730\u770b\u5230 <code>ArrayMap</code> \u662f\u5982\u4f55\u9ad8\u6548\u5730\u5b58\u50a8\u548c\u7ba1\u7406 Key-Value \u6570\u636e\u7684\u3002</p> <p>\u975e\u5e38\u597d\u7684\u95ee\u9898\uff01\u6211\u4eec\u6765\u8be6\u7ec6\u5206\u6790 <code>ArrayMap</code> \u5982\u4f55\u4fdd\u8bc1 <code>mHashes</code> \u662f\u6709\u5e8f\u7684\uff0c\u4ee5\u53ca <code>mArray</code> \u548c <code>mHashes</code> \u4e4b\u95f4\u7684\u5bf9\u5e94\u5173\u7cfb\u662f\u5426\u4f1a\u56e0\u4e3a\u6269\u5c55\u800c\u9519\u4e71\u3002</p>"},{"location":"030Android/010Basic/#1-mhashes","title":"1. \u5982\u4f55\u4fdd\u8bc1 <code>mHashes</code> \u662f\u6709\u5e8f\u7684\uff1f","text":"<p><code>mHashes</code> \u6570\u7ec4\u5b58\u50a8\u7684\u662f\u6240\u6709 Key \u7684\u54c8\u5e0c\u503c\uff0c\u5e76\u4e14 <code>mHashes</code> \u662f\u6709\u5e8f\u7684\u3002\u8fd9\u662f\u901a\u8fc7\u4ee5\u4e0b\u673a\u5236\u4fdd\u8bc1\u7684\uff1a</p>"},{"location":"030Android/010Basic/#1_12","title":"\uff081\uff09\u63d2\u5165\u65f6\u7ef4\u62a4\u6709\u5e8f\u6027","text":"<p>\u5728\u63d2\u5165\u65b0\u7684 Key-Value \u65f6\uff0c<code>ArrayMap</code> \u4f1a\u901a\u8fc7 \u4e8c\u5206\u67e5\u627e \u786e\u5b9a\u65b0 Key \u7684\u54c8\u5e0c\u503c\u5e94\u8be5\u63d2\u5165\u7684\u4f4d\u7f6e\uff0c\u7136\u540e\u5c06\u6570\u636e\u63d2\u5165\u5230\u6b63\u786e\u7684\u4f4d\u7f6e\uff0c\u540c\u65f6\u4fdd\u6301 <code>mHashes</code> \u7684\u6709\u5e8f\u6027\u3002</p> <p>\u4ee5\u4e0b\u662f\u63d2\u5165\u65f6\u7684\u5173\u952e\u903b\u8f91\uff1a</p> <pre><code>int index = binarySearchHashes(mHashes, mSize, hash);\nif (index &lt; 0) {\n    index = ~index; // \u8ba1\u7b97\u63d2\u5165\u4f4d\u7f6e\n}\n</code></pre> <ul> <li>\u4e8c\u5206\u67e5\u627e\uff1a<code>binarySearchHashes</code> \u4f1a\u5728 <code>mHashes</code> \u4e2d\u67e5\u627e\u54c8\u5e0c\u503c\u7684\u4f4d\u7f6e\u3002\u5982\u679c\u54c8\u5e0c\u503c\u4e0d\u5b58\u5728\uff0c\u5219\u8fd4\u56de <code>~index</code>\uff0c\u8868\u793a\u5e94\u8be5\u63d2\u5165\u7684\u4f4d\u7f6e\u3002</li> <li>\u63d2\u5165\u6570\u636e\uff1a\u5c06\u65b0 Key \u7684\u54c8\u5e0c\u503c\u63d2\u5165\u5230 <code>mHashes</code> \u7684\u6307\u5b9a\u4f4d\u7f6e\uff0c\u540c\u65f6\u5c06 Key \u548c Value \u63d2\u5165\u5230 <code>mArray</code> \u7684\u5bf9\u5e94\u4f4d\u7f6e\u3002</li> </ul>"},{"location":"030Android/010Basic/#2_11","title":"\uff082\uff09\u6570\u636e\u79fb\u52a8","text":"<p>\u5982\u679c\u63d2\u5165\u7684\u4f4d\u7f6e\u4e0d\u662f\u6570\u7ec4\u7684\u672b\u5c3e\uff0c\u5219\u9700\u8981\u5c06\u63d2\u5165\u4f4d\u7f6e\u4e4b\u540e\u7684\u6570\u636e\u5411\u540e\u79fb\u52a8\uff0c\u4ee5\u817e\u51fa\u7a7a\u95f4\uff1a</p> <pre><code>if (index &lt; mSize) {\n    System.arraycopy(mHashes, index, mHashes, index + 1, mSize - index);\n    System.arraycopy(mArray, index &lt;&lt; 1, mArray, (index + 1) &lt;&lt; 1, (mSize - index) &lt;&lt; 1);\n}\n</code></pre> <ul> <li><code>mHashes</code> \u79fb\u52a8\uff1a\u5c06 <code>mHashes</code> \u4e2d\u4ece <code>index</code> \u5f00\u59cb\u7684\u6570\u636e\u5411\u540e\u79fb\u52a8\u4e00\u4f4d\u3002</li> <li><code>mArray</code> \u79fb\u52a8\uff1a\u5c06 <code>mArray</code> \u4e2d\u4ece <code>index &lt;&lt; 1</code> \u5f00\u59cb\u7684\u6570\u636e\u5411\u540e\u79fb\u52a8\u4e24\u4f4d\uff08\u56e0\u4e3a <code>mArray</code> \u662f\u4ea4\u66ff\u5b58\u50a8 Key \u548c Value \u7684\uff09\u3002</li> </ul> <p>\u901a\u8fc7\u8fd9\u79cd\u65b9\u5f0f\uff0c<code>mHashes</code> \u548c <code>mArray</code> \u7684\u6709\u5e8f\u6027\u5f97\u4ee5\u4fdd\u6301\u3002</p>"},{"location":"030Android/010Basic/#2-marray-mhashes","title":"2. <code>mArray</code> \u548c <code>mHashes</code> \u7684\u5bf9\u5e94\u5173\u7cfb\u662f\u5426\u4f1a\u9519\u4e71\uff1f","text":"<p><code>mArray</code> \u548c <code>mHashes</code> \u7684\u5bf9\u5e94\u5173\u7cfb\u662f \u4e25\u683c\u4e00\u81f4 \u7684\uff0c\u4e0d\u4f1a\u56e0\u4e3a\u6269\u5c55\u6216\u5176\u4ed6\u64cd\u4f5c\u800c\u9519\u4e71\u3002\u4ee5\u4e0b\u662f\u539f\u56e0\uff1a</p>"},{"location":"030Android/010Basic/#1_13","title":"\uff081\uff09\u63d2\u5165\u548c\u5220\u9664\u65f6\u7684\u540c\u6b65\u64cd\u4f5c","text":"<ul> <li>\u63d2\u5165\u65f6\uff1a</li> <li>\u5728 <code>mHashes</code> \u4e2d\u63d2\u5165\u54c8\u5e0c\u503c\u7684\u540c\u65f6\uff0c\u4f1a\u5728 <code>mArray</code> \u7684\u5bf9\u5e94\u4f4d\u7f6e\u63d2\u5165 Key \u548c Value\u3002</li> <li> <p>\u5982\u679c\u63d2\u5165\u4f4d\u7f6e\u4e0d\u662f\u672b\u5c3e\uff0c\u5219\u4f1a\u540c\u6b65\u79fb\u52a8 <code>mHashes</code> \u548c <code>mArray</code> \u4e2d\u7684\u6570\u636e\u3002</p> </li> <li> <p>\u5220\u9664\u65f6\uff1a</p> </li> <li>\u5220\u9664 <code>mHashes</code> \u4e2d\u7684\u54c8\u5e0c\u503c\u65f6\uff0c\u4f1a\u540c\u6b65\u5220\u9664 <code>mArray</code> \u4e2d\u5bf9\u5e94\u7684 Key \u548c Value\u3002</li> <li>\u5982\u679c\u5220\u9664\u4f4d\u7f6e\u4e0d\u662f\u672b\u5c3e\uff0c\u5219\u4f1a\u540c\u6b65\u79fb\u52a8 <code>mHashes</code> \u548c <code>mArray</code> \u4e2d\u7684\u6570\u636e\u3002</li> </ul>"},{"location":"030Android/010Basic/#2_12","title":"\uff082\uff09\u6269\u5bb9\u65f6\u7684\u6570\u636e\u590d\u5236","text":"<p>\u5728\u6269\u5bb9\u65f6\uff0c<code>ArrayMap</code> \u4f1a\u521b\u5efa\u4e00\u4e2a\u65b0\u7684 <code>mHashes</code> \u548c <code>mArray</code>\uff0c\u5e76\u5c06\u65e7\u6570\u7ec4\u4e2d\u7684\u6570\u636e \u5b8c\u6574\u590d\u5236 \u5230\u65b0\u6570\u7ec4\u4e2d\uff1a</p> <pre><code>System.arraycopy(ohashes, 0, mHashes, 0, ohashes.length);\nSystem.arraycopy(oarray, 0, mArray, 0, oarray.length);\n</code></pre> <ul> <li>\u6570\u636e\u4e00\u81f4\u6027\uff1a\u6269\u5bb9\u8fc7\u7a0b\u4e2d\uff0c<code>mHashes</code> \u548c <code>mArray</code> \u7684\u6570\u636e\u4f1a\u88ab \u540c\u6b65\u590d\u5236\uff0c\u56e0\u6b64\u5b83\u4eec\u7684\u5bf9\u5e94\u5173\u7cfb\u4e0d\u4f1a\u9519\u4e71\u3002</li> </ul>"},{"location":"030Android/010Basic/#3_18","title":"\uff083\uff09\u7d22\u5f15\u8ba1\u7b97\u7684\u4e00\u81f4\u6027","text":"<p>\u5728 <code>ArrayMap</code> \u4e2d\uff0c<code>mHashes</code> \u548c <code>mArray</code> \u7684\u7d22\u5f15\u662f\u901a\u8fc7\u4ee5\u4e0b\u65b9\u5f0f\u5173\u8054\u7684\uff1a - <code>mHashes[index]</code> \u5bf9\u5e94 <code>mArray[index &lt;&lt; 1]</code>\uff08Key\uff09\u548c <code>mArray[(index &lt;&lt; 1) + 1]</code>\uff08Value\uff09\u3002</p> <p>\u8fd9\u79cd\u7d22\u5f15\u8ba1\u7b97\u65b9\u5f0f\u4fdd\u8bc1\u4e86 <code>mHashes</code> \u548c <code>mArray</code> \u7684\u4e25\u683c\u5bf9\u5e94\u5173\u7cfb\u3002</p>"},{"location":"030Android/010Basic/#3_19","title":"3. \u793a\u4f8b","text":"<p>\u5047\u8bbe\u6709\u4ee5\u4e0b\u6570\u636e\uff1a</p> Key Value Hash \"a\" 1 97 \"b\" 2 98 \"c\" 3 99 <p>\u5b58\u50a8\u7ed3\u6784\u5982\u4e0b\uff1a</p> <ul> <li><code>mHashes</code>\uff1a<code>[97, 98, 99]</code></li> <li><code>mArray</code>\uff1a<code>[\"a\", 1, \"b\", 2, \"c\", 3]</code></li> </ul> <p>\u5982\u679c\u63d2\u5165\u4e00\u4e2a\u65b0\u7684 Key-Value <code>(\"d\", 4)</code>\uff0c\u5176\u54c8\u5e0c\u503c\u4e3a <code>100</code>\uff0c\u5219\u63d2\u5165\u540e\u7684\u7ed3\u6784\u4e3a\uff1a</p> <ul> <li><code>mHashes</code>\uff1a<code>[97, 98, 99, 100]</code></li> <li><code>mArray</code>\uff1a<code>[\"a\", 1, \"b\", 2, \"c\", 3, \"d\", 4]</code></li> </ul> <p>\u5982\u679c\u5220\u9664 Key <code>\"b\"</code>\uff0c\u5219\u5220\u9664\u540e\u7684\u7ed3\u6784\u4e3a\uff1a</p> <ul> <li><code>mHashes</code>\uff1a<code>[97, 99, 100]</code></li> <li><code>mArray</code>\uff1a<code>[\"a\", 1, \"c\", 3, \"d\", 4]</code></li> </ul>"},{"location":"030Android/010Basic/#4_14","title":"4. \u603b\u7ed3","text":"<ul> <li><code>mHashes</code> \u7684\u6709\u5e8f\u6027\uff1a</li> <li>\u901a\u8fc7\u4e8c\u5206\u67e5\u627e\u786e\u5b9a\u63d2\u5165\u4f4d\u7f6e\uff0c\u5e76\u5728\u63d2\u5165\u65f6\u79fb\u52a8\u6570\u636e\uff0c\u4fdd\u8bc1 <code>mHashes</code> \u59cb\u7ec8\u6709\u5e8f\u3002</li> <li><code>mArray</code> \u548c <code>mHashes</code> \u7684\u5bf9\u5e94\u5173\u7cfb\uff1a</li> <li>\u5728\u63d2\u5165\u3001\u5220\u9664\u548c\u6269\u5bb9\u65f6\uff0c<code>mHashes</code> \u548c <code>mArray</code> \u7684\u6570\u636e\u4f1a\u540c\u6b65\u64cd\u4f5c\uff0c\u56e0\u6b64\u5b83\u4eec\u7684\u5bf9\u5e94\u5173\u7cfb\u4e0d\u4f1a\u9519\u4e71\u3002</li> <li>\u7d22\u5f15\u8ba1\u7b97\uff1a</li> <li><code>mHashes[index]</code> \u5bf9\u5e94 <code>mArray[index &lt;&lt; 1]</code>\uff08Key\uff09\u548c <code>mArray[(index &lt;&lt; 1) + 1]</code>\uff08Value\uff09\uff0c\u4fdd\u8bc1\u4e86\u4e25\u683c\u7684\u4e00\u81f4\u6027\u3002</li> </ul> <p>\u901a\u8fc7\u4ee5\u4e0a\u673a\u5236\uff0c<code>ArrayMap</code> \u80fd\u591f\u9ad8\u6548\u5730\u7ba1\u7406 Key-Value \u6570\u636e\uff0c\u540c\u65f6\u4fdd\u6301\u6570\u636e\u7684\u6709\u5e8f\u6027\u548c\u4e00\u81f4\u6027\u3002</p>"},{"location":"030Android/010Basic/#android_6","title":"Android\u6709\u54ea\u4e9b\u591a\u8fdb\u7a0b\u901a\u4fe1\u65b9\u5f0f\uff1f","text":"\u7b54\u6848 <p>\u5728Android\u4e2d\uff0c\u591a\u8fdb\u7a0b\u901a\u4fe1\u4e3b\u8981\u6709\u4ee5\u4e0b\u51e0\u79cd\u65b9\u5f0f\uff1a</p>"},{"location":"030Android/010Basic/#1-intent_1","title":"1. Intent","text":"<ul> <li>\u7528\u9014\uff1a\u7528\u4e8eActivity\u3001Service\u3001BroadcastReceiver\u4e4b\u95f4\u7684\u901a\u4fe1\u3002</li> <li>\u7279\u70b9\uff1a\u7b80\u5355\u6613\u7528\uff0c\u9002\u5408\u4f20\u9012\u5c11\u91cf\u6570\u636e\u3002</li> <li>\u9650\u5236\uff1a\u4e0d\u9002\u5408\u5927\u6570\u636e\u6216\u9891\u7e41\u901a\u4fe1\u3002</li> </ul>"},{"location":"030Android/010Basic/#2-messenger","title":"2. Messenger","text":"<ul> <li>\u7528\u9014\uff1a\u57fa\u4e8eAIDL\u7684\u8f7b\u91cf\u7ea7IPC\uff0c\u9002\u5408\u5355\u5411\u901a\u4fe1\u3002</li> <li>\u7279\u70b9\uff1a\u4f7f\u7528Handler\u5904\u7406\u6d88\u606f\uff0c\u5b9e\u73b0\u7b80\u5355\u3002</li> <li>\u9650\u5236\uff1a\u4ec5\u652f\u6301\u5355\u5411\u901a\u4fe1\uff0c\u4e0d\u9002\u5408\u590d\u6742\u573a\u666f\u3002</li> </ul>"},{"location":"030Android/010Basic/#3-aidlandroid-interface-definition-language","title":"3. AIDL\uff08Android Interface Definition Language\uff09","text":"<ul> <li>\u7528\u9014\uff1a\u7528\u4e8e\u590d\u6742IPC\uff0c\u652f\u6301\u53cc\u5411\u901a\u4fe1\u3002</li> <li>\u7279\u70b9\uff1a\u529f\u80fd\u5f3a\u5927\uff0c\u9002\u5408\u9891\u7e41\u901a\u4fe1\u6216\u590d\u6742\u8c03\u7528\u3002</li> <li>\u9650\u5236\uff1a\u5b9e\u73b0\u8f83\u590d\u6742\uff0c\u9700\u5904\u7406\u7ebf\u7a0b\u5b89\u5168\u3002</li> </ul>"},{"location":"030Android/010Basic/#4-contentprovider","title":"4. ContentProvider","text":"<ul> <li>\u7528\u9014\uff1a\u7528\u4e8e\u8de8\u5e94\u7528\u6570\u636e\u5171\u4eab\u3002</li> <li>\u7279\u70b9\uff1a\u5c01\u88c5\u4e86\u6570\u636e\u8bbf\u95ee\u7ec6\u8282\uff0c\u652f\u6301\u6570\u636e\u64cd\u4f5c\u3002</li> <li>\u9650\u5236\uff1a\u4e3b\u8981\u7528\u4e8e\u6570\u636e\u5171\u4eab\uff0c\u4e0d\u9002\u5408\u9891\u7e41\u901a\u4fe1\u3002</li> </ul>"},{"location":"030Android/010Basic/#5-socket","title":"5. Socket","text":"<ul> <li>\u7528\u9014\uff1a\u57fa\u4e8e\u7f51\u7edc\u7684\u8fdb\u7a0b\u95f4\u901a\u4fe1\u3002</li> <li>\u7279\u70b9\uff1a\u9002\u5408\u8de8\u8bbe\u5907\u6216\u590d\u6742\u7f51\u7edc\u901a\u4fe1\u3002</li> <li>\u9650\u5236\uff1a\u5b9e\u73b0\u590d\u6742\uff0c\u6027\u80fd\u5f00\u9500\u8f83\u5927\u3002</li> </ul>"},{"location":"030Android/010Basic/#6-sharedpreferences","title":"6. SharedPreferences","text":"<ul> <li>\u7528\u9014\uff1a\u901a\u8fc7\u6587\u4ef6\u5171\u4eab\u6570\u636e\u3002</li> <li>\u7279\u70b9\uff1a\u7b80\u5355\u6613\u7528\uff0c\u9002\u5408\u5c11\u91cf\u6570\u636e\u5171\u4eab\u3002</li> <li>\u9650\u5236\uff1a\u4e0d\u9002\u5408\u9891\u7e41\u6216\u5927\u6570\u636e\u901a\u4fe1\u3002</li> </ul>"},{"location":"030Android/010Basic/#7-file","title":"7. File","text":"<ul> <li>\u7528\u9014\uff1a\u901a\u8fc7\u6587\u4ef6\u7cfb\u7edf\u5171\u4eab\u6570\u636e\u3002</li> <li>\u7279\u70b9\uff1a\u9002\u5408\u5927\u6570\u636e\u6216\u6301\u4e45\u5316\u5b58\u50a8\u3002</li> <li>\u9650\u5236\uff1a\u9700\u5904\u7406\u5e76\u53d1\u548c\u540c\u6b65\u95ee\u9898\u3002</li> </ul>"},{"location":"030Android/010Basic/#8-binder","title":"8. Binder","text":"<ul> <li>\u7528\u9014\uff1aAndroid\u7684\u6838\u5fc3IPC\u673a\u5236\uff0cAIDL\u57fa\u4e8eBinder\u3002</li> <li>\u7279\u70b9\uff1a\u9ad8\u6548\uff0c\u9002\u5408\u9891\u7e41\u901a\u4fe1\u3002</li> <li>\u9650\u5236\uff1a\u5b9e\u73b0\u590d\u6742\uff0c\u9700\u5904\u7406\u7ebf\u7a0b\u5b89\u5168\u3002</li> </ul>"},{"location":"030Android/010Basic/#9-broadcastreceiver","title":"9. BroadcastReceiver","text":"<ul> <li>\u7528\u9014\uff1a\u7528\u4e8e\u7cfb\u7edf\u6216\u5e94\u7528\u95f4\u7684\u4e8b\u4ef6\u901a\u77e5\u3002</li> <li>\u7279\u70b9\uff1a\u652f\u6301\u4e00\u5bf9\u591a\u901a\u4fe1\uff0c\u9002\u5408\u4e8b\u4ef6\u9a71\u52a8\u573a\u666f\u3002</li> <li>\u9650\u5236\uff1a\u4e0d\u9002\u5408\u9891\u7e41\u6216\u5927\u6570\u636e\u901a\u4fe1\u3002</li> </ul>"},{"location":"030Android/010Basic/#10-jobscheduler","title":"10. JobScheduler","text":"<ul> <li>\u7528\u9014\uff1a\u7528\u4e8e\u540e\u53f0\u4efb\u52a1\u8c03\u5ea6\u3002</li> <li>\u7279\u70b9\uff1a\u9002\u5408\u5b9a\u65f6\u6216\u6761\u4ef6\u89e6\u53d1\u4efb\u52a1\u3002</li> <li>\u9650\u5236\uff1a\u4e3b\u8981\u7528\u4e8e\u4efb\u52a1\u8c03\u5ea6\uff0c\u4e0d\u9002\u5408\u5b9e\u65f6\u901a\u4fe1\u3002</li> </ul>"},{"location":"030Android/010Basic/#11-bound-service","title":"11. Bound Service","text":"<ul> <li>\u7528\u9014\uff1a\u901a\u8fc7\u7ed1\u5b9a\u670d\u52a1\u8fdb\u884c\u901a\u4fe1\u3002</li> <li>\u7279\u70b9\uff1a\u652f\u6301\u53cc\u5411\u901a\u4fe1\uff0c\u9002\u5408\u957f\u65f6\u95f4\u8fde\u63a5\u3002</li> <li>\u9650\u5236\uff1a\u5b9e\u73b0\u8f83\u590d\u6742\uff0c\u9700\u5904\u7406\u751f\u547d\u5468\u671f\u3002</li> </ul>"},{"location":"030Android/010Basic/#12-shared-memory","title":"12. Shared Memory","text":"<ul> <li>\u7528\u9014\uff1a\u901a\u8fc7\u5171\u4eab\u5185\u5b58\u8fdb\u884c\u9ad8\u6548\u901a\u4fe1\u3002</li> <li>\u7279\u70b9\uff1a\u6027\u80fd\u9ad8\uff0c\u9002\u5408\u5927\u6570\u636e\u4f20\u8f93\u3002</li> <li>\u9650\u5236\uff1a\u5b9e\u73b0\u590d\u6742\uff0c\u9700\u5904\u7406\u540c\u6b65\u95ee\u9898\u3002</li> </ul>"},{"location":"030Android/010Basic/#_92","title":"\u603b\u7ed3","text":"<ul> <li>\u7b80\u5355\u901a\u4fe1\uff1aIntent\u3001Messenger\u3001SharedPreferences\u3002</li> <li>\u590d\u6742\u901a\u4fe1\uff1aAIDL\u3001Binder\u3001Bound Service\u3002</li> <li>\u6570\u636e\u5171\u4eab\uff1aContentProvider\u3001File\u3001Shared Memory\u3002</li> <li>\u7f51\u7edc\u901a\u4fe1\uff1aSocket\u3002</li> <li>\u4e8b\u4ef6\u901a\u77e5\uff1aBroadcastReceiver\u3002</li> <li>\u540e\u53f0\u4efb\u52a1\uff1aJobScheduler\u3002</li> </ul> <p>\u6839\u636e\u5177\u4f53\u9700\u6c42\u9009\u62e9\u5408\u9002\u7684\u901a\u4fe1\u65b9\u5f0f\u3002</p>"},{"location":"030Android/010Basic/#androidrequestresponse","title":"Android\u5e73\u65f6\u5982\u4f55\u8c03\u8bd5\u7f51\u7edc\u63a5\u53e3\uff1f\u627e\u5230Request\u53c2\u6570\uff0c\u6216\u8005\u662f\u540e\u53f0Response\u7684\u95ee\u9898\u3002","text":"\u7b54\u6848 <p>\u5728Android\u5f00\u53d1\u4e2d\uff0c\u8c03\u8bd5\u7f51\u7edc\u63a5\u53e3\u901a\u5e38\u6d89\u53ca\u68c0\u67e5\u8bf7\u6c42\u53c2\u6570\u548c\u670d\u52a1\u5668\u54cd\u5e94\u3002\u4ee5\u4e0b\u662f\u5e38\u7528\u7684\u8c03\u8bd5\u65b9\u6cd5\uff1a</p>"},{"location":"030Android/010Basic/#1-logcat","title":"1. \u4f7f\u7528Logcat","text":"<p>\u901a\u8fc7<code>Log.d()</code>\u6216<code>Log.e()</code>\u6253\u5370\u8bf7\u6c42\u53c2\u6570\u548c\u54cd\u5e94\u6570\u636e\u5230Logcat\uff0c\u4fbf\u4e8e\u67e5\u770b\u3002</p> <pre><code>Log.d(\"NetworkRequest\", \"Request URL: \" + url);\nLog.d(\"NetworkRequest\", \"Request Parameters: \" + params.toString());\nLog.d(\"NetworkResponse\", \"Response: \" + response);\n</code></pre>"},{"location":"030Android/010Basic/#2-stetho","title":"2. \u4f7f\u7528Stetho","text":"<p>Facebook\u7684Stetho\u5e93\u53ef\u4ee5\u5728Chrome\u5f00\u53d1\u8005\u5de5\u5177\u4e2d\u67e5\u770b\u7f51\u7edc\u8bf7\u6c42\u3002</p> <ul> <li> <p>\u6dfb\u52a0\u4f9d\u8d56\uff1a <pre><code>implementation 'com.facebook.stetho:stetho:1.5.1'\nimplementation 'com.facebook.stetho:stetho-okhttp3:1.5.1'\n</code></pre></p> </li> <li> <p>\u521d\u59cb\u5316\uff1a <pre><code>Stetho.initializeWithDefaults(this);\n</code></pre></p> </li> <li> <p>\u6dfb\u52a0\u5230OkHttpClient\uff1a <pre><code>OkHttpClient client = new OkHttpClient.Builder()\n    .addNetworkInterceptor(new StethoInterceptor())\n    .build();\n</code></pre></p> </li> <li> <p>\u5728Chrome\u4e2d\u6253\u5f00<code>chrome://inspect</code>\uff0c\u9009\u62e9\u8bbe\u5907\u67e5\u770b\u7f51\u7edc\u8bf7\u6c42\u3002</p> </li> </ul>"},{"location":"030Android/010Basic/#3-okhttp","title":"3. \u4f7f\u7528OkHttp\u7684\u62e6\u622a\u5668","text":"<p>OkHttp\u7684\u62e6\u622a\u5668\u53ef\u4ee5\u8bb0\u5f55\u8bf7\u6c42\u548c\u54cd\u5e94\u4fe1\u606f\u3002</p> <pre><code>OkHttpClient client = new OkHttpClient.Builder()\n    .addInterceptor(new HttpLoggingInterceptor().setLevel(HttpLoggingInterceptor.Level.BODY))\n    .build();\n</code></pre> <p>\u8fd8\u6709\u57fa\u4e8eOkhttp\u7684chuck SDK\uff0c\u81ea\u5df1\u4fee\u6539\u4e00\u4e0b\u6e90\u7801\uff0c\u6539\u4e00\u4e0b\u8c03\u7528\u65b9\u5f0f\u3002\u7136\u540e\u4f5c\u4e3aAAR\u6587\u4ef6\u5f15\u7528\u4e5f\u662f\u4e0d\u9519\u7684\u9009\u62e9\u3002 https://github.com/jgilfelt/chuck</p>"},{"location":"030Android/010Basic/#4-postman","title":"4. \u4f7f\u7528Postman","text":"<p>\u5728Postman\u4e2d\u624b\u52a8\u6d4b\u8bd5\u63a5\u53e3\uff0c\u9a8c\u8bc1\u8bf7\u6c42\u53c2\u6570\u548c\u54cd\u5e94\u3002</p>"},{"location":"030Android/010Basic/#5-charles-proxy","title":"5. \u4f7f\u7528Charles Proxy","text":"<p>Charles Proxy\u53ef\u4ee5\u6355\u83b7\u548c\u5206\u6790\u7f51\u7edc\u8bf7\u6c42\u3002</p> <ul> <li>\u5b89\u88c5Charles\u5e76\u914d\u7f6e\u4ee3\u7406\u3002</li> <li>\u5728\u8bbe\u5907\u4e0a\u8bbe\u7f6e\u4ee3\u7406\u4e3aCharles\u7684IP\u548c\u7aef\u53e3\u3002</li> <li>\u5728Charles\u4e2d\u67e5\u770b\u8bf7\u6c42\u548c\u54cd\u5e94\u3002</li> </ul>"},{"location":"030Android/010Basic/#6-android-studionetwork-profiler","title":"6. \u4f7f\u7528Android Studio\u7684Network Profiler","text":"<p>Network Profiler\u53ef\u4ee5\u5b9e\u65f6\u76d1\u63a7\u7f51\u7edc\u6d3b\u52a8\u3002</p> <ul> <li>\u6253\u5f00Android Studio\uff0c\u8fdb\u5165<code>View &gt; Tool Windows &gt; Profiler</code>\u3002</li> <li>\u70b9\u51fb<code>+</code>\u53f7\uff0c\u9009\u62e9\u8981\u8c03\u8bd5\u7684\u5e94\u7528\u3002</li> <li>\u5728Profiler\u4e2d\u9009\u62e9<code>Network</code>\uff0c\u67e5\u770b\u7f51\u7edc\u8bf7\u6c42\u548c\u54cd\u5e94\u3002</li> </ul>"},{"location":"030Android/010Basic/#7-http","title":"7. \u68c0\u67e5HTTP\u72b6\u6001\u7801\u548c\u9519\u8bef\u4fe1\u606f","text":"<p>\u6839\u636eHTTP\u72b6\u6001\u7801\u548c\u9519\u8bef\u4fe1\u606f\u5b9a\u4f4d\u95ee\u9898\u3002</p> <pre><code>if (response.code() == 200) {\n    // \u8bf7\u6c42\u6210\u529f\n} else {\n    Log.e(\"NetworkError\", \"Error Code: \" + response.code());\n    Log.e(\"NetworkError\", \"Error Message: \" + response.message());\n}\n</code></pre>"},{"location":"030Android/010Basic/#8-mock-server","title":"8. \u4f7f\u7528Mock Server","text":"<p>\u4f7f\u7528Mock Server\u6a21\u62df\u540e\u7aef\u54cd\u5e94\uff0c\u4fbf\u4e8e\u8c03\u8bd5\u3002</p> <ul> <li>\u4f7f\u7528MockWebServer\uff1a <pre><code>MockWebServer server = new MockWebServer();\nserver.start();\nserver.enqueue(new MockResponse().setBody(\"{\\\"message\\\":\\\"OK\\\"}\"));\nString url = server.url(\"/\").toString();\n</code></pre></li> </ul>"},{"location":"030Android/010Basic/#_93","title":"\u603b\u7ed3","text":"<p>\u5e38\u7528\u7684\u8c03\u8bd5\u65b9\u6cd5\u5305\u62ecLogcat\u3001Stetho\u3001OkHttp\u62e6\u622a\u5668\u3001Postman\u3001Charles Proxy\u3001Network Profiler\u7b49\u3002\u901a\u8fc7\u8fd9\u4e9b\u5de5\u5177\uff0c\u53ef\u4ee5\u6709\u6548\u5b9a\u4f4d\u548c\u89e3\u51b3\u7f51\u7edc\u63a5\u53e3\u95ee\u9898\u3002</p>"},{"location":"030Android/010Basic/#android_7","title":"Android\u5982\u4f55\u5bfc\u5165\u5916\u90e8\u6570\u636e\u5e93\uff1f","text":"\u7b54\u6848 <p>\u5728Android\u4e2d\u5bfc\u5165\u5916\u90e8\u6570\u636e\u5e93\u901a\u5e38\u6d89\u53ca\u5c06\u9884\u5148\u751f\u6210\u7684SQLite\u6570\u636e\u5e93\u6587\u4ef6\u653e\u5165\u5e94\u7528\u7684<code>assets</code>\u6216<code>raw</code>\u76ee\u5f55\uff0c\u7136\u540e\u5728\u5e94\u7528\u9996\u6b21\u8fd0\u884c\u65f6\u5c06\u5176\u590d\u5236\u5230\u5e94\u7528\u7684\u5185\u90e8\u5b58\u50a8\u4e2d\u3002\u4ee5\u4e0b\u662f\u5177\u4f53\u6b65\u9aa4\uff1a</p>"},{"location":"030Android/010Basic/#1_14","title":"1. \u51c6\u5907\u6570\u636e\u5e93\u6587\u4ef6","text":"<p>\u9996\u5148\uff0c\u786e\u4fdd\u4f60\u5df2\u7ecf\u6709\u4e00\u4e2aSQLite\u6570\u636e\u5e93\u6587\u4ef6\uff08\u4f8b\u5982<code>mydatabase.db</code>\uff09\u3002</p>"},{"location":"030Android/010Basic/#2-assets","title":"2. \u5c06\u6570\u636e\u5e93\u6587\u4ef6\u653e\u5165<code>assets</code>\u76ee\u5f55","text":"<p>\u5c06\u6570\u636e\u5e93\u6587\u4ef6\u653e\u5165Android\u9879\u76ee\u7684<code>assets</code>\u76ee\u5f55\u4e2d\u3002\u5982\u679c<code>assets</code>\u76ee\u5f55\u4e0d\u5b58\u5728\uff0c\u53ef\u4ee5\u5728<code>src/main</code>\u4e0b\u521b\u5efa\u3002</p> <pre><code>src/main/assets/mydatabase.db\n</code></pre>"},{"location":"030Android/010Basic/#3_20","title":"3. \u521b\u5efa\u6570\u636e\u5e93\u5e2e\u52a9\u7c7b","text":"<p>\u521b\u5efa\u4e00\u4e2a<code>SQLiteOpenHelper</code>\u7684\u5b50\u7c7b\u6765\u7ba1\u7406\u6570\u636e\u5e93\u7684\u521b\u5efa\u548c\u7248\u672c\u63a7\u5236\u3002</p> <pre><code>import android.content.Context;\nimport android.database.sqlite.SQLiteDatabase;\nimport android.database.sqlite.SQLiteOpenHelper;\nimport java.io.FileOutputStream;\nimport java.io.IOException;\nimport java.io.InputStream;\nimport java.io.OutputStream;\n\npublic class DatabaseHelper extends SQLiteOpenHelper {\n\n    private static final String DATABASE_NAME = \"mydatabase.db\";\n    private static final int DATABASE_VERSION = 1;\n    private final Context context;\n\n    public DatabaseHelper(Context context) {\n        super(context, DATABASE_NAME, null, DATABASE_VERSION);\n        this.context = context;\n    }\n\n    @Override\n    public void onCreate(SQLiteDatabase db) {\n        // \u6570\u636e\u5e93\u5df2\u7ecf\u901a\u8fc7\u590d\u5236\u521b\u5efa\uff0c\u8fd9\u91cc\u4e0d\u9700\u8981\u518d\u521b\u5efa\u8868\n    }\n\n    @Override\n    public void onUpgrade(SQLiteDatabase db, int oldVersion, int newVersion) {\n        // \u5904\u7406\u6570\u636e\u5e93\u5347\u7ea7\u903b\u8f91\n    }\n\n    public void createDatabase() throws IOException {\n        boolean dbExist = checkDatabase();\n        if (!dbExist) {\n            this.getReadableDatabase();\n            copyDatabase();\n        }\n    }\n\n    private boolean checkDatabase() {\n        SQLiteDatabase checkDB = null;\n        try {\n            String path = context.getDatabasePath(DATABASE_NAME).getPath();\n            checkDB = SQLiteDatabase.openDatabase(path, null, SQLiteDatabase.OPEN_READONLY);\n        } catch (Exception e) {\n            // \u6570\u636e\u5e93\u4e0d\u5b58\u5728\n        }\n        if (checkDB != null) {\n            checkDB.close();\n        }\n        return checkDB != null;\n    }\n\n    private void copyDatabase() throws IOException {\n        InputStream inputStream = context.getAssets().open(DATABASE_NAME);\n        String outFileName = context.getDatabasePath(DATABASE_NAME).getPath();\n        OutputStream outputStream = new FileOutputStream(outFileName);\n\n        byte[] buffer = new byte[1024];\n        int length;\n        while ((length = inputStream.read(buffer)) &gt; 0) {\n            outputStream.write(buffer, 0, length);\n        }\n\n        outputStream.flush();\n        outputStream.close();\n        inputStream.close();\n    }\n}\n</code></pre>"},{"location":"030Android/010Basic/#4_15","title":"4. \u5728\u5e94\u7528\u542f\u52a8\u65f6\u590d\u5236\u6570\u636e\u5e93","text":"<p>\u5728\u5e94\u7528\u542f\u52a8\u65f6\uff08\u4f8b\u5982\u5728<code>MainActivity</code>\u4e2d\uff09\uff0c\u8c03\u7528<code>createDatabase()</code>\u65b9\u6cd5\u6765\u590d\u5236\u6570\u636e\u5e93\u3002</p> <pre><code>import android.os.Bundle;\nimport androidx.appcompat.app.AppCompatActivity;\nimport java.io.IOException;\n\npublic class MainActivity extends AppCompatActivity {\n\n    @Override\n    protected void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        setContentView(R.layout.activity_main);\n\n        DatabaseHelper dbHelper = new DatabaseHelper(this);\n        try {\n            dbHelper.createDatabase();\n        } catch (IOException e) {\n            e.printStackTrace();\n        }\n    }\n}\n</code></pre>"},{"location":"030Android/010Basic/#5_9","title":"5. \u8bbf\u95ee\u6570\u636e\u5e93","text":"<p>\u901a\u8fc7<code>SQLiteOpenHelper</code>\u7684\u5b9e\u4f8b\u8bbf\u95ee\u6570\u636e\u5e93\u3002</p> <pre><code>SQLiteDatabase db = dbHelper.getReadableDatabase();\n// \u6267\u884c\u67e5\u8be2\u6216\u5176\u4ed6\u64cd\u4f5c\n</code></pre>"},{"location":"030Android/010Basic/#_94","title":"\u6ce8\u610f\u4e8b\u9879","text":"<ul> <li>\u6570\u636e\u5e93\u8def\u5f84\uff1a\u786e\u4fdd\u6570\u636e\u5e93\u6587\u4ef6\u8def\u5f84\u6b63\u786e\uff0c\u901a\u5e38\u4f7f\u7528<code>context.getDatabasePath(DATABASE_NAME).getPath()</code>\u83b7\u53d6\u8def\u5f84\u3002</li> <li>\u6570\u636e\u5e93\u7248\u672c\uff1a\u5982\u679c\u6570\u636e\u5e93\u7ed3\u6784\u53d1\u751f\u53d8\u5316\uff0c\u9700\u8981\u5728<code>onUpgrade()</code>\u65b9\u6cd5\u4e2d\u5904\u7406\u5347\u7ea7\u903b\u8f91\u3002</li> <li>\u6587\u4ef6\u5927\u5c0f\uff1a\u5982\u679c\u6570\u636e\u5e93\u6587\u4ef6\u8f83\u5927\uff0c\u590d\u5236\u8fc7\u7a0b\u53ef\u80fd\u4f1a\u5f71\u54cd\u5e94\u7528\u542f\u52a8\u65f6\u95f4\u3002</li> </ul> <p>\u901a\u8fc7\u8fd9\u4e9b\u6b65\u9aa4\uff0c\u4f60\u53ef\u4ee5\u5728Android\u5e94\u7528\u4e2d\u6210\u529f\u5bfc\u5165\u5e76\u4f7f\u7528\u5916\u90e8\u6570\u636e\u5e93\u3002</p>"},{"location":"030Android/010Basic/#android-apk","title":"Android APK\u6784\u5efa\u6d41\u7a0b","text":"\u7b54\u6848 <p>Android APK\u7684\u6784\u5efa\u8fc7\u7a0b\u53ef\u4ee5\u5206\u4e3a\u591a\u4e2a\u6b65\u9aa4\uff0c\u4ee5\u4e0b\u662f\u4e00\u4e2a\u7b80\u5316\u7684\u6d41\u7a0b\u56fe\u63cf\u8ff0\uff1a</p> <ol> <li>\u6e90\u4ee3\u7801\u7f16\u8bd1\uff1aJava/Kotlin\u4ee3\u7801\u88ab\u7f16\u8bd1\u6210\u5b57\u8282\u7801\uff08.class\u6587\u4ef6\uff09\u3002</li> <li>\u5b57\u8282\u7801\u8f6c\u6362\uff1a\u4f7f\u7528D8\u6216R8\u5de5\u5177\u5c06\u5b57\u8282\u7801\u8f6c\u6362\u4e3aDEX\u6587\u4ef6\uff08Dalvik Executable\uff09\u3002</li> <li>\u8d44\u6e90\u5904\u7406\uff1aAAPT/AAPT2\u5de5\u5177\u7f16\u8bd1\u8d44\u6e90\u6587\u4ef6\uff08\u5982XML\u3001\u56fe\u7247\u7b49\uff09\uff0c\u751f\u6210\u8d44\u6e90\u8868\u548c\u4e8c\u8fdb\u5236\u8d44\u6e90\u6587\u4ef6\u3002</li> <li>\u6253\u5305\uff1a\u5c06\u6240\u6709DEX\u6587\u4ef6\u3001\u7f16\u8bd1\u540e\u7684\u8d44\u6e90\u6587\u4ef6\u548cAndroidManifest.xml\u6253\u5305\u6210\u4e00\u4e2a\u672a\u7b7e\u540d\u7684APK\u6587\u4ef6\u3002</li> <li>\u7b7e\u540d\uff1a\u4f7f\u7528\u7b7e\u540d\u5de5\u5177\uff08\u5982apksigner\uff09\u5bf9APK\u8fdb\u884c\u7b7e\u540d\uff0c\u786e\u4fddAPK\u7684\u5b8c\u6574\u6027\u548c\u6765\u6e90\u53ef\u4fe1\u3002</li> <li>\u5bf9\u9f50\uff1a\u4f7f\u7528zipalign\u5de5\u5177\u5bf9APK\u8fdb\u884c\u5bf9\u9f50\u4f18\u5316\uff0c\u63d0\u5347\u8fd0\u884c\u65f6\u6027\u80fd\u3002</li> </ol> <p>\u4e3b\u8981\u5206\u4e3a\u516d\u4e2a\u6b65\u9aa4\uff1a</p> <p>1 \u901a\u8fc7aapt\u6253\u5305res\u8d44\u6e90\u6587\u4ef6\uff0c\u751f\u6210R.java\u6587\u4ef6\u3001resource.arsc\u548cres\u6587\u4ef6\uff08\u4e8c\u8fdb\u5236&amp;\u975e\u4e8c\u8fdb\u5236\u5982res/raw\u548cpic\u4fdd\u6301\u539f\u6837\uff09 2 \u5904\u7406.aidl\u6587\u4ef6\uff0c\u751f\u6210\u5bf9\u5e94\u7684Java\u63a5\u53e3\u6587\u4ef6 3 \u901a\u8fc7Java Compiler\u7f16\u8bd1R.java\u3001Java\u63a5\u53e3\u6587\u4ef6\u3001Java\u6e90\u6587\u4ef6\uff0c\u751f\u6210.class\u6587\u4ef6 4 \u901a\u8fc7dex\u547d\u4ee4\uff0c\u5c06.class\u6587\u4ef6\u548c\u7b2c\u4e09\u65b9\u5e93\u4e2d\u7684.class\u6587\u4ef6\u5904\u7406\u751f\u6210classes.dex 5 \u901a\u8fc7apkbuilder\u5de5\u5177\uff0c\u5c06aapt\u751f\u6210\u7684resource.arsc\u548cres\u6587\u4ef6\u3001assets\u6587\u4ef6\u548cclasses.dex\u4e00\u8d77\u6253\u5305\u751f\u6210apk 6 \u901a\u8fc7Jarsigner\u5de5\u5177\uff0c\u5bf9\u4e0a\u9762\u7684apk\u8fdb\u884cdebug\u6216release\u7b7e\u540d 7 \u901a\u8fc7zipalign\u5de5\u5177\uff0c\u5c06\u7b7e\u540d\u540e\u7684apk\u8fdb\u884c\u5bf9\u9f50\u5904\u7406</p> <p></p>"},{"location":"030Android/010Basic/#androiddpsppx","title":"Android\u4e2ddp\u3001sp\u3001px\u7684\u7406\u89e3\u4ee5\u53ca\u76f8\u4e92\u8f6c\u6362","text":"\u7b54\u6848 <p>px</p> <p>\u50cf\u7d20\uff0c\u5bf9\u5e94\u4e8e\u5c4f\u5e55\u4e0a\u7684\u5b9e\u9645\u50cf\u7d20\u3002\u5728\u753b\u5206\u5272\u7ebf\u7684\u53ef\u4ee5\u7528\u5230\uff0c\u7528\u5176\u4ed6\u5355\u4f4d\u753b\u53ef\u80fd\u5f88\u6a21\u7cca\u3002</p> <p>dp\u3001dip</p> <p>\u4e0e\u5bc6\u5ea6\u65e0\u5173\u7684\u50cf\u7d20\u5355\u4f4d\uff0c\u57fa\u4e8e\u5c4f\u5e55\u7684\u7269\u7406\u5c3a\u5bf8\u7684\u62bd\u8c61\u5355\u4f4d\uff0c\u5728160dpi\u7684\u5c4f\u5e55\u4e0a1dp\u76f8\u5f53\u4e8e1px\uff0c\u4e00\u822c\u7528\u4e8e\u7a7a\u95f4\u5927\u5c0f\u7684\u5355\u4f4d\u3002</p> <p>sp</p> <p>\u4e0e\u7f29\u653e\u65e0\u5173\u7684\u50cf\u7d20\u5355\u4f4d\uff0c\u7c7b\u4f3cdp\uff0c\u4e0d\u7528\u4e4b\u5904\u5728\u4e8e\u5b83\u8fd8\u4f1a\u6839\u636e\u7528\u6237\u5b57\u4f53\u5927\u5c0f\u914d\u7f6e\u800c\u7f29\u653e\u3002\u5f00\u53d1\u4e2d\u6307\u5b9a\u5b57\u4f53\u5927\u5c0f\u65f6\u5efa\u8bae\u4f7f\u7528sp\uff0c\u56e0\u4e3a\u5b83\u4f1a\u6839\u636e\u5c4f\u5e55\u5bc6\u5ea6\u548c\u7528\u6237\u5b57\u4f53\u914d\u7f6e\u800c\u9002\u914d</p> <pre><code>DisplayMetrics dm = getResources().getDisplayMetrics();\nint dpi       = dm.densityDpi;    // \u5c4f\u5e55Dpi\nint width     = dm.widthPixels;   // \u5f53\u524d\u5c4f\u5e55\u53ef\u7528\u7a7a\u95f4\u7684\u5bbd(\u50cf\u7d20)\nint height    = dm.heightPixels;  // \u9ad8(\u50cf\u7d20)\nfloat density = dm.density;       // \u5c4f\u5e55\u5bc6\u5ea6\nfloat scale   = dm.scaledDensity; // \u5b57\u4f53\u7f29\u653e\u6bd4\u4f8b\n\n// \u83b7\u5f97\u8bbe\u5907\u7684\u914d\u7f6e\u4fe1\u606f\nConfiguration c = getResources().getConfiguration();\nint widthDp     = c.screenWidthDp;  // \u5f53\u524d\u5c4f\u5e55\u53ef\u7528\u7a7a\u95f4\u7684\u5bbd(dp)\nint heightDp    = c.screenHeightDp; // \u9ad8(dp)\nint dpi2        = c.densityDpi;     // \u5c4f\u5e55Dpi\nfloat fontScale = c.fontScale;      // \u5b57\u4f53\u7f29\u653e\u6bd4\u4f8b\n</code></pre> <pre><code>    /**\n     * \u5c06px\u503c\u8f6c\u6362\u4e3adip\u6216dp\u503c\n     * @param pxValue\n     * @return\n     */\n    public static int px2dip(Context context, float pxValue) {\n        final float scale = context.getResources().getDisplayMetrics().density;\n        return (int) (pxValue / scale + 0.5f);\n    }\n\n    /**\n     * \u5c06dip\u6216dp\u503c\u8f6c\u6362\u4e3apx\u503c\n     *\n     * @param dipValue\n     * @return\n     */\n    public static int dip2px(Context context, float dipValue) {\n        final float scale = context.getResources().getDisplayMetrics().density;\n        return (int) (dipValue * scale + 0.5f);\n    }\n\n    /**\n     * \u5c06px\u503c\u8f6c\u6362\u4e3asp\u503c\n     * @param pxValue\n     * @return\n     */\n    public static int px2sp(Context context, float pxValue) {\n        final float fontScale = context.getResources().getDisplayMetrics().scaledDensity;\n        return (int) (pxValue / fontScale + 0.5f);\n    }\n\n    /**\n     * \u5c06sp\u503c\u8f6c\u6362\u4e3apx\u503c\n     * @param spValue\n     * @return\n     */\n    public static int sp2px(Context context, float spValue) {\n        final float fontScale = context.getResources().getDisplayMetrics().scaledDensity;\n        return (int) (spValue * fontScale + 0.5f);\n    }\n</code></pre>"},{"location":"030Android/010Basic/#relativelayoutlinearlayout","title":"RelativeLayout\u548cLinearLayout\u5728\u5b9e\u73b0\u6548\u679c\u540c\u7b49\u7684\u60c5\u51b5\u4e0b\u4f7f\u7528\u54ea\u4e2a\uff1f\u4e3a\u4ec0\u4e48\uff1f","text":"\u7b54\u6848 <p>Android\u4e2dRelativeLayout\u548cLinearLayout\u6027\u80fd\u5206\u6790</p> <p>\u9009\u62e9LinearLayout\uff0c\u56e0\u4e3aRelativeLayout\u5728measure\u8fc7\u7a0b\u9700\u8981\u4e24\u6b21\u3002</p> <pre><code>    //RelativeLayout\u6e90\u7801\n    View[] views = mSortedHorizontalChildren;\n    int count = views.length;\n    for (int i = 0; i &lt; count; i++) {\n    /**/\n        measureChildHorizontal(child, params, myWidth, myHeight);\n    }\n    /**/\n    for (int i = 0; i &lt; count; i++){\n    /***/\n    measureChild(child, params, myWidth, myHeight);\n    }\n\n    //LinearLayout\n    @Override\n    protected void onMeasure(int widthMeasureSpec, int heightMeasureSpec) {\n        if (mOrientation == VERTICAL) {\n            measureVertical(widthMeasureSpec, heightMeasureSpec);\n        } else {\n            measureHorizontal(widthMeasureSpec, heightMeasureSpec);\n        }\n    }\n</code></pre> <p>\u4ece\u6e90\u7801\u6211\u4eec\u53d1\u73b0RelativeLayout\u4f1a\u5bf9\u5b50View\u505a\u4e24\u6b21measure\u3002\u8fd9\u662f\u4e3a\u4ec0\u4e48\u5462\uff1f\u9996\u5148RelativeLayout\u4e2d\u5b50View\u7684\u6392\u5217\u65b9\u5f0f\u662f\u57fa\u4e8e\u5f7c\u6b64\u7684\u4f9d\u8d56\u5173\u7cfb\uff0c\u800c\u8fd9\u4e2a\u4f9d\u8d56\u5173\u7cfb\u53ef\u80fd\u548c\u5e03\u5c40\u4e2dView\u7684\u987a\u5e8f\u5e76\u4e0d\u76f8\u540c\uff0c\u5728\u786e\u5b9a\u6bcf\u4e2a\u5b50View\u7684\u4f4d\u7f6e\u7684\u65f6\u5019\uff0c\u5c31\u9700\u8981\u5148\u7ed9\u6240\u6709\u7684\u5b50View\u6392\u5e8f\u4e00\u4e0b\u3002\u53c8\u56e0\u4e3aRelativeLayout\u5141\u8bb8A B\u4e24\u4e2a\u5b50View\uff0c\u6a2a\u5411\u4e0aB\u4f9d\u8d56\u4e8eA\uff0c\u7eb5\u5411\u4e0aA\u4f9d\u8d56\u4e8eB\uff0c\u6240\u4ee5\u9700\u8981\u6a2a\u5411\u7eb5\u5411\u5206\u522b\u8fdb\u884c\u4e00\u6b21\u6392\u5e8f\u6d4b\u91cf\u3002</p> <p>RelativeLayout\u53e6\u5916\u4e00\u4e2a\u6027\u80fd\u95ee\u9898\uff1a</p> <p>View\u7684measure\u65b9\u6cd5\u91cc\u5bf9\u7ed8\u5236\u8fc7\u7a0b\u505a\u4e86\u4e00\u4e2a\u4f18\u5316\uff0c\u5982\u679c\u6211\u4eec\u7684\u5b50View\u6ca1\u6709\u8981\u6c42\u5f3a\u5236\u5237\u65b0\uff0c\u800c\u7236View\u7ed9\u5b50View\u7684\u4f20\u5165\u503c\u4e5f\u6ca1\u6709\u53d8\u5316\uff0c\u4e5f\u5c31\u8bf4\u5b50View\u7684\u4f4d\u7f6e\u6ca1\u6709\u53d8\u5316\uff0c\u5c31\u4e0d\u4f1a\u505a\u65e0\u8c13\u7684measure\u3002\u4f46\u662f\u4e0a\u9762\u5df2\u7ecf\u8bf4\u4e86RelativeLayout\u8981\u505a\u4e24\u6b21measure\uff0c\u800c\u5728\u505a\u6a2a\u5411\u6d4b\u91cf\u65f6\uff0c\u7eb5\u5411\u7684\u6d4b\u91cf\u7ed3\u679c\u5c1a\u672a\u5b8c\u6210\uff0c\u53ea\u597d\u6682\u65f6\u4f7f\u7528myHeight\u4f20\u5165\u5b50View\u7cfb\u7edf\uff0c\u5047\u5982\u5b50View\u7684Height\u4e0d\u7b49\u4e8e\uff08\u8bbe\u7f6e\u4e86margin\uff09myHeight\u7684\u9ad8\u5ea6\uff0c\u90a3\u4e48measure\u4e2d\u4f18\u5316\u5219\u4e0d\u8d77\u4f5c\u7528\uff0c\u8fd9\u4e00\u8fc7\u7a0b\u5c06\u8fdb\u4e00\u6b65\u5f71\u54cdRelativeLayout\u7684\u7ed8\u5236\u6027\u80fd\u3002\u800cLinearLayout\u5219\u65e0\u8fd9\u65b9\u9762\u7684\u62c5\u5fe7\uff0c\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u4e5f\u5f88\u597d\u529e\uff0c\u5982\u679c\u53ef\u4ee5\uff0c\u5c3d\u91cf\u4f7f\u7528padding\u4ee3\u66ffmargin\u3002</p> <p>\u7ed3\u8bba</p> <ul> <li>RelativeLayout\u4f1a\u8ba9\u5b50View\u8c03\u7528\u4e24\u6b21onMeasure\uff0cLinearLayout\u518d\u6709weight\u65f6\uff0c\u4e5f\u4f1a\u8c03\u7528\u5b50View\u4e24\u6b21onMeasure</li> <li>RelativeLayout\u7684\u5b50View\u5982\u679c\u9ad8\u5ea6\u548cRelativeLayout\u4e0d\u540c\uff0c\u5219\u4f1a\u5f15\u53d1\u6548\u7387\u95ee\u9898\u3002\u5f53\u5b50View\u5f88\u590d\u6742\u65f6\uff0c\u8fd9\u4e2a\u95ee\u9898\u4f1a\u66f4\u52a0\u4e25\u91cd\u3002\u5982\u679c\u53ef\u4ee5\uff0c\u5c3d\u91cf\u4f7f\u7528padding\u4ee3\u66ffmargin</li> <li>\u5728\u4e0d\u5f71\u54cd\u5c42\u7ea7\u6df1\u5ea6\u7684\u60c5\u51b5\u4e0b\uff0c\u4f7f\u7528LinaerLayout\u548cFrameLayout\u800c\u4e0d\u662fRelativeLayout</li> </ul>"},{"location":"030Android/010Basic/#androiddalvikartjavajvm","title":"Android\u7684Dalvik\u865a\u62df\u673a\u4ee5\u53caART\u865a\u62df\u673a\uff0c\u4ee5\u53caJava\u7684JVM\u865a\u62df\u673a\u6709\u4ec0\u4e48\u533a\u522b\uff0c\u7279\u70b9","text":"\u7b54\u6848 <p>Android\u7684Dalvik\u865a\u62df\u673a\u3001ART\u865a\u62df\u673a\u548cJava\u7684JVM\u865a\u62df\u673a\u5728\u8bbe\u8ba1\u548c\u8fd0\u884c\u673a\u5236\u4e0a\u6709\u663e\u8457\u533a\u522b\uff0c\u4ee5\u4e0b\u662f\u5b83\u4eec\u7684\u4e3b\u8981\u7279\u70b9\u548c\u5dee\u5f02\uff1a</p>"},{"location":"030Android/010Basic/#1-dalvik","title":"1. Dalvik\u865a\u62df\u673a","text":"<ul> <li>\u8bbe\u8ba1\u76ee\u6807: \u4e13\u4e3aAndroid\u8bbe\u8ba1\uff0c\u9002\u7528\u4e8e\u5185\u5b58\u548c\u5904\u7406\u5668\u8d44\u6e90\u6709\u9650\u7684\u79fb\u52a8\u8bbe\u5907\u3002</li> <li>\u6267\u884c\u65b9\u5f0f: \u91c7\u7528\u57fa\u4e8e\u5bc4\u5b58\u5668\u7684\u67b6\u6784\uff0c\u6267\u884cDEX\uff08Dalvik Executable\uff09\u683c\u5f0f\u7684\u5b57\u8282\u7801\u3002</li> <li>\u7f16\u8bd1\u65b9\u5f0f: \u5e94\u7528\u5b89\u88c5\u65f6\uff0c\u5c06Java\u5b57\u8282\u7801\u8f6c\u6362\u4e3aDEX\u5b57\u8282\u7801\uff0c\u8fd0\u884c\u65f6\u901a\u8fc7JIT\uff08Just-In-Time\uff09\u7f16\u8bd1\u5668\u5c06\u5b57\u8282\u7801\u8f6c\u6362\u4e3a\u673a\u5668\u7801\u3002</li> <li>\u6027\u80fd: JIT\u7f16\u8bd1\u5728\u8fd0\u884c\u65f6\u8fdb\u884c\uff0c\u53ef\u80fd\u5bfc\u81f4\u542f\u52a8\u5ef6\u8fdf\u548c\u8fd0\u884c\u65f6\u6027\u80fd\u6ce2\u52a8\u3002</li> <li>\u5185\u5b58\u4f7f\u7528: \u76f8\u5bf9\u8f83\u4f4e\uff0c\u9002\u5408\u8d44\u6e90\u6709\u9650\u7684\u8bbe\u5907\u3002</li> </ul>"},{"location":"030Android/010Basic/#2-art","title":"2. ART\u865a\u62df\u673a","text":"<ul> <li>\u8bbe\u8ba1\u76ee\u6807: \u4f5c\u4e3aDalvik\u7684\u66ff\u4ee3\uff0c\u63d0\u5347\u6027\u80fd\u548c\u6548\u7387\u3002</li> <li>\u6267\u884c\u65b9\u5f0f: \u540c\u6837\u57fa\u4e8e\u5bc4\u5b58\u5668\u67b6\u6784\uff0c\u6267\u884cDEX\u5b57\u8282\u7801\u3002</li> <li>\u7f16\u8bd1\u65b9\u5f0f: \u91c7\u7528AOT\uff08Ahead-Of-Time\uff09\u7f16\u8bd1\uff0c\u5e94\u7528\u5b89\u88c5\u65f6\u5c06DEX\u5b57\u8282\u7801\u76f4\u63a5\u7f16\u8bd1\u4e3a\u673a\u5668\u7801\uff0c\u8fd0\u884c\u65f6\u65e0\u9700\u518d\u7f16\u8bd1\u3002</li> <li>\u6027\u80fd: AOT\u7f16\u8bd1\u51cf\u5c11\u4e86\u8fd0\u884c\u65f6\u5f00\u9500\uff0c\u542f\u52a8\u66f4\u5feb\uff0c\u8fd0\u884c\u66f4\u6d41\u7545\u3002</li> <li>\u5185\u5b58\u4f7f\u7528: \u5b89\u88c5\u65f6\u7f16\u8bd1\u5360\u7528\u66f4\u591a\u5b58\u50a8\u7a7a\u95f4\uff0c\u4f46\u8fd0\u884c\u65f6\u5185\u5b58\u6548\u7387\u66f4\u9ad8\u3002</li> </ul>"},{"location":"030Android/010Basic/#3-java-jvm","title":"3. Java JVM\u865a\u62df\u673a","text":"<ul> <li>\u8bbe\u8ba1\u76ee\u6807: \u4e3a\u684c\u9762\u548c\u670d\u52a1\u5668\u73af\u5883\u8bbe\u8ba1\uff0c\u652f\u6301\u8de8\u5e73\u53f0\u8fd0\u884c\u3002</li> <li>\u6267\u884c\u65b9\u5f0f: \u57fa\u4e8e\u6808\u7684\u67b6\u6784\uff0c\u6267\u884cJAR\u6587\u4ef6\u4e2d\u7684Java\u5b57\u8282\u7801\uff08Class\u6587\u4ef6\uff09\u3002</li> <li>\u7f16\u8bd1\u65b9\u5f0f: \u901a\u5e38\u91c7\u7528JIT\u7f16\u8bd1\uff0c\u8fd0\u884c\u65f6\u5c06\u5b57\u8282\u7801\u8f6c\u6362\u4e3a\u673a\u5668\u7801\uff0c\u90e8\u5206JVM\u4e5f\u652f\u6301AOT\u7f16\u8bd1\u3002</li> <li>\u6027\u80fd: JIT\u7f16\u8bd1\u4f18\u5316\u4e86\u70ed\u70b9\u4ee3\u7801\uff0c\u9002\u5408\u957f\u65f6\u95f4\u8fd0\u884c\u7684\u5e94\u7528\u3002</li> <li>\u5185\u5b58\u4f7f\u7528: \u901a\u5e38\u8f83\u9ad8\uff0c\u9002\u5408\u8d44\u6e90\u4e30\u5bcc\u7684\u73af\u5883\u3002</li> </ul>"},{"location":"030Android/010Basic/#_95","title":"\u4e3b\u8981\u533a\u522b","text":"<ul> <li>\u67b6\u6784: Dalvik\u548cART\u57fa\u4e8e\u5bc4\u5b58\u5668\uff0cJVM\u57fa\u4e8e\u6808\u3002</li> <li>\u5b57\u8282\u7801\u683c\u5f0f: Dalvik\u548cART\u4f7f\u7528DEX\uff0cJVM\u4f7f\u7528Class\u6587\u4ef6\u3002</li> <li>\u7f16\u8bd1\u65b9\u5f0f: Dalvik\u7528JIT\uff0cART\u7528AOT\uff0cJVM\u4e3b\u8981\u7528JIT\u3002</li> <li>\u6027\u80fd: ART\u7684AOT\u7f16\u8bd1\u6027\u80fd\u4f18\u4e8eDalvik\u7684JIT\uff0cJVM\u7684JIT\u9002\u5408\u957f\u65f6\u95f4\u8fd0\u884c\u7684\u5e94\u7528\u3002</li> <li>\u5185\u5b58\u4f7f\u7528: Dalvik\u5185\u5b58\u5360\u7528\u4f4e\uff0cART\u5b89\u88c5\u65f6\u5360\u7528\u5927\u4f46\u8fd0\u884c\u65f6\u9ad8\u6548\uff0cJVM\u5185\u5b58\u5360\u7528\u8f83\u9ad8\u3002</li> </ul>"},{"location":"030Android/010Basic/#_96","title":"\u603b\u7ed3","text":"<ul> <li>Dalvik: \u9002\u5408\u65e9\u671fAndroid\u8bbe\u5907\uff0c\u8d44\u6e90\u5360\u7528\u4f4e\u3002</li> <li>ART: \u63d0\u5347\u6027\u80fd\uff0c\u9002\u5408\u73b0\u4ee3Android\u8bbe\u5907\u3002</li> <li>JVM: \u9002\u5408\u684c\u9762\u548c\u670d\u52a1\u5668\u73af\u5883\uff0c\u652f\u6301\u8de8\u5e73\u53f0\u3002</li> </ul> <p>\u8fd9\u4e9b\u5dee\u5f02\u53cd\u6620\u4e86\u5b83\u4eec\u5728\u4e0d\u540c\u5e94\u7528\u573a\u666f\u4e2d\u7684\u4f18\u5316\u65b9\u5411\u3002</p>"},{"location":"030Android/010Basic/#android_8","title":"Android \u5185\u5b58\u4f18\u5316","text":"\u7b54\u6848 <p>Android\u7684\u5185\u5b58\u4f18\u5316\u5728\u6211\u770b\u6765\u5206\u4e3a\u4e24\u70b9\uff1a\u907f\u514d\u5185\u5b58\u6cc4\u6f0f\u3001\u6269\u5927\u5185\u5b58\uff0c\u5176\u5b9e\u5c31\u662f\u5f00\u6e90\u8282\u6d41\u3002 \u5176\u5b9e\u5185\u5b58\u6cc4\u6f0f\u7684\u672c\u8d28\u5c31\u662f\u8f83\u957f\u751f\u547d\u5468\u671f\u7684\u5bf9\u8c61\u5f15\u7528\u4e86\u8f83\u77ed\u751f\u547d\u5468\u671f\u7684\u5bf9\u8c61\u3002</p> <p>\u5e38\u89c1\u7684\u5185\u5b58\u6cc4\u6f0f \u5355\u4f8b\u6a21\u5f0f\u5bfc\u81f4\u7684\u5185\u5b58\u6cc4\u6f0f\u3002 \u6700\u5e38\u89c1\u7684\u4f8b\u5b50\u5c31\u662f\u521b\u5efa\u8fd9\u4e2a\u5355\u4f8b\u5bf9\u8c61\u9700\u8981\u4f20\u5165\u4e00\u4e2a Context\uff0c\u8fd9\u65f6\u5019\u4f20\u5165\u4e86\u4e00\u4e2a Activity \u7c7b\u578b\u7684 Context\uff0c\u7531\u4e8e\u5355\u4f8b\u5bf9\u8c61\u7684\u9759\u6001\u5c5e\u6027\uff0c\u5bfc\u81f4\u5b83\u7684\u751f\u547d\u5468\u671f\u662f\u4ece\u5355\u4f8b\u7c7b\u52a0\u8f7d\u5230\u5e94\u7528\u7a0b\u5e8f\u7ed3\u675f\u4e3a\u6b62\uff0c\u6240\u4ee5\u5373\u4f7f\u5df2\u7ecf finish \u6389\u4e86\u4f20\u5165\u7684 Activity\uff0c\u7531\u4e8e\u6211\u4eec\u7684\u5355\u4f8b\u5bf9\u8c61\u4f9d\u7136\u6301\u6709 Activity \u7684\u5f15\u7528\uff0c\u6240\u4ee5\u5bfc\u81f4\u4e86\u5185\u5b58\u6cc4\u6f0f\u3002\u89e3\u51b3\u529e\u6cd5\u4e5f\u5f88\u7b80\u5355\uff0c\u4e0d\u8981\u4f7f\u7528 Activity \u7c7b\u578b\u7684 Context\uff0c\u4f7f\u7528 Application \u7c7b\u578b\u7684 Context \u53ef\u4ee5\u907f\u514d\u5185\u5b58\u6cc4\u6f0f\u3002</p> <p>\u9759\u6001\u53d8\u91cf\u5bfc\u81f4\u7684\u5185\u5b58\u6cc4\u6f0f\u3002 \u9759\u6001\u53d8\u91cf\u662f\u653e\u5728\u65b9\u6cd5\u533a\u4e2d\u7684\uff0c\u5b83\u7684\u751f\u547d\u5468\u671f\u662f\u4ece\u7c7b\u52a0\u8f7d\u5230\u7a0b\u5e8f\u7ed3\u675f\uff0c\u53ef\u4ee5\u770b\u5230\u9759\u6001\u53d8\u91cf\u751f\u547d\u5468\u671f\u662f\u975e\u5e38\u4e45\u7684\u3002\u6700\u5e38\u89c1\u7684\u56e0\u9759\u6001\u53d8\u91cf\u5bfc\u81f4\u5185\u5b58\u6cc4\u6f0f\u7684\u4f8b\u5b50\u662f\u6211\u4eec\u5728 Activity \u4e2d\u521b\u5efa\u4e86\u4e00\u4e2a\u9759\u6001\u53d8\u91cf\uff0c\u800c\u8fd9\u4e2a\u9759\u6001\u53d8\u91cf\u7684\u521b\u5efa\u9700\u8981\u4f20\u5165 Activity \u7684\u5f15\u7528 this\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\u5373\u4f7f Activity \u8c03\u7528\u4e86 finish \u4e5f\u4f1a\u5bfc\u81f4\u5185\u5b58\u6cc4\u6f0f\u3002\u539f\u56e0\u5c31\u662f\u56e0\u4e3a\u8fd9\u4e2a\u9759\u6001\u53d8\u91cf\u7684\u751f\u547d\u5468\u671f\u51e0\u4e4e\u548c\u6574\u4e2a\u5e94\u7528\u7a0b\u5e8f\u7684\u751f\u547d\u5468\u671f\u4e00\u81f4\uff0c\u5b83\u4e00\u76f4\u6301\u6709 Activity \u7684\u5f15\u7528\uff0c\u4ece\u800c\u5bfc\u81f4\u4e86\u5185\u5b58\u6cc4\u6f0f\u3002</p> <p>\u975e\u9759\u6001\u5185\u90e8\u7c7b\u5bfc\u81f4\u7684\u5185\u5b58\u6cc4\u6f0f\u3002 \u975e\u9759\u6001\u5185\u90e8\u7c7b\u5bfc\u81f4\u5185\u5b58\u6cc4\u6f0f\u7684\u539f\u56e0\u662f\u975e\u9759\u6001\u5185\u90e8\u7c7b\u6301\u6709\u5916\u90e8\u7c7b\u7684\u5f15\u7528\uff0c\u6700\u5e38\u89c1\u7684\u4f8b\u5b50\u5c31\u662f\u5728 Activity \u4e2d\u4f7f\u7528 Handler \u548c Thread \u4e86\u3002\u4f7f\u7528\u975e\u9759\u6001\u5185\u90e8\u7c7b\u521b\u5efa\u7684 Handler \u548c Thread \u5728\u6267\u884c\u5ef6\u65f6\u64cd\u4f5c\u7684\u65f6\u5019\u4f1a\u4e00\u76f4\u6301\u6709\u5f53\u524dActivity\u7684\u5f15\u7528\uff0c\u5982\u679c\u5728\u6267\u884c\u5ef6\u65f6\u64cd\u4f5c\u7684\u65f6\u5019\u5c31\u7ed3\u675f Activity\uff0c\u8fd9\u6837\u5c31\u4f1a\u5bfc\u81f4\u5185\u5b58\u6cc4\u6f0f\u3002\u89e3\u51b3\u529e\u6cd5\u6709\u4e24\u79cd\uff1a\u7b2c\u4e00\u79cd\u662f\u4f7f\u7528\u9759\u6001\u5185\u90e8\u7c7b\uff0c\u5728\u9759\u6001\u5185\u90e8\u7c7b\u4e2d\u4f7f\u7528\u5f31\u5f15\u7528\u8c03\u7528Activity\u3002\u7b2c\u4e8c\u79cd\u65b9\u6cd5\u662f\u5728 Activity \u7684 onDestroy \u4e2d\u8c03\u7528 handler.removeCallbacksAndMessages \u6765\u53d6\u6d88\u5ef6\u65f6\u4e8b\u4ef6\u3002</p> <p>\u4f7f\u7528\u8d44\u6e90\u672a\u53ca\u65f6\u5173\u95ed\u5bfc\u81f4\u7684\u5185\u5b58\u6cc4\u6f0f\u3002 \u5e38\u89c1\u7684\u4f8b\u5b50\u6709\uff1a\u64cd\u4f5c\u5404\u79cd\u6570\u636e\u6d41\u672a\u53ca\u65f6\u5173\u95ed\uff0c\u64cd\u4f5c Bitmap \u672a\u53ca\u65f6 recycle \u7b49\u7b49\u3002</p> <p>\u4f7f\u7528\u7b2c\u4e09\u65b9\u5e93\u672a\u80fd\u53ca\u65f6\u89e3\u7ed1\u3002 \u6709\u7684\u4e09\u65b9\u5e93\u63d0\u4f9b\u4e86\u6ce8\u518c\u548c\u89e3\u7ed1\u7684\u529f\u80fd\uff0c\u6700\u5e38\u89c1\u7684\u5c31 EventBus \u4e86\uff0c\u6211\u4eec\u90fd\u77e5\u9053\u4f7f\u7528 EventBus \u8981\u5728 onCreate \u4e2d\u6ce8\u518c\uff0c\u5728 onDestroy \u4e2d\u89e3\u7ed1\u3002\u5982\u679c\u6ca1\u6709\u89e3\u7ed1\u7684\u8bdd\uff0cEventBus \u5176\u5b9e\u662f\u4e00\u4e2a\u5355\u4f8b\u6a21\u5f0f\uff0c\u4ed6\u4f1a\u4e00\u76f4\u6301\u6709 Activity \u7684\u5f15\u7528\uff0c\u5bfc\u81f4\u5185\u5b58\u6cc4\u6f0f\u3002\u540c\u6837\u5e38\u89c1\u7684\u8fd8\u6709 RxJava\uff0c\u5728\u4f7f\u7528 Timer \u64cd\u4f5c\u7b26\u505a\u4e86\u4e00\u4e9b\u5ef6\u65f6\u64cd\u4f5c\u540e\u4e5f\u8981\u6ce8\u610f\u5728 onDestroy \u65b9\u6cd5\u4e2d\u8c03\u7528 disposable.dispose()\u6765\u53d6\u6d88\u64cd\u4f5c\u3002</p> <p>\u5c5e\u6027\u52a8\u753b\u5bfc\u81f4\u7684\u5185\u5b58\u6cc4\u6f0f\u3002 \u5e38\u89c1\u7684\u4f8b\u5b50\u5c31\u662f\u5728\u5c5e\u6027\u52a8\u753b\u6267\u884c\u7684\u8fc7\u7a0b\u4e2d\u9000\u51fa\u4e86 Activity\uff0c\u8fd9\u65f6 View \u5bf9\u8c61\u4f9d\u7136\u6301\u6709 Activity \u7684\u5f15\u7528\u4ece\u800c\u5bfc\u81f4\u4e86\u5185\u5b58\u6cc4\u6f0f\u3002\u89e3\u51b3\u529e\u6cd5\u5c31\u662f\u5728 onDestroy \u4e2d\u8c03\u7528\u52a8\u753b\u7684 cancel \u65b9\u6cd5\u53d6\u6d88\u5c5e\u6027\u52a8\u753b\u3002 WebView \u5bfc\u81f4\u7684\u5185\u5b58\u6cc4\u6f0f\u3002WebView \u6bd4\u8f83\u7279\u6b8a\uff0c\u5373\u4f7f\u662f\u8c03\u7528\u4e86\u5b83\u7684 destroy \u65b9\u6cd5\uff0c\u4f9d\u7136\u4f1a\u5bfc\u81f4\u5185\u5b58\u6cc4\u6f0f\u3002\u5176\u5b9e\u907f\u514dWebView\u5bfc\u81f4\u5185\u5b58\u6cc4\u6f0f\u7684\u6700\u597d\u65b9\u6cd5\u5c31\u662f\u8ba9WebView\u6240\u5728\u7684Activity\u5904\u4e8e\u53e6\u4e00\u4e2a\u8fdb\u7a0b\u4e2d\uff0c\u5f53\u8fd9\u4e2a Activity \u7ed3\u675f\u65f6\u6740\u6b7b\u5f53\u524d WebView \u6240\u5904\u7684\u8fdb\u7a0b\u5373\u53ef\uff0c\u6211\u8bb0\u5f97\u963f\u91cc\u9489\u9489\u7684 WebView \u5c31\u662f\u53e6\u5916\u5f00\u542f\u7684\u4e00\u4e2a\u8fdb\u7a0b\uff0c\u5e94\u8be5\u4e5f\u662f\u91c7\u7528\u8fd9\u79cd\u65b9\u6cd5\u907f\u514d\u5185\u5b58\u6cc4\u6f0f\u3002</p> <p>\u6269\u5927\u5185\u5b58 \u4e3a\u4ec0\u4e48\u8981\u6269\u5927\u6211\u4eec\u7684\u5185\u5b58\u5462\uff1f\u6709\u65f6\u5019\u6211\u4eec\u5b9e\u9645\u5f00\u53d1\u4e2d\u4e0d\u53ef\u907f\u514d\u7684\u8981\u4f7f\u7528\u5f88\u591a\u7b2c\u4e09\u65b9\u5546\u4e1a\u7684 SDK\uff0c\u8fd9\u4e9b SDK \u5176\u5b9e\u6709\u597d\u6709\u574f\uff0c\u5927\u5382\u7684 SDK \u53ef\u80fd\u5185\u5b58\u6cc4\u6f0f\u4f1a\u5c11\u4e00\u4e9b\uff0c\u4f46\u4e00\u4e9b\u5c0f\u5382\u7684 SDK \u8d28\u91cf\u4e5f\u5c31\u4e0d\u592a\u9760\u8c31\u4e00\u4e9b\u3002\u90a3\u5e94\u5bf9\u8fd9\u79cd\u6211\u4eec\u65e0\u6cd5\u6539\u53d8\u7684\u60c5\u51b5\uff0c\u6700\u597d\u7684\u529e\u6cd5\u5c31\u662f\u6269\u5927\u5185\u5b58\u3002 \u6269\u5927\u5185\u5b58\u901a\u5e38\u6709\u4e24\u79cd\u65b9\u6cd5\uff1a\u4e00\u4e2a\u662f\u5728\u6e05\u5355\u6587\u4ef6\u4e2d\u7684 Application \u4e0b\u6dfb\u52a0largeHeap=\u201dtrue\u201d\u8fd9\u4e2a\u5c5e\u6027\uff0c\u53e6\u4e00\u4e2a\u5c31\u662f\u540c\u4e00\u4e2a\u5e94\u7528\u5f00\u542f\u591a\u4e2a\u8fdb\u7a0b\u6765\u6269\u5927\u4e00\u4e2a\u5e94\u7528\u7684\u603b\u5185\u5b58\u7a7a\u95f4\u3002\u7b2c\u4e8c\u79cd\u65b9\u6cd5\u5176\u5b9e\u5c31\u5f88\u5e38\u89c1\u4e86\uff0c\u6bd4\u65b9\u8bf4\u6211\u4f7f\u7528\u8fc7\u4e2a\u63a8\u7684 S DK\uff0c\u4e2a\u63a8\u7684 Service \u5176\u5b9e\u5c31\u662f\u5904\u5728\u53e6\u5916\u4e00\u4e2a\u5355\u72ec\u7684\u8fdb\u7a0b\u4e2d\u3002 Android \u4e2d\u7684\u5185\u5b58\u4f18\u5316\u603b\u7684\u6765\u8bf4\u5c31\u662f\u5f00\u6e90\u548c\u8282\u6d41\uff0c\u5f00\u6e90\u5c31\u662f\u6269\u5927\u5185\u5b58\uff0c\u8282\u6d41\u5c31\u662f\u907f\u514d\u5185\u5b58\u6cc4\u6f0f\u3002</p>"},{"location":"030Android/010Basic/#_97","title":"Android\u57fa\u7840","text":"\u7b54\u6848"},{"location":"030Android/010Basic/#_98","title":"Android\u57fa\u7840","text":"\u7b54\u6848"},{"location":"030Android/020SystemSourceCode/","title":"Android\u7cfb\u7edf\u6e90\u7801\u5206\u6790","text":""},{"location":"030Android/020SystemSourceCode/#_1","title":"Android\u7cfb\u7edf\u6e90\u7801\u89e3\u6790","text":""},{"location":"030Android/020SystemSourceCode/#android-activity","title":"Android Activity\u7684\u542f\u52a8\u8fc7\u7a0b","text":"\u7b54\u6848 <p>\u4e00\u4e9b\u7f51\u7edc\u8d44\u6599 https://github.com/jeanboydev/Android-ReadTheFuckingSourceCode/blob/master/article/android/framework/Android-Activity%E5%90%AF%E5%8A%A8%E8%BF%87%E7%A8%8B.md</p> <p>\u8fd9\u4e2a\u6211\u5f3a\u70c8\u5efa\u8bae\u6bcf\u4e2aAndroid\u5f00\u53d1\u4eba\u5458\u90fd\u8981\u6e05\u695a\u7684\u77e5\u9053\uff0c\u5e76\u4e14\u8ddf\u4e00\u4e0b\u6e90\u7801\uff0c\u51e0\u4e2a\u6838\u5fc3\u7c7b\u7684\u4f5c\u7528\u3002\u4f60\u4f1a\u5bf9Android\u6709\u4e00\u4e2a\u66f4\u597d\u7684\u8ba4\u8bc6\u3002</p> <p>Android Activity\u7684\u542f\u52a8\u8fc7\u7a0b\u6d89\u53ca\u591a\u4e2a\u6b65\u9aa4\u548c\u7ec4\u4ef6\u4e4b\u95f4\u7684\u4ea4\u4e92\uff0c\u4e3b\u8981\u5305\u62ec\u4ee5\u4e0b\u51e0\u4e2a\u9636\u6bb5\uff1a</p>"},{"location":"030Android/020SystemSourceCode/#1","title":"1. \u542f\u52a8\u8bf7\u6c42","text":"<ul> <li>\u901a\u8fc7 <code>startActivity()</code> \u6216 <code>startActivityForResult()</code> \u53d1\u8d77\u542f\u52a8\u8bf7\u6c42\u3002</li> <li>\u8fd9\u4e9b\u65b9\u6cd5\u4f1a\u8c03\u7528 <code>Instrumentation</code> \u7684 <code>execStartActivity()</code>\u3002</li> </ul>"},{"location":"030Android/020SystemSourceCode/#2-instrumentation","title":"2. Instrumentation\u5904\u7406","text":"<ul> <li><code>Instrumentation</code> \u8d1f\u8d23\u76d1\u63a7\u5e94\u7528\u4e0e\u7cfb\u7edf\u7684\u4ea4\u4e92\uff0c<code>execStartActivity()</code> \u4f1a\u901a\u8fc7 <code>ActivityTaskManagerService</code> (ATMS) \u5c06\u8bf7\u6c42\u4f20\u9012\u7ed9\u7cfb\u7edf\u670d\u52a1\u3002</li> </ul>"},{"location":"030Android/020SystemSourceCode/#3-activitytaskmanagerservice-atms","title":"3. ActivityTaskManagerService (ATMS) \u5904\u7406","text":"<ul> <li>ATMS \u662f\u7cfb\u7edf\u670d\u52a1\uff0c\u8d1f\u8d23\u7ba1\u7406 Activity \u548c\u4efb\u52a1\u6808\u3002</li> <li>ATMS \u6839\u636e <code>Intent</code> \u548c <code>ActivityInfo</code> \u786e\u5b9a\u76ee\u6807 Activity\uff0c\u5e76\u68c0\u67e5\u6743\u9650\u548c\u542f\u52a8\u6a21\u5f0f\u3002</li> </ul>"},{"location":"030Android/020SystemSourceCode/#4-activityrecord","title":"4. \u521b\u5efaActivityRecord","text":"<ul> <li>ATMS \u4e3a\u5373\u5c06\u542f\u52a8\u7684 Activity \u521b\u5efa <code>ActivityRecord</code>\uff0c\u8bb0\u5f55\u5176\u72b6\u6001\u548c\u4fe1\u606f\u3002</li> </ul>"},{"location":"030Android/020SystemSourceCode/#5","title":"5. \u5e94\u7528\u8fdb\u7a0b\u4ea4\u4e92","text":"<ul> <li>\u5982\u679c\u76ee\u6807 Activity \u6240\u5728\u8fdb\u7a0b\u672a\u542f\u52a8\uff0cATMS \u4f1a\u901a\u8fc7 <code>Zygote</code> \u521b\u5efa\u65b0\u8fdb\u7a0b\u3002</li> <li>\u5982\u679c\u8fdb\u7a0b\u5df2\u5b58\u5728\uff0cATMS \u76f4\u63a5\u4e0e <code>ApplicationThread</code> \u901a\u4fe1\u3002</li> </ul>"},{"location":"030Android/020SystemSourceCode/#6-applicationthread","title":"6. ApplicationThread\u5904\u7406","text":"<ul> <li><code>ApplicationThread</code> \u662f <code>ActivityThread</code> \u7684\u5185\u90e8\u7c7b\uff0c\u8d1f\u8d23\u4e0e ATMS \u901a\u4fe1\u3002</li> <li>\u6536\u5230\u542f\u52a8\u8bf7\u6c42\u540e\uff0c<code>ApplicationThread</code> \u901a\u8fc7 <code>H</code>\uff08Handler\uff09\u5c06\u6d88\u606f\u4f20\u9012\u7ed9 <code>ActivityThread</code>\u3002</li> </ul>"},{"location":"030Android/020SystemSourceCode/#7-activitythread","title":"7. ActivityThread\u5904\u7406","text":"<ul> <li><code>ActivityThread</code> \u662f\u4e3b\u7ebf\u7a0b\uff0c\u8d1f\u8d23\u7ba1\u7406 Activity \u751f\u547d\u5468\u671f\u3002</li> <li>\u8c03\u7528 <code>handleLaunchActivity()</code>\uff0c\u4f9d\u6b21\u6267\u884c <code>performLaunchActivity()</code> \u548c <code>handleResumeActivity()</code>\u3002</li> </ul>"},{"location":"030Android/020SystemSourceCode/#8-activity","title":"8. \u521b\u5efa\u548c\u521d\u59cb\u5316Activity","text":"<ul> <li><code>performLaunchActivity()</code> \u901a\u8fc7\u53cd\u5c04\u521b\u5efa Activity \u5b9e\u4f8b\uff0c\u5e76\u8c03\u7528\u5176 <code>attach()</code> \u65b9\u6cd5\u7ed1\u5b9a\u4e0a\u4e0b\u6587\u3002</li> <li>\u63a5\u7740\u8c03\u7528 <code>onCreate()</code>\uff0c\u5b8c\u6210\u5e03\u5c40\u52a0\u8f7d\u548c\u521d\u59cb\u5316\u3002</li> </ul>"},{"location":"030Android/020SystemSourceCode/#9-activity","title":"9. Activity\u751f\u547d\u5468\u671f\u56de\u8c03","text":"<ul> <li><code>handleResumeActivity()</code> \u8c03\u7528 <code>onStart()</code> \u548c <code>onResume()</code>\uff0c\u4f7f Activity \u8fdb\u5165\u524d\u53f0\u3002</li> </ul>"},{"location":"030Android/020SystemSourceCode/#10","title":"10. \u754c\u9762\u663e\u793a","text":"<ul> <li><code>onResume()</code> \u5b8c\u6210\u540e\uff0cActivity \u7684\u754c\u9762\u663e\u793a\u5728\u5c4f\u5e55\u4e0a\uff0c\u7528\u6237\u53ef\u4e0e\u4e4b\u4ea4\u4e92\u3002</li> </ul>"},{"location":"030Android/020SystemSourceCode/#_2","title":"\u603b\u7ed3","text":"<p>Activity \u542f\u52a8\u8fc7\u7a0b\u6d89\u53ca\u591a\u4e2a\u7ec4\u4ef6\u534f\u4f5c\uff0c\u4e3b\u8981\u5305\u62ec\uff1a 1. \u542f\u52a8\u8bf7\u6c42\uff1a\u901a\u8fc7 <code>startActivity()</code> \u53d1\u8d77\u3002 2. \u7cfb\u7edf\u670d\u52a1\u5904\u7406\uff1aATMS \u7ba1\u7406 Activity \u548c\u4efb\u52a1\u6808\u3002 3. \u8fdb\u7a0b\u548c\u7ebf\u7a0b\u4ea4\u4e92\uff1a\u901a\u8fc7 <code>ApplicationThread</code> \u548c <code>ActivityThread</code> \u5904\u7406\u3002 4. Activity\u521b\u5efa\u548c\u751f\u547d\u5468\u671f\uff1a\u521b\u5efa\u5b9e\u4f8b\u5e76\u56de\u8c03\u751f\u547d\u5468\u671f\u65b9\u6cd5\u3002 5. \u754c\u9762\u663e\u793a\uff1a\u5b8c\u6210\u751f\u547d\u5468\u671f\u56de\u8c03\u540e\uff0c\u754c\u9762\u663e\u793a\u3002</p> <p>\u6574\u4e2a\u8fc7\u7a0b\u786e\u4fdd\u4e86 Activity \u7684\u6b63\u786e\u542f\u52a8\u548c\u663e\u793a\u3002</p> <p>\u6839Activity\u542f\u52a8\u6d41\u7a0b\u6574\u4f53\u4e0a\u5b66\u4e60\u610f\u4e49\u8f83\u5927\uff0c\u5efa\u8bae\u4ece\u6574\u4f53\u6d41\u7a0b\u5165\u624b\uff0c\u7136\u540e\u53ef\u4ee5\u5bf9\u7ec6\u8282\u63a8\u6572\uff0c\u9047\u5230\u6d41\u7a0b\u4e0d\u901a\u65f6\u4e5f\u53ef\u4ee5debug\u3002 Activity\u7684\u6574\u4f53\u542f\u52a8\u6d41\u7a0b\uff1a</p> <p>\u70b9\u51fb\u56fe\u6807\uff0cLauncher\u5411AMS\u8bf7\u6c42\u542f\u52a8\u8be5App AMS\u53cd\u9988\u6536\u5230\u542f\u52a8\u8bf7\u6c42,\u5e76\u544a\u77e5Launcher\u8fdb\u5165pause\u72b6\u6001 Launcher\u8fdb\u5165Paused\u72b6\u6001\u5e76\u544a\u77e5AMS AMS\u68c0\u6d4b\u65b0\u7684App\u662f\u5426\u5df2\u542f\u52a8\uff0c\u5426\u5219\u901a\u77e5Zygote\u521b\u5efa\u65b0\u7684\u8fdb\u7a0b\u5e76\u8c03\u7528ActivityThread.main\u65b9\u6cd5 \u5e94\u7528\u8fdb\u7a0b\u542f\u52a8ActivityThread ActivityThread\u4e2dH\u7c7b\u5904\u7406\u9700\u8981\u542f\u52a8Activity\u7684\u8bf7\u6c42\u6d88\u606f</p>"},{"location":"030Android/020SystemSourceCode/#android-recyclerview","title":"Android RecyclerView\u6e90\u7801\u89e3\u6790","text":"\u7b54\u6848 <p>https://www.cnblogs.com/huansky/p/14252980.html \u7ed8\u5236 https://www.cnblogs.com/huansky/p/14288574.html \u590d\u7528 https://zhuanlan.zhihu.com/p/263841552</p>"},{"location":"030Android/020SystemSourceCode/#android-recyclerviewlistview","title":"\u4ece\u6e90\u7801\u89d2\u5ea6\u5206\u6790Android RecyclerView\u548cListView\u7684\u533a\u522b\uff0c\u4ee5\u53ca\u6709\u54ea\u4e9b\u7279\u6027","text":"\u7b54\u6848 <p>\u4ece\u6e90\u7801\u89d2\u5ea6\u5206\u6790\uff0c<code>RecyclerView</code> \u548c <code>ListView</code> \u5728\u5b9e\u73b0\u673a\u5236\u3001\u6269\u5c55\u6027\u548c\u6027\u80fd\u4f18\u5316\u7b49\u65b9\u9762\u6709\u663e\u8457\u5dee\u5f02\u3002\u4ee5\u4e0b\u662f\u5b83\u4eec\u7684\u6838\u5fc3\u533a\u522b\u548c\u7279\u6027\uff1a</p>"},{"location":"030Android/020SystemSourceCode/#1-viewholder","title":"1. ViewHolder \u6a21\u5f0f","text":"<ul> <li>ListView: <code>ViewHolder</code> \u6a21\u5f0f\u5e76\u975e\u5f3a\u5236\u4f7f\u7528\uff0c\u5f00\u53d1\u8005\u9700\u624b\u52a8\u5b9e\u73b0\u4ee5\u51cf\u5c11 <code>findViewById</code> \u7684\u8c03\u7528\u3002\u82e5\u672a\u6b63\u786e\u4f7f\u7528\uff0c\u53ef\u80fd\u5bfc\u81f4\u6027\u80fd\u95ee\u9898\u3002</li> <li>RecyclerView: \u5f3a\u5236\u4f7f\u7528 <code>ViewHolder</code> \u6a21\u5f0f\uff0c\u901a\u8fc7 <code>RecyclerView.ViewHolder</code> \u7c7b\u7ba1\u7406\u89c6\u56fe\uff0c\u786e\u4fdd\u9ad8\u6548\u590d\u7528\uff0c\u51cf\u5c11\u4e0d\u5fc5\u8981\u7684\u89c6\u56fe\u67e5\u627e\u3002</li> </ul>"},{"location":"030Android/020SystemSourceCode/#2","title":"2. \u5e03\u5c40\u7ba1\u7406","text":"<ul> <li>ListView: \u5e03\u5c40\u7ba1\u7406\u56fa\u5b9a\u4e3a\u5782\u76f4\u5217\u8868\uff0c\u4e0d\u652f\u6301\u5176\u4ed6\u5e03\u5c40\u65b9\u5f0f\u3002</li> <li>RecyclerView: \u901a\u8fc7 <code>RecyclerView.LayoutManager</code> \u5b9e\u73b0\u7075\u6d3b\u7684\u5e03\u5c40\u7ba1\u7406\uff0c\u652f\u6301\u7ebf\u6027\u3001\u7f51\u683c\u3001\u7011\u5e03\u6d41\u7b49\u591a\u79cd\u5e03\u5c40\uff0c\u6269\u5c55\u6027\u5f3a\u3002</li> </ul>"},{"location":"030Android/020SystemSourceCode/#3-item","title":"3. Item \u52a8\u753b","text":"<ul> <li>ListView: \u9ed8\u8ba4\u4e0d\u652f\u6301 Item \u52a8\u753b\uff0c\u9700\u624b\u52a8\u5b9e\u73b0\u3002</li> <li>RecyclerView: \u5185\u7f6e <code>RecyclerView.ItemAnimator</code>\uff0c\u652f\u6301\u6dfb\u52a0\u3001\u5220\u9664\u3001\u79fb\u52a8\u7b49\u52a8\u753b\u6548\u679c\uff0c\u4e14\u53ef\u81ea\u5b9a\u4e49\u52a8\u753b\u3002</li> </ul>"},{"location":"030Android/020SystemSourceCode/#4","title":"4. \u6570\u636e\u66f4\u65b0","text":"<ul> <li>ListView: \u4f7f\u7528 <code>Adapter</code> \u7684 <code>notifyDataSetChanged()</code> \u5237\u65b0\u6574\u4e2a\u5217\u8868\uff0c\u6548\u7387\u8f83\u4f4e\u3002</li> <li>RecyclerView: \u63d0\u4f9b <code>Adapter</code> \u7684 <code>notifyItemInserted()</code>\u3001<code>notifyItemRemoved()</code> \u7b49\u65b9\u6cd5\uff0c\u652f\u6301\u5c40\u90e8\u5237\u65b0\uff0c\u63d0\u5347\u6027\u80fd\u3002</li> </ul>"},{"location":"030Android/020SystemSourceCode/#5-item","title":"5. Item \u88c5\u9970","text":"<ul> <li>ListView: \u4e0d\u652f\u6301 Item \u88c5\u9970\u3002</li> <li>RecyclerView: \u901a\u8fc7 <code>RecyclerView.ItemDecoration</code> \u652f\u6301\u6dfb\u52a0\u5206\u5272\u7ebf\u3001\u95f4\u8ddd\u7b49\u88c5\u9970\u6548\u679c\uff0c\u4e14\u53ef\u81ea\u5b9a\u4e49\u3002</li> </ul>"},{"location":"030Android/020SystemSourceCode/#6-item","title":"6. Item \u70b9\u51fb\u4e8b\u4ef6","text":"<ul> <li>ListView: \u5185\u7f6e <code>OnItemClickListener</code> \u548c <code>OnItemLongClickListener</code>\uff0c\u4f7f\u7528\u65b9\u4fbf\u3002</li> <li>RecyclerView: \u4e0d\u5185\u7f6e\u70b9\u51fb\u4e8b\u4ef6\uff0c\u9700\u5f00\u53d1\u8005\u901a\u8fc7 <code>ViewHolder</code> \u6216 <code>RecyclerView.addOnItemTouchListener()</code> \u5b9e\u73b0\uff0c\u7075\u6d3b\u6027\u66f4\u9ad8\u3002</li> </ul>"},{"location":"030Android/020SystemSourceCode/#7","title":"7. \u6e90\u7801\u7ed3\u6784","text":"<ul> <li>ListView: \u76f4\u63a5\u7ee7\u627f <code>AbsListView</code>\uff0c\u5e03\u5c40\u548c\u903b\u8f91\u8026\u5408\u5ea6\u9ad8\uff0c\u6269\u5c55\u6027\u8f83\u5dee\u3002</li> <li>RecyclerView: \u7ee7\u627f <code>ViewGroup</code>\uff0c\u901a\u8fc7 <code>LayoutManager</code>\u3001<code>Adapter</code>\u3001<code>ItemAnimator</code> \u7b49\u7ec4\u4ef6\u89e3\u8026\uff0c\u6269\u5c55\u6027\u66f4\u5f3a\u3002</li> </ul>"},{"location":"030Android/020SystemSourceCode/#8","title":"8. \u6027\u80fd\u4f18\u5316","text":"<ul> <li>ListView: \u590d\u7528\u673a\u5236\u7b80\u5355\uff0c\u6027\u80fd\u4f18\u5316\u6709\u9650\u3002</li> <li>RecyclerView: \u901a\u8fc7 <code>Recycler</code> \u7c7b\u5b9e\u73b0\u590d\u6742\u590d\u7528\u673a\u5236\uff0c\u652f\u6301\u591a\u7ea7\u7f13\u5b58\uff0c\u6027\u80fd\u66f4\u4f18\u3002</li> </ul>"},{"location":"030Android/020SystemSourceCode/#9","title":"9. \u5d4c\u5957\u6eda\u52a8","text":"<ul> <li>ListView: \u4e0d\u652f\u6301\u5d4c\u5957\u6eda\u52a8\u3002</li> <li>RecyclerView: \u652f\u6301\u5d4c\u5957\u6eda\u52a8\uff0c\u4e0e <code>NestedScrollingParent</code> \u548c <code>NestedScrollingChild</code> \u63a5\u53e3\u517c\u5bb9\uff0c\u9002\u7528\u4e8e\u590d\u6742\u6eda\u52a8\u573a\u666f\u3002</li> </ul>"},{"location":"030Android/020SystemSourceCode/#10_1","title":"10. \u6269\u5c55\u6027","text":"<ul> <li>ListView: \u6269\u5c55\u6027\u6709\u9650\uff0c\u5b9a\u5236\u590d\u6742\u5e03\u5c40\u6216\u884c\u4e3a\u8f83\u56f0\u96be\u3002</li> <li>RecyclerView: \u9ad8\u5ea6\u6a21\u5757\u5316\uff0c\u6613\u4e8e\u6269\u5c55\u548c\u5b9a\u5236\uff0c\u9002\u5408\u590d\u6742\u9700\u6c42\u3002</li> </ul>"},{"location":"030Android/020SystemSourceCode/#_3","title":"\u603b\u7ed3","text":"<ul> <li>ListView: \u7b80\u5355\u6613\u7528\uff0c\u9002\u5408\u57fa\u7840\u5217\u8868\u9700\u6c42\uff0c\u4f46\u6269\u5c55\u6027\u548c\u6027\u80fd\u4f18\u5316\u6709\u9650\u3002</li> <li>RecyclerView: \u529f\u80fd\u5f3a\u5927\uff0c\u6269\u5c55\u6027\u9ad8\uff0c\u652f\u6301\u590d\u6742\u5e03\u5c40\u548c\u52a8\u753b\uff0c\u6027\u80fd\u66f4\u4f18\uff0c\u9002\u5408\u73b0\u4ee3\u5e94\u7528\u5f00\u53d1\u3002</li> </ul> <p>\u5728\u5f00\u53d1\u4e2d\uff0c\u4f18\u5148\u9009\u62e9 <code>RecyclerView</code>\uff0c\u9664\u975e\u6709\u7279\u6b8a\u9700\u6c42\u6216\u517c\u5bb9\u6027\u8003\u8651\u3002</p>"},{"location":"030Android/020SystemSourceCode/#android-recyclerview_1","title":"Android RecyclerView\u7684\u7f13\u5b58\u673a\u5236","text":"\u7b54\u6848 <p>\u4ece\u7f13\u5b58\u7684\u89d2\u5ea6\u5206\u6790\uff0cAndroid \u7684 <code>RecyclerView</code> \u901a\u8fc7\u9ad8\u6548\u7684\u7f13\u5b58\u673a\u5236\u6765\u63d0\u5347\u6eda\u52a8\u6027\u80fd\u548c\u51cf\u5c11\u8d44\u6e90\u6d88\u8017\u3002\u4ee5\u4e0b\u662f <code>RecyclerView</code> \u7f13\u5b58\u673a\u5236\u7684\u5173\u952e\u70b9\uff1a</p>"},{"location":"030Android/020SystemSourceCode/#1-viewholder_1","title":"1. ViewHolder \u7f13\u5b58","text":"<p><code>RecyclerView</code> \u4f7f\u7528 <code>ViewHolder</code> \u6a21\u5f0f\u6765\u7f13\u5b58\u89c6\u56fe\uff0c\u907f\u514d\u9891\u7e41\u521b\u5efa\u548c\u9500\u6bc1 <code>View</code> \u5bf9\u8c61\u3002<code>ViewHolder</code> \u7f13\u5b58\u5206\u4e3a\u4ee5\u4e0b\u51e0\u5c42\uff1a</p> <ul> <li>Attached Scrap: \u7f13\u5b58\u5f53\u524d\u53ef\u89c1\u7684 <code>ViewHolder</code>\uff0c\u7528\u4e8e\u5feb\u901f\u91cd\u65b0\u7ed1\u5b9a\u6570\u636e\u3002</li> <li>Cached Views: \u7f13\u5b58\u521a\u521a\u6ed1\u51fa\u5c4f\u5e55\u7684 <code>ViewHolder</code>\uff0c\u6570\u91cf\u7531 <code>RecyclerView</code> \u7684 <code>mViewCacheMax</code> \u51b3\u5b9a\u3002</li> <li>Recycled Pool: \u7f13\u5b58\u5b8c\u5168\u4e0d\u53ef\u89c1\u7684 <code>ViewHolder</code>\uff0c\u4f9b\u540e\u7eed\u590d\u7528\u3002</li> </ul>"},{"location":"030Android/020SystemSourceCode/#2-recycler-pool","title":"2. Recycler Pool","text":"<p><code>Recycled Pool</code> \u662f\u4e00\u4e2a\u5168\u5c40\u7f13\u5b58\uff0c\u5b58\u50a8\u4e0d\u540c <code>ViewHolder</code> \u7c7b\u578b\uff0c\u4f9b\u591a\u4e2a <code>RecyclerView</code> \u5b9e\u4f8b\u5171\u4eab\uff0c\u9002\u5408\u591a\u5217\u8868\u573a\u666f\u3002</p>"},{"location":"030Android/020SystemSourceCode/#3-prefetch","title":"3. Prefetch \u673a\u5236","text":"<p><code>RecyclerView</code> \u5728 Android 5.0 \u540e\u5f15\u5165\u4e86\u9884\u53d6\u673a\u5236\uff0c\u5229\u7528 UI \u7ebf\u7a0b\u7a7a\u95f2\u65f6\u95f4\u63d0\u524d\u52a0\u8f7d\u5373\u5c06\u663e\u793a\u7684 <code>ViewHolder</code>\uff0c\u51cf\u5c11\u5361\u987f\u3002</p>"},{"location":"030Android/020SystemSourceCode/#4-item-animations","title":"4. Item Animations \u7f13\u5b58","text":"<p><code>RecyclerView</code> \u7f13\u5b58\u52a8\u753b\u72b6\u6001\uff0c\u786e\u4fdd\u52a8\u753b\u5e73\u6ed1\u6267\u884c\uff0c\u907f\u514d\u56e0\u9891\u7e41\u521b\u5efa\u548c\u9500\u6bc1\u52a8\u753b\u5bf9\u8c61\u5bfc\u81f4\u7684\u6027\u80fd\u95ee\u9898\u3002</p>"},{"location":"030Android/020SystemSourceCode/#5-layoutmanager","title":"5. LayoutManager \u7f13\u5b58","text":"<p><code>LayoutManager</code> \u8d1f\u8d23\u5e03\u5c40\u7ba1\u7406\uff0c\u901a\u8fc7\u7f13\u5b58\u5e03\u5c40\u4fe1\u606f\u51cf\u5c11\u8ba1\u7b97\u91cf\uff0c\u63d0\u5347\u5e03\u5c40\u6548\u7387\u3002</p>"},{"location":"030Android/020SystemSourceCode/#6","title":"6. \u81ea\u5b9a\u4e49\u7f13\u5b58\u7b56\u7565","text":"<p>\u5f00\u53d1\u8005\u53ef\u4ee5\u901a\u8fc7 <code>setItemViewCacheSize()</code> \u8c03\u6574\u7f13\u5b58\u5927\u5c0f\uff0c\u6216\u901a\u8fc7 <code>RecyclerView.RecycledViewPool</code> \u81ea\u5b9a\u4e49\u7f13\u5b58\u6c60\uff0c\u4f18\u5316\u6027\u80fd\u3002</p>"},{"location":"030Android/020SystemSourceCode/#_4","title":"\u603b\u7ed3","text":"<p><code>RecyclerView</code> \u901a\u8fc7\u591a\u5c42\u7f13\u5b58\u673a\u5236\uff08<code>ViewHolder</code> \u7f13\u5b58\u3001<code>Recycler Pool</code>\u3001\u9884\u53d6\u673a\u5236\u7b49\uff09\u663e\u8457\u63d0\u5347\u4e86\u6eda\u52a8\u6027\u80fd\uff0c\u51cf\u5c11\u4e86\u8d44\u6e90\u6d88\u8017\u3002\u5f00\u53d1\u8005\u53ef\u4ee5\u6839\u636e\u9700\u6c42\u8fdb\u4e00\u6b65\u4f18\u5316\u7f13\u5b58\u7b56\u7565\uff0c\u63d0\u5347\u5e94\u7528\u6027\u80fd\u3002</p> <p><code>ViewHolder</code> \u662f <code>RecyclerView</code> \u4e2d\u7528\u4e8e\u7f13\u5b58\u548c\u7ba1\u7406\u5217\u8868\u9879\u89c6\u56fe\u7684\u6838\u5fc3\u7ec4\u4ef6\u3002\u5b83\u5b58\u50a8\u4e86\u4e0e\u5217\u8868\u9879\u89c6\u56fe\u76f8\u5173\u7684\u4fe1\u606f\uff0c\u5e76\u901a\u8fc7\u590d\u7528\u673a\u5236\u63d0\u5347\u6027\u80fd\u3002\u4ee5\u4e0b\u662f <code>ViewHolder</code> \u5b58\u50a8\u7684\u5177\u4f53\u4fe1\u606f\u53ca\u5176\u4f5c\u4e3a\u7f13\u5b58\u4ecb\u8d28\u7684\u539f\u56e0\uff1a</p>"},{"location":"030Android/020SystemSourceCode/#1-viewholder_2","title":"1. ViewHolder \u5b58\u50a8\u7684\u4fe1\u606f","text":"<p><code>ViewHolder</code> \u4e3b\u8981\u5b58\u50a8\u4ee5\u4e0b\u4fe1\u606f\uff1a</p>"},{"location":"030Android/020SystemSourceCode/#1_1","title":"(1) \u89c6\u56fe\u5f15\u7528","text":"<ul> <li><code>ViewHolder</code> \u6301\u6709\u5217\u8868\u9879\u89c6\u56fe\uff08<code>View</code>\uff09\u7684\u5f15\u7528\uff0c\u907f\u514d\u6bcf\u6b21\u7ed1\u5b9a\u6570\u636e\u65f6\u90fd\u8c03\u7528 <code>findViewById</code>\uff0c\u4ece\u800c\u51cf\u5c11\u6027\u80fd\u5f00\u9500\u3002</li> <li>\u4f8b\u5982\uff1a <pre><code>public class MyViewHolder extends RecyclerView.ViewHolder {\n    TextView title;\n    ImageView icon;\n\n    public MyViewHolder(View itemView) {\n        super(itemView);\n        title = itemView.findViewById(R.id.title);\n        icon = itemView.findViewById(R.id.icon);\n    }\n}\n</code></pre></li> </ul>"},{"location":"030Android/020SystemSourceCode/#2_1","title":"(2) \u6570\u636e\u7ed1\u5b9a\u72b6\u6001","text":"<ul> <li><code>ViewHolder</code> \u53ef\u4ee5\u5b58\u50a8\u4e0e\u5f53\u524d\u89c6\u56fe\u76f8\u5173\u7684\u4e34\u65f6\u72b6\u6001\uff0c\u4f8b\u5982\u9009\u4e2d\u72b6\u6001\u3001\u52a8\u753b\u72b6\u6001\u7b49\u3002</li> <li>\u8fd9\u4e9b\u72b6\u6001\u5728\u89c6\u56fe\u590d\u7528\u65f6\u53ef\u4ee5\u5feb\u901f\u6062\u590d\uff0c\u907f\u514d\u91cd\u65b0\u8ba1\u7b97\u3002</li> </ul>"},{"location":"030Android/020SystemSourceCode/#3","title":"(3) \u4f4d\u7f6e\u4fe1\u606f","text":"<ul> <li><code>ViewHolder</code> \u4f1a\u8bb0\u5f55\u5f53\u524d\u5217\u8868\u9879\u7684\u4f4d\u7f6e\uff08<code>position</code>\uff09\uff0c\u7528\u4e8e\u5728\u6eda\u52a8\u65f6\u5feb\u901f\u5b9a\u4f4d\u548c\u7ed1\u5b9a\u6570\u636e\u3002</li> </ul>"},{"location":"030Android/020SystemSourceCode/#4_1","title":"(4) \u5176\u4ed6\u5143\u6570\u636e","text":"<ul> <li><code>ViewHolder</code> \u53ef\u4ee5\u5b58\u50a8\u4e0e\u5217\u8868\u9879\u76f8\u5173\u7684\u5176\u4ed6\u5143\u6570\u636e\uff0c\u4f8b\u5982\u89c6\u56fe\u7c7b\u578b\uff08<code>itemType</code>\uff09\u3001\u7ed1\u5b9a\u65f6\u95f4\u6233\u7b49\u3002</li> </ul>"},{"location":"030Android/020SystemSourceCode/#2-recyclerview-viewholder","title":"2. \u4e3a\u4ec0\u4e48 RecyclerView \u4f7f\u7528 ViewHolder \u4f5c\u4e3a\u7f13\u5b58\u4ecb\u8d28\uff1f","text":"<p><code>RecyclerView</code> \u4f7f\u7528 <code>ViewHolder</code> \u4f5c\u4e3a\u7f13\u5b58\u4ecb\u8d28\u7684\u4e3b\u8981\u539f\u56e0\u5982\u4e0b\uff1a</p>"},{"location":"030Android/020SystemSourceCode/#1-findviewbyid","title":"(1) \u51cf\u5c11 findViewById \u7684\u5f00\u9500","text":"<ul> <li>\u5728\u4f20\u7edf\u7684 <code>ListView</code> \u6216 <code>GridView</code> \u4e2d\uff0c\u6bcf\u6b21\u7ed1\u5b9a\u6570\u636e\u65f6\u90fd\u9700\u8981\u8c03\u7528 <code>findViewById</code> \u6765\u83b7\u53d6\u5b50\u89c6\u56fe\u7684\u5f15\u7528\uff0c\u8fd9\u662f\u4e00\u4e2a\u8017\u65f6\u7684\u64cd\u4f5c\u3002</li> <li><code>ViewHolder</code> \u901a\u8fc7\u7f13\u5b58\u89c6\u56fe\u5f15\u7528\uff0c\u907f\u514d\u4e86\u91cd\u590d\u8c03\u7528 <code>findViewById</code>\uff0c\u4ece\u800c\u63d0\u5347\u4e86\u6027\u80fd\u3002</li> </ul>"},{"location":"030Android/020SystemSourceCode/#2_2","title":"(2) \u89c6\u56fe\u590d\u7528","text":"<ul> <li><code>ViewHolder</code> \u662f <code>RecyclerView</code> \u89c6\u56fe\u590d\u7528\u7684\u57fa\u672c\u5355\u4f4d\u3002\u5f53\u5217\u8868\u9879\u6ed1\u51fa\u5c4f\u5e55\u65f6\uff0c<code>ViewHolder</code> \u4f1a\u88ab\u653e\u5165\u7f13\u5b58\u6c60\u4e2d\uff0c\u4f9b\u540e\u7eed\u590d\u7528\u3002</li> <li>\u590d\u7528 <code>ViewHolder</code> \u53ef\u4ee5\u51cf\u5c11\u9891\u7e41\u521b\u5efa\u548c\u9500\u6bc1\u89c6\u56fe\u7684\u5f00\u9500\uff0c\u964d\u4f4e\u5185\u5b58\u5360\u7528\u548c GC \u538b\u529b\u3002</li> </ul>"},{"location":"030Android/020SystemSourceCode/#3_1","title":"(3) \u5206\u79bb\u89c6\u56fe\u548c\u6570\u636e","text":"<ul> <li><code>ViewHolder</code> \u5c06\u89c6\u56fe\u7684\u5f15\u7528\u548c\u6570\u636e\u7684\u7ed1\u5b9a\u903b\u8f91\u5206\u79bb\uff0c\u4f7f\u5f97\u4ee3\u7801\u66f4\u6e05\u6670\u3001\u66f4\u6613\u4e8e\u7ef4\u62a4\u3002</li> <li>\u6570\u636e\u7ed1\u5b9a\u901a\u8fc7 <code>onBindViewHolder</code> \u65b9\u6cd5\u5b9e\u73b0\uff0c\u800c\u89c6\u56fe\u7684\u521d\u59cb\u5316\u548c\u7ba1\u7406\u5219\u7531 <code>ViewHolder</code> \u8d1f\u8d23\u3002</li> </ul>"},{"location":"030Android/020SystemSourceCode/#4_2","title":"(4) \u652f\u6301\u591a\u79cd\u89c6\u56fe\u7c7b\u578b","text":"<ul> <li><code>RecyclerView</code> \u652f\u6301\u591a\u79cd\u89c6\u56fe\u7c7b\u578b\uff08\u4f8b\u5982\u5934\u90e8\u3001\u5c3e\u90e8\u3001\u666e\u901a\u9879\u7b49\uff09\uff0c<code>ViewHolder</code> \u53ef\u4ee5\u6839\u636e\u89c6\u56fe\u7c7b\u578b\uff08<code>itemType</code>\uff09\u8fdb\u884c\u5206\u7c7b\u7f13\u5b58\u3002</li> <li>\u4e0d\u540c\u7c7b\u578b\u7684 <code>ViewHolder</code> \u4f1a\u88ab\u5b58\u50a8\u5728\u4e0d\u540c\u7684\u7f13\u5b58\u6c60\u4e2d\uff0c\u786e\u4fdd\u590d\u7528\u65f6\u7c7b\u578b\u5339\u914d\u3002</li> </ul>"},{"location":"030Android/020SystemSourceCode/#5_1","title":"(5) \u63d0\u5347\u6eda\u52a8\u6027\u80fd","text":"<ul> <li>\u901a\u8fc7 <code>ViewHolder</code> \u7684\u7f13\u5b58\u673a\u5236\uff0c<code>RecyclerView</code> \u53ef\u4ee5\u5728\u6eda\u52a8\u65f6\u5feb\u901f\u590d\u7528\u89c6\u56fe\uff0c\u51cf\u5c11\u5e03\u5c40\u8ba1\u7b97\u548c\u89c6\u56fe\u521b\u5efa\u7684\u65f6\u95f4\uff0c\u4ece\u800c\u63d0\u5347\u6eda\u52a8\u7684\u6d41\u7545\u6027\u3002</li> </ul>"},{"location":"030Android/020SystemSourceCode/#6_1","title":"(6) \u652f\u6301\u52a8\u753b\u548c\u72b6\u6001\u4fdd\u5b58","text":"<ul> <li><code>ViewHolder</code> \u53ef\u4ee5\u4fdd\u5b58\u89c6\u56fe\u7684\u52a8\u753b\u72b6\u6001\u548c\u4e34\u65f6\u72b6\u6001\uff08\u4f8b\u5982\u9009\u4e2d\u72b6\u6001\u3001\u5c55\u5f00\u72b6\u6001\u7b49\uff09\uff0c\u5728\u590d\u7528\u65f6\u80fd\u591f\u5feb\u901f\u6062\u590d\u8fd9\u4e9b\u72b6\u6001\uff0c\u786e\u4fdd\u52a8\u753b\u548c\u4ea4\u4e92\u7684\u8fde\u7eed\u6027\u3002</li> </ul>"},{"location":"030Android/020SystemSourceCode/#3-viewholder","title":"3. ViewHolder \u7684\u5de5\u4f5c\u6d41\u7a0b","text":"<p>\u4ee5\u4e0b\u662f <code>ViewHolder</code> \u5728 <code>RecyclerView</code> \u4e2d\u7684\u5178\u578b\u5de5\u4f5c\u6d41\u7a0b\uff1a</p> <ol> <li>\u521b\u5efa\u9636\u6bb5\uff1a</li> <li>\u5f53 <code>RecyclerView</code> \u9700\u8981\u663e\u793a\u65b0\u7684\u5217\u8868\u9879\u65f6\uff0c\u4f1a\u8c03\u7528 <code>onCreateViewHolder</code> \u521b\u5efa\u4e00\u4e2a\u65b0\u7684 <code>ViewHolder</code>\u3002</li> <li> <p><code>ViewHolder</code> \u4f1a\u521d\u59cb\u5316\u89c6\u56fe\u5e76\u7f13\u5b58\u89c6\u56fe\u5f15\u7528\u3002</p> </li> <li> <p>\u7ed1\u5b9a\u9636\u6bb5\uff1a</p> </li> <li> <p>\u5f53 <code>RecyclerView</code> \u9700\u8981\u663e\u793a\u6570\u636e\u65f6\uff0c\u4f1a\u8c03\u7528 <code>onBindViewHolder</code>\uff0c\u5c06\u6570\u636e\u7ed1\u5b9a\u5230 <code>ViewHolder</code> \u4e2d\u7684\u89c6\u56fe\u4e0a\u3002</p> </li> <li> <p>\u590d\u7528\u9636\u6bb5\uff1a</p> </li> <li>\u5f53\u5217\u8868\u9879\u6ed1\u51fa\u5c4f\u5e55\u65f6\uff0c<code>ViewHolder</code> \u4f1a\u88ab\u653e\u5165\u7f13\u5b58\u6c60\u4e2d\u3002</li> <li> <p>\u5f53\u65b0\u7684\u5217\u8868\u9879\u9700\u8981\u663e\u793a\u65f6\uff0c<code>RecyclerView</code> \u4f1a\u4ece\u7f13\u5b58\u6c60\u4e2d\u83b7\u53d6 <code>ViewHolder</code> \u5e76\u590d\u7528\u3002</p> </li> <li> <p>\u56de\u6536\u9636\u6bb5\uff1a</p> </li> <li>\u5982\u679c <code>ViewHolder</code> \u957f\u65f6\u95f4\u672a\u88ab\u590d\u7528\uff0c\u53ef\u80fd\u4f1a\u88ab\u56de\u6536\u4ee5\u91ca\u653e\u5185\u5b58\u3002</li> </ol>"},{"location":"030Android/020SystemSourceCode/#_5","title":"\u603b\u7ed3","text":"<p><code>ViewHolder</code> \u662f <code>RecyclerView</code> \u6027\u80fd\u4f18\u5316\u7684\u6838\u5fc3\u8bbe\u8ba1\uff0c\u5b83\u901a\u8fc7\u7f13\u5b58\u89c6\u56fe\u5f15\u7528\u3001\u652f\u6301\u89c6\u56fe\u590d\u7528\u3001\u5206\u79bb\u89c6\u56fe\u548c\u6570\u636e\u903b\u8f91\u7b49\u65b9\u5f0f\uff0c\u663e\u8457\u63d0\u5347\u4e86\u5217\u8868\u7684\u6027\u80fd\u548c\u6d41\u7545\u6027\u3002\u4f7f\u7528 <code>ViewHolder</code> \u4f5c\u4e3a\u7f13\u5b58\u4ecb\u8d28\uff0c\u4e0d\u4ec5\u51cf\u5c11\u4e86\u8d44\u6e90\u5f00\u9500\uff0c\u8fd8\u4f7f\u5f97\u4ee3\u7801\u7ed3\u6784\u66f4\u6e05\u6670\u3001\u66f4\u6613\u4e8e\u7ef4\u62a4\u3002</p> <p>https://juejin.cn/post/6844904104637022221 https://www.cnblogs.com/huansky/p/14252980.html \u7ed8\u5236\u6d41\u7a0b https://www.cnblogs.com/huansky/p/14288574.html \u7f13\u5b58\u6d41\u7a0b</p> <p>\u603b\u7ed3\u4e00\u4e0b\u4e0a\u8ff0\u6d41\u7a0b\uff1a\u901a\u8fc7 mAttachedScrap\u3001mCachedViews \u53ca mViewCacheExtension \u83b7\u53d6\u7684 ViewHolder \u4e0d\u9700\u8981\u91cd\u65b0\u521b\u5efa\u5e03\u5c40\u53ca\u7ed1\u5b9a\u6570\u636e\uff1b\u901a\u8fc7\u7f13\u5b58\u6c60 mRecyclerPool \u83b7\u53d6\u7684 ViewHolder\u4e0d\u9700\u8981\u91cd\u65b0\u521b\u5efa\u5e03\u5c40\uff0c\u4f46\u662f\u9700\u8981\u91cd\u65b0\u7ed1\u5b9a\u6570\u636e\uff1b\u5982\u679c\u4e0a\u8ff0\u7f13\u5b58\u4e2d\u90fd\u6ca1\u6709\u83b7\u53d6\u5230\u76ee\u6807 ViewHolder\uff0c\u90a3\u4e48\u5c31\u4f1a\u56de\u8c03 Adapter#onCreateViewHolder \u521b\u5efa\u5e03\u5c40\uff0c\u4ee5\u53ca\u56de\u8c03 Adapter#onBindViewHolder\u6765\u7ed1\u5b9a\u6570\u636e\u3002</p> <p>ViewCacheExtension \u6211\u4eec\u5df2\u7ecf\u77e5\u9053 ViewCacheExtension \u5c5e\u4e8e\u7b2c\u4e09\u7ea7\u7f13\u5b58\uff0c\u9700\u8981\u5f00\u53d1\u8005\u81ea\u884c\u5b9e\u73b0\uff0c\u90a3\u4e48 ViewCacheExtension \u5728\u4ec0\u4e48\u573a\u666f\u4e0b\u4f7f\u7528\uff1f\u53c8\u662f\u5982\u4f55\u5b9e\u73b0\u7684\u5462\uff1f</p> <p>\u9996\u5148\u6211\u4eec\u8981\u660e\u786e\u4e00\u70b9\uff0c\u90a3\u5c31\u662f Recycler \u672c\u8eab\u5df2\u7ecf\u8bbe\u7f6e\u4e86\u597d\u51e0\u7ea7\u7f13\u5b58\u4e86\uff0c\u4e3a\u4ec0\u4e48\u8fd8\u8981\u7559\u4e2a\u63a5\u53e3\u8ba9\u5f00\u53d1\u8005\u53bb\u81ea\u884c\u5b9e\u73b0\u7f13\u5b58\u5462\uff1f</p> <p>\u5173\u4e8e\u8fd9\u4e00\u70b9\uff0c\u6765\u770b\u770b Recycler \u4e2d\u7684\u5176\u4ed6\u7f13\u5b58\uff1a</p> <p>mAttachedScrap \u7528\u6765\u5904\u7406\u53ef\u89c1\u5c4f\u5e55\u7684\u7f13\u5b58\uff1b</p> <p>mCachedViews \u91cc\u5b58\u50a8\u7684\u6570\u636e\u867d\u7136\u662f\u6839\u636e position \u6765\u7f13\u5b58\uff0c\u4f46\u662f\u91cc\u9762\u7684\u6570\u636e\u968f\u65f6\u53ef\u80fd\u4f1a\u88ab\u66ff\u6362\u7684\uff1b</p> <p>mRecyclerPool \u91cc\u6309 viewType \u53bb\u5b58\u50a8 ArrayList&lt; ViewHolder&gt;\uff0c\u6240\u4ee5 mRecyclerPool \u5e76\u4e0d\u80fd\u6309 position \u53bb\u5b58\u50a8 ViewHolder\uff0c\u800c\u4e14\u4ece mRecyclerPool \u53d6\u51fa\u7684 View \u6bcf\u6b21\u90fd\u8981\u53bb\u8d70 Adapter#onBindViewHolder \u53bb\u91cd\u65b0\u7ed1\u5b9a\u6570\u636e\u3002</p> <p>\u5047\u5982\u6211\u73b0\u5728\u9700\u8981\u5728\u4e00\u4e2a\u7279\u5b9a\u7684\u4f4d\u7f6e(\u6bd4\u5982 position=0 \u4f4d\u7f6e)\u4e00\u76f4\u5c55\u793a\u67d0\u4e2a View\uff0c\u4e14\u91cc\u9762\u7684\u5185\u5bb9\u662f\u4e0d\u53d8\u7684\uff0c\u90a3\u4e48\u6700\u597d\u7684\u60c5\u51b5\u5c31\u662f\u5728\u7279\u5b9a\u4f4d\u7f6e\u65f6\uff0c\u65e2\u4e0d\u9700\u8981\u6bcf\u6b21\u91cd\u65b0\u521b\u5efa View\uff0c\u4e5f\u4e0d\u9700\u8981\u6bcf\u6b21\u90fd\u53bb\u91cd\u65b0\u7ed1\u5b9a\u6570\u636e\uff0c\u4e0a\u9762\u7684\u51e0\u79cd\u7f13\u5b58\u663e\u7136\u90fd\u662f\u4e0d\u9002\u7528\u7684\uff0c\u8fd9\u79cd\u60c5\u51b5\u8be5\u600e\u4e48\u529e\u5462\uff1f\u53ef\u4ee5\u901a\u8fc7\u81ea\u5b9a\u4e49\u7f13\u5b58 ViewCacheExtension \u5b9e\u73b0\u4e0a\u8ff0\u9700\u6c42\u3002 </p>"},{"location":"030Android/020SystemSourceCode/#android-recyclerviewviewviewgrouptextview","title":"Android RecyclerView\u5982\u4f55\u5237\u65b0\u67d0\u4e00\u4e2a\u5355\u72ec\u7684View\uff0c\u6bd4\u5982\u4e00\u4e2aViewGroup\u91cc\u9762\u7684textView\uff1f","text":"\u7b54\u6848 <p>\u662f\u7684\uff0c<code>RecyclerView</code> \u7684 Payload \u673a\u5236 \u662f\u4e00\u79cd\u9ad8\u6548\u7684\u5c40\u90e8\u5237\u65b0\u65b9\u5f0f\u3002\u5b83\u5141\u8bb8\u4f60\u5728\u8c03\u7528 <code>notifyItemChanged(int position, Object payload)</code> \u65f6\u4f20\u9012\u4e00\u4e2a\u81ea\u5b9a\u4e49\u7684 <code>payload</code> \u5bf9\u8c61\uff0c\u7136\u540e\u5728 <code>onBindViewHolder</code> \u4e2d\u6839\u636e <code>payload</code> \u6765\u66f4\u65b0\u7279\u5b9a\u7684\u89c6\u56fe\uff0c\u800c\u4e0d\u9700\u8981\u91cd\u65b0\u7ed1\u5b9a\u6574\u4e2a <code>Item</code>\u3002</p> <p>\u8fd9\u79cd\u65b9\u5f0f\u975e\u5e38\u9002\u5408\u5c40\u90e8\u5237\u65b0\uff0c\u6bd4\u5982\u53ea\u66f4\u65b0 <code>TextView</code> \u7684\u6587\u672c\u6216 <code>ImageView</code> \u7684\u56fe\u7247\uff0c\u800c\u4e0d\u5f71\u54cd\u5176\u4ed6\u89c6\u56fe\u3002</p>"},{"location":"030Android/020SystemSourceCode/#_6","title":"\u5b9e\u73b0\u6b65\u9aa4","text":"<ol> <li> <p>\u8c03\u7528 <code>notifyItemChanged</code> \u5e76\u4f20\u9012 Payload\uff1a \u5728\u9700\u8981\u5237\u65b0\u67d0\u4e2a <code>Item</code> \u65f6\uff0c\u8c03\u7528 <code>notifyItemChanged(int position, Object payload)</code>\uff0c\u5e76\u4f20\u9012\u4e00\u4e2a\u81ea\u5b9a\u4e49\u7684 <code>payload</code> \u5bf9\u8c61\uff08\u53ef\u4ee5\u662f <code>String</code>\u3001<code>Bundle</code> \u6216\u81ea\u5b9a\u4e49\u5bf9\u8c61\uff09\u3002</p> </li> <li> <p>\u5728 <code>onBindViewHolder</code> \u4e2d\u5904\u7406 Payload\uff1a \u91cd\u5199 <code>onBindViewHolder</code> \u65b9\u6cd5\uff0c\u68c0\u67e5 <code>payload</code> \u53c2\u6570\uff0c\u6839\u636e <code>payload</code> \u7684\u5185\u5bb9\u66f4\u65b0\u7279\u5b9a\u7684\u89c6\u56fe\u3002</p> </li> </ol>"},{"location":"030Android/020SystemSourceCode/#_7","title":"\u793a\u4f8b\u4ee3\u7801","text":"<p>\u4ee5\u4e0b\u662f\u4e00\u4e2a\u5b8c\u6574\u7684\u793a\u4f8b\uff0c\u5c55\u793a\u5982\u4f55\u4f7f\u7528 Payload \u673a\u5236\u5b9e\u73b0\u5c40\u90e8\u5237\u65b0\u3002</p>"},{"location":"030Android/020SystemSourceCode/#1-adapter","title":"1. Adapter \u5b9e\u73b0","text":"<pre><code>public class MyAdapter extends RecyclerView.Adapter&lt;MyAdapter.MyViewHolder&gt; {\n    private List&lt;String&gt; mData;\n\n    // \u5b9a\u4e49 Payload \u5e38\u91cf\n    public static final String PAYLOAD_UPDATE_TEXT = \"update_text\";\n\n    public static class MyViewHolder extends RecyclerView.ViewHolder {\n        public TextView mTextView;\n        public ImageView mImageView;\n\n        public MyViewHolder(View itemView) {\n            super(itemView);\n            mTextView = itemView.findViewById(R.id.textView);\n            mImageView = itemView.findViewById(R.id.imageView);\n        }\n    }\n\n    public MyAdapter(List&lt;String&gt; data) {\n        this.mData = data;\n    }\n\n    @Override\n    public MyViewHolder onCreateViewHolder(ViewGroup parent, int viewType) {\n        View view = LayoutInflater.from(parent.getContext())\n                .inflate(R.layout.item_layout, parent, false);\n        return new MyViewHolder(view);\n    }\n\n    @Override\n    public void onBindViewHolder(MyViewHolder holder, int position) {\n        // \u7ed1\u5b9a\u6570\u636e\n        holder.mTextView.setText(mData.get(position));\n    }\n\n    // \u91cd\u5199 onBindViewHolder \u4ee5\u652f\u6301 Payload\n    @Override\n    public void onBindViewHolder(MyViewHolder holder, int position, List&lt;Object&gt; payloads) {\n        if (payloads.isEmpty()) {\n            // \u5982\u679c\u6ca1\u6709 Payload\uff0c\u8c03\u7528\u9ed8\u8ba4\u7684 onBindViewHolder\n            super.onBindViewHolder(holder, position, payloads);\n        } else {\n            // \u5904\u7406 Payload\n            for (Object payload : payloads) {\n                if (payload.equals(PAYLOAD_UPDATE_TEXT)) {\n                    // \u66f4\u65b0 TextView\n                    holder.mTextView.setText(mData.get(position));\n                }\n            }\n        }\n    }\n\n    @Override\n    public int getItemCount() {\n        return mData.size();\n    }\n\n    // \u66f4\u65b0\u7279\u5b9a\u4f4d\u7f6e\u7684 TextView\n    public void updateTextView(int position, String newText) {\n        mData.set(position, newText);\n        // \u4f7f\u7528 Payload \u901a\u77e5 Adapter\n        notifyItemChanged(position, PAYLOAD_UPDATE_TEXT);\n    }\n}\n</code></pre>"},{"location":"030Android/020SystemSourceCode/#2_3","title":"2. \u4f7f\u7528\u793a\u4f8b","text":"<p>\u5728 <code>Activity</code> \u6216 <code>Fragment</code> \u4e2d\uff0c\u4f60\u53ef\u4ee5\u8fd9\u6837\u66f4\u65b0\u67d0\u4e2a\u4f4d\u7f6e\u7684 <code>TextView</code>\uff1a</p> <pre><code>MyAdapter adapter = new MyAdapter(data);\nrecyclerView.setAdapter(adapter);\n\n// \u66f4\u65b0\u7b2c 2 \u4e2a\u4f4d\u7f6e\u7684 TextView\nadapter.updateTextView(2, \"New Text\");\n</code></pre>"},{"location":"030Android/020SystemSourceCode/#_8","title":"\u5173\u952e\u70b9\u89e3\u6790","text":"<ol> <li>Payload \u7684\u4f5c\u7528\uff1a</li> <li><code>Payload</code> \u662f\u4e00\u4e2a\u81ea\u5b9a\u4e49\u5bf9\u8c61\uff0c\u7528\u4e8e\u4f20\u9012\u9700\u8981\u66f4\u65b0\u7684\u4fe1\u606f\u3002</li> <li> <p>\u5728 <code>onBindViewHolder</code> \u4e2d\uff0c\u901a\u8fc7\u68c0\u67e5 <code>payloads</code> \u53c2\u6570\uff0c\u53ef\u4ee5\u51b3\u5b9a\u5982\u4f55\u66f4\u65b0\u89c6\u56fe\u3002</p> </li> <li> <p><code>onBindViewHolder</code> \u7684\u91cd\u8f7d\uff1a</p> </li> <li><code>onBindViewHolder(MyViewHolder holder, int position, List&lt;Object&gt; payloads)</code> \u662f\u652f\u6301 Payload \u7684\u5173\u952e\u65b9\u6cd5\u3002</li> <li>\u5982\u679c <code>payloads</code> \u4e3a\u7a7a\uff0c\u8c03\u7528\u9ed8\u8ba4\u7684 <code>onBindViewHolder</code>\u3002</li> <li> <p>\u5982\u679c <code>payloads</code> \u4e0d\u4e3a\u7a7a\uff0c\u6839\u636e <code>payload</code> \u7684\u5185\u5bb9\u66f4\u65b0\u7279\u5b9a\u7684\u89c6\u56fe\u3002</p> </li> <li> <p>\u5c40\u90e8\u5237\u65b0\u7684\u4f18\u52bf\uff1a</p> </li> <li>\u53ea\u66f4\u65b0\u9700\u8981\u53d8\u5316\u7684\u89c6\u56fe\uff0c\u4e0d\u4f1a\u89e6\u53d1\u6574\u4e2a <code>Item</code> \u7684\u91cd\u65b0\u7ed1\u5b9a\u3002</li> <li>\u6027\u80fd\u66f4\u9ad8\uff0c\u5c24\u5176\u662f\u5728\u590d\u6742\u7684 <code>Item</code> \u5e03\u5c40\u4e2d\u3002</li> </ol>"},{"location":"030Android/020SystemSourceCode/#payload","title":"\u6269\u5c55\uff1a\u652f\u6301\u591a\u4e2a Payload","text":"<p>\u5982\u679c\u4f60\u9700\u8981\u652f\u6301\u591a\u79cd\u5c40\u90e8\u5237\u65b0\uff08\u6bd4\u5982\u66f4\u65b0 <code>TextView</code> \u548c <code>ImageView</code>\uff09\uff0c\u53ef\u4ee5\u5b9a\u4e49\u591a\u4e2a <code>Payload</code> \u5e38\u91cf\uff0c\u5e76\u5728 <code>onBindViewHolder</code> \u4e2d\u5206\u522b\u5904\u7406\u3002</p> <pre><code>public static final String PAYLOAD_UPDATE_TEXT = \"update_text\";\npublic static final String PAYLOAD_UPDATE_IMAGE = \"update_image\";\n\n@Override\npublic void onBindViewHolder(MyViewHolder holder, int position, List&lt;Object&gt; payloads) {\n    if (payloads.isEmpty()) {\n        super.onBindViewHolder(holder, position, payloads);\n    } else {\n        for (Object payload : payloads) {\n            if (payload.equals(PAYLOAD_UPDATE_TEXT)) {\n                holder.mTextView.setText(mData.get(position));\n            } else if (payload.equals(PAYLOAD_UPDATE_IMAGE)) {\n                holder.mImageView.setImageResource(R.drawable.new_image);\n            }\n        }\n    }\n}\n</code></pre>"},{"location":"030Android/020SystemSourceCode/#_9","title":"\u603b\u7ed3","text":"<p>\u901a\u8fc7 <code>RecyclerView</code> \u7684 Payload \u673a\u5236\uff0c\u4f60\u53ef\u4ee5\u5b9e\u73b0\u9ad8\u6548\u7684\u5c40\u90e8\u5237\u65b0\uff0c\u907f\u514d\u4e0d\u5fc5\u8981\u7684\u89c6\u56fe\u66f4\u65b0\u3002\u8fd9\u79cd\u65b9\u5f0f\u975e\u5e38\u9002\u5408\u9700\u8981\u9891\u7e41\u66f4\u65b0\u90e8\u5206\u89c6\u56fe\u7684\u573a\u666f\uff0c\u6bd4\u5982\u804a\u5929\u5e94\u7528\u4e2d\u7684\u6d88\u606f\u72b6\u6001\u66f4\u65b0\u3001\u5217\u8868\u4e2d\u7684\u70b9\u8d5e\u6570\u66f4\u65b0\u7b49\u3002</p> <p>https://juejin.cn/post/7024414595678912520</p>"},{"location":"030Android/020SystemSourceCode/#diffutilsdiffutilsdiffutilspayload","title":"\u8bf7\u95eeDiffUtils\u80fd\u8d77\u5230\u4ec0\u4e48\u4f5c\u7528\uff1f\u4e3a\u4ec0\u4e48\u8981\u4f7f\u7528DiffUtils\uff1f\u4ee5\u53caDiffUtils\u80fd\u5426\u548cPayload\u673a\u5236\u914d\u5408\uff1f","text":"\u7b54\u6848 <p><code>DiffUtil</code> \u662f Android \u63d0\u4f9b\u7684\u4e00\u4e2a\u7528\u4e8e\u8ba1\u7b97\u4e24\u4e2a\u6570\u636e\u96c6\u5dee\u5f02\u7684\u5de5\u5177\u7c7b\uff0c\u4e13\u95e8\u4e3a <code>RecyclerView</code> \u8bbe\u8ba1\u3002\u5b83\u7684\u4e3b\u8981\u4f5c\u7528\u662f\u9ad8\u6548\u5730\u8ba1\u7b97\u65b0\u65e7\u6570\u636e\u96c6\u7684\u5dee\u5f02\uff0c\u5e76\u751f\u6210\u66f4\u65b0\u64cd\u4f5c\uff08\u5982\u6dfb\u52a0\u3001\u5220\u9664\u3001\u79fb\u52a8\u3001\u66f4\u65b0\uff09\uff0c\u4ece\u800c\u4f18\u5316 <code>RecyclerView</code> \u7684\u5237\u65b0\u6027\u80fd\u3002</p>"},{"location":"030Android/020SystemSourceCode/#diffutil","title":"DiffUtil \u7684\u4f5c\u7528","text":"<ol> <li>\u8ba1\u7b97\u6570\u636e\u96c6\u5dee\u5f02\uff1a</li> <li><code>DiffUtil</code> \u53ef\u4ee5\u6bd4\u8f83\u4e24\u4e2a\u6570\u636e\u96c6\uff08\u901a\u5e38\u662f <code>List</code>\uff09\uff0c\u5e76\u8ba1\u7b97\u51fa\u5b83\u4eec\u4e4b\u95f4\u7684\u5dee\u5f02\u3002</li> <li> <p>\u5b83\u4f1a\u8fd4\u56de\u4e00\u4e2a <code>DiffUtil.DiffResult</code> \u5bf9\u8c61\uff0c\u5305\u542b\u6dfb\u52a0\u3001\u5220\u9664\u3001\u79fb\u52a8\u548c\u66f4\u65b0\u7684\u64cd\u4f5c\u3002</p> </li> <li> <p>\u4f18\u5316 RecyclerView \u5237\u65b0\uff1a</p> </li> <li>\u901a\u8fc7 <code>DiffUtil</code>\uff0c<code>RecyclerView</code> \u53ef\u4ee5\u53ea\u66f4\u65b0\u53d1\u751f\u53d8\u5316\u7684\u90e8\u5206\uff0c\u800c\u4e0d\u662f\u5237\u65b0\u6574\u4e2a\u5217\u8868\u3002</li> <li> <p>\u8fd9\u51cf\u5c11\u4e86\u4e0d\u5fc5\u8981\u7684 <code>onBindViewHolder</code> \u8c03\u7528\uff0c\u63d0\u5347\u4e86\u6027\u80fd\u3002</p> </li> <li> <p>\u652f\u6301\u52a8\u753b\uff1a</p> </li> <li><code>DiffUtil</code> \u53ef\u4ee5\u751f\u6210\u79fb\u52a8\u3001\u6dfb\u52a0\u548c\u5220\u9664\u7684\u64cd\u4f5c\uff0c\u8fd9\u4e9b\u64cd\u4f5c\u53ef\u4ee5\u89e6\u53d1 <code>RecyclerView</code> \u7684\u9ed8\u8ba4\u52a8\u753b\u6548\u679c\u3002</li> </ol>"},{"location":"030Android/020SystemSourceCode/#diffutil_1","title":"\u4e3a\u4ec0\u4e48\u8981\u4f7f\u7528 DiffUtil\uff1f","text":"<ol> <li>\u6027\u80fd\u4f18\u52bf\uff1a</li> <li>\u5982\u679c\u76f4\u63a5\u8c03\u7528 <code>notifyDataSetChanged()</code>\uff0c<code>RecyclerView</code> \u4f1a\u91cd\u65b0\u7ed1\u5b9a\u6240\u6709\u53ef\u89c1\u7684 <code>ViewHolder</code>\uff0c\u5373\u4f7f\u6570\u636e\u6ca1\u6709\u53d8\u5316\u3002</li> <li> <p>\u4f7f\u7528 <code>DiffUtil</code> \u53ef\u4ee5\u907f\u514d\u4e0d\u5fc5\u8981\u7684\u5237\u65b0\uff0c\u53ea\u66f4\u65b0\u5b9e\u9645\u53d1\u751f\u53d8\u5316\u7684\u90e8\u5206\u3002</p> </li> <li> <p>\u66f4\u597d\u7684\u7528\u6237\u4f53\u9a8c\uff1a</p> </li> <li> <p><code>DiffUtil</code> \u652f\u6301\u52a8\u753b\u6548\u679c\uff08\u5982\u6dfb\u52a0\u3001\u5220\u9664\u3001\u79fb\u52a8\uff09\uff0c\u4f7f\u5217\u8868\u66f4\u65b0\u66f4\u52a0\u5e73\u6ed1\u548c\u81ea\u7136\u3002</p> </li> <li> <p>\u7b80\u5316\u6570\u636e\u66f4\u65b0\u903b\u8f91\uff1a</p> </li> <li>\u624b\u52a8\u7ba1\u7406\u6570\u636e\u96c6\u7684\u6dfb\u52a0\u3001\u5220\u9664\u548c\u79fb\u52a8\u64cd\u4f5c\u53ef\u80fd\u975e\u5e38\u590d\u6742\uff0c\u800c <code>DiffUtil</code> \u53ef\u4ee5\u81ea\u52a8\u5b8c\u6210\u8fd9\u4e9b\u64cd\u4f5c\u3002</li> </ol>"},{"location":"030Android/020SystemSourceCode/#diffutil_2","title":"DiffUtil \u7684\u57fa\u672c\u7528\u6cd5","text":""},{"location":"030Android/020SystemSourceCode/#1-diffutilcallback","title":"1. \u5b9e\u73b0 <code>DiffUtil.Callback</code>","text":"<p><code>DiffUtil.Callback</code> \u662f\u4e00\u4e2a\u62bd\u8c61\u7c7b\uff0c\u9700\u8981\u5b9e\u73b0\u4ee5\u4e0b\u65b9\u6cd5\uff1a</p> <ul> <li><code>getOldListSize()</code>\uff1a\u8fd4\u56de\u65e7\u6570\u636e\u96c6\u7684\u957f\u5ea6\u3002</li> <li><code>getNewListSize()</code>\uff1a\u8fd4\u56de\u65b0\u6570\u636e\u96c6\u7684\u957f\u5ea6\u3002</li> <li><code>areItemsTheSame(int oldItemPosition, int newItemPosition)</code>\uff1a\u5224\u65ad\u4e24\u4e2a\u4f4d\u7f6e\u7684\u9879\u662f\u5426\u662f\u540c\u4e00\u4e2a\u5bf9\u8c61\uff08\u901a\u5e38\u901a\u8fc7\u552f\u4e00\u6807\u8bc6\u7b26\u6bd4\u8f83\uff09\u3002</li> <li><code>areContentsTheSame(int oldItemPosition, int newItemPosition)</code>\uff1a\u5224\u65ad\u4e24\u4e2a\u4f4d\u7f6e\u7684\u9879\u5185\u5bb9\u662f\u5426\u76f8\u540c\u3002</li> <li><code>getChangePayload(int oldItemPosition, int newItemPosition)</code>\uff08\u53ef\u9009\uff09\uff1a\u8fd4\u56de\u4e00\u4e2a <code>Object</code>\uff0c\u7528\u4e8e\u5c40\u90e8\u5237\u65b0\uff08\u4e0e Payload \u673a\u5236\u914d\u5408\uff09\u3002</li> </ul>"},{"location":"030Android/020SystemSourceCode/#2-diffutil","title":"2. \u4f7f\u7528 <code>DiffUtil</code> \u8ba1\u7b97\u5dee\u5f02","text":"<p>\u8c03\u7528 <code>DiffUtil.calculateDiff()</code> \u65b9\u6cd5\u8ba1\u7b97\u5dee\u5f02\uff0c\u5e76\u901a\u8fc7 <code>DiffUtil.DiffResult</code> \u66f4\u65b0 <code>RecyclerView</code>\u3002</p>"},{"location":"030Android/020SystemSourceCode/#_10","title":"\u793a\u4f8b\u4ee3\u7801","text":"<p>\u4ee5\u4e0b\u662f\u4e00\u4e2a\u5b8c\u6574\u7684\u793a\u4f8b\uff0c\u5c55\u793a\u5982\u4f55\u4f7f\u7528 <code>DiffUtil</code> \u548c Payload \u673a\u5236\u3002</p>"},{"location":"030Android/020SystemSourceCode/#1_2","title":"1. \u6570\u636e\u6a21\u578b","text":"<pre><code>public class Item {\n    private int id;\n    private String text;\n\n    public Item(int id, String text) {\n        this.id = id;\n        this.text = text;\n    }\n\n    public int getId() {\n        return id;\n    }\n\n    public String getText() {\n        return text;\n    }\n\n    public void setText(String text) {\n        this.text = text;\n    }\n}\n</code></pre>"},{"location":"030Android/020SystemSourceCode/#2-diffutilcallback","title":"2. \u5b9e\u73b0 <code>DiffUtil.Callback</code>","text":"<pre><code>public class ItemDiffCallback extends DiffUtil.Callback {\n    private List&lt;Item&gt; oldList;\n    private List&lt;Item&gt; newList;\n\n    public ItemDiffCallback(List&lt;Item&gt; oldList, List&lt;Item&gt; newList) {\n        this.oldList = oldList;\n        this.newList = newList;\n    }\n\n    @Override\n    public int getOldListSize() {\n        return oldList.size();\n    }\n\n    @Override\n    public int getNewListSize() {\n        return newList.size();\n    }\n\n    @Override\n    public boolean areItemsTheSame(int oldItemPosition, int newItemPosition) {\n        // \u901a\u8fc7\u552f\u4e00\u6807\u8bc6\u7b26\uff08id\uff09\u5224\u65ad\u662f\u5426\u662f\u540c\u4e00\u4e2a\u9879\n        return oldList.get(oldItemPosition).getId() == newList.get(newItemPosition).getId();\n    }\n\n    @Override\n    public boolean areContentsTheSame(int oldItemPosition, int newItemPosition) {\n        // \u5224\u65ad\u5185\u5bb9\u662f\u5426\u76f8\u540c\n        return oldList.get(oldItemPosition).getText().equals(newList.get(newItemPosition).getText());\n    }\n\n    @Override\n    public Object getChangePayload(int oldItemPosition, int newItemPosition) {\n        // \u8fd4\u56de\u4e00\u4e2a Payload \u5bf9\u8c61\uff0c\u7528\u4e8e\u5c40\u90e8\u5237\u65b0\n        return \"update_text\";\n    }\n}\n</code></pre>"},{"location":"030Android/020SystemSourceCode/#3-adapter","title":"3. Adapter \u5b9e\u73b0","text":"<pre><code>public class MyAdapter extends RecyclerView.Adapter&lt;MyAdapter.MyViewHolder&gt; {\n    private List&lt;Item&gt; mData;\n\n    public static class MyViewHolder extends RecyclerView.ViewHolder {\n        public TextView mTextView;\n\n        public MyViewHolder(View itemView) {\n            super(itemView);\n            mTextView = itemView.findViewById(R.id.textView);\n        }\n    }\n\n    public MyAdapter(List&lt;Item&gt; data) {\n        this.mData = data;\n    }\n\n    @Override\n    public MyViewHolder onCreateViewHolder(ViewGroup parent, int viewType) {\n        View view = LayoutInflater.from(parent.getContext())\n                .inflate(R.layout.item_layout, parent, false);\n        return new MyViewHolder(view);\n    }\n\n    @Override\n    public void onBindViewHolder(MyViewHolder holder, int position) {\n        holder.mTextView.setText(mData.get(position).getText());\n    }\n\n    @Override\n    public void onBindViewHolder(MyViewHolder holder, int position, List&lt;Object&gt; payloads) {\n        if (payloads.isEmpty()) {\n            super.onBindViewHolder(holder, position, payloads);\n        } else {\n            // \u5904\u7406 Payload\n            for (Object payload : payloads) {\n                if (payload.equals(\"update_text\")) {\n                    holder.mTextView.setText(mData.get(position).getText());\n                }\n            }\n        }\n    }\n\n    @Override\n    public int getItemCount() {\n        return mData.size();\n    }\n\n    // \u66f4\u65b0\u6570\u636e\n    public void updateData(List&lt;Item&gt; newData) {\n        ItemDiffCallback callback = new ItemDiffCallback(mData, newData);\n        DiffUtil.DiffResult result = DiffUtil.calculateDiff(callback);\n        mData.clear();\n        mData.addAll(newData);\n        result.dispatchUpdatesTo(this);\n    }\n}\n</code></pre>"},{"location":"030Android/020SystemSourceCode/#4_3","title":"4. \u4f7f\u7528\u793a\u4f8b","text":"<pre><code>List&lt;Item&gt; oldData = ...; // \u65e7\u6570\u636e\nList&lt;Item&gt; newData = ...; // \u65b0\u6570\u636e\n\nMyAdapter adapter = new MyAdapter(oldData);\nrecyclerView.setAdapter(adapter);\n\n// \u66f4\u65b0\u6570\u636e\nadapter.updateData(newData);\n</code></pre>"},{"location":"030Android/020SystemSourceCode/#diffutil-payload","title":"DiffUtil \u548c Payload \u673a\u5236\u7684\u914d\u5408","text":"<ol> <li><code>getChangePayload</code> \u65b9\u6cd5\uff1a</li> <li>\u5728 <code>DiffUtil.Callback</code> \u4e2d\u5b9e\u73b0 <code>getChangePayload</code> \u65b9\u6cd5\uff0c\u8fd4\u56de\u4e00\u4e2a <code>Object</code>\uff08\u5982 <code>String</code> \u6216\u81ea\u5b9a\u4e49\u5bf9\u8c61\uff09\u3002</li> <li> <p>\u8fd9\u4e2a <code>Object</code> \u4f1a\u4f5c\u4e3a <code>payload</code> \u4f20\u9012\u7ed9 <code>onBindViewHolder</code> \u65b9\u6cd5\u3002</p> </li> <li> <p>\u5c40\u90e8\u5237\u65b0\uff1a</p> </li> <li> <p>\u5728 <code>onBindViewHolder</code> \u4e2d\uff0c\u6839\u636e <code>payload</code> \u7684\u5185\u5bb9\uff0c\u53ea\u66f4\u65b0\u7279\u5b9a\u7684\u89c6\u56fe\uff0c\u800c\u4e0d\u91cd\u65b0\u7ed1\u5b9a\u6574\u4e2a <code>Item</code>\u3002</p> </li> <li> <p>\u6027\u80fd\u4f18\u5316\uff1a</p> </li> <li>\u901a\u8fc7 Payload \u673a\u5236\uff0c<code>RecyclerView</code> \u53ef\u4ee5\u53ea\u66f4\u65b0\u53d1\u751f\u53d8\u5316\u7684\u90e8\u5206\uff0c\u8fdb\u4e00\u6b65\u63d0\u5347\u6027\u80fd\u3002</li> </ol>"},{"location":"030Android/020SystemSourceCode/#_11","title":"\u603b\u7ed3","text":"<ul> <li>DiffUtil \u7528\u4e8e\u9ad8\u6548\u8ba1\u7b97\u6570\u636e\u96c6\u7684\u5dee\u5f02\uff0c\u5e76\u751f\u6210\u66f4\u65b0\u64cd\u4f5c\uff0c\u907f\u514d\u4e0d\u5fc5\u8981\u7684\u5237\u65b0\u3002</li> <li>Payload \u673a\u5236 \u7528\u4e8e\u5c40\u90e8\u5237\u65b0\uff0c\u53ea\u66f4\u65b0\u7279\u5b9a\u7684\u89c6\u56fe\u3002</li> <li>DiffUtil \u548c Payload \u673a\u5236\u53ef\u4ee5\u5b8c\u7f8e\u914d\u5408\uff0c\u5728\u8ba1\u7b97\u5dee\u5f02\u7684\u540c\u65f6\uff0c\u652f\u6301\u5c40\u90e8\u5237\u65b0\uff0c\u8fdb\u4e00\u6b65\u63d0\u5347\u6027\u80fd\u3002</li> </ul> <p>\u5982\u679c\u4f60\u7684\u5217\u8868\u6570\u636e\u9891\u7e41\u53d8\u5316\uff0c\u4e14\u9700\u8981\u9ad8\u6027\u80fd\u7684\u5237\u65b0\u673a\u5236\uff0c\u5f3a\u70c8\u63a8\u8350\u4f7f\u7528 <code>DiffUtil</code> \u548c Payload \u673a\u5236\uff01</p>"},{"location":"030Android/020SystemSourceCode/#android-surfaceview","title":"Android SurfaceView\u539f\u7406\u89e3\u6790","text":"\u7b54\u6848 <p><code>SurfaceView</code> \u662f Android \u4e2d\u7528\u4e8e\u5904\u7406\u590d\u6742\u56fe\u5f62\u7ed8\u5236\u548c\u9ad8\u6548\u6e32\u67d3\u7684\u91cd\u8981\u7ec4\u4ef6\uff0c\u5c24\u5176\u9002\u7528\u4e8e\u9700\u8981\u9891\u7e41\u66f4\u65b0 UI \u6216\u9ad8\u6027\u80fd\u56fe\u5f62\u5904\u7406\u7684\u573a\u666f\uff08\u5982\u6e38\u620f\u3001\u89c6\u9891\u64ad\u653e\u3001\u76f8\u673a\u9884\u89c8\u7b49\uff09\u3002\u4e0e\u666e\u901a\u7684 <code>View</code> \u4e0d\u540c\uff0c<code>SurfaceView</code> \u5728\u72ec\u7acb\u7684\u7ebf\u7a0b\u4e2d\u7ed8\u5236\u5185\u5bb9\uff0c\u5e76\u4e14\u53ef\u4ee5\u76f4\u63a5\u64cd\u4f5c\u786c\u4ef6\u52a0\u901f\u7684 Surface\uff0c\u4ece\u800c\u907f\u514d\u963b\u585e\u4e3b\u7ebf\u7a0b\u3002</p> <p>\u4ee5\u4e0b\u662f <code>SurfaceView</code> \u7684\u6838\u5fc3\u7279\u6027\u548c\u4f7f\u7528\u65b9\u6cd5\u89e3\u6790\uff1a</p>"},{"location":"030Android/020SystemSourceCode/#1-surfaceview","title":"1. SurfaceView \u7684\u7279\u70b9","text":"<ul> <li>\u72ec\u7acb\u7684\u7ed8\u5236\u7ebf\u7a0b\uff1a<code>SurfaceView</code> \u62e5\u6709\u4e00\u4e2a\u72ec\u7acb\u7684 Surface\uff0c\u53ef\u4ee5\u5728\u975e UI \u7ebf\u7a0b\u4e2d\u8fdb\u884c\u7ed8\u5236\uff0c\u907f\u514d\u963b\u585e\u4e3b\u7ebf\u7a0b\u3002</li> <li>\u53cc\u7f13\u51b2\u673a\u5236\uff1a<code>SurfaceView</code> \u4f7f\u7528\u53cc\u7f13\u51b2\u6280\u672f\uff0c\u7ed8\u5236\u6548\u7387\u66f4\u9ad8\uff0c\u51cf\u5c11\u753b\u9762\u95ea\u70c1\u3002</li> <li>\u76f4\u63a5\u64cd\u4f5c Surface\uff1a\u901a\u8fc7 <code>SurfaceHolder</code> \u53ef\u4ee5\u76f4\u63a5\u64cd\u4f5c\u5e95\u5c42\u7684 Surface\uff0c\u652f\u6301\u786c\u4ef6\u52a0\u901f\u3002</li> <li>\u9002\u5408\u9ad8\u9891\u66f4\u65b0\uff1a\u9002\u7528\u4e8e\u9700\u8981\u9891\u7e41\u66f4\u65b0 UI \u7684\u573a\u666f\uff08\u5982\u6e38\u620f\u3001\u89c6\u9891\u64ad\u653e\uff09\u3002</li> <li>\u900f\u660e\u533a\u57df\u652f\u6301\uff1a<code>SurfaceView</code> \u7684\u5185\u5bb9\u53ef\u4ee5\u8986\u76d6\u5728\u5176\u4ed6\u89c6\u56fe\u4e4b\u4e0a\uff0c\u652f\u6301\u900f\u660e\u533a\u57df\u3002</li> </ul>"},{"location":"030Android/020SystemSourceCode/#2-surfaceview","title":"2. SurfaceView \u7684\u57fa\u672c\u7ed3\u6784","text":"<p><code>SurfaceView</code> \u7684\u6838\u5fc3\u662f\u901a\u8fc7 <code>SurfaceHolder</code> \u6765\u7ba1\u7406 Surface \u7684\u751f\u547d\u5468\u671f\u548c\u7ed8\u5236\u64cd\u4f5c\u3002<code>SurfaceHolder</code> \u63d0\u4f9b\u4e86\u5bf9 Surface \u7684\u63a7\u5236\u63a5\u53e3\u3002</p>"},{"location":"030Android/020SystemSourceCode/#_12","title":"\u5173\u952e\u7c7b\u548c\u65b9\u6cd5\uff1a","text":"<ul> <li><code>SurfaceView</code>\uff1a\u7528\u4e8e\u663e\u793a\u5185\u5bb9\u7684\u89c6\u56fe\u3002</li> <li><code>SurfaceHolder</code>\uff1a\u7ba1\u7406 Surface \u7684\u751f\u547d\u5468\u671f\u548c\u7ed8\u5236\u64cd\u4f5c\u3002</li> <li><code>addCallback(SurfaceHolder.Callback)</code>\uff1a\u76d1\u542c Surface \u7684\u751f\u547d\u5468\u671f\u4e8b\u4ef6\u3002</li> <li><code>lockCanvas()</code>\uff1a\u83b7\u53d6\u4e00\u4e2a Canvas \u5bf9\u8c61\u7528\u4e8e\u7ed8\u5236\u3002</li> <li><code>unlockCanvasAndPost(Canvas)</code>\uff1a\u63d0\u4ea4\u7ed8\u5236\u5185\u5bb9\u5e76\u91ca\u653e Canvas\u3002</li> <li><code>SurfaceHolder.Callback</code>\uff1a\u76d1\u542c Surface \u7684\u521b\u5efa\u3001\u6539\u53d8\u548c\u9500\u6bc1\u4e8b\u4ef6\u3002</li> </ul>"},{"location":"030Android/020SystemSourceCode/#3-surfaceview","title":"3. SurfaceView \u7684\u4f7f\u7528\u6b65\u9aa4","text":""},{"location":"030Android/020SystemSourceCode/#1-surfaceview_1","title":"\uff081\uff09\u5728\u5e03\u5c40\u6587\u4ef6\u4e2d\u5b9a\u4e49 <code>SurfaceView</code>","text":"<pre><code>&lt;SurfaceView\n    android:id=\"@+id/surfaceView\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"match_parent\" /&gt;\n</code></pre>"},{"location":"030Android/020SystemSourceCode/#2-activity-fragment-surfaceview","title":"\uff082\uff09\u5728 Activity \u6216 Fragment \u4e2d\u521d\u59cb\u5316 <code>SurfaceView</code>","text":"<pre><code>SurfaceView surfaceView = findViewById(R.id.surfaceView);\nSurfaceHolder surfaceHolder = surfaceView.getHolder();\n</code></pre>"},{"location":"030Android/020SystemSourceCode/#3-surfaceholdercallback","title":"\uff083\uff09\u5b9e\u73b0 <code>SurfaceHolder.Callback</code> \u63a5\u53e3","text":"<pre><code>surfaceHolder.addCallback(new SurfaceHolder.Callback() {\n    @Override\n    public void surfaceCreated(SurfaceHolder holder) {\n        // Surface \u521b\u5efa\u65f6\u8c03\u7528\uff0c\u53ef\u4ee5\u5f00\u59cb\u7ed8\u5236\n        new Thread(new DrawingThread(holder)).start();\n    }\n\n    @Override\n    public void surfaceChanged(SurfaceHolder holder, int format, int width, int height) {\n        // Surface \u5c3a\u5bf8\u6216\u683c\u5f0f\u6539\u53d8\u65f6\u8c03\u7528\n    }\n\n    @Override\n    public void surfaceDestroyed(SurfaceHolder holder) {\n        // Surface \u9500\u6bc1\u65f6\u8c03\u7528\uff0c\u505c\u6b62\u7ed8\u5236\n    }\n});\n</code></pre>"},{"location":"030Android/020SystemSourceCode/#4_4","title":"\uff084\uff09\u5728\u72ec\u7acb\u7ebf\u7a0b\u4e2d\u7ed8\u5236\u5185\u5bb9","text":"<pre><code>class DrawingThread implements Runnable {\n    private SurfaceHolder surfaceHolder;\n\n    public DrawingThread(SurfaceHolder surfaceHolder) {\n        this.surfaceHolder = surfaceHolder;\n    }\n\n    @Override\n    public void run() {\n        Canvas canvas = null;\n        try {\n            canvas = surfaceHolder.lockCanvas(); // \u83b7\u53d6 Canvas\n            if (canvas != null) {\n                // \u5728 Canvas \u4e0a\u7ed8\u5236\u5185\u5bb9\n                canvas.drawColor(Color.WHITE);\n                Paint paint = new Paint();\n                paint.setColor(Color.RED);\n                canvas.drawCircle(100, 100, 50, paint);\n            }\n        } finally {\n            if (canvas != null) {\n                surfaceHolder.unlockCanvasAndPost(canvas); // \u63d0\u4ea4\u7ed8\u5236\u5185\u5bb9\n            }\n        }\n    }\n}\n</code></pre>"},{"location":"030Android/020SystemSourceCode/#4-surfaceview","title":"4. SurfaceView \u7684\u6ce8\u610f\u4e8b\u9879","text":"<ul> <li>\u7ebf\u7a0b\u5b89\u5168\uff1a<code>SurfaceView</code> \u7684\u7ed8\u5236\u64cd\u4f5c\u901a\u5e38\u9700\u8981\u5728\u72ec\u7acb\u7ebf\u7a0b\u4e2d\u8fdb\u884c\uff0c\u907f\u514d\u963b\u585e\u4e3b\u7ebf\u7a0b\u3002</li> <li>\u751f\u547d\u5468\u671f\u7ba1\u7406\uff1a\u9700\u8981\u6b63\u786e\u5904\u7406 Surface \u7684\u751f\u547d\u5468\u671f\uff08\u5982 <code>surfaceCreated</code> \u548c <code>surfaceDestroyed</code>\uff09\uff0c\u907f\u514d\u8d44\u6e90\u6cc4\u6f0f\u3002</li> <li>\u6027\u80fd\u4f18\u5316\uff1a\u5c3d\u91cf\u51cf\u5c11 <code>lockCanvas()</code> \u548c <code>unlockCanvasAndPost()</code> \u7684\u8c03\u7528\u9891\u7387\uff0c\u907f\u514d\u9891\u7e41\u9501\u5b9a\u548c\u89e3\u9501 Surface\u3002</li> <li>\u4e0e View \u7684\u533a\u522b\uff1a<code>SurfaceView</code> \u7684\u5185\u5bb9\u662f\u72ec\u7acb\u4e8e\u89c6\u56fe\u5c42\u7ea7\u7684\uff0c\u56e0\u6b64\u53ef\u4ee5\u8986\u76d6\u5728\u5176\u4ed6\u89c6\u56fe\u4e4b\u4e0a\uff0c\u4f46\u4e5f\u53ef\u80fd\u5bfc\u81f4\u5e03\u5c40\u95ee\u9898\u3002</li> </ul>"},{"location":"030Android/020SystemSourceCode/#5-surfaceview","title":"5. SurfaceView \u7684\u66ff\u4ee3\u65b9\u6848","text":"<ul> <li>TextureView\uff1a\u9002\u7528\u4e8e\u9700\u8981\u52a8\u6001\u66f4\u65b0\u5185\u5bb9\u7684\u573a\u666f\uff0c\u652f\u6301\u52a8\u753b\u548c\u53d8\u5f62\uff0c\u4f46\u6027\u80fd\u7565\u4f4e\u4e8e <code>SurfaceView</code>\u3002</li> <li>GLSurfaceView\uff1a\u57fa\u4e8e OpenGL ES \u7684 <code>SurfaceView</code>\uff0c\u9002\u7528\u4e8e 3D \u56fe\u5f62\u6e32\u67d3\u3002</li> </ul>"},{"location":"030Android/020SystemSourceCode/#6-surfaceview","title":"6. \u793a\u4f8b\uff1a\u4f7f\u7528 SurfaceView \u5b9e\u73b0\u7b80\u5355\u52a8\u753b","text":"<p>\u4ee5\u4e0b\u662f\u4e00\u4e2a\u7b80\u5355\u7684\u793a\u4f8b\uff0c\u5c55\u793a\u5982\u4f55\u5728 <code>SurfaceView</code> \u4e2d\u5b9e\u73b0\u4e00\u4e2a\u79fb\u52a8\u7684\u5706\u5f62\u52a8\u753b\u3002</p> <pre><code>class DrawingThread implements Runnable {\n    private SurfaceHolder surfaceHolder;\n    private boolean isRunning = true;\n    private int x = 0;\n\n    public DrawingThread(SurfaceHolder surfaceHolder) {\n        this.surfaceHolder = surfaceHolder;\n    }\n\n    @Override\n    public void run() {\n        while (isRunning) {\n            Canvas canvas = null;\n            try {\n                canvas = surfaceHolder.lockCanvas();\n                if (canvas != null) {\n                    // \u6e05\u7a7a\u753b\u5e03\n                    canvas.drawColor(Color.WHITE);\n                    // \u7ed8\u5236\u5706\u5f62\n                    Paint paint = new Paint();\n                    paint.setColor(Color.RED);\n                    canvas.drawCircle(x, 100, 50, paint);\n                    // \u66f4\u65b0\u5706\u5f62\u4f4d\u7f6e\n                    x += 5;\n                    if (x &gt; canvas.getWidth()) {\n                        x = 0;\n                    }\n                }\n            } finally {\n                if (canvas != null) {\n                    surfaceHolder.unlockCanvasAndPost(canvas);\n                }\n            }\n            // \u63a7\u5236\u5e27\u7387\n            try {\n                Thread.sleep(16); // \u7ea6 60 FPS\n            } catch (InterruptedException e) {\n                e.printStackTrace();\n            }\n        }\n    }\n\n    public void stop() {\n        isRunning = false;\n    }\n}\n</code></pre> <p>\u5728 <code>surfaceCreated</code> \u4e2d\u542f\u52a8\u7ebf\u7a0b\uff0c\u5728 <code>surfaceDestroyed</code> \u4e2d\u505c\u6b62\u7ebf\u7a0b\uff1a <pre><code>surfaceHolder.addCallback(new SurfaceHolder.Callback() {\n    private DrawingThread drawingThread;\n\n    @Override\n    public void surfaceCreated(SurfaceHolder holder) {\n        drawingThread = new DrawingThread(holder);\n        new Thread(drawingThread).start();\n    }\n\n    @Override\n    public void surfaceChanged(SurfaceHolder holder, int format, int width, int height) {}\n\n    @Override\n    public void surfaceDestroyed(SurfaceHolder holder) {\n        if (drawingThread != null) {\n            drawingThread.stop();\n        }\n    }\n});\n</code></pre></p> <p>\u901a\u8fc7\u4ee5\u4e0a\u5185\u5bb9\uff0c\u4f60\u53ef\u4ee5\u638c\u63e1 <code>SurfaceView</code> \u7684\u57fa\u672c\u4f7f\u7528\u65b9\u6cd5\u548c\u6838\u5fc3\u7279\u6027\u3002\u5982\u679c\u9700\u8981\u66f4\u590d\u6742\u7684\u56fe\u5f62\u5904\u7406\uff0c\u53ef\u4ee5\u7ed3\u5408 OpenGL ES \u6216\u81ea\u5b9a\u4e49\u7ed8\u5236\u903b\u8f91\u6765\u5b9e\u73b0\u3002</p>"},{"location":"030Android/020SystemSourceCode/#android-surfaceviewui","title":"\u4e3a\u4ec0\u4e48Android SurfaceView\u53ef\u4ee5\u5728\u5b50\u7ebf\u7a0b\u5237\u65b0UI\uff1f","text":"\u7b54\u6848 <p><code>SurfaceView</code> \u4e4b\u6240\u4ee5\u80fd\u591f\u5728\u5b50\u7ebf\u7a0b\u4e2d\u5237\u65b0 UI\uff0c\u662f\u56e0\u4e3a\u5b83\u7684\u8bbe\u8ba1\u673a\u5236\u4e0e\u666e\u901a\u7684 <code>View</code> \u4e0d\u540c\u3002\u666e\u901a <code>View</code> \u7684\u7ed8\u5236\u5fc5\u987b\u5728\u4e3b\u7ebf\u7a0b\uff08UI \u7ebf\u7a0b\uff09\u4e2d\u8fdb\u884c\uff0c\u800c <code>SurfaceView</code> \u901a\u8fc7\u72ec\u7acb\u7684 <code>Surface</code> \u548c\u53cc\u7f13\u51b2\u673a\u5236\uff0c\u5b9e\u73b0\u4e86\u5728\u5b50\u7ebf\u7a0b\u4e2d\u7ed8\u5236\u5185\u5bb9\u7684\u80fd\u529b\u3002\u4ee5\u4e0b\u662f\u5177\u4f53\u539f\u56e0\u548c\u673a\u5236\uff1a</p>"},{"location":"030Android/020SystemSourceCode/#1-surface","title":"1. \u72ec\u7acb\u7684 Surface","text":"<p><code>SurfaceView</code> \u62e5\u6709\u4e00\u4e2a\u72ec\u7acb\u7684 <code>Surface</code>\uff0c\u8fd9\u662f\u4e00\u4e2a\u7531\u7cfb\u7edf\u7ba1\u7406\u7684\u7ed8\u56fe\u8868\u9762\u3002\u4e0e\u666e\u901a <code>View</code> \u5171\u4eab\u7684 UI \u7ebf\u7a0b\u7ed8\u5236\u673a\u5236\u4e0d\u540c\uff0c<code>Surface</code> \u53ef\u4ee5\u5728\u72ec\u7acb\u7684\u7ebf\u7a0b\u4e2d\u8fdb\u884c\u7ed8\u5236\u64cd\u4f5c\u3002</p> <ul> <li>\u666e\u901a <code>View</code>\uff1a\u6240\u6709 <code>View</code> \u7684\u7ed8\u5236\u90fd\u901a\u8fc7 <code>ViewRootImpl</code> \u5728\u4e3b\u7ebf\u7a0b\u4e2d\u7edf\u4e00\u5904\u7406\uff0c\u8c03\u7528 <code>onDraw()</code> \u65b9\u6cd5\u3002</li> <li><code>SurfaceView</code>\uff1a<code>SurfaceView</code> \u7684\u7ed8\u5236\u4e0d\u4f9d\u8d56\u4e8e <code>ViewRootImpl</code>\uff0c\u800c\u662f\u76f4\u63a5\u64cd\u4f5c\u5e95\u5c42\u7684 <code>Surface</code>\uff0c\u56e0\u6b64\u53ef\u4ee5\u5728\u5b50\u7ebf\u7a0b\u4e2d\u8fdb\u884c\u3002</li> </ul>"},{"location":"030Android/020SystemSourceCode/#2_4","title":"2. \u53cc\u7f13\u51b2\u673a\u5236","text":"<p><code>SurfaceView</code> \u4f7f\u7528\u53cc\u7f13\u51b2\u6280\u672f\uff0c\u8fd9\u610f\u5473\u7740\u5b83\u6709\u4e24\u4e2a\u7f13\u51b2\u533a\uff1a - \u524d\u7aef\u7f13\u51b2\u533a\uff1a\u7528\u4e8e\u663e\u793a\u5f53\u524d\u5185\u5bb9\u3002 - \u540e\u7aef\u7f13\u51b2\u533a\uff1a\u7528\u4e8e\u7ed8\u5236\u4e0b\u4e00\u5e27\u5185\u5bb9\u3002</p> <p>\u7ed8\u5236\u64cd\u4f5c\u5728\u540e\u7aef\u7f13\u51b2\u533a\u4e2d\u8fdb\u884c\uff0c\u5b8c\u6210\u540e\u901a\u8fc7 <code>unlockCanvasAndPost()</code> \u5c06\u540e\u7aef\u7f13\u51b2\u533a\u7684\u5185\u5bb9\u4ea4\u6362\u5230\u524d\u7aef\u7f13\u51b2\u533a\u663e\u793a\u3002\u8fd9\u79cd\u673a\u5236\u907f\u514d\u4e86\u76f4\u63a5\u64cd\u4f5c\u663e\u793a\u7f13\u51b2\u533a\u5bfc\u81f4\u7684\u753b\u9762\u95ea\u70c1\u95ee\u9898\uff0c\u540c\u65f6\u4e5f\u63d0\u9ad8\u4e86\u7ed8\u5236\u6548\u7387\u3002</p>"},{"location":"030Android/020SystemSourceCode/#3-surfaceholder-canvas","title":"3. SurfaceHolder \u548c Canvas \u7684\u63a7\u5236","text":"<p><code>SurfaceView</code> \u901a\u8fc7 <code>SurfaceHolder</code> \u7ba1\u7406 <code>Surface</code> \u7684\u751f\u547d\u5468\u671f\u548c\u7ed8\u5236\u64cd\u4f5c\u3002<code>SurfaceHolder</code> \u63d0\u4f9b\u4e86\u4ee5\u4e0b\u5173\u952e\u65b9\u6cd5\uff1a - <code>lockCanvas()</code>\uff1a\u83b7\u53d6\u4e00\u4e2a <code>Canvas</code> \u5bf9\u8c61\uff0c\u7528\u4e8e\u5728\u540e\u7aef\u7f13\u51b2\u533a\u4e2d\u7ed8\u5236\u5185\u5bb9\u3002 - <code>unlockCanvasAndPost()</code>\uff1a\u5c06\u7ed8\u5236\u5b8c\u6210\u7684\u5185\u5bb9\u63d0\u4ea4\u5230\u524d\u7aef\u7f13\u51b2\u533a\u663e\u793a\u3002</p> <p>\u8fd9\u4e9b\u65b9\u6cd5\u53ef\u4ee5\u5728\u5b50\u7ebf\u7a0b\u4e2d\u8c03\u7528\uff0c\u56e0\u6b64 <code>SurfaceView</code> \u7684\u7ed8\u5236\u64cd\u4f5c\u53ef\u4ee5\u5b8c\u5168\u8131\u79bb\u4e3b\u7ebf\u7a0b\u3002</p>"},{"location":"030Android/020SystemSourceCode/#4_5","title":"4. \u786c\u4ef6\u52a0\u901f\u652f\u6301","text":"<p><code>SurfaceView</code> \u7684 <code>Surface</code> \u76f4\u63a5\u7531\u786c\u4ef6\u5408\u6210\u5668\uff08Hardware Composer\uff09\u7ba1\u7406\uff0c\u652f\u6301\u786c\u4ef6\u52a0\u901f\u3002\u8fd9\u610f\u5473\u7740\u7ed8\u5236\u64cd\u4f5c\u53ef\u4ee5\u901a\u8fc7 GPU \u9ad8\u6548\u6267\u884c\uff0c\u800c\u4e0d\u9700\u8981\u4f9d\u8d56\u4e3b\u7ebf\u7a0b\u7684\u8f6f\u4ef6\u6e32\u67d3\u3002</p>"},{"location":"030Android/020SystemSourceCode/#5-view","title":"5. \u4e0e\u666e\u901a View \u7684\u5bf9\u6bd4","text":"<ul> <li>\u666e\u901a <code>View</code>\uff1a</li> <li>\u7ed8\u5236\u64cd\u4f5c\u5fc5\u987b\u5728\u4e3b\u7ebf\u7a0b\u4e2d\u901a\u8fc7 <code>onDraw()</code> \u65b9\u6cd5\u5b8c\u6210\u3002</li> <li>\u6240\u6709 <code>View</code> \u7684\u7ed8\u5236\u5171\u4eab\u540c\u4e00\u4e2a UI \u7ebf\u7a0b\uff0c\u9891\u7e41\u7ed8\u5236\u53ef\u80fd\u5bfc\u81f4\u4e3b\u7ebf\u7a0b\u5361\u987f\u3002</li> <li> <p>\u9002\u5408\u9759\u6001\u6216\u4f4e\u9891\u66f4\u65b0\u7684 UI\u3002</p> </li> <li> <p><code>SurfaceView</code>\uff1a</p> </li> <li>\u7ed8\u5236\u64cd\u4f5c\u53ef\u4ee5\u5728\u5b50\u7ebf\u7a0b\u4e2d\u5b8c\u6210\uff0c\u901a\u8fc7\u72ec\u7acb\u7684 <code>Surface</code> \u548c\u53cc\u7f13\u51b2\u673a\u5236\u5b9e\u73b0\u9ad8\u6548\u7ed8\u5236\u3002</li> <li>\u9002\u5408\u9ad8\u9891\u66f4\u65b0\u7684\u573a\u666f\uff08\u5982\u6e38\u620f\u3001\u89c6\u9891\u64ad\u653e\u3001\u76f8\u673a\u9884\u89c8\uff09\u3002</li> <li>\u7ed8\u5236\u5185\u5bb9\u76f4\u63a5\u663e\u793a\u5728\u5c4f\u5e55\u4e0a\uff0c\u4e0d\u4f9d\u8d56\u4e8e <code>View</code> \u7684\u5c42\u7ea7\u7ed3\u6784\u3002</li> </ul>"},{"location":"030Android/020SystemSourceCode/#6-view-ui","title":"6. \u4e3a\u4ec0\u4e48\u666e\u901a View \u4e0d\u80fd\u5728\u5b50\u7ebf\u7a0b\u5237\u65b0 UI\uff1f","text":"<p>\u666e\u901a <code>View</code> \u7684\u7ed8\u5236\u4f9d\u8d56\u4e8e <code>ViewRootImpl</code> \u548c <code>Choreographer</code>\uff0c\u5b83\u4eec\u4f1a\u5728\u4e3b\u7ebf\u7a0b\u4e2d\u8c03\u5ea6 <code>onDraw()</code> \u65b9\u6cd5\u3002Android \u7684 UI \u6846\u67b6\u8bbe\u8ba1\u4e3a\u5355\u7ebf\u7a0b\u6a21\u578b\uff0c\u6240\u6709 UI \u64cd\u4f5c\uff08\u5305\u62ec\u6d4b\u91cf\u3001\u5e03\u5c40\u3001\u7ed8\u5236\uff09\u90fd\u5fc5\u987b\u5728\u4e3b\u7ebf\u7a0b\u4e2d\u6267\u884c\uff0c\u4ee5\u786e\u4fdd\u7ebf\u7a0b\u5b89\u5168\u3002</p> <p>\u5982\u679c\u5c1d\u8bd5\u5728\u5b50\u7ebf\u7a0b\u4e2d\u76f4\u63a5\u64cd\u4f5c\u666e\u901a <code>View</code>\uff0c\u4f1a\u629b\u51fa <code>CalledFromWrongThreadException</code> \u5f02\u5e38\uff0c\u63d0\u793a\u201cOnly the original thread that created a view hierarchy can touch its views\u201d\u3002</p>"},{"location":"030Android/020SystemSourceCode/#7-surfaceview","title":"7. SurfaceView \u7684\u5b50\u7ebf\u7a0b\u7ed8\u5236\u793a\u4f8b","text":"<p>\u4ee5\u4e0b\u662f\u4e00\u4e2a\u7b80\u5355\u7684\u793a\u4f8b\uff0c\u5c55\u793a\u5982\u4f55\u5728\u5b50\u7ebf\u7a0b\u4e2d\u5237\u65b0 <code>SurfaceView</code> \u7684 UI\uff1a</p> <pre><code>class DrawingThread implements Runnable {\n    private SurfaceHolder surfaceHolder;\n    private boolean isRunning = true;\n\n    public DrawingThread(SurfaceHolder surfaceHolder) {\n        this.surfaceHolder = surfaceHolder;\n    }\n\n    @Override\n    public void run() {\n        while (isRunning) {\n            Canvas canvas = null;\n            try {\n                canvas = surfaceHolder.lockCanvas(); // \u83b7\u53d6 Canvas\n                if (canvas != null) {\n                    // \u5728 Canvas \u4e0a\u7ed8\u5236\u5185\u5bb9\n                    canvas.drawColor(Color.WHITE);\n                    Paint paint = new Paint();\n                    paint.setColor(Color.RED);\n                    canvas.drawCircle(100, 100, 50, paint);\n                }\n            } finally {\n                if (canvas != null) {\n                    surfaceHolder.unlockCanvasAndPost(canvas); // \u63d0\u4ea4\u7ed8\u5236\u5185\u5bb9\n                }\n            }\n        }\n    }\n\n    public void stop() {\n        isRunning = false;\n    }\n}\n</code></pre> <p>\u5728 <code>SurfaceHolder.Callback</code> \u4e2d\u542f\u52a8\u5b50\u7ebf\u7a0b\uff1a <pre><code>surfaceHolder.addCallback(new SurfaceHolder.Callback() {\n    private DrawingThread drawingThread;\n\n    @Override\n    public void surfaceCreated(SurfaceHolder holder) {\n        drawingThread = new DrawingThread(holder);\n        new Thread(drawingThread).start(); // \u542f\u52a8\u5b50\u7ebf\u7a0b\n    }\n\n    @Override\n    public void surfaceChanged(SurfaceHolder holder, int format, int width, int height) {}\n\n    @Override\n    public void surfaceDestroyed(SurfaceHolder holder) {\n        if (drawingThread != null) {\n            drawingThread.stop(); // \u505c\u6b62\u5b50\u7ebf\u7a0b\n        }\n    }\n});\n</code></pre></p>"},{"location":"030Android/020SystemSourceCode/#_13","title":"\u603b\u7ed3","text":"<p><code>SurfaceView</code> \u4e4b\u6240\u4ee5\u80fd\u591f\u5728\u5b50\u7ebf\u7a0b\u4e2d\u5237\u65b0 UI\uff0c\u662f\u56e0\u4e3a\u5b83\u4f7f\u7528\u4e86\u72ec\u7acb\u7684 <code>Surface</code> \u548c\u53cc\u7f13\u51b2\u673a\u5236\uff0c\u7ed5\u8fc7\u4e86\u666e\u901a <code>View</code> \u7684\u5355\u7ebf\u7a0b\u7ed8\u5236\u6a21\u578b\u3002\u8fd9\u79cd\u8bbe\u8ba1\u4f7f\u5f97 <code>SurfaceView</code> \u975e\u5e38\u9002\u5408\u9700\u8981\u9ad8\u6027\u80fd\u548c\u9ad8\u9891\u66f4\u65b0\u7684\u573a\u666f\uff08\u5982\u6e38\u620f\u3001\u89c6\u9891\u64ad\u653e\u7b49\uff09\u3002\u7136\u800c\uff0c\u666e\u901a <code>View</code> \u4ecd\u7136\u9002\u7528\u4e8e\u5927\u591a\u6570\u9759\u6001\u6216\u4f4e\u9891\u66f4\u65b0\u7684 UI \u573a\u666f\u3002</p>"},{"location":"030Android/020SystemSourceCode/#android-surfaceview-view","title":"Android \u548cSurfaceView\u76f8\u5173\u7684, \u54ea\u4e2aView\u66f4\u9002\u5408\u89c6\u9891\u64ad\u653e\uff1f\u66f4\u7b80\u5355\u6613\u7528\u3002","text":"\u7b54\u6848 <p>\u5728 Android \u5f00\u53d1\u4e2d\uff0c<code>SurfaceView</code> \u548c <code>TextureView</code> \u90fd\u9002\u5408\u89c6\u9891\u64ad\u653e\uff0c\u4f46\u5404\u6709\u4f18\u7f3a\u70b9\uff0c\u9009\u62e9\u53d6\u51b3\u4e8e\u5177\u4f53\u9700\u6c42\u3002</p>"},{"location":"030Android/020SystemSourceCode/#surfaceview","title":"SurfaceView","text":"<p>\u4f18\u70b9\uff1a 1. \u6027\u80fd\u9ad8\uff1a<code>SurfaceView</code> \u5728\u72ec\u7acb\u7a97\u53e3\u4e2d\u7ed8\u5236\uff0c\u4e0d\u5360\u7528\u4e3b\u7ebf\u7a0b\u8d44\u6e90\uff0c\u9002\u5408\u9ad8\u6027\u80fd\u9700\u6c42\u3002 2. \u786c\u4ef6\u52a0\u901f\uff1a\u652f\u6301\u786c\u4ef6\u52a0\u901f\uff0c\u9002\u5408\u89c6\u9891\u64ad\u653e\u7b49\u56fe\u5f62\u5bc6\u96c6\u578b\u4efb\u52a1\u3002</p> <p>\u7f3a\u70b9\uff1a 1. \u5e03\u5c40\u9650\u5236\uff1a\u7531\u4e8e\u5728\u72ec\u7acb\u7a97\u53e3\u4e2d\u7ed8\u5236\uff0c\u67d0\u4e9b\u5e03\u5c40\u64cd\u4f5c\uff08\u5982\u5e73\u79fb\u3001\u7f29\u653e\uff09\u53ef\u80fd\u53d7\u9650\u3002 2. \u900f\u660e\u5ea6\u95ee\u9898\uff1a\u4e0d\u652f\u6301\u900f\u660e\u5ea6\uff0c\u65e0\u6cd5\u5b9e\u73b0\u900f\u660e\u6216\u534a\u900f\u660e\u6548\u679c\u3002</p>"},{"location":"030Android/020SystemSourceCode/#textureview","title":"TextureView","text":"<p>\u4f18\u70b9\uff1a 1. \u5e03\u5c40\u7075\u6d3b\uff1a<code>TextureView</code> \u662f\u666e\u901a\u89c6\u56fe\uff0c\u652f\u6301\u6240\u6709\u5e03\u5c40\u64cd\u4f5c\uff0c\u5982\u5e73\u79fb\u3001\u7f29\u653e\u3001\u65cb\u8f6c\u7b49\u3002 2. \u900f\u660e\u5ea6\u652f\u6301\uff1a\u652f\u6301\u900f\u660e\u5ea6\uff0c\u9002\u5408\u9700\u8981\u900f\u660e\u6216\u534a\u900f\u660e\u6548\u679c\u7684\u573a\u666f\u3002</p> <p>\u7f3a\u70b9\uff1a 1. \u6027\u80fd\u7a0d\u4f4e\uff1a\u7531\u4e8e\u5728\u4e3b\u7ebf\u7a0b\u4e2d\u7ed8\u5236\uff0c\u6027\u80fd\u7565\u4f4e\u4e8e <code>SurfaceView</code>\u3002 2. \u5185\u5b58\u5360\u7528\uff1a\u76f8\u6bd4 <code>SurfaceView</code>\uff0c\u5185\u5b58\u5360\u7528\u7a0d\u9ad8\u3002</p>"},{"location":"030Android/020SystemSourceCode/#_14","title":"\u66f4\u7b80\u5355\u6613\u7528\u7684\u9009\u62e9","text":"<ul> <li>\u7b80\u5355\u6613\u7528\uff1a<code>TextureView</code> \u66f4\u6613\u7528\uff0c\u652f\u6301\u5e38\u89c4\u5e03\u5c40\u64cd\u4f5c\uff0c\u9002\u5408\u5927\u591a\u6570\u89c6\u9891\u64ad\u653e\u9700\u6c42\u3002</li> <li>\u9ad8\u6027\u80fd\u9700\u6c42\uff1a\u82e5\u5bf9\u6027\u80fd\u8981\u6c42\u6781\u9ad8\uff0c<code>SurfaceView</code> \u662f\u66f4\u597d\u7684\u9009\u62e9\u3002</li> </ul>"},{"location":"030Android/020SystemSourceCode/#_15","title":"\u603b\u7ed3","text":"<ul> <li><code>TextureView</code>\uff1a\u9002\u5408\u5927\u591a\u6570\u89c6\u9891\u64ad\u653e\u573a\u666f\uff0c\u5e03\u5c40\u7075\u6d3b\uff0c\u652f\u6301\u900f\u660e\u5ea6\u3002</li> <li><code>SurfaceView</code>\uff1a\u9002\u5408\u9ad8\u6027\u80fd\u9700\u6c42\uff0c\u4f46\u4e0d\u652f\u6301\u900f\u660e\u5ea6\uff0c\u5e03\u5c40\u64cd\u4f5c\u53d7\u9650\u3002</li> </ul> <p>\u6839\u636e\u5177\u4f53\u9700\u6c42\u9009\u62e9\u5408\u9002\u7684\u89c6\u56fe\u3002 IJKPlayer\u9ed8\u8ba4\u4f7f\u7528SurfaceView\uff0c\u4f46\u662f\u4e5f\u63d0\u4f9b\u4e86TextureView\u53ef\u4ee5\u9009\u62e9\u3002</p>"},{"location":"030Android/020SystemSourceCode/#android-remoteviews","title":"Android RemoteViews\u5b9e\u73b0\u548c\u4f7f\u7528\u573a\u666f","text":"\u7b54\u6848"},{"location":"030Android/020SystemSourceCode/#android-remoteviews_1","title":"Android RemoteViews \u5b9e\u73b0\u548c\u4f7f\u7528\u573a\u666f","text":""},{"location":"030Android/020SystemSourceCode/#1_3","title":"1. \u6982\u8ff0","text":"<p><code>RemoteViews</code> \u662f Android \u4e2d\u7528\u4e8e\u63cf\u8ff0\u8de8\u8fdb\u7a0b\u663e\u793a\u7684\u89c6\u56fe\u5c42\u6b21\u7ed3\u6784\u7684\u7c7b\uff0c\u5e38\u7528\u4e8e\u901a\u77e5\u680f\u3001App Widgets \u548c\u7cfb\u7edf UI \u7684\u5b9a\u5236\u3002\u5b83\u5141\u8bb8\u4f60\u5728\u4e00\u4e2a\u8fdb\u7a0b\u4e2d\u521b\u5efa\u89c6\u56fe\uff0c\u5e76\u5728\u53e6\u4e00\u4e2a\u8fdb\u7a0b\u4e2d\u663e\u793a\u3002</p>"},{"location":"030Android/020SystemSourceCode/#2_5","title":"2. \u5b9e\u73b0\u6b65\u9aa4","text":""},{"location":"030Android/020SystemSourceCode/#21-remoteviews","title":"2.1 \u521b\u5efa RemoteViews \u5bf9\u8c61","text":"<p>\u9996\u5148\uff0c\u521b\u5efa\u4e00\u4e2a <code>RemoteViews</code> \u5bf9\u8c61\uff0c\u6307\u5b9a\u5e03\u5c40\u6587\u4ef6\u548c\u5305\u540d\u3002</p> <pre><code>RemoteViews remoteViews = new RemoteViews(context.getPackageName(), R.layout.notification_layout);\n</code></pre>"},{"location":"030Android/020SystemSourceCode/#22","title":"2.2 \u8bbe\u7f6e\u89c6\u56fe\u5185\u5bb9","text":"<p>\u4f7f\u7528 <code>RemoteViews</code> \u7684\u65b9\u6cd5\u8bbe\u7f6e\u89c6\u56fe\u5185\u5bb9\uff0c\u5982\u6587\u672c\u3001\u56fe\u7247\u7b49\u3002</p> <pre><code>remoteViews.setTextViewText(R.id.text_view, \"Hello, World!\");\nremoteViews.setImageViewResource(R.id.image_view, R.drawable.icon);\n</code></pre>"},{"location":"030Android/020SystemSourceCode/#23-app-widget","title":"2.3 \u5e94\u7528\u5230\u901a\u77e5\u6216 App Widget","text":"<p>\u5c06 <code>RemoteViews</code> \u5e94\u7528\u5230\u901a\u77e5\u6216 App Widget\u3002</p> <p>\u901a\u77e5\u680f\u793a\u4f8b\uff1a</p> <pre><code>NotificationCompat.Builder builder = new NotificationCompat.Builder(context, CHANNEL_ID)\n        .setSmallIcon(R.drawable.icon)\n        .setContent(remoteViews);\n\nNotificationManager notificationManager = (NotificationManager) context.getSystemService(Context.NOTIFICATION_SERVICE);\nnotificationManager.notify(notificationId, builder.build());\n</code></pre> <p>App Widget \u793a\u4f8b\uff1a</p> <pre><code>AppWidgetManager appWidgetManager = AppWidgetManager.getInstance(context);\nappWidgetManager.updateAppWidget(appWidgetId, remoteViews);\n</code></pre>"},{"location":"030Android/020SystemSourceCode/#24","title":"2.4 \u5904\u7406\u70b9\u51fb\u4e8b\u4ef6","text":"<p>\u901a\u8fc7 <code>PendingIntent</code> \u5904\u7406\u89c6\u56fe\u7684\u70b9\u51fb\u4e8b\u4ef6\u3002</p> <pre><code>Intent intent = new Intent(context, MainActivity.class);\nPendingIntent pendingIntent = PendingIntent.getActivity(context, 0, intent, PendingIntent.FLAG_UPDATE_CURRENT);\nremoteViews.setOnClickPendingIntent(R.id.button, pendingIntent);\n</code></pre>"},{"location":"030Android/020SystemSourceCode/#3_2","title":"3. \u4f7f\u7528\u573a\u666f","text":""},{"location":"030Android/020SystemSourceCode/#31","title":"3.1 \u901a\u77e5\u680f\u5b9a\u5236","text":"<p><code>RemoteViews</code> \u5e38\u7528\u4e8e\u5b9a\u5236\u901a\u77e5\u680f\u7684\u5e03\u5c40\uff0c\u63d0\u4f9b\u66f4\u4e30\u5bcc\u7684\u4ea4\u4e92\u4f53\u9a8c\u3002</p>"},{"location":"030Android/020SystemSourceCode/#32-app-widgets","title":"3.2 App Widgets","text":"<p>\u5728 App Widgets \u4e2d\u4f7f\u7528 <code>RemoteViews</code> \u521b\u5efa\u4e3b\u5c4f\u5e55\u4e0a\u7684\u5c0f\u90e8\u4ef6\uff0c\u5c55\u793a\u5b9e\u65f6\u4fe1\u606f\u6216\u63d0\u4f9b\u5feb\u6377\u64cd\u4f5c\u3002</p>"},{"location":"030Android/020SystemSourceCode/#33-ui","title":"3.3 \u7cfb\u7edf UI \u5b9a\u5236","text":"<p>\u67d0\u4e9b\u7cfb\u7edf UI \u5143\u7d20\uff08\u5982\u9501\u5c4f\u754c\u9762\uff09\u4e5f\u53ef\u4ee5\u901a\u8fc7 <code>RemoteViews</code> \u8fdb\u884c\u5b9a\u5236\u3002</p>"},{"location":"030Android/020SystemSourceCode/#4_6","title":"4. \u6ce8\u610f\u4e8b\u9879","text":"<ul> <li>\u8de8\u8fdb\u7a0b\u9650\u5236\uff1a<code>RemoteViews</code> \u4ec5\u652f\u6301\u90e8\u5206\u89c6\u56fe\u548c\u64cd\u4f5c\uff0c\u590d\u6742\u5e03\u5c40\u6216\u81ea\u5b9a\u4e49\u89c6\u56fe\u53ef\u80fd\u65e0\u6cd5\u4f7f\u7528\u3002</li> <li>\u6027\u80fd\u8003\u8651\uff1a\u9891\u7e41\u66f4\u65b0 <code>RemoteViews</code> \u53ef\u80fd\u5f71\u54cd\u6027\u80fd\uff0c\u9700\u4f18\u5316\u66f4\u65b0\u9891\u7387\u3002</li> <li>\u517c\u5bb9\u6027\uff1a\u4e0d\u540c Android \u7248\u672c\u5bf9 <code>RemoteViews</code> \u7684\u652f\u6301\u53ef\u80fd\u4e0d\u540c\uff0c\u9700\u8fdb\u884c\u517c\u5bb9\u6027\u6d4b\u8bd5\u3002</li> </ul>"},{"location":"030Android/020SystemSourceCode/#5_2","title":"5. \u603b\u7ed3","text":"<p><code>RemoteViews</code> \u662f Android \u5f00\u53d1\u4e2d\u7528\u4e8e\u8de8\u8fdb\u7a0b\u663e\u793a\u89c6\u56fe\u7684\u91cd\u8981\u5de5\u5177\uff0c\u9002\u7528\u4e8e\u901a\u77e5\u680f\u3001App Widgets \u548c\u7cfb\u7edf UI \u7684\u5b9a\u5236\u3002\u638c\u63e1\u5176\u4f7f\u7528\u65b9\u6cd5\u80fd\u663e\u8457\u63d0\u5347\u5e94\u7528\u7684\u7528\u6237\u4f53\u9a8c\u3002</p>"},{"location":"030Android/020SystemSourceCode/#android-activitythread","title":"Android ActivityThread\u6e90\u7801\u89e3\u6790","text":"\u7b54\u6848 <p><code>ActivityThread</code> \u662f Android \u5e94\u7528\u7a0b\u5e8f\u7684\u6838\u5fc3\u7c7b\u4e4b\u4e00\uff0c\u8d1f\u8d23\u7ba1\u7406\u5e94\u7528\u7a0b\u5e8f\u7684\u4e3b\u7ebf\u7a0b\u548c\u4e3b\u7ebf\u7a0b\u7684\u6d88\u606f\u5faa\u73af\u3002\u5b83\u662f\u5e94\u7528\u7a0b\u5e8f\u4e0e\u7cfb\u7edf\u4e4b\u95f4\u7684\u6865\u6881\uff0c\u8d1f\u8d23\u5904\u7406\u5e94\u7528\u7a0b\u5e8f\u7684\u751f\u547d\u5468\u671f\u3001UI \u66f4\u65b0\u3001\u4e8b\u4ef6\u5206\u53d1\u7b49\u5173\u952e\u4efb\u52a1\u3002\u4ee5\u4e0b\u662f\u5bf9 <code>ActivityThread</code> \u7684\u6e90\u7801\u89e3\u6790\uff0c\u5e2e\u52a9\u4f60\u66f4\u597d\u5730\u7406\u89e3\u5176\u5de5\u4f5c\u539f\u7406\u3002</p>"},{"location":"030Android/020SystemSourceCode/#1-activitythread","title":"1. ActivityThread \u6982\u8ff0","text":"<p><code>ActivityThread</code> \u662f Android \u5e94\u7528\u7a0b\u5e8f\u7684\u4e3b\u7ebf\u7a0b\u7c7b\uff0c\u6bcf\u4e2a\u5e94\u7528\u7a0b\u5e8f\u90fd\u6709\u4e00\u4e2a <code>ActivityThread</code> \u5b9e\u4f8b\u3002\u5b83\u8d1f\u8d23\u7ba1\u7406\u5e94\u7528\u7a0b\u5e8f\u7684 <code>Activity</code>\u3001<code>Service</code>\u3001<code>BroadcastReceiver</code> \u7b49\u7ec4\u4ef6\u7684\u751f\u547d\u5468\u671f\uff0c\u5e76\u4e0e\u7cfb\u7edf\u670d\u52a1\uff08\u5982 <code>ActivityManagerService</code>\uff09\u8fdb\u884c\u4ea4\u4e92\u3002</p>"},{"location":"030Android/020SystemSourceCode/#2-activitythread","title":"2. ActivityThread \u7684\u4e3b\u8981\u804c\u8d23","text":"<ul> <li>\u7ba1\u7406\u5e94\u7528\u7a0b\u5e8f\u7684\u4e3b\u7ebf\u7a0b\uff1a<code>ActivityThread</code> \u662f\u5e94\u7528\u7a0b\u5e8f\u7684\u4e3b\u7ebf\u7a0b\uff0c\u8d1f\u8d23\u5904\u7406 UI \u66f4\u65b0\u548c\u4e8b\u4ef6\u5206\u53d1\u3002</li> <li>\u5904\u7406\u5e94\u7528\u7a0b\u5e8f\u7684\u751f\u547d\u5468\u671f\uff1a<code>ActivityThread</code> \u8d1f\u8d23\u542f\u52a8\u3001\u6682\u505c\u3001\u6062\u590d\u3001\u505c\u6b62\u548c\u9500\u6bc1 <code>Activity</code> \u548c <code>Service</code>\u3002</li> <li>\u4e0e\u7cfb\u7edf\u670d\u52a1\u4ea4\u4e92\uff1a<code>ActivityThread</code> \u901a\u8fc7 <code>Binder</code> \u4e0e <code>ActivityManagerService</code> \u7b49\u7cfb\u7edf\u670d\u52a1\u901a\u4fe1\uff0c\u6267\u884c\u7cfb\u7edf\u7ea7\u522b\u7684\u64cd\u4f5c\u3002</li> <li>\u7ba1\u7406\u5e94\u7528\u7a0b\u5e8f\u7684 <code>Context</code>\uff1a<code>ActivityThread</code> \u8d1f\u8d23\u521b\u5efa\u548c\u7ba1\u7406\u5e94\u7528\u7a0b\u5e8f\u7684 <code>Context</code> \u5bf9\u8c61\uff0c\u5982 <code>Application</code>\u3001<code>Activity</code> \u7b49\u3002</li> </ul>"},{"location":"030Android/020SystemSourceCode/#3-activitythread","title":"3. ActivityThread \u7684\u6838\u5fc3\u65b9\u6cd5","text":""},{"location":"030Android/020SystemSourceCode/#31-mainstring-args","title":"3.1 <code>main(String[] args)</code>","text":"<p><code>main</code> \u65b9\u6cd5\u662f <code>ActivityThread</code> \u7684\u5165\u53e3\u70b9\uff0c\u5e94\u7528\u7a0b\u5e8f\u542f\u52a8\u65f6\u4f1a\u8c03\u7528\u6b64\u65b9\u6cd5\u3002\u5b83\u521d\u59cb\u5316\u4e3b\u7ebf\u7a0b\u7684\u6d88\u606f\u5faa\u73af\uff08<code>Looper</code>\uff09\uff0c\u5e76\u521b\u5efa <code>ActivityThread</code> \u5b9e\u4f8b\u3002</p> <pre><code>public static void main(String[] args) {\n    // \u521d\u59cb\u5316\u4e3b\u7ebf\u7a0b\u7684 Looper\n    Looper.prepareMainLooper();\n\n    // \u521b\u5efa ActivityThread \u5b9e\u4f8b\n    ActivityThread thread = new ActivityThread();\n    thread.attach(false);\n\n    // \u542f\u52a8\u4e3b\u7ebf\u7a0b\u7684\u6d88\u606f\u5faa\u73af\n    Looper.loop();\n}\n</code></pre> <ul> <li><code>Looper.prepareMainLooper()</code>\uff1a\u521d\u59cb\u5316\u4e3b\u7ebf\u7a0b\u7684 <code>Looper</code>\uff0c\u786e\u4fdd\u4e3b\u7ebf\u7a0b\u53ef\u4ee5\u5904\u7406\u6d88\u606f\u3002</li> <li><code>thread.attach(false)</code>\uff1a\u5c06 <code>ActivityThread</code> \u5b9e\u4f8b\u4e0e\u7cfb\u7edf\u670d\u52a1\uff08\u5982 <code>ActivityManagerService</code>\uff09\u8fdb\u884c\u7ed1\u5b9a\u3002</li> <li><code>Looper.loop()</code>\uff1a\u542f\u52a8\u4e3b\u7ebf\u7a0b\u7684\u6d88\u606f\u5faa\u73af\uff0c\u5904\u7406\u6d88\u606f\u961f\u5217\u4e2d\u7684\u6d88\u606f\u3002</li> </ul>"},{"location":"030Android/020SystemSourceCode/#32-attachboolean-system","title":"3.2 <code>attach(boolean system)</code>","text":"<p><code>attach</code> \u65b9\u6cd5\u7528\u4e8e\u5c06 <code>ActivityThread</code> \u5b9e\u4f8b\u4e0e\u7cfb\u7edf\u670d\u52a1\u8fdb\u884c\u7ed1\u5b9a\u3002\u5b83\u4f1a\u901a\u8fc7 <code>Binder</code> \u4e0e <code>ActivityManagerService</code> \u901a\u4fe1\uff0c\u6ce8\u518c\u5e94\u7528\u7a0b\u5e8f\u8fdb\u7a0b\u3002</p> <pre><code>private void attach(boolean system) {\n    // \u83b7\u53d6 ActivityManagerService \u7684 Binder \u4ee3\u7406\n    final IActivityManager mgr = ActivityManager.getService();\n    try {\n        // \u5c06 ApplicationThread \u6ce8\u518c\u5230 ActivityManagerService\n        mgr.attachApplication(mAppThread);\n    } catch (RemoteException ex) {\n        throw ex.rethrowFromSystemServer();\n    }\n}\n</code></pre> <ul> <li><code>mAppThread</code> \u662f <code>ApplicationThread</code> \u7684\u5b9e\u4f8b\uff0c\u5b83\u662f <code>ActivityThread</code> \u7684\u5185\u90e8\u7c7b\uff0c\u8d1f\u8d23\u4e0e <code>ActivityManagerService</code> \u901a\u4fe1\u3002</li> <li><code>attachApplication</code> \u65b9\u6cd5\u5c06 <code>ApplicationThread</code> \u6ce8\u518c\u5230 <code>ActivityManagerService</code>\uff0c\u7cfb\u7edf\u670d\u52a1\u53ef\u4ee5\u901a\u8fc7 <code>ApplicationThread</code> \u63a7\u5236\u5e94\u7528\u7a0b\u5e8f\u7684\u751f\u547d\u5468\u671f\u3002</li> </ul>"},{"location":"030Android/020SystemSourceCode/#33-handlemessagemessage-msg","title":"3.3 <code>handleMessage(Message msg)</code>","text":"<p><code>handleMessage</code> \u65b9\u6cd5\u662f <code>ActivityThread</code> \u5904\u7406\u6d88\u606f\u7684\u6838\u5fc3\u65b9\u6cd5\u3002\u5b83\u6839\u636e\u6d88\u606f\u7684\u7c7b\u578b\u6267\u884c\u76f8\u5e94\u7684\u64cd\u4f5c\uff0c\u5982\u542f\u52a8 <code>Activity</code>\u3001\u5904\u7406 <code>Service</code> \u7684\u751f\u547d\u5468\u671f\u7b49\u3002</p> <pre><code>public void handleMessage(Message msg) {\n    switch (msg.what) {\n        case LAUNCH_ACTIVITY: {\n            // \u5904\u7406\u542f\u52a8 Activity \u7684\u6d88\u606f\n            handleLaunchActivity((ActivityClientRecord) msg.obj);\n            break;\n        }\n        case PAUSE_ACTIVITY: {\n            // \u5904\u7406\u6682\u505c Activity \u7684\u6d88\u606f\n            handlePauseActivity((ActivityClientRecord) msg.obj);\n            break;\n        }\n        case STOP_ACTIVITY: {\n            // \u5904\u7406\u505c\u6b62 Activity \u7684\u6d88\u606f\n            handleStopActivity((ActivityClientRecord) msg.obj);\n            break;\n        }\n        // \u5176\u4ed6\u6d88\u606f\u5904\u7406...\n    }\n}\n</code></pre> <ul> <li><code>LAUNCH_ACTIVITY</code>\uff1a\u5904\u7406\u542f\u52a8 <code>Activity</code> \u7684\u6d88\u606f\uff0c\u8c03\u7528 <code>handleLaunchActivity</code> \u65b9\u6cd5\u3002</li> <li><code>PAUSE_ACTIVITY</code>\uff1a\u5904\u7406\u6682\u505c <code>Activity</code> \u7684\u6d88\u606f\uff0c\u8c03\u7528 <code>handlePauseActivity</code> \u65b9\u6cd5\u3002</li> <li><code>STOP_ACTIVITY</code>\uff1a\u5904\u7406\u505c\u6b62 <code>Activity</code> \u7684\u6d88\u606f\uff0c\u8c03\u7528 <code>handleStopActivity</code> \u65b9\u6cd5\u3002</li> </ul>"},{"location":"030Android/020SystemSourceCode/#34-handlelaunchactivityactivityclientrecord-r","title":"3.4 <code>handleLaunchActivity(ActivityClientRecord r)</code>","text":"<p><code>handleLaunchActivity</code> \u65b9\u6cd5\u8d1f\u8d23\u542f\u52a8 <code>Activity</code>\u3002\u5b83\u4f1a\u521b\u5efa <code>Activity</code> \u5b9e\u4f8b\uff0c\u8c03\u7528 <code>onCreate</code> \u65b9\u6cd5\uff0c\u5e76\u5c06 <code>Activity</code> \u7684\u89c6\u56fe\u6dfb\u52a0\u5230\u7a97\u53e3\u7ba1\u7406\u5668\u4e2d\u3002</p> <pre><code>private void handleLaunchActivity(ActivityClientRecord r) {\n    // \u521b\u5efa Activity \u5b9e\u4f8b\n    Activity activity = performLaunchActivity(r, null);\n\n    if (activity != null) {\n        // \u8c03\u7528 Activity \u7684 onStart \u548c onResume \u65b9\u6cd5\n        handleResumeActivity(r.token, false, true);\n    }\n}\n</code></pre> <ul> <li><code>performLaunchActivity</code>\uff1a\u521b\u5efa <code>Activity</code> \u5b9e\u4f8b\uff0c\u5e76\u8c03\u7528 <code>onCreate</code> \u65b9\u6cd5\u3002</li> <li><code>handleResumeActivity</code>\uff1a\u8c03\u7528 <code>Activity</code> \u7684 <code>onStart</code> \u548c <code>onResume</code> \u65b9\u6cd5\uff0c\u5e76\u5c06 <code>Activity</code> \u7684\u89c6\u56fe\u6dfb\u52a0\u5230\u7a97\u53e3\u7ba1\u7406\u5668\u4e2d\u3002</li> </ul>"},{"location":"030Android/020SystemSourceCode/#4-applicationthread","title":"4. ApplicationThread","text":"<p><code>ApplicationThread</code> \u662f <code>ActivityThread</code> \u7684\u5185\u90e8\u7c7b\uff0c\u8d1f\u8d23\u4e0e <code>ActivityManagerService</code> \u901a\u4fe1\u3002\u5b83\u662f <code>ActivityThread</code> \u7684 Binder \u63a5\u53e3\u5b9e\u73b0\u7c7b\uff0c\u7cfb\u7edf\u670d\u52a1\u901a\u8fc7 <code>ApplicationThread</code> \u63a7\u5236\u5e94\u7528\u7a0b\u5e8f\u7684\u751f\u547d\u5468\u671f\u3002</p> <pre><code>private class ApplicationThread extends IApplicationThread.Stub {\n    @Override\n    public void scheduleLaunchActivity(Intent intent, IBinder token, ...) {\n        // \u53d1\u9001 LAUNCH_ACTIVITY \u6d88\u606f\u5230\u4e3b\u7ebf\u7a0b\n        sendMessage(H.LAUNCH_ACTIVITY, r);\n    }\n\n    @Override\n    public void schedulePauseActivity(IBinder token, ...) {\n        // \u53d1\u9001 PAUSE_ACTIVITY \u6d88\u606f\u5230\u4e3b\u7ebf\u7a0b\n        sendMessage(H.PAUSE_ACTIVITY, r);\n    }\n}\n</code></pre> <ul> <li><code>scheduleLaunchActivity</code>\uff1a\u5f53\u7cfb\u7edf\u670d\u52a1\u9700\u8981\u542f\u52a8 <code>Activity</code> \u65f6\uff0c\u4f1a\u8c03\u7528\u6b64\u65b9\u6cd5\uff0c\u53d1\u9001 <code>LAUNCH_ACTIVITY</code> \u6d88\u606f\u5230\u4e3b\u7ebf\u7a0b\u3002</li> <li><code>schedulePauseActivity</code>\uff1a\u5f53\u7cfb\u7edf\u670d\u52a1\u9700\u8981\u6682\u505c <code>Activity</code> \u65f6\uff0c\u4f1a\u8c03\u7528\u6b64\u65b9\u6cd5\uff0c\u53d1\u9001 <code>PAUSE_ACTIVITY</code> \u6d88\u606f\u5230\u4e3b\u7ebf\u7a0b\u3002</li> </ul>"},{"location":"030Android/020SystemSourceCode/#5_3","title":"5. \u603b\u7ed3","text":"<p><code>ActivityThread</code> \u662f Android \u5e94\u7528\u7a0b\u5e8f\u7684\u6838\u5fc3\u7c7b\uff0c\u8d1f\u8d23\u7ba1\u7406\u5e94\u7528\u7a0b\u5e8f\u7684\u4e3b\u7ebf\u7a0b\u548c\u7ec4\u4ef6\u7684\u751f\u547d\u5468\u671f\u3002\u5b83\u901a\u8fc7 <code>ApplicationThread</code> \u4e0e\u7cfb\u7edf\u670d\u52a1\u901a\u4fe1\uff0c\u5904\u7406\u7cfb\u7edf\u7ea7\u522b\u7684\u64cd\u4f5c\u3002\u7406\u89e3 <code>ActivityThread</code> \u7684\u5de5\u4f5c\u539f\u7406\uff0c\u6709\u52a9\u4e8e\u6df1\u5165\u7406\u89e3 Android \u5e94\u7528\u7a0b\u5e8f\u7684\u8fd0\u884c\u673a\u5236\u3002</p>"},{"location":"030Android/020SystemSourceCode/#6_2","title":"6. \u5173\u952e\u70b9","text":"<ul> <li><code>ActivityThread</code> \u662f\u5e94\u7528\u7a0b\u5e8f\u7684\u4e3b\u7ebf\u7a0b\uff0c\u8d1f\u8d23\u5904\u7406 UI \u66f4\u65b0\u548c\u4e8b\u4ef6\u5206\u53d1\u3002</li> <li><code>ApplicationThread</code> \u662f <code>ActivityThread</code> \u7684\u5185\u90e8\u7c7b\uff0c\u8d1f\u8d23\u4e0e <code>ActivityManagerService</code> \u901a\u4fe1\u3002</li> <li><code>ActivityThread</code> \u901a\u8fc7 <code>handleMessage</code> \u65b9\u6cd5\u5904\u7406\u7cfb\u7edf\u670d\u52a1\u53d1\u9001\u7684\u6d88\u606f\uff0c\u6267\u884c\u76f8\u5e94\u7684\u751f\u547d\u5468\u671f\u64cd\u4f5c\u3002</li> </ul> <p>\u901a\u8fc7\u5bf9 <code>ActivityThread</code> \u6e90\u7801\u7684\u89e3\u6790\uff0c\u4f60\u53ef\u4ee5\u66f4\u597d\u5730\u7406\u89e3 Android \u5e94\u7528\u7a0b\u5e8f\u7684\u542f\u52a8\u8fc7\u7a0b\u3001\u751f\u547d\u5468\u671f\u7ba1\u7406\u548c\u6d88\u606f\u5904\u7406\u673a\u5236\u3002</p>"},{"location":"030Android/020SystemSourceCode/#android_1","title":"Android\u8fdb\u7a0b\u540d\u79f0\u662f\u5982\u4f55\u88ab\u6307\u5b9a\u7684\uff1f","text":"\u7b54\u6848 <p>\u5728Android\u7cfb\u7edf\u4e2d\uff0c\u8fdb\u7a0b\u540d\u79f0\u7684\u6307\u5b9a\u4e3b\u8981\u4e0e<code>ActivityThread</code>\u7c7b\u548c<code>Process</code>\u7c7b\u76f8\u5173\u3002\u4ee5\u4e0b\u662f\u6e90\u7801\u89d2\u5ea6\u7684\u5206\u6790\uff1a</p>"},{"location":"030Android/020SystemSourceCode/#1-activitythread_1","title":"1. <code>ActivityThread</code>\u7c7b","text":"<p><code>ActivityThread</code>\u662fAndroid\u5e94\u7528\u7684\u4e3b\u7ebf\u7a0b\uff0c\u8d1f\u8d23\u7ba1\u7406\u5e94\u7528\u7684\u4e3b\u5faa\u73af\u548c\u7ec4\u4ef6\u751f\u547d\u5468\u671f\u3002\u8fdb\u7a0b\u540d\u79f0\u7684\u521d\u59cb\u5316\u5728<code>ActivityThread</code>\u7684<code>main</code>\u65b9\u6cd5\u4e2d\u5b8c\u6210\u3002</p>"},{"location":"030Android/020SystemSourceCode/#main","title":"<code>main</code>\u65b9\u6cd5","text":"<p><pre><code>public static void main(String[] args) {\n    ...\n    Process.setArgV0(\"&lt;pre-initialized&gt;\");\n    Looper.prepareMainLooper();\n    ActivityThread thread = new ActivityThread();\n    thread.attach(false);\n    ...\n    Looper.loop();\n    ...\n}\n</code></pre> \u5728<code>main</code>\u65b9\u6cd5\u4e2d\uff0c<code>Process.setArgV0</code>\u7528\u4e8e\u8bbe\u7f6e\u8fdb\u7a0b\u540d\u79f0\u7684\u521d\u59cb\u503c\u3002</p>"},{"location":"030Android/020SystemSourceCode/#2-attach","title":"2. <code>attach</code>\u65b9\u6cd5","text":"<p><code>attach</code>\u65b9\u6cd5\u8fdb\u4e00\u6b65\u8bbe\u7f6e\u8fdb\u7a0b\u540d\u79f0\uff0c\u7279\u522b\u662f\u5f53\u5e94\u7528\u542f\u52a8\u65f6\u3002</p> <p><pre><code>private void attach(boolean system) {\n    ...\n    if (!system) {\n        final String processName = ActivityThread.currentProcessName();\n        android.ddm.DdmHandleAppName.setAppName(processName, UserHandle.myUserId());\n    }\n    ...\n}\n</code></pre> <code>ActivityThread.currentProcessName()</code>\u83b7\u53d6\u5f53\u524d\u8fdb\u7a0b\u540d\u79f0\uff0c\u5e76\u901a\u8fc7<code>DdmHandleAppName.setAppName</code>\u8bbe\u7f6eDDMS\u4e2d\u7684\u5e94\u7528\u540d\u79f0\u3002</p>"},{"location":"030Android/020SystemSourceCode/#3-process","title":"3. <code>Process</code>\u7c7b","text":"<p><code>Process</code>\u7c7b\u63d0\u4f9b\u4e86\u4e0e\u8fdb\u7a0b\u76f8\u5173\u7684\u64cd\u4f5c\uff0c\u5305\u62ec\u8bbe\u7f6e\u8fdb\u7a0b\u540d\u79f0\u3002</p>"},{"location":"030Android/020SystemSourceCode/#setargv0","title":"<code>setArgV0</code>\u65b9\u6cd5","text":"<p><pre><code>public static final void setArgV0(String name) {\n    if (name == null) {\n        throw new NullPointerException(\"name == null\");\n    }\n    try {\n        Libcore.os.prctl(PR_SET_NAME, name, 0, 0, 0);\n    } catch (ErrnoException e) {\n        throw new RuntimeException(e);\n    }\n}\n</code></pre> <code>setArgV0</code>\u901a\u8fc7<code>prctl</code>\u7cfb\u7edf\u8c03\u7528\u8bbe\u7f6e\u8fdb\u7a0b\u540d\u79f0\u3002</p>"},{"location":"030Android/020SystemSourceCode/#4-activitymanagerservice","title":"4. <code>ActivityManagerService</code>","text":"<p><code>ActivityManagerService</code>\u8d1f\u8d23\u7ba1\u7406\u8fdb\u7a0b\u7684\u542f\u52a8\u548c\u540d\u79f0\u8bbe\u7f6e\u3002</p>"},{"location":"030Android/020SystemSourceCode/#startprocesslocked","title":"<code>startProcessLocked</code>\u65b9\u6cd5","text":"<p><pre><code>final ProcessRecord startProcessLocked(String processName, ApplicationInfo info, ...) {\n    ...\n    String hostingType = \"activity\";\n    String hostingNameStr = \"activity\";\n    ...\n    Process.ProcessStartResult startResult = Process.start(entryPoint, ...);\n    ...\n}\n</code></pre> <code>startProcessLocked</code>\u542f\u52a8\u65b0\u8fdb\u7a0b\u65f6\uff0c\u4f1a\u6839\u636e<code>processName</code>\u548c<code>ApplicationInfo</code>\u8bbe\u7f6e\u8fdb\u7a0b\u540d\u79f0\u3002</p>"},{"location":"030Android/020SystemSourceCode/#5-processstart","title":"5. <code>Process.start</code>\u65b9\u6cd5","text":"<p><code>Process.start</code>\u662f\u542f\u52a8\u65b0\u8fdb\u7a0b\u7684\u5173\u952e\u65b9\u6cd5\u3002</p> <p><pre><code>public static final ProcessStartResult start(final String processClass, ...) {\n    ...\n    return zygoteProcess.start(processClass, ...);\n}\n</code></pre> <code>zygoteProcess.start</code>\u901a\u8fc7Zygote\u8fdb\u7a0b\u542f\u52a8\u65b0\u8fdb\u7a0b\uff0c\u5e76\u8bbe\u7f6e\u8fdb\u7a0b\u540d\u79f0\u3002</p>"},{"location":"030Android/020SystemSourceCode/#_16","title":"\u603b\u7ed3","text":"<p>Android\u8fdb\u7a0b\u540d\u79f0\u7684\u6307\u5b9a\u6d89\u53ca\u591a\u4e2a\u6b65\u9aa4\uff1a 1. \u521d\u59cb\u5316\uff1a<code>ActivityThread.main</code>\u901a\u8fc7<code>Process.setArgV0</code>\u8bbe\u7f6e\u521d\u59cb\u540d\u79f0\u3002 2. \u8bbe\u7f6e\uff1a<code>ActivityThread.attach</code>\u901a\u8fc7<code>DdmHandleAppName.setAppName</code>\u8bbe\u7f6eDDMS\u4e2d\u7684\u5e94\u7528\u540d\u79f0\u3002 3. \u542f\u52a8\u65b0\u8fdb\u7a0b\uff1a<code>ActivityManagerService</code>\u548c<code>Process</code>\u7c7b\u5728\u542f\u52a8\u65b0\u8fdb\u7a0b\u65f6\u8bbe\u7f6e\u8fdb\u7a0b\u540d\u79f0\u3002</p> <p>\u8fd9\u4e9b\u6b65\u9aa4\u5171\u540c\u786e\u4fdd\u6bcf\u4e2aAndroid\u8fdb\u7a0b\u62e5\u6709\u6b63\u786e\u7684\u540d\u79f0\u3002</p>"},{"location":"030Android/020SystemSourceCode/#android-binder","title":"Android Binder\u673a\u5236","text":"\u7b54\u6848 <p>https://gityuan.com/2015/10/31/binder-prepare/</p> <p>Android Binder\u673a\u5236\u662fAndroid\u7cfb\u7edf\u4e2d\u7528\u4e8e\u8fdb\u7a0b\u95f4\u901a\u4fe1\uff08IPC\uff09\u7684\u6838\u5fc3\u673a\u5236\u3002\u5b83\u5141\u8bb8\u4e0d\u540c\u8fdb\u7a0b\u4e4b\u95f4\u8fdb\u884c\u9ad8\u6548\u3001\u5b89\u5168\u7684\u901a\u4fe1\uff0c\u662fAndroid\u6846\u67b6\u7684\u91cd\u8981\u7ec4\u6210\u90e8\u5206\u3002\u4ee5\u4e0b\u662f\u5bf9Binder\u673a\u5236\u7684\u8be6\u7ec6\u89e3\u6790\uff1a</p>"},{"location":"030Android/020SystemSourceCode/#1-binder","title":"1. Binder\u673a\u5236\u6982\u8ff0","text":"<p>Binder\u673a\u5236\u57fa\u4e8e\u5ba2\u6237\u7aef-\u670d\u52a1\u5668\u6a21\u578b\uff0c\u5ba2\u6237\u7aef\u8fdb\u7a0b\u901a\u8fc7Binder\u5411\u670d\u52a1\u5668\u8fdb\u7a0b\u53d1\u9001\u8bf7\u6c42\uff0c\u670d\u52a1\u5668\u8fdb\u7a0b\u5904\u7406\u8bf7\u6c42\u5e76\u8fd4\u56de\u7ed3\u679c\u3002Binder\u673a\u5236\u7684\u6838\u5fc3\u662fBinder\u9a71\u52a8\uff0c\u5b83\u8fd0\u884c\u5728\u5185\u6838\u7a7a\u95f4\uff0c\u8d1f\u8d23\u7ba1\u7406\u8fdb\u7a0b\u95f4\u7684\u901a\u4fe1\u3002</p>"},{"location":"030Android/020SystemSourceCode/#2-binder","title":"2. Binder\u673a\u5236\u7684\u4e3b\u8981\u7ec4\u4ef6","text":"<ul> <li>Binder\u9a71\u52a8\uff1a\u4f4d\u4e8e\u5185\u6838\u7a7a\u95f4\uff0c\u8d1f\u8d23\u8fdb\u7a0b\u95f4\u901a\u4fe1\u7684\u5b9e\u9645\u6570\u636e\u4f20\u8f93\u548c\u7ba1\u7406\u3002</li> <li>ServiceManager\uff1a\u4e00\u4e2a\u7279\u6b8a\u7684\u7cfb\u7edf\u670d\u52a1\uff0c\u8d1f\u8d23\u7ba1\u7406\u6240\u6709\u6ce8\u518c\u7684Binder\u670d\u52a1\u3002\u5ba2\u6237\u7aef\u901a\u8fc7ServiceManager\u67e5\u627e\u6240\u9700\u7684Binder\u670d\u52a1\u3002</li> <li>Binder Proxy\uff1a\u5ba2\u6237\u7aef\u4f7f\u7528\u7684\u4ee3\u7406\u5bf9\u8c61\uff0c\u7528\u4e8e\u5411\u670d\u52a1\u5668\u53d1\u9001\u8bf7\u6c42\u3002</li> <li>Binder Stub\uff1a\u670d\u52a1\u5668\u7aef\u7684\u5b9e\u73b0\u5bf9\u8c61\uff0c\u8d1f\u8d23\u5904\u7406\u5ba2\u6237\u7aef\u7684\u8bf7\u6c42\u5e76\u8fd4\u56de\u7ed3\u679c\u3002</li> </ul>"},{"location":"030Android/020SystemSourceCode/#3-binder","title":"3. Binder\u673a\u5236\u7684\u5de5\u4f5c\u6d41\u7a0b","text":"<ol> <li>\u670d\u52a1\u6ce8\u518c\uff1a\u670d\u52a1\u5668\u8fdb\u7a0b\u5c06\u670d\u52a1\u6ce8\u518c\u5230ServiceManager\u4e2d\uff0cServiceManager\u4f1a\u4e3a\u8be5\u670d\u52a1\u5206\u914d\u4e00\u4e2a\u552f\u4e00\u7684\u6807\u8bc6\u7b26\uff08Binder\u5f15\u7528\uff09\u3002</li> <li>\u670d\u52a1\u67e5\u627e\uff1a\u5ba2\u6237\u7aef\u8fdb\u7a0b\u901a\u8fc7ServiceManager\u67e5\u627e\u6240\u9700\u7684\u670d\u52a1\uff0c\u83b7\u53d6\u670d\u52a1\u7684Binder\u5f15\u7528\u3002</li> <li>\u8bf7\u6c42\u53d1\u9001\uff1a\u5ba2\u6237\u7aef\u901a\u8fc7Binder Proxy\u5411\u670d\u52a1\u5668\u53d1\u9001\u8bf7\u6c42\uff0c\u8bf7\u6c42\u6570\u636e\u901a\u8fc7Binder\u9a71\u52a8\u4f20\u9012\u5230\u670d\u52a1\u5668\u8fdb\u7a0b\u3002</li> <li>\u8bf7\u6c42\u5904\u7406\uff1a\u670d\u52a1\u5668\u8fdb\u7a0b\u7684Binder Stub\u63a5\u6536\u5230\u8bf7\u6c42\u540e\uff0c\u8c03\u7528\u76f8\u5e94\u7684\u670d\u52a1\u65b9\u6cd5\u8fdb\u884c\u5904\u7406\u3002</li> <li>\u7ed3\u679c\u8fd4\u56de\uff1a\u670d\u52a1\u5668\u5c06\u5904\u7406\u7ed3\u679c\u901a\u8fc7Binder\u9a71\u52a8\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\u3002</li> </ol>"},{"location":"030Android/020SystemSourceCode/#4-binder","title":"4. Binder\u673a\u5236\u7684\u7279\u70b9","text":"<ul> <li>\u9ad8\u6548\uff1aBinder\u673a\u5236\u4f7f\u7528\u5185\u5b58\u6620\u5c04\uff08mmap\uff09\u6280\u672f\uff0c\u51cf\u5c11\u4e86\u6570\u636e\u62f7\u8d1d\u7684\u6b21\u6570\uff0c\u63d0\u9ad8\u4e86\u901a\u4fe1\u6548\u7387\u3002</li> <li>\u5b89\u5168\uff1aBinder\u673a\u5236\u57fa\u4e8eLinux\u7684UID/GID\u673a\u5236\uff0c\u53ef\u4ee5\u63a7\u5236\u8fdb\u7a0b\u95f4\u7684\u8bbf\u95ee\u6743\u9650\uff0c\u786e\u4fdd\u901a\u4fe1\u7684\u5b89\u5168\u6027\u3002</li> <li>\u8de8\u8fdb\u7a0b\u8c03\u7528\u900f\u660e\uff1aBinder\u673a\u5236\u901a\u8fc7\u4ee3\u7406\u5bf9\u8c61\u548c\u5b58\u6839\u5bf9\u8c61\uff0c\u4f7f\u5f97\u8de8\u8fdb\u7a0b\u8c03\u7528\u5bf9\u5f00\u53d1\u8005\u900f\u660e\uff0c\u5f00\u53d1\u8005\u53ef\u4ee5\u50cf\u8c03\u7528\u672c\u5730\u65b9\u6cd5\u4e00\u6837\u8c03\u7528\u8fdc\u7a0b\u65b9\u6cd5\u3002</li> </ul>"},{"location":"030Android/020SystemSourceCode/#5-binder","title":"5. Binder\u673a\u5236\u7684\u5e94\u7528","text":"<p>Binder\u673a\u5236\u5e7f\u6cdb\u5e94\u7528\u4e8eAndroid\u7cfb\u7edf\u7684\u5404\u4e2a\u7ec4\u4ef6\u4e2d\uff0c\u4f8b\u5982\uff1a - ActivityManagerService\uff1a\u7ba1\u7406Activity\u7684\u751f\u547d\u5468\u671f\u548c\u4efb\u52a1\u6808\u3002 - WindowManagerService\uff1a\u7ba1\u7406\u7a97\u53e3\u7684\u663e\u793a\u548c\u5e03\u5c40\u3002 - PackageManagerService\uff1a\u7ba1\u7406\u5e94\u7528\u7a0b\u5e8f\u7684\u5b89\u88c5\u548c\u5378\u8f7d\u3002</p>"},{"location":"030Android/020SystemSourceCode/#6-binder","title":"6. Binder\u673a\u5236\u7684\u5b9e\u73b0\u7ec6\u8282","text":"<ul> <li>Binder\u9a71\u52a8\uff1aBinder\u9a71\u52a8\u662fBinder\u673a\u5236\u7684\u6838\u5fc3\uff0c\u5b83\u8d1f\u8d23\u7ba1\u7406Binder\u5bf9\u8c61\u7684\u751f\u547d\u5468\u671f\u3001\u6570\u636e\u4f20\u8f93\u548c\u7ebf\u7a0b\u8c03\u5ea6\u3002</li> <li>Binder\u534f\u8bae\uff1aBinder\u534f\u8bae\u5b9a\u4e49\u4e86\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u4e4b\u95f4\u7684\u901a\u4fe1\u683c\u5f0f\uff0c\u5305\u62ec\u547d\u4ee4\u3001\u6570\u636e\u548c\u72b6\u6001\u4fe1\u606f\u3002</li> <li>Binder\u7ebf\u7a0b\u6c60\uff1aBinder\u673a\u5236\u4f7f\u7528\u7ebf\u7a0b\u6c60\u6765\u5904\u7406\u5ba2\u6237\u7aef\u7684\u8bf7\u6c42\uff0c\u786e\u4fdd\u670d\u52a1\u5668\u80fd\u591f\u5e76\u53d1\u5904\u7406\u591a\u4e2a\u8bf7\u6c42\u3002</li> </ul>"},{"location":"030Android/020SystemSourceCode/#7-binder","title":"7. Binder\u673a\u5236\u7684\u4f18\u7f3a\u70b9","text":"<ul> <li>\u4f18\u70b9\uff1a</li> <li>\u9ad8\u6548\uff1a\u51cf\u5c11\u4e86\u6570\u636e\u62f7\u8d1d\uff0c\u63d0\u9ad8\u4e86\u901a\u4fe1\u6548\u7387\u3002</li> <li>\u5b89\u5168\uff1a\u57fa\u4e8eLinux\u7684UID/GID\u673a\u5236\uff0c\u786e\u4fdd\u901a\u4fe1\u7684\u5b89\u5168\u6027\u3002</li> <li>\u900f\u660e\uff1a\u8de8\u8fdb\u7a0b\u8c03\u7528\u5bf9\u5f00\u53d1\u8005\u900f\u660e\uff0c\u7b80\u5316\u4e86\u5f00\u53d1\u96be\u5ea6\u3002</li> <li>\u7f3a\u70b9\uff1a</li> <li>\u590d\u6742\u6027\uff1aBinder\u673a\u5236\u7684\u5b9e\u73b0\u8f83\u4e3a\u590d\u6742\uff0c\u7406\u89e3\u548c\u8c03\u8bd5\u96be\u5ea6\u8f83\u5927\u3002</li> <li>\u6027\u80fd\u74f6\u9888\uff1a\u5728\u9ad8\u5e76\u53d1\u573a\u666f\u4e0b\uff0cBinder\u9a71\u52a8\u53ef\u80fd\u6210\u4e3a\u6027\u80fd\u74f6\u9888\u3002</li> </ul>"},{"location":"030Android/020SystemSourceCode/#_17","title":"\u603b\u7ed3","text":"<p>Android Binder\u673a\u5236\u662fAndroid\u7cfb\u7edf\u4e2d\u7528\u4e8e\u8fdb\u7a0b\u95f4\u901a\u4fe1\u7684\u6838\u5fc3\u673a\u5236\uff0c\u5b83\u57fa\u4e8e\u5ba2\u6237\u7aef-\u670d\u52a1\u5668\u6a21\u578b\uff0c\u901a\u8fc7Binder\u9a71\u52a8\u5b9e\u73b0\u9ad8\u6548\u3001\u5b89\u5168\u7684\u901a\u4fe1\u3002Binder\u673a\u5236\u5e7f\u6cdb\u5e94\u7528\u4e8eAndroid\u7cfb\u7edf\u7684\u5404\u4e2a\u7ec4\u4ef6\u4e2d\uff0c\u662fAndroid\u6846\u67b6\u7684\u91cd\u8981\u7ec4\u6210\u90e8\u5206\u3002\u7406\u89e3Binder\u673a\u5236\u7684\u5de5\u4f5c\u539f\u7406\u548c\u5b9e\u73b0\u7ec6\u8282\uff0c\u5bf9\u4e8e\u6df1\u5165\u7406\u89e3Android\u7cfb\u7edf\u548c\u5f00\u53d1\u9ad8\u6027\u80fd\u7684Android\u5e94\u7528\u5177\u6709\u91cd\u8981\u610f\u4e49\u3002</p>"},{"location":"030Android/020SystemSourceCode/#android-ams","title":"Android AMS\u673a\u5236","text":"\u7b54\u6848 <p>Android AMS\uff08Activity Manager Service\uff09\u662fAndroid\u7cfb\u7edf\u4e2d\u8d1f\u8d23\u7ba1\u7406Activity\u3001Service\u3001Application\u7b49\u7ec4\u4ef6\u751f\u547d\u5468\u671f\u7684\u6838\u5fc3\u670d\u52a1\u3002AMS\u673a\u5236\u662fAndroid\u6846\u67b6\u7684\u91cd\u8981\u7ec4\u6210\u90e8\u5206\uff0c\u8d1f\u8d23\u5e94\u7528\u7a0b\u5e8f\u7684\u542f\u52a8\u3001\u5207\u6362\u3001\u9500\u6bc1\u7b49\u64cd\u4f5c\u3002</p>"},{"location":"030Android/020SystemSourceCode/#1-ams","title":"1. AMS\u7684\u4e3b\u8981\u529f\u80fd","text":"<p>AMS\u7684\u4e3b\u8981\u529f\u80fd\u5305\u62ec\uff1a - Activity\u7ba1\u7406\uff1a\u8d1f\u8d23Activity\u7684\u542f\u52a8\u3001\u5207\u6362\u3001\u9500\u6bc1\u7b49\u64cd\u4f5c\u3002 - Service\u7ba1\u7406\uff1a\u8d1f\u8d23Service\u7684\u542f\u52a8\u3001\u7ed1\u5b9a\u3001\u9500\u6bc1\u7b49\u64cd\u4f5c\u3002 - Application\u7ba1\u7406\uff1a\u8d1f\u8d23\u5e94\u7528\u7a0b\u5e8f\u7684\u542f\u52a8\u3001\u9000\u51fa\u7b49\u64cd\u4f5c\u3002 - \u8fdb\u7a0b\u7ba1\u7406\uff1a\u8d1f\u8d23\u8fdb\u7a0b\u7684\u521b\u5efa\u3001\u9500\u6bc1\u3001\u4f18\u5148\u7ea7\u8c03\u6574\u7b49\u64cd\u4f5c\u3002 - \u4efb\u52a1\u6808\u7ba1\u7406\uff1a\u8d1f\u8d23\u7ba1\u7406Activity\u7684\u4efb\u52a1\u6808\uff08Task Stack\uff09\uff0c\u786e\u4fddActivity\u6309\u7167\u6b63\u786e\u7684\u987a\u5e8f\u663e\u793a\u3002</p>"},{"location":"030Android/020SystemSourceCode/#2-ams","title":"2. AMS\u7684\u5de5\u4f5c\u673a\u5236","text":"<p>AMS\u7684\u5de5\u4f5c\u673a\u5236\u4e3b\u8981\u6d89\u53ca\u4ee5\u4e0b\u51e0\u4e2a\u65b9\u9762\uff1a</p>"},{"location":"030Android/020SystemSourceCode/#21-activity","title":"2.1 Activity\u7684\u542f\u52a8\u6d41\u7a0b","text":"<p>\u5f53\u7528\u6237\u70b9\u51fb\u4e00\u4e2a\u5e94\u7528\u56fe\u6807\u6216\u901a\u8fc7Intent\u542f\u52a8\u4e00\u4e2aActivity\u65f6\uff0cAMS\u4f1a\u8d1f\u8d23\u5904\u7406\u8fd9\u4e2a\u8bf7\u6c42\u3002\u5177\u4f53\u6d41\u7a0b\u5982\u4e0b\uff1a 1. Launcher\u53d1\u8d77\u8bf7\u6c42\uff1aLauncher\uff08\u684c\u9762\u5e94\u7528\uff09\u901a\u8fc7<code>startActivity</code>\u65b9\u6cd5\u53d1\u8d77\u542f\u52a8Activity\u7684\u8bf7\u6c42\u3002 2. AMS\u5904\u7406\u8bf7\u6c42\uff1aAMS\u63a5\u6536\u5230\u8bf7\u6c42\u540e\uff0c\u4f1a\u68c0\u67e5\u76ee\u6807Activity\u7684\u6743\u9650\u3001\u542f\u52a8\u6a21\u5f0f\u7b49\u4fe1\u606f\u3002 3. \u521b\u5efa\u8fdb\u7a0b\uff08\u5982\u679c\u9700\u8981\uff09\uff1a\u5982\u679c\u76ee\u6807Activity\u6240\u5728\u7684\u5e94\u7528\u7a0b\u5e8f\u8fdb\u7a0b\u5c1a\u672a\u542f\u52a8\uff0cAMS\u4f1a\u901a\u8fc7Zygote\u8fdb\u7a0b\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u5e94\u7528\u8fdb\u7a0b\u3002 4. \u542f\u52a8Activity\uff1aAMS\u901a\u8fc7Binder\u673a\u5236\u4e0e\u76ee\u6807\u5e94\u7528\u7a0b\u5e8f\u8fdb\u7a0b\u901a\u4fe1\uff0c\u901a\u77e5\u5176\u542f\u52a8\u76ee\u6807Activity\u3002 5. Activity\u751f\u547d\u5468\u671f\u56de\u8c03\uff1a\u76ee\u6807Activity\u7684<code>onCreate</code>\u3001<code>onStart</code>\u3001<code>onResume</code>\u7b49\u65b9\u6cd5\u4f1a\u88ab\u4f9d\u6b21\u8c03\u7528\uff0c\u5b8c\u6210Activity\u7684\u542f\u52a8\u3002</p>"},{"location":"030Android/020SystemSourceCode/#22-service","title":"2.2 Service\u7684\u542f\u52a8\u6d41\u7a0b","text":"<p>Service\u7684\u542f\u52a8\u6d41\u7a0b\u4e0eActivity\u7c7b\u4f3c\uff0cAMS\u8d1f\u8d23\u5904\u7406Service\u7684\u542f\u52a8\u3001\u7ed1\u5b9a\u7b49\u64cd\u4f5c\u3002\u5177\u4f53\u6d41\u7a0b\u5982\u4e0b\uff1a 1. \u53d1\u8d77\u8bf7\u6c42\uff1a\u901a\u8fc7<code>startService</code>\u6216<code>bindService</code>\u65b9\u6cd5\u53d1\u8d77\u542f\u52a8\u6216\u7ed1\u5b9aService\u7684\u8bf7\u6c42\u3002 2. AMS\u5904\u7406\u8bf7\u6c42\uff1aAMS\u63a5\u6536\u5230\u8bf7\u6c42\u540e\uff0c\u4f1a\u68c0\u67e5\u76ee\u6807Service\u7684\u6743\u9650\u7b49\u4fe1\u606f\u3002 3. \u521b\u5efa\u8fdb\u7a0b\uff08\u5982\u679c\u9700\u8981\uff09\uff1a\u5982\u679c\u76ee\u6807Service\u6240\u5728\u7684\u5e94\u7528\u7a0b\u5e8f\u8fdb\u7a0b\u5c1a\u672a\u542f\u52a8\uff0cAMS\u4f1a\u901a\u8fc7Zygote\u8fdb\u7a0b\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u5e94\u7528\u8fdb\u7a0b\u3002 4. \u542f\u52a8Service\uff1aAMS\u901a\u8fc7Binder\u673a\u5236\u4e0e\u76ee\u6807\u5e94\u7528\u7a0b\u5e8f\u8fdb\u7a0b\u901a\u4fe1\uff0c\u901a\u77e5\u5176\u542f\u52a8\u76ee\u6807Service\u3002 5. Service\u751f\u547d\u5468\u671f\u56de\u8c03\uff1a\u76ee\u6807Service\u7684<code>onCreate</code>\u3001<code>onStartCommand</code>\u7b49\u65b9\u6cd5\u4f1a\u88ab\u4f9d\u6b21\u8c03\u7528\uff0c\u5b8c\u6210Service\u7684\u542f\u52a8\u3002</p>"},{"location":"030Android/020SystemSourceCode/#23","title":"2.3 \u8fdb\u7a0b\u7ba1\u7406","text":"<p>AMS\u8d1f\u8d23\u7ba1\u7406\u5e94\u7528\u7a0b\u5e8f\u8fdb\u7a0b\u7684\u751f\u547d\u5468\u671f\uff0c\u5305\u62ec\u8fdb\u7a0b\u7684\u521b\u5efa\u3001\u9500\u6bc1\u3001\u4f18\u5148\u7ea7\u8c03\u6574\u7b49\u3002AMS\u4f1a\u6839\u636e\u5e94\u7528\u7a0b\u5e8f\u7684\u72b6\u6001\uff08\u5982\u524d\u53f0\u3001\u540e\u53f0\uff09\u52a8\u6001\u8c03\u6574\u8fdb\u7a0b\u7684\u4f18\u5148\u7ea7\uff0c\u4ee5\u786e\u4fdd\u7cfb\u7edf\u8d44\u6e90\u7684\u5408\u7406\u5206\u914d\u3002</p>"},{"location":"030Android/020SystemSourceCode/#24_1","title":"2.4 \u4efb\u52a1\u6808\u7ba1\u7406","text":"<p>AMS\u901a\u8fc7\u4efb\u52a1\u6808\uff08Task Stack\uff09\u6765\u7ba1\u7406Activity\u7684\u663e\u793a\u987a\u5e8f\u3002\u6bcf\u4e2a\u4efb\u52a1\u6808\u5305\u542b\u4e00\u7ec4\u76f8\u5173\u7684Activity\uff0c\u7528\u6237\u53ef\u4ee5\u901a\u8fc7\u8fd4\u56de\u952e\u4f9d\u6b21\u56de\u9000\u5230\u4e4b\u524d\u7684Activity\u3002AMS\u4f1a\u6839\u636eActivity\u7684\u542f\u52a8\u6a21\u5f0f\uff08\u5982<code>standard</code>\u3001<code>singleTop</code>\u3001<code>singleTask</code>\u3001<code>singleInstance</code>\uff09\u6765\u51b3\u5b9a\u5982\u4f55\u7ba1\u7406\u4efb\u52a1\u6808\u3002</p>"},{"location":"030Android/020SystemSourceCode/#3-ams","title":"3. AMS\u7684\u542f\u52a8\u6a21\u5f0f","text":"<p>AMS\u652f\u6301\u591a\u79cdActivity\u542f\u52a8\u6a21\u5f0f\uff0c\u4e3b\u8981\u5305\u62ec\uff1a - standard\uff1a\u9ed8\u8ba4\u6a21\u5f0f\uff0c\u6bcf\u6b21\u542f\u52a8\u90fd\u4f1a\u521b\u5efa\u4e00\u4e2a\u65b0\u7684Activity\u5b9e\u4f8b\u3002 - singleTop\uff1a\u5982\u679c\u76ee\u6807Activity\u5df2\u7ecf\u4f4d\u4e8e\u4efb\u52a1\u6808\u7684\u9876\u90e8\uff0c\u5219\u4e0d\u4f1a\u521b\u5efa\u65b0\u7684\u5b9e\u4f8b\uff0c\u800c\u662f\u590d\u7528\u73b0\u6709\u7684\u5b9e\u4f8b\u3002 - singleTask\uff1a\u5982\u679c\u76ee\u6807Activity\u5df2\u7ecf\u5b58\u5728\u4e8e\u4efb\u52a1\u6808\u4e2d\uff0c\u5219\u4e0d\u4f1a\u521b\u5efa\u65b0\u7684\u5b9e\u4f8b\uff0c\u800c\u662f\u5c06\u4efb\u52a1\u6808\u4e2d\u8be5Activity\u4e4b\u4e0a\u7684\u6240\u6709Activity\u9500\u6bc1\uff0c\u4f7f\u5176\u6210\u4e3a\u6808\u9876\u3002 - singleInstance\uff1a\u76ee\u6807Activity\u4f1a\u5355\u72ec\u5b58\u5728\u4e8e\u4e00\u4e2a\u4efb\u52a1\u6808\u4e2d\uff0c\u4e14\u8be5\u4efb\u52a1\u6808\u4e2d\u53ea\u80fd\u6709\u4e00\u4e2aActivity\u3002</p>"},{"location":"030Android/020SystemSourceCode/#4-amsbinder","title":"4. AMS\u4e0eBinder\u673a\u5236","text":"<p>AMS\u901a\u8fc7Binder\u673a\u5236\u4e0e\u5e94\u7528\u7a0b\u5e8f\u8fdb\u7a0b\u8fdb\u884c\u901a\u4fe1\u3002Binder\u662fAndroid\u4e2d\u7684\u4e00\u79cd\u8de8\u8fdb\u7a0b\u901a\u4fe1\uff08IPC\uff09\u673a\u5236\uff0cAMS\u4f5c\u4e3a\u7cfb\u7edf\u670d\u52a1\u8fd0\u884c\u5728\u7cfb\u7edf\u8fdb\u7a0b\u4e2d\uff0c\u800c\u5e94\u7528\u7a0b\u5e8f\u8fd0\u884c\u5728\u72ec\u7acb\u7684\u8fdb\u7a0b\u4e2d\u3002AMS\u901a\u8fc7Binder\u4e0e\u5e94\u7528\u7a0b\u5e8f\u8fdb\u7a0b\u901a\u4fe1\uff0c\u53d1\u9001\u542f\u52a8\u3001\u9500\u6bc1\u7b49\u6307\u4ee4\u3002</p>"},{"location":"030Android/020SystemSourceCode/#5-ams","title":"5. AMS\u7684\u4f18\u5316\u4e0e\u9650\u5236","text":"<p>AMS\u5728Android\u7cfb\u7edf\u4e2d\u626e\u6f14\u7740\u91cd\u8981\u89d2\u8272\uff0c\u4f46\u4e5f\u5b58\u5728\u4e00\u4e9b\u6027\u80fd\u74f6\u9888\u548c\u9650\u5236\u3002\u4f8b\u5982\uff0cAMS\u9700\u8981\u5904\u7406\u5927\u91cf\u7684\u8de8\u8fdb\u7a0b\u901a\u4fe1\uff0c\u8fd9\u53ef\u80fd\u4f1a\u5bfc\u81f4\u7cfb\u7edf\u6027\u80fd\u4e0b\u964d\u3002\u4e3a\u4e86\u4f18\u5316AMS\u7684\u6027\u80fd\uff0cAndroid\u7cfb\u7edf\u5f15\u5165\u4e86\u4ee5\u4e0b\u673a\u5236\uff1a - \u8fdb\u7a0b\u4f18\u5148\u7ea7\u7ba1\u7406\uff1aAMS\u4f1a\u6839\u636e\u5e94\u7528\u7a0b\u5e8f\u7684\u72b6\u6001\u52a8\u6001\u8c03\u6574\u8fdb\u7a0b\u7684\u4f18\u5148\u7ea7\uff0c\u786e\u4fdd\u524d\u53f0\u5e94\u7528\u7684\u54cd\u5e94\u901f\u5ea6\u3002 - \u4efb\u52a1\u6808\u4f18\u5316\uff1aAMS\u4f1a\u5bf9\u4efb\u52a1\u6808\u8fdb\u884c\u4f18\u5316\uff0c\u51cf\u5c11\u4e0d\u5fc5\u8981\u7684Activity\u5b9e\u4f8b\uff0c\u964d\u4f4e\u5185\u5b58\u5360\u7528\u3002</p>"},{"location":"030Android/020SystemSourceCode/#6_3","title":"6. \u603b\u7ed3","text":"<p>AMS\u662fAndroid\u7cfb\u7edf\u4e2d\u8d1f\u8d23\u7ba1\u7406Activity\u3001Service\u3001Application\u7b49\u7ec4\u4ef6\u751f\u547d\u5468\u671f\u7684\u6838\u5fc3\u670d\u52a1\u3002\u5b83\u901a\u8fc7Binder\u673a\u5236\u4e0e\u5e94\u7528\u7a0b\u5e8f\u8fdb\u7a0b\u901a\u4fe1\uff0c\u5904\u7406\u7ec4\u4ef6\u7684\u542f\u52a8\u3001\u5207\u6362\u3001\u9500\u6bc1\u7b49\u64cd\u4f5c\u3002AMS\u8fd8\u8d1f\u8d23\u8fdb\u7a0b\u7ba1\u7406\u3001\u4efb\u52a1\u6808\u7ba1\u7406\u7b49\u529f\u80fd\uff0c\u786e\u4fdd\u7cfb\u7edf\u8d44\u6e90\u7684\u5408\u7406\u5206\u914d\u548c\u5e94\u7528\u7a0b\u5e8f\u7684\u6b63\u5e38\u8fd0\u884c\u3002\u7406\u89e3AMS\u7684\u673a\u5236\u5bf9\u4e8e\u5f00\u53d1\u9ad8\u6027\u80fd\u3001\u7a33\u5b9a\u7684Android\u5e94\u7528\u81f3\u5173\u91cd\u8981\u3002</p>"},{"location":"030Android/020SystemSourceCode/#android_2","title":"\u4f60\u77e5\u9053\u54ea\u4e9bAndroid\u7cfb\u7edf\u6e90\u7801\u7684\u8bbe\u8ba1\u6a21\u5f0f\uff1f","text":"\u7b54\u6848 <p>\u5728Android\u7cfb\u7edf\u6e90\u7801\u4e2d\uff0c\u8bbe\u8ba1\u6a21\u5f0f\u88ab\u5e7f\u6cdb\u7528\u4e8e\u89e3\u51b3\u5e38\u89c1\u95ee\u9898\u5e76\u63d0\u5347\u4ee3\u7801\u7684\u53ef\u7ef4\u62a4\u6027\u548c\u6269\u5c55\u6027\u3002\u4ee5\u4e0b\u662f\u4e00\u4e9b\u5e38\u7528\u7684\u8bbe\u8ba1\u6a21\u5f0f\u53ca\u5176\u5e94\u7528\u573a\u666f\uff1a</p>"},{"location":"030Android/020SystemSourceCode/#1-singleton","title":"1. \u5355\u4f8b\u6a21\u5f0f\uff08Singleton\uff09","text":"<ul> <li>\u5e94\u7528\u573a\u666f\uff1a\u786e\u4fdd\u4e00\u4e2a\u7c7b\u53ea\u6709\u4e00\u4e2a\u5b9e\u4f8b\uff0c\u5e76\u63d0\u4f9b\u5168\u5c40\u8bbf\u95ee\u70b9\u3002</li> <li>\u793a\u4f8b\uff1a<code>LayoutInflater</code>\u3001<code>InputMethodManager</code>\u7b49\u7cfb\u7edf\u670d\u52a1\u901a\u5e38\u901a\u8fc7\u5355\u4f8b\u6a21\u5f0f\u63d0\u4f9b\u3002</li> </ul>"},{"location":"030Android/020SystemSourceCode/#2-factory","title":"2. \u5de5\u5382\u6a21\u5f0f\uff08Factory\uff09","text":"<ul> <li>\u5e94\u7528\u573a\u666f\uff1a\u521b\u5efa\u5bf9\u8c61\u65f6\u9690\u85cf\u5177\u4f53\u5b9e\u73b0\uff0c\u63d0\u4f9b\u7edf\u4e00\u7684\u63a5\u53e3\u3002</li> <li>\u793a\u4f8b\uff1a<code>BitmapFactory</code>\u7528\u4e8e\u521b\u5efa<code>Bitmap</code>\u5bf9\u8c61\u3002</li> </ul>"},{"location":"030Android/020SystemSourceCode/#3-observer","title":"3. \u89c2\u5bdf\u8005\u6a21\u5f0f\uff08Observer\uff09","text":"<ul> <li>\u5e94\u7528\u573a\u666f\uff1a\u5b9a\u4e49\u5bf9\u8c61\u95f4\u7684\u4e00\u5bf9\u591a\u4f9d\u8d56\u5173\u7cfb\uff0c\u5f53\u4e00\u4e2a\u5bf9\u8c61\u72b6\u6001\u6539\u53d8\u65f6\uff0c\u6240\u6709\u4f9d\u8d56\u5bf9\u8c61\u90fd\u4f1a\u6536\u5230\u901a\u77e5\u3002</li> <li>\u793a\u4f8b\uff1a<code>LiveData</code>\u3001<code>View</code>\u4e0e<code>ViewTreeObserver</code>\u7684\u4ea4\u4e92\u3002</li> </ul>"},{"location":"030Android/020SystemSourceCode/#4-adapter","title":"4. \u9002\u914d\u5668\u6a21\u5f0f\uff08Adapter\uff09","text":"<ul> <li>\u5e94\u7528\u573a\u666f\uff1a\u5c06\u4e00\u4e2a\u7c7b\u7684\u63a5\u53e3\u8f6c\u6362\u6210\u5ba2\u6237\u7aef\u671f\u671b\u7684\u53e6\u4e00\u4e2a\u63a5\u53e3\u3002</li> <li>\u793a\u4f8b\uff1a<code>RecyclerView.Adapter</code>\u7528\u4e8e\u5c06\u6570\u636e\u9002\u914d\u5230<code>RecyclerView</code>\u4e2d\u3002</li> </ul>"},{"location":"030Android/020SystemSourceCode/#5-decorator","title":"5. \u88c5\u9970\u8005\u6a21\u5f0f\uff08Decorator\uff09","text":"<ul> <li>\u5e94\u7528\u573a\u666f\uff1a\u52a8\u6001\u5730\u4e3a\u5bf9\u8c61\u6dfb\u52a0\u529f\u80fd\uff0c\u907f\u514d\u901a\u8fc7\u5b50\u7c7b\u6269\u5c55\u3002</li> <li>\u793a\u4f8b\uff1a<code>ContextWrapper</code>\u662f\u5bf9<code>Context</code>\u7684\u88c5\u9970\uff0c\u5141\u8bb8\u5728\u4e0d\u4fee\u6539\u539f\u59cb\u7c7b\u7684\u60c5\u51b5\u4e0b\u6269\u5c55\u529f\u80fd\u3002</li> </ul>"},{"location":"030Android/020SystemSourceCode/#6-strategy","title":"6. \u7b56\u7565\u6a21\u5f0f\uff08Strategy\uff09","text":"<ul> <li>\u5e94\u7528\u573a\u666f\uff1a\u5b9a\u4e49\u4e00\u7cfb\u5217\u7b97\u6cd5\uff0c\u5c01\u88c5\u6bcf\u4e2a\u7b97\u6cd5\uff0c\u5e76\u4f7f\u5b83\u4eec\u53ef\u4ee5\u4e92\u6362\u3002</li> <li>\u793a\u4f8b\uff1a<code>Animation</code>\u4e2d\u7684\u63d2\u503c\u5668\uff08Interpolator\uff09\u5141\u8bb8\u52a8\u6001\u6539\u53d8\u52a8\u753b\u7684\u884c\u4e3a\u3002</li> </ul>"},{"location":"030Android/020SystemSourceCode/#7-template-method","title":"7. \u6a21\u677f\u65b9\u6cd5\u6a21\u5f0f\uff08Template Method\uff09","text":"<ul> <li>\u5e94\u7528\u573a\u666f\uff1a\u5b9a\u4e49\u4e00\u4e2a\u7b97\u6cd5\u7684\u6846\u67b6\uff0c\u5141\u8bb8\u5b50\u7c7b\u5728\u4e0d\u6539\u53d8\u7ed3\u6784\u7684\u60c5\u51b5\u4e0b\u91cd\u5199\u67d0\u4e9b\u6b65\u9aa4\u3002</li> <li>\u793a\u4f8b\uff1a<code>AsyncTask</code>\u4e2d\u7684<code>doInBackground</code>\u3001<code>onPostExecute</code>\u7b49\u65b9\u6cd5\u3002</li> </ul>"},{"location":"030Android/020SystemSourceCode/#8-builder","title":"8. \u5efa\u9020\u8005\u6a21\u5f0f\uff08Builder\uff09","text":"<ul> <li>\u5e94\u7528\u573a\u666f\uff1a\u5c06\u4e00\u4e2a\u590d\u6742\u5bf9\u8c61\u7684\u6784\u5efa\u4e0e\u5176\u8868\u793a\u5206\u79bb\uff0c\u4f7f\u5f97\u540c\u6837\u7684\u6784\u5efa\u8fc7\u7a0b\u53ef\u4ee5\u521b\u5efa\u4e0d\u540c\u7684\u8868\u793a\u3002</li> <li>\u793a\u4f8b\uff1a<code>AlertDialog.Builder</code>\u7528\u4e8e\u6784\u5efa<code>AlertDialog</code>\u3002</li> </ul>"},{"location":"030Android/020SystemSourceCode/#9-proxy","title":"9. \u4ee3\u7406\u6a21\u5f0f\uff08Proxy\uff09","text":"<ul> <li>\u5e94\u7528\u573a\u666f\uff1a\u4e3a\u5176\u4ed6\u5bf9\u8c61\u63d0\u4f9b\u4e00\u79cd\u4ee3\u7406\u4ee5\u63a7\u5236\u5bf9\u8fd9\u4e2a\u5bf9\u8c61\u7684\u8bbf\u95ee\u3002</li> <li>\u793a\u4f8b\uff1a<code>Binder</code>\u673a\u5236\u4e2d\u7684\u4ee3\u7406\u5bf9\u8c61\u7528\u4e8e\u8de8\u8fdb\u7a0b\u901a\u4fe1\u3002</li> </ul>"},{"location":"030Android/020SystemSourceCode/#10-composite","title":"10. \u7ec4\u5408\u6a21\u5f0f\uff08Composite\uff09","text":"<ul> <li>\u5e94\u7528\u573a\u666f\uff1a\u5c06\u5bf9\u8c61\u7ec4\u5408\u6210\u6811\u5f62\u7ed3\u6784\u4ee5\u8868\u793a\u201c\u90e8\u5206-\u6574\u4f53\u201d\u7684\u5c42\u6b21\u7ed3\u6784\u3002</li> <li>\u793a\u4f8b\uff1a<code>View</code>\u548c<code>ViewGroup</code>\u7684\u5c42\u6b21\u7ed3\u6784\u3002</li> </ul>"},{"location":"030Android/020SystemSourceCode/#11-command","title":"11. \u547d\u4ee4\u6a21\u5f0f\uff08Command\uff09","text":"<ul> <li>\u5e94\u7528\u573a\u666f\uff1a\u5c06\u8bf7\u6c42\u5c01\u88c5\u4e3a\u5bf9\u8c61\uff0c\u4f7f\u5f97\u53ef\u4ee5\u7528\u4e0d\u540c\u7684\u8bf7\u6c42\u5bf9\u5ba2\u6237\u8fdb\u884c\u53c2\u6570\u5316\u3002</li> <li>\u793a\u4f8b\uff1a<code>Runnable</code>\u548c<code>Handler</code>\u7528\u4e8e\u5c01\u88c5\u548c\u6267\u884c\u4efb\u52a1\u3002</li> </ul>"},{"location":"030Android/020SystemSourceCode/#12-state","title":"12. \u72b6\u6001\u6a21\u5f0f\uff08State\uff09","text":"<ul> <li>\u5e94\u7528\u573a\u666f\uff1a\u5141\u8bb8\u5bf9\u8c61\u5728\u5176\u5185\u90e8\u72b6\u6001\u6539\u53d8\u65f6\u6539\u53d8\u5176\u884c\u4e3a\u3002</li> <li>\u793a\u4f8b\uff1a<code>View</code>\u7684\u72b6\u6001\u7ba1\u7406\uff08\u5982<code>View.Visibility</code>\uff09\u3002</li> </ul>"},{"location":"030Android/020SystemSourceCode/#13-memento","title":"13. \u5907\u5fd8\u5f55\u6a21\u5f0f\uff08Memento\uff09","text":"<ul> <li>\u5e94\u7528\u573a\u666f\uff1a\u5728\u4e0d\u7834\u574f\u5c01\u88c5\u6027\u7684\u524d\u63d0\u4e0b\uff0c\u6355\u83b7\u5e76\u5916\u90e8\u5316\u4e00\u4e2a\u5bf9\u8c61\u7684\u5185\u90e8\u72b6\u6001\u3002</li> <li>\u793a\u4f8b\uff1a<code>Activity</code>\u7684\u72b6\u6001\u4fdd\u5b58\u4e0e\u6062\u590d\uff08<code>onSaveInstanceState</code>\u548c<code>onRestoreInstanceState</code>\uff09\u3002</li> </ul>"},{"location":"030Android/020SystemSourceCode/#14-iterator","title":"14. \u8fed\u4ee3\u5668\u6a21\u5f0f\uff08Iterator\uff09","text":"<ul> <li>\u5e94\u7528\u573a\u666f\uff1a\u63d0\u4f9b\u4e00\u79cd\u65b9\u6cd5\u987a\u5e8f\u8bbf\u95ee\u4e00\u4e2a\u805a\u5408\u5bf9\u8c61\u4e2d\u7684\u5404\u4e2a\u5143\u7d20\uff0c\u800c\u53c8\u4e0d\u66b4\u9732\u5176\u5185\u90e8\u8868\u793a\u3002</li> <li>\u793a\u4f8b\uff1a<code>Cursor</code>\u7528\u4e8e\u904d\u5386\u6570\u636e\u5e93\u67e5\u8be2\u7ed3\u679c\u3002</li> </ul>"},{"location":"030Android/020SystemSourceCode/#15-facade","title":"15. \u5916\u89c2\u6a21\u5f0f\uff08Facade\uff09","text":"<ul> <li>\u5e94\u7528\u573a\u666f\uff1a\u4e3a\u5b50\u7cfb\u7edf\u4e2d\u7684\u4e00\u7ec4\u63a5\u53e3\u63d0\u4f9b\u4e00\u4e2a\u7edf\u4e00\u7684\u63a5\u53e3\u3002</li> <li>\u793a\u4f8b\uff1a<code>Context</code>\u5c01\u88c5\u4e86\u8bbf\u95ee\u7cfb\u7edf\u8d44\u6e90\u7684\u63a5\u53e3\u3002</li> </ul> <p>\u8fd9\u4e9b\u8bbe\u8ba1\u6a21\u5f0f\u5728Android\u6e90\u7801\u4e2d\u5e7f\u6cdb\u5e94\u7528\uff0c\u5e2e\u52a9\u5f00\u53d1\u8005\u6784\u5efa\u7075\u6d3b\u3001\u53ef\u7ef4\u62a4\u7684\u7cfb\u7edf\u67b6\u6784\u3002</p>"},{"location":"030Android/020SystemSourceCode/#android-bitmap","title":"Android bitmap\u662f\u4ec0\u4e48\uff1f\u6709\u4ec0\u4e48\u7279\u70b9\uff1f","text":"<pre><code>??? answer \"\u7b54\u6848\"\n\u5728Android\u5f00\u53d1\u4e2d\uff0c`Bitmap` \u662f\u4e00\u4e2a\u7528\u4e8e\u8868\u793a\u56fe\u50cf\u6570\u636e\u7684\u7c7b\uff0c\u901a\u5e38\u7528\u4e8e\u5904\u7406\u548c\u663e\u793a\u56fe\u50cf\u3002\u4ee5\u4e0b\u662f\u5b83\u7684\u4e3b\u8981\u7279\u70b9\uff1a\n\n### 1. **\u56fe\u50cf\u8868\u793a**\n- `Bitmap` \u7528\u4e8e\u5b58\u50a8\u548c\u64cd\u4f5c\u50cf\u7d20\u6570\u636e\uff0c\u652f\u6301\u591a\u79cd\u683c\u5f0f\u5982PNG\u3001JPEG\u7b49\u3002\n\n### 2. **\u5185\u5b58\u5360\u7528**\n- `Bitmap` \u76f4\u63a5\u5b58\u50a8\u50cf\u7d20\u6570\u636e\uff0c\u5185\u5b58\u6d88\u8017\u8f83\u5927\uff0c\u5c24\u5176\u662f\u9ad8\u5206\u8fa8\u7387\u56fe\u50cf\uff0c\u5bb9\u6613\u5bfc\u81f4\u5185\u5b58\u6ea2\u51fa\uff08OOM\uff09\u3002\n\n### 3. **\u53ef\u53d8\u6027**\n- \u53ef\u4ee5\u662f\u53ef\u53d8\u7684\uff08`mutable`\uff09\u6216\u4e0d\u53ef\u53d8\u7684\uff08`immutable`\uff09\u3002\u53ef\u53d8 `Bitmap` \u5141\u8bb8\u4fee\u6539\u50cf\u7d20\u6570\u636e\uff0c\u800c\u4e0d\u53ef\u53d8 `Bitmap` \u5219\u4e0d\u80fd\u3002\n\n### 4. **\u56fe\u50cf\u5904\u7406**\n- \u652f\u6301\u7f29\u653e\u3001\u88c1\u526a\u3001\u65cb\u8f6c\u7b49\u64cd\u4f5c\uff0c\u9002\u5408\u5728UI\u4e2d\u663e\u793a\u548c\u5904\u7406\u56fe\u50cf\u3002\n\n### 5. **\u786c\u4ef6\u52a0\u901f**\n- \u90e8\u5206\u64cd\u4f5c\u53ef\u5229\u7528\u786c\u4ef6\u52a0\u901f\u63d0\u5347\u6027\u80fd\uff0c\u4f46\u5e76\u975e\u6240\u6709\u64cd\u4f5c\u90fd\u652f\u6301\u3002\n\n### 6. **\u56de\u6536\u673a\u5236**\n- \u4f7f\u7528 `recycle()` \u65b9\u6cd5\u53ef\u624b\u52a8\u91ca\u653e\u5185\u5b58\uff0c\u907f\u514d\u5185\u5b58\u6cc4\u6f0f\u3002\n\n### 7. **\u7f13\u5b58**\n- \u5e38\u7528 `Bitmap` \u53ef\u901a\u8fc7 `LruCache` \u6216 `DiskLruCache` \u8fdb\u884c\u7f13\u5b58\uff0c\u63d0\u5347\u52a0\u8f7d\u6548\u7387\u3002\n\n### 8. **\u914d\u7f6e\u9009\u9879**\n- \u901a\u8fc7 `BitmapFactory.Options` \u53ef\u63a7\u5236\u56fe\u50cf\u89e3\u7801\u65b9\u5f0f\uff0c\u5982\u91c7\u6837\u7387\u3001\u989c\u8272\u6a21\u5f0f\u7b49\u3002\n\n### 9. **\u7ebf\u7a0b\u5b89\u5168**\n- `Bitmap` \u672c\u8eab\u975e\u7ebf\u7a0b\u5b89\u5168\uff0c\u591a\u7ebf\u7a0b\u64cd\u4f5c\u65f6\u9700\u81ea\u884c\u540c\u6b65\u3002\n\n### 10. **API\u652f\u6301**\n- \u63d0\u4f9b\u4e30\u5bcc\u7684API\uff0c\u5982 `createBitmap()`\u3001`copy()` \u7b49\uff0c\u4fbf\u4e8e\u56fe\u50cf\u64cd\u4f5c\u3002\n\n### \u793a\u4f8b\u4ee3\u7801\n```java\n// \u4ece\u8d44\u6e90\u52a0\u8f7dBitmap\nBitmap bitmap = BitmapFactory.decodeResource(getResources(), R.drawable.image);\n\n// \u7f29\u653eBitmap\nBitmap scaledBitmap = Bitmap.createScaledBitmap(bitmap, newWidth, newHeight, true);\n\n// \u56de\u6536Bitmap\nbitmap.recycle();\n```\n\n### \u603b\u7ed3\n`Bitmap` \u662fAndroid\u4e2d\u5904\u7406\u56fe\u50cf\u7684\u6838\u5fc3\u7c7b\uff0c\u529f\u80fd\u5f3a\u5927\u4f46\u9700\u6ce8\u610f\u5185\u5b58\u7ba1\u7406\uff0c\u907f\u514dOOM\u95ee\u9898\u3002\n</code></pre>"},{"location":"030Android/020SystemSourceCode/#android_3","title":"Android\u5982\u4f55\u5b89\u5168\u52a0\u8f7d\u5927\u56fe\u7247\uff1f","text":"\u7b54\u6848 <p>\u5728Android\u4e2d\u52a0\u8f7d\u5927\u56fe\u7247\u65f6\uff0c\u76f4\u63a5\u52a0\u8f7d\u53ef\u80fd\u5bfc\u81f4\u5185\u5b58\u6ea2\u51fa\uff08OOM\uff09\u3002\u4ee5\u4e0b\u662f\u5b89\u5168\u52a0\u8f7d\u5927\u56fe\u7247\u7684\u51e0\u79cd\u65b9\u6cd5\uff1a</p>"},{"location":"030Android/020SystemSourceCode/#1-bitmapfactoryoptions","title":"1. \u4f7f\u7528 <code>BitmapFactory.Options</code> \u8fdb\u884c\u91c7\u6837","text":"<p>\u901a\u8fc7\u8bbe\u7f6e <code>inSampleSize</code> \u6765\u964d\u4f4e\u56fe\u50cf\u5206\u8fa8\u7387\uff0c\u51cf\u5c11\u5185\u5b58\u5360\u7528\u3002</p> <pre><code>public Bitmap decodeSampledBitmapFromResource(Resources res, int resId, int reqWidth, int reqHeight) {\n    // \u7b2c\u4e00\u6b21\u89e3\u7801\uff0c\u83b7\u53d6\u56fe\u50cf\u5c3a\u5bf8\n    final BitmapFactory.Options options = new BitmapFactory.Options();\n    options.inJustDecodeBounds = true;\n    BitmapFactory.decodeResource(res, resId, options);\n\n    // \u8ba1\u7b97 inSampleSize\n    options.inSampleSize = calculateInSampleSize(options, reqWidth, reqHeight);\n\n    // \u7b2c\u4e8c\u6b21\u89e3\u7801\uff0c\u52a0\u8f7d\u7f29\u5c0f\u540e\u7684\u56fe\u50cf\n    options.inJustDecodeBounds = false;\n    return BitmapFactory.decodeResource(res, resId, options);\n}\n\npublic int calculateInSampleSize(BitmapFactory.Options options, int reqWidth, int reqHeight) {\n    final int height = options.outHeight;\n    final int width = options.outWidth;\n    int inSampleSize = 1;\n\n    if (height &gt; reqHeight || width &gt; reqWidth) {\n        final int halfHeight = height / 2;\n        final int halfWidth = width / 2;\n\n        while ((halfHeight / inSampleSize) &gt;= reqHeight &amp;&amp; (halfWidth / inSampleSize) &gt;= reqWidth) {\n            inSampleSize *= 2;\n        }\n    }\n\n    return inSampleSize;\n}\n</code></pre>"},{"location":"030Android/020SystemSourceCode/#2-bitmapregiondecoder","title":"2. \u4f7f\u7528 <code>BitmapRegionDecoder</code> \u52a0\u8f7d\u90e8\u5206\u56fe\u50cf","text":"<p>\u5bf9\u4e8e\u8d85\u5927\u56fe\u50cf\uff0c\u53ef\u4ee5\u53ea\u52a0\u8f7d\u663e\u793a\u533a\u57df\u7684\u90e8\u5206\u56fe\u50cf\u3002</p> <pre><code>public Bitmap decodeRegionFromResource(Resources res, int resId, Rect rect, int reqWidth, int reqHeight) {\n    InputStream is = res.openRawResource(resId);\n    BitmapRegionDecoder decoder = BitmapRegionDecoder.newInstance(is, false);\n    BitmapFactory.Options options = new BitmapFactory.Options();\n    options.inSampleSize = calculateInSampleSize(decoder.getWidth(), decoder.getHeight(), reqWidth, reqHeight);\n    return decoder.decodeRegion(rect, options);\n}\n</code></pre>"},{"location":"030Android/020SystemSourceCode/#3_3","title":"3. \u4f7f\u7528\u7b2c\u4e09\u65b9\u5e93","text":"<p>\u4f7f\u7528\u5982Glide\u3001Picasso\u7b49\u7b2c\u4e09\u65b9\u5e93\uff0c\u5b83\u4eec\u5df2\u4f18\u5316\u4e86\u5927\u56fe\u7247\u7684\u52a0\u8f7d\u3002</p>"},{"location":"030Android/020SystemSourceCode/#glide","title":"Glide \u793a\u4f8b","text":"<pre><code>Glide.with(context)\n    .load(imageUrl)\n    .override(reqWidth, reqHeight)\n    .into(imageView);\n</code></pre>"},{"location":"030Android/020SystemSourceCode/#picasso","title":"Picasso \u793a\u4f8b","text":"<pre><code>Picasso.get()\n    .load(imageUrl)\n    .resize(reqWidth, reqHeight)\n    .into(imageView);\n</code></pre>"},{"location":"030Android/020SystemSourceCode/#4-inbitmap","title":"4. \u4f7f\u7528 <code>inBitmap</code> \u91cd\u7528\u5185\u5b58","text":"<p>\u901a\u8fc7 <code>inBitmap</code> \u91cd\u7528\u5df2\u5b58\u5728\u7684 <code>Bitmap</code> \u5185\u5b58\uff0c\u51cf\u5c11\u5185\u5b58\u5206\u914d\u3002</p> <pre><code>BitmapFactory.Options options = new BitmapFactory.Options();\noptions.inMutable = true;\noptions.inBitmap = reusableBitmap;\nBitmap bitmap = BitmapFactory.decodeResource(res, resId, options);\n</code></pre>"},{"location":"030Android/020SystemSourceCode/#5-bitmapfactoryoptions-inpreferredconfig","title":"5. \u4f7f\u7528 <code>BitmapFactory.Options</code> \u7684 <code>inPreferredConfig</code>","text":"<p>\u901a\u8fc7\u8bbe\u7f6e <code>inPreferredConfig</code> \u4e3a <code>Bitmap.Config.RGB_565</code>\uff0c\u51cf\u5c11\u6bcf\u4e2a\u50cf\u7d20\u7684\u5185\u5b58\u5360\u7528\u3002</p> <pre><code>BitmapFactory.Options options = new BitmapFactory.Options();\noptions.inPreferredConfig = Bitmap.Config.RGB_565;\nBitmap bitmap = BitmapFactory.decodeResource(res, resId, options);\n</code></pre>"},{"location":"030Android/020SystemSourceCode/#6_4","title":"6. \u5f02\u6b65\u52a0\u8f7d","text":"<p>\u5728\u540e\u53f0\u7ebf\u7a0b\u52a0\u8f7d\u56fe\u7247\uff0c\u907f\u514d\u963b\u585e\u4e3b\u7ebf\u7a0b\u3002</p> <pre><code>new AsyncTask&lt;Void, Void, Bitmap&gt;() {\n    @Override\n    protected Bitmap doInBackground(Void... voids) {\n        return decodeSampledBitmapFromResource(res, resId, reqWidth, reqHeight);\n    }\n\n    @Override\n    protected void onPostExecute(Bitmap bitmap) {\n        imageView.setImageBitmap(bitmap);\n    }\n}.execute();\n</code></pre>"},{"location":"030Android/020SystemSourceCode/#_18","title":"\u603b\u7ed3","text":"<p>\u5b89\u5168\u52a0\u8f7d\u5927\u56fe\u7247\u7684\u5173\u952e\u662f\u51cf\u5c11\u5185\u5b58\u5360\u7528\uff0c\u53ef\u901a\u8fc7\u91c7\u6837\u3001\u52a0\u8f7d\u90e8\u5206\u56fe\u50cf\u3001\u4f7f\u7528\u7b2c\u4e09\u65b9\u5e93\u3001\u91cd\u7528\u5185\u5b58\u3001\u5f02\u6b65\u52a0\u8f7d\u7b49\u65b9\u6cd5\u5b9e\u73b0\u3002</p>"},{"location":"030Android/020SystemSourceCode/#android_4","title":"Android\u4e2d\u7684\u7c7b\u52a0\u8f7d\u5668","text":"\u7b54\u6848 <p>PathClassLoader\uff0c\u53ea\u80fd\u52a0\u8f7d\u7cfb\u7edf\u4e2d\u5df2\u7ecf\u5b89\u88c5\u8fc7\u7684 apk DexClassLoader\uff0c\u53ef\u4ee5\u52a0\u8f7d jar/apk/dex\uff0c\u53ef\u4ee5\u4ece SD\u5361\u4e2d\u52a0\u8f7d\u672a\u5b89\u88c5\u7684 apk</p>"},{"location":"030Android/020SystemSourceCode/#andriod","title":"Andriod \u7cfb\u7edf\u542f\u52a8\u8fc7\u7a0b","text":"\u7b54\u6848 <p>https://github.com/jeanboydev/Android-ReadTheFuckingSourceCode/blob/master/article/android/framework/Android-%E7%B3%BB%E7%BB%9F%E5%90%AF%E5%8A%A8%E8%BF%87%E7%A8%8B.md</p>"},{"location":"030Android/020SystemSourceCode/#android-surfaceflinger","title":"Android - SurfaceFlinger \u56fe\u5f62\u7cfb\u7edf","text":"\u7b54\u6848 <p>https://github.com/jeanboydev/Android-ReadTheFuckingSourceCode/blob/master/article/android/framework/Android-SurfaceFlinger%E5%9B%BE%E5%BD%A2%E7%B3%BB%E7%BB%9F.md</p>"},{"location":"030Android/020SystemSourceCode/#android-service","title":"Android - Service \u542f\u52a8\u8fc7\u7a0b","text":"\u7b54\u6848 <p>https://github.com/jeanboydev/Android-ReadTheFuckingSourceCode/blob/master/article/android/framework/Android-Service%E5%90%AF%E5%8A%A8%E8%BF%87%E7%A8%8B.md</p>"},{"location":"030Android/020SystemSourceCode/#android-packagemangerservice","title":"Android - PackageMangerService \u5206\u6790","text":"\u7b54\u6848 <p>https://github.com/jeanboydev/Android-ReadTheFuckingSourceCode/blob/master/article/android/framework/Android-PackageManagerService%E5%88%86%E6%9E%90.md</p>"},{"location":"030Android/020SystemSourceCode/#android-powermanagerservice","title":"Android - PowerManagerService \u542f\u52a8","text":"\u7b54\u6848 <p>https://github.com/jeanboydev/Android-ReadTheFuckingSourceCode/blob/master/article/android/framework/Android-PowerManagerService-%E5%90%AF%E5%8A%A8.md</p>"},{"location":"030Android/030ThirdSDKSourceCode/","title":"Android\u4e09\u65b9\u6e90\u7801\u89e3\u6790","text":""},{"location":"030Android/030ThirdSDKSourceCode/#okhttp","title":"OkHttp\u6e90\u7801\u89e3\u6790","text":"\u7b54\u6848 <p>OkHttp \u662f\u4e00\u4e2a\u5e7f\u6cdb\u4f7f\u7528\u7684\u5f00\u6e90 HTTP \u5ba2\u6237\u7aef\u5e93\uff0c\u9002\u7528\u4e8e Android \u548c Java \u5e94\u7528\u7a0b\u5e8f\u3002\u5b83\u7531 Square \u516c\u53f8\u5f00\u53d1\uff0c\u65e8\u5728\u7b80\u5316 HTTP \u8bf7\u6c42\u548c\u54cd\u5e94\u7684\u5904\u7406\u3002\u4ee5\u4e0b\u662f\u4ece\u6e90\u7801\u89d2\u5ea6\u5bf9 OkHttp \u7684\u5206\u6790\uff1a</p>"},{"location":"030Android/030ThirdSDKSourceCode/#1","title":"1. \u6838\u5fc3\u7c7b\u4e0e\u7ec4\u4ef6","text":"<p>OkHttp \u7684\u6838\u5fc3\u7c7b\u4e3b\u8981\u5305\u62ec <code>OkHttpClient</code>\u3001<code>Request</code>\u3001<code>Response</code>\u3001<code>Call</code> \u548c <code>Interceptor</code>\u3002</p> <ul> <li> <p>OkHttpClient: \u8fd9\u662f OkHttp \u7684\u6838\u5fc3\u7c7b\uff0c\u7528\u4e8e\u521b\u5efa\u548c\u7ba1\u7406 HTTP \u8bf7\u6c42\u3002\u5b83\u5c01\u88c5\u4e86\u8fde\u63a5\u6c60\u3001\u7f13\u5b58\u3001\u62e6\u622a\u5668\u3001\u4ee3\u7406\u7b49\u914d\u7f6e\u3002<code>OkHttpClient</code> \u4f7f\u7528\u4e86 Builder \u6a21\u5f0f\u6765\u914d\u7f6e\u5404\u79cd\u53c2\u6570\u3002</p> </li> <li> <p>Request: \u8868\u793a\u4e00\u4e2a HTTP \u8bf7\u6c42\uff0c\u5305\u542b URL\u3001\u65b9\u6cd5\uff08GET\u3001POST \u7b49\uff09\u3001\u5934\u4fe1\u606f\u3001\u8bf7\u6c42\u4f53\u7b49\u3002</p> </li> <li> <p>Response: \u8868\u793a\u4e00\u4e2a HTTP \u54cd\u5e94\uff0c\u5305\u542b\u72b6\u6001\u7801\u3001\u5934\u4fe1\u606f\u3001\u54cd\u5e94\u4f53\u7b49\u3002</p> </li> <li> <p>Call: \u8868\u793a\u4e00\u4e2a\u51c6\u5907\u6267\u884c\u7684\u8bf7\u6c42\u3002<code>Call</code> \u662f\u4e00\u4e2a\u63a5\u53e3\uff0c\u5177\u4f53\u7684\u5b9e\u73b0\u7c7b\u662f <code>RealCall</code>\u3002<code>Call</code> \u53ef\u4ee5\u540c\u6b65\u6216\u5f02\u6b65\u6267\u884c\u3002</p> </li> <li> <p>Interceptor: \u62e6\u622a\u5668\u662f OkHttp \u7684\u4e00\u4e2a\u5f3a\u5927\u529f\u80fd\uff0c\u5141\u8bb8\u4f60\u5728\u8bf7\u6c42\u548c\u54cd\u5e94\u7684\u5904\u7406\u8fc7\u7a0b\u4e2d\u63d2\u5165\u81ea\u5b9a\u4e49\u903b\u8f91\u3002\u62e6\u622a\u5668\u53ef\u4ee5\u7528\u4e8e\u65e5\u5fd7\u8bb0\u5f55\u3001\u91cd\u8bd5\u3001\u7f13\u5b58\u7b49\u3002</p> </li> </ul>"},{"location":"030Android/030ThirdSDKSourceCode/#2","title":"2. \u8bf7\u6c42\u6267\u884c\u6d41\u7a0b","text":"<p>OkHttp \u7684\u8bf7\u6c42\u6267\u884c\u6d41\u7a0b\u53ef\u4ee5\u5206\u4e3a\u4ee5\u4e0b\u51e0\u4e2a\u6b65\u9aa4\uff1a</p> <ol> <li> <p>\u521b\u5efa\u8bf7\u6c42: \u4f7f\u7528 <code>Request.Builder</code> \u6784\u5efa\u4e00\u4e2a <code>Request</code> \u5bf9\u8c61\u3002</p> </li> <li> <p>\u521b\u5efa Call: \u901a\u8fc7 <code>OkHttpClient.newCall(Request)</code> \u65b9\u6cd5\u521b\u5efa\u4e00\u4e2a <code>Call</code> \u5bf9\u8c61\u3002</p> </li> <li> <p>\u6267\u884c\u8bf7\u6c42: \u8c03\u7528 <code>Call.execute()</code> \u8fdb\u884c\u540c\u6b65\u8bf7\u6c42\uff0c\u6216\u8005\u8c03\u7528 <code>Call.enqueue(Callback)</code> \u8fdb\u884c\u5f02\u6b65\u8bf7\u6c42\u3002</p> </li> <li> <p>\u62e6\u622a\u5668\u94fe: \u8bf7\u6c42\u4f1a\u7ecf\u8fc7\u4e00\u7cfb\u5217\u7684\u62e6\u622a\u5668\uff08Interceptor\uff09\uff0c\u6bcf\u4e2a\u62e6\u622a\u5668\u53ef\u4ee5\u5bf9\u8bf7\u6c42\u8fdb\u884c\u5904\u7406\uff0c\u7136\u540e\u5c06\u8bf7\u6c42\u4f20\u9012\u7ed9\u4e0b\u4e00\u4e2a\u62e6\u622a\u5668\uff0c\u6700\u7ec8\u5230\u8fbe\u7f51\u7edc\u5c42\u3002</p> </li> <li> <p>\u7f51\u7edc\u8bf7\u6c42: \u5728\u7f51\u7edc\u5c42\uff0cOkHttp \u4f7f\u7528 <code>HttpURLConnection</code> \u6216 <code>Http2Connection</code> \u8fdb\u884c\u5b9e\u9645\u7684\u7f51\u7edc\u8bf7\u6c42\u3002</p> </li> <li> <p>\u54cd\u5e94\u5904\u7406: \u54cd\u5e94\u4f1a\u7ecf\u8fc7\u62e6\u622a\u5668\u94fe\u8fd4\u56de\uff0c\u6700\u7ec8\u8fd4\u56de\u7ed9\u8c03\u7528\u8005\u3002</p> </li> </ol>"},{"location":"030Android/030ThirdSDKSourceCode/#3","title":"3. \u62e6\u622a\u5668\u94fe","text":"<p>OkHttp \u7684\u62e6\u622a\u5668\u94fe\u662f\u5176\u6838\u5fc3\u673a\u5236\u4e4b\u4e00\u3002\u62e6\u622a\u5668\u94fe\u662f\u4e00\u4e2a\u8d23\u4efb\u94fe\u6a21\u5f0f\u7684\u5e94\u7528\uff0c\u6bcf\u4e2a\u62e6\u622a\u5668\u90fd\u53ef\u4ee5\u5bf9\u8bf7\u6c42\u548c\u54cd\u5e94\u8fdb\u884c\u5904\u7406\u3002\u62e6\u622a\u5668\u94fe\u7684\u987a\u5e8f\u5982\u4e0b\uff1a</p> <ol> <li> <p>\u5e94\u7528\u62e6\u622a\u5668: \u6700\u5148\u6267\u884c\u7684\u62e6\u622a\u5668\uff0c\u901a\u5e38\u7528\u4e8e\u5904\u7406\u4e0e\u4e1a\u52a1\u903b\u8f91\u76f8\u5173\u7684\u64cd\u4f5c\uff0c\u5982\u65e5\u5fd7\u8bb0\u5f55\u3001\u8bf7\u6c42\u91cd\u8bd5\u7b49\u3002</p> </li> <li> <p>\u91cd\u8bd5\u548c\u91cd\u5b9a\u5411\u62e6\u622a\u5668: \u8d1f\u8d23\u5904\u7406\u8bf7\u6c42\u7684\u91cd\u8bd5\u548c\u91cd\u5b9a\u5411\u3002</p> </li> <li> <p>\u6865\u63a5\u62e6\u622a\u5668: \u8d1f\u8d23\u5c06\u7528\u6237\u6784\u5efa\u7684\u8bf7\u6c42\u8f6c\u6362\u4e3a\u7f51\u7edc\u8bf7\u6c42\uff0c\u5982\u6dfb\u52a0\u5fc5\u8981\u7684\u5934\u4fe1\u606f\u3001\u5904\u7406 Cookie \u7b49\u3002</p> </li> <li> <p>\u7f13\u5b58\u62e6\u622a\u5668: \u8d1f\u8d23\u5904\u7406\u7f13\u5b58\u903b\u8f91\uff0c\u5982\u679c\u8bf7\u6c42\u7684\u54cd\u5e94\u5df2\u7ecf\u5728\u7f13\u5b58\u4e2d\uff0c\u5219\u76f4\u63a5\u8fd4\u56de\u7f13\u5b58\u54cd\u5e94\u3002</p> </li> <li> <p>\u8fde\u63a5\u62e6\u622a\u5668: \u8d1f\u8d23\u7ba1\u7406\u4e0e\u670d\u52a1\u5668\u7684\u8fde\u63a5\uff0c\u5305\u62ec\u8fde\u63a5\u6c60\u7684\u7ba1\u7406\u3002</p> </li> <li> <p>\u7f51\u7edc\u62e6\u622a\u5668: \u6700\u540e\u6267\u884c\u7684\u62e6\u622a\u5668\uff0c\u8d1f\u8d23\u5b9e\u9645\u7684\u7f51\u7edc\u8bf7\u6c42\u3002</p> </li> </ol>"},{"location":"030Android/030ThirdSDKSourceCode/#4","title":"4. \u8fde\u63a5\u7ba1\u7406","text":"<p>OkHttp \u4f7f\u7528\u8fde\u63a5\u6c60\uff08<code>ConnectionPool</code>\uff09\u6765\u7ba1\u7406 HTTP \u8fde\u63a5\uff0c\u4ee5\u51cf\u5c11\u91cd\u590d\u521b\u5efa\u548c\u9500\u6bc1\u8fde\u63a5\u7684\u5f00\u9500\u3002\u8fde\u63a5\u6c60\u4e2d\u7684\u8fde\u63a5\u53ef\u4ee5\u88ab\u590d\u7528\uff0c\u4ece\u800c\u63d0\u9ad8\u6027\u80fd\u3002</p> <ul> <li> <p>ConnectionPool: \u7ba1\u7406 HTTP \u548c HTTP/2 \u8fde\u63a5\u7684\u6c60\u3002\u5b83\u4f7f\u7528\u4e00\u4e2a\u540e\u53f0\u7ebf\u7a0b\u5b9a\u671f\u6e05\u7406\u7a7a\u95f2\u8fde\u63a5\u3002</p> </li> <li> <p>RealConnection: \u8868\u793a\u4e00\u4e2a\u5b9e\u9645\u7684\u7f51\u7edc\u8fde\u63a5\uff0c\u5c01\u88c5\u4e86 Socket \u548c\u534f\u8bae\uff08HTTP/1.1 \u6216 HTTP/2\uff09\u3002</p> </li> </ul>"},{"location":"030Android/030ThirdSDKSourceCode/#5","title":"5. \u7f13\u5b58\u673a\u5236","text":"<p>OkHttp \u63d0\u4f9b\u4e86\u5185\u7f6e\u7684\u7f13\u5b58\u673a\u5236\uff0c\u53ef\u4ee5\u901a\u8fc7 <code>Cache</code> \u7c7b\u6765\u914d\u7f6e\u3002\u7f13\u5b58\u673a\u5236\u57fa\u4e8e HTTP \u7f13\u5b58\u89c4\u8303\uff0c\u652f\u6301\u7f13\u5b58\u54cd\u5e94\u7684\u5b58\u50a8\u548c\u8bfb\u53d6\u3002</p> <ul> <li> <p>Cache: \u8d1f\u8d23\u7ba1\u7406\u7f13\u5b58\u6587\u4ef6\uff0c\u7f13\u5b58\u6587\u4ef6\u5b58\u50a8\u5728\u78c1\u76d8\u4e0a\u3002</p> </li> <li> <p>CacheStrategy: \u51b3\u5b9a\u662f\u5426\u4f7f\u7528\u7f13\u5b58\u3001\u662f\u5426\u53d1\u8d77\u7f51\u7edc\u8bf7\u6c42\u7b49\u3002</p> </li> </ul>"},{"location":"030Android/030ThirdSDKSourceCode/#6","title":"6. \u5f02\u6b65\u8bf7\u6c42","text":"<p>OkHttp \u7684\u5f02\u6b65\u8bf7\u6c42\u901a\u8fc7 <code>Call.enqueue(Callback)</code> \u65b9\u6cd5\u5b9e\u73b0\u3002\u5f02\u6b65\u8bf7\u6c42\u4f7f\u7528\u4e86\u4e00\u4e2a\u7ebf\u7a0b\u6c60\u6765\u6267\u884c\u7f51\u7edc\u8bf7\u6c42\uff0c\u8bf7\u6c42\u5b8c\u6210\u540e\u901a\u8fc7\u56de\u8c03\u63a5\u53e3 <code>Callback</code> \u8fd4\u56de\u7ed3\u679c\u3002</p> <ul> <li>Dispatcher: \u8d1f\u8d23\u7ba1\u7406\u5f02\u6b65\u8bf7\u6c42\u7684\u6267\u884c\u548c\u53d6\u6d88\u3002\u5b83\u7ef4\u62a4\u4e86\u4e00\u4e2a\u7ebf\u7a0b\u6c60\uff0c\u7528\u4e8e\u6267\u884c\u5f02\u6b65\u8bf7\u6c42\u3002</li> </ul>"},{"location":"030Android/030ThirdSDKSourceCode/#7-http2","title":"7. HTTP/2 \u652f\u6301","text":"<p>OkHttp \u652f\u6301 HTTP/2 \u534f\u8bae\uff0cHTTP/2 \u63d0\u4f9b\u4e86\u591a\u8def\u590d\u7528\u3001\u5934\u90e8\u538b\u7f29\u7b49\u7279\u6027\uff0c\u53ef\u4ee5\u663e\u8457\u63d0\u9ad8\u7f51\u7edc\u6027\u80fd\u3002</p> <ul> <li>Http2Connection: \u8868\u793a\u4e00\u4e2a HTTP/2 \u8fde\u63a5\uff0c\u5c01\u88c5\u4e86 HTTP/2 \u7684\u5e27\u3001\u6d41\u7b49\u6982\u5ff5\u3002</li> </ul>"},{"location":"030Android/030ThirdSDKSourceCode/#8-websocket","title":"8. WebSocket \u652f\u6301","text":"<p>OkHttp \u8fd8\u652f\u6301 WebSocket \u534f\u8bae\uff0c\u5141\u8bb8\u5ba2\u6237\u7aef\u4e0e\u670d\u52a1\u5668\u8fdb\u884c\u5168\u53cc\u5de5\u901a\u4fe1\u3002</p> <ul> <li>RealWebSocket: \u8868\u793a\u4e00\u4e2a WebSocket \u8fde\u63a5\uff0c\u8d1f\u8d23\u5904\u7406 WebSocket \u7684\u63e1\u624b\u3001\u6d88\u606f\u53d1\u9001\u548c\u63a5\u6536\u7b49\u3002</li> </ul>"},{"location":"030Android/030ThirdSDKSourceCode/#9","title":"9. \u6e90\u7801\u7ed3\u6784","text":"<p>OkHttp \u7684\u6e90\u7801\u7ed3\u6784\u6e05\u6670\uff0c\u4e3b\u8981\u5206\u4e3a\u4ee5\u4e0b\u51e0\u4e2a\u6a21\u5757\uff1a</p> <ul> <li>okhttp: \u6838\u5fc3\u6a21\u5757\uff0c\u5305\u542b HTTP \u8bf7\u6c42\u3001\u54cd\u5e94\u3001\u62e6\u622a\u5668\u3001\u8fde\u63a5\u7ba1\u7406\u7b49\u3002</li> <li>okhttp-tls: \u5904\u7406 TLS/SSL \u76f8\u5173\u7684\u529f\u80fd\u3002</li> <li>okhttp-logging-interceptor: \u63d0\u4f9b\u4e86\u65e5\u5fd7\u8bb0\u5f55\u62e6\u622a\u5668\u3002</li> <li>okhttp-urlconnection: \u63d0\u4f9b\u4e86\u4e0e <code>HttpURLConnection</code> \u517c\u5bb9\u7684 API\u3002</li> <li>okhttp-sse: \u652f\u6301\u670d\u52a1\u5668\u53d1\u9001\u4e8b\u4ef6\uff08Server-Sent Events\uff09\u3002</li> </ul>"},{"location":"030Android/030ThirdSDKSourceCode/#10","title":"10. \u8bbe\u8ba1\u6a21\u5f0f","text":"<p>OkHttp \u7684\u6e90\u7801\u4e2d\u4f7f\u7528\u4e86\u591a\u79cd\u8bbe\u8ba1\u6a21\u5f0f\uff0c\u5982 Builder \u6a21\u5f0f\u3001\u8d23\u4efb\u94fe\u6a21\u5f0f\u3001\u5de5\u5382\u6a21\u5f0f\u7b49\uff0c\u8fd9\u4e9b\u8bbe\u8ba1\u6a21\u5f0f\u4f7f\u5f97 OkHttp \u7684\u4ee3\u7801\u7ed3\u6784\u6e05\u6670\u3001\u6613\u4e8e\u6269\u5c55\u548c\u7ef4\u62a4\u3002</p>"},{"location":"030Android/030ThirdSDKSourceCode/#_1","title":"\u603b\u7ed3","text":"<p>OkHttp \u662f\u4e00\u4e2a\u529f\u80fd\u5f3a\u5927\u3001\u8bbe\u8ba1\u4f18\u96c5\u7684 HTTP \u5ba2\u6237\u7aef\u5e93\u3002\u901a\u8fc7\u62e6\u622a\u5668\u94fe\u3001\u8fde\u63a5\u6c60\u3001\u7f13\u5b58\u673a\u5236\u7b49\u6838\u5fc3\u7ec4\u4ef6\uff0cOkHttp \u63d0\u4f9b\u4e86\u9ad8\u6548\u3001\u7075\u6d3b\u7684 HTTP \u8bf7\u6c42\u5904\u7406\u80fd\u529b\u3002\u5176\u6e90\u7801\u7ed3\u6784\u6e05\u6670\uff0c\u8bbe\u8ba1\u6a21\u5f0f\u5e94\u7528\u5f97\u5f53\uff0c\u975e\u5e38\u9002\u5408\u5b66\u4e60\u548c\u501f\u9274\u3002</p>"},{"location":"030Android/030ThirdSDKSourceCode/#retrofit","title":"Retrofit\u6e90\u7801\u89e3\u6790","text":"\u7b54\u6848 <p>Retrofit \u662f\u4e00\u4e2a\u5e7f\u6cdb\u4f7f\u7528\u7684 HTTP \u5ba2\u6237\u7aef\u5e93\uff0c\u4e13\u4e3a Android \u548c Java \u5e94\u7528\u8bbe\u8ba1\u3002\u5b83\u901a\u8fc7\u5c06 HTTP API \u8f6c\u6362\u4e3a Java \u63a5\u53e3\uff0c\u7b80\u5316\u4e86\u7f51\u7edc\u8bf7\u6c42\u7684\u5904\u7406\u3002\u4ee5\u4e0b\u662f\u4ece\u6e90\u7801\u89d2\u5ea6\u5bf9 Retrofit \u7684\u5206\u6790\uff1a</p>"},{"location":"030Android/030ThirdSDKSourceCode/#1_1","title":"1. \u6838\u5fc3\u7ec4\u4ef6","text":""},{"location":"030Android/030ThirdSDKSourceCode/#11-retrofit","title":"1.1 <code>Retrofit</code> \u7c7b","text":"<p><code>Retrofit</code> \u7c7b\u662f\u5e93\u7684\u6838\u5fc3\uff0c\u8d1f\u8d23\u521b\u5efa API \u63a5\u53e3\u7684\u5b9e\u4f8b\u3002\u5b83\u4f7f\u7528\u6784\u5efa\u5668\u6a21\u5f0f\u8fdb\u884c\u914d\u7f6e\uff0c\u5141\u8bb8\u8bbe\u7f6e\u57fa\u7840 URL\u3001\u8f6c\u6362\u5668\u5de5\u5382\u3001\u8c03\u7528\u9002\u914d\u5668\u7b49\u3002</p> <pre><code>public final class Retrofit {\nprivate final Map&lt;Method, ServiceMethod&lt;?&gt;&gt; serviceMethodCache = new ConcurrentHashMap&lt;&gt;();\nprivate final Call.Factory callFactory;\nprivate final HttpUrl baseUrl;\nprivate final List&lt;Converter.Factory&gt; converterFactories;\nprivate final List&lt;CallAdapter.Factory&gt; callAdapterFactories;\nprivate final Executor callbackExecutor;\nprivate final boolean validateEagerly;\n\nRetrofit(Call.Factory callFactory, HttpUrl baseUrl,\n    List&lt;Converter.Factory&gt; converterFactories, List&lt;CallAdapter.Factory&gt; callAdapterFactories,\n    Executor callbackExecutor, boolean validateEagerly) {\n    this.callFactory = callFactory;\n    this.baseUrl = baseUrl;\n    this.converterFactories = converterFactories;\n    this.callAdapterFactories = callAdapterFactories;\n    this.callbackExecutor = callbackExecutor;\n    this.validateEagerly = validateEagerly;\n}\n\npublic &lt;T&gt; T create(final Class&lt;T&gt; service) {\n    Utils.validateServiceInterface(service);\n    if (validateEagerly) {\n    eagerlyValidateMethods(service);\n    }\n    return (T) Proxy.newProxyInstance(service.getClassLoader(), new Class&lt;?&gt;[] { service },\n        new InvocationHandler() {\n        private final Platform platform = Platform.get();\n        private final Object[] emptyArgs = new Object[0];\n\n        @Override public Object invoke(Object proxy, Method method, Object[] args)\n            throws Throwable {\n            // If the method is a method from Object then defer to normal invocation.\n            if (method.getDeclaringClass() == Object.class) {\n            return method.invoke(this, args);\n            }\n            if (platform.isDefaultMethod(method)) {\n            return platform.invokeDefaultMethod(method, service, proxy, args);\n            }\n            return loadServiceMethod(method).invoke(args != null ? args : emptyArgs);\n        }\n        });\n}\n\nServiceMethod&lt;?&gt; loadServiceMethod(Method method) {\n    ServiceMethod&lt;?&gt; result = serviceMethodCache.get(method);\n    if (result != null) return result;\n\n    synchronized (serviceMethodCache) {\n    result = serviceMethodCache.get(method);\n    if (result == null) {\n        result = ServiceMethod.parseAnnotations(this, method);\n        serviceMethodCache.put(method, result);\n    }\n    }\n    return result;\n}\n}\n</code></pre>"},{"location":"030Android/030ThirdSDKSourceCode/#12-servicemethod","title":"1.2 <code>ServiceMethod</code> \u7c7b","text":"<p><code>ServiceMethod</code> \u8d1f\u8d23\u89e3\u6790\u63a5\u53e3\u65b9\u6cd5\u4e0a\u7684\u6ce8\u89e3\uff08\u5982 <code>@GET</code>, <code>@POST</code>\uff09\uff0c\u5e76\u751f\u6210\u5bf9\u5e94\u7684 HTTP \u8bf7\u6c42\u3002\u5b83\u4f7f\u7528 <code>RequestFactory</code> \u548c <code>CallAdapter</code> \u6765\u5904\u7406\u8bf7\u6c42\u548c\u54cd\u5e94\u3002</p> <pre><code>abstract class ServiceMethod&lt;T&gt; {\nstatic &lt;T&gt; ServiceMethod&lt;T&gt; parseAnnotations(Retrofit retrofit, Method method) {\n    RequestFactory requestFactory = RequestFactory.parseAnnotations(retrofit, method);\n\n    Type returnType = method.getGenericReturnType();\n    if (Utils.hasUnresolvableType(returnType)) {\n    throw methodError(method,\n        \"Method return type must not include a type variable or wildcard: %s\", returnType);\n    }\n    if (returnType == void.class) {\n    throw methodError(method, \"Service methods cannot return void.\");\n    }\n\n    return HttpServiceMethod.parseAnnotations(retrofit, method, requestFactory);\n}\n\nabstract T invoke(Object[] args);\n}\n</code></pre>"},{"location":"030Android/030ThirdSDKSourceCode/#13-calladapter","title":"1.3 <code>CallAdapter</code> \u63a5\u53e3","text":"<p><code>CallAdapter</code> \u8d1f\u8d23\u5c06 <code>Call</code> \u5bf9\u8c61\u9002\u914d\u4e3a\u5176\u4ed6\u7c7b\u578b\uff08\u5982 <code>Observable</code>, <code>Completable</code>\uff09\uff0c\u5141\u8bb8 Retrofit \u4e0e RxJava \u7b49\u5e93\u96c6\u6210\u3002</p> <pre><code>public interface CallAdapter&lt;R, T&gt; {\nType responseType();\nT adapt(Call&lt;R&gt; call);\n}\n</code></pre>"},{"location":"030Android/030ThirdSDKSourceCode/#14-converter","title":"1.4 <code>Converter</code> \u63a5\u53e3","text":"<p><code>Converter</code> \u8d1f\u8d23\u5c06 HTTP \u8bf7\u6c42\u548c\u54cd\u5e94\u7684\u6570\u636e\u8f6c\u6362\u4e3a Java \u5bf9\u8c61\u3002\u5e38\u89c1\u7684\u8f6c\u6362\u5668\u5305\u62ec Gson\u3001Jackson \u7b49\u3002</p> <pre><code>public interface Converter&lt;F, T&gt; {\nT convert(F value) throws IOException;\n}\n</code></pre>"},{"location":"030Android/030ThirdSDKSourceCode/#2_1","title":"2. \u5de5\u4f5c\u6d41\u7a0b","text":"<ol> <li>\u521b\u5efa Retrofit \u5b9e\u4f8b\uff1a\u901a\u8fc7 <code>Retrofit.Builder</code> \u914d\u7f6e\u57fa\u7840 URL\u3001\u8f6c\u6362\u5668\u3001\u8c03\u7528\u9002\u914d\u5668\u7b49\u3002</li> <li>\u521b\u5efa API \u63a5\u53e3\u5b9e\u4f8b\uff1a\u4f7f\u7528 <code>Retrofit.create()</code> \u65b9\u6cd5\u751f\u6210\u63a5\u53e3\u7684\u4ee3\u7406\u5bf9\u8c61\u3002</li> <li>\u89e3\u6790\u6ce8\u89e3\uff1a\u8c03\u7528\u63a5\u53e3\u65b9\u6cd5\u65f6\uff0cRetrofit \u89e3\u6790\u65b9\u6cd5\u4e0a\u7684\u6ce8\u89e3\uff0c\u751f\u6210 <code>ServiceMethod</code> \u5bf9\u8c61\u3002</li> <li>\u521b\u5efa HTTP \u8bf7\u6c42\uff1a<code>ServiceMethod</code> \u4f7f\u7528 <code>RequestFactory</code> \u751f\u6210 HTTP \u8bf7\u6c42\u3002</li> <li>\u6267\u884c\u8bf7\u6c42\uff1a\u901a\u8fc7 <code>CallAdapter</code> \u5c06 <code>Call</code> \u5bf9\u8c61\u9002\u914d\u4e3a\u6240\u9700\u7c7b\u578b\uff0c\u5e76\u6267\u884c\u8bf7\u6c42\u3002</li> <li>\u5904\u7406\u54cd\u5e94\uff1a\u4f7f\u7528 <code>Converter</code> \u5c06\u54cd\u5e94\u6570\u636e\u8f6c\u6362\u4e3a Java \u5bf9\u8c61\u3002</li> </ol>"},{"location":"030Android/030ThirdSDKSourceCode/#3_1","title":"3. \u5173\u952e\u8bbe\u8ba1\u6a21\u5f0f","text":"<ul> <li>\u52a8\u6001\u4ee3\u7406\uff1aRetrofit \u4f7f\u7528 Java \u7684\u52a8\u6001\u4ee3\u7406\u673a\u5236\u751f\u6210 API \u63a5\u53e3\u7684\u5b9e\u4f8b\u3002</li> <li>\u6784\u5efa\u5668\u6a21\u5f0f\uff1a<code>Retrofit.Builder</code> \u7528\u4e8e\u914d\u7f6e\u548c\u521b\u5efa <code>Retrofit</code> \u5b9e\u4f8b\u3002</li> <li>\u9002\u914d\u5668\u6a21\u5f0f\uff1a<code>CallAdapter</code> \u548c <code>Converter</code> \u4f7f\u7528\u9002\u914d\u5668\u6a21\u5f0f\uff0c\u4f7f Retrofit \u80fd\u591f\u7075\u6d3b\u652f\u6301\u591a\u79cd\u6570\u636e\u683c\u5f0f\u548c\u8c03\u7528\u65b9\u5f0f\u3002</li> </ul>"},{"location":"030Android/030ThirdSDKSourceCode/#4_1","title":"4. \u603b\u7ed3","text":"<p>Retrofit \u901a\u8fc7\u52a8\u6001\u4ee3\u7406\u3001\u6ce8\u89e3\u89e3\u6790\u548c\u9002\u914d\u5668\u6a21\u5f0f\uff0c\u7b80\u5316\u4e86 HTTP \u8bf7\u6c42\u7684\u5904\u7406\u3002\u5176\u6a21\u5757\u5316\u8bbe\u8ba1\u4f7f\u5f97\u6269\u5c55\u548c\u5b9a\u5236\u53d8\u5f97\u5bb9\u6613\uff0c\u80fd\u591f\u6ee1\u8db3\u5404\u79cd\u590d\u6742\u7684\u7f51\u7edc\u8bf7\u6c42\u9700\u6c42\u3002</p>"},{"location":"030Android/030ThirdSDKSourceCode/#retrofitokhttp","title":"Retrofit\u548cOkhttp\u7684\u5173\u7cfb","text":"\u7b54\u6848 <p>Retrofit \u548c OkHttp \u662f\u4e24\u4e2a\u7d27\u5bc6\u76f8\u5173\u7684\u5e93\uff0c\u901a\u5e38\u4e00\u8d77\u4f7f\u7528\u6765\u5904\u7406\u7f51\u7edc\u8bf7\u6c42\u3002\u5b83\u4eec\u4e4b\u95f4\u7684\u5173\u7cfb\u548c\u5173\u8054\u70b9\u53ef\u4ee5\u4ece\u4ee5\u4e0b\u51e0\u4e2a\u65b9\u9762\u6765\u5206\u6790\uff1a</p>"},{"location":"030Android/030ThirdSDKSourceCode/#1_2","title":"1. \u5173\u7cfb\u6982\u8ff0","text":"<ul> <li>OkHttp\uff1aOkHttp \u662f\u4e00\u4e2a\u9ad8\u6548\u7684 HTTP \u5ba2\u6237\u7aef\uff0c\u8d1f\u8d23\u5e95\u5c42\u7684\u7f51\u7edc\u901a\u4fe1\uff0c\u5305\u62ec\u8fde\u63a5\u7ba1\u7406\u3001\u8bf7\u6c42\u53d1\u9001\u3001\u54cd\u5e94\u63a5\u6536\u7b49\u3002</li> <li>Retrofit\uff1aRetrofit \u662f\u4e00\u4e2a\u57fa\u4e8e OkHttp \u7684\u9ad8\u7ea7 REST \u5ba2\u6237\u7aef\uff0c\u5b83\u901a\u8fc7\u5c06 HTTP API \u8f6c\u6362\u4e3a Java \u63a5\u53e3\uff0c\u7b80\u5316\u4e86\u7f51\u7edc\u8bf7\u6c42\u7684\u5904\u7406\u3002Retrofit \u4f9d\u8d56\u4e8e OkHttp \u6765\u5904\u7406\u5b9e\u9645\u7684\u7f51\u7edc\u8bf7\u6c42\u3002</li> </ul>"},{"location":"030Android/030ThirdSDKSourceCode/#2_2","title":"2. \u5173\u8054\u70b9","text":""},{"location":"030Android/030ThirdSDKSourceCode/#21","title":"2.1 \u4f9d\u8d56\u5173\u7cfb","text":"<p>Retrofit \u4f9d\u8d56\u4e8e OkHttp \u6765\u5904\u7406\u5e95\u5c42\u7684\u7f51\u7edc\u8bf7\u6c42\u3002\u5728 Retrofit \u7684\u6784\u5efa\u8fc7\u7a0b\u4e2d\uff0c\u901a\u5e38\u4f1a\u914d\u7f6e\u4e00\u4e2a <code>OkHttpClient</code> \u5b9e\u4f8b\u4f5c\u4e3a <code>Call.Factory</code>\u3002</p> <pre><code>OkHttpClient okHttpClient = new OkHttpClient.Builder()\n    .addInterceptor(new LoggingInterceptor())\n    .build();\n\nRetrofit retrofit = new Retrofit.Builder()\n    .baseUrl(\"https://api.example.com/\")\n    .client(okHttpClient)\n    .addConverterFactory(GsonConverterFactory.create())\n    .build();\n</code></pre>"},{"location":"030Android/030ThirdSDKSourceCode/#22-call","title":"2.2 <code>Call</code> \u5bf9\u8c61","text":"<p>\u5728 Retrofit \u4e2d\uff0c\u63a5\u53e3\u65b9\u6cd5\u7684\u8fd4\u56de\u7c7b\u578b\u53ef\u4ee5\u662f <code>Call&lt;T&gt;</code>\uff0c\u8fd9\u91cc\u7684 <code>Call</code> \u662f Retrofit \u7684 <code>Call</code> \u63a5\u53e3\uff0c\u4f46\u5b83\u5b9e\u9645\u4e0a\u662f\u7531 OkHttp \u7684 <code>Call</code> \u5b9e\u73b0\u7684\u3002Retrofit \u7684 <code>Call</code> \u63a5\u53e3\u662f\u5bf9 OkHttp \u7684 <code>Call</code> \u7684\u5c01\u88c5\u3002</p> <pre><code>public interface MyApiService {\n    @GET(\"users/{user}\")\n    Call&lt;User&gt; getUser(@Path(\"user\") String user);\n}\n</code></pre> <p>\u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0c<code>getUser</code> \u65b9\u6cd5\u8fd4\u56de\u7684\u662f Retrofit \u7684 <code>Call&lt;User&gt;</code>\uff0c\u4f46\u5b9e\u9645\u6267\u884c\u7f51\u7edc\u8bf7\u6c42\u65f6\uff0c\u4f7f\u7528\u7684\u662f OkHttp \u7684 <code>Call</code>\u3002</p>"},{"location":"030Android/030ThirdSDKSourceCode/#23","title":"2.3 \u8bf7\u6c42\u6267\u884c","text":"<p>\u5f53\u8c03\u7528 Retrofit \u7684 <code>Call</code> \u5bf9\u8c61\u7684 <code>enqueue</code> \u6216 <code>execute</code> \u65b9\u6cd5\u65f6\uff0cRetrofit \u4f1a\u5c06\u8bf7\u6c42\u59d4\u6258\u7ed9 OkHttp \u7684 <code>Call</code> \u6765\u6267\u884c\u3002</p> <pre><code>Call&lt;User&gt; call = myApiService.getUser(\"octocat\");\ncall.enqueue(new Callback&lt;User&gt;() {\n    @Override\n    public void onResponse(Call&lt;User&gt; call, Response&lt;User&gt; response) {\n        if (response.isSuccessful()) {\n            User user = response.body();\n            // \u5904\u7406\u7528\u6237\u6570\u636e\n        } else {\n            // \u5904\u7406\u9519\u8bef\n        }\n    }\n\n    @Override\n    public void onFailure(Call&lt;User&gt; call, Throwable t) {\n        // \u5904\u7406\u5931\u8d25\n    }\n});\n</code></pre> <p>\u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0c<code>call.enqueue</code> \u5b9e\u9645\u4e0a\u662f\u901a\u8fc7 OkHttp \u7684 <code>Call</code> \u6765\u6267\u884c\u5f02\u6b65\u8bf7\u6c42\u7684\u3002</p>"},{"location":"030Android/030ThirdSDKSourceCode/#3_2","title":"3. \u5177\u4f53\u5173\u8054","text":""},{"location":"030Android/030ThirdSDKSourceCode/#31-callfactory","title":"3.1 <code>Call.Factory</code>","text":"<p>\u5728 Retrofit \u7684\u6784\u5efa\u8fc7\u7a0b\u4e2d\uff0c\u53ef\u4ee5\u901a\u8fc7 <code>client</code> \u65b9\u6cd5\u8bbe\u7f6e\u4e00\u4e2a <code>OkHttpClient</code> \u5b9e\u4f8b\u4f5c\u4e3a <code>Call.Factory</code>\u3002\u8fd9\u4e2a <code>Call.Factory</code> \u8d1f\u8d23\u521b\u5efa Retrofit \u7684 <code>Call</code> \u5bf9\u8c61\u3002</p> <pre><code>Retrofit retrofit = new Retrofit.Builder()\n    .baseUrl(\"https://api.example.com/\")\n    .client(okHttpClient)\n    .addConverterFactory(GsonConverterFactory.create())\n    .build();\n</code></pre>"},{"location":"030Android/030ThirdSDKSourceCode/#32-okhttpcall","title":"3.2 <code>OkHttpCall</code>","text":"<p>Retrofit \u7684 <code>Call</code> \u63a5\u53e3\u7684\u5b9e\u73b0\u7c7b\u662f <code>OkHttpCall</code>\uff0c\u5b83\u5c01\u88c5\u4e86 OkHttp \u7684 <code>Call</code> \u5bf9\u8c61\uff0c\u5e76\u63d0\u4f9b\u4e86\u4e0e Retrofit \u7684 <code>Call</code> \u63a5\u53e3\u4e00\u81f4\u7684\u65b9\u6cd5\u3002</p> <pre><code>final class OkHttpCall&lt;T&gt; implements Call&lt;T&gt; {\nprivate final RequestFactory requestFactory;\nprivate final Object[] args;\nprivate final okhttp3.Call.Factory callFactory;\nprivate final Converter&lt;ResponseBody, T&gt; responseConverter;\n\nprivate volatile boolean canceled;\nprivate okhttp3.Call rawCall;\nprivate Throwable creationFailure;\nprivate boolean executed;\n\nOkHttpCall(RequestFactory requestFactory, Object[] args, okhttp3.Call.Factory callFactory,\n    Converter&lt;ResponseBody, T&gt; responseConverter) {\n    this.requestFactory = requestFactory;\n    this.args = args;\n    this.callFactory = callFactory;\n    this.responseConverter = responseConverter;\n}\n\n@Override public void enqueue(final Callback&lt;T&gt; callback) {\n    synchronized (this) {\n    if (executed) throw new IllegalStateException(\"Already executed.\");\n    executed = true;\n    }\n\n    okhttp3.Call call;\n    Throwable failure;\n\n    synchronized (this) {\n    if (canceled) {\n        call = null;\n        failure = new IOException(\"Canceled\");\n    } else {\n        call = rawCall;\n        failure = creationFailure;\n        if (call == null &amp;&amp; failure == null) {\n        try {\n            call = rawCall = createRawCall();\n        } catch (Throwable t) {\n            failure = creationFailure = t;\n        }\n        }\n    }\n    }\n\n    if (failure != null) {\n    callback.onFailure(this, failure);\n    return;\n    }\n\n    if (canceled) {\n    call.cancel();\n    }\n\n    call.enqueue(new okhttp3.Callback() {\n    @Override public void onResponse(okhttp3.Call call, okhttp3.Response rawResponse) {\n        Response&lt;T&gt; response;\n        try {\n        response = parseResponse(rawResponse);\n        } catch (Throwable e) {\n        callFailure(e);\n        return;\n        }\n        callSuccess(response);\n    }\n\n    @Override public void onFailure(okhttp3.Call call, IOException e) {\n        callFailure(e);\n    }\n\n    private void callFailure(Throwable e) {\n        try {\n        callback.onFailure(OkHttpCall.this, e);\n        } catch (Throwable t) {\n        t.printStackTrace();\n        }\n    }\n\n    private void callSuccess(Response&lt;T&gt; response) {\n        try {\n        callback.onResponse(OkHttpCall.this, response);\n        } catch (Throwable t) {\n        t.printStackTrace();\n        }\n    }\n    });\n}\n}\n</code></pre>"},{"location":"030Android/030ThirdSDKSourceCode/#4_2","title":"4. \u603b\u7ed3","text":"<ul> <li>Retrofit \u4f9d\u8d56\u4e8e OkHttp\uff1aRetrofit \u4f7f\u7528 OkHttp \u4f5c\u4e3a\u5e95\u5c42\u7684 HTTP \u5ba2\u6237\u7aef\u6765\u5904\u7406\u7f51\u7edc\u8bf7\u6c42\u3002</li> <li><code>Call</code> \u5bf9\u8c61\u7684\u5173\u8054\uff1aRetrofit \u7684 <code>Call</code> \u63a5\u53e3\u662f\u5bf9 OkHttp \u7684 <code>Call</code> \u7684\u5c01\u88c5\uff0c\u5b9e\u9645\u6267\u884c\u7f51\u7edc\u8bf7\u6c42\u65f6\u4f7f\u7528\u7684\u662f OkHttp \u7684 <code>Call</code>\u3002</li> <li>\u8bf7\u6c42\u6267\u884c\uff1aRetrofit \u901a\u8fc7 <code>OkHttpCall</code> \u7c7b\u5c06\u8bf7\u6c42\u59d4\u6258\u7ed9 OkHttp \u6765\u6267\u884c\u3002</li> </ul> <p>\u901a\u8fc7\u8fd9\u79cd\u8bbe\u8ba1\uff0cRetrofit \u80fd\u591f\u5229\u7528 OkHttp \u7684\u5f3a\u5927\u529f\u80fd\uff0c\u540c\u65f6\u63d0\u4f9b\u66f4\u9ad8\u7ea7\u7684\u62bd\u8c61\u548c\u66f4\u7b80\u6d01\u7684 API\uff0c\u4f7f\u5f97\u5f00\u53d1\u8005\u80fd\u591f\u66f4\u8f7b\u677e\u5730\u5904\u7406\u7f51\u7edc\u8bf7\u6c42\u3002</p>"},{"location":"030Android/030ThirdSDKSourceCode/#retrofit_1","title":"Retrofit\u7684\u52a8\u6001\u4ee3\u7406\u5230\u5e95\u505a\u4e86\u4ec0\u4e48\uff1f","text":"\u7b54\u6848 <p>Retrofit \u4f7f\u7528 Java \u7684\u52a8\u6001\u4ee3\u7406\u673a\u5236\u6765\u751f\u6210 API \u63a5\u53e3\u7684\u5b9e\u4f8b\u3002\u52a8\u6001\u4ee3\u7406\u7684\u6838\u5fc3\u662f\u901a\u8fc7 <code>Proxy.newProxyInstance</code> \u65b9\u6cd5\u521b\u5efa\u4e00\u4e2a\u4ee3\u7406\u5bf9\u8c61\uff0c\u8fd9\u4e2a\u4ee3\u7406\u5bf9\u8c61\u4f1a\u62e6\u622a\u6240\u6709\u5bf9\u63a5\u53e3\u65b9\u6cd5\u7684\u8c03\u7528\uff0c\u5e76\u5c06\u8fd9\u4e9b\u8c03\u7528\u8f6c\u53d1\u7ed9 <code>InvocationHandler</code> \u5904\u7406\u3002</p> <p>\u4ee5\u4e0b\u662f\u5bf9 <code>MyApiService</code> \u63a5\u53e3\u7684\u52a8\u6001\u4ee3\u7406\u8fc7\u7a0b\u7684\u8be6\u7ec6\u5206\u6790\uff0c\u4ee5\u53ca\u52a8\u6001\u4ee3\u7406\u540e\u7684\u4ee3\u7801\u5927\u81f4\u5b9e\u73b0\u3002</p>"},{"location":"030Android/030ThirdSDKSourceCode/#1_3","title":"1. \u52a8\u6001\u4ee3\u7406\u7684\u6838\u5fc3\u903b\u8f91","text":"<p>\u5f53\u8c03\u7528 <code>Retrofit.create(MyApiService.class)</code> \u65f6\uff0cRetrofit \u4f1a\u901a\u8fc7\u52a8\u6001\u4ee3\u7406\u751f\u6210\u4e00\u4e2a <code>MyApiService</code> \u7684\u4ee3\u7406\u5bf9\u8c61\u3002\u8fd9\u4e2a\u4ee3\u7406\u5bf9\u8c61\u7684\u6838\u5fc3\u903b\u8f91\u5982\u4e0b\uff1a</p> <pre><code>public &lt;T&gt; T create(final Class&lt;T&gt; service) {\n    return (T) Proxy.newProxyInstance(\n        service.getClassLoader(),\n        new Class&lt;?&gt;[] { service },\n        new InvocationHandler() {\n            private final Platform platform = Platform.get();\n            private final Object[] emptyArgs = new Object[0];\n\n            @Override\n            public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {\n                // \u5982\u679c\u65b9\u6cd5\u662f Object \u7684\u65b9\u6cd5\uff08\u5982 toString, equals \u7b49\uff09\uff0c\u76f4\u63a5\u8c03\u7528\n                if (method.getDeclaringClass() == Object.class) {\n                    return method.invoke(this, args);\n                }\n                // \u5982\u679c\u662f\u9ed8\u8ba4\u65b9\u6cd5\uff08Java 8+\uff09\uff0c\u8c03\u7528\u9ed8\u8ba4\u65b9\u6cd5\u7684\u5b9e\u73b0\n                if (platform.isDefaultMethod(method)) {\n                    return platform.invokeDefaultMethod(method, service, proxy, args);\n                }\n                // \u52a0\u8f7d ServiceMethod \u5e76\u8c03\u7528\n                return loadServiceMethod(method).invoke(args != null ? args : emptyArgs);\n            }\n        }\n    );\n}\n</code></pre>"},{"location":"030Android/030ThirdSDKSourceCode/#2_3","title":"2. \u52a8\u6001\u4ee3\u7406\u540e\u7684\u4ee3\u7801\u5927\u81f4\u5b9e\u73b0","text":"<p>\u5047\u8bbe\u6211\u4eec\u6709\u4e00\u4e2a <code>MyApiService</code> \u63a5\u53e3\uff1a</p> <pre><code>public interface MyApiService {\n    @GET(\"users/{user}\")\n    Call&lt;User&gt; getUser(@Path(\"user\") String user);\n}\n</code></pre> <p>\u52a8\u6001\u4ee3\u7406\u751f\u6210\u7684\u4ee3\u7406\u5bf9\u8c61\u4f1a\u62e6\u622a\u5bf9 <code>getUser</code> \u65b9\u6cd5\u7684\u8c03\u7528\uff0c\u5e76\u5c06\u5176\u8f6c\u53d1\u7ed9 <code>InvocationHandler</code>\u3002\u4ee5\u4e0b\u662f\u4ee3\u7406\u5bf9\u8c61\u7684\u5927\u81f4\u5b9e\u73b0\u903b\u8f91\uff1a</p> <pre><code>// \u52a8\u6001\u4ee3\u7406\u751f\u6210\u7684\u4f2a\u4ee3\u7801\npublic class MyApiServiceProxy implements MyApiService {\n    private final InvocationHandler handler;\n\n    public MyApiServiceProxy(InvocationHandler handler) {\n        this.handler = handler;\n    }\n\n    @Override\n    public Call&lt;User&gt; getUser(String user) {\n        try {\n            // \u8c03\u7528 InvocationHandler \u7684 invoke \u65b9\u6cd5\n            return (Call&lt;User&gt;) handler.invoke(\n                this, // \u4ee3\u7406\u5bf9\u8c61\n                MyApiService.class.getMethod(\"getUser\", String.class), // \u65b9\u6cd5\u5bf9\u8c61\n                new Object[] { user } // \u65b9\u6cd5\u53c2\u6570\n            );\n        } catch (Throwable t) {\n            throw new RuntimeException(t);\n        }\n    }\n}\n</code></pre>"},{"location":"030Android/030ThirdSDKSourceCode/#3-invocationhandler","title":"3. <code>InvocationHandler</code> \u7684\u5177\u4f53\u903b\u8f91","text":"<p>\u5728 <code>InvocationHandler</code> \u7684 <code>invoke</code> \u65b9\u6cd5\u4e2d\uff0cRetrofit \u4f1a\u6267\u884c\u4ee5\u4e0b\u6b65\u9aa4\uff1a</p> <ol> <li>\u89e3\u6790\u65b9\u6cd5\u6ce8\u89e3\uff1a\u901a\u8fc7 <code>ServiceMethod.parseAnnotations</code> \u89e3\u6790\u65b9\u6cd5\u4e0a\u7684\u6ce8\u89e3\uff08\u5982 <code>@GET</code>, <code>@Path</code> \u7b49\uff09\uff0c\u751f\u6210\u4e00\u4e2a <code>ServiceMethod</code> \u5bf9\u8c61\u3002</li> <li>\u521b\u5efa HTTP \u8bf7\u6c42\uff1a\u4f7f\u7528 <code>ServiceMethod</code> \u548c\u4f20\u5165\u7684\u53c2\u6570\u751f\u6210\u4e00\u4e2a OkHttp \u7684 <code>Request</code> \u5bf9\u8c61\u3002</li> <li>\u6267\u884c\u8bf7\u6c42\uff1a\u901a\u8fc7 <code>OkHttpCall</code> \u5c06\u8bf7\u6c42\u59d4\u6258\u7ed9 OkHttp \u6267\u884c\u3002</li> <li>\u8fd4\u56de <code>Call</code> \u5bf9\u8c61\uff1a\u8fd4\u56de\u4e00\u4e2a Retrofit \u7684 <code>Call</code> \u5bf9\u8c61\uff0c\u4f9b\u8c03\u7528\u8005\u4f7f\u7528\u3002</li> </ol> <p>\u4ee5\u4e0b\u662f <code>InvocationHandler</code> \u7684 <code>invoke</code> \u65b9\u6cd5\u7684\u4f2a\u4ee3\u7801\uff1a</p> <pre><code>@Override\npublic Object invoke(Object proxy, Method method, Object[] args) throws Throwable {\n    // 1. \u89e3\u6790\u65b9\u6cd5\u6ce8\u89e3\uff0c\u751f\u6210 ServiceMethod\n    ServiceMethod&lt;Call&lt;User&gt;&gt; serviceMethod = loadServiceMethod(method);\n\n    // 2. \u521b\u5efa OkHttpCall\n    OkHttpCall&lt;User&gt; okHttpCall = new OkHttpCall&lt;&gt;(serviceMethod, args);\n\n    // 3. \u8fd4\u56de Call \u5bf9\u8c61\n    return okHttpCall;\n}\n</code></pre>"},{"location":"030Android/030ThirdSDKSourceCode/#4_3","title":"4. \u52a8\u6001\u4ee3\u7406\u540e\u7684\u8c03\u7528\u6d41\u7a0b","text":"<p>\u5f53\u6211\u4eec\u8c03\u7528 <code>myApiService.getUser(\"octocat\")</code> \u65f6\uff0c\u5b9e\u9645\u7684\u8c03\u7528\u6d41\u7a0b\u5982\u4e0b\uff1a</p> <ol> <li>\u4ee3\u7406\u5bf9\u8c61\u62e6\u622a\u8c03\u7528\uff1a\u52a8\u6001\u4ee3\u7406\u5bf9\u8c61\u62e6\u622a\u5bf9 <code>getUser</code> \u65b9\u6cd5\u7684\u8c03\u7528\u3002</li> <li>\u8c03\u7528 <code>InvocationHandler.invoke</code>\uff1a\u5c06\u65b9\u6cd5\u8c03\u7528\u8f6c\u53d1\u7ed9 <code>InvocationHandler</code>\u3002</li> <li>\u89e3\u6790\u6ce8\u89e3\u5e76\u521b\u5efa <code>ServiceMethod</code>\uff1aRetrofit \u89e3\u6790 <code>@GET</code> \u548c <code>@Path</code> \u6ce8\u89e3\uff0c\u751f\u6210\u4e00\u4e2a <code>ServiceMethod</code> \u5bf9\u8c61\u3002</li> <li>\u521b\u5efa <code>OkHttpCall</code>\uff1a\u4f7f\u7528 <code>ServiceMethod</code> \u548c\u53c2\u6570\u751f\u6210\u4e00\u4e2a <code>OkHttpCall</code> \u5bf9\u8c61\u3002\u5177\u4f53\u64cd\u4f5c\u662fHttpServiceMethod\u3002</li> <li>\u8fd4\u56de <code>Call</code> \u5bf9\u8c61\uff1a\u5c06 <code>OkHttpCall</code> \u5bf9\u8c61\u8fd4\u56de\u7ed9\u8c03\u7528\u8005\u3002</li> </ol>"},{"location":"030Android/030ThirdSDKSourceCode/#5_1","title":"5. \u603b\u7ed3","text":"<p>\u52a8\u6001\u4ee3\u7406\u7684\u6838\u5fc3\u4f5c\u7528\u662f\u62e6\u622a\u5bf9\u63a5\u53e3\u65b9\u6cd5\u7684\u8c03\u7528\uff0c\u5e76\u5c06\u8fd9\u4e9b\u8c03\u7528\u8f6c\u53d1\u7ed9 Retrofit \u7684\u5185\u90e8\u903b\u8f91\u5904\u7406\u3002\u5177\u4f53\u6765\u8bf4\uff1a</p> <ul> <li>Retrofit \u901a\u8fc7\u52a8\u6001\u4ee3\u7406\u751f\u6210\u4e00\u4e2a\u4ee3\u7406\u5bf9\u8c61\uff0c\u8fd9\u4e2a\u4ee3\u7406\u5bf9\u8c61\u5b9e\u73b0\u4e86 <code>MyApiService</code> \u63a5\u53e3\u3002</li> <li>\u5f53\u8c03\u7528\u63a5\u53e3\u65b9\u6cd5\u65f6\uff0c\u4ee3\u7406\u5bf9\u8c61\u4f1a\u62e6\u622a\u8c03\u7528\uff0c\u5e76\u901a\u8fc7 <code>InvocationHandler</code> \u5904\u7406\u3002</li> <li><code>InvocationHandler</code> \u4f1a\u89e3\u6790\u65b9\u6cd5\u6ce8\u89e3\u3001\u521b\u5efa HTTP \u8bf7\u6c42\uff0c\u5e76\u8fd4\u56de\u4e00\u4e2a <code>Call</code> \u5bf9\u8c61\u3002</li> </ul> <p>\u901a\u8fc7\u52a8\u6001\u4ee3\u7406\uff0cRetrofit \u80fd\u591f\u5c06 HTTP API \u7684\u5b9a\u4e49\u8f6c\u6362\u4e3a Java \u63a5\u53e3\uff0c\u5e76\u81ea\u52a8\u5904\u7406\u7f51\u7edc\u8bf7\u6c42\u7684\u7ec6\u8282\uff0c\u6781\u5927\u5730\u7b80\u5316\u4e86\u5f00\u53d1\u8005\u7684\u5de5\u4f5c\u3002</p>"},{"location":"030Android/030ThirdSDKSourceCode/#_2","title":"\u52a8\u6001\u4ee3\u7406\u7684\u5bf9\u8c61\u662f\u5426\u5728\u5185\u5b58\u4e2d\uff1f","text":"<p>\u662f\u7684\uff0c\u52a8\u6001\u4ee3\u7406\u751f\u6210\u7684\u4ee3\u7406\u5bf9\u8c61\u662f\u5728\u5185\u5b58\u4e2d\u7684\u3002\u5177\u4f53\u6765\u8bf4\uff0c\u5f53\u8c03\u7528 <code>Retrofit.create(MyApiService.class)</code> \u65f6\uff0cRetrofit \u4f1a\u901a\u8fc7 Java \u7684 <code>Proxy.newProxyInstance</code> \u65b9\u6cd5\u5728\u5185\u5b58\u4e2d\u52a8\u6001\u751f\u6210\u4e00\u4e2a\u4ee3\u7406\u5bf9\u8c61\u3002\u8fd9\u4e2a\u4ee3\u7406\u5bf9\u8c61\u5b9e\u73b0\u4e86\u6307\u5b9a\u7684\u63a5\u53e3\uff08\u5982 <code>MyApiService</code>\uff09\uff0c\u5e76\u4e14\u4f1a\u62e6\u622a\u6240\u6709\u5bf9\u63a5\u53e3\u65b9\u6cd5\u7684\u8c03\u7528\uff0c\u5c06\u5176\u8f6c\u53d1\u7ed9 <code>InvocationHandler</code> \u5904\u7406\u3002</p>"},{"location":"030Android/030ThirdSDKSourceCode/#1_4","title":"1. \u52a8\u6001\u4ee3\u7406\u5bf9\u8c61\u7684\u751f\u6210","text":"<p>\u52a8\u6001\u4ee3\u7406\u5bf9\u8c61\u7684\u751f\u6210\u662f\u901a\u8fc7 <code>Proxy.newProxyInstance</code> \u65b9\u6cd5\u5b8c\u6210\u7684\u3002\u8fd9\u4e2a\u65b9\u6cd5\u4f1a\u5728\u5185\u5b58\u4e2d\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u5bf9\u8c61\uff0c\u8be5\u5bf9\u8c61\u5b9e\u73b0\u4e86\u6307\u5b9a\u7684\u63a5\u53e3\u3002\u4ee5\u4e0b\u662f <code>Proxy.newProxyInstance</code> \u7684\u6838\u5fc3\u903b\u8f91\uff1a</p> <pre><code>public static Object newProxyInstance(\n    ClassLoader loader,\n    Class&lt;?&gt;[] interfaces,\n    InvocationHandler h) {\n    // 1. \u751f\u6210\u4ee3\u7406\u7c7b\u7684\u5b57\u8282\u7801\n    Class&lt;?&gt; cl = getProxyClass0(loader, interfaces);\n    // 2. \u901a\u8fc7\u53cd\u5c04\u521b\u5efa\u4ee3\u7406\u5bf9\u8c61\n    final Constructor&lt;?&gt; cons = cl.getConstructor(InvocationHandler.class);\n    return cons.newInstance(h);\n}\n</code></pre> <ul> <li><code>ClassLoader loader</code>\uff1a\u7528\u4e8e\u52a0\u8f7d\u4ee3\u7406\u7c7b\u7684\u7c7b\u52a0\u8f7d\u5668\u3002</li> <li><code>Class&lt;?&gt;[] interfaces</code>\uff1a\u4ee3\u7406\u7c7b\u9700\u8981\u5b9e\u73b0\u7684\u63a5\u53e3\u5217\u8868\u3002</li> <li><code>InvocationHandler h</code>\uff1a\u5904\u7406\u4ee3\u7406\u5bf9\u8c61\u65b9\u6cd5\u8c03\u7528\u7684\u5904\u7406\u5668\u3002</li> </ul> <p>\u751f\u6210\u7684\u4ee3\u7406\u5bf9\u8c61\u5728\u5185\u5b58\u4e2d\uff0c\u5e76\u4e14\u53ef\u4ee5\u901a\u8fc7\u5f15\u7528\u6765\u8bbf\u95ee\u3002</p>"},{"location":"030Android/030ThirdSDKSourceCode/#2_4","title":"2. \u4ee3\u7406\u5bf9\u8c61\u7684\u5185\u5b58\u7ed3\u6784","text":"<p>\u4ee3\u7406\u5bf9\u8c61\u5728\u5185\u5b58\u4e2d\u7684\u7ed3\u6784\u5927\u81f4\u5982\u4e0b\uff1a</p> <ul> <li>\u4ee3\u7406\u7c7b\uff1a<code>Proxy.newProxyInstance</code> \u4f1a\u52a8\u6001\u751f\u6210\u4e00\u4e2a\u7c7b\uff0c\u8fd9\u4e2a\u7c7b\u5b9e\u73b0\u4e86\u6307\u5b9a\u7684\u63a5\u53e3\uff08\u5982 <code>MyApiService</code>\uff09\u3002</li> <li>\u4ee3\u7406\u5bf9\u8c61\uff1a\u751f\u6210\u7684\u4ee3\u7406\u7c7b\u7684\u4e00\u4e2a\u5b9e\u4f8b\uff0c\u6301\u6709 <code>InvocationHandler</code> \u7684\u5f15\u7528\u3002</li> <li><code>InvocationHandler</code>\uff1a\u8d1f\u8d23\u5904\u7406\u4ee3\u7406\u5bf9\u8c61\u7684\u65b9\u6cd5\u8c03\u7528\u3002</li> </ul> <p>\u4ee5\u4e0b\u662f\u4e00\u4e2a\u7b80\u5316\u7684\u5185\u5b58\u7ed3\u6784\u793a\u610f\u56fe\uff1a</p> <pre><code>+-------------------+\n| \u4ee3\u7406\u5bf9\u8c61           |\n|-------------------|\n| InvocationHandler | --&gt; \u6307\u5411 Retrofit \u63d0\u4f9b\u7684 InvocationHandler \u5b9e\u4f8b\n| \u63a5\u53e3\u65b9\u6cd5\u5b9e\u73b0       | --&gt; \u6240\u6709\u65b9\u6cd5\u8c03\u7528\u90fd\u4f1a\u8f6c\u53d1\u7ed9 InvocationHandler\n+-------------------+\n</code></pre>"},{"location":"030Android/030ThirdSDKSourceCode/#3_3","title":"3. \u4ee3\u7406\u5bf9\u8c61\u7684\u4f7f\u7528","text":"<p>\u5f53\u6211\u4eec\u8c03\u7528 <code>Retrofit.create(MyApiService.class)</code> \u65f6\uff0cRetrofit \u4f1a\u8fd4\u56de\u4e00\u4e2a\u4ee3\u7406\u5bf9\u8c61\u3002\u8fd9\u4e2a\u4ee3\u7406\u5bf9\u8c61\u5728\u5185\u5b58\u4e2d\uff0c\u53ef\u4ee5\u901a\u8fc7\u5f15\u7528\u6765\u8bbf\u95ee\u3002\u4f8b\u5982\uff1a</p> <pre><code>MyApiService myApiService = retrofit.create(MyApiService.class);\n</code></pre> <p>\u6b64\u65f6\uff0c<code>myApiService</code> \u662f\u4e00\u4e2a\u52a8\u6001\u751f\u6210\u7684\u4ee3\u7406\u5bf9\u8c61\uff0c\u5b83\u5b9e\u73b0\u4e86 <code>MyApiService</code> \u63a5\u53e3\u3002\u5f53\u6211\u4eec\u8c03\u7528 <code>myApiService.getUser(\"octocat\")</code> \u65f6\uff0c\u4ee3\u7406\u5bf9\u8c61\u4f1a\u62e6\u622a\u8fd9\u4e2a\u8c03\u7528\uff0c\u5e76\u5c06\u5176\u8f6c\u53d1\u7ed9 <code>InvocationHandler</code>\u3002</p>"},{"location":"030Android/030ThirdSDKSourceCode/#4_4","title":"4. \u4ee3\u7406\u5bf9\u8c61\u7684\u751f\u547d\u5468\u671f","text":"<ul> <li>\u521b\u5efa\uff1a\u4ee3\u7406\u5bf9\u8c61\u5728\u8c03\u7528 <code>Retrofit.create</code> \u65f6\u521b\u5efa\uff0c\u5e76\u5b58\u50a8\u5728\u5185\u5b58\u4e2d\u3002</li> <li>\u4f7f\u7528\uff1a\u901a\u8fc7\u5f15\u7528\uff08\u5982 <code>myApiService</code>\uff09\u8bbf\u95ee\u4ee3\u7406\u5bf9\u8c61\uff0c\u5e76\u8c03\u7528\u5176\u65b9\u6cd5\u3002</li> <li>\u9500\u6bc1\uff1a\u5f53\u4ee3\u7406\u5bf9\u8c61\u4e0d\u518d\u88ab\u5f15\u7528\u65f6\uff0cJava \u7684\u5783\u573e\u56de\u6536\u5668\uff08GC\uff09\u4f1a\u5c06\u5176\u4ece\u5185\u5b58\u4e2d\u56de\u6536\u3002</li> </ul>"},{"location":"030Android/030ThirdSDKSourceCode/#5_2","title":"5. \u52a8\u6001\u4ee3\u7406\u7684\u6027\u80fd\u5f00\u9500","text":"<p>\u52a8\u6001\u4ee3\u7406\u7684\u751f\u6210\u548c\u8c03\u7528\u4f1a\u5e26\u6765\u4e00\u5b9a\u7684\u6027\u80fd\u5f00\u9500\uff0c\u4e3b\u8981\u5305\u62ec\uff1a</p> <ol> <li>\u7c7b\u751f\u6210\u5f00\u9500\uff1a<code>Proxy.newProxyInstance</code> \u9700\u8981\u52a8\u6001\u751f\u6210\u4ee3\u7406\u7c7b\u7684\u5b57\u8282\u7801\u3002</li> <li>\u65b9\u6cd5\u8c03\u7528\u5f00\u9500\uff1a\u6bcf\u6b21\u8c03\u7528\u4ee3\u7406\u5bf9\u8c61\u7684\u65b9\u6cd5\u65f6\uff0c\u90fd\u9700\u8981\u901a\u8fc7 <code>InvocationHandler</code> \u8f6c\u53d1\u3002</li> </ol> <p>\u4e0d\u8fc7\uff0c\u8fd9\u4e9b\u5f00\u9500\u5728\u73b0\u4ee3 JVM \u4e2d\u901a\u5e38\u662f\u53ef\u4ee5\u63a5\u53d7\u7684\uff0c\u5c24\u5176\u662f\u5728\u7f51\u7edc\u8bf7\u6c42\u8fd9\u79cd I/O \u5bc6\u96c6\u578b\u64cd\u4f5c\u4e2d\uff0c\u52a8\u6001\u4ee3\u7406\u7684\u5f00\u9500\u76f8\u5bf9\u8f83\u5c0f\u3002</p>"},{"location":"030Android/030ThirdSDKSourceCode/#6_1","title":"6. \u603b\u7ed3","text":"<ul> <li>\u52a8\u6001\u4ee3\u7406\u751f\u6210\u7684\u4ee3\u7406\u5bf9\u8c61\u662f\u5728\u5185\u5b58\u4e2d\u7684\uff0c\u901a\u8fc7 <code>Proxy.newProxyInstance</code> \u65b9\u6cd5\u52a8\u6001\u521b\u5efa\u3002</li> <li>\u4ee3\u7406\u5bf9\u8c61\u5b9e\u73b0\u4e86\u6307\u5b9a\u7684\u63a5\u53e3\uff08\u5982 <code>MyApiService</code>\uff09\uff0c\u5e76\u6301\u6709 <code>InvocationHandler</code> \u7684\u5f15\u7528\u3002</li> <li>\u4ee3\u7406\u5bf9\u8c61\u7684\u65b9\u6cd5\u8c03\u7528\u4f1a\u88ab\u62e6\u622a\uff0c\u5e76\u8f6c\u53d1\u7ed9 <code>InvocationHandler</code> \u5904\u7406\u3002</li> <li>\u4ee3\u7406\u5bf9\u8c61\u7684\u751f\u547d\u5468\u671f\u7531 JVM \u7ba1\u7406\uff0c\u5f53\u4e0d\u518d\u88ab\u5f15\u7528\u65f6\u4f1a\u88ab\u5783\u573e\u56de\u6536\u3002</li> </ul> <p>\u901a\u8fc7\u52a8\u6001\u4ee3\u7406\uff0cRetrofit \u80fd\u591f\u5c06 HTTP API \u7684\u5b9a\u4e49\u8f6c\u6362\u4e3a Java \u63a5\u53e3\uff0c\u5e76\u81ea\u52a8\u5904\u7406\u7f51\u7edc\u8bf7\u6c42\u7684\u7ec6\u8282\uff0c\u6781\u5927\u5730\u7b80\u5316\u4e86\u5f00\u53d1\u8005\u7684\u5de5\u4f5c\u3002</p>"},{"location":"030Android/030ThirdSDKSourceCode/#_3","title":"\u5c06\u52a8\u6001\u4ee3\u7406\u5bf9\u8c61\u6301\u4e45\u5316\u5230\u672c\u5730\u3002","text":"<ol> <li>\u83b7\u53d6\u52a8\u6001\u4ee3\u7406\u7c7b\u7684\u5b57\u8282\u7801 Java \u7684\u52a8\u6001\u4ee3\u7406\u7c7b\u662f\u901a\u8fc7 Proxy.newProxyInstance \u52a8\u6001\u751f\u6210\u7684\uff0c\u5b83\u4eec\u7684\u5b57\u8282\u7801\u5e76\u4e0d\u76f4\u63a5\u5b58\u50a8\u5728\u78c1\u76d8\u4e0a\u3002\u4f46\u662f\uff0c\u4f60\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u65b9\u6cd5\u83b7\u53d6\u8fd9\u4e9b\u5b57\u8282\u7801\uff1a</li> </ol> <p>\u65b9\u6cd5 1\uff1a\u4f7f\u7528 ProxyGenerator \u751f\u6210\u5b57\u8282\u7801 Java \u63d0\u4f9b\u4e86\u4e00\u4e2a\u5185\u90e8\u5de5\u5177\u7c7b sun.misc.ProxyGenerator\uff0c\u53ef\u4ee5\u7528\u6765\u751f\u6210\u52a8\u6001\u4ee3\u7406\u7c7b\u7684\u5b57\u8282\u7801\u3002\u4f60\u53ef\u4ee5\u901a\u8fc7\u53cd\u5c04\u8c03\u7528\u8fd9\u4e2a\u5de5\u5177\u7c7b\uff0c\u5c06\u751f\u6210\u7684\u5b57\u8282\u7801\u4fdd\u5b58\u5230\u6587\u4ef6\u4e2d\u3002</p> <p>\u8fd0\u884c\u4e0a\u8ff0\u4ee3\u7801\u540e\uff0c\u4f60\u4f1a\u5728\u5f53\u524d\u76ee\u5f55\u4e0b\u770b\u5230\u4e00\u4e2a\u540d\u4e3a GeneratedProxy.class \u7684\u6587\u4ef6\uff0c\u8fd9\u5c31\u662f\u52a8\u6001\u751f\u6210\u7684\u4ee3\u7406\u7c7b\u7684\u5b57\u8282\u7801\u3002</p> <p>\u65b9\u6cd5 2\uff1a\u4f7f\u7528\u5b57\u8282\u7801\u64cd\u4f5c\u5e93\uff08\u5982 ASM \u6216 ByteBuddy\uff09 \u5982\u679c\u4f60\u9700\u8981\u66f4\u7075\u6d3b\u5730\u64cd\u4f5c\u5b57\u8282\u7801\uff0c\u53ef\u4ee5\u4f7f\u7528\u5b57\u8282\u7801\u64cd\u4f5c\u5e93\uff08\u5982 ASM \u6216 ByteBuddy\uff09\u6765\u751f\u6210\u6216\u4fee\u6539\u52a8\u6001\u4ee3\u7406\u7c7b\u7684\u5b57\u8282\u7801\u3002</p> <ol> <li>\u53cd\u7f16\u8bd1\u5b57\u8282\u7801\u6587\u4ef6 \u751f\u6210\u7684 .class \u6587\u4ef6\u662f\u5b57\u8282\u7801\u6587\u4ef6\uff0c\u4e0d\u80fd\u76f4\u63a5\u9605\u8bfb\u3002\u4f60\u53ef\u4ee5\u4f7f\u7528\u53cd\u7f16\u8bd1\u5de5\u5177\u5c06\u5176\u8f6c\u6362\u4e3a Java \u6e90\u4ee3\u7801\u3002\u5e38\u7528\u7684\u53cd\u7f16\u8bd1\u5de5\u5177\u6709\uff1a</li> </ol> <p>JD-GUI\uff1a\u4e00\u4e2a\u56fe\u5f62\u5316\u5de5\u5177\uff0c\u53ef\u4ee5\u76f4\u63a5\u6253\u5f00 .class \u6587\u4ef6\u5e76\u67e5\u770b\u53cd\u7f16\u8bd1\u540e\u7684\u4ee3\u7801\u3002</p> <p>CFR\uff1a\u4e00\u4e2a\u547d\u4ee4\u884c\u5de5\u5177\uff0c\u53ef\u4ee5\u5c06 .class \u6587\u4ef6\u53cd\u7f16\u8bd1\u4e3a Java \u6e90\u4ee3\u7801\u3002</p> <p>Jadx\uff1a\u4e00\u4e2a\u5f3a\u5927\u7684\u53cd\u7f16\u8bd1\u5de5\u5177\uff0c\u652f\u6301\u5c06 .class \u6587\u4ef6\u6216 .jar \u6587\u4ef6\u53cd\u7f16\u8bd1\u4e3a Java \u4ee3\u7801\u3002</p>"},{"location":"030Android/030ThirdSDKSourceCode/#glide","title":"Glide\u6e90\u7801\u89e3\u6790","text":"\u7b54\u6848 <p>https://juejin.cn/post/6844903986412126216</p> <p>Glide \u662f\u4e00\u4e2a\u5e7f\u6cdb\u4f7f\u7528\u7684 Android \u56fe\u7247\u52a0\u8f7d\u5e93\uff0c\u5176\u6e90\u7801\u8bbe\u8ba1\u7cbe\u826f\uff0c\u5177\u6709\u9ad8\u6548\u7684\u56fe\u7247\u52a0\u8f7d\u548c\u7f13\u5b58\u673a\u5236\u3002\u4ee5\u4e0b\u662f\u4ece\u6e90\u7801\u8c03\u5ea6\u89d2\u5ea6\u5bf9 Glide \u6846\u67b6\u7684\u5206\u6790\uff0c\u91cd\u70b9\u56f4\u7ed5\u5176\u6838\u5fc3\u8c03\u5ea6\u673a\u5236\u5c55\u5f00\u3002</p>"},{"location":"030Android/030ThirdSDKSourceCode/#1-glide","title":"1. Glide \u7684\u6838\u5fc3\u8c03\u5ea6\u673a\u5236","text":"<p>Glide \u7684\u8c03\u5ea6\u673a\u5236\u4e3b\u8981\u56f4\u7ed5\u4ee5\u4e0b\u51e0\u4e2a\u6838\u5fc3\u7ec4\u4ef6\uff1a - RequestManager\uff1a\u8d1f\u8d23\u7ba1\u7406\u56fe\u7247\u8bf7\u6c42\u7684\u751f\u547d\u5468\u671f\u3002 - Engine\uff1a\u8d1f\u8d23\u8c03\u5ea6\u56fe\u7247\u52a0\u8f7d\u4efb\u52a1\u3002 - DecodeJob\uff1a\u8d1f\u8d23\u5177\u4f53\u7684\u56fe\u7247\u89e3\u7801\u548c\u8f6c\u6362\u4efb\u52a1\u3002 - ExecutorService\uff1a\u7528\u4e8e\u7ba1\u7406\u7ebf\u7a0b\u6c60\uff0c\u6267\u884c\u5f02\u6b65\u4efb\u52a1\u3002 - ResourceCacheGenerator \u548c DataCacheGenerator\uff1a\u8d1f\u8d23\u4ece\u7f13\u5b58\u4e2d\u83b7\u53d6\u8d44\u6e90\u3002 - SourceGenerator\uff1a\u8d1f\u8d23\u4ece\u539f\u59cb\u6570\u636e\u6e90\uff08\u5982\u7f51\u7edc\u3001\u6587\u4ef6\uff09\u52a0\u8f7d\u8d44\u6e90\u3002</p>"},{"location":"030Android/030ThirdSDKSourceCode/#2_5","title":"2. \u8c03\u5ea6\u6d41\u7a0b\u5206\u6790","text":"<p>\u4ee5\u4e0b\u662f Glide \u56fe\u7247\u52a0\u8f7d\u7684\u8c03\u5ea6\u6d41\u7a0b\uff1a</p>"},{"location":"030Android/030ThirdSDKSourceCode/#1_5","title":"(1) \u8bf7\u6c42\u53d1\u8d77","text":"<ul> <li>\u5f53\u8c03\u7528 <code>Glide.with(context).load(url).into(imageView)</code> \u65f6\uff0cGlide \u4f1a\u521b\u5efa\u4e00\u4e2a <code>Request</code> \u5bf9\u8c61\u3002</li> <li><code>RequestManager</code> \u8d1f\u8d23\u7ba1\u7406\u8bf7\u6c42\u7684\u751f\u547d\u5468\u671f\uff0c\u786e\u4fdd\u8bf7\u6c42\u4e0e Activity/Fragment \u7684\u751f\u547d\u5468\u671f\u7ed1\u5b9a\u3002</li> </ul>"},{"location":"030Android/030ThirdSDKSourceCode/#2_6","title":"(2) \u4efb\u52a1\u8c03\u5ea6","text":"<ul> <li><code>RequestManager</code> \u5c06\u8bf7\u6c42\u4ea4\u7ed9 <code>Engine</code> \u5904\u7406\u3002</li> <li><code>Engine</code> \u8d1f\u8d23\u8c03\u5ea6\u4efb\u52a1\uff0c\u9996\u5148\u68c0\u67e5\u5185\u5b58\u7f13\u5b58\uff08ActiveResources \u548c MemoryCache\uff09\u662f\u5426\u6709\u53ef\u7528\u7684\u8d44\u6e90\u3002</li> <li>\u5982\u679c\u6709\uff0c\u76f4\u63a5\u8fd4\u56de\u8d44\u6e90\u3002</li> <li>\u5982\u679c\u6ca1\u6709\uff0c\u521b\u5efa\u4e00\u4e2a <code>DecodeJob</code> \u4efb\u52a1\u3002</li> </ul>"},{"location":"030Android/030ThirdSDKSourceCode/#3-decodejob","title":"(3) DecodeJob \u7684\u6267\u884c","text":"<ul> <li><code>DecodeJob</code> \u662f\u4e00\u4e2a <code>Runnable</code>\uff0c\u4f1a\u88ab\u63d0\u4ea4\u5230\u7ebf\u7a0b\u6c60\u4e2d\u6267\u884c\u3002</li> <li><code>DecodeJob</code> \u7684\u6267\u884c\u5206\u4e3a\u591a\u4e2a\u9636\u6bb5\uff1a</li> <li>\u4ece\u7f13\u5b58\u52a0\u8f7d\uff1a<ul> <li>\u4f7f\u7528 <code>ResourceCacheGenerator</code> \u548c <code>DataCacheGenerator</code> \u68c0\u67e5\u78c1\u76d8\u7f13\u5b58\u3002</li> <li>\u5982\u679c\u7f13\u5b58\u547d\u4e2d\uff0c\u76f4\u63a5\u89e3\u7801\u5e76\u8fd4\u56de\u8d44\u6e90\u3002</li> </ul> </li> <li>\u4ece\u6570\u636e\u6e90\u52a0\u8f7d\uff1a<ul> <li>\u5982\u679c\u7f13\u5b58\u672a\u547d\u4e2d\uff0c\u4f7f\u7528 <code>SourceGenerator</code> \u4ece\u539f\u59cb\u6570\u636e\u6e90\uff08\u5982\u7f51\u7edc\uff09\u52a0\u8f7d\u6570\u636e\u3002</li> </ul> </li> <li>\u89e3\u7801\u548c\u8f6c\u6362\uff1a<ul> <li>\u52a0\u8f7d\u5230\u7684\u539f\u59cb\u6570\u636e\u4f1a\u88ab\u89e3\u7801\u4e3a Bitmap \u6216\u5176\u4ed6\u8d44\u6e90\u7c7b\u578b\u3002</li> <li>\u6839\u636e\u914d\u7f6e\u7684 <code>Transformation</code> \u5bf9\u8d44\u6e90\u8fdb\u884c\u8f6c\u6362\uff08\u5982\u88c1\u526a\u3001\u5706\u89d2\u7b49\uff09\u3002</li> </ul> </li> </ul>"},{"location":"030Android/030ThirdSDKSourceCode/#4_5","title":"(4) \u8d44\u6e90\u5206\u53d1","text":"<ul> <li>\u5f53 <code>DecodeJob</code> \u5b8c\u6210\u540e\uff0c\u8d44\u6e90\u4f1a\u88ab\u4f20\u9012\u5230\u4e3b\u7ebf\u7a0b\u3002</li> <li><code>EngineJob</code> \u8d1f\u8d23\u5c06\u8d44\u6e90\u5206\u53d1\u7ed9 <code>Target</code>\uff08\u901a\u5e38\u662f <code>ImageViewTarget</code>\uff09\uff0c\u6700\u7ec8\u663e\u793a\u5230 <code>ImageView</code> \u4e0a\u3002</li> </ul>"},{"location":"030Android/030ThirdSDKSourceCode/#3_4","title":"3. \u7ebf\u7a0b\u6c60\u4e0e\u5e76\u53d1\u63a7\u5236","text":"<p>Glide \u4f7f\u7528\u591a\u4e2a\u7ebf\u7a0b\u6c60\u6765\u7ba1\u7406\u4efb\u52a1\u7684\u6267\u884c\uff1a - DiskCacheExecutor\uff1a\u7528\u4e8e\u6267\u884c\u78c1\u76d8\u7f13\u5b58\u76f8\u5173\u7684\u4efb\u52a1\uff08\u5982\u8bfb\u53d6\u7f13\u5b58\uff09\u3002 - SourceExecutor\uff1a\u7528\u4e8e\u6267\u884c\u4ece\u6570\u636e\u6e90\u52a0\u8f7d\u6570\u636e\u7684\u4efb\u52a1\uff08\u5982\u7f51\u7edc\u8bf7\u6c42\uff09\u3002 - AnimationExecutor\uff1a\u7528\u4e8e\u6267\u884c\u52a8\u753b\u76f8\u5173\u7684\u4efb\u52a1\u3002 - MainThreadExecutor\uff1a\u7528\u4e8e\u5728\u4e3b\u7ebf\u7a0b\u4e2d\u5206\u53d1\u7ed3\u679c\u3002</p> <p>\u8fd9\u4e9b\u7ebf\u7a0b\u6c60\u7684\u914d\u7f6e\u548c\u7ba1\u7406\u7531 <code>GlideExecutor</code> \u7c7b\u8d1f\u8d23\uff0c\u786e\u4fdd\u4efb\u52a1\u7684\u9ad8\u6548\u6267\u884c\u548c\u8d44\u6e90\u5408\u7406\u5229\u7528\u3002</p>"},{"location":"030Android/030ThirdSDKSourceCode/#4_6","title":"4. \u7f13\u5b58\u673a\u5236\u4e0e\u8c03\u5ea6","text":"<p>Glide \u7684\u7f13\u5b58\u673a\u5236\u662f\u5176\u9ad8\u6548\u8c03\u5ea6\u7684\u5173\u952e\uff1a - ActiveResources\uff1a\u5b58\u50a8\u5f53\u524d\u6b63\u5728\u4f7f\u7528\u7684\u8d44\u6e90\uff0c\u91c7\u7528\u5f31\u5f15\u7528\u673a\u5236\uff0c\u907f\u514d\u5185\u5b58\u6cc4\u6f0f\u3002 - MemoryCache\uff1a\u5b58\u50a8\u6700\u8fd1\u4f7f\u7528\u8fc7\u7684\u8d44\u6e90\uff0c\u91c7\u7528 LRU \u7b97\u6cd5\u7ba1\u7406\u3002 - DiskCache\uff1a\u5b58\u50a8\u78c1\u76d8\u7f13\u5b58\uff0c\u5206\u4e3a\u539f\u59cb\u6570\u636e\u7f13\u5b58\u548c\u8f6c\u6362\u540e\u7684\u8d44\u6e90\u7f13\u5b58\u3002</p> <p>\u5728\u8c03\u5ea6\u8fc7\u7a0b\u4e2d\uff0cGlide \u4f1a\u4f18\u5148\u4ece\u7f13\u5b58\u4e2d\u83b7\u53d6\u8d44\u6e90\uff0c\u907f\u514d\u91cd\u590d\u52a0\u8f7d\u548c\u89e3\u7801\uff0c\u4ece\u800c\u63d0\u5347\u6027\u80fd\u3002</p>"},{"location":"030Android/030ThirdSDKSourceCode/#5_3","title":"5. \u751f\u547d\u5468\u671f\u7ed1\u5b9a","text":"<p>Glide \u901a\u8fc7 <code>RequestManager</code> \u5c06\u56fe\u7247\u8bf7\u6c42\u4e0e Activity/Fragment \u7684\u751f\u547d\u5468\u671f\u7ed1\u5b9a\uff1a - \u5f53 Activity/Fragment \u9500\u6bc1\u65f6\uff0c<code>RequestManager</code> \u4f1a\u81ea\u52a8\u53d6\u6d88\u672a\u5b8c\u6210\u7684\u8bf7\u6c42\uff0c\u5e76\u91ca\u653e\u76f8\u5173\u8d44\u6e90\u3002 - \u8fd9\u79cd\u673a\u5236\u907f\u514d\u4e86\u5185\u5b58\u6cc4\u6f0f\u548c\u65e0\u6548\u7684\u8d44\u6e90\u52a0\u8f7d\u3002</p>"},{"location":"030Android/030ThirdSDKSourceCode/#6_2","title":"6. \u5173\u952e\u6e90\u7801\u7c7b","text":"<p>\u4ee5\u4e0b\u662f\u4e0e\u8c03\u5ea6\u76f8\u5173\u7684\u5173\u952e\u7c7b\uff1a - Glide\uff1a\u5165\u53e3\u7c7b\uff0c\u8d1f\u8d23\u521d\u59cb\u5316\u548c\u7ba1\u7406\u5168\u5c40\u914d\u7f6e\u3002 - RequestManager\uff1a\u7ba1\u7406\u8bf7\u6c42\u7684\u751f\u547d\u5468\u671f\u3002 - Engine\uff1a\u6838\u5fc3\u8c03\u5ea6\u7c7b\uff0c\u8d1f\u8d23\u4efb\u52a1\u7684\u5206\u53d1\u548c\u6267\u884c\u3002 - DecodeJob\uff1a\u8d1f\u8d23\u5177\u4f53\u7684\u89e3\u7801\u548c\u8f6c\u6362\u4efb\u52a1\u3002 - EngineJob\uff1a\u8d1f\u8d23\u7ba1\u7406 <code>DecodeJob</code> \u7684\u6267\u884c\u548c\u8d44\u6e90\u5206\u53d1\u3002 - GlideExecutor\uff1a\u8d1f\u8d23\u7ba1\u7406\u7ebf\u7a0b\u6c60\u3002</p>"},{"location":"030Android/030ThirdSDKSourceCode/#7","title":"7. \u603b\u7ed3","text":"<p>Glide \u7684\u8c03\u5ea6\u673a\u5236\u901a\u8fc7\u4ee5\u4e0b\u8bbe\u8ba1\u5b9e\u73b0\u9ad8\u6548\u56fe\u7247\u52a0\u8f7d\uff1a - \u591a\u7ea7\u7f13\u5b58\u673a\u5236\uff0c\u51cf\u5c11\u91cd\u590d\u52a0\u8f7d\u3002 - \u591a\u7ebf\u7a0b\u6c60\u7ba1\u7406\uff0c\u5408\u7406\u5206\u914d\u8d44\u6e90\u3002 - \u751f\u547d\u5468\u671f\u7ed1\u5b9a\uff0c\u907f\u514d\u5185\u5b58\u6cc4\u6f0f\u3002 - \u6a21\u5757\u5316\u8bbe\u8ba1\uff0c\u804c\u8d23\u6e05\u6670\uff0c\u6613\u4e8e\u6269\u5c55\u3002</p> <p>\u901a\u8fc7\u5206\u6790\u6e90\u7801\uff0c\u53ef\u4ee5\u66f4\u597d\u5730\u7406\u89e3 Glide \u7684\u5de5\u4f5c\u539f\u7406\uff0c\u5e76\u5728\u5b9e\u9645\u5f00\u53d1\u4e2d\u4f18\u5316\u5176\u4f7f\u7528\u3002</p>"},{"location":"030Android/030ThirdSDKSourceCode/#gson","title":"Gson\u6e90\u7801\u89e3\u6790","text":"\u7b54\u6848 <p>Gson \u662f Google \u63d0\u4f9b\u7684\u4e00\u4e2a\u7528\u4e8e\u5728 Java \u5bf9\u8c61\u548c JSON \u6570\u636e\u4e4b\u95f4\u8fdb\u884c\u5e8f\u5217\u5316\u548c\u53cd\u5e8f\u5217\u5316\u7684\u5f00\u6e90\u5e93\u3002\u5b83\u5e7f\u6cdb\u7528\u4e8e Android \u5f00\u53d1\u4e2d\uff0c\u7528\u4e8e\u5904\u7406 JSON \u6570\u636e\u3002\u4e0b\u9762\u662f\u5bf9 Gson \u6e90\u7801\u7684\u7b80\u8981\u89e3\u6790\uff0c\u5e2e\u52a9\u4f60\u7406\u89e3\u5176\u6838\u5fc3\u5b9e\u73b0\u539f\u7406\u3002</p>"},{"location":"030Android/030ThirdSDKSourceCode/#1-gson","title":"1. Gson \u7684\u6838\u5fc3\u7c7b","text":"<p>Gson \u7684\u6838\u5fc3\u7c7b\u662f <code>com.google.gson.Gson</code>\uff0c\u5b83\u63d0\u4f9b\u4e86\u4e3b\u8981\u7684 API \u7528\u4e8e\u5e8f\u5217\u5316\u548c\u53cd\u5e8f\u5217\u5316\u3002</p>"},{"location":"030Android/030ThirdSDKSourceCode/#11-gson","title":"1.1 Gson \u7c7b\u7684\u4e3b\u8981\u65b9\u6cd5","text":"<ul> <li><code>toJson(Object src)</code>: \u5c06 Java \u5bf9\u8c61\u8f6c\u6362\u4e3a JSON \u5b57\u7b26\u4e32\u3002</li> <li><code>fromJson(String json, Class&lt;T&gt; classOfT)</code>: \u5c06 JSON \u5b57\u7b26\u4e32\u8f6c\u6362\u4e3a Java \u5bf9\u8c61\u3002</li> <li><code>toJson(Object src, Appendable writer)</code>: \u5c06 Java \u5bf9\u8c61\u8f6c\u6362\u4e3a JSON \u5e76\u5199\u5165\u5230 <code>Appendable</code>\uff08\u5982 <code>StringWriter</code>\uff09\u3002</li> <li><code>fromJson(Reader json, Class&lt;T&gt; classOfT)</code>: \u4ece <code>Reader</code> \u4e2d\u8bfb\u53d6 JSON \u6570\u636e\u5e76\u8f6c\u6362\u4e3a Java \u5bf9\u8c61\u3002</li> </ul>"},{"location":"030Android/030ThirdSDKSourceCode/#2-gson","title":"2. Gson \u7684\u6838\u5fc3\u7ec4\u4ef6","text":"<p>Gson \u7684\u5b9e\u73b0\u4f9d\u8d56\u4e8e\u51e0\u4e2a\u6838\u5fc3\u7ec4\u4ef6\uff1a</p>"},{"location":"030Android/030ThirdSDKSourceCode/#21-jsonelement","title":"2.1 <code>JsonElement</code> \u53ca\u5176\u5b50\u7c7b","text":"<p><code>JsonElement</code> \u662f Gson \u4e2d\u8868\u793a JSON \u5143\u7d20\u7684\u57fa\u7c7b\uff0c\u5b83\u6709\u4ee5\u4e0b\u51e0\u4e2a\u5b50\u7c7b\uff1a - <code>JsonObject</code>: \u8868\u793a JSON \u5bf9\u8c61\uff0c\u7c7b\u4f3c\u4e8e Java \u4e2d\u7684 <code>Map&lt;String, JsonElement&gt;</code>\u3002 - <code>JsonArray</code>: \u8868\u793a JSON \u6570\u7ec4\uff0c\u7c7b\u4f3c\u4e8e Java \u4e2d\u7684 <code>List&lt;JsonElement&gt;</code>\u3002 - <code>JsonPrimitive</code>: \u8868\u793a JSON \u7684\u57fa\u672c\u7c7b\u578b\uff08\u5982\u5b57\u7b26\u4e32\u3001\u6570\u5b57\u3001\u5e03\u5c14\u503c\uff09\u3002 - <code>JsonNull</code>: \u8868\u793a JSON \u7684 <code>null</code> \u503c\u3002</p>"},{"location":"030Android/030ThirdSDKSourceCode/#22-typeadapter","title":"2.2 <code>TypeAdapter</code>","text":"<p><code>TypeAdapter</code> \u662f Gson \u4e2d\u7528\u4e8e\u5904\u7406\u7279\u5b9a\u7c7b\u578b\u5e8f\u5217\u5316\u548c\u53cd\u5e8f\u5217\u5316\u7684\u6838\u5fc3\u7c7b\u3002\u5b83\u6709\u4e24\u4e2a\u4e3b\u8981\u65b9\u6cd5\uff1a - <code>write(JsonWriter out, T value)</code>: \u5c06 Java \u5bf9\u8c61\u5199\u5165 JSON\u3002 - <code>read(JsonReader in)</code>: \u4ece JSON \u4e2d\u8bfb\u53d6\u5e76\u8f6c\u6362\u4e3a Java \u5bf9\u8c61\u3002</p> <p>Gson \u4e3a\u5927\u591a\u6570\u5e38\u89c1\u7c7b\u578b\uff08\u5982 <code>String</code>\u3001<code>Integer</code>\u3001<code>Boolean</code> \u7b49\uff09\u63d0\u4f9b\u4e86\u5185\u7f6e\u7684 <code>TypeAdapter</code>\u3002</p>"},{"location":"030Android/030ThirdSDKSourceCode/#23-jsonreader-jsonwriter","title":"2.3 <code>JsonReader</code> \u548c <code>JsonWriter</code>","text":"<ul> <li><code>JsonReader</code>: \u7528\u4e8e\u4ece JSON \u6570\u636e\u6d41\u4e2d\u8bfb\u53d6\u6570\u636e\u3002</li> <li><code>JsonWriter</code>: \u7528\u4e8e\u5c06\u6570\u636e\u5199\u5165 JSON \u6570\u636e\u6d41\u3002</li> </ul> <p>\u8fd9\u4e24\u4e2a\u7c7b\u8d1f\u8d23\u5904\u7406 JSON \u6570\u636e\u7684\u89e3\u6790\u548c\u751f\u6210\u3002</p>"},{"location":"030Android/030ThirdSDKSourceCode/#3-gson","title":"3. Gson \u7684\u5e8f\u5217\u5316\u8fc7\u7a0b","text":"<p>\u5f53\u4f60\u8c03\u7528 <code>Gson.toJson(Object src)</code> \u65f6\uff0cGson \u4f1a\u6267\u884c\u4ee5\u4e0b\u6b65\u9aa4\uff1a 1. \u67e5\u627e\u5408\u9002\u7684 <code>TypeAdapter</code>: Gson \u4f1a\u6839\u636e\u5bf9\u8c61\u7684\u7c7b\u578b\u67e5\u627e\u5bf9\u5e94\u7684 <code>TypeAdapter</code>\u3002\u5982\u679c\u627e\u4e0d\u5230\uff0c\u5b83\u4f1a\u5c1d\u8bd5\u521b\u5efa\u4e00\u4e2a\u65b0\u7684 <code>TypeAdapter</code>\u3002 2. \u4f7f\u7528 <code>JsonWriter</code> \u5199\u5165 JSON: <code>TypeAdapter</code> \u4f1a\u4f7f\u7528 <code>JsonWriter</code> \u5c06 Java \u5bf9\u8c61\u8f6c\u6362\u4e3a JSON \u5b57\u7b26\u4e32\u3002</p>"},{"location":"030Android/030ThirdSDKSourceCode/#4-gson","title":"4. Gson \u7684\u53cd\u5e8f\u5217\u5316\u8fc7\u7a0b","text":"<p>\u5f53\u4f60\u8c03\u7528 <code>Gson.fromJson(String json, Class&lt;T&gt; classOfT)</code> \u65f6\uff0cGson \u4f1a\u6267\u884c\u4ee5\u4e0b\u6b65\u9aa4\uff1a 1. \u67e5\u627e\u5408\u9002\u7684 <code>TypeAdapter</code>: Gson \u4f1a\u6839\u636e\u76ee\u6807\u7c7b\u578b\u67e5\u627e\u5bf9\u5e94\u7684 <code>TypeAdapter</code>\u3002\u5982\u679c\u627e\u4e0d\u5230\uff0c\u5b83\u4f1a\u5c1d\u8bd5\u521b\u5efa\u4e00\u4e2a\u65b0\u7684 <code>TypeAdapter</code>\u3002 2. \u4f7f\u7528 <code>JsonReader</code> \u8bfb\u53d6 JSON: <code>TypeAdapter</code> \u4f1a\u4f7f\u7528 <code>JsonReader</code> \u4ece JSON \u5b57\u7b26\u4e32\u4e2d\u8bfb\u53d6\u6570\u636e\u5e76\u8f6c\u6362\u4e3a Java \u5bf9\u8c61\u3002</p>"},{"location":"030Android/030ThirdSDKSourceCode/#5_4","title":"5. \u81ea\u5b9a\u4e49\u5e8f\u5217\u5316\u548c\u53cd\u5e8f\u5217\u5316","text":"<p>Gson \u5141\u8bb8\u4f60\u901a\u8fc7 <code>TypeAdapter</code> \u6216 <code>JsonSerializer</code>/<code>JsonDeserializer</code> \u81ea\u5b9a\u4e49\u5e8f\u5217\u5316\u548c\u53cd\u5e8f\u5217\u5316\u8fc7\u7a0b\u3002</p>"},{"location":"030Android/030ThirdSDKSourceCode/#51-typeadapter","title":"5.1 \u4f7f\u7528 <code>TypeAdapter</code>","text":"<p>\u4f60\u53ef\u4ee5\u901a\u8fc7\u7ee7\u627f <code>TypeAdapter</code> \u5e76\u91cd\u5199 <code>write</code> \u548c <code>read</code> \u65b9\u6cd5\u6765\u5b9e\u73b0\u81ea\u5b9a\u4e49\u7684\u5e8f\u5217\u5316\u548c\u53cd\u5e8f\u5217\u5316\u903b\u8f91\u3002</p> <pre><code>public class CustomTypeAdapter extends TypeAdapter&lt;MyClass&gt; {\n    @Override\n    public void write(JsonWriter out, MyClass value) throws IOException {\n        // \u81ea\u5b9a\u4e49\u5e8f\u5217\u5316\u903b\u8f91\n    }\n\n    @Override\n    public MyClass read(JsonReader in) throws IOException {\n        // \u81ea\u5b9a\u4e49\u53cd\u5e8f\u5217\u5316\u903b\u8f91\n    }\n}\n</code></pre> <p>\u7136\u540e\u901a\u8fc7 <code>GsonBuilder</code> \u6ce8\u518c\u8fd9\u4e2a <code>TypeAdapter</code>\uff1a</p> <pre><code>Gson gson = new GsonBuilder()\n    .registerTypeAdapter(MyClass.class, new CustomTypeAdapter())\n    .create();\n</code></pre>"},{"location":"030Android/030ThirdSDKSourceCode/#52-jsonserializer-jsondeserializer","title":"5.2 \u4f7f\u7528 <code>JsonSerializer</code> \u548c <code>JsonDeserializer</code>","text":"<p>\u4f60\u4e5f\u53ef\u4ee5\u901a\u8fc7\u5b9e\u73b0 <code>JsonSerializer</code> \u548c <code>JsonDeserializer</code> \u63a5\u53e3\u6765\u81ea\u5b9a\u4e49\u5e8f\u5217\u5316\u548c\u53cd\u5e8f\u5217\u5316\u903b\u8f91\u3002</p> <pre><code>public class CustomSerializer implements JsonSerializer&lt;MyClass&gt; {\n    @Override\n    public JsonElement serialize(MyClass src, Type typeOfSrc, JsonSerializationContext context) {\n        // \u81ea\u5b9a\u4e49\u5e8f\u5217\u5316\u903b\u8f91\n    }\n}\n\npublic class CustomDeserializer implements JsonDeserializer&lt;MyClass&gt; {\n    @Override\n    public MyClass deserialize(JsonElement json, Type typeOfT, JsonDeserializationContext context) throws JsonParseException {\n        // \u81ea\u5b9a\u4e49\u53cd\u5e8f\u5217\u5316\u903b\u8f91\n    }\n}\n</code></pre> <p>\u7136\u540e\u901a\u8fc7 <code>GsonBuilder</code> \u6ce8\u518c\u8fd9\u4e9b\u5e8f\u5217\u5316\u548c\u53cd\u5e8f\u5217\u5316\u5668\uff1a</p> <pre><code>Gson gson = new GsonBuilder()\n    .registerTypeAdapter(MyClass.class, new CustomSerializer())\n    .registerTypeAdapter(MyClass.class, new CustomDeserializer())\n    .create();\n</code></pre>"},{"location":"030Android/030ThirdSDKSourceCode/#6-gson","title":"6. Gson \u7684\u7f13\u5b58\u673a\u5236","text":"<p>Gson \u5185\u90e8\u4f7f\u7528\u4e86\u7f13\u5b58\u673a\u5236\u6765\u63d0\u9ad8\u6027\u80fd\u3002\u4f8b\u5982\uff0c<code>TypeAdapter</code> \u4f1a\u88ab\u7f13\u5b58\u4ee5\u907f\u514d\u91cd\u590d\u521b\u5efa\u3002\u6b64\u5916\uff0cGson \u8fd8\u4f1a\u7f13\u5b58\u53cd\u5c04\u64cd\u4f5c\u7684\u7ed3\u679c\uff0c\u4ee5\u51cf\u5c11\u53cd\u5c04\u8c03\u7528\u7684\u5f00\u9500\u3002</p>"},{"location":"030Android/030ThirdSDKSourceCode/#7-gson","title":"7. Gson \u7684\u7ebf\u7a0b\u5b89\u5168\u6027","text":"<p>Gson \u662f\u7ebf\u7a0b\u5b89\u5168\u7684\uff0c\u4f60\u53ef\u4ee5\u5728\u591a\u7ebf\u7a0b\u73af\u5883\u4e2d\u5171\u4eab\u540c\u4e00\u4e2a <code>Gson</code> \u5b9e\u4f8b\u3002\u8fd9\u662f\u56e0\u4e3a Gson \u5185\u90e8\u7684\u72b6\u6001\u662f\u4e0d\u53ef\u53d8\u7684\uff0c\u4e14\u6240\u6709\u7684\u64cd\u4f5c\u90fd\u662f\u65e0\u72b6\u6001\u7684\u3002</p>"},{"location":"030Android/030ThirdSDKSourceCode/#8-gson","title":"8. Gson \u7684\u6269\u5c55\u6027","text":"<p>Gson \u63d0\u4f9b\u4e86\u591a\u79cd\u6269\u5c55\u70b9\uff0c\u5141\u8bb8\u4f60\u901a\u8fc7\u81ea\u5b9a\u4e49 <code>TypeAdapter</code>\u3001<code>JsonSerializer</code>\u3001<code>JsonDeserializer</code> \u7b49\u6765\u6269\u5c55\u5176\u529f\u80fd\u3002\u6b64\u5916\uff0c\u4f60\u8fd8\u53ef\u4ee5\u901a\u8fc7 <code>GsonBuilder</code> \u914d\u7f6e Gson \u7684\u884c\u4e3a\uff0c\u4f8b\u5982\u8bbe\u7f6e\u65e5\u671f\u683c\u5f0f\u3001\u662f\u5426\u683c\u5f0f\u5316\u8f93\u51fa\u7b49\u3002</p>"},{"location":"030Android/030ThirdSDKSourceCode/#9_1","title":"9. \u603b\u7ed3","text":"<p>Gson \u662f\u4e00\u4e2a\u529f\u80fd\u5f3a\u5927\u4e14\u7075\u6d3b\u7684 JSON \u5904\u7406\u5e93\uff0c\u5b83\u7684\u6838\u5fc3\u5728\u4e8e <code>TypeAdapter</code>\u3001<code>JsonReader</code> \u548c <code>JsonWriter</code>\u3002\u901a\u8fc7\u7406\u89e3\u8fd9\u4e9b\u6838\u5fc3\u7ec4\u4ef6\u7684\u5de5\u4f5c\u539f\u7406\uff0c\u4f60\u53ef\u4ee5\u66f4\u597d\u5730\u4f7f\u7528 Gson\uff0c\u5e76\u5728\u9700\u8981\u65f6\u8fdb\u884c\u81ea\u5b9a\u4e49\u6269\u5c55\u3002</p> <p>\u5e0c\u671b\u8fd9\u4e2a\u89e3\u6790\u5bf9\u4f60\u7406\u89e3 Gson \u7684\u6e90\u7801\u6709\u6240\u5e2e\u52a9\uff01\u5982\u679c\u4f60\u6709\u66f4\u591a\u95ee\u9898\uff0c\u6b22\u8fce\u7ee7\u7eed\u63d0\u95ee\u3002</p>"},{"location":"030Android/030ThirdSDKSourceCode/#leakcanary","title":"\u6e90\u7801\u89d2\u5ea6\u5206\u6790LeakCanary\u5b9e\u73b0\u539f\u7406","text":"\u7b54\u6848 <p>LeakCanary \u662f\u4e00\u4e2a\u7528\u4e8e\u68c0\u6d4b Android \u5e94\u7528\u4e2d\u5185\u5b58\u6cc4\u6f0f\u7684\u5f00\u6e90\u5de5\u5177\u3002\u5b83\u901a\u8fc7\u76d1\u63a7\u5bf9\u8c61\u7684\u5185\u5b58\u5206\u914d\u548c\u56de\u6536\uff0c\u5e2e\u52a9\u5f00\u53d1\u8005\u53d1\u73b0\u6f5c\u5728\u7684\u5185\u5b58\u6cc4\u6f0f\u95ee\u9898\u3002\u4ee5\u4e0b\u662f\u4ece\u6e90\u7801\u89d2\u5ea6\u5206\u6790 LeakCanary \u7684\u5b9e\u73b0\u539f\u7406\u3002</p>"},{"location":"030Android/030ThirdSDKSourceCode/#1_6","title":"1. \u6838\u5fc3\u539f\u7406","text":"<p>LeakCanary \u7684\u6838\u5fc3\u539f\u7406\u662f\u901a\u8fc7 <code>ReferenceQueue</code> \u548c <code>WeakReference</code> \u6765\u76d1\u63a7\u5bf9\u8c61\u7684\u56de\u6536\u60c5\u51b5\u3002\u5177\u4f53\u6b65\u9aa4\u5982\u4e0b\uff1a</p> <ol> <li>\u76d1\u63a7\u5bf9\u8c61\uff1aLeakCanary \u4f1a\u76d1\u63a7 Activity\u3001Fragment \u7b49\u5bf9\u8c61\u3002</li> <li>\u5f31\u5f15\u7528\uff1a\u5c06\u8fd9\u4e9b\u5bf9\u8c61\u5305\u88c5\u5728 <code>WeakReference</code> \u4e2d\uff0c\u5e76\u5173\u8054\u4e00\u4e2a <code>ReferenceQueue</code>\u3002</li> <li>\u68c0\u6d4b\u56de\u6536\uff1a\u5f53\u5bf9\u8c61\u88ab\u56de\u6536\u65f6\uff0c<code>WeakReference</code> \u4f1a\u88ab\u653e\u5165 <code>ReferenceQueue</code> \u4e2d\u3002</li> <li>\u5206\u6790\u6cc4\u6f0f\uff1a\u5982\u679c\u5bf9\u8c61\u6ca1\u6709\u88ab\u56de\u6536\uff0cLeakCanary \u4f1a\u89e6\u53d1\u5185\u5b58\u6cc4\u6f0f\u5206\u6790\u3002</li> </ol>"},{"location":"030Android/030ThirdSDKSourceCode/#2_7","title":"2. \u6e90\u7801\u5206\u6790","text":""},{"location":"030Android/030ThirdSDKSourceCode/#21_1","title":"2.1 \u521d\u59cb\u5316","text":"<p>LeakCanary \u7684\u521d\u59cb\u5316\u901a\u5e38\u5728 <code>Application</code> \u7684 <code>onCreate</code> \u65b9\u6cd5\u4e2d\u5b8c\u6210\uff1a</p> <pre><code>public class MyApplication extends Application {\n    @Override\n    public void onCreate() {\n        super.onCreate();\n        if (LeakCanary.isInAnalyzerProcess(this)) {\n            return;\n        }\n        LeakCanary.install(this);\n    }\n}\n</code></pre> <p><code>LeakCanary.install(this)</code> \u4f1a\u521d\u59cb\u5316 LeakCanary \u7684\u6838\u5fc3\u7ec4\u4ef6\u3002</p>"},{"location":"030Android/030ThirdSDKSourceCode/#22-activity","title":"2.2 \u76d1\u63a7 Activity","text":"<p>LeakCanary \u901a\u8fc7 <code>ActivityRefWatcher</code> \u76d1\u63a7 Activity \u7684\u751f\u547d\u5468\u671f\uff1a</p> <pre><code>public final class ActivityRefWatcher {\n    private final Application application;\n    private final RefWatcher refWatcher;\n\n    public static void install(Application application, RefWatcher refWatcher) {\n        new ActivityRefWatcher(application, refWatcher).watchActivities();\n    }\n\n    private void watchActivities() {\n        application.registerActivityLifecycleCallbacks(lifecycleCallbacks);\n    }\n\n    private final Application.ActivityLifecycleCallbacks lifecycleCallbacks =\n            new Application.ActivityLifecycleCallbacks() {\n                @Override\n                public void onActivityDestroyed(Activity activity) {\n                    refWatcher.watch(activity);\n                }\n                // \u5176\u4ed6\u751f\u547d\u5468\u671f\u65b9\u6cd5\u7701\u7565\n            };\n}\n</code></pre> <p>\u5728 <code>onActivityDestroyed</code> \u65b9\u6cd5\u4e2d\uff0cLeakCanary \u4f1a\u8c03\u7528 <code>refWatcher.watch(activity)</code> \u6765\u76d1\u63a7 Activity \u5bf9\u8c61\u3002</p>"},{"location":"030Android/030ThirdSDKSourceCode/#23-refwatcher","title":"2.3 RefWatcher","text":"<p><code>RefWatcher</code> \u662f LeakCanary \u7684\u6838\u5fc3\u7c7b\uff0c\u8d1f\u8d23\u76d1\u63a7\u5bf9\u8c61\u7684\u56de\u6536\u60c5\u51b5\uff1a</p> <pre><code>public final class RefWatcher {\n    private final WatchExecutor watchExecutor;\n    private final DebuggerControl debuggerControl;\n    private final GcTrigger gcTrigger;\n    private final HeapDumper heapDumper;\n    private final HeapDump.Listener heapDumpListener;\n    private final ExcludedRefs excludedRefs;\n\n    public void watch(Object watchedReference, String referenceName) {\n        if (this == DISABLED) {\n            return;\n        }\n        checkNotNull(watchedReference, \"watchedReference\");\n        checkNotNull(referenceName, \"referenceName\");\n        final long watchStartNanoTime = System.nanoTime();\n        String key = UUID.randomUUID().toString();\n        retainedKeys.add(key);\n        final KeyedWeakReference reference =\n                new KeyedWeakReference(watchedReference, key, referenceName, queue);\n\n        ensureGoneAsync(watchStartNanoTime, reference);\n    }\n\n    private void ensureGoneAsync(final long watchStartNanoTime, final KeyedWeakReference reference) {\n        watchExecutor.execute(new Retryable() {\n            @Override\n            public Retryable.Result run() {\n                return ensureGone(reference, watchStartNanoTime);\n            }\n        });\n    }\n\n    Retryable.Result ensureGone(KeyedWeakReference reference, long watchStartNanoTime) {\n        long gcStartNanoTime = System.nanoTime();\n        long watchDurationMs = NANOSECONDS.toMillis(gcStartNanoTime - watchStartNanoTime);\n\n        removeWeaklyReachableReferences();\n\n        if (gone(reference)) {\n            return Retryable.Result.DONE;\n        }\n\n        gcTrigger.runGc();\n        removeWeaklyReachableReferences();\n\n        if (!gone(reference)) {\n            long startDumpHeap = System.nanoTime();\n            long gcDurationMs = NANOSECONDS.toMillis(startDumpHeap - gcStartNanoTime);\n\n            File heapDumpFile = heapDumper.dumpHeap();\n            if (heapDumpFile == null) {\n                return Retryable.Result.RETRY;\n            }\n\n            long heapDumpDurationMs = NANOSECONDS.toMillis(System.nanoTime() - startDumpHeap);\n            heapDumpListener.analyze(\n                    new HeapDump(heapDumpFile, reference.key, reference.name, excludedRefs, watchDurationMs,\n                            gcDurationMs, heapDumpDurationMs));\n        }\n        return Retryable.Result.DONE;\n    }\n\n    private boolean gone(KeyedWeakReference reference) {\n        return !retainedKeys.contains(reference.key);\n    }\n\n    private void removeWeaklyReachableReferences() {\n        KeyedWeakReference ref;\n        while ((ref = (KeyedWeakReference) queue.poll()) != null) {\n            retainedKeys.remove(ref.key);\n        }\n    }\n}\n</code></pre> <ul> <li>watch \u65b9\u6cd5\uff1a\u5c06\u5bf9\u8c61\u5305\u88c5\u6210 <code>KeyedWeakReference</code>\uff0c\u5e76\u653e\u5165 <code>retainedKeys</code> \u96c6\u5408\u4e2d\u3002</li> <li>ensureGoneAsync \u65b9\u6cd5\uff1a\u5f02\u6b65\u6267\u884c\u5185\u5b58\u6cc4\u6f0f\u68c0\u6d4b\u3002</li> <li>ensureGone \u65b9\u6cd5\uff1a\u68c0\u67e5\u5bf9\u8c61\u662f\u5426\u88ab\u56de\u6536\uff0c\u5982\u679c\u6ca1\u6709\u56de\u6536\uff0c\u5219\u89e6\u53d1 GC \u5e76\u518d\u6b21\u68c0\u67e5\u3002\u5982\u679c\u5bf9\u8c61\u4ecd\u7136\u5b58\u5728\uff0c\u5219\u751f\u6210 Heap Dump \u5e76\u8fdb\u884c\u5206\u6790\u3002</li> <li>removeWeaklyReachableReferences \u65b9\u6cd5\uff1a\u4ece <code>ReferenceQueue</code> \u4e2d\u79fb\u9664\u5df2\u88ab\u56de\u6536\u7684\u5bf9\u8c61\u3002</li> </ul>"},{"location":"030Android/030ThirdSDKSourceCode/#24-heap-dump","title":"2.4 Heap Dump \u5206\u6790","text":"<p>LeakCanary \u4f7f\u7528 <code>HeapAnalyzer</code> \u5206\u6790 Heap Dump \u6587\u4ef6\uff0c\u627e\u51fa\u5185\u5b58\u6cc4\u6f0f\u7684\u6839\u6e90\uff1a</p> <pre><code>public class HeapAnalyzer {\n    public AnalysisResult checkForLeak(File heapDumpFile, String referenceKey) {\n        try {\n            HprofBuffer buffer = new MemoryMappedFileBuffer(heapDumpFile);\n            HprofParser parser = new HprofParser(buffer);\n            Snapshot snapshot = parser.parse();\n            deduplicateGcRoots(snapshot);\n\n            Instance leakingRef = findLeakingReference(referenceKey, snapshot);\n\n            if (leakingRef == null) {\n                return AnalysisResult.noLeak(referenceKey);\n            }\n\n            return findLeakTrace(snapshot, leakingRef);\n        } catch (Throwable e) {\n            return AnalysisResult.failure(e, referenceKey);\n        }\n    }\n\n    private Instance findLeakingReference(String referenceKey, Snapshot snapshot) {\n        ClassObj refClass = snapshot.findClass(KeyedWeakReference.class.getName());\n        List&lt;Instance&gt; leakingRefs = new ArrayList&lt;&gt;();\n        for (Instance instance : refClass.getInstancesList()) {\n            String keyCandidate = asString(instance.getField(\"key\"));\n            if (referenceKey.equals(keyCandidate)) {\n                leakingRefs.add(instance);\n            }\n        }\n        if (leakingRefs.size() == 1) {\n            return leakingRefs.get(0);\n        }\n        return null;\n    }\n\n    private AnalysisResult findLeakTrace(Snapshot snapshot, Instance leakingRef) {\n        ShortestPathFinder pathFinder = new ShortestPathFinder();\n        ShortestPathFinder.Result result = pathFinder.findPath(snapshot, leakingRef);\n        return AnalysisResult.leakDetected(result.leakingNode, result.leakTrace, referenceKey);\n    }\n}\n</code></pre> <ul> <li>checkForLeak \u65b9\u6cd5\uff1a\u89e3\u6790 Heap Dump \u6587\u4ef6\uff0c\u67e5\u627e\u6cc4\u6f0f\u7684\u5f15\u7528\u3002</li> <li>findLeakingReference \u65b9\u6cd5\uff1a\u901a\u8fc7 <code>KeyedWeakReference</code> \u7684 <code>key</code> \u67e5\u627e\u6cc4\u6f0f\u7684\u5bf9\u8c61\u3002</li> <li>findLeakTrace \u65b9\u6cd5\uff1a\u4f7f\u7528 <code>ShortestPathFinder</code> \u67e5\u627e\u6cc4\u6f0f\u8def\u5f84\u3002</li> </ul>"},{"location":"030Android/030ThirdSDKSourceCode/#3_5","title":"3. \u603b\u7ed3","text":"<p>LeakCanary \u901a\u8fc7 <code>WeakReference</code> \u548c <code>ReferenceQueue</code> \u76d1\u63a7\u5bf9\u8c61\u7684\u56de\u6536\u60c5\u51b5\uff0c\u7ed3\u5408 Heap Dump \u5206\u6790\u5de5\u5177\uff0c\u5e2e\u52a9\u5f00\u53d1\u8005\u53d1\u73b0\u548c\u89e3\u51b3\u5185\u5b58\u6cc4\u6f0f\u95ee\u9898\u3002\u5176\u6838\u5fc3\u5728\u4e8e\u5f02\u6b65\u68c0\u6d4b\u3001GC \u89e6\u53d1\u548c Heap Dump \u5206\u6790\uff0c\u786e\u4fdd\u80fd\u591f\u51c6\u786e\u6355\u6349\u5230\u5185\u5b58\u6cc4\u6f0f\u7684\u6839\u6e90\u3002</p>"},{"location":"030Android/030ThirdSDKSourceCode/#httpshttps","title":"HTTPS\u662f\u5982\u4f55\u4fdd\u8bc1\u901a\u4fe1\u5b89\u5168\u7684\uff1f\u6d89\u53ca\u5230Https\u901a\u4fe1\u6d41\u7a0b\u3002","text":"\u7b54\u6848 <p>HTTPS\u901a\u8fc7\u52a0\u5bc6\u548c\u8ba4\u8bc1\u673a\u5236\u786e\u4fdd\u901a\u4fe1\u5b89\u5168\uff0c\u4ee5\u4e0b\u662f\u5176\u6838\u5fc3\u6d41\u7a0b\uff1a</p>"},{"location":"030Android/030ThirdSDKSourceCode/#1_7","title":"1. \u52a0\u5bc6","text":"<ul> <li>\u5bf9\u79f0\u52a0\u5bc6\uff1a\u4f7f\u7528\u540c\u4e00\u5bc6\u94a5\u52a0\u5bc6\u548c\u89e3\u5bc6\u6570\u636e\uff0c\u901f\u5ea6\u5feb\uff0c\u4f46\u5bc6\u94a5\u4f20\u8f93\u5b58\u5728\u98ce\u9669\u3002</li> <li>\u975e\u5bf9\u79f0\u52a0\u5bc6\uff1a\u4f7f\u7528\u516c\u94a5\u52a0\u5bc6\u3001\u79c1\u94a5\u89e3\u5bc6\uff0c\u5b89\u5168\u6027\u9ad8\uff0c\u4f46\u901f\u5ea6\u8f83\u6162\u3002</li> <li>\u6df7\u5408\u52a0\u5bc6\uff1a\u7ed3\u5408\u4e24\u8005\uff0cHTTPS\u5728\u63e1\u624b\u9636\u6bb5\u4f7f\u7528\u975e\u5bf9\u79f0\u52a0\u5bc6\u4ea4\u6362\u5bf9\u79f0\u5bc6\u94a5\uff0c\u540e\u7eed\u901a\u4fe1\u4f7f\u7528\u5bf9\u79f0\u52a0\u5bc6\u3002</li> </ul>"},{"location":"030Android/030ThirdSDKSourceCode/#2_8","title":"2. \u8ba4\u8bc1","text":"<ul> <li>\u6570\u5b57\u8bc1\u4e66\uff1a\u7531CA\u7b7e\u53d1\uff0c\u5305\u542b\u670d\u52a1\u5668\u516c\u94a5\u548c\u8eab\u4efd\u4fe1\u606f\uff0c\u786e\u4fdd\u8bc1\u4e66\u771f\u5b9e\u6709\u6548\u3002</li> <li>CA\uff08\u8bc1\u4e66\u9881\u53d1\u673a\u6784\uff09\uff1a\u8d1f\u8d23\u9a8c\u8bc1\u670d\u52a1\u5668\u8eab\u4efd\u5e76\u7b7e\u53d1\u8bc1\u4e66\u3002</li> </ul>"},{"location":"030Android/030ThirdSDKSourceCode/#https","title":"HTTPS\u901a\u4fe1\u6d41\u7a0b","text":"<ol> <li> <p>\u5ba2\u6237\u7aef\u53d1\u8d77\u8bf7\u6c42\uff1a\u5ba2\u6237\u7aef\u53d1\u9001HTTPS\u8bf7\u6c42\uff0c\u5305\u542b\u652f\u6301\u7684TLS\u7248\u672c\u548c\u52a0\u5bc6\u5957\u4ef6\u3002</p> </li> <li> <p>\u670d\u52a1\u5668\u54cd\u5e94\uff1a\u670d\u52a1\u5668\u8fd4\u56de\u9009\u62e9\u7684TLS\u7248\u672c\u3001\u52a0\u5bc6\u5957\u4ef6\u53ca\u6570\u5b57\u8bc1\u4e66\u3002</p> </li> <li> <p>\u8bc1\u4e66\u9a8c\u8bc1\uff1a\u5ba2\u6237\u7aef\u9a8c\u8bc1\u8bc1\u4e66\u7684\u6709\u6548\u6027\uff0c\u5305\u62ecCA\u7b7e\u540d\u548c\u57df\u540d\u5339\u914d\u3002</p> </li> <li> <p>\u5bc6\u94a5\u4ea4\u6362\uff1a\u5ba2\u6237\u7aef\u751f\u6210\u9884\u4e3b\u5bc6\u94a5\uff0c\u7528\u670d\u52a1\u5668\u516c\u94a5\u52a0\u5bc6\u540e\u53d1\u9001\uff0c\u670d\u52a1\u5668\u7528\u79c1\u94a5\u89e3\u5bc6\u3002</p> </li> <li> <p>\u4f1a\u8bdd\u5bc6\u94a5\u751f\u6210\uff1a\u53cc\u65b9\u4f7f\u7528\u9884\u4e3b\u5bc6\u94a5\u751f\u6210\u76f8\u540c\u7684\u4f1a\u8bdd\u5bc6\u94a5\uff0c\u7528\u4e8e\u5bf9\u79f0\u52a0\u5bc6\u3002</p> </li> <li> <p>\u52a0\u5bc6\u901a\u4fe1\uff1a\u4f7f\u7528\u4f1a\u8bdd\u5bc6\u94a5\u52a0\u5bc6\u548c\u89e3\u5bc6\u6570\u636e\uff0c\u786e\u4fdd\u4f20\u8f93\u5b89\u5168\u3002</p> </li> </ol>"},{"location":"030Android/030ThirdSDKSourceCode/#_4","title":"\u603b\u7ed3","text":"<p>HTTPS\u901a\u8fc7\u6df7\u5408\u52a0\u5bc6\u548c\u6570\u5b57\u8bc1\u4e66\u8ba4\u8bc1\uff0c\u786e\u4fdd\u6570\u636e\u5728\u4f20\u8f93\u8fc7\u7a0b\u4e2d\u7684\u673a\u5bc6\u6027\u3001\u5b8c\u6574\u6027\u548c\u8eab\u4efd\u771f\u5b9e\u6027\u3002</p>"},{"location":"030Android/030ThirdSDKSourceCode/#https_1","title":"\u4e3a\u4ec0\u4e48\u901a\u8fc7\u4e2d\u95f4\u4eba\u653b\u51fb\u53ef\u4ee5\u6293\u5230HTTPS\u7684\u5305\uff0c\u4ec0\u4e48\u539f\u7406","text":"\u7b54\u6848 <p>\u672c\u5730\u8bc1\u4e66 MIIT\u653b\u51fb \u4f7f\u7528Charles\u3001Fiddler\u7b49\u6293\u5305\u5de5\u5177\u6293\u53d6HTTPS\u5305\uff0c\u672c\u8d28\u4e0a\u662f\u8fdb\u884c\u4e86\u4e2d\u95f4\u4eba\u653b\u51fb\uff08MITM\uff09\u3002\u4ee5\u4e0b\u662f\u5176\u5de5\u4f5c\u539f\u7406\u548c\u6b65\u9aa4\uff1a</p>"},{"location":"030Android/030ThirdSDKSourceCode/#1_8","title":"1. \u4e2d\u95f4\u4eba\u653b\u51fb\u539f\u7406","text":"<p>\u4e2d\u95f4\u4eba\u653b\u51fb\u901a\u8fc7\u62e6\u622a\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u7684\u901a\u4fe1\uff0c\u4f2a\u88c5\u6210\u670d\u52a1\u5668\u4e0e\u5ba2\u6237\u7aef\u901a\u4fe1\uff0c\u540c\u65f6\u4f2a\u88c5\u6210\u5ba2\u6237\u7aef\u4e0e\u670d\u52a1\u5668\u901a\u4fe1\uff0c\u4ece\u800c\u83b7\u53d6\u4f20\u8f93\u7684\u6570\u636e\u3002</p>"},{"location":"030Android/030ThirdSDKSourceCode/#2_9","title":"2. \u6293\u5305\u5de5\u5177\u7684\u5de5\u4f5c\u6d41\u7a0b","text":"<ol> <li>\u5b89\u88c5\u6839\u8bc1\u4e66\uff1a</li> <li> <p>\u6293\u5305\u5de5\u5177\u751f\u6210\u81ea\u7b7e\u540d\u6839\u8bc1\u4e66\u5e76\u5b89\u88c5\u5230\u5ba2\u6237\u7aef\u8bbe\u5907\u7684\u53d7\u4fe1\u4efb\u6839\u8bc1\u4e66\u5b58\u50a8\u4e2d\uff0c\u4f7f\u5ba2\u6237\u7aef\u4fe1\u4efb\u5de5\u5177\u7b7e\u53d1\u7684\u8bc1\u4e66\u3002</p> </li> <li> <p>\u62e6\u622aHTTPS\u8bf7\u6c42\uff1a</p> </li> <li> <p>\u5ba2\u6237\u7aef\u53d1\u8d77HTTPS\u8bf7\u6c42\u65f6\uff0c\u5de5\u5177\u62e6\u622a\u5e76\u4f2a\u88c5\u6210\u670d\u52a1\u5668\uff0c\u4f7f\u7528\u81ea\u7b7e\u540d\u8bc1\u4e66\u4e0e\u5ba2\u6237\u7aef\u5efa\u7acb\u8fde\u63a5\u3002</p> </li> <li> <p>\u5efa\u7acb\u4e0e\u670d\u52a1\u5668\u7684\u8fde\u63a5\uff1a</p> </li> <li> <p>\u5de5\u5177\u4f5c\u4e3a\u5ba2\u6237\u7aef\uff0c\u4e0e\u771f\u5b9e\u670d\u52a1\u5668\u5efa\u7acbHTTPS\u8fde\u63a5\uff0c\u83b7\u53d6\u670d\u52a1\u5668\u8bc1\u4e66\u3002</p> </li> <li> <p>\u89e3\u5bc6\u548c\u91cd\u65b0\u52a0\u5bc6\uff1a</p> </li> <li> <p>\u5de5\u5177\u4f7f\u7528\u670d\u52a1\u5668\u8bc1\u4e66\u4e0e\u670d\u52a1\u5668\u901a\u4fe1\uff0c\u83b7\u53d6\u6570\u636e\u540e\u89e3\u5bc6\uff0c\u518d\u7528\u81ea\u7b7e\u540d\u8bc1\u4e66\u52a0\u5bc6\u5e76\u53d1\u9001\u7ed9\u5ba2\u6237\u7aef\u3002</p> </li> <li> <p>\u5ba2\u6237\u7aef\u63a5\u6536\u6570\u636e\uff1a</p> </li> <li>\u5ba2\u6237\u7aef\u63a5\u6536\u5de5\u5177\u53d1\u9001\u7684\u6570\u636e\uff0c\u7531\u4e8e\u4fe1\u4efb\u4e86\u5de5\u5177\u7684\u6839\u8bc1\u4e66\uff0c\u8ba4\u4e3a\u8fde\u63a5\u662f\u5b89\u5168\u7684\u3002</li> </ol>"},{"location":"030Android/030ThirdSDKSourceCode/#3-https","title":"3. \u4e3a\u4ec0\u4e48\u53ef\u4ee5\u6293\u53d6HTTPS\u5305","text":"<ul> <li>\u4fe1\u4efb\u6839\u8bc1\u4e66\uff1a\u5ba2\u6237\u7aef\u4fe1\u4efb\u4e86\u6293\u5305\u5de5\u5177\u7684\u6839\u8bc1\u4e66\uff0c\u63a5\u53d7\u5176\u7b7e\u53d1\u7684\u8bc1\u4e66\u3002</li> <li>\u4e2d\u95f4\u4eba\u89d2\u8272\uff1a\u5de5\u5177\u4f5c\u4e3a\u4e2d\u95f4\u4eba\uff0c\u5206\u522b\u4e0e\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u5efa\u7acb\u8fde\u63a5\uff0c\u89e3\u5bc6\u548c\u91cd\u65b0\u52a0\u5bc6\u6570\u636e\u3002</li> </ul>"},{"location":"030Android/030ThirdSDKSourceCode/#4_7","title":"4. \u5b89\u5168\u98ce\u9669","text":"<ul> <li>\u9690\u79c1\u6cc4\u9732\uff1a\u6293\u5305\u5de5\u5177\u53ef\u4ee5\u67e5\u770b\u548c\u4fee\u6539HTTPS\u6570\u636e\uff0c\u5b58\u5728\u9690\u79c1\u6cc4\u9732\u98ce\u9669\u3002</li> <li>\u8bc1\u4e66\u4fe1\u4efb\uff1a\u5b89\u88c5\u4e0d\u53d7\u4fe1\u4efb\u7684\u6839\u8bc1\u4e66\u53ef\u80fd\u5bfc\u81f4\u5176\u4ed6\u4e2d\u95f4\u4eba\u653b\u51fb\u3002</li> </ul>"},{"location":"030Android/030ThirdSDKSourceCode/#_5","title":"\u603b\u7ed3","text":"<p>\u6293\u5305\u5de5\u5177\u901a\u8fc7\u5b89\u88c5\u81ea\u7b7e\u540d\u6839\u8bc1\u4e66\u5e76\u5145\u5f53\u4e2d\u95f4\u4eba\uff0c\u89e3\u5bc6\u548c\u91cd\u65b0\u52a0\u5bc6HTTPS\u6570\u636e\uff0c\u4ece\u800c\u5b9e\u73b0\u6293\u5305\u3002\u8fd9\u4f9d\u8d56\u4e8e\u5ba2\u6237\u7aef\u5bf9\u5de5\u5177\u6839\u8bc1\u4e66\u7684\u4fe1\u4efb\u3002</p>"},{"location":"030Android/030ThirdSDKSourceCode/#git","title":"Git\u539f\u7406","text":"\u7b54\u6848 <p>\u6682\u65e0</p>"},{"location":"030Android/030ThirdSDKSourceCode/#_6","title":"\u591a\u6e20\u9053\u6253\u5305\u539f\u7406","text":"\u7b54\u6848 <p>EOCD \u662f\u5426\u652f\u6301V3 V4\u76ee\u524d\u8fd8\u6ca1\u6709\u9a8c\u8bc1\u3002 Android \u591a\u6e20\u9053\u6253\u5305\u7684\u51e0\u79cd\u5e38\u89c1\u5de5\u5177\uff08\u5982 Gradle\u3001\u7f8e\u56e2 Walle\u3001VasDolly\uff09\u5404\u6709\u4e0d\u540c\u7684\u5b9e\u73b0\u539f\u7406\u548c\u5de5\u4f5c\u6d41\u7a0b\uff0c\u4e0b\u9762\u5206\u522b\u8bb2\u89e3\u5b83\u4eec\u7684\u539f\u7406\u3001\u5de5\u4f5c\u6d41\u7a0b\u4ee5\u53ca\u6e20\u9053\u4fe1\u606f\u7684\u5b58\u50a8\u4f4d\u7f6e\u3002</p>"},{"location":"030Android/030ThirdSDKSourceCode/#1-gradle-productflavors","title":"1. Gradle \u7684 <code>productFlavors</code> \u5b9e\u73b0\u591a\u6e20\u9053\u6253\u5305","text":""},{"location":"030Android/030ThirdSDKSourceCode/#_7","title":"\u539f\u7406","text":"<p>Gradle \u7684 <code>productFlavors</code> \u662f\u901a\u8fc7\u5728\u7f16\u8bd1\u65f6\u4e3a\u6bcf\u4e2a\u6e20\u9053\u751f\u6210\u72ec\u7acb\u7684 APK \u6587\u4ef6\u3002\u6bcf\u4e2a\u6e20\u9053\u7684 APK \u6587\u4ef6\u662f\u72ec\u7acb\u7f16\u8bd1\u7684\uff0c\u6e20\u9053\u4fe1\u606f\u901a\u8fc7 <code>manifestPlaceholders</code> \u6ce8\u5165\u5230 <code>AndroidManifest.xml</code> \u4e2d\u3002</p>"},{"location":"030Android/030ThirdSDKSourceCode/#_8","title":"\u5de5\u4f5c\u6d41\u7a0b","text":"<ol> <li> <p>\u914d\u7f6e\u6e20\u9053\uff1a \u5728 <code>build.gradle</code> \u4e2d\u5b9a\u4e49 <code>productFlavors</code>\uff0c\u4e3a\u6bcf\u4e2a\u6e20\u9053\u6307\u5b9a\u4e0d\u540c\u7684\u914d\u7f6e\uff1a <pre><code>android {\n    flavorDimensions \"default\"\n    productFlavors {\n        channel1 {\n            manifestPlaceholders = [CHANNEL: \"channel1\"]\n        }\n        channel2 {\n            manifestPlaceholders = [CHANNEL: \"channel2\"]\n        }\n    }\n}\n</code></pre></p> </li> <li> <p>\u6ce8\u5165\u6e20\u9053\u4fe1\u606f\uff1a \u5728 <code>AndroidManifest.xml</code> \u4e2d\u901a\u8fc7\u5360\u4f4d\u7b26 <code>${CHANNEL}</code> \u5f15\u7528\u6e20\u9053\u4fe1\u606f\uff1a <pre><code>&lt;meta-data\n    android:name=\"CHANNEL\"\n    android:value=\"${CHANNEL}\" /&gt;\n</code></pre></p> </li> <li> <p>\u751f\u6210\u591a\u6e20\u9053\u5305\uff1a \u8fd0\u884c Gradle \u547d\u4ee4\u751f\u6210\u591a\u6e20\u9053\u5305\uff1a <pre><code>./gradlew assembleRelease\n</code></pre> \u8fd9\u4f1a\u4e3a\u6bcf\u4e2a\u6e20\u9053\u751f\u6210\u4e00\u4e2a\u72ec\u7acb\u7684 APK \u6587\u4ef6\u3002</p> </li> <li> <p>\u8bfb\u53d6\u6e20\u9053\u4fe1\u606f\uff1a \u5728\u5e94\u7528\u542f\u52a8\u65f6\uff0c\u901a\u8fc7\u4ee3\u7801\u8bfb\u53d6 <code>AndroidManifest.xml</code> \u4e2d\u7684\u6e20\u9053\u4fe1\u606f\uff1a <pre><code>ApplicationInfo appInfo = getPackageManager().getApplicationInfo(getPackageName(), PackageManager.GET_META_DATA);\nString channel = appInfo.metaData.getString(\"CHANNEL\");\n</code></pre></p> </li> </ol>"},{"location":"030Android/030ThirdSDKSourceCode/#_9","title":"\u6e20\u9053\u4fe1\u606f\u5b58\u50a8\u4f4d\u7f6e","text":"<ul> <li>\u6e20\u9053\u4fe1\u606f\u5b58\u50a8\u5728 <code>AndroidManifest.xml</code> \u7684 <code>&lt;meta-data&gt;</code> \u6807\u7b7e\u4e2d\uff0c\u6700\u7ec8\u6253\u5305\u5230 APK \u6587\u4ef6\u7684 <code>AndroidManifest.xml</code> \u6587\u4ef6\u4e2d\u3002</li> </ul>"},{"location":"030Android/030ThirdSDKSourceCode/#2-walle","title":"2. \u7f8e\u56e2 Walle \u5b9e\u73b0\u591a\u6e20\u9053\u6253\u5305","text":""},{"location":"030Android/030ThirdSDKSourceCode/#_10","title":"\u539f\u7406","text":"<p>\u7f8e\u56e2 Walle \u7684\u539f\u7406\u662f\u901a\u8fc7\u5728 APK \u6587\u4ef6\u7684 <code>META-INF</code> \u76ee\u5f55\u4e0b\u63d2\u5165\u4e00\u4e2a\u7a7a\u6587\u4ef6\uff08\u6216\u4fee\u6539\u6587\u4ef6\u5185\u5bb9\uff09\u6765\u5b58\u50a8\u6e20\u9053\u4fe1\u606f\u3002\u7531\u4e8e <code>META-INF</code> \u76ee\u5f55\u4e0b\u7684\u6587\u4ef6\u4e0d\u4f1a\u5f71\u54cd APK \u7684\u7b7e\u540d\uff0c\u56e0\u6b64\u53ef\u4ee5\u5728\u4e0d\u91cd\u65b0\u7b7e\u540d\u7684\u60c5\u51b5\u4e0b\u5feb\u901f\u751f\u6210\u591a\u6e20\u9053\u5305\u3002</p>"},{"location":"030Android/030ThirdSDKSourceCode/#_11","title":"\u5de5\u4f5c\u6d41\u7a0b","text":"<ol> <li> <p>\u914d\u7f6e Walle\uff1a \u5728 <code>build.gradle</code> \u4e2d\u5f15\u5165 Walle \u63d2\u4ef6\u5e76\u914d\u7f6e\u6e20\u9053\u5217\u8868\uff1a <pre><code>apply plugin: 'walle'\n\nwalle {\n    channelFile = file(\"channel.txt\") // \u6e20\u9053\u5217\u8868\u6587\u4ef6\n}\n</code></pre></p> </li> <li> <p>\u751f\u6210\u57fa\u7840 APK\uff1a \u5148\u751f\u6210\u4e00\u4e2a\u672a\u6ce8\u5165\u6e20\u9053\u4fe1\u606f\u7684\u57fa\u7840 APK \u6587\u4ef6\uff1a <pre><code>./gradlew assembleRelease\n</code></pre></p> </li> <li> <p>\u6ce8\u5165\u6e20\u9053\u4fe1\u606f\uff1a \u4f7f\u7528 Walle \u5de5\u5177\u4e3a\u6bcf\u4e2a\u6e20\u9053\u751f\u6210\u5bf9\u5e94\u7684 APK \u6587\u4ef6\uff1a <pre><code>java -jar walle-cli-all.jar batch -c channel1,channel2 base.apk\n</code></pre> \u8fd9\u4f1a\u5728 <code>META-INF</code> \u76ee\u5f55\u4e0b\u751f\u6210\u4e00\u4e2a\u7a7a\u6587\u4ef6\uff08\u5982 <code>channel_channel1</code>\uff09\uff0c\u6587\u4ef6\u540d\u5305\u542b\u6e20\u9053\u4fe1\u606f\u3002</p> </li> <li> <p>\u8bfb\u53d6\u6e20\u9053\u4fe1\u606f\uff1a \u5728\u5e94\u7528\u542f\u52a8\u65f6\uff0c\u901a\u8fc7 Walle \u63d0\u4f9b\u7684 API \u8bfb\u53d6\u6e20\u9053\u4fe1\u606f\uff1a <pre><code>String channel = WalleChannelReader.getChannel(context);\n</code></pre></p> </li> </ol>"},{"location":"030Android/030ThirdSDKSourceCode/#_12","title":"\u6e20\u9053\u4fe1\u606f\u5b58\u50a8\u4f4d\u7f6e","text":"<ul> <li>\u6e20\u9053\u4fe1\u606f\u5b58\u50a8\u5728 APK \u6587\u4ef6\u7684 <code>META-INF</code> \u76ee\u5f55\u4e0b\uff0c\u4ee5\u7a7a\u6587\u4ef6\u7684\u5f62\u5f0f\u4fdd\u5b58\uff08\u6587\u4ef6\u540d\u5305\u542b\u6e20\u9053\u4fe1\u606f\uff09\u3002</li> </ul>"},{"location":"030Android/030ThirdSDKSourceCode/#3-vasdolly","title":"3. VasDolly \u5b9e\u73b0\u591a\u6e20\u9053\u6253\u5305","text":""},{"location":"030Android/030ThirdSDKSourceCode/#_13","title":"\u539f\u7406","text":"<p>VasDolly \u7684\u539f\u7406\u662f\u901a\u8fc7\u5728 APK \u6587\u4ef6\u7684 ZIP \u6587\u4ef6\u6ce8\u91ca\u533a\u57df\uff08ZIP Comment\uff09\u4e2d\u63d2\u5165\u6e20\u9053\u4fe1\u606f\u3002\u7531\u4e8e ZIP \u6587\u4ef6\u683c\u5f0f\u5141\u8bb8\u5728\u6587\u4ef6\u672b\u5c3e\u6dfb\u52a0\u6ce8\u91ca\uff0c\u4e14\u4e0d\u4f1a\u5f71\u54cd APK \u7684\u7b7e\u540d\uff0c\u56e0\u6b64\u53ef\u4ee5\u5728\u4e0d\u91cd\u65b0\u7b7e\u540d\u7684\u60c5\u51b5\u4e0b\u5feb\u901f\u751f\u6210\u591a\u6e20\u9053\u5305\u3002</p>"},{"location":"030Android/030ThirdSDKSourceCode/#_14","title":"\u5de5\u4f5c\u6d41\u7a0b","text":"<ol> <li> <p>\u914d\u7f6e VasDolly\uff1a \u5728 <code>build.gradle</code> \u4e2d\u5f15\u5165 VasDolly \u63d2\u4ef6\u5e76\u914d\u7f6e\u6e20\u9053\u5217\u8868\uff1a <pre><code>apply plugin: 'com.tencent.vasdolly'\n\nchannel {\n    channelFile = file(\"channel.txt\") // \u6e20\u9053\u5217\u8868\u6587\u4ef6\n}\n</code></pre></p> </li> <li> <p>\u751f\u6210\u57fa\u7840 APK\uff1a \u5148\u751f\u6210\u4e00\u4e2a\u672a\u6ce8\u5165\u6e20\u9053\u4fe1\u606f\u7684\u57fa\u7840 APK \u6587\u4ef6\uff1a <pre><code>./gradlew assembleRelease\n</code></pre></p> </li> <li> <p>\u6ce8\u5165\u6e20\u9053\u4fe1\u606f\uff1a \u4f7f\u7528 VasDolly \u5de5\u5177\u4e3a\u6bcf\u4e2a\u6e20\u9053\u751f\u6210\u5bf9\u5e94\u7684 APK \u6587\u4ef6\uff1a <pre><code>java -jar VasDolly.jar put -c channel1 base.apk\n</code></pre> \u8fd9\u4f1a\u5c06\u6e20\u9053\u4fe1\u606f\u5199\u5165 APK \u6587\u4ef6\u7684 ZIP \u6ce8\u91ca\u533a\u57df\u3002</p> </li> <li> <p>\u8bfb\u53d6\u6e20\u9053\u4fe1\u606f\uff1a \u5728\u5e94\u7528\u542f\u52a8\u65f6\uff0c\u901a\u8fc7 VasDolly \u63d0\u4f9b\u7684 API \u8bfb\u53d6\u6e20\u9053\u4fe1\u606f\uff1a <pre><code>String channel = ChannelReader.getChannel(context);\n</code></pre></p> </li> </ol>"},{"location":"030Android/030ThirdSDKSourceCode/#_15","title":"\u6e20\u9053\u4fe1\u606f\u5b58\u50a8\u4f4d\u7f6e","text":"<ul> <li>\u6e20\u9053\u4fe1\u606f\u5b58\u50a8\u5728 APK \u6587\u4ef6\u7684 ZIP \u6ce8\u91ca\u533a\u57df\uff08ZIP Comment\uff09\uff0c\u8fd9\u662f\u4e00\u4e2a\u4e0d\u5f71\u54cd APK \u7b7e\u540d\u7684\u533a\u57df\u3002</li> </ul>"},{"location":"030Android/030ThirdSDKSourceCode/#_16","title":"\u603b\u7ed3\u5bf9\u6bd4","text":"\u5de5\u5177/\u65b9\u6cd5 \u539f\u7406 \u6e20\u9053\u4fe1\u606f\u5b58\u50a8\u4f4d\u7f6e \u4f18\u70b9 \u7f3a\u70b9 Gradle (<code>productFlavors</code>) \u4e3a\u6bcf\u4e2a\u6e20\u9053\u72ec\u7acb\u7f16\u8bd1 APK\uff0c\u6e20\u9053\u4fe1\u606f\u6ce8\u5165\u5230 <code>AndroidManifest.xml</code> <code>AndroidManifest.xml</code> \u7684 <code>&lt;meta-data&gt;</code> \u5b98\u65b9\u652f\u6301\uff0c\u914d\u7f6e\u7b80\u5355 \u6253\u5305\u901f\u5ea6\u6162\uff0c\u6bcf\u4e2a\u6e20\u9053\u9700\u91cd\u65b0\u7f16\u8bd1 \u7f8e\u56e2 Walle \u5728 APK \u7684 <code>META-INF</code> \u76ee\u5f55\u4e0b\u63d2\u5165\u7a7a\u6587\u4ef6\u5b58\u50a8\u6e20\u9053\u4fe1\u606f <code>META-INF</code> \u76ee\u5f55\u4e0b\u7684\u7a7a\u6587\u4ef6 \u6253\u5305\u901f\u5ea6\u5feb\uff0c\u65e0\u9700\u91cd\u65b0\u7b7e\u540d \u4f9d\u8d56\u7b2c\u4e09\u65b9\u5de5\u5177 VasDolly \u5728 APK \u7684 ZIP \u6ce8\u91ca\u533a\u57df\u63d2\u5165\u6e20\u9053\u4fe1\u606f APK \u6587\u4ef6\u7684 ZIP \u6ce8\u91ca\u533a\u57df \u6253\u5305\u901f\u5ea6\u5feb\uff0c\u65e0\u9700\u91cd\u65b0\u7b7e\u540d \u4f9d\u8d56\u7b2c\u4e09\u65b9\u5de5\u5177 <ul> <li>\u5982\u679c\u9700\u8981\u5feb\u901f\u751f\u6210\u5927\u91cf\u6e20\u9053\u5305\uff0c\u63a8\u8350\u4f7f\u7528 Walle \u6216 VasDolly\u3002</li> <li>\u5982\u679c\u9700\u8981\u4e3a\u4e0d\u540c\u6e20\u9053\u5b9a\u5236\u5316\u4ee3\u7801\u6216\u8d44\u6e90\uff0c\u63a8\u8350\u4f7f\u7528 Gradle \u7684 <code>productFlavors</code>\u3002</li> </ul>"},{"location":"040Jetpack/010Basic/","title":"Jetpack","text":""},{"location":"040Jetpack/010Basic/#lifecycle","title":"LifeCycle","text":"\u7b54\u6848 <p>https://juejin.cn/post/6893870636733890574</p> <p>//\u4e13\u95e8\u7528\u4e8e\u5206\u53d1\u751f\u547d\u5468\u671f\u4e8b\u4ef6\u7684Fragment public class ReportFragment extends Fragment {     public static void injectIfNeededIn(Activity activity) {         if (Build.VERSION.SDK_INT &gt;= 29) {             //\u5728API 29\u53ca\u4ee5\u4e0a\uff0c\u53ef\u4ee5\u76f4\u63a5\u6ce8\u518c\u56de\u8c03 \u83b7\u53d6\u751f\u547d\u5468\u671f             activity.registerActivityLifecycleCallbacks(                     new LifecycleCallbacks());         }         //API29\u4ee5\u524d\uff0c\u4f7f\u7528fragment \u83b7\u53d6\u751f\u547d\u5468\u671f         if (manager.findFragmentByTag(REPORT_FRAGMENT_TAG) == null) {             manager.beginTransaction().add(new ReportFragment(), REPORT_FRAGMENT_TAG).commit();             manager.executePendingTransactions();         }     }     ... }</p> <p>Android Jetpack \u4e2d\u7684 <code>Lifecycle</code> \u7ec4\u4ef6\u662f\u7528\u4e8e\u7ba1\u7406 Android \u7ec4\u4ef6\uff08\u5982 <code>Activity</code> \u548c <code>Fragment</code>\uff09\u751f\u547d\u5468\u671f\u7684\u6838\u5fc3\u5de5\u5177\u3002\u5b83\u5141\u8bb8\u5f00\u53d1\u8005\u4ee5\u54cd\u5e94\u5f0f\u7684\u65b9\u5f0f\u5904\u7406\u751f\u547d\u5468\u671f\u4e8b\u4ef6\uff0c\u907f\u514d\u624b\u52a8\u7ba1\u7406\u751f\u547d\u5468\u671f\u5e26\u6765\u7684\u590d\u6742\u6027\u3002\u4ee5\u4e0b\u662f\u5bf9 <code>Lifecycle</code> \u6e90\u7801\u7684\u89e3\u6790\uff0c\u5e2e\u52a9\u4f60\u7406\u89e3\u5176\u5de5\u4f5c\u539f\u7406\u3002</p>"},{"location":"040Jetpack/010Basic/#1-lifecycle","title":"1. Lifecycle \u7684\u6838\u5fc3\u7c7b","text":"<p><code>Lifecycle</code> \u7684\u6838\u5fc3\u7c7b\u5305\u62ec\uff1a - <code>Lifecycle</code>: \u4e00\u4e2a\u62bd\u8c61\u7c7b\uff0c\u5b9a\u4e49\u4e86\u751f\u547d\u5468\u671f\u7684\u72b6\u6001\u548c\u4e8b\u4ef6\u3002 - <code>LifecycleOwner</code>: \u63a5\u53e3\uff0c\u8868\u793a\u62e5\u6709\u751f\u547d\u5468\u671f\u7684\u7ec4\u4ef6\uff08\u5982 <code>Activity</code> \u6216 <code>Fragment</code>\uff09\u3002 - <code>LifecycleObserver</code>: \u63a5\u53e3\uff0c\u7528\u4e8e\u89c2\u5bdf\u751f\u547d\u5468\u671f\u4e8b\u4ef6\u3002 - <code>LifecycleRegistry</code>: <code>Lifecycle</code> \u7684\u5b9e\u73b0\u7c7b\uff0c\u8d1f\u8d23\u7ba1\u7406\u751f\u547d\u5468\u671f\u72b6\u6001\u548c\u5206\u53d1\u4e8b\u4ef6\u3002</p>"},{"location":"040Jetpack/010Basic/#2-lifecycle","title":"2. Lifecycle \u7684\u72b6\u6001\u548c\u4e8b\u4ef6","text":"<p><code>Lifecycle</code> \u5b9a\u4e49\u4e86\u4e24\u79cd\u679a\u4e3e\u7c7b\u578b\uff1a - <code>State</code>: \u8868\u793a\u5f53\u524d\u751f\u547d\u5468\u671f\u72b6\u6001\u3002 - <code>INITIALIZED</code> - <code>CREATED</code> - <code>STARTED</code> - <code>RESUMED</code> - <code>DESTROYED</code> - <code>Event</code>: \u8868\u793a\u751f\u547d\u5468\u671f\u4e8b\u4ef6\u3002 - <code>ON_CREATE</code> - <code>ON_START</code> - <code>ON_RESUME</code> - <code>ON_PAUSE</code> - <code>ON_STOP</code> - <code>ON_DESTROY</code> - <code>ON_ANY</code>\uff08\u8868\u793a\u4efb\u4f55\u4e8b\u4ef6\uff09</p> <p>\u72b6\u6001\u548c\u4e8b\u4ef6\u4e4b\u95f4\u7684\u5173\u7cfb\u662f\uff1a - \u4e8b\u4ef6\u4f1a\u89e6\u53d1\u72b6\u6001\u7684\u8f6c\u6362\u3002 - \u4f8b\u5982\uff0c<code>ON_CREATE</code> \u4e8b\u4ef6\u4f1a\u5c06\u72b6\u6001\u4ece <code>INITIALIZED</code> \u8f6c\u6362\u4e3a <code>CREATED</code>\u3002</p>"},{"location":"040Jetpack/010Basic/#3-lifecycleowner","title":"3. LifecycleOwner","text":"<p><code>LifecycleOwner</code> \u662f\u4e00\u4e2a\u63a5\u53e3\uff0c\u8868\u793a\u62e5\u6709\u751f\u547d\u5468\u671f\u7684\u7ec4\u4ef6\u3002\u4f8b\u5982\uff0c<code>ComponentActivity</code> \u548c <code>Fragment</code> \u90fd\u5b9e\u73b0\u4e86 <code>LifecycleOwner</code>\u3002</p> <pre><code>public interface LifecycleOwner {\n    Lifecycle getLifecycle();\n}\n</code></pre> <p>\u901a\u8fc7 <code>getLifecycle()</code> \u65b9\u6cd5\uff0c\u53ef\u4ee5\u83b7\u53d6\u7ec4\u4ef6\u7684 <code>Lifecycle</code> \u5bf9\u8c61\u3002</p>"},{"location":"040Jetpack/010Basic/#4-lifecycleobserver","title":"4. LifecycleObserver","text":"<p><code>LifecycleObserver</code> \u662f\u4e00\u4e2a\u6807\u8bb0\u63a5\u53e3\uff0c\u7528\u4e8e\u89c2\u5bdf\u751f\u547d\u5468\u671f\u4e8b\u4ef6\u3002\u901a\u5e38\u7ed3\u5408 <code>@OnLifecycleEvent</code> \u6ce8\u89e3\u4f7f\u7528\u3002</p> <pre><code>public interface LifecycleObserver {}\n</code></pre> <p>\u4f8b\u5982\uff1a <pre><code>class MyObserver : LifecycleObserver {\n    @OnLifecycleEvent(Lifecycle.Event.ON_RESUME)\n    fun onResume() {\n        // \u5904\u7406 ON_RESUME \u4e8b\u4ef6\n    }\n}\n</code></pre></p>"},{"location":"040Jetpack/010Basic/#5-lifecycleregistry","title":"5. LifecycleRegistry","text":"<p><code>LifecycleRegistry</code> \u662f <code>Lifecycle</code> \u7684\u5b9e\u73b0\u7c7b\uff0c\u8d1f\u8d23\u7ba1\u7406\u751f\u547d\u5468\u671f\u72b6\u6001\u548c\u5206\u53d1\u4e8b\u4ef6\u3002</p>"},{"location":"040Jetpack/010Basic/#_1","title":"\u5173\u952e\u65b9\u6cd5\uff1a","text":"<ul> <li><code>handleLifecycleEvent(Lifecycle.Event event)</code>: \u5904\u7406\u751f\u547d\u5468\u671f\u4e8b\u4ef6\uff0c\u66f4\u65b0\u72b6\u6001\u5e76\u901a\u77e5\u89c2\u5bdf\u8005\u3002</li> <li><code>setCurrentState(Lifecycle.State state)</code>: \u76f4\u63a5\u8bbe\u7f6e\u5f53\u524d\u72b6\u6001\u3002</li> </ul>"},{"location":"040Jetpack/010Basic/#_2","title":"\u72b6\u6001\u8f6c\u6362\u903b\u8f91\uff1a","text":"<p><code>LifecycleRegistry</code> \u4f1a\u6839\u636e\u63a5\u6536\u5230\u7684\u4e8b\u4ef6\u66f4\u65b0\u72b6\u6001\u3002\u4f8b\u5982\uff1a - \u5f53\u63a5\u6536\u5230 <code>ON_CREATE</code> \u4e8b\u4ef6\u65f6\uff0c\u72b6\u6001\u4ece <code>INITIALIZED</code> \u53d8\u4e3a <code>CREATED</code>\u3002 - \u5f53\u63a5\u6536\u5230 <code>ON_START</code> \u4e8b\u4ef6\u65f6\uff0c\u72b6\u6001\u4ece <code>CREATED</code> \u53d8\u4e3a <code>STARTED</code>\u3002</p>"},{"location":"040Jetpack/010Basic/#_3","title":"\u89c2\u5bdf\u8005\u901a\u77e5\uff1a","text":"<p><code>LifecycleRegistry</code> \u7ef4\u62a4\u4e86\u4e00\u4e2a\u89c2\u5bdf\u8005\u5217\u8868\u3002\u5f53\u72b6\u6001\u53d1\u751f\u53d8\u5316\u65f6\uff0c\u4f1a\u904d\u5386\u89c2\u5bdf\u8005\u5217\u8868\u5e76\u8c03\u7528\u76f8\u5e94\u7684\u65b9\u6cd5\u3002</p>"},{"location":"040Jetpack/010Basic/#6","title":"6. \u6e90\u7801\u89e3\u6790\u793a\u4f8b","text":"<p>\u4ee5\u4e0b\u662f\u4e00\u4e2a\u7b80\u5355\u7684\u6e90\u7801\u89e3\u6790\u793a\u4f8b\uff0c\u5c55\u793a <code>LifecycleRegistry</code> \u5982\u4f55\u5904\u7406\u4e8b\u4ef6\uff1a</p> <pre><code>public class LifecycleRegistry extends Lifecycle {\n    private Lifecycle.State mState; // \u5f53\u524d\u72b6\u6001\n    private final WeakReference&lt;LifecycleOwner&gt; mLifecycleOwner;\n    private FastSafeIterableMap&lt;LifecycleObserver, ObserverWithState&gt; mObserverMap = new FastSafeIterableMap&lt;&gt;();\n\n    public void handleLifecycleEvent(Lifecycle.Event event) {\n        State next = getStateAfter(event); // \u8ba1\u7b97\u4e0b\u4e00\u4e2a\u72b6\u6001\n        moveToState(next); // \u66f4\u65b0\u72b6\u6001\n    }\n\n    private void moveToState(State next) {\n        if (mState == next) {\n            return;\n        }\n        mState = next;\n        sync(); // \u540c\u6b65\u72b6\u6001\u5230\u89c2\u5bdf\u8005\n    }\n\n    private void sync() {\n        for (Map.Entry&lt;LifecycleObserver, ObserverWithState&gt; entry : mObserverMap) {\n            entry.getValue().dispatchEvent(mLifecycleOwner.get(), mState);\n        }\n    }\n}\n</code></pre> <ul> <li><code>handleLifecycleEvent</code> \u65b9\u6cd5\u63a5\u6536\u4e00\u4e2a\u4e8b\u4ef6\uff0c\u8ba1\u7b97\u4e0b\u4e00\u4e2a\u72b6\u6001\u5e76\u66f4\u65b0\u3002</li> <li><code>moveToState</code> \u65b9\u6cd5\u66f4\u65b0\u5f53\u524d\u72b6\u6001\u5e76\u8c03\u7528 <code>sync</code> \u65b9\u6cd5\u3002</li> <li><code>sync</code> \u65b9\u6cd5\u904d\u5386\u6240\u6709\u89c2\u5bdf\u8005\u5e76\u5206\u53d1\u4e8b\u4ef6\u3002</li> </ul>"},{"location":"040Jetpack/010Basic/#7-lifecycle","title":"7. Lifecycle \u7684\u4f7f\u7528\u573a\u666f","text":"<ul> <li>ViewModel: <code>ViewModel</code> \u901a\u8fc7 <code>Lifecycle</code> \u611f\u77e5\u751f\u547d\u5468\u671f\uff0c\u907f\u514d\u5185\u5b58\u6cc4\u6f0f\u3002</li> <li>LiveData: <code>LiveData</code> \u901a\u8fc7 <code>Lifecycle</code> \u5b9e\u73b0\u6570\u636e\u66f4\u65b0\u4ec5\u5728\u6d3b\u8dc3\u72b6\u6001\u4e0b\u751f\u6548\u3002</li> <li>\u81ea\u5b9a\u4e49\u751f\u547d\u5468\u671f\u7ec4\u4ef6: \u5f00\u53d1\u8005\u53ef\u4ee5\u901a\u8fc7 <code>Lifecycle</code> \u5b9e\u73b0\u81ea\u5b9a\u4e49\u7ec4\u4ef6\u7684\u751f\u547d\u5468\u671f\u7ba1\u7406\u3002</li> </ul>"},{"location":"040Jetpack/010Basic/#8","title":"8. \u603b\u7ed3","text":"<ul> <li><code>Lifecycle</code> \u63d0\u4f9b\u4e86\u4e00\u79cd\u6807\u51c6\u5316\u7684\u65b9\u5f0f\u7ba1\u7406 Android \u7ec4\u4ef6\u7684\u751f\u547d\u5468\u671f\u3002</li> <li>\u901a\u8fc7 <code>LifecycleOwner</code> \u548c <code>LifecycleObserver</code>\uff0c\u5f00\u53d1\u8005\u53ef\u4ee5\u8f7b\u677e\u89c2\u5bdf\u548c\u54cd\u5e94\u751f\u547d\u5468\u671f\u4e8b\u4ef6\u3002</li> <li><code>LifecycleRegistry</code> \u662f <code>Lifecycle</code> \u7684\u6838\u5fc3\u5b9e\u73b0\uff0c\u8d1f\u8d23\u72b6\u6001\u7ba1\u7406\u548c\u4e8b\u4ef6\u5206\u53d1\u3002</li> </ul> <p>\u901a\u8fc7\u6df1\u5165\u7406\u89e3 <code>Lifecycle</code> \u7684\u6e90\u7801\uff0c\u53ef\u4ee5\u66f4\u597d\u5730\u638c\u63e1 Android \u751f\u547d\u5468\u671f\u7ba1\u7406\u7684\u673a\u5236\uff0c\u5e76\u7f16\u5199\u51fa\u66f4\u5065\u58ee\u7684\u4ee3\u7801\u3002</p>"},{"location":"040Jetpack/010Basic/#lifecycle_1","title":"Lifecycle\u4f7f\u7528\u6848\u4f8b\u3002","text":"<p>\u597d\u7684\uff01\u4e0b\u9762\u901a\u8fc7\u4e00\u4e2a\u5177\u4f53\u7684\u4f8b\u5b50\uff0c\u5bf9\u6bd4 \u4e0d\u4f7f\u7528 <code>Lifecycle</code> \u548c \u4f7f\u7528 <code>Lifecycle</code> \u7684\u533a\u522b\uff0c\u5e2e\u52a9\u4f60\u7406\u89e3 <code>Lifecycle</code> \u7684\u597d\u5904\u4ee5\u53ca\u4e0d\u4f7f\u7528\u5b83\u65f6\u7684\u4e0d\u4fbf\u4e4b\u5904\u3002</p>"},{"location":"040Jetpack/010Basic/#_4","title":"\u573a\u666f\u63cf\u8ff0","text":"<p>\u5047\u8bbe\u6211\u4eec\u6709\u4e00\u4e2a <code>Activity</code>\uff0c\u9700\u8981\u5728 <code>onStart()</code> \u65f6\u542f\u52a8\u4e00\u4e2a\u7f51\u7edc\u8bf7\u6c42\uff0c\u5e76\u5728 <code>onStop()</code> \u65f6\u505c\u6b62\u8be5\u8bf7\u6c42\u3002\u540c\u65f6\uff0c\u6211\u4eec\u9700\u8981\u786e\u4fdd\u5728 <code>Activity</code> \u9500\u6bc1\u65f6\u91ca\u653e\u8d44\u6e90\u3002</p>"},{"location":"040Jetpack/010Basic/#1-lifecycle_1","title":"1. \u4e0d\u4f7f\u7528 <code>Lifecycle</code> \u7684\u5b9e\u73b0","text":"<p>\u5728\u4e0d\u4f7f\u7528 <code>Lifecycle</code> \u7684\u60c5\u51b5\u4e0b\uff0c\u6211\u4eec\u9700\u8981\u624b\u52a8\u5728 <code>Activity</code> \u7684\u751f\u547d\u5468\u671f\u65b9\u6cd5\u4e2d\u7ba1\u7406\u7f51\u7edc\u8bf7\u6c42\u548c\u8d44\u6e90\u91ca\u653e\u3002</p>"},{"location":"040Jetpack/010Basic/#_5","title":"\u4ee3\u7801\u793a\u4f8b\uff1a","text":"<pre><code>class MainActivity : AppCompatActivity() {\n\n    private lateinit var networkManager: NetworkManager\n\n    override fun onCreate(savedInstanceState: Bundle?) {\n        super.onCreate(savedInstanceState)\n        networkManager = NetworkManager()\n    }\n\n    override fun onStart() {\n        super.onStart()\n        networkManager.startRequest() // \u624b\u52a8\u542f\u52a8\u7f51\u7edc\u8bf7\u6c42\n    }\n\n    override fun onStop() {\n        super.onStop()\n        networkManager.stopRequest() // \u624b\u52a8\u505c\u6b62\u7f51\u7edc\u8bf7\u6c42\n    }\n\n    override fun onDestroy() {\n        super.onDestroy()\n        networkManager.releaseResources() // \u624b\u52a8\u91ca\u653e\u8d44\u6e90\n    }\n}\n\nclass NetworkManager {\n    fun startRequest() {\n        println(\"Network request started\")\n    }\n\n    fun stopRequest() {\n        println(\"Network request stopped\")\n    }\n\n    fun releaseResources() {\n        println(\"Resources released\")\n    }\n}\n</code></pre>"},{"location":"040Jetpack/010Basic/#_6","title":"\u95ee\u9898\u5206\u6790\uff1a","text":"<ol> <li>\u4ee3\u7801\u5197\u4f59\uff1a\u6bcf\u4e2a <code>Activity</code> \u6216 <code>Fragment</code> \u90fd\u9700\u8981\u624b\u52a8\u8c03\u7528 <code>startRequest()</code>\u3001<code>stopRequest()</code> \u548c <code>releaseResources()</code>\uff0c\u5bfc\u81f4\u4ee3\u7801\u91cd\u590d\u3002</li> <li>\u5bb9\u6613\u9057\u6f0f\uff1a\u5982\u679c\u5f00\u53d1\u8005\u5fd8\u8bb0\u5728\u67d0\u4e2a\u751f\u547d\u5468\u671f\u65b9\u6cd5\u4e2d\u8c03\u7528\u76f8\u5173\u903b\u8f91\uff0c\u53ef\u80fd\u4f1a\u5bfc\u81f4\u5185\u5b58\u6cc4\u6f0f\u6216\u8d44\u6e90\u672a\u91ca\u653e\u3002</li> <li>\u96be\u4ee5\u7ef4\u62a4\uff1a\u5982\u679c\u751f\u547d\u5468\u671f\u903b\u8f91\u9700\u8981\u4fee\u6539\uff0c\u9700\u8981\u5728\u591a\u4e2a\u5730\u65b9\u540c\u6b65\u66f4\u65b0\uff0c\u589e\u52a0\u4e86\u7ef4\u62a4\u6210\u672c\u3002</li> </ol>"},{"location":"040Jetpack/010Basic/#2-lifecycle_1","title":"2. \u4f7f\u7528 <code>Lifecycle</code> \u7684\u5b9e\u73b0","text":"<p>\u4f7f\u7528 <code>Lifecycle</code>\uff0c\u6211\u4eec\u53ef\u4ee5\u5c06\u751f\u547d\u5468\u671f\u76f8\u5173\u7684\u903b\u8f91\u5c01\u88c5\u5230\u4e00\u4e2a <code>LifecycleObserver</code> \u4e2d\uff0c\u8ba9 <code>Activity</code> \u81ea\u52a8\u7ba1\u7406\u8fd9\u4e9b\u903b\u8f91\u3002</p>"},{"location":"040Jetpack/010Basic/#_7","title":"\u4ee3\u7801\u793a\u4f8b\uff1a","text":"<pre><code>class MainActivity : AppCompatActivity() {\n\n    override fun onCreate(savedInstanceState: Bundle?) {\n        super.onCreate(savedInstanceState)\n        lifecycle.addObserver(NetworkManager()) // \u6ce8\u518c LifecycleObserver\n    }\n}\n\nclass NetworkManager : LifecycleObserver {\n\n    @OnLifecycleEvent(Lifecycle.Event.ON_START)\n    fun startRequest() {\n        println(\"Network request started\")\n    }\n\n    @OnLifecycleEvent(Lifecycle.Event.ON_STOP)\n    fun stopRequest() {\n        println(\"Network request stopped\")\n    }\n\n    @OnLifecycleEvent(Lifecycle.Event.ON_DESTROY)\n    fun releaseResources() {\n        println(\"Resources released\")\n    }\n}\n</code></pre>"},{"location":"040Jetpack/010Basic/#_8","title":"\u597d\u5904\u5206\u6790\uff1a","text":"<ol> <li>\u4ee3\u7801\u7b80\u6d01\uff1a\u5c06\u751f\u547d\u5468\u671f\u903b\u8f91\u5c01\u88c5\u5230 <code>NetworkManager</code> \u4e2d\uff0c<code>Activity</code> \u53ea\u9700\u8981\u6ce8\u518c <code>LifecycleObserver</code>\uff0c\u4ee3\u7801\u66f4\u52a0\u7b80\u6d01\u3002</li> <li>\u907f\u514d\u9057\u6f0f\uff1a<code>Lifecycle</code> \u4f1a\u81ea\u52a8\u8c03\u7528 <code>LifecycleObserver</code> \u4e2d\u7684\u65b9\u6cd5\uff0c\u65e0\u9700\u62c5\u5fc3\u5fd8\u8bb0\u8c03\u7528\u67d0\u4e2a\u751f\u547d\u5468\u671f\u65b9\u6cd5\u3002</li> <li>\u6613\u4e8e\u7ef4\u62a4\uff1a\u5982\u679c\u9700\u8981\u4fee\u6539\u751f\u547d\u5468\u671f\u903b\u8f91\uff0c\u53ea\u9700\u4fee\u6539 <code>NetworkManager</code> \u4e2d\u7684\u4ee3\u7801\uff0c\u65e0\u9700\u4fee\u6539\u591a\u4e2a <code>Activity</code> \u6216 <code>Fragment</code>\u3002</li> <li>\u89e3\u8026\uff1a<code>NetworkManager</code> \u4e0d\u518d\u4f9d\u8d56\u5177\u4f53\u7684 <code>Activity</code> \u6216 <code>Fragment</code>\uff0c\u53ef\u4ee5\u5728\u4efb\u4f55 <code>LifecycleOwner</code> \u4e2d\u4f7f\u7528\u3002</li> </ol>"},{"location":"040Jetpack/010Basic/#3","title":"3. \u5bf9\u6bd4\u603b\u7ed3","text":"\u65b9\u9762 \u4e0d\u4f7f\u7528 <code>Lifecycle</code> \u4f7f\u7528 <code>Lifecycle</code> \u4ee3\u7801\u5197\u4f59 \u9700\u8981\u5728\u6bcf\u4e2a <code>Activity</code> \u6216 <code>Fragment</code> \u4e2d\u624b\u52a8\u8c03\u7528\u903b\u8f91 \u903b\u8f91\u5c01\u88c5\u5728 <code>LifecycleObserver</code> \u4e2d\uff0c\u4ee3\u7801\u7b80\u6d01 \u907f\u514d\u9057\u6f0f \u5bb9\u6613\u5fd8\u8bb0\u8c03\u7528\u67d0\u4e9b\u751f\u547d\u5468\u671f\u65b9\u6cd5\uff0c\u5bfc\u81f4\u95ee\u9898 \u81ea\u52a8\u8c03\u7528\uff0c\u907f\u514d\u9057\u6f0f \u7ef4\u62a4\u6210\u672c \u4fee\u6539\u903b\u8f91\u9700\u8981\u5728\u591a\u4e2a\u5730\u65b9\u540c\u6b65\u66f4\u65b0\uff0c\u7ef4\u62a4\u6210\u672c\u9ad8 \u53ea\u9700\u4fee\u6539 <code>LifecycleObserver</code>\uff0c\u7ef4\u62a4\u6210\u672c\u4f4e \u89e3\u8026 \u903b\u8f91\u4e0e <code>Activity</code> \u6216 <code>Fragment</code> \u8026\u5408\u7d27\u5bc6 \u903b\u8f91\u4e0e <code>Activity</code> \u6216 <code>Fragment</code> \u89e3\u8026 \u53ef\u590d\u7528\u6027 \u903b\u8f91\u96be\u4ee5\u590d\u7528 \u903b\u8f91\u53ef\u4ee5\u5728\u591a\u4e2a <code>LifecycleOwner</code> \u4e2d\u590d\u7528"},{"location":"040Jetpack/010Basic/#4","title":"4. \u5b9e\u9645\u573a\u666f\u4e2d\u7684\u597d\u5904","text":"<ul> <li><code>ViewModel</code> \u548c <code>LiveData</code> \u7684\u96c6\u6210\uff1a<code>Lifecycle</code> \u662f <code>ViewModel</code> \u548c <code>LiveData</code> \u7684\u57fa\u7840\uff0c\u786e\u4fdd\u6570\u636e\u53ea\u5728\u6d3b\u8dc3\u72b6\u6001\u4e0b\u66f4\u65b0\uff0c\u907f\u514d\u5185\u5b58\u6cc4\u6f0f\u3002</li> <li>\u7b2c\u4e09\u65b9\u5e93\u7684\u652f\u6301\uff1a\u8bb8\u591a\u7b2c\u4e09\u65b9\u5e93\uff08\u5982 <code>Glide</code>\u3001<code>Room</code>\uff09\u90fd\u652f\u6301 <code>Lifecycle</code>\uff0c\u53ef\u4ee5\u81ea\u52a8\u7ba1\u7406\u8d44\u6e90\u7684\u751f\u547d\u5468\u671f\u3002</li> <li>\u81ea\u5b9a\u4e49\u7ec4\u4ef6\uff1a\u5982\u679c\u4f60\u5f00\u53d1\u81ea\u5b9a\u4e49\u7ec4\u4ef6\uff0c<code>Lifecycle</code> \u53ef\u4ee5\u5e2e\u52a9\u4f60\u66f4\u597d\u5730\u7ba1\u7406\u7ec4\u4ef6\u7684\u751f\u547d\u5468\u671f\u3002</li> </ul>"},{"location":"040Jetpack/010Basic/#5","title":"5. \u603b\u7ed3","text":"<ul> <li>\u4e0d\u4f7f\u7528 <code>Lifecycle</code> \u7684\u4e0d\u4fbf\u4e4b\u5904\uff1a\u4ee3\u7801\u5197\u4f59\u3001\u5bb9\u6613\u9057\u6f0f\u3001\u7ef4\u62a4\u6210\u672c\u9ad8\u3001\u8026\u5408\u7d27\u5bc6\u3002</li> <li>\u4f7f\u7528 <code>Lifecycle</code> \u7684\u597d\u5904\uff1a\u4ee3\u7801\u7b80\u6d01\u3001\u81ea\u52a8\u7ba1\u7406\u751f\u547d\u5468\u671f\u3001\u6613\u4e8e\u7ef4\u62a4\u3001\u89e3\u8026\u3001\u53ef\u590d\u7528\u3002</li> </ul> <p>\u901a\u8fc7\u4f7f\u7528 <code>Lifecycle</code>\uff0c\u5f00\u53d1\u8005\u53ef\u4ee5\u66f4\u4e13\u6ce8\u4e8e\u4e1a\u52a1\u903b\u8f91\uff0c\u800c\u65e0\u9700\u62c5\u5fc3\u751f\u547d\u5468\u671f\u7ba1\u7406\u7684\u7ec6\u8282\uff0c\u4ece\u800c\u63d0\u9ad8\u4ee3\u7801\u8d28\u91cf\u548c\u5f00\u53d1\u6548\u7387\u3002</p>"},{"location":"040Jetpack/010Basic/#lifecycleactivity","title":"LifeCycle\u5982\u4f55\u88abActivity\u7684\u751f\u547d\u5468\u671f\u5173\u8054\u4e0a\u7684\uff1f","text":"\u7b54\u6848 <p>\u5728 Android \u4e2d\uff0c<code>ComponentActivity</code> \u901a\u8fc7\u5b9e\u73b0 <code>LifecycleOwner</code> \u63a5\u53e3\uff0c\u5e76\u5229\u7528 <code>LifecycleRegistry</code> \u6765\u7ba1\u7406\u751f\u547d\u5468\u671f\u72b6\u6001\u7684\u53d8\u5316\u3002\u4ee5\u4e0b\u662f\u5b83\u4eec\u5982\u4f55\u4ea7\u751f\u8054\u7cfb\uff0c\u4ee5\u53ca\u751f\u547d\u5468\u671f\u5982\u4f55\u88ab\u83b7\u53d6\u548c\u901a\u77e5\u8ba2\u9605\u8005\u7684\u8be6\u7ec6\u8fc7\u7a0b\uff1a</p>"},{"location":"040Jetpack/010Basic/#1-componentactivity-lifecycleowner","title":"1. <code>ComponentActivity</code> \u5b9e\u73b0 <code>LifecycleOwner</code>","text":"<p><code>ComponentActivity</code> \u5b9e\u73b0\u4e86 <code>LifecycleOwner</code> \u63a5\u53e3\uff0c\u8981\u6c42\u63d0\u4f9b\u4e00\u4e2a <code>Lifecycle</code> \u5bf9\u8c61\u3002\u6838\u5fc3\u4ee3\u7801\u5982\u4e0b\uff1a <pre><code>public class ComponentActivity extends Activity implements LifecycleOwner {\n    private final LifecycleRegistry mLifecycleRegistry = new LifecycleRegistry(this);\n\n    @Override\n    public Lifecycle getLifecycle() {\n        return mLifecycleRegistry;\n    }\n}\n</code></pre> - <code>LifecycleRegistry</code> \u662f <code>Lifecycle</code> \u7684\u5177\u4f53\u5b9e\u73b0\u7c7b\uff0c\u8d1f\u8d23\u7ba1\u7406\u751f\u547d\u5468\u671f\u72b6\u6001\u548c\u901a\u77e5\u89c2\u5bdf\u8005\u3002</p>"},{"location":"040Jetpack/010Basic/#2","title":"2. \u751f\u547d\u5468\u671f\u4e8b\u4ef6\u7684\u6765\u6e90","text":"<p><code>ComponentActivity</code> \u901a\u8fc7\u5d4c\u5165\u4e00\u4e2a <code>ReportFragment</code>\uff08\u6216\u901a\u8fc7 <code>ActivityLifecycleCallbacks</code>\uff09\u6765\u76d1\u542c Activity \u7684\u751f\u547d\u5468\u671f\u4e8b\u4ef6\u3002\u4ee5 <code>ReportFragment</code> \u4e3a\u4f8b\uff1a</p>"},{"location":"040Jetpack/010Basic/#reportfragment","title":"<code>ReportFragment</code> \u7684\u4f5c\u7528","text":"<ul> <li>\u5728 <code>ComponentActivity</code> \u7684 <code>onCreate()</code> \u4e2d\uff0c\u4f1a\u52a8\u6001\u6dfb\u52a0\u4e00\u4e2a\u65e0 UI \u7684 <code>ReportFragment</code>\uff1a <pre><code>protected void onCreate(@Nullable Bundle savedInstanceState) {\n    super.onCreate(savedInstanceState);\n    ReportFragment.injectIfNeededIn(this); // \u6ce8\u5165 Fragment\n}\n</code></pre></li> <li><code>ReportFragment</code> \u5728\u751f\u547d\u5468\u671f\u56de\u8c03\u4e2d\u901a\u8fc7 <code>LifecycleRegistry</code> \u5206\u53d1\u4e8b\u4ef6\uff1a <pre><code>class ReportFragment extends Fragment {\n    @Override\n    public void onStart() {\n        super.onStart();\n        dispatch(Lifecycle.Event.ON_START);\n    }\n\n    @Override\n    public void onResume() {\n        super.onResume();\n        dispatch(Lifecycle.Event.ON_RESUME);\n    }\n\n    private void dispatch(Lifecycle.Event event) {\n        Activity activity = getActivity();\n        if (activity instanceof LifecycleOwner) {\n            LifecycleRegistry registry = ((LifecycleOwner) activity).getLifecycle();\n            registry.handleLifecycleEvent(event); // \u89e6\u53d1\u4e8b\u4ef6\u5206\u53d1\n        }\n    }\n}\n</code></pre></li> </ul>"},{"location":"040Jetpack/010Basic/#3-lifecycleregistry","title":"3. <code>LifecycleRegistry</code> \u5904\u7406\u4e8b\u4ef6","text":"<p>\u5f53 <code>ReportFragment</code> \u8c03\u7528 <code>handleLifecycleEvent()</code> \u65f6\uff0c<code>LifecycleRegistry</code> \u4f1a\uff1a 1. \u66f4\u65b0\u5f53\u524d\u72b6\u6001 \u6839\u636e\u4e8b\u4ef6\u7c7b\u578b\uff08\u5982 <code>ON_START</code>\uff09\u8f6c\u6362\u5230\u5bf9\u5e94\u7684\u72b6\u6001\uff08\u5982 <code>STARTED</code>\uff09\uff1a <pre><code>public void handleLifecycleEvent(Lifecycle.Event event) {\n    State next = getStateAfter(event); // \u8ba1\u7b97\u65b0\u72b6\u6001\n    moveToState(next); // \u66f4\u65b0\u72b6\u6001\n}\n</code></pre> 2. \u901a\u77e5\u89c2\u5bdf\u8005 \u904d\u5386\u6240\u6709\u89c2\u5bdf\u8005\uff08<code>LifecycleObserver</code>\uff09\uff0c\u5e76\u89e6\u53d1\u5bf9\u5e94\u7684\u56de\u8c03\uff08\u5982 <code>@OnLifecycleEvent</code> \u6216\u9ed8\u8ba4\u63a5\u53e3\u65b9\u6cd5\uff09\uff1a <pre><code>private void sync() {\n    for (LifecycleObserver observer : mObservers) {\n        dispatchEvent(observer, currentState);\n    }\n}\n</code></pre></p>"},{"location":"040Jetpack/010Basic/#4_1","title":"4. \u89c2\u5bdf\u8005\u8ba2\u9605\u4e0e\u901a\u77e5","text":"<p>\u89c2\u5bdf\u8005\u901a\u8fc7 <code>getLifecycle().addObserver()</code> \u6ce8\u518c\u540e\uff0c\u4f1a\u5728\u72b6\u6001\u53d8\u5316\u65f6\u88ab\u901a\u77e5\uff1a <pre><code>lifecycle.addObserver(new LifecycleObserver() {\n    @OnLifecycleEvent(Lifecycle.Event.ON_START)\n    void onStart() {\n        Log.d(\"TAG\", \"Activity started!\");\n    }\n});\n</code></pre> - \u57fa\u4e8e\u6ce8\u89e3\uff1a\u901a\u8fc7\u53cd\u5c04\u6216\u4ee3\u7801\u751f\u6210\uff08\u5982 <code>DefaultLifecycleObserver</code>\uff09\u5339\u914d\u751f\u547d\u5468\u671f\u4e8b\u4ef6\u3002 - \u72b6\u6001\u540c\u6b65\uff1a\u5f53\u89c2\u5bdf\u8005\u521a\u6ce8\u518c\u65f6\uff0c\u4f1a\u7acb\u5373\u6536\u5230\u5f53\u524d\u72b6\u6001\u7684\u540c\u6b65\u4e8b\u4ef6\u3002</p>"},{"location":"040Jetpack/010Basic/#_9","title":"\u5173\u952e\u8bbe\u8ba1\u603b\u7ed3","text":"<ol> <li>\u89e3\u8026\u76d1\u542c \u901a\u8fc7 <code>ReportFragment</code> \u6216 <code>ActivityLifecycleCallbacks</code> \u76d1\u542c Activity \u751f\u547d\u5468\u671f\uff0c\u907f\u514d\u76f4\u63a5\u8026\u5408\u3002</li> <li>\u72b6\u6001\u673a\u7ba1\u7406 <code>LifecycleRegistry</code> \u7ef4\u62a4\u72b6\u6001\u673a\uff08\u5982 <code>INITIALIZED</code>\u3001<code>STARTED</code>\u3001<code>RESUMED</code>\uff09\uff0c\u786e\u4fdd\u4e8b\u4ef6\u987a\u5e8f\u6b63\u786e\u3002</li> <li>\u89c2\u5bdf\u8005\u6a21\u5f0f \u89c2\u5bdf\u8005\u53ea\u9700\u5173\u6ce8\u751f\u547d\u5468\u671f\u72b6\u6001\uff0c\u65e0\u9700\u91cd\u5199 Activity \u65b9\u6cd5\u3002</li> </ol>"},{"location":"040Jetpack/010Basic/#_10","title":"\u6d41\u7a0b\u56fe","text":"<pre><code>ComponentActivity (LifecycleOwner)\n    \u2191 \u6301\u6709\nLifecycleRegistry\n    \u2191 \u63a5\u6536\u4e8b\u4ef6\nReportFragment / ActivityLifecycleCallbacks\n    \u2191 \u76d1\u542c\nActivity \u539f\u751f\u751f\u547d\u5468\u671f\n</code></pre> <p>\u901a\u8fc7\u8fd9\u79cd\u8bbe\u8ba1\uff0cAndroid \u751f\u547d\u5468\u671f\u7ec4\u4ef6\u5b9e\u73b0\u4e86\u9ad8\u5ea6\u89e3\u8026\u548c\u7075\u6d3b\u6027\uff0c\u5f00\u53d1\u8005\u53ef\u4ee5\u8f7b\u677e\u76d1\u542c\u751f\u547d\u5468\u671f\u800c\u4e0d\u4fb5\u5165\u4e1a\u52a1\u903b\u8f91\u3002</p>"},{"location":"040Jetpack/010Basic/#lifecycleactivitylifecyclecallbacks","title":"\u5173\u4e8eLifeCycle\u7684ActivityLifecycleCallbacks\u539f\u7406","text":"\u7b54\u6848 <p><code>ActivityLifecycleCallbacks</code> \u662f Android \u63d0\u4f9b\u7684\u4e00\u4e2a\u5168\u5c40\u76d1\u542c\u6240\u6709 Activity \u751f\u547d\u5468\u671f\u4e8b\u4ef6\u7684\u673a\u5236\uff0c\u5176\u6838\u5fc3\u539f\u7406\u662f\u901a\u8fc7 \u5e94\u7528\u7ea7\u6ce8\u518c \u548c \u56de\u8c03\u5206\u53d1 \u5b9e\u73b0\u7684\u3002\u4ee5\u4e0b\u662f\u5b83\u7684\u5de5\u4f5c\u539f\u7406\u548c\u5173\u952e\u7ec6\u8282\uff1a</p>"},{"location":"040Jetpack/010Basic/#1","title":"1. \u57fa\u672c\u6982\u5ff5","text":"<ul> <li>\u4f5c\u7528\uff1a\u76d1\u542c\u5e94\u7528\u4e2d \u6240\u6709 Activity \u7684\u751f\u547d\u5468\u671f\u4e8b\u4ef6\uff08\u5982 <code>onCreate</code>\u3001<code>onStart</code>\u7b49\uff09\u3002</li> <li>\u6ce8\u518c\u65b9\u5f0f\uff1a\u901a\u8fc7 <code>Application.registerActivityLifecycleCallbacks()</code> \u5168\u5c40\u6ce8\u518c\u3002</li> <li>\u9002\u7528\u573a\u666f\uff1a\u7edf\u8ba1\u3001\u65e5\u5fd7\u76d1\u63a7\u3001\u5168\u5c40\u72b6\u6001\u7ba1\u7406\uff08\u5982\u5224\u65ad\u5e94\u7528\u524d\u540e\u53f0\uff09\u3002</li> </ul>"},{"location":"040Jetpack/010Basic/#2_1","title":"2. \u6838\u5fc3\u5b9e\u73b0\u539f\u7406","text":""},{"location":"040Jetpack/010Basic/#21","title":"2.1 \u6ce8\u518c\u8fc7\u7a0b","text":"<p>\u5f53\u8c03\u7528 <code>registerActivityLifecycleCallbacks()</code> \u65f6\uff0c\u7cfb\u7edf\u4f1a\u5c06\u56de\u8c03\u63a5\u53e3\u4fdd\u5b58\u5728 <code>Application</code> \u7684\u4e00\u4e2a\u5217\u8868\u4e2d\uff1a <pre><code>// \u7b80\u5316\u4ee3\u7801\u903b\u8f91\npublic class Application {\n    private List&lt;ActivityLifecycleCallbacks&gt; mActivityLifecycleCallbacks = new ArrayList&lt;&gt;();\n\n    public void registerActivityLifecycleCallbacks(ActivityLifecycleCallbacks callback) {\n        synchronized (mActivityLifecycleCallbacks) {\n            mActivityLifecycleCallbacks.add(callback);\n        }\n    }\n}\n</code></pre></p>"},{"location":"040Jetpack/010Basic/#22","title":"2.2 \u4e8b\u4ef6\u5206\u53d1\u673a\u5236","text":"<p>\u5f53 Activity \u7684\u751f\u547d\u5468\u671f\u65b9\u6cd5\u88ab\u89e6\u53d1\u65f6\uff0c\u7cfb\u7edf\u4f1a\u901a\u8fc7 <code>Instrumentation</code> \u6216 <code>Activity</code> \u7684\u5185\u90e8\u673a\u5236\uff0c\u904d\u5386\u6240\u6709\u5df2\u6ce8\u518c\u7684\u56de\u8c03\u5e76\u901a\u77e5\u5b83\u4eec\u3002\u4f8b\u5982\uff1a <pre><code>// \u6a21\u62df Activity \u7684 onStart() \u5206\u53d1\u903b\u8f91\npublic class Activity {\n    void performStart() {\n        onStart();\n        // \u5206\u53d1\u4e8b\u4ef6\u7ed9\u6240\u6709\u6ce8\u518c\u7684 Callbacks\n        for (ActivityLifecycleCallbacks callback : mApplication.mActivityLifecycleCallbacks) {\n            callback.onActivityStarted(this);\n        }\n    }\n}\n</code></pre></p>"},{"location":"040Jetpack/010Basic/#3-activity","title":"3. \u5e95\u5c42\u5982\u4f55\u6302\u94a9\u5230 Activity \u751f\u547d\u5468\u671f\uff1f","text":"<p>Android \u901a\u8fc7\u4ee5\u4e0b\u4e24\u79cd\u65b9\u5f0f\u5c06 <code>ActivityLifecycleCallbacks</code> \u4e0e Activity \u751f\u547d\u5468\u671f\u5173\u8054\uff1a</p>"},{"location":"040Jetpack/010Basic/#1-instrumentation","title":"\u65b9\u5f0f 1\uff1a\u901a\u8fc7 <code>Instrumentation</code> \u5206\u53d1","text":"<ul> <li><code>Instrumentation</code> \u662f Android \u63a7\u5236 Activity \u751f\u547d\u5468\u671f\u6267\u884c\u7684\u6838\u5fc3\u7c7b\u3002</li> <li>\u6bcf\u4e2a Activity \u7684\u751f\u547d\u5468\u671f\u65b9\u6cd5\uff08\u5982 <code>onCreate()</code>\uff09\u4f1a\u5148\u7ecf\u8fc7 <code>Instrumentation</code>\uff0c\u518d\u7531\u5b83\u89e6\u53d1\u56de\u8c03\uff1a <pre><code>public class Instrumentation {\n    public void callActivityOnCreate(Activity activity, Bundle icicle) {\n        activity.onCreate(icicle);\n        // \u901a\u77e5 Application \u5206\u53d1\u56de\u8c03\n        activity.getApplication().dispatchActivityCreated(activity, icicle);\n    }\n}\n</code></pre></li> </ul>"},{"location":"040Jetpack/010Basic/#2-activity","title":"\u65b9\u5f0f 2\uff1a\u901a\u8fc7 <code>Activity</code> \u7684\u57fa\u7c7b\u5206\u53d1","text":"<ul> <li>Activity \u7684\u57fa\u7c7b\uff08\u5982 <code>Activity</code>\uff09\u4f1a\u5728\u751f\u547d\u5468\u671f\u65b9\u6cd5\u4e2d\u76f4\u63a5\u8c03\u7528 <code>Application</code> \u7684\u5206\u53d1\u903b\u8f91\uff1a <pre><code>public class Activity {\n    protected void onStart() {\n        // ... \u5176\u4ed6\u903b\u8f91\n        mApplication.dispatchActivityStarted(this);\n    }\n}\n</code></pre></li> </ul>"},{"location":"040Jetpack/010Basic/#4-lifecycleowner","title":"4. \u4e0e <code>LifecycleOwner</code> \u7684\u533a\u522b","text":"\u7279\u6027 <code>ActivityLifecycleCallbacks</code> <code>LifecycleOwner</code> (\u5982 <code>ComponentActivity</code>) \u76d1\u542c\u8303\u56f4 \u5168\u5c40\uff08\u6240\u6709 Activity\uff09 \u5355\u4e2a\u7279\u5b9a Activity/Fragment \u6ce8\u518c\u65b9\u5f0f \u901a\u8fc7 <code>Application</code> \u6ce8\u518c \u901a\u8fc7 <code>getLifecycle().addObserver()</code> \u6ce8\u518c \u4f7f\u7528\u573a\u666f \u8de8 Activity \u7684\u5168\u5c40\u76d1\u63a7\uff08\u5982\u7edf\u8ba1 SDK\uff09 \u7ec4\u4ef6\u5185\u90e8\u751f\u547d\u5468\u671f\u611f\u77e5\uff08\u5982 ViewModel\u3001LiveData\uff09 \u6027\u80fd\u5f71\u54cd \u6240\u6709 Activity \u90fd\u4f1a\u89e6\u53d1\u56de\u8c03\uff0c\u9700\u8c28\u614e\u4f7f\u7528 \u4ec5\u5f71\u54cd\u7279\u5b9a\u7ec4\u4ef6\u7684\u89c2\u5bdf\u8005"},{"location":"040Jetpack/010Basic/#5_1","title":"5. \u6ce8\u610f\u4e8b\u9879","text":"<ol> <li>\u5185\u5b58\u6cc4\u6f0f\u98ce\u9669 \u6ce8\u518c\u540e\u5fc5\u987b\u8c03\u7528 <code>unregisterActivityLifecycleCallbacks()</code> \u6ce8\u9500\uff0c\u5426\u5219\u4f1a\u5bfc\u81f4\u56de\u8c03\u6301\u6709 Activity \u5f15\u7528\u3002</li> <li>\u6027\u80fd\u5f00\u9500 \u6bcf\u4e2a Activity \u7684\u751f\u547d\u5468\u671f\u4e8b\u4ef6\u90fd\u4f1a\u904d\u5386\u6240\u6709\u56de\u8c03\uff0c\u4e0d\u5b9c\u6ce8\u518c\u8fc7\u591a\u76d1\u542c\u5668\u3002</li> <li>\u6267\u884c\u987a\u5e8f \u56de\u8c03\u7684\u6267\u884c\u987a\u5e8f\u4e0e\u6ce8\u518c\u987a\u5e8f\u4e00\u81f4\uff0c\u4f46\u4e0d\u5e94\u4f9d\u8d56\u5177\u4f53\u987a\u5e8f\u3002</li> </ol>"},{"location":"040Jetpack/010Basic/#6_1","title":"6. \u793a\u4f8b\u4ee3\u7801","text":"<pre><code>// \u6ce8\u518c\u5168\u5c40\u76d1\u542c\npublic class MyApp extends Application {\n    @Override\n    public void onCreate() {\n        super.onCreate();\n        registerActivityLifecycleCallbacks(new ActivityLifecycleCallbacks() {\n            @Override\n            public void onActivityCreated(Activity activity, Bundle savedInstanceState) {\n                Log.d(\"Global\", \"Activity created: \" + activity.getClass().getSimpleName());\n            }\n            // \u5176\u4ed6\u751f\u547d\u5468\u671f\u65b9\u6cd5...\n        });\n    }\n}\n</code></pre>"},{"location":"040Jetpack/010Basic/#_11","title":"\u603b\u7ed3","text":"<p><code>ActivityLifecycleCallbacks</code> \u7684\u672c\u8d28\u662f\u901a\u8fc7 Application \u96c6\u4e2d\u7ba1\u7406\u56de\u8c03\u5217\u8868\uff0c\u5e76\u5728 Activity \u751f\u547d\u5468\u671f\u89e6\u53d1\u65f6\u904d\u5386\u901a\u77e5\u6240\u6709\u76d1\u542c\u5668\u3002\u5b83\u7684\u4f18\u52bf\u5728\u4e8e\u5168\u5c40\u6027\uff0c\u4f46\u9700\u8981\u8c28\u614e\u4f7f\u7528\u4ee5\u907f\u514d\u6027\u80fd\u95ee\u9898\u548c\u5185\u5b58\u6cc4\u6f0f\u3002</p>"},{"location":"040Jetpack/010Basic/#livedata","title":"LiveData\u4f7f\u7528","text":"\u7b54\u6848"},{"location":"040Jetpack/010Basic/#android-livedata","title":"\u4ece\u6e90\u7801\u89d2\u5ea6\u89e3\u6790 Android LiveData","text":""},{"location":"040Jetpack/010Basic/#1-livedata","title":"1. LiveData \u6982\u8ff0","text":"<p>LiveData \u662f Android Jetpack \u7ec4\u4ef6\u4e4b\u4e00\uff0c\u7528\u4e8e\u5728\u5e94\u7528\u7ec4\u4ef6\uff08\u5982 Activity\u3001Fragment\uff09\u4e4b\u95f4\u5171\u4eab\u6570\u636e\uff0c\u5e76\u786e\u4fdd\u6570\u636e\u66f4\u65b0\u65f6 UI \u80fd\u591f\u81ea\u52a8\u54cd\u5e94\u3002LiveData \u5177\u6709\u751f\u547d\u5468\u671f\u611f\u77e5\u80fd\u529b\uff0c\u80fd\u591f\u907f\u514d\u5185\u5b58\u6cc4\u6f0f\u548c\u65e0\u6548\u7684 UI \u66f4\u65b0\u3002</p>"},{"location":"040Jetpack/010Basic/#2-livedata","title":"2. LiveData \u7684\u6838\u5fc3\u7c7b","text":"<ul> <li>LiveData: \u6570\u636e\u6301\u6709\u7c7b\uff0c\u8d1f\u8d23\u5b58\u50a8\u6570\u636e\u5e76\u901a\u77e5\u89c2\u5bdf\u8005\u6570\u636e\u53d8\u5316\u3002</li> <li>MutableLiveData: LiveData \u7684\u53ef\u53d8\u7248\u672c\uff0c\u5141\u8bb8\u5916\u90e8\u4fee\u6539\u6570\u636e\u3002</li> <li>Observer: \u89c2\u5bdf\u8005\u63a5\u53e3\uff0c\u7528\u4e8e\u76d1\u542c LiveData \u6570\u636e\u53d8\u5316\u3002</li> </ul>"},{"location":"040Jetpack/010Basic/#3-livedata","title":"3. LiveData \u6e90\u7801\u89e3\u6790","text":""},{"location":"040Jetpack/010Basic/#31-livedata","title":"3.1 LiveData \u7c7b","text":"<p>LiveData \u7684\u6838\u5fc3\u903b\u8f91\u5728 <code>androidx.lifecycle.LiveData</code> \u7c7b\u4e2d\u3002</p> <pre><code>public abstract class LiveData&lt;T&gt; {\n    // \u5b58\u50a8\u6570\u636e\u7684\u53d8\u91cf\n    private volatile Object mData;\n\n    // \u89c2\u5bdf\u8005\u96c6\u5408\n    private SafeIterableMap&lt;Observer&lt;? super T&gt;, ObserverWrapper&gt; mObservers = new SafeIterableMap&lt;&gt;();\n\n    // \u8bbe\u7f6e\u6570\u636e\n    @MainThread\n    protected void setValue(T value) {\n        assertMainThread(\"setValue\");\n        mVersion++;\n        mData = value;\n        dispatchingValue(null);\n    }\n\n    // \u901a\u77e5\u89c2\u5bdf\u8005\u6570\u636e\u53d8\u5316\n    private void dispatchingValue(@Nullable ObserverWrapper initiator) {\n        // \u904d\u5386\u6240\u6709\u89c2\u5bdf\u8005\u5e76\u901a\u77e5\n        for (Iterator&lt;Map.Entry&lt;Observer&lt;? super T&gt;, ObserverWrapper&gt;&gt; iterator = mObservers.iteratorWithAdditions(); iterator.hasNext(); ) {\n            considerNotify(iterator.next().getValue());\n        }\n    }\n\n    // \u901a\u77e5\u5355\u4e2a\u89c2\u5bdf\u8005\n    private void considerNotify(ObserverWrapper observer) {\n        if (observer.mActive) {\n            observer.mObserver.onChanged((T) mData);\n        }\n    }\n\n    // \u6dfb\u52a0\u89c2\u5bdf\u8005\n    @MainThread\n    public void observe(@NonNull LifecycleOwner owner, @NonNull Observer&lt;? super T&gt; observer) {\n        // \u5c06\u89c2\u5bdf\u8005\u4e0e\u751f\u547d\u5468\u671f\u7ed1\u5b9a\n        LifecycleBoundObserver wrapper = new LifecycleBoundObserver(owner, observer);\n        ObserverWrapper existing = mObservers.putIfAbsent(observer, wrapper);\n        if (existing != null &amp;&amp; !existing.isAttachedTo(owner)) {\n            throw new IllegalArgumentException(\"Cannot add the same observer with different lifecycles\");\n        }\n        if (existing != null) {\n            return;\n        }\n        owner.getLifecycle().addObserver(wrapper);\n    }\n}\n</code></pre>"},{"location":"040Jetpack/010Basic/#32-mutablelivedata","title":"3.2 MutableLiveData \u7c7b","text":"<p><code>MutableLiveData</code> \u662f <code>LiveData</code> \u7684\u5b50\u7c7b\uff0c\u5141\u8bb8\u5916\u90e8\u4fee\u6539\u6570\u636e\u3002</p> <pre><code>public class MutableLiveData&lt;T&gt; extends LiveData&lt;T&gt; {\n    @Override\n    public void postValue(T value) {\n        super.postValue(value);\n    }\n\n    @Override\n    public void setValue(T value) {\n        super.setValue(value);\n    }\n}\n</code></pre>"},{"location":"040Jetpack/010Basic/#33-observer","title":"3.3 Observer \u63a5\u53e3","text":"<p><code>Observer</code> \u662f\u4e00\u4e2a\u7b80\u5355\u7684\u63a5\u53e3\uff0c\u7528\u4e8e\u76d1\u542c\u6570\u636e\u53d8\u5316\u3002</p> <pre><code>public interface Observer&lt;T&gt; {\n    void onChanged(T t);\n}\n</code></pre>"},{"location":"040Jetpack/010Basic/#4-livedata","title":"4. LiveData \u4f7f\u7528\u6848\u4f8b","text":""},{"location":"040Jetpack/010Basic/#41","title":"4.1 \u57fa\u672c\u4f7f\u7528","text":"<pre><code>// \u521b\u5efa LiveData \u5bf9\u8c61\nMutableLiveData&lt;String&gt; liveData = new MutableLiveData&lt;&gt;();\n\n// \u89c2\u5bdf LiveData \u6570\u636e\u53d8\u5316\nliveData.observe(this, new Observer&lt;String&gt;() {\n    @Override\n    public void onChanged(String s) {\n        // \u66f4\u65b0 UI\n        textView.setText(s);\n    }\n});\n\n// \u4fee\u6539 LiveData \u6570\u636e\nliveData.setValue(\"Hello, LiveData!\");\n</code></pre>"},{"location":"040Jetpack/010Basic/#42-viewmodel-livedata","title":"4.2 ViewModel \u4e2d\u4f7f\u7528 LiveData","text":"<pre><code>public class MyViewModel extends ViewModel {\n    private MutableLiveData&lt;String&gt; mText;\n\n    public MyViewModel() {\n        mText = new MutableLiveData&lt;&gt;();\n        mText.setValue(\"Hello, ViewModel!\");\n    }\n\n    public LiveData&lt;String&gt; getText() {\n        return mText;\n    }\n}\n\n// \u5728 Activity \u4e2d\u4f7f\u7528\nMyViewModel model = new ViewModelProvider(this).get(MyViewModel.class);\nmodel.getText().observe(this, new Observer&lt;String&gt;() {\n    @Override\n    public void onChanged(String s) {\n        textView.setText(s);\n    }\n});\n</code></pre>"},{"location":"040Jetpack/010Basic/#43","title":"4.3 \u6570\u636e\u8f6c\u6362","text":"<pre><code>// \u4f7f\u7528 Transformations.map \u5bf9 LiveData \u8fdb\u884c\u8f6c\u6362\nLiveData&lt;String&gt; transformedLiveData = Transformations.map(liveData, input -&gt; input + \" transformed\");\n\n// \u89c2\u5bdf\u8f6c\u6362\u540e\u7684 LiveData\ntransformedLiveData.observe(this, new Observer&lt;String&gt;() {\n    @Override\n    public void onChanged(String s) {\n        textView.setText(s);\n    }\n});\n</code></pre>"},{"location":"040Jetpack/010Basic/#5_2","title":"5. \u603b\u7ed3","text":"<ul> <li>LiveData \u662f\u4e00\u4e2a\u751f\u547d\u5468\u671f\u611f\u77e5\u7684\u6570\u636e\u6301\u6709\u7c7b\uff0c\u80fd\u591f\u81ea\u52a8\u7ba1\u7406\u89c2\u5bdf\u8005\u7684\u751f\u547d\u5468\u671f\uff0c\u907f\u514d\u5185\u5b58\u6cc4\u6f0f\u3002</li> <li>MutableLiveData \u662f LiveData \u7684\u53ef\u53d8\u7248\u672c\uff0c\u5141\u8bb8\u5916\u90e8\u4fee\u6539\u6570\u636e\u3002</li> <li>Observer \u63a5\u53e3\u7528\u4e8e\u76d1\u542c\u6570\u636e\u53d8\u5316\uff0c\u5e76\u5728\u6570\u636e\u53d8\u5316\u65f6\u66f4\u65b0 UI\u3002</li> <li>LiveData \u901a\u5e38\u4e0e ViewModel \u7ed3\u5408\u4f7f\u7528\uff0c\u7528\u4e8e\u5728 UI \u7ec4\u4ef6\u4e4b\u95f4\u5171\u4eab\u6570\u636e\u3002</li> </ul> <p>\u901a\u8fc7\u6e90\u7801\u89e3\u6790\u548c\u4f7f\u7528\u6848\u4f8b\uff0c\u53ef\u4ee5\u66f4\u597d\u5730\u7406\u89e3 LiveData \u7684\u5de5\u4f5c\u539f\u7406\u548c\u4f7f\u7528\u65b9\u6cd5\u3002</p>"},{"location":"040Jetpack/010Basic/#livedata_1","title":"LiveData\u539f\u7406","text":"\u7b54\u6848 <p>https://juejin.cn/post/6903143273737814029/</p> <p>LiveData\u89e3\u51b3\u4e86\u4ec0\u4e48\u95ee\u9898\uff1f \u4f7f\u7528 LiveData \u5177\u6709\u4ee5\u4e0b\u4f18\u52bf\uff1a</p> <p>\u786e\u4fdd\u754c\u9762\u7b26\u5408\u6570\u636e\u72b6\u6001\uff0c\u5f53\u751f\u547d\u5468\u671f\u72b6\u6001\u53d8\u5316\u65f6\uff0cLiveData\u901a\u77e5Observer\uff0c\u53ef\u4ee5\u5728observer\u4e2d\u66f4\u65b0\u754c\u9762\u3002\u89c2\u5bdf\u8005\u53ef\u4ee5\u5728\u751f\u547d\u5468\u671f\u72b6\u6001\u66f4\u6539\u65f6\u5237\u65b0\u754c\u9762\uff0c\u800c\u4e0d\u662f\u5728\u6bcf\u6b21\u6570\u636e\u53d8\u5316\u65f6\u5237\u65b0\u754c\u9762\u3002 \u4e0d\u4f1a\u53d1\u751f\u5185\u5b58\u6cc4\u6f0f\uff0cobserver\u4f1a\u5728LifecycleOwner\u72b6\u6001\u53d8\u4e3aDESTROYED\u540e\u81ea\u52a8remove\u3002 \u4e0d\u4f1a\u56e0 Activity \u505c\u6b62\u800c\u5bfc\u81f4\u5d29\u6e83\uff0c\u5982\u679cLifecycleOwner\u751f\u547d\u5468\u671f\u5904\u4e8e\u975e\u6d3b\u8dc3\u72b6\u6001\uff0c\u5219\u5b83\u4e0d\u4f1a\u63a5\u6536\u4efb\u4f55 LiveData\u4e8b\u4ef6\u3002 \u4e0d\u9700\u8981\u624b\u52a8\u89e3\u9664\u89c2\u5bdf\uff0c\u5f00\u53d1\u8005\u4e0d\u9700\u8981\u5728onPause\u6216onDestroy\u65b9\u6cd5\u4e2d\u89e3\u9664\u5bf9LiveData\u7684\u89c2\u5bdf\uff0c\u56e0\u4e3aLiveData\u80fd\u611f\u77e5\u751f\u547d\u5468\u671f\u72b6\u6001\u53d8\u5316\uff0c\u6240\u4ee5\u4f1a\u81ea\u52a8\u7ba1\u7406\u6240\u6709\u8fd9\u4e9b\u64cd\u4f5c\u3002 \u6570\u636e\u59cb\u7ec8\u4fdd\u6301\u6700\u65b0\u72b6\u6001\uff0c\u6570\u636e\u66f4\u65b0\u65f6 \u82e5LifecycleOwner\u4e3a\u975e\u6d3b\u8dc3\u72b6\u6001\uff0c\u90a3\u4e48\u4f1a\u5728\u53d8\u4e3a\u6d3b\u8dc3\u65f6\u63a5\u6536\u6700\u65b0\u6570\u636e\u3002\u4f8b\u5982\uff0c\u66fe\u7ecf\u5728\u540e\u53f0\u7684 Activity \u4f1a\u5728\u8fd4\u56de\u524d\u53f0\u540e\uff0cobserver\u7acb\u5373\u63a5\u6536\u6700\u65b0\u7684\u6570\u636e\u3002</p> <p><code>LiveData</code> \u662f Android Jetpack \u7ec4\u4ef6\u5e93\u4e2d\u7684\u4e00\u4e2a\u6838\u5fc3\u7ec4\u4ef6\uff0c\u5b83\u7684\u51fa\u73b0\u4e3b\u8981\u662f\u4e3a\u4e86\u89e3\u51b3\u4ee5\u4e0b\u51e0\u4e2a\u95ee\u9898\uff1a</p>"},{"location":"040Jetpack/010Basic/#1_1","title":"1. \u751f\u547d\u5468\u671f\u611f\u77e5","text":""},{"location":"040Jetpack/010Basic/#_12","title":"\u95ee\u9898\uff1a","text":"<p>\u5728 Android \u5f00\u53d1\u4e2d\uff0cUI \u7ec4\u4ef6\uff08\u5982 Activity \u548c Fragment\uff09\u5177\u6709\u751f\u547d\u5468\u671f\u3002\u5982\u679c\u5728 UI \u7ec4\u4ef6\u9500\u6bc1\u540e\u4ecd\u7136\u66f4\u65b0 UI\uff0c\u4f1a\u5bfc\u81f4\u5185\u5b58\u6cc4\u6f0f\u6216\u5d29\u6e83\u3002</p>"},{"location":"040Jetpack/010Basic/#_13","title":"\u89e3\u51b3\u65b9\u6848\uff1a","text":"<p><code>LiveData</code> \u662f\u751f\u547d\u5468\u671f\u611f\u77e5\u7684\uff0c\u5b83\u53ea\u4f1a\u5c06\u6570\u636e\u66f4\u65b0\u901a\u77e5\u7ed9\u5904\u4e8e\u6d3b\u8dc3\u72b6\u6001\uff08\u5982 <code>STARTED</code> \u6216 <code>RESUMED</code>\uff09\u7684\u89c2\u5bdf\u8005\u3002\u5982\u679c\u89c2\u5bdf\u8005\u7684\u751f\u547d\u5468\u671f\u5904\u4e8e\u975e\u6d3b\u8dc3\u72b6\u6001\uff08\u5982 <code>DESTROYED</code>\uff09\uff0c<code>LiveData</code> \u4f1a\u81ea\u52a8\u505c\u6b62\u901a\u77e5\uff0c\u4ece\u800c\u907f\u514d\u5185\u5b58\u6cc4\u6f0f\u548c\u65e0\u6548\u7684 UI \u66f4\u65b0\u3002</p>"},{"location":"040Jetpack/010Basic/#2-ui","title":"2. \u6570\u636e\u4e0e UI \u7684\u89e3\u8026","text":""},{"location":"040Jetpack/010Basic/#_14","title":"\u95ee\u9898\uff1a","text":"<p>\u4f20\u7edf\u7684\u6570\u636e\u66f4\u65b0\u65b9\u5f0f\uff08\u5982\u56de\u8c03\u6216\u63a5\u53e3\uff09\u901a\u5e38\u9700\u8981\u624b\u52a8\u7ba1\u7406 UI \u7ec4\u4ef6\u7684\u751f\u547d\u5468\u671f\uff0c\u5bfc\u81f4\u4ee3\u7801\u8026\u5408\u5ea6\u9ad8\uff0c\u96be\u4ee5\u7ef4\u62a4\u3002</p>"},{"location":"040Jetpack/010Basic/#_15","title":"\u89e3\u51b3\u65b9\u6848\uff1a","text":"<p><code>LiveData</code> \u901a\u8fc7\u89c2\u5bdf\u8005\u6a21\u5f0f\u5b9e\u73b0\u4e86\u6570\u636e\u4e0e UI \u7684\u89e3\u8026\u3002UI \u7ec4\u4ef6\u53ea\u9700\u8981\u89c2\u5bdf <code>LiveData</code>\uff0c\u5e76\u5728\u6570\u636e\u53d8\u5316\u65f6\u66f4\u65b0 UI\uff0c\u800c\u4e0d\u9700\u8981\u5173\u5fc3\u6570\u636e\u7684\u6765\u6e90\u548c\u751f\u547d\u5468\u671f\u7ba1\u7406\u3002</p>"},{"location":"040Jetpack/010Basic/#3_1","title":"3. \u907f\u514d\u5185\u5b58\u6cc4\u6f0f","text":""},{"location":"040Jetpack/010Basic/#_16","title":"\u95ee\u9898\uff1a","text":"<p>\u5728 Android \u4e2d\uff0c\u5982\u679c\u6301\u6709\u5bf9 Activity \u6216 Fragment \u7684\u5f15\u7528\uff0c\u800c\u8fd9\u4e9b\u7ec4\u4ef6\u7684\u751f\u547d\u5468\u671f\u5df2\u7ecf\u7ed3\u675f\uff0c\u4f1a\u5bfc\u81f4\u5185\u5b58\u6cc4\u6f0f\u3002</p>"},{"location":"040Jetpack/010Basic/#_17","title":"\u89e3\u51b3\u65b9\u6848\uff1a","text":"<p><code>LiveData</code> \u81ea\u52a8\u4e0e <code>LifecycleOwner</code>\uff08\u5982 Activity \u6216 Fragment\uff09\u7ed1\u5b9a\uff0c\u5f53 <code>LifecycleOwner</code> \u88ab\u9500\u6bc1\u65f6\uff0c<code>LiveData</code> \u4f1a\u81ea\u52a8\u6e05\u7406\u89c2\u5bdf\u8005\uff0c\u907f\u514d\u5185\u5b58\u6cc4\u6f0f\u3002</p>"},{"location":"040Jetpack/010Basic/#4_2","title":"4. \u6570\u636e\u6301\u4e45\u5316","text":""},{"location":"040Jetpack/010Basic/#_18","title":"\u95ee\u9898\uff1a","text":"<p>\u5728\u914d\u7f6e\u53d8\u66f4\uff08\u5982\u5c4f\u5e55\u65cb\u8f6c\uff09\u65f6\uff0cActivity \u6216 Fragment \u4f1a\u88ab\u9500\u6bc1\u5e76\u91cd\u65b0\u521b\u5efa\uff0c\u5bfc\u81f4\u6570\u636e\u4e22\u5931\u3002</p>"},{"location":"040Jetpack/010Basic/#_19","title":"\u89e3\u51b3\u65b9\u6848\uff1a","text":"<p><code>LiveData</code> \u901a\u5e38\u4e0e <code>ViewModel</code> \u7ed3\u5408\u4f7f\u7528\u3002<code>ViewModel</code> \u5728\u914d\u7f6e\u53d8\u66f4\u65f6\u4e0d\u4f1a\u88ab\u9500\u6bc1\uff0c\u56e0\u6b64 <code>LiveData</code> \u4e2d\u7684\u6570\u636e\u53ef\u4ee5\u6301\u4e45\u5316\uff0c\u907f\u514d\u91cd\u65b0\u52a0\u8f7d\u6570\u636e\u3002</p>"},{"location":"040Jetpack/010Basic/#5_3","title":"5. \u7b80\u5316\u5f02\u6b65\u6570\u636e\u66f4\u65b0","text":""},{"location":"040Jetpack/010Basic/#_20","title":"\u95ee\u9898\uff1a","text":"<p>\u5728 Android \u4e2d\uff0cUI \u66f4\u65b0\u5fc5\u987b\u5728\u4e3b\u7ebf\u7a0b\u4e2d\u8fdb\u884c\uff0c\u800c\u6570\u636e\u52a0\u8f7d\u901a\u5e38\u5728\u540e\u53f0\u7ebf\u7a0b\u4e2d\u8fdb\u884c\u3002\u4f20\u7edf\u7684\u65b9\u5f0f\u9700\u8981\u624b\u52a8\u5207\u6362\u7ebf\u7a0b\uff0c\u4ee3\u7801\u590d\u6742\u4e14\u5bb9\u6613\u51fa\u9519\u3002</p>"},{"location":"040Jetpack/010Basic/#_21","title":"\u89e3\u51b3\u65b9\u6848\uff1a","text":"<p><code>LiveData</code> \u63d0\u4f9b\u4e86 <code>postValue</code> \u65b9\u6cd5\uff0c\u53ef\u4ee5\u5728\u540e\u53f0\u7ebf\u7a0b\u4e2d\u66f4\u65b0\u6570\u636e\uff0c\u5e76\u81ea\u52a8\u5c06\u6570\u636e\u66f4\u65b0\u901a\u77e5\u5207\u6362\u5230\u4e3b\u7ebf\u7a0b\uff0c\u7b80\u5316\u4e86\u7ebf\u7a0b\u5207\u6362\u7684\u903b\u8f91\u3002</p>"},{"location":"040Jetpack/010Basic/#6_2","title":"6. \u7edf\u4e00\u7684\u89c2\u5bdf\u8005\u6a21\u5f0f","text":""},{"location":"040Jetpack/010Basic/#_22","title":"\u95ee\u9898\uff1a","text":"<p>\u5728 Android \u4e2d\uff0c\u6570\u636e\u6765\u6e90\u53ef\u80fd\u591a\u79cd\u591a\u6837\uff08\u5982\u7f51\u7edc\u8bf7\u6c42\u3001\u6570\u636e\u5e93\u67e5\u8be2\u3001\u672c\u5730\u7f13\u5b58\u7b49\uff09\uff0c\u4f20\u7edf\u7684\u65b9\u5f0f\u9700\u8981\u4e3a\u6bcf\u79cd\u6570\u636e\u6765\u6e90\u5b9e\u73b0\u4e0d\u540c\u7684\u89c2\u5bdf\u8005\u6a21\u5f0f\u3002</p>"},{"location":"040Jetpack/010Basic/#_23","title":"\u89e3\u51b3\u65b9\u6848\uff1a","text":"<p><code>LiveData</code> \u63d0\u4f9b\u4e86\u4e00\u79cd\u7edf\u4e00\u7684\u89c2\u5bdf\u8005\u6a21\u5f0f\uff0c\u65e0\u8bba\u6570\u636e\u6765\u6e90\u662f\u4ec0\u4e48\uff0c\u90fd\u53ef\u4ee5\u901a\u8fc7 <code>LiveData</code> \u6765\u89c2\u5bdf\u6570\u636e\u53d8\u5316\uff0c\u5e76\u5728 UI \u4e2d\u66f4\u65b0\u3002</p>"},{"location":"040Jetpack/010Basic/#7-jetpack","title":"7. \u4e0e Jetpack \u7ec4\u4ef6\u65e0\u7f1d\u96c6\u6210","text":""},{"location":"040Jetpack/010Basic/#_24","title":"\u95ee\u9898\uff1a","text":"<p>\u5728 Jetpack \u7ec4\u4ef6\u5e93\u63a8\u51fa\u4e4b\u524d\uff0cAndroid \u5f00\u53d1\u4e2d\u7f3a\u4e4f\u4e00\u5957\u7edf\u4e00\u7684\u6570\u636e\u7ba1\u7406\u548c\u751f\u547d\u5468\u671f\u7ba1\u7406\u65b9\u6848\u3002</p>"},{"location":"040Jetpack/010Basic/#_25","title":"\u89e3\u51b3\u65b9\u6848\uff1a","text":"<p><code>LiveData</code> \u662f Jetpack \u7ec4\u4ef6\u5e93\u7684\u4e00\u90e8\u5206\uff0c\u4e0e <code>ViewModel</code>\u3001<code>Room</code>\u3001<code>WorkManager</code> \u7b49\u7ec4\u4ef6\u65e0\u7f1d\u96c6\u6210\uff0c\u63d0\u4f9b\u4e86\u4e00\u5957\u5b8c\u6574\u7684\u89e3\u51b3\u65b9\u6848\u3002</p>"},{"location":"040Jetpack/010Basic/#_26","title":"\u603b\u7ed3","text":"<p><code>LiveData</code> \u7684\u51fa\u73b0\u4e3b\u8981\u662f\u4e3a\u4e86\u89e3\u51b3\u4ee5\u4e0b\u95ee\u9898\uff1a 1. \u751f\u547d\u5468\u671f\u611f\u77e5\uff1a\u907f\u514d\u5728 UI \u7ec4\u4ef6\u9500\u6bc1\u540e\u66f4\u65b0 UI\u3002 2. \u6570\u636e\u4e0e UI \u7684\u89e3\u8026\uff1a\u7b80\u5316\u6570\u636e\u66f4\u65b0\u7684\u903b\u8f91\u3002 3. \u907f\u514d\u5185\u5b58\u6cc4\u6f0f\uff1a\u81ea\u52a8\u6e05\u7406\u89c2\u5bdf\u8005\u3002 4. \u6570\u636e\u6301\u4e45\u5316\uff1a\u5728\u914d\u7f6e\u53d8\u66f4\u65f6\u4fdd\u6301\u6570\u636e\u3002 5. \u7b80\u5316\u5f02\u6b65\u6570\u636e\u66f4\u65b0\uff1a\u81ea\u52a8\u5207\u6362\u7ebf\u7a0b\u3002 6. \u7edf\u4e00\u7684\u89c2\u5bdf\u8005\u6a21\u5f0f\uff1a\u9002\u7528\u4e8e\u591a\u79cd\u6570\u636e\u6765\u6e90\u3002 7. \u4e0e Jetpack \u7ec4\u4ef6\u96c6\u6210\uff1a\u63d0\u4f9b\u4e00\u5957\u5b8c\u6574\u7684\u89e3\u51b3\u65b9\u6848\u3002</p> <p>\u901a\u8fc7 <code>LiveData</code>\uff0c\u5f00\u53d1\u8005\u53ef\u4ee5\u66f4\u8f7b\u677e\u5730\u5b9e\u73b0\u6570\u636e\u9a71\u52a8\u7684 UI \u66f4\u65b0\uff0c\u540c\u65f6\u907f\u514d\u5e38\u89c1\u7684\u751f\u547d\u5468\u671f\u95ee\u9898\u548c\u5185\u5b58\u6cc4\u6f0f\u95ee\u9898\u3002</p>"},{"location":"040Jetpack/010Basic/#livedata_2","title":"LiveData\u5b58\u5728\u7684\u5c40\u9650\u6027","text":"\u7b54\u6848 <p>https://juejin.cn/post/7121621553670225957 LiveData \u5b58\u5728\u7684\u5c40\u9650 LiveData \u662f Android \u751f\u6001\u4e2d\u4e00\u4e2a\u7684\u7b80\u5355\u7684\u751f\u547d\u5468\u671f\u611f\u77e5\u578b\u5bb9\u5668\u3002\u7b80\u5355\u5373\u662f\u5b83\u7684\u4f18\u52bf\uff0c\u4e5f\u662f\u5b83\u7684\u5c40\u9650\uff0c\u5f53\u7136\u8fd9\u4e9b\u5c40\u9650\u6027\u4e0d\u5e94\u8be5\u7b97 LiveData \u7684\u7f3a\u70b9\uff0c\u56e0\u4e3a LiveData \u7684\u8bbe\u8ba1\u521d\u8877\u5c31\u662f\u4e00\u4e2a\u7b80\u5355\u7684\u6570\u636e\u5bb9\u5668\uff0c\u9700\u8981\u5177\u4f53\u95ee\u9898\u5177\u4f53\u5206\u6790\u3002\u5bf9\u4e8e\u7b80\u5355\u7684\u6570\u636e\u6d41\u573a\u666f\uff0c\u4f7f\u7528 LiveData \u5b8c\u5168\u6ca1\u6709\u95ee\u9898\u3002</p> <p>1\u3001LiveData \u53ea\u80fd\u5728\u4e3b\u7ebf\u7a0b\u66f4\u65b0\u6570\u636e\uff1a \u53ea\u80fd\u5728\u4e3b\u7ebf\u7a0b setValue\uff0c\u5373\u4f7f postValue \u5185\u90e8\u4e5f\u662f\u5207\u6362\u5230\u4e3b\u7ebf\u7a0b\u6267\u884c\uff1b 2\u3001LiveData \u6570\u636e\u91cd\u653e\u95ee\u9898\uff1a \u6ce8\u518c\u65b0\u7684\u8ba2\u9605\u8005\uff0c\u4f1a\u91cd\u65b0\u6536\u5230 LiveData \u5b58\u50a8\u7684\u6570\u636e\uff0c\u8fd9\u5728\u6709\u4e9b\u60c5\u51b5\u4e0b\u4e0d\u7b26\u5408\u9884\u671f\uff08\u5177\u4f53\u89c1\u7b2c TODO \u8282\uff09\uff1b 3\u3001LiveData \u4e0d\u9632\u6296\u95ee\u9898\uff1a \u91cd\u590d setValue \u76f8\u540c\u7684\u503c\uff0c\u8ba2\u9605\u8005\u4f1a\u6536\u5230\u591a\u6b21 onChanged() \u56de\u8c03\uff08\u53ef\u4ee5\u4f7f\u7528 distinctUntilChanged() \u4f18\u5316\uff09\uff1b 4\u3001LiveData \u4e22\u5931\u6570\u636e\u95ee\u9898\uff1a \u5728\u6570\u636e\u751f\u4ea7\u901f\u5ea6 &gt; \u6570\u636e\u6d88\u8d39\u901f\u5ea6\u65f6\uff0cLiveData \u65e0\u6cd5\u89c2\u5bdf\u8005\u80fd\u591f\u63a5\u6536\u5230\u5168\u90e8\u6570\u636e\u3002\u6bd4\u5982\u5728\u5b50\u7ebf\u7a0b\u5927\u91cf postValue \u6570\u636e\u4f46\u4e3b\u7ebf\u7a0b\u6d88\u8d39\u8ddf\u4e0d\u4e0a\u65f6\uff0c\u4e2d\u95f4\u5c31\u4f1a\u6709\u4e00\u90e8\u5206\u6570\u636e\u88ab\u5ffd\u7565\u3002</p> <p>1.4 LiveData \u7684\u66ff\u4ee3\u8005</p> <p>1\u3001RxJava\uff1a RxJava \u662f\u7b2c\u4e09\u65b9\u7ec4\u7ec7 ReactiveX \u5f00\u53d1\u7684\u7ec4\u4ef6\uff0cRx \u662f\u4e00\u4e2a\u5305\u62ec Java\u3001Go \u7b49\u8bed\u8a00\u5728\u5185\u7684\u591a\u8bed\u8a00\u6570\u636e\u6d41\u6846\u67b6\u3002\u529f\u80fd\u5f3a\u5927\u662f\u5b83\u7684\u4f18\u52bf\uff0c\u652f\u6301\u5927\u91cf\u4e30\u5bcc\u7684\u64cd\u4f5c\u7b26\uff0c\u4e5f\u652f\u6301\u7ebf\u7a0b\u5207\u6362\u548c\u80cc\u538b\u3002\u7136\u800c Rx \u7684\u5b66\u4e60\u95e8\u69db\u8fc7\u9ad8\uff0c\u5bf9\u5f00\u53d1\u53cd\u800c\u662f\u4e00\u79cd\u65b0\u7684\u8d1f\u62c5\uff0c\u4e5f\u4f1a\u5e26\u6765\u8bef\u7528\u7684\u98ce\u9669\u3002 2\u3001Kotlin Flow\uff1a Kotlin Flow \u662f\u57fa\u4e8e Kotlin \u534f\u7a0b\u57fa\u7840\u80fd\u529b\u642d\u5efa\u7684\u4e00\u5957\u6570\u636e\u6d41\u6846\u67b6\uff0c\u4ece\u529f\u80fd\u590d\u6742\u6027\u4e0a\u770b\u662f\u4ecb\u4e8e LiveData \u548c RxJava \u4e4b\u95f4\u7684\u89e3\u51b3\u65b9\u6848\u3002Kotlin Flow \u62e5\u6709\u6bd4 LiveData \u66f4\u4e30\u5bcc\u7684\u80fd\u529b\uff0c\u4f46\u88c1\u526a\u4e86 RxJava \u5927\u91cf\u590d\u6742\u7684\u64cd\u4f5c\u7b26\uff0c\u505a\u5f97\u66f4\u52a0\u7cbe\u7b80\u3002\u5e76\u4e14\u5728 Kotlin \u534f\u7a0b\u7684\u52a0\u6301\u4e0b\uff0cKotlin Flow \u76ee\u524d\u662f Google \u4e3b\u63a8\u7684\u6570\u636e\u6d41\u6846\u67b6\u3002</p>"},{"location":"040Jetpack/010Basic/#viewmodel","title":"ViewModel\u4f7f\u7528\u6848\u4f8b","text":"\u7b54\u6848 <p><code>ViewModel</code> \u662f Android \u67b6\u6784\u7ec4\u4ef6\u4e2d\u7684\u6838\u5fc3\u90e8\u5206\uff0c\u7528\u4e8e\u7ba1\u7406\u4e0e UI \u76f8\u5173\u7684\u6570\u636e\uff0c\u5e76\u5728\u914d\u7f6e\u66f4\u6539\uff08\u5982\u5c4f\u5e55\u65cb\u8f6c\uff09\u65f6\u4fdd\u6301\u6570\u636e\u7684\u6301\u4e45\u6027\u3002\u4ee5\u4e0b\u662f\u4e00\u4e9b\u5e38\u89c1\u7684 <code>ViewModel</code> \u4f7f\u7528\u6848\u4f8b\uff0c\u5e2e\u52a9\u4f60\u66f4\u597d\u5730\u7406\u89e3\u5176\u5e94\u7528\u573a\u666f\u3002</p>"},{"location":"040Jetpack/010Basic/#1-ui","title":"1. \u4fdd\u5b58 UI \u6570\u636e","text":"<p>\u5728 Activity \u6216 Fragment \u4e2d\uff0c\u5f53\u5c4f\u5e55\u65cb\u8f6c\u6216\u5176\u4ed6\u914d\u7f6e\u66f4\u6539\u65f6\uff0cUI \u6570\u636e\u901a\u5e38\u4f1a\u4e22\u5931\u3002\u4f7f\u7528 <code>ViewModel</code> \u53ef\u4ee5\u907f\u514d\u8fd9\u79cd\u60c5\u51b5\u3002</p>"},{"location":"040Jetpack/010Basic/#_27","title":"\u6848\u4f8b\uff1a\u8ba1\u6570\u5668\u5e94\u7528","text":"<pre><code>class CounterViewModel : ViewModel() {\n    private val _count = MutableLiveData&lt;Int&gt;()\n    val count: LiveData&lt;Int&gt; get() = _count\n\n    init {\n        _count.value = 0\n    }\n\n    fun increment() {\n        _count.value = (_count.value ?: 0) + 1\n    }\n}\n\nclass CounterActivity : AppCompatActivity() {\n    private lateinit var viewModel: CounterViewModel\n\n    override fun onCreate(savedInstanceState: Bundle?) {\n        super.onCreate(savedInstanceState)\n        setContentView(R.layout.activity_counter)\n\n        viewModel = ViewModelProvider(this).get(CounterViewModel::class.java)\n\n        val countTextView = findViewById&lt;TextView&gt;(R.id.countTextView)\n        val incrementButton = findViewById&lt;Button&gt;(R.id.incrementButton)\n\n        viewModel.count.observe(this, Observer { count -&gt;\n            countTextView.text = \"Count: $count\"\n        })\n\n        incrementButton.setOnClickListener {\n            viewModel.increment()\n        }\n    }\n}\n</code></pre>"},{"location":"040Jetpack/010Basic/#_28","title":"\u8bf4\u660e\uff1a","text":"<ul> <li><code>CounterViewModel</code> \u4fdd\u5b58\u8ba1\u6570\u5668\u7684\u72b6\u6001\u3002</li> <li>\u5f53\u5c4f\u5e55\u65cb\u8f6c\u65f6\uff0c<code>CounterViewModel</code> \u4e0d\u4f1a\u88ab\u9500\u6bc1\uff0c\u8ba1\u6570\u5668\u7684\u503c\u5f97\u4ee5\u4fdd\u7559\u3002</li> </ul>"},{"location":"040Jetpack/010Basic/#2_2","title":"2. \u6570\u636e\u5171\u4eab","text":"<p><code>ViewModel</code> \u53ef\u4ee5\u5728\u591a\u4e2a Fragment \u4e4b\u95f4\u5171\u4eab\u6570\u636e\uff0c\u800c\u4e0d\u9700\u8981\u901a\u8fc7 Activity \u4f20\u9012\u6570\u636e\u3002</p>"},{"location":"040Jetpack/010Basic/#_29","title":"\u6848\u4f8b\uff1a\u5171\u4eab\u7528\u6237\u4fe1\u606f","text":"<pre><code>class SharedViewModel : ViewModel() {\n    private val _user = MutableLiveData&lt;User&gt;()\n    val user: LiveData&lt;User&gt; get() = _user\n\n    fun setUser(user: User) {\n        _user.value = user\n    }\n}\n\nclass UserProfileFragment : Fragment() {\n    private lateinit var viewModel: SharedViewModel\n\n    override fun onCreateView(inflater: LayoutInflater, container: ViewGroup?, savedInstanceState: Bundle?): View? {\n        val view = inflater.inflate(R.layout.fragment_user_profile, container, false)\n        viewModel = ViewModelProvider(requireActivity()).get(SharedViewModel::class.java)\n\n        viewModel.user.observe(viewLifecycleOwner, Observer { user -&gt;\n            // \u66f4\u65b0 UI\n        })\n\n        return view\n    }\n}\n\nclass UserSettingsFragment : Fragment() {\n    private lateinit var viewModel: SharedViewModel\n\n    override fun onCreateView(inflater: LayoutInflater, container: ViewGroup?, savedInstanceState: Bundle?): View? {\n        val view = inflater.inflate(R.layout.fragment_user_settings, container, false)\n        viewModel = ViewModelProvider(requireActivity()).get(SharedViewModel::class.java)\n\n        viewModel.user.observe(viewLifecycleOwner, Observer { user -&gt;\n            // \u66f4\u65b0 UI\n        })\n\n        return view\n    }\n}\n</code></pre>"},{"location":"040Jetpack/010Basic/#_30","title":"\u8bf4\u660e\uff1a","text":"<ul> <li><code>SharedViewModel</code> \u5728 Activity \u4e2d\u521b\u5efa\uff0c\u5e76\u5728\u591a\u4e2a Fragment \u4e4b\u95f4\u5171\u4eab\u3002</li> <li>\u5f53\u7528\u6237\u4fe1\u606f\u66f4\u65b0\u65f6\uff0c\u6240\u6709\u89c2\u5bdf\u8be5 <code>LiveData</code> \u7684 Fragment \u90fd\u4f1a\u6536\u5230\u901a\u77e5\u3002</li> </ul>"},{"location":"040Jetpack/010Basic/#3_2","title":"3. \u5f02\u6b65\u6570\u636e\u52a0\u8f7d","text":"<p><code>ViewModel</code> \u53ef\u4ee5\u7ed3\u5408 <code>LiveData</code> \u548c <code>Coroutine</code> \u6216 <code>RxJava</code> \u5b9e\u73b0\u5f02\u6b65\u6570\u636e\u52a0\u8f7d\uff0c\u907f\u514d\u5728 UI \u7ebf\u7a0b\u4e2d\u6267\u884c\u8017\u65f6\u64cd\u4f5c\u3002</p>"},{"location":"040Jetpack/010Basic/#_31","title":"\u6848\u4f8b\uff1a\u4ece\u7f51\u7edc\u52a0\u8f7d\u6570\u636e","text":"<pre><code>class NewsViewModel : ViewModel() {\n    private val _news = MutableLiveData&lt;List&lt;News&gt;&gt;()\n    val news: LiveData&lt;List&lt;News&gt;&gt; get() = _news\n\n    fun loadNews() {\n        viewModelScope.launch {\n            val result = NewsRepository.fetchNews() // \u6a21\u62df\u7f51\u7edc\u8bf7\u6c42\n            _news.value = result\n        }\n    }\n}\n\nclass NewsActivity : AppCompatActivity() {\n    private lateinit var viewModel: NewsViewModel\n\n    override fun onCreate(savedInstanceState: Bundle?) {\n        super.onCreate(savedInstanceState)\n        setContentView(R.layout.activity_news)\n\n        viewModel = ViewModelProvider(this).get(NewsViewModel::class.java)\n\n        val newsRecyclerView = findViewById&lt;RecyclerView&gt;(R.id.newsRecyclerView)\n        val adapter = NewsAdapter()\n        newsRecyclerView.adapter = adapter\n\n        viewModel.news.observe(this, Observer { news -&gt;\n            adapter.submitList(news)\n        })\n\n        viewModel.loadNews()\n    }\n}\n</code></pre>"},{"location":"040Jetpack/010Basic/#_32","title":"\u8bf4\u660e\uff1a","text":"<ul> <li><code>NewsViewModel</code> \u4f7f\u7528 <code>viewModelScope</code> \u542f\u52a8\u534f\u7a0b\uff0c\u4ece\u7f51\u7edc\u52a0\u8f7d\u6570\u636e\u3002</li> <li>\u6570\u636e\u52a0\u8f7d\u5b8c\u6210\u540e\uff0c\u901a\u8fc7 <code>LiveData</code> \u901a\u77e5 UI \u66f4\u65b0\u3002</li> </ul>"},{"location":"040Jetpack/010Basic/#4_3","title":"4. \u8868\u5355\u6570\u636e\u4fdd\u5b58","text":"<p>\u5728\u8868\u5355\u8f93\u5165\u573a\u666f\u4e2d\uff0c<code>ViewModel</code> \u53ef\u4ee5\u4fdd\u5b58\u7528\u6237\u8f93\u5165\u7684\u6570\u636e\uff0c\u907f\u514d\u56e0\u914d\u7f6e\u66f4\u6539\u5bfc\u81f4\u6570\u636e\u4e22\u5931\u3002</p>"},{"location":"040Jetpack/010Basic/#_33","title":"\u6848\u4f8b\uff1a\u7528\u6237\u6ce8\u518c\u8868\u5355","text":"<pre><code>class RegistrationViewModel : ViewModel() {\n    private val _username = MutableLiveData&lt;String&gt;()\n    val username: LiveData&lt;String&gt; get() = _username\n\n    private val _email = MutableLiveData&lt;String&gt;()\n    val email: LiveData&lt;String&gt; get() = _email\n\n    fun setUsername(username: String) {\n        _username.value = username\n    }\n\n    fun setEmail(email: String) {\n        _email.value = email\n    }\n}\n\nclass RegistrationActivity : AppCompatActivity() {\n    private lateinit var viewModel: RegistrationViewModel\n\n    override fun onCreate(savedInstanceState: Bundle?) {\n        super.onCreate(savedInstanceState)\n        setContentView(R.layout.activity_registration)\n\n        viewModel = ViewModelProvider(this).get(RegistrationViewModel::class.java)\n\n        val usernameEditText = findViewById&lt;EditText&gt;(R.id.usernameEditText)\n        val emailEditText = findViewById&lt;EditText&gt;(R.id.emailEditText)\n\n        usernameEditText.setText(viewModel.username.value)\n        emailEditText.setText(viewModel.email.value)\n\n        usernameEditText.addTextChangedListener {\n            viewModel.setUsername(it.toString())\n        }\n\n        emailEditText.addTextChangedListener {\n            viewModel.setEmail(it.toString())\n        }\n    }\n}\n</code></pre>"},{"location":"040Jetpack/010Basic/#_34","title":"\u8bf4\u660e\uff1a","text":"<ul> <li><code>RegistrationViewModel</code> \u4fdd\u5b58\u7528\u6237\u8f93\u5165\u7684\u7528\u6237\u540d\u548c\u90ae\u7bb1\u3002</li> <li>\u5f53\u5c4f\u5e55\u65cb\u8f6c\u65f6\uff0c\u8f93\u5165\u6846\u4e2d\u7684\u6570\u636e\u4e0d\u4f1a\u4e22\u5931\u3002</li> </ul>"},{"location":"040Jetpack/010Basic/#5_4","title":"5. \u72b6\u6001\u7ba1\u7406","text":"<p><code>ViewModel</code> \u53ef\u4ee5\u7528\u4e8e\u7ba1\u7406\u590d\u6742\u7684 UI \u72b6\u6001\uff0c\u4f8b\u5982\u52a0\u8f7d\u72b6\u6001\u3001\u9519\u8bef\u72b6\u6001\u7b49\u3002</p>"},{"location":"040Jetpack/010Basic/#_35","title":"\u6848\u4f8b\uff1a\u52a0\u8f7d\u72b6\u6001\u7ba1\u7406","text":"<pre><code>class LoadStateViewModel : ViewModel() {\n    private val _loadingState = MutableLiveData&lt;Boolean&gt;()\n    val loadingState: LiveData&lt;Boolean&gt; get() = _loadingState\n\n    private val _errorState = MutableLiveData&lt;String&gt;()\n    val errorState: LiveData&lt;String&gt; get() = _errorState\n\n    fun loadData() {\n        _loadingState.value = true\n        viewModelScope.launch {\n            try {\n                // \u6a21\u62df\u7f51\u7edc\u8bf7\u6c42\n                delay(2000)\n                _loadingState.value = false\n            } catch (e: Exception) {\n                _loadingState.value = false\n                _errorState.value = e.message\n            }\n        }\n    }\n}\n\nclass LoadStateActivity : AppCompatActivity() {\n    private lateinit var viewModel: LoadStateViewModel\n\n    override fun onCreate(savedInstanceState: Bundle?) {\n        super.onCreate(savedInstanceState)\n        setContentView(R.layout.activity_load_state)\n\n        viewModel = ViewModelProvider(this).get(LoadStateViewModel::class.java)\n\n        viewModel.loadingState.observe(this, Observer { isLoading -&gt;\n            if (isLoading) {\n                // \u663e\u793a\u52a0\u8f7d\u52a8\u753b\n            } else {\n                // \u9690\u85cf\u52a0\u8f7d\u52a8\u753b\n            }\n        })\n\n        viewModel.errorState.observe(this, Observer { error -&gt;\n            if (!error.isNullOrEmpty()) {\n                Toast.makeText(this, error, Toast.LENGTH_SHORT).show()\n            }\n        })\n\n        viewModel.loadData()\n    }\n}\n</code></pre>"},{"location":"040Jetpack/010Basic/#_36","title":"\u8bf4\u660e\uff1a","text":"<ul> <li><code>LoadStateViewModel</code> \u7ba1\u7406\u52a0\u8f7d\u72b6\u6001\u548c\u9519\u8bef\u72b6\u6001\u3002</li> <li>UI \u6839\u636e\u72b6\u6001\u66f4\u65b0\u663e\u793a\u5185\u5bb9\u3002</li> </ul>"},{"location":"040Jetpack/010Basic/#_37","title":"\u603b\u7ed3","text":"<p><code>ViewModel</code> \u7684\u4e3b\u8981\u5e94\u7528\u573a\u666f\u5305\u62ec\uff1a 1. \u4fdd\u5b58 UI \u6570\u636e\uff1a\u907f\u514d\u56e0\u914d\u7f6e\u66f4\u6539\u5bfc\u81f4\u6570\u636e\u4e22\u5931\u3002 2. \u6570\u636e\u5171\u4eab\uff1a\u5728\u591a\u4e2a Fragment \u4e4b\u95f4\u5171\u4eab\u6570\u636e\u3002 3. \u5f02\u6b65\u6570\u636e\u52a0\u8f7d\uff1a\u7ed3\u5408 <code>LiveData</code> \u548c\u534f\u7a0b\u5b9e\u73b0\u5f02\u6b65\u64cd\u4f5c\u3002 4. \u8868\u5355\u6570\u636e\u4fdd\u5b58\uff1a\u4fdd\u5b58\u7528\u6237\u8f93\u5165\u7684\u6570\u636e\u3002 5. \u72b6\u6001\u7ba1\u7406\uff1a\u7ba1\u7406\u590d\u6742\u7684 UI \u72b6\u6001\u3002</p> <p>\u901a\u8fc7\u5408\u7406\u4f7f\u7528 <code>ViewModel</code>\uff0c\u53ef\u4ee5\u663e\u8457\u63d0\u5347\u5e94\u7528\u7684\u7a33\u5b9a\u6027\u548c\u7528\u6237\u4f53\u9a8c\u3002</p>"},{"location":"040Jetpack/010Basic/#viewmodel_1","title":"ViewModel\u539f\u7406","text":"\u7b54\u6848 <p>https://juejin.cn/post/6915012483421831175</p> <p>\u5728\u8be6\u7ec6\u4ecb\u7ecdViewModel\u524d\uff0c\u5148\u6765\u770b\u4e0b\u80cc\u666f\u548c\u95ee\u9898\u70b9\u3002</p> <p>Activity\u53ef\u80fd\u4f1a\u5728\u67d0\u4e9b\u573a\u666f\uff08\u4f8b\u5982\u5c4f\u5e55\u65cb\u8f6c\uff09\u9500\u6bc1\u548c\u91cd\u65b0\u521b\u5efa\u754c\u9762\uff0c\u90a3\u4e48\u5b58\u50a8\u5728\u5176\u4e2d\u7684\u754c\u9762\u76f8\u5173\u6570\u636e\u90fd\u4f1a\u4e22\u5931\u3002\u4f8b\u5982\uff0c\u754c\u9762\u542b\u7528\u6237\u4fe1\u606f\u5217\u8868\uff0c\u56e0\u914d\u7f6e\u66f4\u6539\u800c\u91cd\u65b0\u521b\u5efa Activity \u540e\uff0c\u65b0 Activity \u5fc5\u987b\u91cd\u65b0\u8bf7\u6c42\u7528\u6237\u5217\u8868\uff0c\u8fd9\u4f1a\u9020\u6210\u8d44\u6e90\u7684\u6d6a\u8d39\u3002\u80fd\u5426\u76f4\u63a5\u6062\u590d\u4e4b\u524d\u7684\u6570\u636e\u5462\uff1f\u5bf9\u4e8e\u7b80\u5355\u7684\u6570\u636e\uff0cActivity \u53ef\u4ee5\u4f7f\u7528 onSaveInstanceState() \u65b9\u6cd5\u4fdd\u5b58 \u7136\u540e\u4ece onCreate() \u4e2d\u7684Bundle\u6062\u590d\u6570\u636e\uff0c\u4f46\u6b64\u65b9\u6cd5\u4ec5\u9002\u5408\u53ef\u4ee5\u5e8f\u5217\u5316\u518d\u53cd\u5e8f\u5217\u5316\u7684\u5c11\u91cf\u6570\u636e\uff08IPC\u5bf9Bundle\u67091M\u7684\u9650\u5236\uff09\uff0c\u800c\u4e0d\u9002\u5408\u6570\u91cf\u53ef\u80fd\u8f83\u5927\u7684\u6570\u636e\uff0c\u5982\u7528\u6237\u4fe1\u606f\u5217\u8868\u6216\u4f4d\u56fe\u3002 \u90a3\u4e48\u5982\u4f55\u505a\u5230 \u56e0\u914d\u7f6e\u66f4\u6539\u800c\u65b0\u5efaActivity\u540e\u7684\u6570\u636e\u6062\u590d\u5462\uff1f</p> <p>UI\u5c42\uff08\u5982 Activity \u548c Fragment\uff09\u7ecf\u5e38\u9700\u8981\u901a\u8fc7\u903b\u8f91\u5c42\uff08\u5982MVP\u4e2d\u7684Presenter\uff09\u8fdb\u884c\u5f02\u6b65\u8bf7\u6c42\uff0c\u53ef\u80fd\u9700\u8981\u4e00\u4e9b\u65f6\u95f4\u624d\u80fd\u8fd4\u56de\u7ed3\u679c\uff0c\u5982\u679c\u903b\u8f91\u5c42\u6301\u6709UI\u5c42\u5e94\u7528\uff08\u5982context\uff09\uff0c\u90a3\u4e48UI\u5c42\u9700\u8981\u7ba1\u7406\u8fd9\u4e9b\u8bf7\u6c42\uff0c\u786e\u4fdd\u754c\u9762\u9500\u6bc1\u540e\u6e05\u7406\u8fd9\u4e9b\u8c03\u7528\u4ee5\u907f\u514d\u6f5c\u5728\u7684\u5185\u5b58\u6cc4\u9732\uff0c\u4f46\u6b64\u9879\u7ba1\u7406\u9700\u8981\u5927\u91cf\u7684\u7ef4\u62a4\u5de5\u4f5c\u3002 \u90a3\u4e48\u5982\u4f55\u66f4\u597d\u7684\u907f\u514d\u56e0\u5f02\u6b65\u8bf7\u6c42\u5e26\u6765\u7684\u5185\u5b58\u6cc4\u6f0f\u5462\uff1f</p> <p>\u8fd9\u65f6\u5019ViewModel\u5c31\u95ea\u4eae\u51fa\u573a\u4e86\u2014\u2014ViewModel\u7528\u4e8e\u4ee3\u66ffMVP\u4e2d\u7684Presenter\uff0c\u4e3aUI\u5c42\u51c6\u5907\u6570\u636e\uff0c\u7528\u4e8e\u89e3\u51b3\u4e0a\u9762\u4e24\u4e2a\u95ee\u9898\u3002</p>"},{"location":"040Jetpack/010Basic/#android-viewmodel","title":"Android ViewModel \u6e90\u7801\u5206\u6790","text":"<p>ViewModel \u662f Android Jetpack \u67b6\u6784\u7ec4\u4ef6\u4e2d\u7684\u6838\u5fc3\u7ec4\u4ef6\u4e4b\u4e00\uff0c\u7528\u4e8e\u4ee5\u751f\u547d\u5468\u671f\u611f\u77e5\u7684\u65b9\u5f0f\u7ba1\u7406\u548c\u5b58\u50a8 UI \u76f8\u5173\u7684\u6570\u636e\u3002\u4e0b\u9762\u6211\u5c06\u4ece\u591a\u4e2a\u89d2\u5ea6\u5206\u6790 ViewModel \u7684\u6e90\u7801\u5b9e\u73b0\u3002</p>"},{"location":"040Jetpack/010Basic/#1-viewmodel","title":"1. ViewModel \u57fa\u672c\u7ed3\u6784","text":"<p>ViewModel \u662f\u4e00\u4e2a\u62bd\u8c61\u7c7b\uff0c\u4f4d\u4e8e <code>androidx.lifecycle.ViewModel</code> \u5305\u4e2d\uff1a</p> <pre><code>public abstract class ViewModel {\n    // \u5b58\u50a8\u6e05\u7406\u65f6\u9700\u8981\u91ca\u653e\u7684\u8d44\u6e90\n    private final Map&lt;String, Object&gt; mBagOfTags = new HashMap&lt;&gt;();\n    private volatile boolean mCleared = false;\n\n    // \u5f53 ViewModel \u4e0d\u518d\u4f7f\u7528\u65f6\u8c03\u7528\n    protected void onCleared() {\n    }\n\n    // \u6807\u8bb0\u4e3a\u5df2\u6e05\u7406\u5e76\u89e6\u53d1 onCleared()\n    final void clear() {\n        mCleared = true;\n        if (mBagOfTags != null) {\n            synchronized (mBagOfTags) {\n                for (Object value : mBagOfTags.values()) {\n                    closeWithRuntimeException(value);\n                }\n            }\n        }\n        onCleared();\n    }\n\n    // \u5176\u4ed6\u8f85\u52a9\u65b9\u6cd5...\n}\n</code></pre>"},{"location":"040Jetpack/010Basic/#2-viewmodel","title":"2. ViewModel \u7684\u521b\u5efa\u673a\u5236","text":"<p>ViewModel \u901a\u5e38\u901a\u8fc7 <code>ViewModelProvider</code> \u521b\u5efa\uff1a</p> <pre><code>public class ViewModelProvider {\n    private final Factory mFactory;\n    private final ViewModelStore mViewModelStore;\n\n    public ViewModelProvider(@NonNull ViewModelStoreOwner owner) {\n        this(owner.getViewModelStore(), owner instanceof HasDefaultViewModelProviderFactory\n                ? ((HasDefaultViewModelProviderFactory) owner).getDefaultViewModelProviderFactory()\n                : NewInstanceFactory.getInstance());\n    }\n\n    public &lt;T extends ViewModel&gt; T get(@NonNull Class&lt;T&gt; modelClass) {\n        String canonicalName = modelClass.getCanonicalName();\n        String key = \"androidx.lifecycle.ViewModelProvider.DefaultKey:\" + canonicalName;\n        return get(key, modelClass);\n    }\n\n    public &lt;T extends ViewModel&gt; T get(@NonNull String key, @NonNull Class&lt;T&gt; modelClass) {\n        ViewModel viewModel = mViewModelStore.get(key);\n\n        if (modelClass.isInstance(viewModel)) {\n            return (T) viewModel;\n        } else {\n            // \u521b\u5efa\u65b0\u7684 ViewModel \u5b9e\u4f8b\n            viewModel = mFactory.create(modelClass);\n            mViewModelStore.put(key, viewModel);\n            return (T) viewModel;\n        }\n    }\n}\n</code></pre>"},{"location":"040Jetpack/010Basic/#3-viewmodelstore","title":"3. ViewModelStore \u5b9e\u73b0","text":"<p><code>ViewModelStore</code> \u8d1f\u8d23\u5b58\u50a8\u548c\u7ba1\u7406 ViewModel \u5b9e\u4f8b\uff1a</p> <pre><code>public class ViewModelStore {\n    private final HashMap&lt;String, ViewModel&gt; mMap = new HashMap&lt;&gt;();\n\n    final void put(String key, ViewModel viewModel) {\n        ViewModel oldViewModel = mMap.put(key, viewModel);\n        if (oldViewModel != null) {\n            oldViewModel.onCleared();\n        }\n    }\n\n    final ViewModel get(String key) {\n        return mMap.get(key);\n    }\n\n    public final void clear() {\n        for (ViewModel vm : mMap.values()) {\n            vm.clear();\n        }\n        mMap.clear();\n    }\n}\n</code></pre>"},{"location":"040Jetpack/010Basic/#4_4","title":"4. \u751f\u547d\u5468\u671f\u96c6\u6210","text":"<p>ViewModel \u4e0e\u751f\u547d\u5468\u671f\u7684\u96c6\u6210\u4e3b\u8981\u901a\u8fc7 <code>ComponentActivity</code> \u548c <code>Fragment</code> \u5b9e\u73b0\uff1a</p> <pre><code>// ComponentActivity \u4e2d\u7684\u76f8\u5173\u5b9e\u73b0\npublic class ComponentActivity extends androidx.core.app.ComponentActivity implements\n        ViewModelStoreOwner,\n        HasDefaultViewModelProviderFactory {\n\n    private ViewModelStore mViewModelStore;\n    private ViewModelProvider.Factory mDefaultFactory;\n\n    public ViewModelStore getViewModelStore() {\n        if (mViewModelStore == null) {\n            NonConfigurationInstances nc =\n                    (NonConfigurationInstances) getLastNonConfigurationInstance();\n            if (nc != null) {\n                mViewModelStore = nc.viewModelStore;\n            }\n            if (mViewModelStore == null) {\n                mViewModelStore = new ViewModelStore();\n            }\n        }\n        return mViewModelStore;\n    }\n\n    // \u5728\u914d\u7f6e\u66f4\u6539\u65f6\u4fdd\u5b58 ViewModelStore\n    public final Object onRetainNonConfigurationInstance() {\n        Object custom = onRetainCustomNonConfigurationInstance();\n        ViewModelStore viewModelStore = mViewModelStore;\n\n        if (viewModelStore == null &amp;&amp; custom == null) {\n            return null;\n        }\n\n        NonConfigurationInstances nci = new NonConfigurationInstances();\n        nci.custom = custom;\n        nci.viewModelStore = viewModelStore;\n        return nci;\n    }\n\n    // \u5728 Activity \u9500\u6bc1\u65f6\u6e05\u7406\n    protected void onDestroy() {\n        super.onDestroy();\n        if (mViewModelStore != null &amp;&amp; !isChangingConfigurations()) {\n            mViewModelStore.clear();\n        }\n    }\n}\n</code></pre>"},{"location":"040Jetpack/010Basic/#5-viewmodel","title":"5. ViewModel \u7684\u4fdd\u7559\u673a\u5236","text":"<p>ViewModel \u7684\u6838\u5fc3\u7279\u6027\u662f\u5728\u914d\u7f6e\u66f4\u6539(\u5982\u5c4f\u5e55\u65cb\u8f6c)\u65f6\u4fdd\u7559\u6570\u636e\uff0c\u8fd9\u662f\u901a\u8fc7\u4ee5\u4e0b\u673a\u5236\u5b9e\u73b0\u7684\uff1a</p> <ol> <li>Activity \u88ab\u9500\u6bc1\u91cd\u5efa\u65f6\uff0c\u7cfb\u7edf\u4f1a\u8c03\u7528 <code>onRetainNonConfigurationInstance()</code> \u4fdd\u5b58 ViewModelStore</li> <li>\u65b0\u7684 Activity \u5b9e\u4f8b\u901a\u8fc7 <code>getLastNonConfigurationInstance()</code> \u83b7\u53d6\u4e4b\u524d\u7684 ViewModelStore</li> <li>\u5982\u679c Activity \u662f\u6b63\u5e38\u7ed3\u675f(\u975e\u914d\u7f6e\u66f4\u6539)\uff0c\u5219\u6e05\u9664\u6240\u6709 ViewModel</li> </ol>"},{"location":"040Jetpack/010Basic/#6-viewmodel","title":"6. ViewModel \u7684\u6269\u5c55\u529f\u80fd","text":""},{"location":"040Jetpack/010Basic/#savedstatehandle","title":"SavedStateHandle","text":"<p>ViewModel \u53ef\u4ee5\u4e0e SavedStateHandle \u7ed3\u5408\u4f7f\u7528\uff0c\u5b9e\u73b0\u8fdb\u7a0b\u6b7b\u4ea1\u6062\u590d\uff1a</p> <pre><code>public class SavedStateViewModelFactory extends ViewModelProvider.KeyedFactory {\n    public &lt;T extends ViewModel&gt; T create(String key, Class&lt;T&gt; modelClass) {\n        SavedStateHandleController controller = SavedStateHandleController.create(\n            mSavedStateRegistry, mLifecycle, key, mDefaultArgs);\n\n        if (modelClass.isAssignableFrom(SavedStateViewModel.class)) {\n            return modelClass.getConstructor(SavedStateHandle.class)\n                .newInstance(controller.getHandle());\n        }\n        // \u5176\u4ed6 ViewModel \u521b\u5efa\u903b\u8f91\n    }\n}\n</code></pre>"},{"location":"040Jetpack/010Basic/#viewmodel_2","title":"ViewModel \u4f5c\u7528\u57df","text":"<p>ViewModel \u53ef\u4ee5\u9650\u5b9a\u5728 Activity\u3001Fragment \u6216 Navigation \u56fe\u7684\u4f5c\u7528\u57df\u5185\uff1a</p> <pre><code>// \u5728 Fragment \u4e2d\u83b7\u53d6 Activity \u7ea7\u522b\u7684 ViewModel\nViewModelProvider(requireActivity()).get(SharedViewModel::class.java)\n\n// \u5728 Navigation \u56fe\u4e2d\u83b7\u53d6\u4f5c\u7528\u57df ViewModel\nViewModelProvider(navController.getViewModelStoreOwner(R.id.nav_graph))\n    .get(GraphViewModel::class.java)\n</code></pre>"},{"location":"040Jetpack/010Basic/#7","title":"7. \u5173\u952e\u8bbe\u8ba1\u8981\u70b9","text":"<ol> <li>\u751f\u547d\u5468\u671f\u611f\u77e5\uff1aViewModel \u81ea\u52a8\u611f\u77e5 Activity/Fragment \u7684\u751f\u547d\u5468\u671f</li> <li>\u914d\u7f6e\u66f4\u6539\u4fdd\u7559\uff1a\u901a\u8fc7\u4fdd\u5b58 ViewModelStore \u5b9e\u73b0</li> <li>\u8d44\u6e90\u6e05\u7406\uff1a\u63d0\u4f9b onCleared() \u56de\u8c03\u7528\u4e8e\u8d44\u6e90\u91ca\u653e</li> <li>\u4f5c\u7528\u57df\u7ba1\u7406\uff1a\u652f\u6301\u4e0d\u540c\u5c42\u6b21\u7684\u5171\u4eab\u4f5c\u7528\u57df</li> <li>\u6d4b\u8bd5\u53cb\u597d\uff1a\u4e0d\u6301\u6709 UI \u5f15\u7528\uff0c\u4fbf\u4e8e\u5355\u5143\u6d4b\u8bd5</li> </ol>"},{"location":"040Jetpack/010Basic/#_38","title":"\u603b\u7ed3","text":"<p>ViewModel \u7684\u6e90\u7801\u5b9e\u73b0\u5c55\u793a\u4e86 Android \u67b6\u6784\u7ec4\u4ef6\u5982\u4f55\u4f18\u96c5\u5730\u89e3\u51b3 UI \u6570\u636e\u6301\u4e45\u5316\u548c\u751f\u547d\u5468\u671f\u7ba1\u7406\u95ee\u9898\u3002\u5176\u6838\u5fc3\u5728\u4e8e ViewModelStore \u7684\u4fdd\u7559\u673a\u5236\u548c\u4e0e\u751f\u547d\u5468\u671f\u7ec4\u4ef6\u7684\u6df1\u5ea6\u96c6\u6210\uff0c\u4f7f\u5f97\u5f00\u53d1\u8005\u53ef\u4ee5\u4e13\u6ce8\u4e8e\u4e1a\u52a1\u903b\u8f91\u800c\u4e0d\u7528\u62c5\u5fc3\u914d\u7f6e\u66f4\u6539\u5bfc\u81f4\u7684\u6570\u636e\u4e22\u5931\u95ee\u9898\u3002</p> <p>ViewModel \u672c\u8eab\u5e76\u4e0d\u76f4\u63a5\u611f\u77e5 Activity/Fragment \u7684\u751f\u547d\u5468\u671f\uff0c\u800c\u662f\u901a\u8fc7 \u95f4\u63a5\u5173\u8054 \u7684\u65b9\u5f0f\u5b9e\u73b0\u751f\u547d\u5468\u671f\u611f\u77e5\u3002\u8ba9\u6211\u8be6\u7ec6\u89e3\u91ca\u8fd9\u4e2a\u673a\u5236\uff1a</p>"},{"location":"040Jetpack/010Basic/#viewmodel_3","title":"ViewModel \u751f\u547d\u5468\u671f\u611f\u77e5\u7684\u6838\u5fc3\u673a\u5236","text":""},{"location":"040Jetpack/010Basic/#1_2","title":"1. \u95f4\u63a5\u611f\u77e5\uff08\u975e\u76f4\u63a5\u76d1\u542c\uff09","text":"<p>ViewModel \u5e76\u4e0d\u76f4\u63a5 \u76d1\u542c Activity/Fragment \u7684\u751f\u547d\u5468\u671f\uff0c\u800c\u662f\u901a\u8fc7\u4ee5\u4e0b\u95f4\u63a5\u65b9\u5f0f\u5173\u8054\uff1a</p> <ul> <li><code>ViewModelStore</code> \u7531 <code>ViewModelStoreOwner</code>\uff08\u5982 Activity/Fragment\uff09\u6301\u6709</li> <li><code>ViewModelStore</code> \u7684\u6e05\u7406\u7531\u5bbf\u4e3b\uff08Activity/Fragment\uff09\u89e6\u53d1</li> </ul>"},{"location":"040Jetpack/010Basic/#2_3","title":"2. \u5173\u952e\u53c2\u4e0e\u7ec4\u4ef6","text":"\u7ec4\u4ef6 \u89d2\u8272 <code>ViewModelStoreOwner</code> \u63a5\u53e3\uff08\u5982 Activity/Fragment \u5b9e\u73b0\uff09\uff0c\u63d0\u4f9b <code>ViewModelStore</code> <code>ViewModelStore</code> \u5b58\u50a8 ViewModel \u7684\u5bb9\u5668 <code>ComponentActivity</code> \u5728 <code>onDestroy()</code> \u4e2d\u51b3\u5b9a\u662f\u5426\u6e05\u7406 <code>ViewModelStore</code>"},{"location":"040Jetpack/010Basic/#_39","title":"\u5177\u4f53\u5b9e\u73b0\u6d41\u7a0b","text":""},{"location":"040Jetpack/010Basic/#1activityfragment-viewmodelstoreowner","title":"\u6b65\u9aa4 1\uff1aActivity/Fragment \u5b9e\u73b0 <code>ViewModelStoreOwner</code>","text":"<pre><code>// ComponentActivity \u7684\u5b9e\u73b0\npublic class ComponentActivity extends Activity implements ViewModelStoreOwner {\n    private ViewModelStore mViewModelStore;\n\n    @Override\n    public ViewModelStore getViewModelStore() {\n        if (mViewModelStore == null) {\n            mViewModelStore = new ViewModelStore();\n        }\n        return mViewModelStore;\n    }\n}\n</code></pre>"},{"location":"040Jetpack/010Basic/#2_4","title":"\u6b65\u9aa4 2\uff1a\u5728\u9500\u6bc1\u65f6\u5224\u65ad\u662f\u5426\u9700\u8981\u6e05\u7406","text":"<pre><code>// ComponentActivity.java\nprotected void onDestroy() {\n    super.onDestroy();\n\n    // \u5173\u952e\u5224\u65ad\uff1a\u53ea\u6709\u975e\u914d\u7f6e\u66f4\u6539\u7684\u9500\u6bc1\u624d\u4f1a\u6e05\u7406 ViewModelStore\n    if (!isChangingConfigurations()) { \n        if (mViewModelStore != null) {\n            mViewModelStore.clear(); // \u89e6\u53d1\u6240\u6709 ViewModel \u7684 onCleared()\n        }\n    }\n}\n</code></pre>"},{"location":"040Jetpack/010Basic/#3-viewmodelstore_1","title":"\u6b65\u9aa4 3\uff1a\u914d\u7f6e\u66f4\u6539\u65f6\u4fdd\u7559 ViewModelStore","text":"<pre><code>// ComponentActivity.java\npublic final Object onRetainNonConfigurationInstance() {\n    // \u4fdd\u5b58 ViewModelStore \u5230 NonConfigurationInstances\n    NonConfigurationInstances nci = new NonConfigurationInstances();\n    nci.viewModelStore = mViewModelStore;\n    return nci; // \u7cfb\u7edf\u4f1a\u4e34\u65f6\u4fdd\u7559\u8fd9\u4e2a\u5bf9\u8c61\n}\n\n// \u65b0\u7684 Activity \u5b9e\u4f8b\u901a\u8fc7\u6b64\u65b9\u6cd5\u6062\u590d\nViewModelStore getViewModelStore() {\n    if (mViewModelStore == null) {\n        NonConfigurationInstances nc = getLastNonConfigurationInstance();\n        if (nc != null) {\n            mViewModelStore = nc.viewModelStore; // \u6062\u590d\u4e4b\u524d\u7684 ViewModelStore\n        }\n        // ...\u521d\u59cb\u5316\u903b\u8f91\n    }\n    return mViewModelStore;\n}\n</code></pre>"},{"location":"040Jetpack/010Basic/#_40","title":"\u4e3a\u4ec0\u4e48\u8bf4\u8fd9\u662f\"\u751f\u547d\u5468\u671f\u611f\u77e5\"\uff1f","text":"<ol> <li> <p>\u81ea\u52a8\u6e05\u7406\u65f6\u673a Activity/Fragment \u901a\u8fc7\u81ea\u8eab\u7684 <code>onDestroy()</code> \u56de\u8c03\uff0c\u5728\u975e\u914d\u7f6e\u66f4\u6539\u7684\u573a\u666f\u4e0b\u81ea\u52a8\u89e6\u53d1 <code>ViewModelStore.clear()</code>\u3002</p> </li> <li> <p>\u914d\u7f6e\u66f4\u6539\u8c41\u514d \u901a\u8fc7 <code>isChangingConfigurations()</code> \u5224\u65ad\uff0c\u53ea\u6709\u771f\u6b63\u7684\u9500\u6bc1\uff08\u5982\u7528\u6237\u6309\u8fd4\u56de\u952e\uff09\u624d\u4f1a\u6e05\u7406 ViewModel\u3002</p> </li> <li> <p>\u65e0\u9700\u624b\u52a8\u76d1\u542c ViewModel \u7684\u4f7f\u7528\u8005\u4e0d\u9700\u8981\u81ea\u5df1\u5904\u7406\u751f\u547d\u5468\u671f\u56de\u8c03\uff0c\u6240\u6709\u6e05\u7406\u903b\u8f91\u7531\u7cfb\u7edf\u81ea\u52a8\u5b8c\u6210\u3002</p> </li> </ol>"},{"location":"040Jetpack/010Basic/#_41","title":"\u7c7b\u6bd4\u7406\u89e3","text":"<p>\u53ef\u4ee5\u628a\u8fd9\u79cd\u8bbe\u8ba1\u770b\u4f5c\u4e00\u79cd\"\u88ab\u52a8\u611f\u77e5\"\uff1a - Activity/Fragment \u662f\u751f\u547d\u5468\u671f\u7684\"\u4e3b\u52a8\u611f\u77e5\u8005\"\uff08\u5b83\u4eec\u76f4\u63a5\u63a5\u6536\u751f\u547d\u5468\u671f\u56de\u8c03\uff09 - ViewModel \u662f\"\u88ab\u52a8\u54cd\u5e94\u8005\"\uff08\u901a\u8fc7\u5bbf\u4e3b\u7684\u6307\u4ee4\u51b3\u5b9a\u662f\u5426\u6e05\u7406\uff09</p> <p>\u8fd9\u79cd\u95f4\u63a5\u5173\u8054\u7684\u8bbe\u8ba1\u907f\u514d\u4e86 ViewModel \u76f4\u63a5\u6301\u6709\u751f\u547d\u5468\u671f\u5bf9\u8c61\uff0c\u4ece\u800c\u9632\u6b62\u5185\u5b58\u6cc4\u6f0f\u3002</p>"},{"location":"040Jetpack/010Basic/#_42","title":"\u603b\u7ed3\u56de\u7b54","text":"<p>ViewModel \u4e0d\u76f4\u63a5\u611f\u77e5\u751f\u547d\u5468\u671f\uff0c\u800c\u662f\uff1a 1. \u7531\u5bbf\u4e3b\uff08Activity/Fragment\uff09\u5728 <code>onDestroy()</code> \u4e2d\u6839\u636e <code>isChangingConfigurations()</code> \u51b3\u5b9a\u662f\u5426\u6e05\u7406 ViewModelStore 2. \u901a\u8fc7 <code>ViewModelStoreOwner</code> \u63a5\u53e3\u5b9e\u73b0\u5bbf\u4e3b\u4e0e ViewModel \u7684\u5173\u8054 3. \u914d\u7f6e\u66f4\u6539\u65f6\u901a\u8fc7 <code>onRetainNonConfigurationInstance()</code> \u4fdd\u7559 ViewModelStore</p> <p>\u8fd9\u79cd\u8bbe\u8ba1\u5b9e\u73b0\u4e86\u751f\u547d\u5468\u671f\u611f\u77e5\u7684\u6548\u679c\uff0c\u540c\u65f6\u4fdd\u8bc1\u4e86\u67b6\u6784\u7684\u677e\u8026\u5408\u3002</p>"},{"location":"040Jetpack/010Basic/#viewmodel_4","title":"\u5173\u4e8eViewModel\u662f\u5982\u4f55\u5728\u91cd\u5efa\u7684\u65f6\u5019\u4fdd\u5b58\u6570\u636e\u7684\uff1f","text":"\u7b54\u6848 <p>\u5728Android\u5f00\u53d1\u4e2d\uff0c<code>ViewModel</code> \u662f\u7528\u4e8e\u7ba1\u7406\u4e0eUI\u76f8\u5173\u7684\u6570\u636e\uff0c\u5e76\u5728\u914d\u7f6e\u66f4\u6539\uff08\u5982\u5c4f\u5e55\u65cb\u8f6c\uff09\u65f6\u4fdd\u6301\u6570\u636e\u6301\u4e45\u6027\u7684\u7ec4\u4ef6\u3002\u4e3a\u4e86\u7406\u89e3 <code>ViewModel</code> \u5982\u4f55\u5728Activity\u91cd\u5efa\u65f6\u4fdd\u5b58\u6570\u636e\uff0c\u6211\u4eec\u9700\u8981\u4ece\u6e90\u7801\u7684\u89d2\u5ea6\u5206\u6790\u5176\u5b9e\u73b0\u673a\u5236\u3002</p>"},{"location":"040Jetpack/010Basic/#1-viewmodel_1","title":"1. ViewModel \u7684\u751f\u547d\u5468\u671f","text":"<p><code>ViewModel</code> \u7684\u751f\u547d\u5468\u671f\u6bd4Activity\u6216Fragment\u66f4\u957f\u3002\u5f53Activity\u56e0\u914d\u7f6e\u66f4\u6539\uff08\u5982\u5c4f\u5e55\u65cb\u8f6c\uff09\u800c\u91cd\u5efa\u65f6\uff0c<code>ViewModel</code> \u4e0d\u4f1a\u88ab\u9500\u6bc1\uff0c\u800c\u662f\u7ee7\u7eed\u5b58\u5728\uff0c\u76f4\u5230Activity\u771f\u6b63\u88ab\u9500\u6bc1\uff08\u5373\u7528\u6237\u9000\u51faActivity\u6216\u7cfb\u7edf\u56de\u6536\u8d44\u6e90\uff09\u3002</p>"},{"location":"040Jetpack/010Basic/#2-viewmodel_1","title":"2. ViewModel \u7684\u5b58\u50a8\u548c\u7ba1\u7406","text":"<p><code>ViewModel</code> \u7684\u5b58\u50a8\u548c\u7ba1\u7406\u662f\u901a\u8fc7 <code>ViewModelStore</code> \u548c <code>ViewModelProvider</code> \u5b9e\u73b0\u7684\u3002</p>"},{"location":"040Jetpack/010Basic/#21-viewmodelstore","title":"2.1 ViewModelStore","text":"<p><code>ViewModelStore</code> \u662f\u4e00\u4e2a\u7b80\u5355\u7684\u7c7b\uff0c\u7528\u4e8e\u5b58\u50a8 <code>ViewModel</code> \u5b9e\u4f8b\u3002\u5b83\u5185\u90e8\u4f7f\u7528\u4e00\u4e2a <code>HashMap</code> \u6765\u4fdd\u5b58 <code>ViewModel</code>\uff0c\u952e\u662f <code>ViewModel</code> \u7684\u7c7b\u540d\uff0c\u503c\u662f <code>ViewModel</code> \u5b9e\u4f8b\u3002</p> <pre><code>public class ViewModelStore {\n    private final HashMap&lt;String, ViewModel&gt; mMap = new HashMap&lt;&gt;();\n\n    final void put(String key, ViewModel viewModel) {\n        ViewModel oldViewModel = mMap.put(key, viewModel);\n        if (oldViewModel != null) {\n            oldViewModel.onCleared();\n        }\n    }\n\n    final ViewModel get(String key) {\n        return mMap.get(key);\n    }\n\n    Set&lt;String&gt; keys() {\n        return new HashSet&lt;&gt;(mMap.keySet());\n    }\n\n    public final void clear() {\n        for (ViewModel vm : mMap.values()) {\n            vm.onCleared();\n        }\n        mMap.clear();\n    }\n}\n</code></pre>"},{"location":"040Jetpack/010Basic/#22-viewmodelprovider","title":"2.2 ViewModelProvider","text":"<p><code>ViewModelProvider</code> \u662f\u7528\u4e8e\u521b\u5efa\u548c\u83b7\u53d6 <code>ViewModel</code> \u7684\u5de5\u5177\u7c7b\u3002\u5b83\u901a\u8fc7 <code>ViewModelStore</code> \u6765\u7ba1\u7406 <code>ViewModel</code> \u7684\u751f\u547d\u5468\u671f\u3002</p> <pre><code>public class ViewModelProvider {\n    private final ViewModelStore mViewModelStore;\n    private final Factory mFactory;\n\n    public ViewModelProvider(@NonNull ViewModelStore store, @NonNull Factory factory) {\n        mFactory = factory;\n        mViewModelStore = store;\n    }\n\n    public &lt;T extends ViewModel&gt; T get(@NonNull Class&lt;T&gt; modelClass) {\n        String canonicalName = modelClass.getCanonicalName();\n        if (canonicalName == null) {\n            throw new IllegalArgumentException(\"Local and anonymous classes can not be ViewModels\");\n        }\n        return get(DEFAULT_KEY + \":\" + canonicalName, modelClass);\n    }\n\n    public &lt;T extends ViewModel&gt; T get(@NonNull String key, @NonNull Class&lt;T&gt; modelClass) {\n        ViewModel viewModel = mViewModelStore.get(key);\n\n        if (modelClass.isInstance(viewModel)) {\n            return (T) viewModel;\n        } else {\n            //noinspection StatementWithEmptyBody\n            if (viewModel != null) {\n                // TODO: log a warning.\n            }\n        }\n\n        viewModel = mFactory.create(modelClass);\n        mViewModelStore.put(key, viewModel);\n        return (T) viewModel;\n    }\n}\n</code></pre>"},{"location":"040Jetpack/010Basic/#3-viewmodel","title":"3. ViewModel \u7684\u6301\u4e45\u5316","text":"<p>\u5f53Activity\u56e0\u914d\u7f6e\u66f4\u6539\u800c\u91cd\u5efa\u65f6\uff0c<code>ViewModel</code> \u5e76\u4e0d\u4f1a\u88ab\u9500\u6bc1\u3002\u8fd9\u662f\u56e0\u4e3a <code>ViewModelStore</code> \u88ab\u4fdd\u5b58\u5728 <code>NonConfigurationInstances</code> \u4e2d\uff0c<code>NonConfigurationInstances</code> \u662f\u4e00\u4e2a\u5728Activity\u91cd\u5efa\u65f6\u4e0d\u4f1a\u88ab\u9500\u6bc1\u7684\u5bf9\u8c61\u3002</p>"},{"location":"040Jetpack/010Basic/#31-nonconfigurationinstances","title":"3.1 NonConfigurationInstances","text":"<p><code>NonConfigurationInstances</code> \u662f\u4e00\u4e2a\u9759\u6001\u5185\u90e8\u7c7b\uff0c\u7528\u4e8e\u4fdd\u5b58\u4e0eActivity\u65e0\u5173\u7684\u5bf9\u8c61\u3002<code>ViewModelStore</code> \u5c31\u662f\u901a\u8fc7\u8fd9\u4e2a\u673a\u5236\u5728Activity\u91cd\u5efa\u65f6\u5f97\u4ee5\u4fdd\u7559\u3002</p> <pre><code>static final class NonConfigurationInstances {\n    Object activity;\n    HashMap&lt;String, Object&gt; children;\n    FragmentManagerNonConfig fragments;\n    ViewModelStore viewModelStore;\n}\n</code></pre>"},{"location":"040Jetpack/010Basic/#32-activity-retainnonconfigurationinstances","title":"3.2 Activity \u7684 retainNonConfigurationInstances","text":"<p>\u5728Activity\u91cd\u5efa\u65f6\uff0c\u7cfb\u7edf\u4f1a\u8c03\u7528 <code>retainNonConfigurationInstances()</code> \u65b9\u6cd5\uff0c\u5c06 <code>ViewModelStore</code> \u4fdd\u5b58\u5728 <code>NonConfigurationInstances</code> \u4e2d\u3002</p> <pre><code>public final Object retainNonConfigurationInstances() {\n    Object activity = onRetainNonConfigurationInstance();\n    HashMap&lt;String, Object&gt; children = onRetainNonConfigurationChildInstances();\n    FragmentManagerNonConfig fragments = mFragments.retainNestedNonConfig();\n\n    if (activity == null &amp;&amp; children == null &amp;&amp; fragments == null &amp;&amp; viewModelStore == null) {\n        return null;\n    }\n\n    NonConfigurationInstances nci = new NonConfigurationInstances();\n    nci.activity = activity;\n    nci.children = children;\n    nci.fragments = fragments;\n    nci.viewModelStore = viewModelStore;\n    return nci;\n}\n</code></pre>"},{"location":"040Jetpack/010Basic/#33-activity-attach","title":"3.3 Activity \u7684 attach","text":"<p>\u5728Activity\u91cd\u5efa\u540e\uff0c\u7cfb\u7edf\u4f1a\u8c03\u7528 <code>attach()</code> \u65b9\u6cd5\uff0c\u5c06\u4e4b\u524d\u4fdd\u5b58\u7684 <code>NonConfigurationInstances</code> \u91cd\u65b0\u9644\u52a0\u5230\u65b0\u7684Activity\u5b9e\u4f8b\u4e2d\u3002</p> <pre><code>final void attach(Context context, ActivityThread aThread,\n        Instrumentation instr, IBinder token, int ident,\n        Application application, Intent intent, ActivityInfo info,\n        CharSequence title, Activity parent, String id,\n        NonConfigurationInstances lastNonConfigurationInstances,\n        Configuration config, String referrer, IVoiceInteractor voiceInteractor,\n        Window window, ActivityConfigCallback activityConfigCallback) {\n    ...\n    mLastNonConfigurationInstances = lastNonConfigurationInstances;\n    if (mLastNonConfigurationInstances != null) {\n        mViewModelStore = mLastNonConfigurationInstances.viewModelStore;\n    }\n    ...\n}\n</code></pre>"},{"location":"040Jetpack/010Basic/#4_5","title":"4. \u603b\u7ed3","text":"<p>\u901a\u8fc7 <code>ViewModelStore</code> \u548c <code>NonConfigurationInstances</code> \u673a\u5236\uff0c<code>ViewModel</code> \u5728Activity\u91cd\u5efa\u65f6\u5f97\u4ee5\u4fdd\u7559\u3002\u5177\u4f53\u6b65\u9aa4\u5982\u4e0b\uff1a 1. <code>ViewModelStore</code> \u7528\u4e8e\u5b58\u50a8 <code>ViewModel</code> \u5b9e\u4f8b\u3002 2. \u5f53Activity\u56e0\u914d\u7f6e\u66f4\u6539\u800c\u91cd\u5efa\u65f6\uff0c<code>ViewModelStore</code> \u88ab\u4fdd\u5b58\u5728 <code>NonConfigurationInstances</code> \u4e2d\u3002 3. \u5728Activity\u91cd\u5efa\u540e\uff0c<code>ViewModelStore</code> \u4ece <code>NonConfigurationInstances</code> \u4e2d\u6062\u590d\uff0c<code>ViewModel</code> \u5b9e\u4f8b\u5f97\u4ee5\u4fdd\u7559\u3002</p> <p>\u8fd9\u79cd\u673a\u5236\u786e\u4fdd\u4e86 <code>ViewModel</code> \u5728Activity\u91cd\u5efa\u65f6\u4e0d\u4f1a\u4e22\u5931\u6570\u636e\uff0c\u4ece\u800c\u63d0\u9ad8\u4e86\u5e94\u7528\u7684\u7a33\u5b9a\u6027\u548c\u7528\u6237\u4f53\u9a8c\u3002</p>"},{"location":"040Jetpack/010Basic/#_43","title":"\u591a\u4e2a\u6570\u636e\u6e90\u7684\u65f6\u5019\uff0c\u5982\u4f55\u7ec4\u7ec7\u548c\u7ba1\u7406\uff1f","text":"\u7b54\u6848 <p>\u5f53\u4e00\u4e2a Activity \u7684 UI \u5c55\u793a\u9700\u8981\u4f9d\u8d56\u591a\u4e2a\u6570\u636e\u6e90\u65f6\uff0c\u901a\u5e38\u9700\u8981\u4ece\u591a\u4e2a API \u83b7\u53d6\u6570\u636e\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u5982\u4f55\u7ec4\u7ec7\u548c\u7ba1\u7406\u8fd9\u4e9b\u6570\u636e\u662f\u4e00\u4e2a\u5173\u952e\u95ee\u9898\u3002\u4ee5\u4e0b\u662f\u51e0\u79cd\u5e38\u89c1\u7684\u89e3\u51b3\u65b9\u6848\uff0c\u4ee5\u53ca\u5b83\u4eec\u7684\u4f18\u7f3a\u70b9\uff1a</p>"},{"location":"040Jetpack/010Basic/#1-livedata_1","title":"1. \u4f7f\u7528\u591a\u4e2a LiveData","text":"<p>\u6bcf\u4e2a\u6570\u636e\u6e90\u53ef\u4ee5\u5bf9\u5e94\u4e00\u4e2a <code>LiveData</code>\uff0c\u5e76\u5728 ViewModel \u4e2d\u7ba1\u7406\u8fd9\u4e9b <code>LiveData</code>\u3002</p>"},{"location":"040Jetpack/010Basic/#_44","title":"\u5b9e\u73b0\u65b9\u5f0f\uff1a","text":"<ul> <li>\u5728 ViewModel \u4e2d\u4e3a\u6bcf\u4e2a\u6570\u636e\u6e90\u5b9a\u4e49\u4e00\u4e2a <code>MutableLiveData</code>\u3002</li> <li>\u5728 Activity \u6216 Fragment \u4e2d\u89c2\u5bdf\u8fd9\u4e9b <code>LiveData</code>\uff0c\u5e76\u5728\u6570\u636e\u53d8\u5316\u65f6\u66f4\u65b0 UI\u3002</li> </ul>"},{"location":"040Jetpack/010Basic/#_45","title":"\u793a\u4f8b\u4ee3\u7801\uff1a","text":"<pre><code>public class MyViewModel extends ViewModel {\n    private MutableLiveData&lt;String&gt; data1 = new MutableLiveData&lt;&gt;();\n    private MutableLiveData&lt;Integer&gt; data2 = new MutableLiveData&lt;&gt;();\n\n    public LiveData&lt;String&gt; getData1() {\n        return data1;\n    }\n\n    public LiveData&lt;Integer&gt; getData2() {\n        return data2;\n    }\n\n    public void fetchData1() {\n        // \u6a21\u62df\u4ece API \u83b7\u53d6\u6570\u636e\n        data1.setValue(\"Data from API 1\");\n    }\n\n    public void fetchData2() {\n        // \u6a21\u62df\u4ece API \u83b7\u53d6\u6570\u636e\n        data2.setValue(100);\n    }\n}\n\n// \u5728 Activity \u4e2d\u89c2\u5bdf LiveData\nMyViewModel viewModel = new ViewModelProvider(this).get(MyViewModel.class);\nviewModel.getData1().observe(this, data -&gt; {\n    // \u66f4\u65b0 UI\n    textView1.setText(data);\n});\nviewModel.getData2().observe(this, data -&gt; {\n    // \u66f4\u65b0 UI\n    textView2.setText(String.valueOf(data));\n});\n\n// \u89e6\u53d1\u6570\u636e\u52a0\u8f7d\nviewModel.fetchData1();\nviewModel.fetchData2();\n</code></pre>"},{"location":"040Jetpack/010Basic/#_46","title":"\u4f18\u70b9\uff1a","text":"<ul> <li>\u7b80\u5355\u76f4\u89c2\uff0c\u6bcf\u4e2a\u6570\u636e\u6e90\u72ec\u7acb\u7ba1\u7406\u3002</li> <li>\u9002\u5408\u6570\u636e\u6e90\u4e4b\u95f4\u6ca1\u6709\u4f9d\u8d56\u5173\u7cfb\u7684\u573a\u666f\u3002</li> </ul>"},{"location":"040Jetpack/010Basic/#_47","title":"\u7f3a\u70b9\uff1a","text":"<ul> <li>\u5982\u679c\u6570\u636e\u6e90\u4e4b\u95f4\u6709\u4f9d\u8d56\u5173\u7cfb\uff08\u4f8b\u5982\u4e00\u4e2a API \u7684\u8bf7\u6c42\u7ed3\u679c\u9700\u8981\u4f5c\u4e3a\u53e6\u4e00\u4e2a API \u7684\u53c2\u6570\uff09\uff0c\u4ee3\u7801\u4f1a\u53d8\u5f97\u590d\u6742\u3002</li> <li>\u9700\u8981\u624b\u52a8\u7ba1\u7406\u591a\u4e2a <code>LiveData</code> \u7684\u72b6\u6001\u3002</li> </ul>"},{"location":"040Jetpack/010Basic/#2-mediatorlivedata","title":"2. \u4f7f\u7528 MediatorLiveData","text":"<p><code>MediatorLiveData</code> \u662f <code>LiveData</code> \u7684\u4e00\u4e2a\u5b50\u7c7b\uff0c\u53ef\u4ee5\u5408\u5e76\u591a\u4e2a <code>LiveData</code> \u7684\u6570\u636e\uff0c\u5e76\u5728\u4efb\u610f\u4e00\u4e2a <code>LiveData</code> \u53d8\u5316\u65f6\u89e6\u53d1\u66f4\u65b0\u3002</p>"},{"location":"040Jetpack/010Basic/#_48","title":"\u5b9e\u73b0\u65b9\u5f0f\uff1a","text":"<ul> <li>\u4f7f\u7528 <code>MediatorLiveData</code> \u89c2\u5bdf\u591a\u4e2a <code>LiveData</code>\u3002</li> <li>\u5728 <code>MediatorLiveData</code> \u7684\u56de\u8c03\u4e2d\u5408\u5e76\u6570\u636e\u5e76\u66f4\u65b0 UI\u3002</li> </ul>"},{"location":"040Jetpack/010Basic/#_49","title":"\u793a\u4f8b\u4ee3\u7801\uff1a","text":"<pre><code>public class MyViewModel extends ViewModel {\n    private MutableLiveData&lt;String&gt; data1 = new MutableLiveData&lt;&gt;();\n    private MutableLiveData&lt;Integer&gt; data2 = new MutableLiveData&lt;&gt;();\n    private MediatorLiveData&lt;CombinedData&gt; combinedData = new MediatorLiveData&lt;&gt;();\n\n    public MyViewModel() {\n        // \u89c2\u5bdf data1 \u548c data2 \u7684\u53d8\u5316\n        combinedData.addSource(data1, value -&gt; combineData());\n        combinedData.addSource(data2, value -&gt; combineData());\n    }\n\n    private void combineData() {\n        String value1 = data1.getValue();\n        Integer value2 = data2.getValue();\n        if (value1 != null &amp;&amp; value2 != null) {\n            combinedData.setValue(new CombinedData(value1, value2));\n        }\n    }\n\n    public LiveData&lt;CombinedData&gt; getCombinedData() {\n        return combinedData;\n    }\n\n    public void fetchData1() {\n        // \u6a21\u62df\u4ece API \u83b7\u53d6\u6570\u636e\n        data1.setValue(\"Data from API 1\");\n    }\n\n    public void fetchData2() {\n        // \u6a21\u62df\u4ece API \u83b7\u53d6\u6570\u636e\n        data2.setValue(100);\n    }\n\n    // \u6570\u636e\u5408\u5e76\u7c7b\n    public static class CombinedData {\n        public final String data1;\n        public final int data2;\n\n        public CombinedData(String data1, int data2) {\n            this.data1 = data1;\n            this.data2 = data2;\n        }\n    }\n}\n\n// \u5728 Activity \u4e2d\u89c2\u5bdf MediatorLiveData\nMyViewModel viewModel = new ViewModelProvider(this).get(MyViewModel.class);\nviewModel.getCombinedData().observe(this, combinedData -&gt; {\n    // \u66f4\u65b0 UI\n    textView1.setText(combinedData.data1);\n    textView2.setText(String.valueOf(combinedData.data2));\n});\n\n// \u89e6\u53d1\u6570\u636e\u52a0\u8f7d\nviewModel.fetchData1();\nviewModel.fetchData2();\n</code></pre>"},{"location":"040Jetpack/010Basic/#_50","title":"\u4f18\u70b9\uff1a","text":"<ul> <li>\u53ef\u4ee5\u5408\u5e76\u591a\u4e2a\u6570\u636e\u6e90\uff0c\u9002\u5408\u6570\u636e\u6e90\u4e4b\u95f4\u6709\u4f9d\u8d56\u5173\u7cfb\u7684\u573a\u666f\u3002</li> <li>\u51cf\u5c11 UI \u5c42\u7684\u89c2\u5bdf\u903b\u8f91\uff0c\u7b80\u5316\u4ee3\u7801\u3002</li> </ul>"},{"location":"040Jetpack/010Basic/#_51","title":"\u7f3a\u70b9\uff1a","text":"<ul> <li>\u9700\u8981\u624b\u52a8\u7ba1\u7406\u6570\u636e\u5408\u5e76\u903b\u8f91\u3002</li> <li>\u5982\u679c\u6570\u636e\u6e90\u8fc7\u591a\uff0c<code>MediatorLiveData</code> \u7684\u56de\u8c03\u53ef\u80fd\u4f1a\u53d8\u5f97\u590d\u6742\u3002</li> </ul>"},{"location":"040Jetpack/010Basic/#3-kotlin-flow","title":"3. \u4f7f\u7528 Kotlin Flow\uff08\u63a8\u8350\uff09","text":"<p>\u5982\u679c\u9879\u76ee\u4f7f\u7528 Kotlin\uff0c\u53ef\u4ee5\u4f7f\u7528 <code>Flow</code> \u6765\u5904\u7406\u591a\u4e2a\u6570\u636e\u6e90\u3002<code>Flow</code> \u662f Kotlin \u534f\u7a0b\u7684\u4e00\u90e8\u5206\uff0c\u9002\u5408\u5904\u7406\u5f02\u6b65\u6570\u636e\u6d41\u3002</p>"},{"location":"040Jetpack/010Basic/#_52","title":"\u5b9e\u73b0\u65b9\u5f0f\uff1a","text":"<ul> <li>\u4f7f\u7528 <code>flow</code> \u521b\u5efa\u591a\u4e2a\u6570\u636e\u6d41\u3002</li> <li>\u4f7f\u7528 <code>combine</code> \u6216 <code>zip</code> \u64cd\u4f5c\u7b26\u5408\u5e76\u591a\u4e2a\u6570\u636e\u6d41\u3002</li> <li>\u5728 UI \u5c42\u6536\u96c6\u5408\u5e76\u540e\u7684\u6570\u636e\u6d41\u3002</li> </ul>"},{"location":"040Jetpack/010Basic/#_53","title":"\u793a\u4f8b\u4ee3\u7801\uff1a","text":"<pre><code>class MyViewModel : ViewModel() {\n    private val data1 = MutableStateFlow&lt;String?&gt;(null)\n    private val data2 = MutableStateFlow&lt;Int?&gt;(null)\n\n    val combinedData: StateFlow&lt;CombinedData?&gt; = combine(data1, data2) { value1, value2 -&gt;\n        if (value1 != null &amp;&amp; value2 != null) {\n            CombinedData(value1, value2)\n        } else {\n            null\n        }\n    }.stateIn(viewModelScope, SharingStarted.Eagerly, null)\n\n    fun fetchData1() {\n        viewModelScope.launch {\n            // \u6a21\u62df\u4ece API \u83b7\u53d6\u6570\u636e\n            data1.value = \"Data from API 1\"\n        }\n    }\n\n    fun fetchData2() {\n        viewModelScope.launch {\n            // \u6a21\u62df\u4ece API \u83b7\u53d6\u6570\u636e\n            data2.value = 100\n        }\n    }\n\n    data class CombinedData(val data1: String, val data2: Int)\n}\n\n// \u5728 Activity \u4e2d\u6536\u96c6 Flow\nval viewModel: MyViewModel by viewModels()\nlifecycleScope.launch {\n    viewModel.combinedData.collect { combinedData -&gt;\n        combinedData?.let {\n            textView1.text = it.data1\n            textView2.text = it.data2.toString()\n        }\n    }\n}\n\n// \u89e6\u53d1\u6570\u636e\u52a0\u8f7d\nviewModel.fetchData1()\nviewModel.fetchData2()\n</code></pre>"},{"location":"040Jetpack/010Basic/#_54","title":"\u4f18\u70b9\uff1a","text":"<ul> <li>\u5929\u7136\u652f\u6301\u5f02\u6b65\u64cd\u4f5c\uff0c\u9002\u5408\u590d\u6742\u7684\u5f02\u6b65\u573a\u666f\u3002</li> <li>\u4f7f\u7528 Kotlin \u534f\u7a0b\uff0c\u4ee3\u7801\u66f4\u7b80\u6d01\u3002</li> <li>\u652f\u6301\u4e30\u5bcc\u7684\u64cd\u4f5c\u7b26\uff08\u5982 <code>combine</code>\u3001<code>zip</code>\u3001<code>map</code> \u7b49\uff09\uff0c\u65b9\u4fbf\u6570\u636e\u6d41\u5904\u7406\u3002</li> </ul>"},{"location":"040Jetpack/010Basic/#_55","title":"\u7f3a\u70b9\uff1a","text":"<ul> <li>\u9700\u8981\u719f\u6089 Kotlin \u534f\u7a0b\u548c <code>Flow</code> \u7684\u4f7f\u7528\u3002</li> <li>\u4e0d\u9002\u5408\u7eaf Java \u9879\u76ee\u3002</li> </ul>"},{"location":"040Jetpack/010Basic/#4-rxjava","title":"4. \u4f7f\u7528 RxJava","text":"<p>\u5982\u679c\u9879\u76ee\u5df2\u7ecf\u4f7f\u7528\u4e86 RxJava\uff0c\u53ef\u4ee5\u4f7f\u7528 <code>Observable</code> \u6216 <code>Flowable</code> \u6765\u5904\u7406\u591a\u4e2a\u6570\u636e\u6e90\u3002</p>"},{"location":"040Jetpack/010Basic/#_56","title":"\u5b9e\u73b0\u65b9\u5f0f\uff1a","text":"<ul> <li>\u4f7f\u7528 <code>Observable</code> \u521b\u5efa\u591a\u4e2a\u6570\u636e\u6d41\u3002</li> <li>\u4f7f\u7528 <code>zip</code> \u6216 <code>combineLatest</code> \u64cd\u4f5c\u7b26\u5408\u5e76\u6570\u636e\u6d41\u3002</li> <li>\u5728 UI \u5c42\u8ba2\u9605\u5408\u5e76\u540e\u7684\u6570\u636e\u6d41\u3002</li> </ul>"},{"location":"040Jetpack/010Basic/#_57","title":"\u793a\u4f8b\u4ee3\u7801\uff1a","text":"<pre><code>public class MyViewModel extends ViewModel {\n    private BehaviorSubject&lt;String&gt; data1 = BehaviorSubject.create();\n    private BehaviorSubject&lt;Integer&gt; data2 = BehaviorSubject.create();\n    private Observable&lt;CombinedData&gt; combinedData;\n\n    public MyViewModel() {\n        combinedData = Observable.combineLatest(data1, data2, (value1, value2) -&gt; new CombindData(value1, value2));\n    }\n\n    public Observable&lt;CombinedData&gt; getCombinedData() {\n        return combinedData;\n    }\n\n    public void fetchData1() {\n        // \u6a21\u62df\u4ece API \u83b7\u53d6\u6570\u636e\n        data1.onNext(\"Data from API 1\");\n    }\n\n    public void fetchData2() {\n        // \u6a21\u62df\u4ece API \u83b7\u53d6\u6570\u636e\n        data2.onNext(100);\n    }\n\n    public static class CombindData {\n        public final String data1;\n        public final int data2;\n\n        public CombindData(String data1, int data2) {\n            this.data1 = data1;\n            this.data2 = data2;\n        }\n    }\n}\n\n// \u5728 Activity \u4e2d\u8ba2\u9605 Observable\nMyViewModel viewModel = new ViewModelProvider(this).get(MyViewModel.class);\nviewModel.getCombinedData().subscribe(combinedData -&gt; {\n    // \u66f4\u65b0 UI\n    textView1.setText(combinedData.data1);\n    textView2.setText(String.valueOf(combinedData.data2));\n});\n\n// \u89e6\u53d1\u6570\u636e\u52a0\u8f7d\nviewModel.fetchData1();\nviewModel.fetchData2();\n</code></pre>"},{"location":"040Jetpack/010Basic/#_58","title":"\u4f18\u70b9\uff1a","text":"<ul> <li>\u5f3a\u5927\u7684\u5f02\u6b65\u5904\u7406\u80fd\u529b\u3002</li> <li>\u4e30\u5bcc\u7684\u64cd\u4f5c\u7b26\u652f\u6301\u3002</li> </ul>"},{"location":"040Jetpack/010Basic/#_59","title":"\u7f3a\u70b9\uff1a","text":"<ul> <li>RxJava \u7684\u5b66\u4e60\u66f2\u7ebf\u8f83\u9ad8\u3002</li> <li>\u9700\u8981\u624b\u52a8\u7ba1\u7406\u8ba2\u9605\u751f\u547d\u5468\u671f\u3002</li> </ul>"},{"location":"040Jetpack/010Basic/#_60","title":"\u603b\u7ed3","text":"<ul> <li>\u591a\u4e2a LiveData\uff1a\u9002\u5408\u7b80\u5355\u7684\u573a\u666f\uff0c\u6570\u636e\u6e90\u4e4b\u95f4\u6ca1\u6709\u4f9d\u8d56\u5173\u7cfb\u3002</li> <li>MediatorLiveData\uff1a\u9002\u5408\u9700\u8981\u5408\u5e76\u591a\u4e2a\u6570\u636e\u6e90\u7684\u573a\u666f\u3002</li> <li>Kotlin Flow\uff1a\u63a8\u8350\u4f7f\u7528\uff0c\u9002\u5408\u590d\u6742\u7684\u5f02\u6b65\u573a\u666f\uff0c\u4ee3\u7801\u7b80\u6d01\u4e14\u529f\u80fd\u5f3a\u5927\u3002</li> <li>RxJava\uff1a\u9002\u5408\u5df2\u7ecf\u4f7f\u7528 RxJava \u7684\u9879\u76ee\uff0c\u529f\u80fd\u5f3a\u5927\u4f46\u5b66\u4e60\u6210\u672c\u8f83\u9ad8\u3002</li> </ul> <p>\u6839\u636e\u9879\u76ee\u9700\u6c42\u548c\u56e2\u961f\u6280\u672f\u6808\u9009\u62e9\u5408\u9002\u7684\u65b9\u5f0f\u3002\u5982\u679c\u4f7f\u7528 Kotlin\uff0c\u63a8\u8350\u4f18\u5148\u8003\u8651 <code>Flow</code>\u3002</p>"},{"location":"040Jetpack/010Basic/#flow","title":"Flow\u4f7f\u7528","text":"\u7b54\u6848"},{"location":"040Jetpack/010Basic/#kotlin-flow","title":"Kotlin Flow \u7684\u597d\u5904","text":"<p>Kotlin Flow \u662f Kotlin \u534f\u7a0b\u5e93\u7684\u4e00\u90e8\u5206\uff0c\u4e13\u95e8\u7528\u4e8e\u5904\u7406\u5f02\u6b65\u6570\u636e\u6d41\u3002\u76f8\u6bd4\u4e8e\u4f20\u7edf\u7684\u56de\u8c03\u3001LiveData \u6216 RxJava\uff0cFlow \u5177\u6709\u4ee5\u4e0b\u4f18\u52bf\uff1a</p> <ol> <li>\u5929\u7136\u652f\u6301\u534f\u7a0b\uff1a</li> <li>Flow \u662f\u57fa\u4e8e Kotlin \u534f\u7a0b\u7684\uff0c\u53ef\u4ee5\u65e0\u7f1d\u96c6\u6210\u5230\u534f\u7a0b\u4e2d\uff0c\u7b80\u5316\u5f02\u6b65\u7f16\u7a0b\u3002</li> <li> <p>\u907f\u514d\u4e86\u56de\u8c03\u5730\u72f1\uff0c\u4ee3\u7801\u66f4\u7b80\u6d01\u3002</p> </li> <li> <p>\u51b7\u6d41\uff08Cold Stream\uff09\uff1a</p> </li> <li> <p>Flow \u662f\u51b7\u6d41\uff0c\u53ea\u6709\u5728\u6536\u96c6\u65f6\u624d\u4f1a\u6267\u884c\uff0c\u907f\u514d\u4e86\u4e0d\u5fc5\u8981\u7684\u8d44\u6e90\u6d6a\u8d39\u3002</p> </li> <li> <p>\u4e30\u5bcc\u7684\u64cd\u4f5c\u7b26\uff1a</p> </li> <li> <p>\u63d0\u4f9b\u4e86\u4e30\u5bcc\u7684\u64cd\u4f5c\u7b26\uff08\u5982 <code>map</code>\u3001<code>filter</code>\u3001<code>combine</code>\u3001<code>zip</code> \u7b49\uff09\uff0c\u65b9\u4fbf\u5bf9\u6570\u636e\u6d41\u8fdb\u884c\u8f6c\u6362\u548c\u7ec4\u5408\u3002</p> </li> <li> <p>\u751f\u547d\u5468\u671f\u611f\u77e5\uff1a</p> </li> <li> <p>\u53ef\u4ee5\u901a\u8fc7 <code>lifecycleScope</code> \u6216 <code>viewModelScope</code> \u81ea\u52a8\u7ba1\u7406\u751f\u547d\u5468\u671f\uff0c\u907f\u514d\u5185\u5b58\u6cc4\u6f0f\u3002</p> </li> <li> <p>\u80cc\u538b\u652f\u6301\uff1a</p> </li> <li> <p>\u652f\u6301\u80cc\u538b\uff08Backpressure\uff09\uff0c\u53ef\u4ee5\u5904\u7406\u751f\u4ea7\u8005\u548c\u6d88\u8d39\u8005\u901f\u5ea6\u4e0d\u5339\u914d\u7684\u95ee\u9898\u3002</p> </li> <li> <p>\u4e0e LiveData \u65e0\u7f1d\u96c6\u6210\uff1a</p> </li> <li>\u53ef\u4ee5\u901a\u8fc7 <code>asLiveData()</code> \u5c06 Flow \u8f6c\u6362\u4e3a LiveData\uff0c\u65b9\u4fbf\u5728 Android \u4e2d\u4f7f\u7528\u3002</li> </ol>"},{"location":"040Jetpack/010Basic/#flow_1","title":"Flow \u7684\u4f7f\u7528\u65b9\u5f0f","text":"<p>\u4ee5\u4e0b\u662f\u51e0\u4e2a\u5e38\u89c1\u7684\u4f7f\u7528\u6848\u4f8b\uff0c\u5c55\u793a Flow \u7684\u4f18\u52bf\u548c\u7528\u6cd5\u3002</p>"},{"location":"040Jetpack/010Basic/#1_3","title":"\u6848\u4f8b 1\uff1a\u7b80\u5355\u7684\u6570\u636e\u6d41","text":"<p>\u573a\u666f\uff1a\u4ece\u7f51\u7edc\u6216\u6570\u636e\u5e93\u83b7\u53d6\u6570\u636e\uff0c\u5e76\u5728 UI \u4e2d\u5c55\u793a\u3002</p> <pre><code>// ViewModel\nclass MyViewModel : ViewModel() {\n    private val _data = MutableStateFlow&lt;String?&gt;(null)\n    val data: StateFlow&lt;String?&gt; = _data\n\n    fun fetchData() {\n        viewModelScope.launch {\n            // \u6a21\u62df\u7f51\u7edc\u8bf7\u6c42\n            delay(1000)\n            _data.value = \"Hello, Flow!\"\n        }\n    }\n}\n\n// Activity\nclass MyActivity : AppCompatActivity() {\n    private val viewModel: MyViewModel by viewModels()\n\n    override fun onCreate(savedInstanceState: Bundle?) {\n        super.onCreate(savedInstanceState)\n        setContentView(R.layout.activity_main)\n\n        // \u6536\u96c6\u6570\u636e\u6d41\n        lifecycleScope.launch {\n            viewModel.data.collect { data -&gt;\n                findViewById&lt;TextView&gt;(R.id.textView).text = data\n            }\n        }\n\n        // \u89e6\u53d1\u6570\u636e\u52a0\u8f7d\n        viewModel.fetchData()\n    }\n}\n</code></pre> <p>\u4f18\u70b9\uff1a - \u4f7f\u7528 <code>StateFlow</code> \u53ef\u4ee5\u8f7b\u677e\u7ba1\u7406 UI \u72b6\u6001\u3002 - \u81ea\u52a8\u5904\u7406\u751f\u547d\u5468\u671f\uff0c\u907f\u514d\u5185\u5b58\u6cc4\u6f0f\u3002</p>"},{"location":"040Jetpack/010Basic/#2_5","title":"\u6848\u4f8b 2\uff1a\u5408\u5e76\u591a\u4e2a\u6570\u636e\u6d41","text":"<p>\u573a\u666f\uff1a\u4ece\u4e24\u4e2a API \u83b7\u53d6\u6570\u636e\uff0c\u5408\u5e76\u540e\u5c55\u793a\u3002</p> <pre><code>// ViewModel\nclass MyViewModel : ViewModel() {\n    private val _data1 = MutableStateFlow&lt;String?&gt;(null)\n    private val _data2 = MutableStateFlow&lt;Int?&gt;(null)\n    val combinedData: StateFlow&lt;CombinedData?&gt; = combine(_data1, _data2) { data1, data2 -&gt;\n        if (data1 != null &amp;&amp; data2 != null) {\n            CombinedData(data1, data2)\n        } else {\n            null\n        }\n    }.stateIn(viewModelScope, SharingStarted.Eagerly, null)\n\n    fun fetchData1() {\n        viewModelScope.launch {\n            // \u6a21\u62df\u7f51\u7edc\u8bf7\u6c42\n            delay(1000)\n            _data1.value = \"Data from API 1\"\n        }\n    }\n\n    fun fetchData2() {\n        viewModelScope.launch {\n            // \u6a21\u62df\u7f51\u7edc\u8bf7\u6c42\n            delay(1500)\n            _data2.value = 100\n        }\n    }\n\n    data class CombinedData(val data1: String, val data2: Int)\n}\n\n// Activity\nclass MyActivity : AppCompatActivity() {\n    private val viewModel: MyViewModel by viewModels()\n\n    override fun onCreate(savedInstanceState: Bundle?) {\n        super.onCreate(savedInstanceState)\n        setContentView(R.layout.activity_main)\n\n        // \u6536\u96c6\u5408\u5e76\u540e\u7684\u6570\u636e\u6d41\n        lifecycleScope.launch {\n            viewModel.combinedData.collect { combinedData -&gt;\n                combinedData?.let {\n                    findViewById&lt;TextView&gt;(R.id.textView1).text = it.data1\n                    findViewById&lt;TextView&gt;(R.id.textView2).text = it.data2.toString()\n                }\n            }\n        }\n\n        // \u89e6\u53d1\u6570\u636e\u52a0\u8f7d\n        viewModel.fetchData1()\n        viewModel.fetchData2()\n    }\n}\n</code></pre> <p>\u4f18\u70b9\uff1a - \u4f7f\u7528 <code>combine</code> \u64cd\u4f5c\u7b26\u53ef\u4ee5\u8f7b\u677e\u5408\u5e76\u591a\u4e2a\u6570\u636e\u6d41\u3002 - \u81ea\u52a8\u5904\u7406\u6570\u636e\u6e90\u7684\u4f9d\u8d56\u5173\u7cfb\u3002</p>"},{"location":"040Jetpack/010Basic/#3_3","title":"\u6848\u4f8b 3\uff1a\u5904\u7406\u590d\u6742\u7684\u5f02\u6b65\u64cd\u4f5c","text":"<p>\u573a\u666f\uff1a\u4ece API \u83b7\u53d6\u6570\u636e\uff0c\u8fdb\u884c\u8f6c\u6362\u548c\u8fc7\u6ee4\u3002</p> <pre><code>// ViewModel\nclass MyViewModel : ViewModel() {\n    private val _data = MutableStateFlow&lt;List&lt;String&gt;?&gt;(null)\n    val data: StateFlow&lt;List&lt;String&gt;?&gt; = _data\n\n    fun fetchData() {\n        viewModelScope.launch {\n            // \u6a21\u62df\u7f51\u7edc\u8bf7\u6c42\n            val result = flow {\n                emit(\"A\")\n                delay(500)\n                emit(\"B\")\n                delay(500)\n                emit(\"C\")\n            }\n                .map { it.toLowerCase() } // \u8f6c\u6362\u4e3a\u5c0f\u5199\n                .filter { it != \"b\" }    // \u8fc7\u6ee4\u6389 \"b\"\n                .toList()\n\n            _data.value = result\n        }\n    }\n}\n\n// Activity\nclass MyActivity : AppCompatActivity() {\n    private val viewModel: MyViewModel by viewModels()\n\n    override fun onCreate(savedInstanceState: Bundle?) {\n        super.onCreate(savedInstanceState)\n        setContentView(R.layout.activity_main)\n\n        // \u6536\u96c6\u6570\u636e\u6d41\n        lifecycleScope.launch {\n            viewModel.data.collect { data -&gt;\n                data?.let {\n                    findViewById&lt;TextView&gt;(R.id.textView).text = it.joinToString(\", \")\n                }\n            }\n        }\n\n        // \u89e6\u53d1\u6570\u636e\u52a0\u8f7d\n        viewModel.fetchData()\n    }\n}\n</code></pre> <p>\u4f18\u70b9\uff1a - \u4f7f\u7528 <code>map</code> \u548c <code>filter</code> \u64cd\u4f5c\u7b26\u53ef\u4ee5\u8f7b\u677e\u5bf9\u6570\u636e\u6d41\u8fdb\u884c\u8f6c\u6362\u548c\u8fc7\u6ee4\u3002 - \u4ee3\u7801\u6e05\u6670\u6613\u8bfb\u3002</p>"},{"location":"040Jetpack/010Basic/#4-room","title":"\u6848\u4f8b 4\uff1a\u4e0e Room \u6570\u636e\u5e93\u96c6\u6210","text":"<p>\u573a\u666f\uff1a\u4ece Room \u6570\u636e\u5e93\u89c2\u5bdf\u6570\u636e\u53d8\u5316\u3002</p> <pre><code>// Dao\n@Dao\ninterface UserDao {\n    @Query(\"SELECT * FROM user\")\n    fun getUsers(): Flow&lt;List&lt;User&gt;&gt;\n}\n\n// ViewModel\nclass MyViewModel(application: Application) : AndroidViewModel(application) {\n    private val userDao = (application as MyApp).database.userDao()\n    val users: LiveData&lt;List&lt;User&gt;&gt; = userDao.getUsers().asLiveData()\n}\n\n// Activity\nclass MyActivity : AppCompatActivity() {\n    private val viewModel: MyViewModel by viewModels()\n\n    override fun onCreate(savedInstanceState: Bundle?) {\n        super.onCreate(savedInstanceState)\n        setContentView(R.layout.activity_main)\n\n        // \u89c2\u5bdf\u6570\u636e\u5e93\u6570\u636e\u53d8\u5316\n        viewModel.users.observe(this) { users -&gt;\n            findViewById&lt;TextView&gt;(R.id.textView).text = users.joinToString(\", \")\n        }\n    }\n}\n</code></pre> <p>\u4f18\u70b9\uff1a - \u4f7f\u7528 <code>asLiveData()</code> \u5c06 Flow \u8f6c\u6362\u4e3a LiveData\uff0c\u65b9\u4fbf\u5728 Android \u4e2d\u4f7f\u7528\u3002 - \u81ea\u52a8\u89c2\u5bdf\u6570\u636e\u5e93\u53d8\u5316\uff0c\u65e0\u9700\u624b\u52a8\u5237\u65b0\u3002</p>"},{"location":"040Jetpack/010Basic/#5_5","title":"\u6848\u4f8b 5\uff1a\u5904\u7406\u80cc\u538b\u95ee\u9898","text":"<p>\u573a\u666f\uff1a\u751f\u4ea7\u8005\u901f\u5ea6\u8fc7\u5feb\uff0c\u6d88\u8d39\u8005\u5904\u7406\u4e0d\u8fc7\u6765\u3002</p> <pre><code>// ViewModel\nclass MyViewModel : ViewModel() {\n    val data = flow {\n        for (i in 1..100) {\n            emit(i)\n            delay(100) // \u6a21\u62df\u5feb\u901f\u751f\u4ea7\u6570\u636e\n        }\n    }.buffer(10) // \u8bbe\u7f6e\u7f13\u51b2\u533a\u5927\u5c0f\n\n    fun startCollecting() {\n        viewModelScope.launch {\n            data.collect { value -&gt;\n                delay(500) // \u6a21\u62df\u6162\u901f\u6d88\u8d39\u6570\u636e\n                println(\"Collected: $value\")\n            }\n        }\n    }\n}\n</code></pre> <p>\u4f18\u70b9\uff1a - \u4f7f\u7528 <code>buffer</code> \u64cd\u4f5c\u7b26\u53ef\u4ee5\u5904\u7406\u80cc\u538b\u95ee\u9898\uff0c\u907f\u514d\u6570\u636e\u4e22\u5931\u3002</p>"},{"location":"040Jetpack/010Basic/#_61","title":"\u603b\u7ed3","text":"<p>Kotlin Flow \u662f\u4e00\u4e2a\u5f3a\u5927\u7684\u5f02\u6b65\u6570\u636e\u6d41\u5904\u7406\u5de5\u5177\uff0c\u7279\u522b\u9002\u5408\u4ee5\u4e0b\u573a\u666f\uff1a - \u9700\u8981\u5904\u7406\u591a\u4e2a\u6570\u636e\u6e90\u3002 - \u9700\u8981\u5bf9\u6570\u636e\u6d41\u8fdb\u884c\u590d\u6742\u7684\u8f6c\u6362\u548c\u7ec4\u5408\u3002 - \u9700\u8981\u4e0e\u534f\u7a0b\u65e0\u7f1d\u96c6\u6210\u3002 - \u9700\u8981\u5904\u7406\u80cc\u538b\u95ee\u9898\u3002</p> <p>\u901a\u8fc7\u4ee5\u4e0a\u6848\u4f8b\uff0c\u53ef\u4ee5\u770b\u51fa Flow \u7684\u4ee3\u7801\u7b80\u6d01\u3001\u529f\u80fd\u5f3a\u5927\uff0c\u662f Kotlin \u5f02\u6b65\u7f16\u7a0b\u7684\u9996\u9009\u5de5\u5177\u3002</p>"},{"location":"040Jetpack/010Basic/#flow_2","title":"Flow\u539f\u7406","text":"\u7b54\u6848 <p>https://juejin.cn/post/7077149853876224013</p> <p>Kotlin Flow \u5305\u542b\u4e09\u4e2a\u5b9e\u4f53\uff1a\u6570\u636e\u751f\u4ea7\u65b9 - \uff08\u53ef\u9009\u7684\uff09\u4e2d\u4ecb\u8005 - \u6570\u636e\u4f7f\u7528\u65b9\u3002\u6570\u636e\u751f\u4ea7\u65b9\u8d1f\u8d23\u5411\u6570\u636e\u6d41\u53d1\u5c04\uff08emit\uff09\u6570\u636e\uff0c\u800c\u6570\u636e\u4f7f\u7528\u65b9\u4ece\u6570\u636e\u6d41\u4e2d\u6d88\u8d39\u6570\u636e\u3002\u6839\u636e\u751f\u4ea7\u65b9\u4ea7\u751f\u6570\u636e\u7684\u65f6\u673a\uff0c\u53ef\u4ee5\u5c06 Kotlin Flow \u5206\u4e3a\u51b7\u6d41\u548c\u70ed\u6d41\u4e24\u79cd\uff1a</p> <p>\u666e\u901a Flow\uff08\u51b7\u6d41\uff09\uff1a \u51b7\u6d41\u662f\u4e0d\u5171\u4eab\u7684\uff0c\u4e5f\u6ca1\u6709\u7f13\u5b58\u673a\u5236\u3002\u51b7\u6d41\u53ea\u6709\u5728\u8ba2\u9605\u8005 collect \u6570\u636e\u65f6\uff0c\u624d\u6309\u9700\u6267\u884c\u53d1\u5c04\u6570\u636e\u6d41\u7684\u4ee3\u7801\u3002\u51b7\u6d41\u548c\u8ba2\u9605\u8005\u662f\u4e00\u5bf9\u4e00\u7684\u5173\u7cfb\uff0c\u591a\u4e2a\u8ba2\u9605\u8005\u95f4\u7684\u6570\u636e\u6d41\u662f\u76f8\u4e92\u72ec\u7acb\u7684\uff0c\u4e00\u65e6\u8ba2\u9605\u8005\u505c\u6b62\u76d1\u542c\u6216\u8005\u751f\u4ea7\u4ee3\u7801\u7ed3\u675f\uff0c\u6570\u636e\u6d41\u5c31\u81ea\u52a8\u5173\u95ed\u3002 SharedFlow / StateFlow\uff08\u70ed\u6d41\uff09\uff1a \u70ed\u6d41\u662f\u5171\u4eab\u7684\uff0c\u6709\u7f13\u5b58\u673a\u5236\u7684\u3002\u65e0\u8bba\u662f\u5426\u6709\u8ba2\u9605\u8005 collect \u6570\u636e\uff0c\u90fd\u53ef\u4ee5\u751f\u4ea7\u6570\u636e\u5e76\u4e14\u7f13\u5b58\u8d77\u6765\u3002\u70ed\u6d41\u548c\u8ba2\u9605\u8005\u662f\u4e00\u5bf9\u591a\u7684\u5173\u7cfb\uff0c\u591a\u4e2a\u8ba2\u9605\u8005\u53ef\u4ee5\u5171\u4eab\u540c\u4e00\u4e2a\u6570\u636e\u6d41\u3002\u5f53\u4e00\u4e2a\u8ba2\u9605\u8005\u505c\u6b62\u76d1\u542c\u65f6\uff0c\u6570\u636e\u6d41\u4e0d\u4f1a\u81ea\u52a8\u5173\u95ed\uff08\u9664\u975e\u4f7f\u7528 WhileSubscribed \u7b56\u7565\uff0c\u8fd9\u4e2a\u5728\u4e0b\u6587\u518d\u8bf4\uff09\u3002</p> <p>\u4ece\u6e90\u7801\u7684\u89d2\u5ea6\u5206\u6790 Android \u7684 <code>Flow</code>\uff0c\u6211\u4eec\u9700\u8981\u6df1\u5165\u7406\u89e3 Kotlin \u7684\u534f\u7a0b\u5e93\u4ee5\u53ca <code>Flow</code> \u7684\u5b9e\u73b0\u673a\u5236\u3002<code>Flow</code> \u662f Kotlin \u534f\u7a0b\u5e93\u4e2d\u7684\u4e00\u4e2a\u7ec4\u4ef6\uff0c\u7528\u4e8e\u5904\u7406\u5f02\u6b65\u6570\u636e\u6d41\u3002\u4ee5\u4e0b\u662f\u57fa\u4e8e\u6e90\u7801\u7684\u5206\u6790\uff1a</p>"},{"location":"040Jetpack/010Basic/#1-flow","title":"1. Flow \u7684\u57fa\u672c\u6982\u5ff5","text":"<p><code>Flow</code> \u662f\u4e00\u4e2a\u51b7\u6d41\uff08Cold Stream\uff09\uff0c\u610f\u5473\u7740\u5b83\u5728\u88ab\u6536\u96c6\uff08collect\uff09\u65f6\u624d\u4f1a\u5f00\u59cb\u53d1\u5c04\u6570\u636e\u3002\u5b83\u7684\u8bbe\u8ba1\u7075\u611f\u6765\u81ea\u4e8e Reactive Streams\uff0c\u4f46\u66f4\u52a0\u8f7b\u91cf\u7ea7\uff0c\u4e14\u4e0e Kotlin \u534f\u7a0b\u6df1\u5ea6\u96c6\u6210\u3002</p> <p><code>Flow</code> \u7684\u6838\u5fc3\u63a5\u53e3\u5b9a\u4e49\u5982\u4e0b\uff1a</p> <pre><code>public interface Flow&lt;out T&gt; {\n    public suspend fun collect(collector: FlowCollector&lt;T&gt;)\n}\n</code></pre> <ul> <li><code>Flow</code> \u662f\u4e00\u4e2a\u6cdb\u578b\u63a5\u53e3\uff0c<code>T</code> \u662f\u6d41\u4e2d\u53d1\u5c04\u7684\u6570\u636e\u7c7b\u578b\u3002</li> <li><code>collect</code> \u662f\u4e00\u4e2a\u6302\u8d77\u51fd\u6570\uff0c\u7528\u4e8e\u542f\u52a8\u6d41\u7684\u6536\u96c6\u64cd\u4f5c\u3002</li> <li><code>FlowCollector</code> \u662f\u4e00\u4e2a\u63a5\u53e3\uff0c\u7528\u4e8e\u63a5\u6536\u6d41\u4e2d\u7684\u6570\u636e\u3002</li> </ul>"},{"location":"040Jetpack/010Basic/#2-flow","title":"2. Flow \u7684\u6784\u5efa","text":"<p><code>Flow</code> \u7684\u6784\u5efa\u901a\u5e38\u901a\u8fc7 <code>flow { ... }</code> \u6784\u5efa\u5668\u6765\u5b9e\u73b0\u3002\u4ee5\u4e0b\u662f <code>flow</code> \u6784\u5efa\u5668\u7684\u6e90\u7801\uff1a</p> <pre><code>public fun &lt;T&gt; flow(@BuilderInference block: suspend FlowCollector&lt;T&gt;.() -&gt; Unit): Flow&lt;T&gt; {\n    return SafeFlow(block)\n}\n\nprivate class SafeFlow&lt;T&gt;(private val block: suspend FlowCollector&lt;T&gt;.() -&gt; Unit) : Flow&lt;T&gt; {\n    override suspend fun collect(collector: FlowCollector&lt;T&gt;) {\n        collector.block()\n    }\n}\n</code></pre> <ul> <li><code>flow</code> \u662f\u4e00\u4e2a\u9876\u5c42\u51fd\u6570\uff0c\u63a5\u53d7\u4e00\u4e2a\u6302\u8d77\u7684 lambda \u8868\u8fbe\u5f0f\u4f5c\u4e3a\u53c2\u6570\u3002</li> <li><code>SafeFlow</code> \u662f <code>Flow</code> \u7684\u4e00\u4e2a\u5b9e\u73b0\u7c7b\uff0c\u5b83\u5c01\u88c5\u4e86\u53d1\u5c04\u6570\u636e\u7684\u903b\u8f91\u3002</li> <li>\u5f53\u8c03\u7528 <code>collect</code> \u65f6\uff0c\u4f1a\u6267\u884c <code>block</code> \u4e2d\u7684\u4ee3\u7801\uff0c\u4ece\u800c\u53d1\u5c04\u6570\u636e\u3002</li> </ul>"},{"location":"040Jetpack/010Basic/#3-flow","title":"3. Flow \u7684\u6536\u96c6","text":"<p><code>Flow</code> \u7684\u6536\u96c6\u901a\u8fc7 <code>collect</code> \u65b9\u6cd5\u5b8c\u6210\u3002\u4ee5\u4e0b\u662f\u4e00\u4e2a\u7b80\u5355\u7684\u6536\u96c6\u793a\u4f8b\uff1a</p> <pre><code>flow {\n    emit(1)\n    emit(2)\n    emit(3)\n}.collect { value -&gt;\n    println(value)\n}\n</code></pre> <ul> <li><code>emit</code> \u662f <code>FlowCollector</code> \u7684\u4e00\u4e2a\u6269\u5c55\u51fd\u6570\uff0c\u7528\u4e8e\u53d1\u5c04\u6570\u636e\u3002</li> <li><code>collect</code> \u662f\u4e00\u4e2a\u6302\u8d77\u51fd\u6570\uff0c\u7528\u4e8e\u63a5\u6536\u6d41\u4e2d\u7684\u6570\u636e\u3002</li> </ul> <p><code>emit</code> \u7684\u6e90\u7801\u5982\u4e0b\uff1a</p> <pre><code>public suspend inline fun &lt;T&gt; FlowCollector&lt;T&gt;.emit(value: T) {\n    emit(value)\n}\n</code></pre>"},{"location":"040Jetpack/010Basic/#4-flow","title":"4. Flow \u7684\u64cd\u4f5c\u7b26","text":"<p><code>Flow</code> \u63d0\u4f9b\u4e86\u4e30\u5bcc\u7684\u64cd\u4f5c\u7b26\uff08\u5982 <code>map</code>\u3001<code>filter</code>\u3001<code>flatMapConcat</code> \u7b49\uff09\uff0c\u8fd9\u4e9b\u64cd\u4f5c\u7b26\u662f\u901a\u8fc7\u6269\u5c55\u51fd\u6570\u5b9e\u73b0\u7684\u3002\u4ee5\u4e0b\u662f <code>map</code> \u64cd\u4f5c\u7b26\u7684\u6e90\u7801\uff1a</p> <pre><code>public inline fun &lt;T, R&gt; Flow&lt;T&gt;.map(crossinline transform: suspend (value: T) -&gt; R): Flow&lt;R&gt; {\n    return flow {\n        collect { value -&gt;\n            emit(transform(value))\n        }\n    }\n}\n</code></pre> <ul> <li><code>map</code> \u662f\u4e00\u4e2a\u6269\u5c55\u51fd\u6570\uff0c\u63a5\u53d7\u4e00\u4e2a\u8f6c\u6362\u51fd\u6570 <code>transform</code>\u3002</li> <li>\u5728 <code>flow</code> \u6784\u5efa\u5668\u4e2d\uff0c\u901a\u8fc7 <code>collect</code> \u6536\u96c6\u4e0a\u6e38\u6d41\u7684\u6570\u636e\uff0c\u7136\u540e\u5bf9\u6bcf\u4e2a\u503c\u5e94\u7528 <code>transform</code>\uff0c\u5e76\u901a\u8fc7 <code>emit</code> \u53d1\u5c04\u8f6c\u6362\u540e\u7684\u503c\u3002</li> </ul>"},{"location":"040Jetpack/010Basic/#5-flow","title":"5. Flow \u7684\u7ebf\u7a0b\u5207\u6362","text":"<p><code>Flow</code> \u901a\u8fc7 <code>flowOn</code> \u64cd\u4f5c\u7b26\u6765\u5207\u6362\u6d41\u7684\u6267\u884c\u4e0a\u4e0b\u6587\u3002\u4ee5\u4e0b\u662f <code>flowOn</code> \u7684\u6e90\u7801\uff1a</p> <pre><code>public fun &lt;T&gt; Flow&lt;T&gt;.flowOn(context: CoroutineContext): Flow&lt;T&gt; {\n    return ChannelFlowOperatorImpl(this, context)\n}\n</code></pre> <ul> <li><code>flowOn</code> \u63a5\u53d7\u4e00\u4e2a <code>CoroutineContext</code> \u53c2\u6570\uff0c\u7528\u4e8e\u6307\u5b9a\u6d41\u7684\u6267\u884c\u4e0a\u4e0b\u6587\u3002</li> <li><code>ChannelFlowOperatorImpl</code> \u662f\u4e00\u4e2a\u5185\u90e8\u7c7b\uff0c\u8d1f\u8d23\u5c06\u6d41\u7684\u6267\u884c\u5207\u6362\u5230\u6307\u5b9a\u7684\u4e0a\u4e0b\u6587\u3002</li> </ul>"},{"location":"040Jetpack/010Basic/#6-flow","title":"6. Flow \u7684\u80cc\u538b\u5904\u7406","text":"<p><code>Flow</code> \u7684\u80cc\u538b\u5904\u7406\u662f\u901a\u8fc7\u7f13\u51b2\u533a\u548c\u64cd\u4f5c\u7b26\uff08\u5982 <code>buffer</code>\u3001<code>conflate</code>\uff09\u6765\u5b9e\u73b0\u7684\u3002\u4ee5\u4e0b\u662f <code>buffer</code> \u64cd\u4f5c\u7b26\u7684\u6e90\u7801\uff1a</p> <pre><code>public fun &lt;T&gt; Flow&lt;T&gt;.buffer(capacity: Int = Channel.BUFFERED): Flow&lt;T&gt; {\n    return ChannelFlowOperatorImpl(this, capacity = capacity)\n}\n</code></pre> <ul> <li><code>buffer</code> \u5141\u8bb8\u6d41\u5728\u53d1\u5c04\u6570\u636e\u65f6\u4f7f\u7528\u7f13\u51b2\u533a\uff0c\u4ece\u800c\u907f\u514d\u80cc\u538b\u95ee\u9898\u3002</li> <li><code>capacity</code> \u53c2\u6570\u6307\u5b9a\u7f13\u51b2\u533a\u7684\u5927\u5c0f\u3002</li> </ul>"},{"location":"040Jetpack/010Basic/#7-flow","title":"7. Flow \u7684\u53d6\u6d88","text":"<p><code>Flow</code> \u7684\u53d6\u6d88\u662f\u901a\u8fc7\u534f\u7a0b\u7684\u53d6\u6d88\u673a\u5236\u5b9e\u73b0\u7684\u3002\u5f53\u6536\u96c6\u6d41\u7684\u534f\u7a0b\u88ab\u53d6\u6d88\u65f6\uff0c\u6d41\u4f1a\u81ea\u52a8\u505c\u6b62\u53d1\u5c04\u6570\u636e\u3002</p>"},{"location":"040Jetpack/010Basic/#8-flow","title":"8. Flow \u7684\u51b7\u6d41\u7279\u6027","text":"<p><code>Flow</code> \u662f\u51b7\u6d41\uff0c\u610f\u5473\u7740\u6bcf\u6b21\u8c03\u7528 <code>collect</code> \u65f6\uff0c\u6d41\u7684\u53d1\u5c04\u903b\u8f91\u90fd\u4f1a\u91cd\u65b0\u6267\u884c\u3002\u4ee5\u4e0b\u662f\u4e00\u4e2a\u793a\u4f8b\uff1a</p> <pre><code>val flow = flow {\n    println(\"Flow started\")\n    emit(1)\n    emit(2)\n}\n\nflow.collect { println(it) } // \u8f93\u51fa: Flow started, 1, 2\nflow.collect { println(it) } // \u8f93\u51fa: Flow started, 1, 2\n</code></pre> <ul> <li>\u6bcf\u6b21\u8c03\u7528 <code>collect</code> \u65f6\uff0c<code>flow</code> \u7684\u53d1\u5c04\u903b\u8f91\u90fd\u4f1a\u91cd\u65b0\u6267\u884c\u3002</li> </ul>"},{"location":"040Jetpack/010Basic/#9-flow-livedata","title":"9. Flow \u4e0e LiveData \u7684\u6bd4\u8f83","text":"<ul> <li><code>Flow</code> \u662f Kotlin \u534f\u7a0b\u7684\u4e00\u90e8\u5206\uff0c\u652f\u6301\u66f4\u590d\u6742\u7684\u5f02\u6b65\u64cd\u4f5c\u3002</li> <li><code>LiveData</code> \u662f Android \u67b6\u6784\u7ec4\u4ef6\uff0c\u4e3b\u8981\u7528\u4e8e UI \u5c42\u7684\u6570\u636e\u89c2\u5bdf\u3002</li> <li><code>Flow</code> \u53ef\u4ee5\u901a\u8fc7 <code>asLiveData</code> \u6269\u5c55\u51fd\u6570\u8f6c\u6362\u4e3a <code>LiveData</code>\u3002</li> </ul>"},{"location":"040Jetpack/010Basic/#10","title":"10. \u603b\u7ed3","text":"<p>\u4ece\u6e90\u7801\u7684\u89d2\u5ea6\u6765\u770b\uff0c<code>Flow</code> \u662f\u4e00\u4e2a\u57fa\u4e8e Kotlin \u534f\u7a0b\u7684\u5f02\u6b65\u6570\u636e\u6d41\u5e93\u3002\u5b83\u7684\u6838\u5fc3\u8bbe\u8ba1\u5305\u62ec\uff1a - \u51b7\u6d41\u7279\u6027\uff1a\u6bcf\u6b21\u6536\u96c6\u65f6\u91cd\u65b0\u53d1\u5c04\u6570\u636e\u3002 - \u4e30\u5bcc\u7684\u64cd\u4f5c\u7b26\uff1a\u901a\u8fc7\u6269\u5c55\u51fd\u6570\u5b9e\u73b0\u3002 - \u4e0e\u534f\u7a0b\u6df1\u5ea6\u96c6\u6210\uff1a\u652f\u6301\u6302\u8d77\u51fd\u6570\u548c\u53d6\u6d88\u673a\u5236\u3002</p> <p>\u901a\u8fc7\u5206\u6790\u6e90\u7801\uff0c\u6211\u4eec\u53ef\u4ee5\u66f4\u597d\u5730\u7406\u89e3 <code>Flow</code> \u7684\u5de5\u4f5c\u539f\u7406\uff0c\u5e76\u5728\u5b9e\u9645\u5f00\u53d1\u4e2d\u66f4\u9ad8\u6548\u5730\u4f7f\u7528\u5b83\u3002</p>"},{"location":"040Jetpack/010Basic/#flow_3","title":"Flow\u7684\u51b7\u6d41\uff0c\u70ed\u6d41\u5206\u522b\u7528\u5728\u4ec0\u4e48\u573a\u666f\uff1f","text":"\u7b54\u6848 <p><code>Flow</code> \u7684\u51b7\u6d41\uff08Cold Stream\uff09\u548c\u70ed\u6d41\uff08Hot Stream\uff09\u662f\u4e24\u79cd\u4e0d\u540c\u7684\u6570\u636e\u6d41\u6a21\u5f0f\uff0c\u5b83\u4eec\u5206\u522b\u9002\u7528\u4e8e\u4e0d\u540c\u7684\u573a\u666f\u3002\u4ee5\u4e0b\u662f\u5b83\u4eec\u7684\u7279\u6027\u53ca\u9002\u7528\u573a\u666f\u7684\u8be6\u7ec6\u5206\u6790\uff1a</p>"},{"location":"040Jetpack/010Basic/#1-cold-stream","title":"1. \u51b7\u6d41\uff08Cold Stream\uff09","text":"<p>\u51b7\u6d41\u662f <code>Flow</code> \u7684\u9ed8\u8ba4\u884c\u4e3a\uff0c\u5b83\u7684\u7279\u70b9\u662f\uff1a - \u6bcf\u6b21\u6536\u96c6\u65f6\u91cd\u65b0\u542f\u52a8\uff1a\u6bcf\u6b21\u8c03\u7528 <code>collect</code> \u65f6\uff0c\u6d41\u7684\u53d1\u5c04\u903b\u8f91\u90fd\u4f1a\u4ece\u5934\u5f00\u59cb\u6267\u884c\u3002 - \u6309\u9700\u53d1\u5c04\u6570\u636e\uff1a\u53ea\u6709\u5728\u6536\u96c6\u8005\uff08collector\uff09\u5f00\u59cb\u6536\u96c6\u65f6\uff0c\u6d41\u624d\u4f1a\u5f00\u59cb\u53d1\u5c04\u6570\u636e\u3002 - \u65e0\u5171\u4eab\u72b6\u6001\uff1a\u6bcf\u4e2a\u6536\u96c6\u8005\u90fd\u4f1a\u83b7\u5f97\u72ec\u7acb\u7684\u6570\u636e\u6d41\u3002</p>"},{"location":"040Jetpack/010Basic/#_62","title":"\u9002\u7528\u573a\u666f","text":"<ol> <li>\u4e00\u6b21\u6027\u6570\u636e\u6d41\uff1a</li> <li>\u4f8b\u5982\u4ece\u7f51\u7edc\u8bf7\u6c42\u6216\u6570\u636e\u5e93\u67e5\u8be2\u4e2d\u83b7\u53d6\u6570\u636e\uff0c\u6bcf\u6b21\u6536\u96c6\u65f6\u90fd\u9700\u8981\u91cd\u65b0\u83b7\u53d6\u6700\u65b0\u6570\u636e\u3002</li> <li> <p>\u793a\u4f8b\uff1a     <pre><code>fun fetchData(): Flow&lt;Data&gt; = flow {\n    val data = api.fetchData() // \u7f51\u7edc\u8bf7\u6c42\n    emit(data)\n}\n</code></pre></p> </li> <li> <p>\u6309\u9700\u52a0\u8f7d\uff1a</p> </li> <li>\u4f8b\u5982\u5206\u9875\u52a0\u8f7d\u6570\u636e\uff0c\u6bcf\u6b21\u6536\u96c6\u65f6\u6839\u636e\u5f53\u524d\u9875\u6570\u52a0\u8f7d\u65b0\u7684\u6570\u636e\u3002</li> <li> <p>\u793a\u4f8b\uff1a     <pre><code>fun loadPage(page: Int): Flow&lt;List&lt;Item&gt;&gt; = flow {\n    val items = api.loadPage(page) // \u5206\u9875\u52a0\u8f7d\n    emit(items)\n}\n</code></pre></p> </li> <li> <p>\u65e0\u5171\u4eab\u72b6\u6001\u7684\u573a\u666f\uff1a</p> </li> <li>\u4f8b\u5982\u6bcf\u4e2a\u6536\u96c6\u8005\u9700\u8981\u72ec\u7acb\u7684\u6570\u636e\u6d41\uff0c\u6570\u636e\u6d41\u4e4b\u95f4\u4e92\u4e0d\u5e72\u6270\u3002</li> <li>\u793a\u4f8b\uff1a     <pre><code>fun generateNumbers(): Flow&lt;Int&gt; = flow {\n    for (i in 1..10) {\n        emit(i)\n    }\n}\n</code></pre></li> </ol>"},{"location":"040Jetpack/010Basic/#2-hot-stream","title":"2. \u70ed\u6d41\uff08Hot Stream\uff09","text":"<p>\u70ed\u6d41\u7684\u7279\u70b9\u662f\uff1a - \u6570\u636e\u53d1\u5c04\u4e0e\u6536\u96c6\u8005\u65e0\u5173\uff1a\u65e0\u8bba\u662f\u5426\u6709\u6536\u96c6\u8005\uff0c\u70ed\u6d41\u90fd\u4f1a\u6301\u7eed\u53d1\u5c04\u6570\u636e\u3002 - \u5171\u4eab\u72b6\u6001\uff1a\u591a\u4e2a\u6536\u96c6\u8005\u5171\u4eab\u540c\u4e00\u4e2a\u6570\u636e\u6d41\uff0c\u6536\u96c6\u8005\u53ea\u80fd\u63a5\u6536\u5230\u8ba2\u9605\u4e4b\u540e\u7684\u6570\u636e\u3002 - \u9700\u8981\u624b\u52a8\u7ba1\u7406\u751f\u547d\u5468\u671f\uff1a\u70ed\u6d41\u901a\u5e38\u9700\u8981\u624b\u52a8\u542f\u52a8\u548c\u505c\u6b62\u3002</p> <p>\u5728 Kotlin \u534f\u7a0b\u4e2d\uff0c\u70ed\u6d41\u53ef\u4ee5\u901a\u8fc7 <code>StateFlow</code> \u6216 <code>SharedFlow</code> \u5b9e\u73b0\u3002</p>"},{"location":"040Jetpack/010Basic/#_63","title":"\u9002\u7528\u573a\u666f","text":"<ol> <li>\u72b6\u6001\u7ba1\u7406\uff1a</li> <li>\u4f8b\u5982\u5728 MVVM \u67b6\u6784\u4e2d\uff0c\u4f7f\u7528 <code>StateFlow</code> \u7ba1\u7406 UI \u72b6\u6001\u3002</li> <li> <p>\u793a\u4f8b\uff1a     <pre><code>class ViewModel : ViewModel() {\n    private val _state = MutableStateFlow&lt;UiState&gt;(UiState.Loading)\n    val state: StateFlow&lt;UiState&gt; = _state\n\n    fun loadData() {\n        viewModelScope.launch {\n            _state.value = UiState.Loading\n            val data = api.fetchData()\n            _state.value = UiState.Success(data)\n        }\n    }\n}\n</code></pre></p> </li> <li> <p>\u4e8b\u4ef6\u5e7f\u64ad\uff1a</p> </li> <li>\u4f8b\u5982\u4f7f\u7528 <code>SharedFlow</code> \u5e7f\u64ad\u5168\u5c40\u4e8b\u4ef6\uff08\u5982 Toast \u6d88\u606f\u3001\u5bfc\u822a\u4e8b\u4ef6\u7b49\uff09\u3002</li> <li> <p>\u793a\u4f8b\uff1a     <pre><code>object EventBus {\n    private val _events = MutableSharedFlow&lt;Event&gt;()\n    val events: SharedFlow&lt;Event&gt; = _events\n\n    suspend fun emitEvent(event: Event) {\n        _events.emit(event)\n    }\n}\n</code></pre></p> </li> <li> <p>\u5b9e\u65f6\u6570\u636e\u66f4\u65b0\uff1a</p> </li> <li>\u4f8b\u5982\u5b9e\u65f6\u66f4\u65b0\u7684\u4f20\u611f\u5668\u6570\u636e\u3001WebSocket \u6570\u636e\u7b49\u3002</li> <li> <p>\u793a\u4f8b\uff1a     <pre><code>fun observeSensorData(): SharedFlow&lt;SensorData&gt; {\n    return callbackFlow {\n        val sensorListener = object : SensorEventListener {\n            override fun onSensorChanged(event: SensorEvent) {\n                trySend(event.toSensorData())\n            }\n            override fun onAccuracyChanged(sensor: Sensor, accuracy: Int) {}\n        }\n        sensorManager.registerListener(sensorListener, sensor, SensorManager.SENSOR_DELAY_NORMAL)\n        awaitClose { sensorManager.unregisterListener(sensorListener) }\n    }.shareIn(viewModelScope, SharingStarted.WhileSubscribed(), replay = 1)\n}\n</code></pre></p> </li> <li> <p>\u591a\u6536\u96c6\u8005\u5171\u4eab\u6570\u636e\uff1a</p> </li> <li>\u4f8b\u5982\u591a\u4e2a UI \u7ec4\u4ef6\u5171\u4eab\u540c\u4e00\u4e2a\u6570\u636e\u6e90\u3002</li> <li>\u793a\u4f8b\uff1a     <pre><code>val sharedData: SharedFlow&lt;Data&gt; = flow {\n    emit(api.fetchData())\n}.shareIn(viewModelScope, SharingStarted.Eagerly, replay = 1)\n</code></pre></li> </ol>"},{"location":"040Jetpack/010Basic/#3-vs","title":"3. \u51b7\u6d41 vs \u70ed\u6d41\u7684\u5bf9\u6bd4","text":"\u7279\u6027 \u51b7\u6d41\uff08Cold Stream\uff09 \u70ed\u6d41\uff08Hot Stream\uff09 \u6570\u636e\u53d1\u5c04\u65f6\u673a \u6bcf\u6b21\u6536\u96c6\u65f6\u91cd\u65b0\u53d1\u5c04 \u65e0\u8bba\u662f\u5426\u6709\u6536\u96c6\u8005\uff0c\u90fd\u4f1a\u6301\u7eed\u53d1\u5c04 \u5171\u4eab\u72b6\u6001 \u6bcf\u4e2a\u6536\u96c6\u8005\u83b7\u5f97\u72ec\u7acb\u7684\u6570\u636e\u6d41 \u591a\u4e2a\u6536\u96c6\u8005\u5171\u4eab\u540c\u4e00\u4e2a\u6570\u636e\u6d41 \u751f\u547d\u5468\u671f \u968f\u6536\u96c6\u8005\u7684\u751f\u547d\u5468\u671f\u5f00\u59cb\u548c\u7ed3\u675f \u9700\u8981\u624b\u52a8\u7ba1\u7406\u751f\u547d\u5468\u671f \u9002\u7528\u573a\u666f \u4e00\u6b21\u6027\u6570\u636e\u3001\u6309\u9700\u52a0\u8f7d\u3001\u65e0\u5171\u4eab\u72b6\u6001\u7684\u573a\u666f \u72b6\u6001\u7ba1\u7406\u3001\u4e8b\u4ef6\u5e7f\u64ad\u3001\u5b9e\u65f6\u6570\u636e\u66f4\u65b0"},{"location":"040Jetpack/010Basic/#4_6","title":"4. \u603b\u7ed3","text":"<ul> <li>\u51b7\u6d41 \u9002\u7528\u4e8e\u9700\u8981\u6309\u9700\u52a0\u8f7d\u3001\u65e0\u5171\u4eab\u72b6\u6001\u7684\u573a\u666f\uff0c\u4f8b\u5982\u7f51\u7edc\u8bf7\u6c42\u3001\u6570\u636e\u5e93\u67e5\u8be2\u7b49\u3002</li> <li>\u70ed\u6d41 \u9002\u7528\u4e8e\u9700\u8981\u5171\u4eab\u72b6\u6001\u3001\u5b9e\u65f6\u66f4\u65b0\u6570\u636e\u7684\u573a\u666f\uff0c\u4f8b\u5982 UI \u72b6\u6001\u7ba1\u7406\u3001\u4e8b\u4ef6\u5e7f\u64ad\u7b49\u3002</li> </ul> <p>\u5728\u5b9e\u9645\u5f00\u53d1\u4e2d\uff0c\u53ef\u4ee5\u6839\u636e\u5177\u4f53\u9700\u6c42\u9009\u62e9\u51b7\u6d41\u6216\u70ed\u6d41\uff0c\u6216\u8005\u7ed3\u5408\u4e24\u8005\u4f7f\u7528\u3002\u4f8b\u5982\uff0c\u4f7f\u7528\u51b7\u6d41\u83b7\u53d6\u6570\u636e\u540e\uff0c\u5c06\u7ed3\u679c\u8f6c\u6362\u4e3a\u70ed\u6d41\uff08\u5982 <code>StateFlow</code> \u6216 <code>SharedFlow</code>\uff09\u4f9b\u591a\u4e2a UI \u7ec4\u4ef6\u5171\u4eab\u3002</p>"},{"location":"040Jetpack/010Basic/#android-viewbinding","title":"Android ViewBinding\u6e90\u7801\u89e3\u6790","text":"\u7b54\u6848 <p><code>ViewBinding</code> \u662f Android \u5f00\u53d1\u4e2d\u7528\u4e8e\u66ff\u4ee3 <code>findViewById</code> \u7684\u4e00\u79cd\u673a\u5236\uff0c\u5b83\u901a\u8fc7\u751f\u6210\u7ed1\u5b9a\u7c7b\u6765\u76f4\u63a5\u8bbf\u95ee\u5e03\u5c40\u6587\u4ef6\u4e2d\u7684\u89c6\u56fe\uff0c\u4ece\u800c\u907f\u514d\u4e86\u624b\u52a8\u8c03\u7528 <code>findViewById</code> \u7684\u7e41\u7410\u64cd\u4f5c\u3002\u4e0b\u9762\u662f\u5bf9 <code>ViewBinding</code> \u6e90\u7801\u7684\u89e3\u6790\uff0c\u5e2e\u52a9\u4f60\u7406\u89e3\u5176\u5de5\u4f5c\u539f\u7406\u3002</p>"},{"location":"040Jetpack/010Basic/#1-viewbinding","title":"1. ViewBinding \u7684\u57fa\u672c\u539f\u7406","text":"<p><code>ViewBinding</code> \u7684\u6838\u5fc3\u601d\u60f3\u662f\u901a\u8fc7\u7f16\u8bd1\u65f6\u751f\u6210\u7684\u7ed1\u5b9a\u7c7b\u6765\u76f4\u63a5\u5f15\u7528\u5e03\u5c40\u6587\u4ef6\u4e2d\u7684\u89c6\u56fe\u3002\u6bcf\u4e2a\u5e03\u5c40\u6587\u4ef6\u90fd\u4f1a\u751f\u6210\u4e00\u4e2a\u5bf9\u5e94\u7684\u7ed1\u5b9a\u7c7b\uff0c\u7c7b\u540d\u57fa\u4e8e\u5e03\u5c40\u6587\u4ef6\u7684\u540d\u79f0\u3002\u4f8b\u5982\uff0c<code>activity_main.xml</code> \u4f1a\u751f\u6210 <code>ActivityMainBinding</code> \u7c7b\u3002</p>"},{"location":"040Jetpack/010Basic/#2_6","title":"2. \u6e90\u7801\u89e3\u6790","text":""},{"location":"040Jetpack/010Basic/#21_1","title":"2.1 \u751f\u6210\u7ed1\u5b9a\u7c7b","text":"<p>\u5f53\u4f60\u5728 <code>build.gradle</code> \u4e2d\u542f\u7528 <code>ViewBinding</code> \u540e\uff0cAndroid Gradle \u63d2\u4ef6\u4f1a\u5728\u7f16\u8bd1\u65f6\u4e3a\u6bcf\u4e2a\u5e03\u5c40\u6587\u4ef6\u751f\u6210\u4e00\u4e2a\u7ed1\u5b9a\u7c7b\u3002\u8fd9\u4e2a\u7c7b\u7ee7\u627f\u81ea <code>ViewBinding</code> \u63a5\u53e3\uff0c\u5e76\u5305\u542b\u5e03\u5c40\u6587\u4ef6\u4e2d\u6240\u6709\u5e26\u6709 <code>id</code> \u7684\u89c6\u56fe\u7684\u5f15\u7528\u3002</p> <pre><code>android {\n    ...\n    viewBinding {\n        enabled = true\n    }\n}\n</code></pre> <p>\u751f\u6210\u7684\u7ed1\u5b9a\u7c7b\u901a\u5e38\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code>public final class ActivityMainBinding implements ViewBinding {\n    private final RelativeLayout rootView;\n    public final TextView textView;\n\n    private ActivityMainBinding(RelativeLayout rootView, TextView textView) {\n        this.rootView = rootView;\n        this.textView = textView;\n    }\n\n    @Override\n    public RelativeLayout getRoot() {\n        return rootView;\n    }\n\n    public static ActivityMainBinding inflate(LayoutInflater inflater) {\n        return inflate(inflater, null, false);\n    }\n\n    public static ActivityMainBinding inflate(LayoutInflater inflater, ViewGroup parent, boolean attachToParent) {\n        View root = inflater.inflate(R.layout.activity_main, parent, attachToParent);\n        return bind(root);\n    }\n\n    public static ActivityMainBinding bind(View rootView) {\n        TextView textView = rootView.findViewById(R.id.textView);\n        return new ActivityMainBinding((RelativeLayout) rootView, textView);\n    }\n}\n</code></pre>"},{"location":"040Jetpack/010Basic/#22_1","title":"2.2 \u7ed1\u5b9a\u7c7b\u7684\u7ed3\u6784","text":"<ul> <li>rootView: \u4ee3\u8868\u6574\u4e2a\u5e03\u5c40\u7684\u6839\u89c6\u56fe\u3002</li> <li>textView: \u5e03\u5c40\u6587\u4ef6\u4e2d\u5e26\u6709 <code>id</code> \u7684\u89c6\u56fe\u3002</li> <li>inflate(): \u7528\u4e8e\u4ece\u5e03\u5c40\u6587\u4ef6\u4e2d\u52a0\u8f7d\u89c6\u56fe\u5e76\u8fd4\u56de\u7ed1\u5b9a\u7c7b\u7684\u5b9e\u4f8b\u3002</li> <li>bind(): \u7528\u4e8e\u5c06\u5df2\u6709\u7684\u89c6\u56fe\u4e0e\u7ed1\u5b9a\u7c7b\u5173\u8054\u3002</li> </ul>"},{"location":"040Jetpack/010Basic/#23-viewbinding","title":"2.3 \u4f7f\u7528 ViewBinding","text":"<p>\u5728 Activity \u6216 Fragment \u4e2d\u4f7f\u7528 <code>ViewBinding</code> \u65f6\uff0c\u901a\u5e38\u4f1a\u5728 <code>onCreate()</code> \u6216 <code>onCreateView()</code> \u4e2d\u8c03\u7528 <code>inflate()</code> \u65b9\u6cd5\u6765\u52a0\u8f7d\u5e03\u5c40\u5e76\u83b7\u53d6\u7ed1\u5b9a\u7c7b\u7684\u5b9e\u4f8b\u3002</p> <pre><code>public class MainActivity extends AppCompatActivity {\n    private ActivityMainBinding binding;\n\n    @Override\n    protected void onCreate(Bundle savedInstanceState) {\n        super.onCreate(savedInstanceState);\n        binding = ActivityMainBinding.inflate(getLayoutInflater());\n        setContentView(binding.getRoot());\n\n        // \u4f7f\u7528 binding \u8bbf\u95ee\u89c6\u56fe\n        binding.textView.setText(\"Hello, ViewBinding!\");\n    }\n}\n</code></pre>"},{"location":"040Jetpack/010Basic/#24-viewbinding","title":"2.4 ViewBinding \u7684\u4f18\u52bf","text":"<ul> <li>\u7c7b\u578b\u5b89\u5168: \u7531\u4e8e\u89c6\u56fe\u5f15\u7528\u662f\u76f4\u63a5\u751f\u6210\u7684\uff0c\u56e0\u6b64\u4e0d\u4f1a\u51fa\u73b0\u7c7b\u578b\u8f6c\u6362\u9519\u8bef\u3002</li> <li>\u7a7a\u5b89\u5168: \u5982\u679c\u89c6\u56fe\u5728\u5e03\u5c40\u6587\u4ef6\u4e2d\u4e0d\u5b58\u5728\uff0c\u7f16\u8bd1\u65f6\u4f1a\u62a5\u9519\uff0c\u907f\u514d\u4e86\u8fd0\u884c\u65f6\u5f02\u5e38\u3002</li> <li>\u4ee3\u7801\u7b80\u6d01: \u4e0d\u518d\u9700\u8981\u624b\u52a8\u8c03\u7528 <code>findViewById</code>\uff0c\u51cf\u5c11\u4e86\u6837\u677f\u4ee3\u7801\u3002</li> </ul>"},{"location":"040Jetpack/010Basic/#3_4","title":"3. \u6e90\u7801\u751f\u6210\u8fc7\u7a0b","text":"<p><code>ViewBinding</code> \u7684\u751f\u6210\u8fc7\u7a0b\u662f\u7531 Android Gradle \u63d2\u4ef6\u5728\u7f16\u8bd1\u65f6\u5b8c\u6210\u7684\u3002\u5177\u4f53\u6b65\u9aa4\u5982\u4e0b\uff1a</p> <ol> <li>\u89e3\u6790\u5e03\u5c40\u6587\u4ef6: Gradle \u63d2\u4ef6\u4f1a\u89e3\u6790\u6240\u6709\u7684\u5e03\u5c40\u6587\u4ef6\uff0c\u5e76\u627e\u5230\u5e26\u6709 <code>id</code> \u7684\u89c6\u56fe\u3002</li> <li>\u751f\u6210\u7ed1\u5b9a\u7c7b: \u6839\u636e\u5e03\u5c40\u6587\u4ef6\u7684\u5185\u5bb9\uff0c\u751f\u6210\u5bf9\u5e94\u7684\u7ed1\u5b9a\u7c7b\u3002</li> <li>\u7f16\u8bd1\u7ed1\u5b9a\u7c7b: \u5c06\u751f\u6210\u7684\u7ed1\u5b9a\u7c7b\u7f16\u8bd1\u6210\u5b57\u8282\u7801\uff0c\u4f9b\u5e94\u7528\u7a0b\u5e8f\u4f7f\u7528\u3002</li> </ol>"},{"location":"040Jetpack/010Basic/#4_7","title":"4. \u603b\u7ed3","text":"<p><code>ViewBinding</code> \u901a\u8fc7\u7f16\u8bd1\u65f6\u751f\u6210\u7ed1\u5b9a\u7c7b\u7684\u65b9\u5f0f\uff0c\u7b80\u5316\u4e86\u89c6\u56fe\u5f15\u7528\u7684\u8fc7\u7a0b\uff0c\u63d0\u9ad8\u4e86\u4ee3\u7801\u7684\u5b89\u5168\u6027\u548c\u53ef\u8bfb\u6027\u3002\u5b83\u7684\u5b9e\u73b0\u4f9d\u8d56\u4e8e Android Gradle \u63d2\u4ef6\u5728\u7f16\u8bd1\u65f6\u7684\u4ee3\u7801\u751f\u6210\u80fd\u529b\uff0c\u751f\u6210\u7684\u7ed1\u5b9a\u7c7b\u76f4\u63a5\u5f15\u7528\u4e86\u5e03\u5c40\u6587\u4ef6\u4e2d\u7684\u89c6\u56fe\uff0c\u907f\u514d\u4e86\u624b\u52a8\u8c03\u7528 <code>findViewById</code> \u7684\u7e41\u7410\u64cd\u4f5c\u3002</p> <p>\u901a\u8fc7\u7406\u89e3 <code>ViewBinding</code> \u7684\u6e90\u7801\u751f\u6210\u8fc7\u7a0b\u548c\u4f7f\u7528\u65b9\u5f0f\uff0c\u4f60\u53ef\u4ee5\u66f4\u597d\u5730\u5229\u7528\u8fd9\u4e00\u673a\u5236\u6765\u63d0\u5347 Android \u5f00\u53d1\u7684\u6548\u7387\u3002</p>"},{"location":"040Jetpack/010Basic/#android-app-startup","title":"Android App Startup \u4f7f\u7528","text":"\u7b54\u6848 <p>https://juejin.cn/post/6898738809895125006</p> <p>\u5b9a\u4e49</p> <p>\u4e00\u4e2a\u53ef\u4ee5\u7528\u4e8e\u52a0\u901fApp\u542f\u52a8\u901f\u5ea6\u7684\u5e93\uff1b \u63d0\u4f9b\u5728 App \u542f\u52a8\u65f6\u521d\u59cb\u5316\u7ec4\u4ef6\u7b80\u5355\u3001\u9ad8\u6548\u7684\u65b9\u6cd5\uff0c\u53ef\u4ee5\u4f7f\u7528 App Startup \u663e\u793a\u7684\u8bbe\u7f6e\u521d\u59cb\u5316\u987a\u5e8f\uff1b \u63d0\u4f9b\u4e86\u4e00\u4e2a ContentProvider \u6765\u8fd0\u884c\u6240\u6709\u4f9d\u8d56\u9879\u7684\u521d\u59cb\u5316\uff0c\u907f\u514d\u6bcf\u4e2a\u7b2c\u4e09\u65b9\u5e93\u5355\u72ec\u4f7f\u7528 ContentProvider \u8fdb\u884c\u521d\u59cb\u5316\uff0c\u4ece\u800c\u63d0\u9ad8\u4e86\u5e94\u7528\u7684\u7a0b\u5e8f\u7684\u542f\u52a8\u901f\u5ea6\uff1b</p> <p>\u89e3\u51b3\u4e86\u4ec0\u4e48\u95ee\u9898</p> <p>\u5982\u679c\u4f60\u5728\u9879\u76ee\u5f53\u4e2d\u5f15\u5165\u4e86\u975e\u5e38\u591a\u7684\u7b2c\u4e09\u65b9\u5e93\uff0c\u90a3\u4e48Application\u4e2d\u7684\u4ee3\u7801\u5c31\u53ef\u80fd\u4f1a\u53d8\u6210\u8fd9\u4e2a\u6837\u5b50(\u8fd9\u8fd8\u53ea\u662f\u6211\u4eec\u5b9e\u9645\u9879\u76ee\u7684\u90e8\u5206\u4ee3\u7801)\uff1a</p> <p>scss \u4f53\u9a8cAI\u4ee3\u7801\u52a9\u624b \u4ee3\u7801\u89e3\u8bfb\u590d\u5236\u4ee3\u7801class MyApplication : Application() {     override fun onCreate() {         super.onCreate()         CommonModule.init(this);         XCrash.init(this, new XCrash.InitParameters());         initQbSdk(this);         initRetrofit();         initDialogSetting();         initBugly();         initWeChat();         initUmeng();         initDoKit();         initNIM();     }     ... }</p> <p>\u6709\u4e9b\u66f4\u52a0\u806a\u660e\u7684\u5e93\u8bbe\u8ba1\u8005\uff0c\u60f3\u5230\u53ef\u4ee5\u501f\u52a9ContentProvider\u81ea\u52a8\u8c03\u7528\u521d\u59cb\u5316\u63a5\u53e3\uff0c\u4ece\u800c\u907f\u514d\u663e\u793a\u7684\u521d\u59cb\u5316\uff1a</p> <p>kotlin \u4f53\u9a8cAI\u4ee3\u7801\u52a9\u624b \u4ee3\u7801\u89e3\u8bfb\u590d\u5236\u4ee3\u7801//1. \u7ee7\u627f ContentProvider\uff0c\u5728onCreate\u4e2d\u521d\u59cb\u5316 class MyProvider : ContentProvider() {     override fun onCreate(): Boolean {         context?.let {             //ContentProvider\u4e2d\u4e5f\u53ef\u4ee5\u53d6\u5f97Context             LjyToastUtil.getInstance().init(it)         }         return true     }     //\u5176\u4ed6\u65b9\u6cd5\u7528\u4e0d\u5230\uff0c\u76f4\u63a5return null \u6216 return -1 \u5373\u53ef     ... }</p> <p>//2. ContentProvider\u662f\u56db\u5927\u7ec4\u4ef6\u4e4b\u4e00\uff0c\u9700\u8981\u5728AndroidManifest.xml\u6587\u4ef6\u4e2d\u8fdb\u884c\u6ce8\u518c      ...      </p> <p>//3. \u81ea\u5b9a\u4e49\u7684MyProvider\u5728\u4ec0\u4e48\u65f6\u5019\u6267\u884c\u5462? \u8c03\u7528\u6d41\u7a0b\u5982\u4e0b\uff1a Application.attachBaseContext() -&gt; ContentProvider.onCreate() -&gt; Application.onCreate() //\u8fd9\u662f\u5728\u51b7\u542f\u52a8\u9636\u6bb5\u81ea\u52a8\u8fd0\u884c\u521d\u59cb\u5316\u7684\uff0c\u6765\u770b\u4e00\u4e0b Android 10 \u7cfb\u7edf\u6e90\u7801 private void handleBindApplication(AppBindData data) { ... if (!data.restrictedBackupMode) {         if (!ArrayUtils.isEmpty(data.providers)) {         // \u521b\u5efaContentProvider             installContentProviders(app, data.providers);         }     } ...     try {         // \u8c03\u7528\u8c03\u7528 Application \u7684 OnCreate \u65b9\u6cd5         mInstrumentation.callApplicationOnCreate(app);     } catch (Exception e) {         ...     }     ... }</p> <p>\u6b64\u65b9\u6848\u7684\u7f3a\u70b9\uff1aContentProvider\u4f1a\u589e\u52a0\u8bb8\u591a\u989d\u5916\u7684\u8017\u65f6, ContentProvider\u662fAndroid\u56db\u5927\u7ec4\u4ef6\u4e4b\u4e00\uff0c\u8fd9\u4e2a\u7ec4\u4ef6\u76f8\u5bf9\u6765\u8bf4\u662f\u6bd4\u8f83\u91cd\u91cf\u7ea7\u7684, \u4e5f\u5c31\u662f\u8bf4\uff0c\u672c\u6765\u6211\u7684\u521d\u59cb\u5316\u64cd\u4f5c\u53ef\u80fd\u662f\u4e00\u4e2a\u975e\u5e38\u8f7b\u91cf\u7ea7\u7684\u64cd\u4f5c\uff0c\u4f9d\u8d56\u4e8eContentProvider\u4e4b\u540e\u5c31\u53d8\u6210\u4e86\u4e00\u4e2a\u91cd\u91cf\u7ea7\u7684\u64cd\u4f5c\u4e86;</p> <p>\u5982\u4f55\u89e3\u51b3\u95ee\u9898</p> <p>\u9274\u4e8e\u524d\u4e24\u8005\u7684\u7f3a\u70b9\uff0cGoogle\u63a8\u51fa\u4e86App Startup App Startup\u662f\u5982\u4f55\u89e3\u51b3\u95ee\u9898\u7684\u5462\uff1f\u5b83\u53ef\u4ee5\u5c06\u6240\u6709\u7528\u4e8e\u521d\u59cb\u5316\u7684ContentProvider\u5408\u5e76\u6210\u4e00\u4e2a\uff0c\u4ece\u800c\u4f7fApp\u7684\u542f\u52a8\u901f\u5ea6\u53d8\u5f97\u66f4\u5feb\u3002</p> <p>\u4f7f\u7528\u65b9\u6cd5 1. \u5f15\u5165AppStartup\u4f9d\u8d56 arduino \u4f53\u9a8cAI\u4ee3\u7801\u52a9\u624b \u4ee3\u7801\u89e3\u8bfb\u590d\u5236\u4ee3\u7801implementation \"androidx.startup:startup-runtime:1.1.0-alpha01\"</p> <ol> <li> <p>\u5b9a\u4e49\u4e00\u4e2a\u7528\u4e8e\u6267\u884c\u521d\u59cb\u5316\u7684\u7c7b\uff0c\u5e76\u5b9e\u73b0App Startup\u5e93\u7684Initializer\u63a5\u53e3 kotlin \u4f53\u9a8cAI\u4ee3\u7801\u52a9\u624b \u4ee3\u7801\u89e3\u8bfb\u590d\u5236\u4ee3\u7801class LjyToastInitializer : Initializer {     //\u5728create\u65b9\u6cd5\u4e2d\u6267\u884c\u8981\u521d\u59cb\u5316\u7684\u4ee3\u7801     override fun create(context: Context) {         LjyToastUtil.getInstance().init(context)     } <p>//dependencies\u65b9\u6cd5\u7528\u4e8e\u914d\u7f6e\u5f53\u524dLjyToastInitializer\u662f\u5426\u8fd8\u4f9d\u8d56\u4e8e\u5176\u4ed6Initializer //\u6709\u7684\u8bdd\u5728\u6b64\u914d\u7f6e\uff0c\u6ca1\u6709\u5c31return emptyList()\u5373\u53ef override fun dependencies(): List&lt;Class&lt;out Initializer&lt;*&gt;&gt;&gt; {     return emptyList() }</p> <p>}</p> <ol> <li>\u5728\u5e93\u7684AndroidManifest.xml\u4e2d\u914d\u7f6eMyInitializer ini \u4f53\u9a8cAI\u4ee3\u7801\u52a9\u624b \u4ee3\u7801\u89e3\u8bfb\u590d\u5236\u4ee3\u7801 </li> </ol> <p>\u5f53App\u542f\u52a8\u7684\u65f6\u5019\u4f1a\u81ea\u52a8\u6267\u884cApp Startup\u5e93\u4e2d\u5185\u7f6e\u7684ContentProvider\uff0c\u5e76\u5728\u5b83\u7684ContentProvider\u4e2d\u4f1a\u641c\u5bfb\u6240\u6709\u6ce8\u518c\u7684Initializer\uff0c\u7136\u540e\u9010\u4e2a\u8c03\u7528\u5b83\u4eec\u7684create()\u65b9\u6cd5\u6765\u8fdb\u884c\u521d\u59cb\u5316\u64cd\u4f5c;</p> <p>\u5ef6\u8fdf\u521d\u59cb\u5316</p> <p>\u5982\u679c\u4e0d\u5e0c\u671b\u5728\u542f\u52a8\u7684\u65f6\u5019\u81ea\u52a8\u521d\u59cb\u5316\u67d0\u4e2a\u5e93\uff0c\u800c\u662f\u60f3\u8981\u5728\u7279\u5b9a\u7684\u65f6\u673a\u624b\u52a8\u521d\u59cb\u5316\uff0c\u8fd9\u8981\u600e\u4e48\u529e\u5462\uff1f \u9996\u5148\u901a\u8fc7\u5206\u6790\u6e90\u7801\uff0c\u627e\u5230\u8be5\u5e93\u521d\u59cb\u5316\u7684Initializer\u7684\u5168\u8def\u5f84\u7c7b\u540d \u5728\u9879\u76ee\u7684AndroidManifest.xml\u5f53\u4e2d\u52a0\u5165\u5982\u4e0b\u914d\u7f6e:</p> <p>ini \u4f53\u9a8cAI\u4ee3\u7801\u52a9\u624b \u4ee3\u7801\u89e3\u8bfb\u590d\u5236\u4ee3\u7801 </p> <p>\u7981\u7528\u5355\u4e2a\u5e93\u5c31\u5728meta-data\u4e2d\u52a0\u5165tools:node=\"remove\"</p> <p>\u7981\u7528\u6240\u6709\u5e93\u5c31\u662f\u5728provider\u6807\u7b7e\u4e2d\u52a0\u5165tools:node=\"remove\"</p> <p>\u7136\u540e\u5728\u9700\u8981\u7684\u5730\u65b9\u53bb\u624b\u52a8\u7684\u521d\u59cb\u5316</p> <p>kotlin \u4f53\u9a8cAI\u4ee3\u7801\u52a9\u624b \u4ee3\u7801\u89e3\u8bfb\u590d\u5236\u4ee3\u7801AppInitializer.getInstance(this)         .initializeComponent(LjyToastInitializer::class.java)</p> <p>\u5ef6\u8fdf\u521d\u59cb\u5316\u4e5f\u662f\u975e\u5e38\u6709\u7528\u7684\uff0c\u53ef\u4ee5\u51cf\u5c11 App \u7684\u542f\u52a8\u65f6\u95f4\uff0c\u63d0\u9ad8\u542f\u52a8\u901f\u5ea6\u3002</p> <p>\u4f5c\u8005\uff1a\u4eca\u9633 \u94fe\u63a5\uff1ahttps://juejin.cn/post/6997338065375068191 \u6765\u6e90\uff1a\u7a00\u571f\u6398\u91d1 \u8457\u4f5c\u6743\u5f52\u4f5c\u8005\u6240\u6709\u3002\u5546\u4e1a\u8f6c\u8f7d\u8bf7\u8054\u7cfb\u4f5c\u8005\u83b7\u5f97\u6388\u6743\uff0c\u975e\u5546\u4e1a\u8f6c\u8f7d\u8bf7\u6ce8\u660e\u51fa\u5904\u3002</p>"},{"location":"040Jetpack/010Basic/#android-app-startup_1","title":"Android App Startup\u6e90\u7801\u89e3\u6790","text":"\u7b54\u6848 <p>https://juejin.cn/post/6898738809895125006 <code>App Startup</code> \u662f Android Jetpack \u4e2d\u7684\u4e00\u4e2a\u5e93\uff0c\u65e8\u5728\u7b80\u5316\u548c\u4f18\u5316\u5e94\u7528\u7a0b\u5e8f\u542f\u52a8\u65f6\u7ec4\u4ef6\u521d\u59cb\u5316\u7684\u8fc7\u7a0b\u3002\u901a\u8fc7 <code>App Startup</code>\uff0c\u5f00\u53d1\u8005\u53ef\u4ee5\u5c06\u521d\u59cb\u5316\u903b\u8f91\u96c6\u4e2d\u7ba1\u7406\uff0c\u907f\u514d\u5728 <code>Application</code> \u7c7b\u7684 <code>onCreate()</code> \u65b9\u6cd5\u4e2d\u76f4\u63a5\u521d\u59cb\u5316\u6240\u6709\u7ec4\u4ef6\uff0c\u4ece\u800c\u51cf\u5c11\u542f\u52a8\u65f6\u95f4\u5e76\u63d0\u9ad8\u6027\u80fd\u3002</p>"},{"location":"040Jetpack/010Basic/#_64","title":"\u6838\u5fc3\u6982\u5ff5","text":"<ol> <li>Initializer: \u7528\u4e8e\u5b9a\u4e49\u7ec4\u4ef6\u521d\u59cb\u5316\u903b\u8f91\u7684\u63a5\u53e3\u3002\u6bcf\u4e2a\u9700\u8981\u521d\u59cb\u5316\u7684\u7ec4\u4ef6\u90fd\u9700\u8981\u5b9e\u73b0 <code>Initializer</code> \u63a5\u53e3\u3002</li> <li>AppInitializer: \u8d1f\u8d23\u7ba1\u7406\u548c\u6267\u884c\u6240\u6709 <code>Initializer</code> \u7684\u7c7b\u3002\u5b83\u4f1a\u6839\u636e\u4f9d\u8d56\u5173\u7cfb\u6309\u987a\u5e8f\u521d\u59cb\u5316\u7ec4\u4ef6\u3002</li> <li>Manifest \u914d\u7f6e: \u901a\u8fc7\u5728 <code>AndroidManifest.xml</code> \u4e2d\u914d\u7f6e <code>Initializer</code>\uff0c<code>App Startup</code> \u53ef\u4ee5\u81ea\u52a8\u53d1\u73b0\u5e76\u521d\u59cb\u5316\u7ec4\u4ef6\u3002</li> </ol>"},{"location":"040Jetpack/010Basic/#_65","title":"\u6e90\u7801\u89e3\u6790","text":""},{"location":"040Jetpack/010Basic/#1-initializer","title":"1. Initializer \u63a5\u53e3","text":"<p><code>Initializer</code> \u662f\u4e00\u4e2a\u6cdb\u578b\u63a5\u53e3\uff0c\u5b9a\u4e49\u4e86\u7ec4\u4ef6\u521d\u59cb\u5316\u7684\u903b\u8f91\u3002\u5b83\u6709\u4e24\u4e2a\u65b9\u6cd5\uff1a</p> <ul> <li><code>create(context: Context): T</code>: \u7528\u4e8e\u521b\u5efa\u5e76\u521d\u59cb\u5316\u7ec4\u4ef6\u3002</li> <li><code>dependencies(): List&lt;Class&lt;out Initializer&lt;*&gt;&gt;&gt;</code>: \u7528\u4e8e\u5b9a\u4e49\u5f53\u524d <code>Initializer</code> \u4f9d\u8d56\u7684\u5176\u4ed6 <code>Initializer</code>\u3002</li> </ul> <pre><code>interface Initializer&lt;T&gt; {\n    fun create(context: Context): T\n    fun dependencies(): List&lt;Class&lt;out Initializer&lt;*&gt;&gt;&gt;\n}\n</code></pre>"},{"location":"040Jetpack/010Basic/#2-appinitializer","title":"2. AppInitializer \u7c7b","text":"<p><code>AppInitializer</code> \u662f <code>App Startup</code> \u7684\u6838\u5fc3\u7c7b\uff0c\u8d1f\u8d23\u7ba1\u7406\u548c\u6267\u884c\u6240\u6709 <code>Initializer</code>\u3002\u5b83\u901a\u8fc7 <code>discoverAndInitialize()</code> \u65b9\u6cd5\u81ea\u52a8\u53d1\u73b0\u5e76\u521d\u59cb\u5316\u6240\u6709\u914d\u7f6e\u7684 <code>Initializer</code>\u3002</p> <pre><code>class AppInitializer private constructor(\n    private val context: Context,\n    private val initializers: Map&lt;Class&lt;*&gt;, Initializer&lt;*&gt;&gt;\n) {\n    companion object {\n        @JvmStatic\n        fun getInstance(context: Context): AppInitializer {\n            return AppInitializer(context, discoverInitializers(context))\n        }\n\n        private fun discoverInitializers(context: Context): Map&lt;Class&lt;*&gt;, Initializer&lt;*&gt;&gt; {\n            // \u901a\u8fc7\u53cd\u5c04\u6216 Manifest \u914d\u7f6e\u53d1\u73b0\u6240\u6709 Initializer\n            // \u5e76\u8fd4\u56de\u4e00\u4e2a Map&lt;Class&lt;*&gt;, Initializer&lt;*&gt;&gt;\n        }\n    }\n\n    fun initializeComponent(component: Class&lt;out Initializer&lt;*&gt;&gt;) {\n        // \u521d\u59cb\u5316\u6307\u5b9a\u7684\u7ec4\u4ef6\n    }\n\n    fun initializeAllComponents() {\n        // \u521d\u59cb\u5316\u6240\u6709\u7ec4\u4ef6\n    }\n}\n</code></pre>"},{"location":"040Jetpack/010Basic/#3-manifest","title":"3. Manifest \u914d\u7f6e","text":"<p>\u5728 <code>AndroidManifest.xml</code> \u4e2d\uff0c\u53ef\u4ee5\u901a\u8fc7 <code>&lt;meta-data&gt;</code> \u6807\u7b7e\u914d\u7f6e <code>Initializer</code>\u3002<code>App Startup</code> \u4f1a\u81ea\u52a8\u53d1\u73b0\u8fd9\u4e9b\u914d\u7f6e\u5e76\u521d\u59cb\u5316\u76f8\u5e94\u7684\u7ec4\u4ef6\u3002</p> <pre><code>&lt;application&gt;\n    &lt;provider\n        android:name=\"androidx.startup.InitializationProvider\"\n        android:authorities=\"${applicationId}.androidx-startup\"\n        android:exported=\"false\"&gt;\n        &lt;meta-data\n            android:name=\"com.example.MyInitializer\"\n            android:value=\"androidx.startup\" /&gt;\n    &lt;/provider&gt;\n&lt;/application&gt;\n</code></pre>"},{"location":"040Jetpack/010Basic/#4-initializationprovider","title":"4. InitializationProvider","text":"<p><code>InitializationProvider</code> \u662f\u4e00\u4e2a <code>ContentProvider</code>\uff0c\u5b83\u5728\u5e94\u7528\u7a0b\u5e8f\u542f\u52a8\u65f6\u81ea\u52a8\u521d\u59cb\u5316 <code>AppInitializer</code> \u5e76\u6267\u884c\u6240\u6709 <code>Initializer</code>\u3002</p> <pre><code>class InitializationProvider : ContentProvider() {\n    override fun onCreate(): Boolean {\n        val context = context ?: return false\n        AppInitializer.getInstance(context).initializeAllComponents()\n        return true\n    }\n\n    // \u5176\u4ed6 ContentProvider \u65b9\u6cd5...\n}\n</code></pre>"},{"location":"040Jetpack/010Basic/#_66","title":"\u4f7f\u7528\u793a\u4f8b","text":"<p>\u5047\u8bbe\u6211\u4eec\u6709\u4e00\u4e2a <code>Logger</code> \u7ec4\u4ef6\u9700\u8981\u5728\u5e94\u7528\u542f\u52a8\u65f6\u521d\u59cb\u5316\uff1a</p> <ol> <li>\u521b\u5efa <code>LoggerInitializer</code> \u5b9e\u73b0 <code>Initializer</code> \u63a5\u53e3\uff1a</li> </ol> <pre><code>class LoggerInitializer : Initializer&lt;Logger&gt; {\n    override fun create(context: Context): Logger {\n        return Logger.initialize(context)\n    }\n\n    override fun dependencies(): List&lt;Class&lt;out Initializer&lt;*&gt;&gt;&gt; {\n        return emptyList() // \u6ca1\u6709\u4f9d\u8d56\n    }\n}\n</code></pre> <ol> <li>\u5728 <code>AndroidManifest.xml</code> \u4e2d\u914d\u7f6e <code>LoggerInitializer</code>\uff1a</li> </ol> <pre><code>&lt;application&gt;\n    &lt;provider\n        android:name=\"androidx.startup.InitializationProvider\"\n        android:authorities=\"${applicationId}.androidx-startup\"\n        android:exported=\"false\"&gt;\n        &lt;meta-data\n            android:name=\"com.example.LoggerInitializer\"\n            android:value=\"androidx.startup\" /&gt;\n    &lt;/provider&gt;\n&lt;/application&gt;\n</code></pre> <ol> <li>\u5f53\u5e94\u7528\u542f\u52a8\u65f6\uff0c<code>App Startup</code> \u4f1a\u81ea\u52a8\u521d\u59cb\u5316 <code>Logger</code> \u7ec4\u4ef6\u3002</li> </ol>"},{"location":"040Jetpack/010Basic/#_67","title":"\u603b\u7ed3","text":"<p><code>App Startup</code> \u901a\u8fc7\u63d0\u4f9b\u4e00\u79cd\u96c6\u4e2d\u7ba1\u7406\u548c\u4f18\u5316\u7ec4\u4ef6\u521d\u59cb\u5316\u7684\u65b9\u5f0f\uff0c\u5e2e\u52a9\u5f00\u53d1\u8005\u51cf\u5c11\u5e94\u7528\u542f\u52a8\u65f6\u95f4\u5e76\u63d0\u9ad8\u6027\u80fd\u3002\u901a\u8fc7\u5b9e\u73b0 <code>Initializer</code> \u63a5\u53e3\u5e76\u5728 <code>AndroidManifest.xml</code> \u4e2d\u914d\u7f6e\uff0c\u5f00\u53d1\u8005\u53ef\u4ee5\u8f7b\u677e\u5730\u5c06\u521d\u59cb\u5316\u903b\u8f91\u4ece <code>Application</code> \u7c7b\u4e2d\u89e3\u8026\u51fa\u6765\u3002</p>"},{"location":"040Jetpack/010Basic/#startupcontentprovider-sdk","title":"startup\u80fd\u5426\u76f4\u63a5\u7ba1\u7406ContentProvider SDK\u7684\u542f\u52a8\u987a\u5e8f\uff1f","text":"\u7b54\u6848 <p><code>App Startup</code> \u672c\u8eab\u5e76\u4e0d\u80fd\u76f4\u63a5\u7ba1\u7406\u901a\u8fc7 <code>ContentProvider</code> \u521d\u59cb\u5316\u7684 SDK \u7684\u542f\u52a8\u987a\u5e8f\uff0c\u56e0\u4e3a <code>ContentProvider</code> \u7684\u521d\u59cb\u5316\u662f\u7531 Android \u7cfb\u7edf\u63a7\u5236\u7684\uff0c\u800c\u4e0d\u662f\u7531 <code>App Startup</code> \u63a7\u5236\u7684\u3002\u7136\u800c\uff0c<code>App Startup</code> \u63d0\u4f9b\u4e86\u4e00\u79cd\u95f4\u63a5\u7684\u65b9\u5f0f\u6765\u4f18\u5316\u548c\u7ba1\u7406\u521d\u59cb\u5316\u987a\u5e8f\uff0c\u5c24\u5176\u662f\u5f53\u4f60\u80fd\u591f\u5c06\u90e8\u5206\u521d\u59cb\u5316\u903b\u8f91\u8fc1\u79fb\u5230 <code>Initializer</code> \u4e2d\u65f6\u3002</p> <p>\u4ee5\u4e0b\u662f\u4e00\u4e9b\u53ef\u80fd\u7684\u89e3\u51b3\u65b9\u6848\u548c\u7b56\u7565\uff1a</p>"},{"location":"040Jetpack/010Basic/#1-sdk-initializer","title":"1. \u5c06\u90e8\u5206 SDK \u7684\u521d\u59cb\u5316\u8fc1\u79fb\u5230 Initializer","text":"<p>\u5982\u679c\u67d0\u4e9b SDK \u7684\u521d\u59cb\u5316\u903b\u8f91\u53ef\u4ee5\u901a\u8fc7 <code>Initializer</code> \u5b9e\u73b0\uff0c\u90a3\u4e48\u4f60\u53ef\u4ee5\u5c06\u8fd9\u4e9b SDK \u7684\u521d\u59cb\u5316\u4ece <code>ContentProvider</code> \u8fc1\u79fb\u5230 <code>Initializer</code> \u4e2d\u3002\u8fd9\u6837\uff0c\u4f60\u5c31\u53ef\u4ee5\u901a\u8fc7 <code>App Startup</code> \u7684\u4f9d\u8d56\u673a\u5236\u6765\u7ba1\u7406\u5b83\u4eec\u7684\u521d\u59cb\u5316\u987a\u5e8f\u3002</p>"},{"location":"040Jetpack/010Basic/#_68","title":"\u793a\u4f8b\uff1a","text":"<p>\u5047\u8bbe\u6709\u4e24\u4e2a SDK\uff1a<code>SDK A</code> \u548c <code>SDK B</code>\uff0c\u4f60\u5e0c\u671b <code>SDK A</code> \u5728 <code>SDK B</code> \u4e4b\u524d\u521d\u59cb\u5316\u3002</p> <ol> <li>\u4e3a <code>SDK A</code> \u548c <code>SDK B</code> \u521b\u5efa <code>Initializer</code>\uff1a</li> </ol> <pre><code>class SDKAInitializer : Initializer&lt;Unit&gt; {\n    override fun create(context: Context) {\n        SDKA.initialize(context)\n    }\n\n    override fun dependencies(): List&lt;Class&lt;out Initializer&lt;*&gt;&gt;&gt; {\n        return emptyList() // SDK A \u6ca1\u6709\u4f9d\u8d56\n    }\n}\n\nclass SDKBInitializer : Initializer&lt;Unit&gt; {\n    override fun create(context: Context) {\n        SDKB.initialize(context)\n    }\n\n    override fun dependencies(): List&lt;Class&lt;out Initializer&lt;*&gt;&gt;&gt; {\n        return listOf(SDKAInitializer::class.java) // SDK B \u4f9d\u8d56 SDK A\n    }\n}\n</code></pre> <ol> <li>\u5728 <code>AndroidManifest.xml</code> \u4e2d\u914d\u7f6e <code>Initializer</code>\uff1a</li> </ol> <pre><code>&lt;application&gt;\n    &lt;provider\n        android:name=\"androidx.startup.InitializationProvider\"\n        android:authorities=\"${applicationId}.androidx-startup\"\n        android:exported=\"false\"&gt;\n        &lt;meta-data\n            android:name=\"com.example.SDKAInitializer\"\n            android:value=\"androidx.startup\" /&gt;\n        &lt;meta-data\n            android:name=\"com.example.SDKBInitializer\"\n            android:value=\"androidx.startup\" /&gt;\n    &lt;/provider&gt;\n&lt;/application&gt;\n</code></pre> <p>\u901a\u8fc7\u8fd9\u79cd\u65b9\u5f0f\uff0c<code>SDK A</code> \u4f1a\u5728 <code>SDK B</code> \u4e4b\u524d\u521d\u59cb\u5316\u3002</p>"},{"location":"040Jetpack/010Basic/#2-sdk","title":"2. \u5ef6\u8fdf\u521d\u59cb\u5316\u65e0\u6cd5\u8fc1\u79fb\u7684 SDK","text":"<p>\u5bf9\u4e8e\u65e0\u6cd5\u8fc1\u79fb\u5230 <code>Initializer</code> \u7684 SDK\uff08\u5373\u4ecd\u7136\u901a\u8fc7 <code>ContentProvider</code> \u521d\u59cb\u5316\u7684 SDK\uff09\uff0c\u4f60\u53ef\u4ee5\u5c1d\u8bd5\u4ee5\u4e0b\u65b9\u6cd5\uff1a</p>"},{"location":"040Jetpack/010Basic/#1_4","title":"\u65b9\u6cd5 1\uff1a\u7981\u7528\u81ea\u52a8\u521d\u59cb\u5316\u5e76\u624b\u52a8\u521d\u59cb\u5316","text":"<p>\u5982\u679c SDK \u5141\u8bb8\u7981\u7528\u5176 <code>ContentProvider</code> \u7684\u81ea\u52a8\u521d\u59cb\u5316\uff08\u4f8b\u5982\u901a\u8fc7 <code>tools:node=\"remove\"</code>\uff09\uff0c\u4f60\u53ef\u4ee5\u7981\u7528\u81ea\u52a8\u521d\u59cb\u5316\uff0c\u7136\u540e\u5728\u5408\u9002\u7684\u65f6\u673a\u624b\u52a8\u521d\u59cb\u5316\u3002</p> <ol> <li>\u5728 <code>AndroidManifest.xml</code> \u4e2d\u7981\u7528 SDK \u7684 <code>ContentProvider</code>\uff1a</li> </ol> <pre><code>&lt;application&gt;\n    &lt;provider\n        android:name=\"com.example.sdk.SDKInitializerProvider\"\n        android:authorities=\"${applicationId}.sdkinit\"\n        android:exported=\"false\"\n        tools:node=\"remove\" /&gt;\n&lt;/application&gt;\n</code></pre> <ol> <li>\u5728\u5408\u9002\u7684\u65f6\u673a\u624b\u52a8\u521d\u59cb\u5316 SDK\uff1a</li> </ol> <pre><code>class MyApplication : Application() {\n    override fun onCreate() {\n        super.onCreate()\n        // \u624b\u52a8\u521d\u59cb\u5316 SDK\n        SDK.initialize(this)\n    }\n}\n</code></pre>"},{"location":"040Jetpack/010Basic/#2_7","title":"\u65b9\u6cd5 2\uff1a\u4f7f\u7528\u53cd\u5c04\u6216\u5de5\u5177\u7c7b\u63a7\u5236\u521d\u59cb\u5316\u987a\u5e8f","text":"<p>\u5982\u679c SDK \u7684 <code>ContentProvider</code> \u65e0\u6cd5\u7981\u7528\uff0c\u4f60\u53ef\u4ee5\u5c1d\u8bd5\u901a\u8fc7\u53cd\u5c04\u6216\u5176\u4ed6\u5de5\u5177\u7c7b\u5728 <code>Application</code> \u7684 <code>onCreate()</code> \u65b9\u6cd5\u4e2d\u63a7\u5236\u521d\u59cb\u5316\u987a\u5e8f\u3002</p> <p>\u4f8b\u5982\uff1a</p> <pre><code>class MyApplication : Application() {\n    override fun onCreate() {\n        super.onCreate()\n\n        // \u624b\u52a8\u89e6\u53d1 SDK \u7684\u521d\u59cb\u5316\n        val sdkProvider = Class.forName(\"com.example.sdk.SDKInitializerProvider\")\n        val providerInstance = sdkProvider.getDeclaredConstructor().newInstance() as ContentProvider\n        providerInstance.onCreate()\n    }\n}\n</code></pre> <p>\u8fd9\u79cd\u65b9\u6cd5\u9700\u8981\u8c28\u614e\u4f7f\u7528\uff0c\u56e0\u4e3a\u5b83\u4f9d\u8d56\u4e8e SDK \u7684\u5185\u90e8\u5b9e\u73b0\uff0c\u53ef\u80fd\u4f1a\u5bfc\u81f4\u517c\u5bb9\u6027\u95ee\u9898\u3002</p>"},{"location":"040Jetpack/010Basic/#3-app-startup-contentprovider","title":"3. \u7ed3\u5408 App Startup \u548c ContentProvider \u521d\u59cb\u5316","text":"<p>\u5982\u679c\u67d0\u4e9b SDK \u5fc5\u987b\u901a\u8fc7 <code>ContentProvider</code> \u521d\u59cb\u5316\uff0c\u800c\u53e6\u4e00\u4e9b SDK \u53ef\u4ee5\u901a\u8fc7 <code>Initializer</code> \u521d\u59cb\u5316\uff0c\u4f60\u53ef\u4ee5\u7ed3\u5408\u4f7f\u7528 <code>App Startup</code> \u548c <code>ContentProvider</code> \u6765\u4f18\u5316\u521d\u59cb\u5316\u987a\u5e8f\u3002</p>"},{"location":"040Jetpack/010Basic/#_69","title":"\u793a\u4f8b\uff1a","text":"<ol> <li>\u5c06\u53ef\u4ee5\u901a\u8fc7 <code>Initializer</code> \u521d\u59cb\u5316\u7684 SDK \u8fc1\u79fb\u5230 <code>App Startup</code>\u3002</li> <li>\u5bf9\u4e8e\u5fc5\u987b\u901a\u8fc7 <code>ContentProvider</code> \u521d\u59cb\u5316\u7684 SDK\uff0c\u786e\u4fdd\u5b83\u4eec\u7684\u521d\u59cb\u5316\u903b\u8f91\u5c3d\u53ef\u80fd\u8f7b\u91cf\uff0c\u5e76\u5728 <code>Application</code> \u7684 <code>onCreate()</code> \u65b9\u6cd5\u4e2d\u624b\u52a8\u89e6\u53d1\u5b83\u4eec\u7684\u521d\u59cb\u5316\u3002</li> </ol> <pre><code>class MyApplication : Application() {\n    override fun onCreate() {\n        super.onCreate()\n\n        // \u624b\u52a8\u89e6\u53d1\u5fc5\u987b\u901a\u8fc7 ContentProvider \u521d\u59cb\u5316\u7684 SDK\n        val sdkProvider = Class.forName(\"com.example.sdk.SDKInitializerProvider\")\n        val providerInstance = sdkProvider.getDeclaredConstructor().newInstance() as ContentProvider\n        providerInstance.onCreate()\n\n        // \u521d\u59cb\u5316 App Startup \u7ba1\u7406\u7684 SDK\n        AppInitializer.getInstance(this).initializeAllComponents()\n    }\n}\n</code></pre>"},{"location":"040Jetpack/010Basic/#4-sdk","title":"4. \u4e0e SDK \u63d0\u4f9b\u8005\u6c9f\u901a","text":"<p>\u5982\u679c\u67d0\u4e9b SDK \u7684\u521d\u59cb\u5316\u987a\u5e8f\u5bf9\u4f60\u7684\u5e94\u7528\u81f3\u5173\u91cd\u8981\uff0c\u5efa\u8bae\u4e0e SDK \u63d0\u4f9b\u8005\u6c9f\u901a\uff0c\u770b\u770b\u662f\u5426\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u65b9\u5f0f\u4f18\u5316\uff1a - \u63d0\u4f9b\u7981\u7528 <code>ContentProvider</code> \u81ea\u52a8\u521d\u59cb\u5316\u7684\u9009\u9879\u3002 - \u63d0\u4f9b\u624b\u52a8\u521d\u59cb\u5316\u7684 API\u3002 - \u63d0\u4f9b\u4f9d\u8d56\u7ba1\u7406\u673a\u5236\uff0c\u5141\u8bb8\u4f60\u6307\u5b9a\u521d\u59cb\u5316\u987a\u5e8f\u3002</p>"},{"location":"040Jetpack/010Basic/#_70","title":"\u603b\u7ed3","text":"<p><code>App Startup</code> \u672c\u8eab\u65e0\u6cd5\u76f4\u63a5\u7ba1\u7406\u901a\u8fc7 <code>ContentProvider</code> \u521d\u59cb\u5316\u7684 SDK \u7684\u987a\u5e8f\uff0c\u4f46\u4f60\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u65b9\u5f0f\u95f4\u63a5\u4f18\u5316\uff1a 1. \u5c06\u90e8\u5206 SDK \u7684\u521d\u59cb\u5316\u8fc1\u79fb\u5230 <code>Initializer</code>\uff0c\u5e76\u901a\u8fc7\u4f9d\u8d56\u673a\u5236\u7ba1\u7406\u987a\u5e8f\u3002 2. \u5bf9\u4e8e\u65e0\u6cd5\u8fc1\u79fb\u7684 SDK\uff0c\u5c1d\u8bd5\u7981\u7528\u81ea\u52a8\u521d\u59cb\u5316\u5e76\u624b\u52a8\u63a7\u5236\u521d\u59cb\u5316\u65f6\u673a\u3002 3. \u7ed3\u5408 <code>App Startup</code> \u548c <code>ContentProvider</code> \u521d\u59cb\u5316\uff0c\u786e\u4fdd\u5173\u952e SDK \u7684\u521d\u59cb\u5316\u987a\u5e8f\u3002 4. \u4e0e SDK \u63d0\u4f9b\u8005\u6c9f\u901a\uff0c\u5bfb\u6c42\u66f4\u597d\u7684\u521d\u59cb\u5316\u7ba1\u7406\u65b9\u5f0f\u3002</p> <p>\u901a\u8fc7\u8fd9\u4e9b\u65b9\u6cd5\uff0c\u4f60\u53ef\u4ee5\u5728\u4e00\u5b9a\u7a0b\u5ea6\u4e0a\u4f18\u5316\u548c\u7ba1\u7406 SDK \u7684\u521d\u59cb\u5316\u987a\u5e8f\uff0c\u4ece\u800c\u63d0\u5347\u5e94\u7528\u542f\u52a8\u6027\u80fd\u3002 https://github.com/gdutxiaoxu/AnchorTask</p>"},{"location":"040Jetpack/010Basic/#android-jetpackandroid","title":"\u54ea\u4e9bAndroid Jetpack\u5e93\u662f\u4e00\u4e2a\u6807\u51c6Android\u7a0b\u5e8f\u5458\u9700\u8981\u638c\u63e1\u7684\uff1f","text":"\u7b54\u6848 <p>Android Jetpack \u662f\u4e00\u7ec4\u5e93\u3001\u5de5\u5177\u548c\u6307\u5357\uff0c\u65e8\u5728\u5e2e\u52a9\u5f00\u53d1\u8005\u66f4\u9ad8\u6548\u5730\u6784\u5efa\u9ad8\u8d28\u91cf\u7684 Android \u5e94\u7528\u3002\u4ee5\u4e0b\u662f\u4e00\u4e9b\u6807\u51c6 Android \u7a0b\u5e8f\u5458\u9700\u8981\u638c\u63e1\u7684 Jetpack \u5e93\uff1a</p>"},{"location":"040Jetpack/010Basic/#1-viewmodel_2","title":"1. ViewModel","text":"<ul> <li>\u4f5c\u7528: \u7ba1\u7406 UI \u76f8\u5173\u7684\u6570\u636e\uff0c\u5e76\u5728\u914d\u7f6e\u66f4\u6539\uff08\u5982\u5c4f\u5e55\u65cb\u8f6c\uff09\u65f6\u4fdd\u6301\u6570\u636e\u3002</li> <li>\u4f7f\u7528\u573a\u666f: \u7528\u4e8e\u5c06 UI \u903b\u8f91\u4e0e UI \u63a7\u5236\u5668\uff08\u5982 Activity \u6216 Fragment\uff09\u5206\u79bb\u3002</li> </ul>"},{"location":"040Jetpack/010Basic/#2-livedata_1","title":"2. LiveData","text":"<ul> <li>\u4f5c\u7528: \u63d0\u4f9b\u53ef\u89c2\u5bdf\u7684\u6570\u636e\u6301\u6709\u8005\uff0c\u786e\u4fdd UI \u4e0e\u6570\u636e\u72b6\u6001\u540c\u6b65\u3002</li> <li>\u4f7f\u7528\u573a\u666f: \u7528\u4e8e\u5728\u6570\u636e\u53d8\u5316\u65f6\u81ea\u52a8\u66f4\u65b0 UI\u3002</li> </ul>"},{"location":"040Jetpack/010Basic/#3-room","title":"3. Room","text":"<ul> <li>\u4f5c\u7528: \u63d0\u4f9b SQLite \u6570\u636e\u5e93\u7684\u62bd\u8c61\u5c42\uff0c\u7b80\u5316\u6570\u636e\u5e93\u64cd\u4f5c\u3002</li> <li>\u4f7f\u7528\u573a\u666f: \u7528\u4e8e\u672c\u5730\u6570\u636e\u5b58\u50a8\u548c\u7ba1\u7406\u3002</li> </ul>"},{"location":"040Jetpack/010Basic/#4-navigation","title":"4. Navigation","text":"<ul> <li>\u4f5c\u7528: \u7ba1\u7406\u5e94\u7528\u5185\u7684\u5bfc\u822a\u903b\u8f91\uff0c\u7b80\u5316 Fragment \u548c Activity \u4e4b\u95f4\u7684\u5207\u6362\u3002</li> <li>\u4f7f\u7528\u573a\u666f: \u7528\u4e8e\u5b9e\u73b0\u590d\u6742\u7684\u5bfc\u822a\u7ed3\u6784\u548c\u5904\u7406\u8fd4\u56de\u6808\u3002</li> </ul>"},{"location":"040Jetpack/010Basic/#5-workmanager","title":"5. WorkManager","text":"<ul> <li>\u4f5c\u7528: \u7ba1\u7406\u540e\u53f0\u4efb\u52a1\uff0c\u786e\u4fdd\u4efb\u52a1\u5728\u5408\u9002\u7684\u65f6\u673a\u6267\u884c\u3002</li> <li>\u4f7f\u7528\u573a\u666f: \u7528\u4e8e\u6267\u884c\u5ef6\u8fdf\u3001\u5b9a\u671f\u6216\u9700\u4fdd\u8bc1\u6267\u884c\u7684\u4efb\u52a1\u3002</li> </ul>"},{"location":"040Jetpack/010Basic/#6-data-binding","title":"6. Data Binding","text":"<ul> <li>\u4f5c\u7528: \u5c06 UI \u7ec4\u4ef6\u4e0e\u6570\u636e\u6e90\u7ed1\u5b9a\uff0c\u51cf\u5c11\u6837\u677f\u4ee3\u7801\u3002</li> <li>\u4f7f\u7528\u573a\u666f: \u7528\u4e8e\u7b80\u5316 UI \u66f4\u65b0\u548c\u6570\u636e\u7ed1\u5b9a\u3002</li> </ul>"},{"location":"040Jetpack/010Basic/#7-paging","title":"7. Paging","text":"<ul> <li>\u4f5c\u7528: \u5206\u9875\u52a0\u8f7d\u6570\u636e\uff0c\u4f18\u5316\u5927\u6570\u636e\u96c6\u7684\u663e\u793a\u3002</li> <li>\u4f7f\u7528\u573a\u666f: \u7528\u4e8e\u5217\u8868\u6216\u7f51\u683c\u4e2d\u5206\u9875\u52a0\u8f7d\u6570\u636e\u3002</li> </ul>"},{"location":"040Jetpack/010Basic/#8-hilt","title":"8. Hilt","text":"<ul> <li>\u4f5c\u7528: \u57fa\u4e8e Dagger \u7684\u4f9d\u8d56\u6ce8\u5165\u5e93\uff0c\u7b80\u5316\u4f9d\u8d56\u6ce8\u5165\u3002</li> <li>\u4f7f\u7528\u573a\u666f: \u7528\u4e8e\u7ba1\u7406\u5e94\u7528\u4e2d\u7684\u4f9d\u8d56\u5173\u7cfb\u3002</li> </ul>"},{"location":"040Jetpack/010Basic/#9-lifecycle","title":"9. Lifecycle","text":"<ul> <li>\u4f5c\u7528: \u7ba1\u7406 Activity \u548c Fragment \u7684\u751f\u547d\u5468\u671f\uff0c\u907f\u514d\u5185\u5b58\u6cc4\u6f0f\u3002</li> <li>\u4f7f\u7528\u573a\u666f: \u7528\u4e8e\u6267\u884c\u4e0e\u751f\u547d\u5468\u671f\u76f8\u5173\u7684\u64cd\u4f5c\u3002</li> </ul>"},{"location":"040Jetpack/010Basic/#10-viewbinding","title":"10. ViewBinding","text":"<ul> <li>\u4f5c\u7528: \u66ff\u4ee3 <code>findViewById</code>\uff0c\u7b80\u5316\u89c6\u56fe\u7ed1\u5b9a\u3002</li> <li>\u4f7f\u7528\u573a\u666f: \u7528\u4e8e\u5b89\u5168\u5730\u8bbf\u95ee\u89c6\u56fe\u3002</li> </ul>"},{"location":"040Jetpack/010Basic/#11-security","title":"11. Security","text":"<ul> <li>\u4f5c\u7528: \u63d0\u4f9b\u5b89\u5168\u7684\u52a0\u5bc6\u548c\u5bc6\u94a5\u7ba1\u7406\u529f\u80fd\u3002</li> <li>\u4f7f\u7528\u573a\u666f: \u7528\u4e8e\u4fdd\u62a4\u654f\u611f\u6570\u636e\u3002</li> </ul>"},{"location":"040Jetpack/010Basic/#12-app-startup","title":"12. App Startup","text":"<ul> <li>\u4f5c\u7528: \u4f18\u5316\u5e94\u7528\u542f\u52a8\u65f6\u7684\u521d\u59cb\u5316\u8fc7\u7a0b\u3002</li> <li>\u4f7f\u7528\u573a\u666f: \u7528\u4e8e\u5ef6\u8fdf\u521d\u59cb\u5316\u5e93\u548c\u7ec4\u4ef6\u3002</li> </ul>"},{"location":"040Jetpack/010Basic/#13-camerax","title":"13. CameraX","text":"<ul> <li>\u4f5c\u7528: \u7b80\u5316\u76f8\u673a\u529f\u80fd\u7684\u5f00\u53d1\u3002</li> <li>\u4f7f\u7528\u573a\u666f: \u7528\u4e8e\u5b9e\u73b0\u76f8\u673a\u76f8\u5173\u529f\u80fd\u3002</li> </ul>"},{"location":"040Jetpack/010Basic/#14-compose","title":"14. Compose","text":"<ul> <li>\u4f5c\u7528: \u58f0\u660e\u5f0f UI \u5de5\u5177\u5305\uff0c\u7b80\u5316 UI \u5f00\u53d1\u3002</li> <li>\u4f7f\u7528\u573a\u666f: \u7528\u4e8e\u6784\u5efa\u73b0\u4ee3\u3001\u54cd\u5e94\u5f0f UI\u3002</li> </ul>"},{"location":"040Jetpack/010Basic/#15-test","title":"15. Test","text":"<ul> <li>\u4f5c\u7528: \u63d0\u4f9b\u6d4b\u8bd5\u5de5\u5177\u548c\u6846\u67b6\uff0c\u652f\u6301\u5355\u5143\u6d4b\u8bd5\u548c UI \u6d4b\u8bd5\u3002</li> <li>\u4f7f\u7528\u573a\u666f: \u7528\u4e8e\u7f16\u5199\u548c\u8fd0\u884c\u6d4b\u8bd5\u3002</li> </ul>"},{"location":"040Jetpack/010Basic/#16-benchmark","title":"16. Benchmark","text":"<ul> <li>\u4f5c\u7528: \u63d0\u4f9b\u6027\u80fd\u6d4b\u8bd5\u5de5\u5177\uff0c\u5e2e\u52a9\u4f18\u5316\u5e94\u7528\u6027\u80fd\u3002</li> <li>\u4f7f\u7528\u573a\u666f: \u7528\u4e8e\u6027\u80fd\u6d4b\u8bd5\u548c\u4f18\u5316\u3002</li> </ul>"},{"location":"040Jetpack/010Basic/#17-biometric","title":"17. Biometric","text":"<ul> <li>\u4f5c\u7528: \u63d0\u4f9b\u751f\u7269\u8bc6\u522b\u8ba4\u8bc1\u529f\u80fd\u3002</li> <li>\u4f7f\u7528\u573a\u666f: \u7528\u4e8e\u5b9e\u73b0\u6307\u7eb9\u3001\u9762\u90e8\u8bc6\u522b\u7b49\u8ba4\u8bc1\u529f\u80fd\u3002</li> </ul>"},{"location":"040Jetpack/010Basic/#18-preferences","title":"18. Preferences","text":"<ul> <li>\u4f5c\u7528: \u7b80\u5316 SharedPreferences \u7684\u4f7f\u7528\u3002</li> <li>\u4f7f\u7528\u573a\u666f: \u7528\u4e8e\u5b58\u50a8\u548c\u8bfb\u53d6\u7528\u6237\u504f\u597d\u8bbe\u7f6e\u3002</li> </ul>"},{"location":"040Jetpack/010Basic/#19-slices","title":"19. Slices","text":"<ul> <li>\u4f5c\u7528: \u63d0\u4f9b\u4ea4\u4e92\u5f0f UI \u7247\u6bb5\uff0c\u53ef\u5728 Google \u641c\u7d22\u7b49\u5730\u65b9\u663e\u793a\u3002</li> <li>\u4f7f\u7528\u573a\u666f: \u7528\u4e8e\u589e\u5f3a\u5e94\u7528\u7684\u5916\u90e8\u96c6\u6210\u3002</li> </ul>"},{"location":"040Jetpack/010Basic/#20-downloadmanager","title":"20. DownloadManager","text":"<ul> <li>\u4f5c\u7528: \u7ba1\u7406\u540e\u53f0\u4e0b\u8f7d\u4efb\u52a1\u3002</li> <li>\u4f7f\u7528\u573a\u666f: \u7528\u4e8e\u5904\u7406\u5927\u6587\u4ef6\u4e0b\u8f7d\u3002</li> </ul>"},{"location":"040Jetpack/010Basic/#_71","title":"\u603b\u7ed3","text":"<p>\u638c\u63e1\u8fd9\u4e9b Jetpack \u5e93\u53ef\u4ee5\u663e\u8457\u63d0\u5347\u5f00\u53d1\u6548\u7387\u548c\u4ee3\u7801\u8d28\u91cf\u3002\u6839\u636e\u9879\u76ee\u9700\u6c42\u9009\u62e9\u5408\u9002\u7684\u5e93\uff0c\u5e76\u6df1\u5165\u7406\u89e3\u5176\u4f7f\u7528\u573a\u666f\u548c\u6700\u4f73\u5b9e\u8df5\u3002</p>"},{"location":"040Jetpack/010Basic/#_72","title":"Jetpack","text":"\u7b54\u6848"},{"location":"040Jetpack/010Basic/#_73","title":"Jetpack","text":"\u7b54\u6848"},{"location":"040Jetpack/010Basic/#_74","title":"Jetpack","text":"\u7b54\u6848"},{"location":"040Jetpack/010Basic/#_75","title":"Jetpack","text":"\u7b54\u6848"},{"location":"040Jetpack/020Compose/","title":"Compose","text":""},{"location":"040Jetpack/020Compose/#compose_1","title":"\u57fa\u7840Compose\u77e5\u8bc6","text":"\u7b54\u6848"},{"location":"040Jetpack/020Compose/#jetpack-compose","title":"Jetpack Compose \u9762\u8bd5\u9898\u53ca\u7b54\u6848","text":""},{"location":"040Jetpack/020Compose/#_1","title":"\u57fa\u7840\u6982\u5ff5","text":""},{"location":"040Jetpack/020Compose/#1-jetpack-compose","title":"1. \u4ec0\u4e48\u662f Jetpack Compose\uff1f","text":"<p>\u7b54\u6848\uff1aJetpack Compose \u662f Google \u63a8\u51fa\u7684\u73b0\u4ee3 Android UI \u5de5\u5177\u5305\uff0c\u4f7f\u7528 Kotlin \u7f16\u5199\uff0c\u91c7\u7528\u58f0\u660e\u5f0f\u7f16\u7a0b\u8303\u5f0f\u3002\u5b83\u7b80\u5316\u4e86 UI \u5f00\u53d1\u8fc7\u7a0b\uff0c\u901a\u8fc7\u53ef\u7ec4\u5408\u51fd\u6570\u6784\u5efa\u754c\u9762\uff0c\u81ea\u52a8\u5904\u7406 UI \u66f4\u65b0\uff0c\u65e0\u9700\u4f20\u7edf View \u7cfb\u7edf\u7684\u7e41\u7410\u64cd\u4f5c\u3002</p>"},{"location":"040Jetpack/020Compose/#2-ui-ui","title":"2. \u58f0\u660e\u5f0f UI \u548c\u547d\u4ee4\u5f0f UI \u6709\u4ec0\u4e48\u533a\u522b\uff1f","text":"<p>\u7b54\u6848\uff1a - \u547d\u4ee4\u5f0f UI\uff1a\u5f00\u53d1\u8005\u9700\u8981\u660e\u786e\u6307\u793a\u5982\u4f55\u521b\u5efa\u548c\u66f4\u65b0 UI\uff08\u5982 findViewById \u548c setText\uff09 - \u58f0\u660e\u5f0f UI\uff1a\u5f00\u53d1\u8005\u63cf\u8ff0 UI \u5e94\u8be5\u662f\u4ec0\u4e48\u6837\u5b50\uff08\u57fa\u4e8e\u5f53\u524d\u72b6\u6001\uff09\uff0c\u6846\u67b6\u8d1f\u8d23\u5982\u4f55\u5b9e\u73b0</p>"},{"location":"040Jetpack/020Compose/#3-composable","title":"3. Composable \u51fd\u6570\u6709\u4ec0\u4e48\u7279\u70b9\uff1f","text":"<p>\u7b54\u6848\uff1a - \u4f7f\u7528 <code>@Composable</code> \u6ce8\u89e3\u6807\u8bb0 - \u53ef\u4ee5\u8c03\u7528\u5176\u4ed6 Composable \u51fd\u6570 - \u6ca1\u6709\u8fd4\u56de\u503c\uff08\u8fd4\u56de Unit\uff09 - \u5e94\u8be5\u662f\u5e42\u7b49\u7684\uff08\u76f8\u540c\u8f93\u5165\u4ea7\u751f\u76f8\u540c\u8f93\u51fa\uff09 - \u6ca1\u6709\u526f\u4f5c\u7528\uff08\u4e0d\u5e94\u4fee\u6539\u5168\u5c40\u72b6\u6001\uff09</p>"},{"location":"040Jetpack/020Compose/#_2","title":"\u6838\u5fc3\u6982\u5ff5","text":""},{"location":"040Jetpack/020Compose/#4-compose","title":"4. \u89e3\u91ca Compose \u4e2d\u7684\u72b6\u6001\u7ba1\u7406","text":"<p>\u7b54\u6848\uff1a Compose \u4f7f\u7528 <code>remember</code> \u548c <code>mutableStateOf</code> \u6765\u7ba1\u7406\u72b6\u6001\u3002\u5f53\u72b6\u6001\u53d8\u5316\u65f6\uff0c\u53ea\u6709\u4f9d\u8d56\u8be5\u72b6\u6001\u7684 Composable \u4f1a\u91cd\u7ec4\u3002</p> <pre><code>@Composable\nfun Counter() {\n    var count by remember { mutableStateOf(0) }\n    Button(onClick = { count++ }) {\n        Text(\"Clicked $count times\")\n    }\n}\n</code></pre>"},{"location":"040Jetpack/020Compose/#5-recomposition","title":"5. \u4ec0\u4e48\u662f\u91cd\u7ec4\uff08Recomposition\uff09\uff1f","text":"<p>\u7b54\u6848\uff1a\u91cd\u7ec4\u662f Compose \u5728\u72b6\u6001\u53d8\u5316\u65f6\u91cd\u65b0\u6267\u884c Composable \u51fd\u6570\u4ee5\u66f4\u65b0 UI \u7684\u8fc7\u7a0b\u3002Compose \u4f1a\u667a\u80fd\u5730\u53ea\u91cd\u7ec4\u9700\u8981\u66f4\u65b0\u7684\u90e8\u5206\uff0c\u800c\u4e0d\u662f\u6574\u4e2a UI \u6811\u3002</p>"},{"location":"040Jetpack/020Compose/#6","title":"6. \u5982\u4f55\u4f18\u5316\u91cd\u7ec4\u6027\u80fd\uff1f","text":"<p>\u7b54\u6848\uff1a - \u4f7f\u7528 <code>remember</code> \u7f13\u5b58\u8ba1\u7b97\u7ed3\u679c - \u5c06\u5217\u8868\u9879\u4f7f\u7528 <code>key</code> \u51fd\u6570\u63d0\u4f9b\u7a33\u5b9a\u952e - \u4f7f\u7528 <code>derivedStateOf</code> \u51cf\u5c11\u4e0d\u5fc5\u8981\u7684\u91cd\u7ec4 - \u5c06\u4e0d\u5e38\u53d8\u5316\u7684\u90e8\u5206\u63d0\u53d6\u5230\u5355\u72ec\u7684 Composable - \u907f\u514d\u5728 Composable \u4e2d\u8fdb\u884c\u8017\u65f6\u64cd\u4f5c</p>"},{"location":"040Jetpack/020Compose/#_3","title":"\u9ad8\u7ea7\u4e3b\u9898","text":""},{"location":"040Jetpack/020Compose/#7-compose","title":"7. \u89e3\u91ca Compose \u4e2d\u7684\u526f\u4f5c\u7528","text":"<p>\u7b54\u6848\uff1a\u526f\u4f5c\u7528\u662f\u5728 Composable \u51fd\u6570\u4e4b\u5916\u53d1\u751f\u7684\u64cd\u4f5c\uff08\u5982\u7f51\u7edc\u8bf7\u6c42\u3001\u6570\u636e\u5e93\u8bbf\u95ee\uff09\u3002Compose \u63d0\u4f9b\u4e86\u526f\u4f5c\u7528 API\uff1a - <code>LaunchedEffect</code>\uff1a\u534f\u7a0b\u4f5c\u7528\u57df - <code>rememberCoroutineScope</code>\uff1a\u83b7\u53d6\u7ec4\u5408\u611f\u77e5\u7684\u534f\u7a0b\u4f5c\u7528\u57df - <code>DisposableEffect</code>\uff1a\u9700\u8981\u6e05\u7406\u7684\u8d44\u6e90 - <code>SideEffect</code>\uff1a\u6bcf\u6b21\u6210\u529f\u91cd\u7ec4\u540e\u8fd0\u884c</p>"},{"location":"040Jetpack/020Compose/#8-compose","title":"8. \u5982\u4f55\u5728 Compose \u4e2d\u5904\u7406\u4e3b\u9898\u548c\u6837\u5f0f\uff1f","text":"<p>\u7b54\u6848\uff1a Compose \u4f7f\u7528 <code>MaterialTheme</code> \u63d0\u4f9b\u4e3b\u9898\u7cfb\u7edf\uff1a <pre><code>MaterialTheme(\n    colors = darkColors(),\n    typography = Typography(),\n    shapes = Shapes()\n) {\n    // \u5e94\u7528\u5185\u5bb9\n}\n</code></pre> \u53ef\u4ee5\u901a\u8fc7 <code>MaterialTheme.colors</code>\u3001<code>MaterialTheme.typography</code> \u7b49\u8bbf\u95ee\u4e3b\u9898\u503c\u3002</p>"},{"location":"040Jetpack/020Compose/#9-compose-view","title":"9. Compose \u5982\u4f55\u4e0e View \u7cfb\u7edf\u4e92\u64cd\u4f5c\uff1f","text":"<p>\u7b54\u6848\uff1a - Compose in Views\uff1a\u4f7f\u7528 <code>AndroidViewBinding</code> \u6216 <code>ComposeView</code> - Views in Compose\uff1a\u4f7f\u7528 <code>AndroidView</code> Composable - \u4e92\u64cd\u4f5c\u5c42\u5141\u8bb8\u9010\u6b65\u8fc1\u79fb\u73b0\u6709\u5e94\u7528</p>"},{"location":"040Jetpack/020Compose/#10-compose-modifier","title":"10. \u89e3\u91ca Compose \u4e2d\u7684 Modifier \u7cfb\u7edf","text":"<p>\u7b54\u6848\uff1a Modifier \u662f Compose \u4e2d\u7528\u4e8e\u88c5\u9970\u6216\u589e\u5f3a\u7ec4\u4ef6\u7684\u5de5\u5177\u94fe\u3002\u5b83\u4eec\u53ef\u4ee5\uff1a - \u66f4\u6539\u5e03\u5c40\u884c\u4e3a\uff08\u5927\u5c0f\u3001\u586b\u5145\uff09 - \u6dfb\u52a0\u4ea4\u4e92\uff08\u70b9\u51fb\u3001\u6eda\u52a8\uff09 - \u8bbe\u7f6e\u5916\u89c2\uff08\u80cc\u666f\u3001\u8fb9\u6846\uff09 - \u5904\u7406\u624b\u52bf</p> <pre><code>Text(\n    text = \"Hello\",\n    modifier = Modifier\n        .padding(16.dp)\n        .clickable { onClick() }\n        .background(Color.Blue)\n)\n</code></pre>"},{"location":"040Jetpack/020Compose/#_4","title":"\u5b9e\u6218\u95ee\u9898","text":""},{"location":"040Jetpack/020Compose/#11-compose","title":"11. \u5982\u4f55\u5728 Compose \u4e2d\u5b9e\u73b0\u5217\u8868\uff1f","text":"<p>\u7b54\u6848\uff1a \u4f7f\u7528 <code>LazyColumn</code>\uff08\u5782\u76f4\uff09\u6216 <code>LazyRow</code>\uff08\u6c34\u5e73\uff09\uff1a <pre><code>LazyColumn {\n    items(100) { index -&gt;\n        Text(\"Item #$index\")\n    }\n\n    item { Footer() }\n}\n</code></pre></p>"},{"location":"040Jetpack/020Compose/#12-compose","title":"12. \u89e3\u91ca Compose \u4e2d\u7684\u5bfc\u822a","text":"<p>\u7b54\u6848\uff1a \u4f7f\u7528 <code>Navigation</code> \u7ec4\u4ef6\uff1a <pre><code>val navController = rememberNavController()\n\nNavHost(navController, startDestination = \"home\") {\n    composable(\"home\") { HomeScreen(navController) }\n    composable(\"details/{id}\") { backStackEntry -&gt;\n        DetailsScreen(backStackEntry.arguments?.getString(\"id\"))\n    }\n}\n\n// \u5bfc\u822a\u5230\u8be6\u60c5\u9875\nnavController.navigate(\"details/123\")\n</code></pre></p>"},{"location":"040Jetpack/020Compose/#13-compose-ui","title":"13. \u5982\u4f55\u5728 Compose \u4e2d\u6d4b\u8bd5 UI\uff1f","text":"<p>\u7b54\u6848\uff1a \u4f7f\u7528 Compose \u6d4b\u8bd5 API\uff1a - <code>createComposeRule()</code> \u8bbe\u7f6e\u6d4b\u8bd5\u73af\u5883 - <code>onNodeWithText()</code> \u7b49\u67e5\u627e\u5668\u5b9a\u4f4d\u5143\u7d20 - <code>assertIsDisplayed()</code> \u7b49\u65ad\u8a00\u9a8c\u8bc1\u72b6\u6001 - <code>performClick()</code> \u7b49\u64cd\u4f5c\u6a21\u62df\u4ea4\u4e92</p> <pre><code>@Test\nfun testButtonClick() {\n    composeTestRule.setContent { MyApp() }\n\n    onNodeWithText(\"Click me\").performClick()\n    onNodeWithText(\"Clicked!\").assertIsDisplayed()\n}\n</code></pre>"},{"location":"040Jetpack/020Compose/#14-compose","title":"14. \u89e3\u91ca Compose \u4e2d\u7684\u81ea\u5b9a\u4e49\u5e03\u5c40","text":"<p>\u7b54\u6848\uff1a \u4f7f\u7528 <code>Layout</code> Composable \u521b\u5efa\u81ea\u5b9a\u4e49\u5e03\u5c40\uff1a <pre><code>@Composable\nfun CustomLayout() {\n    Layout(content = {\n        Text(\"Hello\")\n        Text(\"World\")\n    }) { measurables, constraints -&gt;\n        // \u6d4b\u91cf\u548c\u5e03\u5c40\u903b\u8f91\n    }\n}\n</code></pre></p>"},{"location":"040Jetpack/020Compose/#15-compose-viewmodel","title":"15. Compose \u4e0e ViewModel \u5982\u4f55\u914d\u5408\u4f7f\u7528\uff1f","text":"<p>\u7b54\u6848\uff1a \u901a\u8fc7 <code>viewModel()</code> \u83b7\u53d6 ViewModel \u5b9e\u4f8b\uff1a <pre><code>@Composable\nfun MyScreen(viewModel: MyViewModel = viewModel()) {\n    val data by viewModel.data.collectAsState()\n\n    if (data.isLoading) {\n        LoadingIndicator()\n    } else {\n        DataList(data.items)\n    }\n}\n</code></pre></p> <p>\u5e0c\u671b\u8fd9\u4e9b\u95ee\u9898\u80fd\u5e2e\u52a9\u4f60\u51c6\u5907 Jetpack Compose \u76f8\u5173\u7684\u9762\u8bd5\uff01\u8bb0\u4f4f\uff0c\u7406\u89e3\u6838\u5fc3\u6982\u5ff5\u6bd4\u6b7b\u8bb0\u786c\u80cc\u7b54\u6848\u66f4\u91cd\u8981\u3002</p>"},{"location":"040Jetpack/020Compose/#compose_2","title":"Compose\u5e38\u7528\u63a7\u4ef6\u4f7f\u7528\u6848\u4f8b\uff0c\u4ee5\u53ca\u6ce8\u610f\u4e8b\u9879","text":"\u7b54\u6848"},{"location":"040Jetpack/020Compose/#jetpack-composeandroid-ui","title":"Jetpack Compose\u548c\u4f20\u7edfAndroid UI\u6709\u4ec0\u4e48\u4e0d\u540c\uff1f","text":"\u7b54\u6848 <p>Jetpack Compose\u548c\u4f20\u7edf\u7684Android UI\u5f00\u53d1\u65b9\u5f0f\u6709\u5f88\u5927\u7684\u4e0d\u540c\u3002\u4ee5\u4e0b\u662f\u4e3b\u8981\u533a\u522b\u548cCompose\u5728\u5e95\u5c42\u5b9e\u73b0\u4e0a\u7684\u4f18\u52bf\uff1a</p>"},{"location":"040Jetpack/020Compose/#_5","title":"\u4e3b\u8981\u533a\u522b","text":"<ol> <li>\u58f0\u660e\u5f0f vs \u547d\u4ee4\u5f0f\uff1a</li> <li>Compose\u91c7\u7528\u58f0\u660e\u5f0fUI\u6a21\u5f0f\uff0c\u4f60\u63cf\u8ff0UI\u5e94\u8be5\u662f\u4ec0\u4e48\u6837\u5b50\uff0c\u800c\u4e0d\u662f\u5982\u4f55\u6784\u5efa\u5b83</li> <li> <p>\u4f20\u7edfAndroid\u4f7f\u7528\u547d\u4ee4\u5f0f\u65b9\u6cd5\uff0c\u901a\u8fc7\u76f4\u63a5\u64cd\u4f5c\u89c6\u56fe\u5c42\u6b21\u7ed3\u6784\u6765\u6784\u5efaUI</p> </li> <li> <p>\u5355\u4e00\u8bed\u8a00\uff1a</p> </li> <li>Compose\u5b8c\u5168\u4f7f\u7528Kotlin\u4ee3\u7801\u5b9a\u4e49UI\uff0c\u65e0\u9700XML</li> <li> <p>\u4f20\u7edf\u65b9\u6cd5\u9700\u8981XML\u5e03\u5c40\u6587\u4ef6\u548cJava/Kotlin\u4ee3\u7801\u7684\u7ed3\u5408</p> </li> <li> <p>\u72b6\u6001\u7ba1\u7406\uff1a</p> </li> <li>Compose\u6709\u5185\u7f6e\u7684\u72b6\u6001\u7ba1\u7406\u7cfb\u7edf\uff0cUI\u4f1a\u81ea\u52a8\u54cd\u5e94\u72b6\u6001\u53d8\u5316</li> <li> <p>\u4f20\u7edfUI\u9700\u8981\u624b\u52a8\u66f4\u65b0\u89c6\u56fe\u4ee5\u53cd\u6620\u6570\u636e\u53d8\u5316</p> </li> <li> <p>\u5e03\u5c40\u7cfb\u7edf\uff1a</p> </li> <li>Compose\u4f7f\u7528\u7075\u6d3b\u7684\u7ea6\u675f\u5e03\u5c40\u7cfb\u7edf</li> <li>\u4f20\u7edf\u65b9\u6cd5\u6709\u4e0d\u540c\u7684\u5e03\u5c40\u7ba1\u7406\u5668(LinearLayout\u3001ConstraintLayout\u7b49)</li> </ol>"},{"location":"040Jetpack/020Compose/#_6","title":"\u5e95\u5c42\u5b9e\u73b0\u4f18\u52bf","text":"<ol> <li>\u7f16\u8bd1\u65f6\u4f18\u5316\uff1a</li> <li>Compose\u7f16\u8bd1\u5668\u53ef\u4ee5\u5728\u7f16\u8bd1\u65f6\u5206\u6790\u548c\u4f18\u5316UI\u7ec4\u4ef6</li> <li> <p>\u4f20\u7edfView\u7cfb\u7edf\u4f9d\u8d56\u8fd0\u884c\u65f6\u53cd\u5c04\u548cXML\u89e3\u6790</p> </li> <li> <p>\u51cf\u5c11\u5e03\u5c40\u5c42\u6b21\uff1a</p> </li> <li>Compose\u4e13\u4e3a\u6241\u5e73\u5316\u5e03\u5c40\u6811\u8bbe\u8ba1\uff0c\u51cf\u5c11\u5d4c\u5957</li> <li> <p>\u4f20\u7edfXML\u5e03\u5c40\u901a\u5e38\u6709\u6df1\u5c42\u6b21\u5d4c\u5957\uff0c\u5f71\u54cd\u6027\u80fd</p> </li> <li> <p>\u91cd\u7ec4\u800c\u975e\u91cd\u7ed8\uff1a</p> </li> <li>Compose\u53ea\u91cd\u7ec4\u53d1\u751f\u53d8\u5316\u7684\u90e8\u5206\uff0c\u800c\u4e0d\u662f\u6574\u4e2a\u89c6\u56fe\u6811</li> <li> <p>\u4f20\u7edf\u7cfb\u7edf\u7ecf\u5e38\u9700\u8981\u5bf9\u6574\u4e2a\u89c6\u56fe\u5c42\u6b21\u7ed3\u6784\u8fdb\u884c\u65e0\u6548\u5316\u548c\u91cd\u7ed8</p> </li> <li> <p>\u5185\u5b58\u6548\u7387\uff1a</p> </li> <li>Compose\u4f7f\u7528\u8f7b\u91cf\u7ea7\u5bf9\u8c61\u8868\u793aUI\u5143\u7d20</li> <li> <p>\u4f20\u7edfView\u662f\u91cd\u91cf\u7ea7\u5bf9\u8c61\uff0c\u6d88\u8017\u66f4\u591a\u5185\u5b58</p> </li> <li> <p>\u5e76\u53d1\u6e32\u67d3\uff1a</p> </li> <li>Compose\u8bbe\u8ba1\u652f\u6301\u5f02\u6b65\u548c\u5e76\u53d1\u6e32\u67d3</li> <li>\u4f20\u7edfView\u7cfb\u7edf\u4e3b\u8981\u5728\u4e3b\u7ebf\u7a0b\u4e0a\u64cd\u4f5c</li> </ol> <p>\u603b\u4f53\u800c\u8a00\uff0cCompose\u5728\u7406\u8bba\u4e0a\u786e\u5b9e\u6bd4XML\u5e03\u5c40\u66f4\u6709\u6548\u7387\uff0c\u7279\u522b\u662f\u5bf9\u4e8e\u590d\u6742\u548c\u52a8\u6001\u7684UI\u3002\u5b83\u51cf\u5c11\u4e86\u4ee3\u7801\u91cf\uff0c\u6539\u5584\u4e86\u6027\u80fd\uff0c\u5e76\u63d0\u4f9b\u4e86\u66f4\u597d\u7684\u5f00\u53d1\u4f53\u9a8c\u3002\u4e0d\u8fc7\uff0cCompose\u76f8\u5bf9\u8f83\u65b0\uff0c\u800c\u4f20\u7edfView\u7cfb\u7edf\u7ecf\u8fc7\u591a\u5e74\u4f18\u5316\uff0c\u6240\u4ee5\u5728\u67d0\u4e9b\u7279\u5b9a\u573a\u666f\u4e0b\uff0c\u6210\u719f\u7684View\u7cfb\u7edf\u53ef\u80fd\u4ecd\u6709\u5176\u4f18\u52bf\u3002</p>"},{"location":"040Jetpack/020Compose/#composeandroid-xml-layout-inflate","title":"Compose\u7c7b\u6bd4Android XML Layout inflate\u6709\u4ec0\u4e48\u5173\u7cfb\uff1f","text":"\u7b54\u6848 <p>https://zhuanlan.zhihu.com/p/496540389 \u672c\u6587\u4e3b\u8981\u5206\u6790\u56de\u7b54\u4e86Compose\u5230\u5e95\u6709\u6ca1\u6709\u5b8c\u5168\u8131\u79bbView\u7cfb\u7edf\u8fd9\u4e2a\u95ee\u9898,\u603b\u7ed3\u5982\u4e0b\uff1a</p> <p>1 Compose\u5728\u6e32\u67d3\u65f6\u5e76\u4e0d\u4f1a\u8f6c\u5316\u6210View\uff0c\u800c\u662f\u53ea\u6709\u4e00\u4e2a\u5165\u53e3View\uff0c\u5373AndroidComposeView,\u7eafCompose\u9879\u76ee\u4e0b\uff0cAndroidComposeView\u6ca1\u6709\u5b50View 2 \u6211\u4eec\u58f0\u660e\u7684Compose\u5e03\u5c40\u5728\u6e32\u67d3\u65f6\u4f1a\u8f6c\u5316\u6210NodeTree,AndroidComposeView\u4e2d\u4f1a\u89e6\u53d1NodeTree\u7684\u5e03\u5c40\u4e0e\u7ed8\u5236,AndroidComposeView#dispatchDraw\u662f\u7ed8\u5236\u7684\u5165\u53e3 3 \u5728Android\u5e73\u53f0\u4e0a\uff0cCompose\u7684\u5e03\u5c40\u4e0e\u7ed8\u5236\u5df2\u57fa\u672c\u8131\u79bbView\u4f53\u7cfb\uff0c\u4f46\u4ecd\u7136\u4f9d\u8d56\u4e8eCanvas 4 \u7531\u4e8e\u826f\u597d\u7684\u5206\u5c42\u4f53\u7cfb\uff0cCompose\u53ef\u901a\u8fc7 compose.runtime\u548ccompose.compiler\u5b9e\u73b0\u8de8\u5e73\u53f0 5 \u5728\u4f7f\u7528Button\u65f6\uff0cAndroidComposeView\u4f1a\u6709\u4e24\u5c42\u5b50View\uff0c\u8fd9\u662f\u56e0\u4e3aButton\u4e2d\u4f7f\u7528\u4e86View\u6765\u5b9e\u73b0\u6c34\u6ce2\u7eb9\u6548\u679c</p> <p>\u7406\u89e3\u60a8\u7684\u95ee\u9898\u3002Compose \u7684 UI \u7ec4\u4ef6\u6700\u7ec8\u4e5f\u9700\u8981\u6709\u4e00\u4e2a\"\u5bb9\u5668\"\u6765\u627f\u8f7d\u5e76\u663e\u793a\u5728\u8bbe\u5907\u5c4f\u5e55\u4e0a\u3002</p>"},{"location":"040Jetpack/020Compose/#compose-ui","title":"Compose UI \u7684\u5bbf\u4e3b\u5bb9\u5668","text":"<p>Compose \u7684\u7ec4\u4ef6\u6811\u6700\u7ec8\u4f1a\u88ab\u6258\u7ba1\u5728\u4e00\u4e2a\u540d\u4e3a <code>AndroidComposeView</code> \u7684\u4f20\u7edf Android <code>ViewGroup</code> \u4e2d\u3002\u8fd9\u4e2a\u89c6\u56fe\u5c31\u662f Compose UI \u4e0e\u4f20\u7edf Android \u89c6\u56fe\u7cfb\u7edf\u7684\u6865\u6881\u3002</p>"},{"location":"040Jetpack/020Compose/#compose-android","title":"\u5982\u4f55\u5c06 Compose \u96c6\u6210\u5230 Android \u5e94\u7528\u4e2d","text":"<p>\u5728 Android \u5e94\u7528\u4e2d\u4f7f\u7528 Compose \u7684\u51e0\u79cd\u5e38\u89c1\u65b9\u5f0f\uff1a</p> <ol> <li>\u6574\u4e2a Activity \u4f7f\u7528 Compose\uff1a</li> </ol> <pre><code>class MainActivity : ComponentActivity() {\n    override fun onCreate(savedInstanceState: Bundle?) {\n        super.onCreate(savedInstanceState)\n        setContent {\n            MyApp()\n        }\n    }\n}\n</code></pre> <p><code>setContent</code> \u51fd\u6570\u662f\u5173\u952e\uff0c\u5b83\u4f1a\u521b\u5efa\u4e00\u4e2a <code>ComposeView</code>\uff08\u5b83\u662f <code>AndroidComposeView</code> \u7684\u5b50\u7c7b\uff09\uff0c\u5e76\u5c06\u5176\u8bbe\u7f6e\u4e3a Activity \u7684\u5185\u5bb9\u89c6\u56fe\u3002</p> <ol> <li>\u5728\u73b0\u6709\u7684 XML \u5e03\u5c40\u4e2d\u4f7f\u7528 Compose\uff1a</li> </ol> <pre><code>&lt;!-- activity_main.xml --&gt;\n&lt;androidx.compose.ui.platform.ComposeView\n    android:id=\"@+id/compose_view\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"match_parent\" /&gt;\n</code></pre> <p>\u7136\u540e\u5728\u4ee3\u7801\u4e2d\uff1a</p> <pre><code>findViewById&lt;ComposeView&gt;(R.id.compose_view).setContent {\n    MyComposeUI()\n}\n</code></pre>"},{"location":"040Jetpack/020Compose/#compose-ui_1","title":"Compose UI \u7684\u6e32\u67d3\u6d41\u7a0b","text":"<p>\u4ece\u6e90\u7801\u5c42\u9762\u6765\u770b\uff0c\u6574\u4e2a\u6d41\u7a0b\u5927\u81f4\u662f\uff1a</p> <ol> <li><code>setContent</code> \u521b\u5efa\u4e00\u4e2a <code>AndroidComposeView</code>\uff0c\u5b83\u7ee7\u627f\u81ea Android \u7684 <code>ViewGroup</code></li> <li><code>AndroidComposeView</code> \u5185\u90e8\u4f1a\u521b\u5efa\u4e00\u4e2a <code>AndroidComposePanel</code>\uff0c\u8fd9\u662f Compose \u7684\u6e32\u67d3\u5f15\u64ce</li> <li>\u5f53 Compose UI \u53d8\u5316\u65f6\uff0c\u53d8\u5316\u88ab\u8f6c\u6362\u4e3a\u7ed8\u5236\u6307\u4ee4</li> <li>\u8fd9\u4e9b\u6307\u4ee4\u6700\u7ec8\u4f1a\u5728 <code>AndroidComposeView</code> \u7684 <code>onDraw</code> \u65b9\u6cd5\u4e2d\u88ab\u6267\u884c\uff0c\u7ed8\u5236\u5230 Canvas \u4e0a</li> </ol>"},{"location":"040Jetpack/020Compose/#xml","title":"\u4e0e XML \u5e03\u5c40\u7684\u5bf9\u5e94\u5173\u7cfb","text":"<p>XML \u5e03\u5c40\uff1a - <code>setContentView(R.layout.some_layout)</code> \u8bbe\u7f6e\u6839\u89c6\u56fe - LayoutInflater \u89e3\u6790 XML \u521b\u5efa View \u5bf9\u8c61\u6811 - Activity/Fragment \u6301\u6709\u6839 View</p> <p>Compose\uff1a - <code>setContent { }</code> \u8bbe\u7f6e\u53ef\u7ec4\u5408\u5185\u5bb9 - ComposeView \u4f5c\u4e3a\u6839\u89c6\u56fe - Compose \u7ec4\u4ef6\u6811\u5b58\u5728\u4e8e Composition \u4e2d\uff0c\u7531 ComposeView \u6258\u7ba1\u548c\u6e32\u67d3</p>"},{"location":"040Jetpack/020Compose/#_7","title":"\u6e90\u7801\u793a\u4f8b","text":"<p><code>setContent</code> \u51fd\u6570\u7684\u7b80\u5316\u5b9e\u73b0\uff1a</p> <pre><code>fun ComponentActivity.setContent(content: @Composable () -&gt; Unit) {\n    // \u521b\u5efa ComposeView\n    val composeView = ComposeView(this)\n\n    // \u8bbe\u7f6e\u5185\u5bb9\n    composeView.setContent(content)\n\n    // \u8bbe\u7f6e\u4e3a Activity \u7684\u5185\u5bb9\u89c6\u56fe\n    setContentView(composeView)\n}\n</code></pre> <p><code>ComposeView</code> \u7684\u5de5\u4f5c\u539f\u7406\uff1a</p> <pre><code>// \u7b80\u5316\u7684\u6e90\u7801\nclass ComposeView : AbstractComposeView {\n    // \u5185\u90e8\u7684 Composition \u5bf9\u8c61\n    private var composition: Composition? = null\n\n    fun setContent(content: @Composable () -&gt; Unit) {\n        // \u521b\u5efa\u6216\u66f4\u65b0 Composition\n        composition = setViewContent(content)\n    }\n\n    // \u8fd9\u4e2a\u65b9\u6cd5\u4f1a\u88ab Android \u89c6\u56fe\u7cfb\u7edf\u8c03\u7528\n    override fun onDraw(canvas: Canvas) {\n        super.onDraw(canvas)\n        // \u5c06 Compose \u7ec4\u4ef6\u7ed8\u5236\u5230 Canvas \u4e0a\n        composePanel.draw(canvas)\n    }\n}\n</code></pre> <p>\u603b\u7ed3\u6765\u8bf4\uff0cCompose UI \u6700\u7ec8\u8fd8\u662f\u9700\u8981\u4e00\u4e2a\u4f20\u7edf\u7684 Android View\uff08\u5177\u4f53\u662f ComposeView\uff09\u4f5c\u4e3a\u5bbf\u4e3b\u5bb9\u5668\uff0c\u8fd9\u4e2a\u5bb9\u5668\u8d1f\u8d23\u5c06 Compose \u7684\u58f0\u660e\u5f0f UI \u8f6c\u6362\u4e3a\u5b9e\u9645\u53ef\u89c1\u7684\u50cf\u7d20\uff0c\u5e76\u663e\u793a\u5728\u5c4f\u5e55\u4e0a\u3002\u4ece\u6574\u4f53\u67b6\u6784\u770b\uff0cCompose \u662f\u6784\u5efa\u5728 Android \u89c6\u56fe\u7cfb\u7edf\u4e4b\u4e0a\u7684\u4e00\u4e2a\u65b0\u62bd\u8c61\u5c42\u3002</p> <p>AndroidComposeView\uff08\u53ca\u5176\u76f8\u5173\u5b9e\u73b0\u7c7b\uff09\u786e\u5b9e\u662f\u6574\u4e2a Compose UI \u7cfb\u7edf\u7684\u5e95\u5c42\u6865\u6881\uff0c\u8d1f\u8d23\u5c06 Compose \u7684\u58f0\u660e\u5f0f UI \u63cf\u8ff0\u6700\u7ec8\u8f6c\u6362\u4e3a Android \u4f20\u7edf\u89c6\u56fe\u7cfb\u7edf\u53ef\u7406\u89e3\u7684\u64cd\u4f5c\u3002</p>"},{"location":"040Jetpack/020Compose/#androidcomposeview","title":"AndroidComposeView \u7684\u6838\u5fc3\u804c\u8d23","text":"<ol> <li> <p>\u4f5c\u4e3a\u5bbf\u4e3b\u5bb9\u5668\uff1a\u5b83\u662f\u4e00\u4e2a\u6807\u51c6\u7684 Android ViewGroup\uff0c\u53ef\u4ee5\u88ab\u6dfb\u52a0\u5230\u89c6\u56fe\u5c42\u6b21\u7ed3\u6784\u4e2d</p> </li> <li> <p>\u7ba1\u7406 Composition\uff1a\u7ef4\u62a4\u548c\u534f\u8c03 Compose \u7684\u7ec4\u5408\u8fc7\u7a0b\uff0c\u786e\u4fdd UI \u63cf\u8ff0\u88ab\u6b63\u786e\u5904\u7406</p> </li> <li> <p>\u5904\u7406\u5e03\u5c40\uff1a\u8d1f\u8d23\u6d4b\u91cf\u548c\u5b9a\u4f4d Compose \u7ec4\u4ef6</p> </li> <li> <p>\u6267\u884c\u7ed8\u5236\uff1a\u5c06 Compose \u7ec4\u4ef6\u6811\u7ed8\u5236\u5230\u5c4f\u5e55\u4e0a</p> </li> <li> <p>\u5904\u7406\u8f93\u5165\u4e8b\u4ef6\uff1a\u63a5\u6536\u89e6\u6478\u3001\u6309\u952e\u7b49\u8f93\u5165\u4e8b\u4ef6\uff0c\u5e76\u4f20\u9012\u7ed9 Compose \u7ec4\u4ef6</p> </li> </ol>"},{"location":"040Jetpack/020Compose/#ui","title":"UI \u66f4\u65b0\u673a\u5236","text":"<p>\u5f53 Compose \u4e2d\u7684\u72b6\u6001\u53d1\u751f\u53d8\u5316\u65f6\uff1a</p> <ol> <li>\u53d8\u5316\u4f1a\u89e6\u53d1\u91cd\u7ec4\u8fc7\u7a0b\uff0c\u751f\u6210\u65b0\u7684 UI \u63cf\u8ff0</li> <li>\u901a\u8fc7\u5dee\u5f02\u7b97\u6cd5\u786e\u5b9a\u54ea\u4e9b\u90e8\u5206\u9700\u8981\u66f4\u65b0</li> <li>AndroidComposeView \u63a5\u6536\u8fd9\u4e9b\u53d8\u5316</li> <li>\u5728\u4e0b\u4e00\u5e27\u7ed8\u5236\u65f6\u5e94\u7528\u8fd9\u4e9b\u66f4\u6539</li> </ol> <p>\u4e0d\u540c\u4e8e\u4f20\u7edf View \u7cfb\u7edf\u4e2d\u9700\u8981\u624b\u52a8\u8c03\u7528 <code>addView()</code>\u3001<code>removeView()</code> \u7b49\u65b9\u6cd5\uff0cCompose \u4e2d\u8fd9\u4e9b\u64cd\u4f5c\u662f\u9690\u5f0f\u7684\uff0c\u7531\u6846\u67b6\u81ea\u52a8\u5904\u7406\u3002\u6bd4\u5982\uff1a</p> <pre><code>@Composable\nfun MyScreen(showDetails: Boolean) {\n    // \u5f53 showDetails \u53d8\u5316\u65f6\uff0cDetailPanel \u4f1a\u81ea\u52a8\u6dfb\u52a0\u6216\u79fb\u9664\n    // \u65e0\u9700\u624b\u52a8\u8c03\u7528 addView/removeView\n    if (showDetails) {\n        DetailPanel()\n    }\n}\n</code></pre>"},{"location":"040Jetpack/020Compose/#_8","title":"\u5e95\u5c42\u5b9e\u73b0\u7ec6\u8282","text":"<p>AndroidComposeView \u5185\u90e8\u4f7f\u7528\u4e86\u4e00\u7cfb\u5217\u590d\u6742\u7684\u673a\u5236\u6765\u9ad8\u6548\u5904\u7406\u8fd9\u4e9b\u53d8\u5316\uff1a</p> <ol> <li>\u8282\u70b9\u7ba1\u7406\uff1a\u7ef4\u62a4\u4e86\u4e00\u4e2a\u6811\u5f62\u7ed3\u6784\u5bf9\u5e94\u4e8e Compose \u7ec4\u4ef6\u6811</li> <li>\u5e03\u5c40\u8282\u70b9\uff1a\u4e3a\u6bcf\u4e2a\u9700\u8981\u5e03\u5c40\u7684\u7ec4\u4ef6\u521b\u5efa LayoutNode</li> <li>\u6e32\u67d3\u8282\u70b9\uff1a\u4e3a\u6bcf\u4e2a\u9700\u8981\u7ed8\u5236\u7684\u7ec4\u4ef6\u521b\u5efa RenderNode</li> <li>\u72b6\u6001\u89c2\u5bdf\uff1a\u6ce8\u518c\u76d1\u542c\u5668\u4ee5\u54cd\u5e94\u72b6\u6001\u53d8\u5316</li> </ol> <p>\u8fd9\u4e9b\u5e95\u5c42\u673a\u5236\u4f7f\u5f97 Compose \u80fd\u591f\u4ee5\u58f0\u660e\u5f0f\u7684\u65b9\u5f0f\u63cf\u8ff0 UI\uff0c\u540c\u65f6\u4fdd\u6301\u9ad8\u6548\u7684\u6e32\u67d3\u6027\u80fd\u3002</p> <p>\u6240\u4ee5\u60a8\u7684\u7406\u89e3\u5b8c\u5168\u6b63\u786e - \u867d\u7136\u5f00\u53d1\u8005\u4f7f\u7528 Compose \u65f6\u4e3b\u8981\u662f\u4ee5\u58f0\u660e\u5f0f\u7684\u65b9\u5f0f\u63cf\u8ff0 UI\uff0c\u4f46\u5728\u5e55\u540e\uff0c\u786e\u5b9e\u662f AndroidComposeView \u53ca\u5176\u5185\u90e8\u5b9e\u73b0\u5728\u5904\u7406\u6240\u6709\u5b9e\u9645\u7684\u89c6\u56fe\u64cd\u4f5c\uff0c\u5305\u62ec\u521b\u5efa\u3001\u66f4\u65b0\u3001\u5220\u9664\u548c\u91cd\u7ed8\u7b49\u3002\u8fd9\u79cd\u62bd\u8c61\u8ba9\u5f00\u53d1\u8005\u80fd\u591f\u4e13\u6ce8\u4e8e\u63cf\u8ff0 UI \u5e94\u8be5\u662f\u4ec0\u4e48\u6837\u5b50\uff0c\u800c\u4e0d\u662f\u5982\u4f55\u5b9e\u73b0\u8fd9\u4e9b\u53d8\u5316\u3002</p>"},{"location":"040Jetpack/020Compose/#disposableeffectsideeffectlaunchedeffect","title":"DisposableEffect\u3001SideEffect\u3001LaunchedEffect\u4e4b\u95f4\u7684\u533a\u522b\uff1f","text":"\u7b54\u6848 <p>\u6211\u5c06\u89e3\u91caJetpack Compose\u4e2d\u7684DisposableEffect\u3001SideEffect\u548cLaunchedEffect\u4e09\u4e2a\u526f\u4f5c\u7528API\u4e4b\u95f4\u7684\u533a\u522b\u3002</p>"},{"location":"040Jetpack/020Compose/#disposableeffect","title":"DisposableEffect","text":"<ul> <li>\u7528\u9014\uff1a\u7528\u4e8e\u9700\u8981\u6e05\u7406\u64cd\u4f5c\u7684\u526f\u4f5c\u7528</li> <li>\u7279\u70b9\uff1a</li> <li>\u5f53\u952e\u503c\u53d8\u5316\u6216\u7ec4\u4ef6\u9000\u51fa\u7ec4\u5408\u65f6\u4f1a\u8c03\u7528onDispose\u4ee3\u7801\u5757</li> <li>\u9002\u5408\u7ba1\u7406\u9700\u8981\u91ca\u653e\u8d44\u6e90\u7684\u64cd\u4f5c\uff0c\u5982\u4e8b\u4ef6\u76d1\u542c\u5668\u3001\u4f20\u611f\u5668\u6ce8\u518c\u7b49</li> <li>\u751f\u547d\u5468\u671f\uff1a\u8fdb\u5165\u7ec4\u5408\u65f6\u6267\u884c\uff0c\u79bb\u5f00\u7ec4\u5408\u6216\u952e\u503c\u53d8\u5316\u65f6\u6267\u884c\u6e05\u7406\u4ee3\u7801</li> <li>\u793a\u4f8b\u573a\u666f\uff1a\u6dfb\u52a0\u548c\u79fb\u9664\u7cfb\u7edf\u76d1\u542c\u5668\u3001\u7b2c\u4e09\u65b9\u5e93\u8d44\u6e90\u7684\u6ce8\u518c\u4e0e\u6ce8\u9500</li> </ul> <pre><code>DisposableEffect(key1, key2) {\n    // \u8bbe\u7f6e\u6548\u679c\uff0c\u5982\u6dfb\u52a0\u76d1\u542c\u5668\n\n    onDispose {\n        // \u6e05\u7406\u4ee3\u7801\uff0c\u5982\u79fb\u9664\u76d1\u542c\u5668\n    }\n}\n</code></pre>"},{"location":"040Jetpack/020Compose/#sideeffect","title":"SideEffect","text":"<ul> <li>\u7528\u9014\uff1a\u6267\u884c\u4e0d\u9700\u8981\u6e05\u7406\u7684\u526f\u4f5c\u7528</li> <li>\u7279\u70b9\uff1a</li> <li>\u6bcf\u6b21\u6210\u529f\u91cd\u7ec4\u540e\u6267\u884c</li> <li>\u6ca1\u6709\u952e\u503c\u53c2\u6570\uff0c\u6bcf\u6b21\u91cd\u7ec4\u90fd\u4f1a\u89e6\u53d1</li> <li>\u4e0d\u80fd\u6302\u8d77\u6267\u884c</li> <li>\u751f\u547d\u5468\u671f\uff1a\u6bcf\u6b21\u91cd\u7ec4\u540e\u6267\u884c</li> <li>\u793a\u4f8b\u573a\u666f\uff1a\u5c06Compose\u72b6\u6001\u540c\u6b65\u5230\u975eCompose\u7cfb\u7edf\uff0c\u5982\u66f4\u65b0Analytics\u4e8b\u4ef6</li> </ul> <pre><code>SideEffect {\n    // \u6bcf\u6b21\u91cd\u7ec4\u540e\u6267\u884c\u7684\u4ee3\u7801\n}\n</code></pre>"},{"location":"040Jetpack/020Compose/#launchedeffect","title":"LaunchedEffect","text":"<ul> <li>\u7528\u9014\uff1a\u5728\u534f\u7a0b\u4f5c\u7528\u57df\u5185\u6267\u884c\u5f02\u6b65\u64cd\u4f5c</li> <li>\u7279\u70b9\uff1a</li> <li>\u4f7f\u7528\u534f\u7a0b\uff0c\u53ef\u4ee5\u6267\u884c\u6302\u8d77\u51fd\u6570</li> <li>\u5f53\u952e\u503c\u53d8\u5316\u65f6\u4f1a\u53d6\u6d88\u65e7\u534f\u7a0b\u5e76\u542f\u52a8\u65b0\u534f\u7a0b</li> <li>\u7ec4\u4ef6\u9000\u51fa\u7ec4\u5408\u65f6\u81ea\u52a8\u53d6\u6d88\u534f\u7a0b</li> <li>\u751f\u547d\u5468\u671f\uff1a\u8fdb\u5165\u7ec4\u5408\u6216\u952e\u503c\u53d8\u5316\u65f6\u542f\u52a8\uff0c\u79bb\u5f00\u7ec4\u5408\u6216\u952e\u503c\u53d8\u5316\u65f6\u53d6\u6d88</li> <li>\u793a\u4f8b\u573a\u666f\uff1a\u6570\u636e\u52a0\u8f7d\u3001\u52a8\u753b\u3001\u5ef6\u8fdf\u64cd\u4f5c</li> </ul> <pre><code>LaunchedEffect(key1, key2) {\n    // \u5728\u534f\u7a0b\u5185\u6267\u884c\u7684\u4ee3\u7801\n    // \u53ef\u4ee5\u8c03\u7528\u6302\u8d77\u51fd\u6570\n}\n</code></pre>"},{"location":"040Jetpack/020Compose/#_9","title":"\u4e3b\u8981\u533a\u522b\u603b\u7ed3","text":"<ol> <li>\u6267\u884c\u65f6\u673a\uff1a</li> <li>SideEffect\uff1a\u6bcf\u6b21\u91cd\u7ec4\u540e\u6267\u884c</li> <li> <p>DisposableEffect\u548cLaunchedEffect\uff1a\u8fdb\u5165\u7ec4\u5408\u6216\u952e\u503c\u53d8\u5316\u65f6\u6267\u884c</p> </li> <li> <p>\u6e05\u7406\u673a\u5236\uff1a</p> </li> <li>DisposableEffect\uff1a\u660e\u786e\u7684\u6e05\u7406\u9636\u6bb5(onDispose)</li> <li>LaunchedEffect\uff1a\u9690\u5f0f\u6e05\u7406(\u534f\u7a0b\u53d6\u6d88)</li> <li> <p>SideEffect\uff1a\u6ca1\u6709\u6e05\u7406\u673a\u5236</p> </li> <li> <p>\u534f\u7a0b\u652f\u6301\uff1a</p> </li> <li>LaunchedEffect\uff1a\u652f\u6301\u534f\u7a0b\u548c\u6302\u8d77\u51fd\u6570</li> <li> <p>DisposableEffect\u548cSideEffect\uff1a\u4e0d\u652f\u6301\u6302\u8d77\u51fd\u6570</p> </li> <li> <p>\u4f7f\u7528\u573a\u666f\uff1a</p> </li> <li>DisposableEffect\uff1a\u9700\u8981\u624b\u52a8\u6e05\u7406\u8d44\u6e90\u7684\u64cd\u4f5c</li> <li>LaunchedEffect\uff1a\u9700\u8981\u5f02\u6b65\u6267\u884c\u6216\u957f\u65f6\u95f4\u8fd0\u884c\u7684\u4efb\u52a1</li> <li>SideEffect\uff1a\u7b80\u5355\u7684\u526f\u4f5c\u7528\uff0c\u65e0\u9700\u6e05\u7406\u548c\u5f02\u6b65</li> </ol> <p>\u9009\u62e9\u54ea\u79cd\u526f\u4f5c\u7528API\u53d6\u51b3\u4e8e\u60a8\u7684\u5177\u4f53\u9700\u6c42\uff0c\u7279\u522b\u662f\u662f\u5426\u9700\u8981\u6e05\u7406\u64cd\u4f5c\uff0c\u4ee5\u53ca\u662f\u5426\u9700\u8981\u534f\u7a0b\u652f\u6301\u3002</p>"},{"location":"040Jetpack/020Compose/#pointercomposable-function","title":"pointer\u4e8b\u4ef6\u5728\u5404\u4e2aComposable function\u4e4b\u95f4\u662f\u5982\u4f55\u5904\u7406\u7684\uff1f","text":"\u7b54\u6848"},{"location":"040Jetpack/020Compose/#composelayout","title":"Compose\u81ea\u5b9a\u4e49Layout\uff1f","text":"\u7b54\u6848"},{"location":"040Jetpack/020Compose/#compositionlocalstaticcompositionlocalofcompositionlocalof","title":"CompositionLocal\u8d77\u4ec0\u4e48\u4f5c\u7528\uff1fstaticCompositionLocalOf\u548ccompositionLocalOf\u6709\u4ec0\u4e48\u533a\u522b\uff1f","text":"\u7b54\u6848"},{"location":"040Jetpack/020Compose/#composable-function","title":"Composable function\u7684\u72b6\u6001\u662f\u5982\u4f55\u6301\u4e45\u5316\u7684\uff1f","text":"\u7b54\u6848"},{"location":"040Jetpack/020Compose/#lazycolumncomposable-function","title":"LazyColumn\u662f\u5982\u4f55\u505aComposable function\u7f13\u5b58\u7684\uff1f","text":"\u7b54\u6848"},{"location":"040Jetpack/020Compose/#lazycolumncomposable-function_1","title":"\u5982\u4f55\u89e3\u51b3LazyColumn\u548c\u5176\u4ed6Composable function\u7684\u6ed1\u52a8\u51b2\u7a81\uff1f","text":"\u7b54\u6848"},{"location":"040Jetpack/020Compose/#composable","title":"@Composable\u7684\u4f5c\u7528\u662f\u4ec0\u4e48\uff1f","text":"\u7b54\u6848"},{"location":"040Jetpack/020Compose/#jetpack-composeflutterreactdiff","title":"Jetpack Compose\u662f\u7528\u4ec0\u4e48\u6e32\u67d3\u7684\uff1f\u6267\u884c\u6d41\u7a0b\u662f\u600e\u4e48\u6837\u7684\uff1f\u4e0eflutter/react\u90a3\u6837\u505adiff\u6709\u4ec0\u4e48\u533a\u522b/\u4f18\u52a3\uff1f","text":"\u7b54\u6848"},{"location":"040Jetpack/020Compose/#jetpack-compose_1","title":"Jetpack Compose\u591a\u7ebf\u7a0b\u6267\u884c\u662f\u5982\u4f55\u5b9e\u73b0\u7684\uff1f","text":"\u7b54\u6848"},{"location":"040Jetpack/020Compose/#composable-composable","title":"\u4ec0\u4e48\u662f\u6709\u72b6\u6001\u7684 Composable \u51fd\u6570\uff1f\u4ec0\u4e48\u662f\u65e0\u72b6\u6001\u7684 Composable \u51fd\u6570\uff1f","text":"\u7b54\u6848"},{"location":"040Jetpack/020Compose/#compose_3","title":"Compose \u7684\u72b6\u6001\u63d0\u5347\u5982\u4f55\u7406\u89e3\uff1f\u6709\u4ec0\u4e48\u597d\u5904\uff1f","text":"\u7b54\u6848"},{"location":"040Jetpack/020Compose/#mvi-mvvmmvpmvc","title":"\u5982\u4f55\u7406\u89e3 MVI \u67b6\u6784\uff1f\u548c MVVM\u3001MVP\u3001MVC \u6709\u4ec0\u4e48\u4e0d\u540c\u7684\uff1f","text":"\u7b54\u6848"},{"location":"040Jetpack/020Compose/#android-flow-collectasstate-flow-state-composable","title":"\u5728 Android \u4e0a\uff0c\u5f53\u4e00\u4e2a Flow \u88ab collectAsState\uff0c\u5e94\u7528\u8f6c\u5165\u540e\u53f0\u65f6\uff0c\u5982\u679c\u8fd9\u4e2a Flow \u518d\u8fdb\u884c\u66f4\u65b0\uff0c\u5bf9\u5e94\u7684 State \u4f1a\u4e0d\u4f1a\u66f4\u65b0\uff1f\u5bf9\u5e94\u7684 Composable \u51fd\u6570\u4f1a\u4e0d\u4f1a\u66f4\u65b0\uff1f","text":"\u7b54\u6848 <p>\u5728 Android \u4e0a\uff0c\u5f53\u4f7f\u7528 <code>collectAsState</code> \u6536\u96c6 Flow \u5e76\u5728\u5e94\u7528\u8f6c\u5165\u540e\u53f0\u65f6\uff0cState \u7684\u66f4\u65b0\u884c\u4e3a\u548c\u5bf9\u5e94\u7684 Composable \u51fd\u6570\u7684\u66f4\u65b0\u884c\u4e3a\u5982\u4e0b\uff1a</p>"},{"location":"040Jetpack/020Compose/#1-state","title":"1. State \u662f\u5426\u4f1a\u66f4\u65b0\uff1f","text":"<ul> <li>\u4f1a\u66f4\u65b0\uff1a<code>collectAsState</code> \u4f1a\u7ee7\u7eed\u6536\u96c6 Flow \u53d1\u5c04\u7684\u6570\u636e\uff0c\u5373\u4f7f\u5e94\u7528\u5904\u4e8e\u540e\u53f0\u3002\u56e0\u4e3a Flow \u662f\u51b7\u6d41\uff0c\u5b83\u7684\u6536\u96c6\u5668\uff08collector\uff09\u5728\u751f\u547d\u5468\u671f\u4e0a\u662f\u72ec\u7acb\u7684\uff0c\u9664\u975e\u624b\u52a8\u53d6\u6d88\u6216\u534f\u7a0b\u4f5c\u7528\u57df\u88ab\u53d6\u6d88\uff08\u5982 ViewModel \u7684 <code>viewModelScope</code> \u5728 Activity \u9500\u6bc1\u65f6\u81ea\u52a8\u53d6\u6d88\uff09\u3002</li> <li>\u4f8b\u5916\u60c5\u51b5\uff1a</li> <li>\u5982\u679c\u6536\u96c6 <code>collectAsState</code> \u7684\u534f\u7a0b\u4f5c\u7528\u57df\uff08\u5982 <code>LaunchedEffect</code> \u6216 <code>rememberCoroutineScope</code>\uff09\u88ab\u53d6\u6d88\uff08\u4f8b\u5982 Composable \u9000\u51fa\u7ec4\u5408\uff09\uff0c\u5219\u6536\u96c6\u4f1a\u505c\u6b62\u3002</li> <li>\u5982\u679c Flow \u7684\u6765\u6e90\uff08\u5982 ViewModel \u7684 <code>StateFlow</code>\uff09\u5728\u540e\u53f0\u505c\u6b62\u53d1\u5c04\u6570\u636e\uff0c\u5219 State \u4e0d\u4f1a\u66f4\u65b0\u3002</li> </ul>"},{"location":"040Jetpack/020Compose/#2-composable","title":"2. Composable \u51fd\u6570\u662f\u5426\u4f1a\u66f4\u65b0\uff1f","text":"<ul> <li>\u4e0d\u4f1a\u7acb\u5373\u91cd\u7ec4\uff1a\u5373\u4f7f State \u7684\u503c\u88ab\u66f4\u65b0\uff0cComposable \u51fd\u6570\u5728\u5e94\u7528\u5904\u4e8e\u540e\u53f0\u65f6\u4e0d\u4f1a\u89e6\u53d1\u91cd\u7ec4\u3002\u56e0\u4e3a Android \u4f1a\u6682\u505c\u4e0d\u53ef\u89c1\u754c\u9762\u7684 UI \u66f4\u65b0\uff08\u5c5e\u4e8e\u7cfb\u7edf\u4f18\u5316\uff09\u3002</li> <li>\u6062\u590d\u524d\u53f0\u540e\u7684\u884c\u4e3a\uff1a</li> <li>\u5f53\u5e94\u7528\u56de\u5230\u524d\u53f0\u65f6\uff0cComposable \u4f1a\u68c0\u67e5 State \u7684\u6700\u65b0\u503c\uff0c\u5e76\u6839\u636e\u9700\u8981\u91cd\u7ec4\uff08\u5982\u679c\u503c\u53d1\u751f\u4e86\u53d8\u5316\uff09\u3002</li> <li>\u5982\u679c State \u5728\u540e\u53f0\u671f\u95f4\u591a\u6b21\u66f4\u65b0\uff0cComposable \u53ea\u4f1a\u54cd\u5e94\u6700\u65b0\u7684\u503c\uff08\u53d6\u51b3\u4e8e\u4f7f\u7528\u7684 Flow \u7c7b\u578b\uff0c\u5982 <code>StateFlow</code> \u4f1a\u4fdd\u7559\u6700\u65b0\u503c\uff09\u3002</li> </ul>"},{"location":"040Jetpack/020Compose/#3","title":"3. \u6ce8\u610f\u4e8b\u9879","text":"<ul> <li>\u6027\u80fd\u5f71\u54cd\uff1a\u867d\u7136 State \u5728\u540e\u53f0\u66f4\u65b0\u4e0d\u4f1a\u89e6\u53d1 UI \u91cd\u7ec4\uff0c\u4f46\u4ecd\u53ef\u80fd\u6d88\u8017\u8d44\u6e90\uff08\u5982 CPU\u3001\u5185\u5b58\uff09\u3002\u5982\u679c\u4e0d\u9700\u8981\u540e\u53f0\u66f4\u65b0\uff0c\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u65b9\u5f0f\u4f18\u5316\uff1a</li> <li>\u4f7f\u7528 <code>Lifecycle.repeatOnLifecycle</code>\uff08\u5728\u975e Compose \u4ee3\u7801\u4e2d\uff09\u6216 <code>flowWithLifecycle</code> \u63a7\u5236 Flow \u7684\u6536\u96c6\u751f\u547d\u5468\u671f\u3002</li> <li>\u5728 Compose \u4e2d\uff0c\u53ef\u4ee5\u901a\u8fc7 <code>LaunchedEffect</code> \u7ed3\u5408 <code>LifecycleOwner</code> \u63a7\u5236\u534f\u7a0b\u7684\u542f\u505c\u3002</li> <li>StateFlow \u7279\u6027\uff1a\u5982\u679c\u4f7f\u7528 <code>StateFlow</code> \u6216 <code>SharedFlow</code>\uff0c\u5b83\u4eec\u4f1a\u4fdd\u7559\u6700\u65b0\u503c\uff0c\u786e\u4fdd\u56de\u5230\u524d\u53f0\u65f6 UI \u72b6\u6001\u4e00\u81f4\u3002</li> </ul>"},{"location":"040Jetpack/020Compose/#_10","title":"\u793a\u4f8b\u4ee3\u7801","text":"<pre><code>@Composable\nfun ExampleScreen(viewModel: MyViewModel) {\n    val state by viewModel.myFlow.collectAsState()\n\n    Text(text = \"Current value: $state\")\n\n    // \u5982\u679c\u9700\u8981\u5728\u540e\u53f0\u505c\u6b62\u6536\u96c6\uff0c\u53ef\u4ee5\u7ed3\u5408\u751f\u547d\u5468\u671f\u63a7\u5236\uff08\u9700\u989d\u5916\u903b\u8f91\uff09\n}\n</code></pre>"},{"location":"040Jetpack/020Compose/#_11","title":"\u603b\u7ed3","text":"<ul> <li>State \u66f4\u65b0\uff1a\u5728\u540e\u53f0\u4ecd\u4f1a\u66f4\u65b0\uff08\u9664\u975e\u534f\u7a0b\u4f5c\u7528\u57df\u88ab\u53d6\u6d88\uff09\u3002</li> <li>UI \u66f4\u65b0\uff1a\u91cd\u7ec4\u4ec5\u5728\u5e94\u7528\u56de\u5230\u524d\u53f0\u540e\u89e6\u53d1\u3002</li> <li>\u63a8\u8350\u5b9e\u8df5\uff1a\u6839\u636e\u4e1a\u52a1\u9700\u6c42\u51b3\u5b9a\u662f\u5426\u9700\u8981\u5728\u540e\u53f0\u66f4\u65b0 State\uff0c\u5fc5\u8981\u65f6\u901a\u8fc7\u751f\u547d\u5468\u671f\u63a7\u5236 Flow \u7684\u6536\u96c6\u3002</li> </ul>"},{"location":"041KMP/010Basic/","title":"Kotlin Multi Platform","text":""},{"location":"041KMP/010Basic/#kmp-kotlin-multiplatform","title":"\u4ec0\u4e48\u662fKMP Kotlin MultiPlatForm\uff0c\u5b83\u80fd\u505a\u4ec0\u4e48\uff1f","text":"\u7b54\u6848 <p>KMP\uff08Kotlin Multiplatform\uff09\u662f JetBrains \u63a8\u51fa\u7684\u4e00\u9879\u6280\u672f\uff0c\u65e8\u5728\u8ba9\u5f00\u53d1\u8005\u4f7f\u7528 Kotlin \u7f16\u5199\u8de8\u5e73\u53f0\u4ee3\u7801\uff0c\u80fd\u591f\u5728\u591a\u4e2a\u5e73\u53f0\u4e0a\u5171\u4eab\u4e1a\u52a1\u903b\u8f91\uff0c\u540c\u65f6\u4fdd\u7559\u5404\u5e73\u53f0\u7684\u7279\u5b9a\u5b9e\u73b0\u3002</p>"},{"location":"041KMP/010Basic/#kmp","title":"KMP \u7684\u6838\u5fc3\u529f\u80fd","text":"<ol> <li>\u4ee3\u7801\u5171\u4eab\uff1a</li> <li> <p>\u5141\u8bb8\u5728\u591a\u4e2a\u5e73\u53f0\uff08\u5982 Android\u3001iOS\u3001Web\u3001\u684c\u9762\u7b49\uff09\u4e4b\u95f4\u5171\u4eab\u4ee3\u7801\uff0c\u51cf\u5c11\u91cd\u590d\u5f00\u53d1\u3002</p> </li> <li> <p>\u5e73\u53f0\u7279\u5b9a\u5b9e\u73b0\uff1a</p> </li> <li> <p>\u652f\u6301\u5728\u5171\u4eab\u4ee3\u7801\u4e2d\u8c03\u7528\u5e73\u53f0\u7279\u5b9a\u7684 API\uff0c\u786e\u4fdd\u5404\u5e73\u53f0\u7684\u72ec\u7279\u6027\u3002</p> </li> <li> <p>\u4e92\u64cd\u4f5c\u6027\uff1a</p> </li> <li> <p>\u4e0e\u73b0\u6709\u4ee3\u7801\u5e93\u517c\u5bb9\uff0c\u652f\u6301\u4e0e Java\u3001Swift\u3001JavaScript \u7b49\u8bed\u8a00\u7684\u4e92\u64cd\u4f5c\u3002</p> </li> <li> <p>\u5de5\u5177\u652f\u6301\uff1a</p> </li> <li>\u63d0\u4f9b Gradle \u63d2\u4ef6\u548c IDE \u652f\u6301\uff0c\u7b80\u5316\u8de8\u5e73\u53f0\u9879\u76ee\u7684\u914d\u7f6e\u548c\u5f00\u53d1\u3002</li> </ol>"},{"location":"041KMP/010Basic/#kmp_1","title":"KMP \u7684\u5e94\u7528\u573a\u666f","text":"<ol> <li>\u79fb\u52a8\u5f00\u53d1\uff1a</li> <li> <p>\u5728 Android \u548c iOS \u4e4b\u95f4\u5171\u4eab\u4e1a\u52a1\u903b\u8f91\uff0cUI \u5c42\u4ecd\u4f7f\u7528\u539f\u751f\u5f00\u53d1\u3002</p> </li> <li> <p>\u5168\u6808\u5f00\u53d1\uff1a</p> </li> <li> <p>\u524d\u540e\u7aef\u4f7f\u7528\u76f8\u540c\u7684 Kotlin \u4ee3\u7801\uff0c\u63d0\u5347\u5f00\u53d1\u6548\u7387\u3002</p> </li> <li> <p>\u684c\u9762\u5e94\u7528\uff1a</p> </li> <li> <p>\u5f00\u53d1\u8de8 Windows\u3001macOS\u3001Linux \u7684\u684c\u9762\u5e94\u7528\u3002</p> </li> <li> <p>\u5e93\u5f00\u53d1\uff1a</p> </li> <li>\u521b\u5efa\u8de8\u5e73\u53f0\u7684\u5e93\uff0c\u4f9b\u4e0d\u540c\u5e73\u53f0\u4f7f\u7528\u3002</li> </ol>"},{"location":"041KMP/010Basic/#_1","title":"\u793a\u4f8b","text":"<p>\u4ee5\u4e0b\u662f\u4e00\u4e2a\u7b80\u5355\u7684 KMP \u9879\u76ee\u7ed3\u6784\uff1a</p> <pre><code>// commonMain - \u5171\u4eab\u4ee3\u7801\nexpect fun platformName(): String\n\nfun greet(): String {\n    return \"Hello from ${platformName()}\"\n}\n\n// androidMain - Android \u5b9e\u73b0\nactual fun platformName(): String {\n    return \"Android\"\n}\n\n// iosMain - iOS \u5b9e\u73b0\nactual fun platformName(): String {\n    return \"iOS\"\n}\n</code></pre>"},{"location":"041KMP/010Basic/#_2","title":"\u603b\u7ed3","text":"<p>KMP \u901a\u8fc7\u4ee3\u7801\u5171\u4eab\u548c\u5e73\u53f0\u7279\u5b9a\u5b9e\u73b0\uff0c\u5e2e\u52a9\u5f00\u53d1\u8005\u9ad8\u6548\u6784\u5efa\u8de8\u5e73\u53f0\u5e94\u7528\uff0c\u51cf\u5c11\u91cd\u590d\u5de5\u4f5c\uff0c\u540c\u65f6\u4fdd\u6301\u5404\u5e73\u53f0\u7684\u72ec\u7279\u6027\u3002</p>"},{"location":"041KMP/010Basic/#kmp_2","title":"\u54ea\u4e9b\u662f\u76ee\u524dKMP\u7684\u5c40\u9650\uff1f","text":"\u7b54\u6848 <p>\u5c3d\u7ba1 Kotlin Multiplatform (KMP) \u63d0\u4f9b\u4e86\u5f3a\u5927\u7684\u8de8\u5e73\u53f0\u5f00\u53d1\u80fd\u529b\uff0c\u4f46\u5b83\u4ecd\u6709\u4e00\u4e9b\u5c40\u9650\u548c\u6311\u6218\u3002\u4ee5\u4e0b\u662f\u4e00\u4e9b\u4e3b\u8981\u7684\u9650\u5236\uff1a</p>"},{"location":"041KMP/010Basic/#1","title":"1. \u6210\u719f\u5ea6","text":"<ul> <li>\u751f\u6001\u7cfb\u7edf\uff1aKMP \u7684\u751f\u6001\u7cfb\u7edf\u4ecd\u5728\u53d1\u5c55\u4e2d\uff0c\u67d0\u4e9b\u5e93\u548c\u5de5\u5177\u53ef\u80fd\u4e0d\u5982\u539f\u751f\u5f00\u53d1\u6210\u719f\u3002</li> <li>\u793e\u533a\u652f\u6301\uff1a\u867d\u7136 Kotlin \u793e\u533a\u6d3b\u8dc3\uff0c\u4f46 KMP \u7684\u793e\u533a\u76f8\u5bf9\u8f83\u5c0f\uff0c\u8d44\u6e90\u548c\u652f\u6301\u6709\u9650\u3002</li> </ul>"},{"location":"041KMP/010Basic/#2","title":"2. \u5e73\u53f0\u7279\u5b9a\u4ee3\u7801","text":"<ul> <li>\u590d\u6742\u6027\uff1a\u867d\u7136 KMP \u5141\u8bb8\u5171\u4eab\u4ee3\u7801\uff0c\u4f46\u5e73\u53f0\u7279\u5b9a\u4ee3\u7801\u7684\u7f16\u5199\u548c\u7ba1\u7406\u53ef\u80fd\u589e\u52a0\u590d\u6742\u6027\u3002</li> <li>\u7ef4\u62a4\u6210\u672c\uff1a\u4e0d\u540c\u5e73\u53f0\u7684\u7279\u5b9a\u5b9e\u73b0\u9700\u8981\u989d\u5916\u7ef4\u62a4\uff0c\u53ef\u80fd\u589e\u52a0\u5f00\u53d1\u6210\u672c\u3002</li> </ul>"},{"location":"041KMP/010Basic/#3","title":"3. \u6027\u80fd","text":"<ul> <li>\u8fd0\u884c\u65f6\u5f00\u9500\uff1aKMP \u7684\u8de8\u5e73\u53f0\u4ee3\u7801\u53ef\u80fd\u5f15\u5165\u989d\u5916\u7684\u8fd0\u884c\u65f6\u5f00\u9500\uff0c\u5f71\u54cd\u6027\u80fd\u3002</li> <li>\u4f18\u5316\u96be\u5ea6\uff1a\u8de8\u5e73\u53f0\u4ee3\u7801\u7684\u4f18\u5316\u53ef\u80fd\u6bd4\u539f\u751f\u4ee3\u7801\u66f4\u5177\u6311\u6218\u6027\u3002</li> </ul>"},{"location":"041KMP/010Basic/#4-ide","title":"4. \u5de5\u5177\u548c IDE \u652f\u6301","text":"<ul> <li>\u5de5\u5177\u94fe\uff1aKMP \u7684\u5de5\u5177\u94fe\u4ecd\u5728\u5b8c\u5584\u4e2d\uff0c\u67d0\u4e9b\u529f\u80fd\u53ef\u80fd\u4e0d\u5982\u539f\u751f\u5f00\u53d1\u5de5\u5177\u6210\u719f\u3002</li> <li>IDE \u652f\u6301\uff1a\u867d\u7136 IntelliJ IDEA \u548c Android Studio \u5bf9 KMP \u63d0\u4f9b\u4e86\u826f\u597d\u652f\u6301\uff0c\u4f46\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\u53ef\u80fd\u4f1a\u9047\u5230\u95ee\u9898\u3002</li> </ul>"},{"location":"041KMP/010Basic/#5","title":"5. \u5b66\u4e60\u66f2\u7ebf","text":"<ul> <li>\u65b0\u6280\u672f\uff1aKMP \u5f15\u5165\u4e86\u65b0\u7684\u6982\u5ff5\u548c\u5de5\u5177\uff0c\u5f00\u53d1\u8005\u9700\u8981\u65f6\u95f4\u5b66\u4e60\u548c\u9002\u5e94\u3002</li> <li>\u6587\u6863\u548c\u6559\u7a0b\uff1a\u5c3d\u7ba1 Kotlin \u7684\u6587\u6863\u8f83\u4e3a\u5b8c\u5584\uff0c\u4f46 KMP \u7684\u7279\u5b9a\u6587\u6863\u548c\u6559\u7a0b\u76f8\u5bf9\u8f83\u5c11\u3002</li> </ul>"},{"location":"041KMP/010Basic/#6","title":"6. \u4e92\u64cd\u4f5c\u6027","text":"<ul> <li>\u8bed\u8a00\u517c\u5bb9\u6027\uff1a\u867d\u7136 KMP \u652f\u6301\u4e0e Java\u3001Swift \u7b49\u8bed\u8a00\u7684\u4e92\u64cd\u4f5c\uff0c\u4f46\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\u53ef\u80fd\u4f1a\u9047\u5230\u517c\u5bb9\u6027\u95ee\u9898\u3002</li> <li>API \u5dee\u5f02\uff1a\u4e0d\u540c\u5e73\u53f0\u7684 API \u5dee\u5f02\u53ef\u80fd\u5bfc\u81f4\u8de8\u5e73\u53f0\u4ee3\u7801\u7684\u590d\u6742\u6027\u589e\u52a0\u3002</li> </ul>"},{"location":"041KMP/010Basic/#7","title":"7. \u7b2c\u4e09\u65b9\u5e93","text":"<ul> <li>\u5e93\u652f\u6301\uff1a\u5e76\u975e\u6240\u6709\u7b2c\u4e09\u65b9\u5e93\u90fd\u652f\u6301 KMP\uff0c\u53ef\u80fd\u9700\u8981\u81ea\u884c\u5b9e\u73b0\u6216\u5bfb\u627e\u66ff\u4ee3\u65b9\u6848\u3002</li> <li>\u4f9d\u8d56\u7ba1\u7406\uff1a\u8de8\u5e73\u53f0\u9879\u76ee\u7684\u4f9d\u8d56\u7ba1\u7406\u53ef\u80fd\u6bd4\u5355\u4e00\u5e73\u53f0\u9879\u76ee\u66f4\u590d\u6742\u3002</li> </ul>"},{"location":"041KMP/010Basic/#8","title":"8. \u8c03\u8bd5\u548c\u6d4b\u8bd5","text":"<ul> <li>\u8c03\u8bd5\u5de5\u5177\uff1a\u8de8\u5e73\u53f0\u4ee3\u7801\u7684\u8c03\u8bd5\u5de5\u5177\u53ef\u80fd\u4e0d\u5982\u539f\u751f\u5f00\u53d1\u5de5\u5177\u6210\u719f\u3002</li> <li>\u6d4b\u8bd5\u590d\u6742\u6027\uff1a\u8de8\u5e73\u53f0\u4ee3\u7801\u7684\u6d4b\u8bd5\u53ef\u80fd\u9700\u8981\u8986\u76d6\u591a\u4e2a\u5e73\u53f0\uff0c\u589e\u52a0\u6d4b\u8bd5\u590d\u6742\u6027\u3002</li> </ul>"},{"location":"041KMP/010Basic/#_3","title":"\u603b\u7ed3","text":"<p>KMP \u63d0\u4f9b\u4e86\u5f3a\u5927\u7684\u8de8\u5e73\u53f0\u5f00\u53d1\u80fd\u529b\uff0c\u4f46\u5728\u6210\u719f\u5ea6\u3001\u6027\u80fd\u3001\u5de5\u5177\u652f\u6301\u3001\u5b66\u4e60\u66f2\u7ebf\u3001\u4e92\u64cd\u4f5c\u6027\u548c\u7b2c\u4e09\u65b9\u5e93\u652f\u6301\u7b49\u65b9\u9762\u4ecd\u5b58\u5728\u4e00\u4e9b\u5c40\u9650\u3002\u5f00\u53d1\u8005\u5728\u9009\u62e9 KMP \u65f6\u9700\u8981\u6743\u8861\u8fd9\u4e9b\u56e0\u7d20\uff0c\u5e76\u6839\u636e\u9879\u76ee\u9700\u6c42\u505a\u51fa\u51b3\u7b56\u3002\u968f\u7740 KMP \u751f\u6001\u7cfb\u7edf\u7684\u4e0d\u65ad\u53d1\u5c55\uff0c\u8fd9\u4e9b\u5c40\u9650\u6709\u671b\u9010\u6b65\u5f97\u5230\u6539\u5584\u3002</p>"},{"location":"041KMP/010Basic/#kmpui","title":"\u76ee\u524d\u53ef\u4ee5\u901a\u8fc7KMP\u5b9e\u73b0UI\u7684\u8de8\u5e73\u53f0\u5417\uff1f","text":"\u7b54\u6848 <p>\u76ee\u524d KMP\uff08Kotlin Multiplatform\uff09\u786e\u5b9e\u53ef\u4ee5\u5b9e\u73b0 UI \u7684\u8de8\u5e73\u53f0\u5f00\u53d1\uff0c\u4f46\u4e0e\u4e1a\u52a1\u903b\u8f91\u7684\u8de8\u5e73\u53f0\u76f8\u6bd4\uff0cUI \u8de8\u5e73\u53f0\u8fd8\u5728\u53d1\u5c55\u4e2d\u3002\u4ee5\u4e0b\u662f\u5f53\u524d KMP \u5728 UI \u8de8\u5e73\u53f0\u65b9\u9762\u7684\u60c5\u51b5\uff1a</p>"},{"location":"041KMP/010Basic/#compose-multiplatform","title":"Compose Multiplatform","text":"<p>\u6700\u4e3b\u8981\u7684 KMP UI \u89e3\u51b3\u65b9\u6848\u662f Compose Multiplatform\uff08\u539f\u540d Jetpack Compose for Desktop/Web\uff09\uff0c\u5b83\u662f Android \u4e0a Jetpack Compose \u58f0\u660e\u5f0f UI \u6846\u67b6\u7684\u8de8\u5e73\u53f0\u7248\u672c\u3002</p> <p>Compose Multiplatform \u5141\u8bb8\u5f00\u53d1\u8005\uff1a - \u5728 Android\u3001iOS\u3001\u684c\u9762\uff08Windows\u3001macOS\u3001Linux\uff09\u548c Web \u4e0a\u5171\u4eab UI \u4ee3\u7801 - \u4f7f\u7528\u76f8\u540c\u7684 Compose \u58f0\u660e\u5f0f API \u6784\u5efa\u754c\u9762 - \u590d\u7528 UI \u7ec4\u4ef6\u548c\u72b6\u6001\u7ba1\u7406\u903b\u8f91</p>"},{"location":"041KMP/010Basic/#_4","title":"\u5f53\u524d\u72b6\u6001","text":"<ol> <li>Android\uff1a\u5b8c\u5168\u652f\u6301\uff0c\u8fd9\u662f Compose \u7684\u53d1\u6e90\u5730</li> <li>\u684c\u9762\uff1a\u5df2\u6b63\u5f0f\u53d1\u5e03\uff0c\u652f\u6301 Windows\u3001macOS \u548c Linux</li> <li>Web\uff1a\u901a\u8fc7 Compose HTML \u53ef\u4ee5\u5c06 Compose \u7f16\u8bd1\u5230 JavaScript\uff0c\u4f46\u4ecd\u5904\u4e8e\u5b9e\u9a8c\u9636\u6bb5</li> <li>iOS\uff1a\u652f\u6301\u5df2\u7ecf\u8fdb\u5165 Alpha \u9636\u6bb5\uff0c2023 \u5e74\u5e95 JetBrains \u53d1\u5e03\u4e86 Compose Multiplatform for iOS \u7684\u9884\u89c8\u7248</li> </ol>"},{"location":"041KMP/010Basic/#kmp-ui","title":"\u5176\u4ed6 KMP UI \u89e3\u51b3\u65b9\u6848","text":"<p>\u9664\u4e86 Compose Multiplatform \u5916\uff0c\u8fd8\u6709\u4e00\u4e9b\u5176\u4ed6 UI \u89e3\u51b3\u65b9\u6848\uff1a</p> <ol> <li> <p>KMM (Kotlin Multiplatform Mobile)\uff1a\u4e13\u6ce8\u4e8e Android \u548c iOS \u7684\u5171\u4eab\u4ee3\u7801\uff0c\u4f46\u901a\u5e38\u5efa\u8bae\u4f7f\u7528\u5404\u5e73\u53f0\u539f\u751f UI\uff08SwiftUI/UIKit \u548c Jetpack Compose/XML\uff09</p> </li> <li> <p>Moko\uff1a\u4e00\u7cfb\u5217\u5e2e\u52a9\u5b9e\u73b0\u8de8\u5e73\u53f0 UI \u4ea4\u4e92\u7684\u5e93\uff0c\u5305\u62ec\u89c6\u56fe\u6a21\u578b\u3001\u8d44\u6e90\u5171\u4eab\u7b49</p> </li> <li> <p>Kodee\uff1a\u63d0\u4f9b\u4e86\u4e00\u5957\u62bd\u8c61\u5c42\uff0c\u5141\u8bb8\u4f7f\u7528\u5355\u4e00 API \u8bbf\u95ee\u5404\u5e73\u53f0\u7684\u539f\u751f UI \u6846\u67b6</p> </li> </ol>"},{"location":"041KMP/010Basic/#_5","title":"\u5b9e\u9645\u5e94\u7528\u60c5\u51b5","text":"<p>\u5c3d\u7ba1 KMP \u7684 UI \u8de8\u5e73\u53f0\u80fd\u529b\u5728\u4e0d\u65ad\u8fdb\u6b65\uff0c\u4f46\u5728\u751f\u4ea7\u73af\u5883\u4e2d\uff1a</p> <ul> <li>\u8bb8\u591a\u56e2\u961f\u9009\u62e9\u5171\u4eab\u4e1a\u52a1\u903b\u8f91\u548c\u6570\u636e\u5c42\uff0c\u4f46\u4f7f\u7528\u5404\u5e73\u53f0\u539f\u751f UI \u6846\u67b6</li> <li>\u5bf9\u4e8e\u9700\u8981\u9ad8\u5ea6\u5b9a\u5236 UI \u6216\u5e73\u53f0\u7279\u5b9a\u529f\u80fd\u7684\u5e94\u7528\uff0c\u6df7\u5408\u65b9\u6cd5\uff08\u5171\u4eab\u90e8\u5206 UI \u4ee3\u7801\uff0c\u90e8\u5206\u4f7f\u7528\u539f\u751f\uff09\u8f83\u4e3a\u5e38\u89c1</li> <li>\u5b8c\u5168\u8de8\u5e73\u53f0 UI \u89e3\u51b3\u65b9\u6848\u4ecd\u5728\u6210\u719f\u4e2d\uff0c\u7279\u522b\u662f\u5728 iOS \u652f\u6301\u65b9\u9762</li> </ul> <p>\u603b\u7684\u6765\u8bf4\uff0cKMP \u7684 UI \u8de8\u5e73\u53f0\u80fd\u529b\u662f\u5b58\u5728\u7684\uff0c\u4f46\u76f8\u6bd4\u4e1a\u52a1\u903b\u8f91\u7684\u5171\u4eab\uff0c\u5b83\u8fd8\u6ca1\u6709\u90a3\u4e48\u6210\u719f\u548c\u5e7f\u6cdb\u5e94\u7528\u3002\u4e0d\u8fc7\u968f\u7740 Compose Multiplatform \u7684\u6301\u7eed\u53d1\u5c55\uff0c\u8fd9\u4e00\u9886\u57df\u6b63\u5728\u5feb\u901f\u8fdb\u6b65\u3002</p>"},{"location":"041KMP/010Basic/#kmpkmp","title":"\u54ea\u4e9b\u662f\u5b98\u65b9KMP\u76ee\u524d\u6ca1\u6709\u529e\u6cd5\u5b9e\u73b0\u7684\u529f\u80fd\uff1f\u4e3e\u51e0\u4e2a\u4f8b\u5b50\u3002KMP\u7684\u4f18\u52bf\u548c\u5c40\u9650\u3002","text":"\u7b54\u6848 <p>KMP\uff08Kotlin Multiplatform\uff09\u6709\u8bb8\u591a\u4f18\u52bf\uff0c\u4f46\u4e5f\u5b58\u5728\u4e00\u4e9b\u5f53\u524d\u65e0\u6cd5\u5b9e\u73b0\u6216\u9700\u8981\u7279\u6b8a\u5904\u7406\u7684\u529f\u80fd\u3002\u4ee5\u4e0b\u662f\u4e00\u4e9b\u4f8b\u5b50\u548c\u5bf9KMP\u4f18\u52bf\u4e0e\u5c40\u9650\u7684\u5206\u6790\uff1a</p>"},{"location":"041KMP/010Basic/#kmp_3","title":"\u5b98\u65b9KMP\u76ee\u524d\u96be\u4ee5\u5b9e\u73b0\u7684\u529f\u80fd","text":"<ol> <li>\u539f\u751f\u5e73\u53f0\u7279\u5b9a\u529f\u80fd\uff1a</li> <li>iOS\u7279\u6709\u7684\u751f\u7269\u8bc6\u522b\uff08\u5982FaceID\u7684\u67d0\u4e9b\u9ad8\u7ea7\u529f\u80fd\uff09</li> <li>Android\u7279\u6709\u7684\u540e\u53f0\u670d\u52a1\u548c\u6743\u9650\u7cfb\u7edf</li> <li> <p>\u7279\u5b9a\u5e73\u53f0\u4e13\u6709\u786c\u4ef6\u8bbf\u95ee\uff08\u5982\u82f9\u679c\u7684LiDAR\u626b\u63cf\u4eea\uff09</p> </li> <li> <p>\u9ad8\u6027\u80fd\u56fe\u5f62\u548c\u6e38\u620f\uff1a</p> </li> <li>\u76f4\u63a5\u8bbf\u95eeMetal/OpenGL ES/Vulkan\u7b49\u4f4e\u7ea7\u56fe\u5f62API</li> <li> <p>\u9700\u8981\u5e73\u53f0\u7279\u5b9a\u4f18\u5316\u7684\u9ad8\u6027\u80fd\u6e38\u620f\u5f15\u64ce\u529f\u80fd</p> </li> <li> <p>\u7279\u5b9a\u5e73\u53f0SDK\u96c6\u6210\uff1a</p> </li> <li>\u82f9\u679c\u751f\u6001\u7cfb\u7edf\u7279\u6709\u529f\u80fd\uff08\u5982Apple Watch\u96c6\u6210\u3001HealthKit\u6df1\u5ea6\u529f\u80fd\uff09</li> <li> <p>\u8c37\u6b4c\u4e13\u5c5e\u670d\u52a1\uff08\u5982\u9ad8\u7ea7Google Maps\u529f\u80fd\u3001\u7279\u5b9aGoogle Play\u670d\u52a1\uff09</p> </li> <li> <p>\u590d\u6742UI\u4ea4\u4e92\uff1a</p> </li> <li>\u5e73\u53f0\u7279\u6709\u7684\u624b\u52bf\u8bc6\u522b\u7cfb\u7edf</li> <li> <p>\u7279\u5b9a\u5e73\u53f0\u7684\u9ad8\u7ea7\u52a8\u753b\u548c\u8fc7\u6e21\u6548\u679c</p> </li> <li> <p>\u7cfb\u7edf\u7ea7\u96c6\u6210\uff1a</p> </li> <li>\u9ed8\u8ba4\u5e94\u7528\u66ff\u6362\uff08\u5982\u9ed8\u8ba4\u6d4f\u89c8\u5668\u3001\u9ed8\u8ba4\u76f8\u673a\uff09</li> <li>\u7cfb\u7edf\u7ea7\u6743\u9650\u548c\u6df1\u5ea6\u64cd\u4f5c\u7cfb\u7edf\u96c6\u6210</li> </ol>"},{"location":"041KMP/010Basic/#kmp_4","title":"KMP\u7684\u4f18\u52bf","text":"<ol> <li>\u4ee3\u7801\u5171\u4eab\u6548\u7387\uff1a</li> <li>\u53ef\u4ee5\u5171\u4eab\u9ad8\u8fbe70%\u7684\u4ee3\u7801\uff0c\u51cf\u5c11\u7ef4\u62a4\u6210\u672c\u548cbug\u51fa\u73b0\u6982\u7387</li> <li> <p>\u4e1a\u52a1\u903b\u8f91\u3001\u7f51\u7edc\u5c42\u3001\u6570\u636e\u5904\u7406\u53ef\u4ee5\u5b8c\u5168\u8de8\u5e73\u53f0</p> </li> <li> <p>\u6e10\u8fdb\u5f0f\u91c7\u7528\uff1a</p> </li> <li>\u53ef\u4ee5\u9010\u6b65\u96c6\u6210\u5230\u73b0\u6709\u9879\u76ee\u4e2d\uff0c\u4e0d\u9700\u8981\u5b8c\u5168\u91cd\u5199</li> <li> <p>\u5141\u8bb8\u56e2\u961f\u51b3\u5b9a\u54ea\u4e9b\u90e8\u5206\u5171\u4eab\uff0c\u54ea\u4e9b\u90e8\u5206\u4fdd\u6301\u5e73\u53f0\u7279\u5b9a</p> </li> <li> <p>\u4fdd\u7559\u539f\u751f\u6027\u80fd\uff1a</p> </li> <li>\u7f16\u8bd1\u4e3a\u771f\u6b63\u7684\u539f\u751f\u4ee3\u7801\uff0c\u800c\u975e\u89e3\u91ca\u6267\u884c</li> <li> <p>\u6bd4\u8bb8\u591a\u5176\u4ed6\u8de8\u5e73\u53f0\u89e3\u51b3\u65b9\u6848\u6027\u80fd\u66f4\u597d</p> </li> <li> <p>\u7c7b\u578b\u5b89\u5168\u548c\u73b0\u4ee3\u8bed\u8a00\u7279\u6027\uff1a</p> </li> <li> <p>\u5229\u7528Kotlin\u7684\u6240\u6709\u4f18\u52bf\uff0c\u5982\u534f\u7a0b\u3001\u6d41\u3001\u51fd\u6570\u5f0f\u7f16\u7a0b</p> </li> <li> <p>\u5f3a\u5927\u7684\u5de5\u5177\u652f\u6301\uff1a</p> </li> <li>JetBrains IDE\u96c6\u6210</li> <li>\u5b98\u65b9\u652f\u6301\u548c\u6301\u7eed\u53d1\u5c55</li> </ol>"},{"location":"041KMP/010Basic/#kmp_5","title":"KMP\u7684\u5c40\u9650","text":"<ol> <li>\u751f\u6001\u7cfb\u7edf\u6210\u719f\u5ea6\uff1a</li> <li>\u4e0eReact Native\u6216Flutter\u76f8\u6bd4\uff0c\u5e93\u548c\u7ec4\u4ef6\u751f\u6001\u7cfb\u7edf\u8f83\u5c0f</li> <li> <p>\u8de8\u5e73\u53f0UI\u89e3\u51b3\u65b9\u6848\uff08\u5982Compose Multiplatform\uff09\u4ecd\u5728\u6210\u719f\u4e2d</p> </li> <li> <p>\u5b66\u4e60\u66f2\u7ebf\uff1a</p> </li> <li>\u9700\u8981\u4e86\u89e3\u5404\u76ee\u6807\u5e73\u53f0\u7684\u7279\u6027</li> <li> <p>\u914d\u7f6e\u548c\u6784\u5efa\u7cfb\u7edf\u8f83\u590d\u6742</p> </li> <li> <p>\u8c03\u8bd5\u590d\u6742\u6027\uff1a</p> </li> <li>\u8de8\u5e73\u53f0\u8c03\u8bd5\u6709\u65f6\u5019\u6bd4\u5355\u5e73\u53f0\u5f00\u53d1\u66f4\u590d\u6742</li> <li> <p>\u67d0\u4e9b\u5e73\u53f0\u7279\u5b9a\u95ee\u9898\u96be\u4ee5\u5728\u5171\u4eab\u4ee3\u7801\u4e2d\u8bca\u65ad</p> </li> <li> <p>\u56e2\u961f\u6280\u80fd\u8981\u6c42\uff1a</p> </li> <li>\u7406\u60f3\u60c5\u51b5\u4e0b\u9700\u8981\u56e2\u961f\u719f\u6089Kotlin</li> <li> <p>\u5728\u8fc7\u6e21\u671f\u53ef\u80fd\u9700\u8981\u540c\u65f6\u7ef4\u62a4\u591a\u4e2a\u5e73\u53f0\u7684\u77e5\u8bc6</p> </li> <li> <p>\u4f9d\u8d56\u7ba1\u7406\uff1a</p> </li> <li>\u7ba1\u7406\u591a\u5e73\u53f0\u4f9d\u8d56\u53ef\u80fd\u590d\u6742</li> <li>\u67d0\u4e9b\u5e93\u53ef\u80fd\u4e0d\u63d0\u4f9b\u591a\u5e73\u53f0\u7248\u672c</li> </ol> <p>KMP\u7279\u522b\u9002\u5408\u90a3\u4e9b\u5df2\u7ecf\u5728Android\u4e0a\u4f7f\u7528Kotlin\uff0c\u5e76\u5e0c\u671b\u5c06\u4e1a\u52a1\u903b\u8f91\u6269\u5c55\u5230iOS\u6216\u5176\u4ed6\u5e73\u53f0\u7684\u56e2\u961f\u3002\u5bf9\u4e8e\u9700\u8981\u9ad8\u5ea6\u5b9a\u5236UI\u4f53\u9a8c\u6216\u5927\u91cf\u4f7f\u7528\u5e73\u53f0\u7279\u5b9a\u529f\u80fd\u7684\u5e94\u7528\uff0c\u901a\u5e38\u91c7\u7528\u6df7\u5408\u7b56\u7565\u6700\u6709\u6548\uff1a\u5171\u4eab\u6838\u5fc3\u903b\u8f91\uff0c\u4f46\u4fdd\u7559\u5e73\u53f0\u7279\u5b9aUI\u548c\u529f\u80fd\u7684\u539f\u751f\u5b9e\u73b0\u3002</p>"},{"location":"041KMP/010Basic/#kmpandroid-ios","title":"\u4f60\u662f\u5426\u63a8\u8350\u4f7f\u7528KMP\u8de8\u7aef\uff1fAndroid iOS\u3002","text":"\u7b54\u6848 <p>KMP\uff08Kotlin Multiplatform\uff09\u5728\u4e1a\u52a1\u903b\u8f91\u5c42\u9762\u7684\u8de8\u5e73\u53f0\u5f00\u53d1\u5df2\u7ecf\u76f8\u5f53\u6210\u719f\uff0c\u5c24\u5176\u662f\u9488\u5bf9Android\u548ciOS\u7684\u5171\u4eab\u4ee3\u7801\u573a\u666f\u3002\u57fa\u4e8e\u5f53\u524d\u7684\u72b6\u6001\uff0c\u6211\u4f1a\u5efa\u8bae\uff1a</p>"},{"location":"041KMP/010Basic/#kmp_6","title":"KMP\u5728\u4e1a\u52a1\u903b\u8f91\u5c42\u7684\u6210\u719f\u5ea6\u8bc4\u4f30","text":"<p>KMP\u5bf9\u4e8e\u5171\u4eab\u4e1a\u52a1\u903b\u8f91\u3001\u7f51\u7edc\u5c42\u3001\u6570\u636e\u5904\u7406\u7b49\u975eUI\u90e8\u5206\u5df2\u7ecf\u76f8\u5f53\u7a33\u5b9a\uff0c\u5f88\u591a\u4f01\u4e1a\u7ea7\u9879\u76ee\u5df2\u7ecf\u5728\u751f\u4ea7\u73af\u5883\u4e2d\u4f7f\u7528\uff0c\u5305\u62ec\uff1a</p> <ul> <li>Cash App (\u7531Square\u5f00\u53d1)</li> <li>Netflix\u7684\u90e8\u5206\u529f\u80fd</li> <li>Philips\u3001VMware\u3001Autodesk\u7b49\u4f01\u4e1a\u7684\u5e94\u7528</li> <li>JetBrains\u81ea\u5df1\u7684\u5e94\u7528\u5982Space</li> </ul>"},{"location":"041KMP/010Basic/#_6","title":"\u6211\u7684\u63a8\u8350","text":"<p>\u662f\u7684\uff0c\u5bf9\u4e8eAndroid\u548ciOS\u7684\u4e1a\u52a1\u903b\u8f91\u90e8\u5206\u8de8\u5e73\u53f0\u5f00\u53d1\uff0c\u6211\u4f1a\u63a8\u8350\u4f7f\u7528KMP\uff0c\u57fa\u4e8e\u4ee5\u4e0b\u7406\u7531\uff1a</p> <ol> <li>\u4ee3\u7801\u590d\u7528\u6536\u76ca\u660e\u663e\uff1a</li> <li>\u7f51\u7edc\u5c42\u3001\u6570\u636e\u5904\u7406\u3001\u72b6\u6001\u7ba1\u7406\u7b49\u4ee3\u7801\u53ef\u4ee5\u9ad8\u6548\u5171\u4eab</li> <li> <p>\u51cf\u5c11\u5728\u4e24\u4e2a\u5e73\u53f0\u4e0a\u5b9e\u73b0\u76f8\u540c\u4e1a\u52a1\u903b\u8f91\u7684\u91cd\u590d\u5de5\u4f5c</p> </li> <li> <p>JetBrains\u7684\u957f\u671f\u652f\u6301\uff1a</p> </li> <li>KMP\u662fJetBrains\u7684\u6218\u7565\u9879\u76ee\uff0c\u6301\u7eed\u83b7\u5f97\u6295\u8d44\u548c\u6539\u8fdb</li> <li> <p>Kotlin 1.8+\u7248\u672c\u5927\u5e45\u6539\u5584\u4e86\u591a\u5e73\u53f0\u652f\u6301</p> </li> <li> <p>\u6210\u719f\u7684\u751f\u6001\u7cfb\u7edf\uff1a</p> </li> <li>\u6838\u5fc3\u5e93\u5982Ktor\uff08\u7f51\u7edc\uff09\u3001SQLDelight\uff08\u6570\u636e\u5e93\uff09\u3001Kotlinx.serialization\uff08\u5e8f\u5217\u5316\uff09\u7b49\u5df2\u7ecf\u975e\u5e38\u7a33\u5b9a</li> <li>\u8d8a\u6765\u8d8a\u591a\u7b2c\u4e09\u65b9\u5e93\u63d0\u4f9bKMP\u652f\u6301</li> </ol>"},{"location":"041KMP/010Basic/#_7","title":"\u4f7f\u7528\u5efa\u8bae","text":"<p>\u5982\u679c\u4f60\u51b3\u5b9a\u91c7\u7528KMP\uff0c\u6211\u5efa\u8bae\uff1a</p> <ol> <li>\u4ece\u5171\u4eab\u6838\u5fc3\u4e1a\u52a1\u903b\u8f91\u5f00\u59cb\uff1a</li> <li>\u9996\u5148\u8fc1\u79fb\u7f51\u7edc\u5c42\u3001\u6570\u636e\u6a21\u578b\u548c\u4e1a\u52a1\u89c4\u5219</li> <li> <p>\u4fdd\u7559\u5e73\u53f0\u7279\u5b9a\u7684UI\u5b9e\u73b0\uff08SwiftUI/UIKit\u548cJetpack Compose/XML\uff09</p> </li> <li> <p>\u91c7\u7528\u6e10\u8fdb\u5f0f\u65b9\u6cd5\uff1a</p> </li> <li>\u4e0d\u8981\u8bd5\u56fe\u4e00\u6b21\u6027\u5c06\u6240\u6709\u5185\u5bb9\u8f6c\u6362\u4e3aKMP</li> <li> <p>\u4ece\u4e00\u4e2a\u529f\u80fd\u6a21\u5757\u5f00\u59cb\uff0c\u9a8c\u8bc1\u6d41\u7a0b\uff0c\u7136\u540e\u6269\u5c55</p> </li> <li> <p>\u4f7f\u7528KMM\u63d2\u4ef6\uff1a</p> </li> <li>\u5229\u7528Android Studio\u7684Kotlin Multiplatform Mobile\u63d2\u4ef6\u7b80\u5316\u5f00\u53d1</li> <li> <p>\u5b83\u63d0\u4f9b\u4e86\u9488\u5bf9\u79fb\u52a8\u5e73\u53f0\u7684\u7279\u5b9a\u5de5\u5177\u548c\u6a21\u677f</p> </li> <li> <p>\u6ce8\u610f\u5e73\u53f0\u5dee\u5f02\uff1a</p> </li> <li>\u4f7f\u7528expect/actual\u6a21\u5f0f\u5904\u7406\u5e73\u53f0\u7279\u5b9a\u529f\u80fd</li> <li>\u4e3aiOS\u5f00\u53d1\u8bbe\u7f6e\u9002\u5f53\u7684\u5185\u5b58\u7ba1\u7406\u7b56\u7565</li> </ol> <p>\u603b\u7684\u6765\u8bf4\uff0c\u5bf9\u4e8e\u4e1a\u52a1\u903b\u8f91\u5c42\u9762\u7684\u5171\u4eab\uff0cKMP\u5df2\u7ecf\u8db3\u591f\u6210\u719f\u53ef\u7528\u4e8e\u751f\u4ea7\u73af\u5883\u3002\u5b83\u80fd\u663e\u8457\u51cf\u5c11\u7ef4\u62a4\u4e24\u5957\u4ee3\u7801\u7684\u6210\u672c\uff0c\u540c\u65f6\u4fdd\u6301\u826f\u597d\u7684\u6027\u80fd\u548c\u539f\u751f\u4f53\u9a8c\u3002\u4e0d\u8fc7UI\u5c42\u9762\u7684\u5171\u4eab\uff08\u901a\u8fc7Compose Multiplatform\uff09\u76ee\u524d\u4ecd\u5904\u4e8e\u53d1\u5c55\u9636\u6bb5\uff0c\u5728\u751f\u4ea7\u73af\u5883\u4e2d\u5e94\u8c28\u614e\u4f7f\u7528\u3002</p>"},{"location":"041KMP/010Basic/#kmp_7","title":"KMP\u6d89\u53ca\u7f51\u7edc\uff0c\u6570\u636e\uff0c\u548c\u903b\u8f91\u7684\u6848\u4f8b\u3002","text":"\u7b54\u6848 <p>\u4e0b\u9762\u6211\u4e3a\u4f60\u63d0\u4f9b\u4e00\u4e2a\u5177\u4f53\u7684KMP\u6848\u4f8b\uff0c\u5c55\u793a\u5982\u4f55\u5b9e\u73b0\u8de8\u5e73\u53f0\u7684\u7f51\u7edc\u8bf7\u6c42\u3001\u6570\u636e\u6a21\u578b\u548c\u4e1a\u52a1\u89c4\u5219\u3002\u8fd9\u4e2a\u4f8b\u5b50\u5c06\u521b\u5efa\u4e00\u4e2a\u7b80\u5355\u7684\u5929\u6c14\u5e94\u7528\u7684\u6838\u5fc3\u903b\u8f91\u5c42\u3002</p> <pre><code>// \u9879\u76ee\u7ed3\u6784\n// \n// - shared/\n//   - build.gradle.kts  (Kotlin Multiplatform \u9879\u76ee\u914d\u7f6e)\n//   - src/\n//     - commonMain/     (\u5171\u4eab\u4ee3\u7801)\n//     - androidMain/    (Android \u7279\u5b9a\u5b9e\u73b0)\n//     - iosMain/        (iOS \u7279\u5b9a\u5b9e\u73b0)\n\n// build.gradle.kts (\u5171\u4eab\u6a21\u5757)\nplugins {\n    kotlin(\"multiplatform\") version \"1.9.0\"\n    kotlin(\"plugin.serialization\") version \"1.9.0\"\n    id(\"com.android.library\")\n}\n\nkotlin {\n    android()\n    ios()\n\n    sourceSets {\n        val commonMain by getting {\n            dependencies {\n                // \u7f51\u7edc\u8bf7\u6c42\n                implementation(\"io.ktor:ktor-client-core:2.3.2\")\n                implementation(\"io.ktor:ktor-client-content-negotiation:2.3.2\")\n                implementation(\"io.ktor:ktor-serialization-kotlinx-json:2.3.2\")\n\n                // \u5e8f\u5217\u5316\n                implementation(\"org.jetbrains.kotlinx:kotlinx-serialization-json:1.5.1\")\n\n                // \u534f\u7a0b\n                implementation(\"org.jetbrains.kotlinx:kotlinx-coroutines-core:1.7.2\")\n            }\n        }\n\n        val androidMain by getting {\n            dependencies {\n                implementation(\"io.ktor:ktor-client-android:2.3.2\")\n            }\n        }\n\n        val iosMain by getting {\n            dependencies {\n                implementation(\"io.ktor:ktor-client-darwin:2.3.2\")\n            }\n        }\n    }\n}\n\n// 1. \u6570\u636e\u6a21\u578b\u5c42 - \u5171\u4eab\u4ee3\u7801 (commonMain)\n\n// \u6570\u636e\u6a21\u578b\u4f7f\u7528 kotlinx.serialization\nimport kotlinx.serialization.Serializable\n\n@Serializable\ndata class WeatherData(\n    val location: String,\n    val temperature: Double,\n    val humidity: Int,\n    val windSpeed: Double,\n    val condition: String,\n    val forecast: List&lt;DailyForecast&gt;\n)\n\n@Serializable\ndata class DailyForecast(\n    val day: String,\n    val minTemp: Double,\n    val maxTemp: Double,\n    val condition: String\n)\n\n// 2. \u7f51\u7edc\u5c42 - \u5171\u4eab\u4ee3\u7801 (commonMain)\n\nimport io.ktor.client.*\nimport io.ktor.client.plugins.contentnegotiation.*\nimport io.ktor.serialization.kotlinx.json.*\nimport io.ktor.client.request.*\nimport io.ktor.client.call.*\nimport kotlinx.serialization.json.Json\n\nclass WeatherApi {\n    // \u521b\u5efa HTTP \u5ba2\u6237\u7aef\u5b9e\u4f8b\n    private val client = HttpClient {\n        install(ContentNegotiation) {\n            json(Json {\n                ignoreUnknownKeys = true\n                prettyPrint = true\n                isLenient = true\n            })\n        }\n    }\n\n    // \u7f51\u7edc\u8bf7\u6c42\u51fd\u6570\n    suspend fun getWeatherData(city: String): WeatherData {\n        return client.get(\"https://api.weatherexample.com/data\") {\n            parameter(\"city\", city)\n            parameter(\"units\", \"metric\")\n        }.body()\n    }\n\n    // \u6e05\u7406\u8d44\u6e90\n    fun close() {\n        client.close()\n    }\n}\n\n// 3. \u5e73\u53f0\u7279\u5b9a\u4ee3\u7801 - \u5b9a\u4e49\u9884\u671f\u7684\u5e73\u53f0\u529f\u80fd\n\n// commonMain - \u5b9a\u4e49\u671f\u671b\u5b9e\u73b0\nexpect class LocationProvider {\n    suspend fun getCurrentLocation(): String\n}\n\n// androidMain - \u5b9e\u9645\u5b9e\u73b0\nactual class LocationProvider {\n    actual suspend fun getCurrentLocation(): String {\n        // \u5728\u5b9e\u9645\u5e94\u7528\u4e2d\uff0c\u8fd9\u91cc\u4f1a\u4f7f\u7528 Android \u7684\u4f4d\u7f6e\u670d\u52a1\n        // \u4e3a\u7b80\u5316\u793a\u4f8b\uff0c\u76f4\u63a5\u8fd4\u56de\u9ed8\u8ba4\u503c\n        return \"Beijing\"\n    }\n}\n\n// iosMain - \u5b9e\u9645\u5b9e\u73b0\nactual class LocationProvider {\n    actual suspend fun getCurrentLocation(): String {\n        // \u5728\u5b9e\u9645\u5e94\u7528\u4e2d\uff0c\u8fd9\u91cc\u4f1a\u4f7f\u7528 iOS \u7684 CoreLocation\n        // \u4e3a\u7b80\u5316\u793a\u4f8b\uff0c\u76f4\u63a5\u8fd4\u56de\u9ed8\u8ba4\u503c\n        return \"Beijing\"\n    }\n}\n\n// 4. \u4e1a\u52a1\u903b\u8f91\u5c42 - \u5171\u4eab\u4ee3\u7801 (commonMain)\n\nimport kotlinx.coroutines.flow.Flow\nimport kotlinx.coroutines.flow.MutableStateFlow\nimport kotlinx.coroutines.flow.asStateFlow\n\nclass WeatherRepository(\n    private val api: WeatherApi,\n    private val locationProvider: LocationProvider\n) {\n    // \u4f7f\u7528 StateFlow \u5b58\u50a8\u5f53\u524d\u5929\u6c14\u72b6\u6001\n    private val _weatherData = MutableStateFlow&lt;WeatherState&gt;(WeatherState.Loading)\n    val weatherData: Flow&lt;WeatherState&gt; = _weatherData.asStateFlow()\n\n    // \u4e1a\u52a1\u903b\u8f91\uff1a\u83b7\u53d6\u5929\u6c14\u4fe1\u606f\n    suspend fun fetchWeather(city: String? = null) {\n        try {\n            _weatherData.value = WeatherState.Loading\n\n            // \u5982\u679c\u6ca1\u6709\u6307\u5b9a\u57ce\u5e02\uff0c\u4f7f\u7528\u5f53\u524d\u4f4d\u7f6e\n            val locationToUse = city ?: locationProvider.getCurrentLocation()\n\n            // \u8c03\u7528 API \u83b7\u53d6\u6570\u636e\n            val data = api.getWeatherData(locationToUse)\n\n            // \u5904\u7406\u4e1a\u52a1\u89c4\u5219 - \u4f8b\u5982\u6e29\u5ea6\u683c\u5f0f\u5316\u3001\u5929\u6c14\u8b66\u544a\u7b49\n            val processedData = processWeatherData(data)\n\n            _weatherData.value = WeatherState.Success(processedData)\n        } catch (e: Exception) {\n            _weatherData.value = WeatherState.Error(\"\u65e0\u6cd5\u83b7\u53d6\u5929\u6c14\u6570\u636e: ${e.message}\")\n        }\n    }\n\n    // \u4e1a\u52a1\u89c4\u5219\uff1a\u5904\u7406\u5929\u6c14\u6570\u636e\n    private fun processWeatherData(data: WeatherData): WeatherData {\n        // \u793a\u4f8b\u4e1a\u52a1\u89c4\u52191\uff1a\u5982\u679c\u6e29\u5ea6\u8fc7\u9ad8\uff0c\u6dfb\u52a0\u9ad8\u6e29\u8b66\u544a\n        val condition = if (data.temperature &gt; 35) {\n            \"${data.condition} (\u9ad8\u6e29\u8b66\u544a)\"\n        } else {\n            data.condition\n        }\n\n        // \u793a\u4f8b\u4e1a\u52a1\u89c4\u52192\uff1a\u9884\u6d4b\u672a\u6765\u51e0\u5929\u7684\u6700\u9ad8\u6e29\u5ea6\u8d8b\u52bf\n        val forecast = data.forecast.map { daily -&gt;\n            // \u5982\u679c\u6700\u9ad8\u6e29\u5ea6\u8d85\u8fc730\u5ea6\uff0c\u6dfb\u52a0\u6807\u8bb0\n            val updatedCondition = if (daily.maxTemp &gt; 30) {\n                \"${daily.condition} (\u8f83\u70ed)\"\n            } else {\n                daily.condition\n            }\n\n            daily.copy(condition = updatedCondition)\n        }\n\n        return data.copy(condition = condition, forecast = forecast)\n    }\n}\n\n// \u5b9a\u4e49\u72b6\u6001\nsealed class WeatherState {\n    object Loading : WeatherState()\n    data class Success(val data: WeatherData) : WeatherState()\n    data class Error(val message: String) : WeatherState()\n}\n\n// 5. \u793a\u4f8b\uff1a\u5982\u4f55\u5728Android/iOS\u4e2d\u4f7f\u7528\u8fd9\u4e2a\u5171\u4eab\u4ee3\u7801\n\n// \u5728Android ViewModel\u4e2d\u4f7f\u7528\n/*\nclass AndroidWeatherViewModel(application: Application) : AndroidViewModel(application) {\n    private val repository = WeatherRepository(\n        WeatherApi(),\n        LocationProvider()\n    )\n\n    val weatherData = repository.weatherData.asLiveData()\n\n    fun loadWeather(city: String? = null) {\n        viewModelScope.launch {\n            repository.fetchWeather(city)\n        }\n    }\n}\n*/\n\n// \u5728iOS\u4f7f\u7528(Swift)\n/*\nclass WeatherViewModel: ObservableObject {\n    @Published var state: WeatherState = .loading\n\n    private let repository: WeatherRepository\n\n    init() {\n        repository = WeatherRepository(\n            api: WeatherApi(),\n            locationProvider: LocationProvider()\n        )\n\n        // \u521b\u5efa\u4e00\u4e2aKotlin\u534f\u7a0b\u4f5c\u7528\u57df\n        let scope = CoroutineScope(Dispatchers.Main.immediate)\n\n        // \u6536\u96c6Flow\n        scope.launch {\n            repository.weatherData.collect { state in\n                // \u66f4\u65b0SwiftUI\u72b6\u6001\n                self.state = state\n            }\n        }\n    }\n\n    func loadWeather(city: String? = nil) {\n        let scope = CoroutineScope(Dispatchers.Main.immediate)\n        scope.launch {\n            repository.fetchWeather(city: city)\n        }\n    }\n}\n*/\n</code></pre> <p>\u8fd9\u4e2a\u4f8b\u5b50\u5c55\u793a\u4e86\u5982\u4f55\u4f7f\u7528KMP\u6784\u5efa\u8de8\u5e73\u53f0\u7684\u5929\u6c14\u5e94\u7528\u6838\u5fc3\u529f\u80fd\uff0c\u5305\u542b\u4e86\u4ee5\u4e0b\u5173\u952e\u5143\u7d20\uff1a</p>"},{"location":"041KMP/010Basic/#_8","title":"\u6838\u5fc3\u7ec4\u4ef6\u89e3\u91ca","text":"<ol> <li>\u6570\u636e\u6a21\u578b\u5c42</li> <li>\u4f7f\u7528<code>kotlinx.serialization</code>\u5b9a\u4e49\u53ef\u5e8f\u5217\u5316\u7684\u6570\u636e\u7c7b</li> <li> <p>\u6570\u636e\u6a21\u578b\u5b8c\u5168\u5171\u4eab\uff0c\u4e0d\u9700\u8981\u5e73\u53f0\u7279\u5b9a\u4ee3\u7801</p> </li> <li> <p>\u7f51\u7edc\u5c42</p> </li> <li>\u4f7f\u7528Ktor\u5ba2\u6237\u7aef\u8fdb\u884c\u7f51\u7edc\u8bf7\u6c42</li> <li> <p>\u5171\u4eabAPI\u8c03\u7528\u903b\u8f91\uff0c\u4f46\u5e73\u53f0\u7279\u5b9a\u7684HTTP\u5f15\u64ce\u901a\u8fc7\u4f9d\u8d56\u6ce8\u5165</p> </li> <li> <p>\u5e73\u53f0\u7279\u5b9a\u529f\u80fd</p> </li> <li>\u4f7f\u7528<code>expect/actual</code>\u6a21\u5f0f\u5904\u7406\u9700\u8981\u5e73\u53f0\u7279\u5b9a\u5b9e\u73b0\u7684\u529f\u80fd</li> <li> <p>\u793a\u4f8b\u4e2d\u7684<code>LocationProvider</code>\u5728\u4e0d\u540c\u5e73\u53f0\u6709\u4e0d\u540c\u5b9e\u73b0</p> </li> <li> <p>\u4e1a\u52a1\u903b\u8f91\u5c42</p> </li> <li><code>WeatherRepository</code>\u5c01\u88c5\u6240\u6709\u4e1a\u52a1\u89c4\u5219</li> <li>\u4f7f\u7528\u534f\u7a0b\u548cFlow\u5904\u7406\u5f02\u6b65\u64cd\u4f5c\u548c\u6570\u636e\u6d41</li> <li>\u5b9e\u73b0\u4e86\u6570\u636e\u5904\u7406\u89c4\u5219\uff0c\u5982\u6e29\u5ea6\u8b66\u544a\u548c\u5929\u6c14\u72b6\u6001\u5904\u7406</li> </ol>"},{"location":"041KMP/010Basic/#_9","title":"\u5982\u4f55\u4f7f\u7528","text":"<p>\u8be5\u793a\u4f8b\u5c55\u793a\u4e86KMP\u9879\u76ee\u7684\u7ec4\u7ec7\u7ed3\u6784\uff0c\u5305\u62ec\uff1a</p> <ul> <li><code>commonMain</code>\uff1a\u5305\u542b\u6240\u6709\u5171\u4eab\u4ee3\u7801</li> <li><code>androidMain</code>\uff1aAndroid\u7279\u5b9a\u5b9e\u73b0</li> <li><code>iosMain</code>\uff1aiOS\u7279\u5b9a\u5b9e\u73b0</li> </ul> <p>\u5728\u5b9e\u9645\u9879\u76ee\u4e2d\uff0c\u4f60\u53ea\u9700\u8981\u5728\u5404\u81ea\u5e73\u53f0\u4e0a\u5b9e\u73b0UI\u5c42\uff0c\u800c\u6838\u5fc3\u7684\u4e1a\u52a1\u903b\u8f91\u3001\u7f51\u7edc\u8bf7\u6c42\u548c\u6570\u636e\u5904\u7406\u53ef\u4ee5\u5b8c\u5168\u5171\u4eab\u3002</p>"},{"location":"041KMP/010Basic/#_10","title":"\u4f18\u52bf","text":"<ol> <li>\u4ee3\u7801\u590d\u7528\uff1a\u7f51\u7edc\u5c42\u3001\u6570\u636e\u6a21\u578b\u548c\u4e1a\u52a1\u89c4\u5219\u53ea\u9700\u7f16\u5199\u4e00\u6b21</li> <li>\u7c7b\u578b\u5b89\u5168\uff1a\u4f7f\u7528Kotlin\u5f3a\u7c7b\u578b\u7cfb\u7edf\uff0c\u51cf\u5c11\u9519\u8bef</li> <li>\u7075\u6d3b\u6027\uff1a\u53ef\u4ee5\u8f7b\u677e\u5904\u7406\u5e73\u53f0\u7279\u5b9a\u529f\u80fd</li> <li>\u73b0\u4ee3API\uff1a\u5229\u7528\u534f\u7a0b\u548cFlow\u5904\u7406\u5f02\u6b65\u64cd\u4f5c</li> </ol> <p>\u8fd9\u4e2a\u4f8b\u5b50\u867d\u7136\u7b80\u5316\u4e86\u4e00\u4e9b\u7ec6\u8282\uff0c\u4f46\u5c55\u793a\u4e86KMP\u5728\u5b9e\u9645\u9879\u76ee\u4e2d\u5982\u4f55\u5e94\u7528\u4e8e\u4e1a\u52a1\u903b\u8f91\u5c42\u9762\u3002\u4f60\u53ef\u4ee5\u57fa\u4e8e\u8fd9\u4e2a\u7ed3\u6784\u6269\u5c55\u66f4\u590d\u6742\u7684\u529f\u80fd\uff0c\u5982\u7f13\u5b58\u7b56\u7565\u3001\u79bb\u7ebf\u652f\u6301\u3001\u66f4\u590d\u6742\u7684\u4e1a\u52a1\u89c4\u5219\u7b49\u3002</p>"},{"location":"041KMP/010Basic/#kmpokhttp-retrofit","title":"KMP\u80fd\u5426\u4f7f\u7528Okhttp Retrofit\u8fd9\u7c7b\u5df2\u7ecf\u5f88\u6613\u7528\u7684\u5e93\uff1f\u5e76\u4e14\u8fd8\u80fd\u591f\u8de8\u5e73\u53f0\uff1f","text":"\u7b54\u6848 <p>KMP\uff08Kotlin Multiplatform\uff09\u5bf9\u4e8e\u4f7f\u7528OkHttp\u548cRetrofit\u8fd9\u7c7bJava/Android\u5e93\u5b58\u5728\u4e00\u4e9b\u9650\u5236\u3002\u6211\u6765\u89e3\u91ca\u4e00\u4e0b\u8fd9\u79cd\u60c5\u51b5\uff1a</p>"},{"location":"041KMP/010Basic/#okhttp-retrofit-kmp","title":"OkHttp \u548c Retrofit \u5728 KMP \u4e2d\u7684\u4f7f\u7528","text":"<p>OkHttp \u548c Retrofit \u662f\u9488\u5bf9 JVM \u5e73\u53f0\u8bbe\u8ba1\u7684\uff0c\u4e3b\u8981\u9762\u5411 Android \u548c Java \u670d\u52a1\u5668\u5f00\u53d1\uff1a</p> <ol> <li>\u76f4\u63a5\u5728\u5171\u4eab\u4ee3\u7801\u4e2d\u4f7f\u7528\u7684\u9650\u5236\uff1a</li> <li>\u8fd9\u4e9b\u5e93\u4e0d\u80fd\u76f4\u63a5\u5728 KMP \u7684\u5171\u4eab\u4ee3\u7801\uff08<code>commonMain</code>\uff09\u4e2d\u4f7f\u7528</li> <li> <p>\u5b83\u4eec\u4f9d\u8d56\u4e8e JVM \u5e73\u53f0\u7684\u7279\u5b9a\u529f\u80fd\uff0c\u65e0\u6cd5\u5728 iOS/Native \u5e73\u53f0\u4e0a\u8fd0\u884c</p> </li> <li> <p>\u4ec5\u9650 Android \u5e73\u53f0\u4f7f\u7528\uff1a</p> </li> <li>\u53ef\u4ee5\u5728 KMP \u9879\u76ee\u7684 <code>androidMain</code> \u6e90\u96c6\u4e2d\u4f7f\u7528\u8fd9\u4e9b\u5e93</li> <li>\u4f46\u8fd9\u610f\u5473\u7740\u4f60\u9700\u8981\u4e3a iOS \u63d0\u4f9b\u4e00\u4e2a\u72ec\u7acb\u7684\u5b9e\u73b0</li> </ol>"},{"location":"041KMP/010Basic/#_11","title":"\u66ff\u4ee3\u65b9\u6848","text":"<p>KMP \u63d0\u4f9b\u4e86\u4e13\u95e8\u8bbe\u8ba1\u7684\u8de8\u5e73\u53f0\u7f51\u7edc\u5e93\uff0c\u5176\u4e2d\u6700\u4e3b\u8981\u7684\u662f\uff1a</p> <ol> <li>Ktor Client\uff1a</li> <li>\u4e13\u4e3a\u8de8\u5e73\u53f0\u8bbe\u8ba1\u7684\u7f51\u7edc\u5e93</li> <li>\u63d0\u4f9b\u7c7b\u4f3c\u529f\u80fd\uff0c\u4f46\u80fd\u5728\u6240\u6709 KMP \u76ee\u6807\u5e73\u53f0\u4e0a\u8fd0\u884c</li> <li>\u652f\u6301\u4e0d\u540c\u5e73\u53f0\u7684\u5f15\u64ce\uff08Android\u3001iOS\u3001JS\uff09</li> <li> <p>\u63d0\u4f9b\u62e6\u622a\u5668\u3001\u5e8f\u5217\u5316\u3001\u8bf7\u6c42/\u54cd\u5e94\u5904\u7406\u7b49\u529f\u80fd</p> </li> <li> <p>\u5bf9 Retrofit \u529f\u80fd\u7684\u6a21\u62df\uff1a</p> </li> <li>\u867d\u7136 Ktor \u4e0d\u63d0\u4f9b\u5b8c\u5168\u76f8\u540c\u7684 API \u63a5\u53e3\u5b9a\u4e49\u65b9\u5f0f</li> <li>\u4f46\u53ef\u4ee5\u521b\u5efa\u6269\u5c55\u51fd\u6570\u548c\u6a21\u5757\u5316 API \u7c7b\u6765\u5b9e\u73b0\u7c7b\u4f3c\u7684\u4ee3\u7801\u7ec4\u7ec7</li> </ol>"},{"location":"041KMP/010Basic/#_12","title":"\u5b9e\u9645\u65b9\u6848","text":"<p>\u5728 KMP \u9879\u76ee\u4e2d\u5904\u7406\u7f51\u7edc\u8bf7\u6c42\u6709\u4ee5\u4e0b\u51e0\u79cd\u65b9\u5f0f\uff1a</p> <ol> <li>\u5b8c\u5168\u5171\u4eab\u65b9\u6848\uff1a</li> <li>\u5728\u5171\u4eab\u4ee3\u7801\u4e2d\u4f7f\u7528 Ktor Client</li> <li> <p>\u6240\u6709\u5e73\u53f0\u4f7f\u7528\u76f8\u540c\u7684\u7f51\u7edc\u4ee3\u7801</p> </li> <li> <p>\u6df7\u5408\u65b9\u6848\uff1a</p> </li> <li>\u5728 Android \u7aef\u4f7f\u7528\u73b0\u6709\u7684 OkHttp/Retrofit \u4ee3\u7801 </li> <li>\u5728 iOS \u7aef\u4f7f\u7528 Ktor \u6216\u539f\u751f\u7f51\u7edc\u5e93</li> <li> <p>\u901a\u8fc7 <code>expect/actual</code> \u6a21\u5f0f\u63d0\u4f9b\u7edf\u4e00\u63a5\u53e3</p> </li> <li> <p>\u62bd\u8c61\u63a5\u53e3\u65b9\u6848\uff1a</p> </li> <li>\u5728\u5171\u4eab\u4ee3\u7801\u4e2d\u5b9a\u4e49\u63a5\u53e3</li> <li>Android \u5b9e\u73b0\u4f7f\u7528 Retrofit</li> <li>iOS \u5b9e\u73b0\u4f7f\u7528\u5176\u4ed6\u6280\u672f</li> <li>\u7f3a\u70b9\u662f\u5b9e\u73b0\u4ee3\u7801\u5197\u4f59</li> </ol> <p>\u5927\u591a\u6570 KMP \u9879\u76ee\u9009\u62e9\u65b9\u6848 1\uff0c\u5b8c\u5168\u4f7f\u7528 Ktor \u4ee3\u66ff Retrofit/OkHttp\uff0c\u56e0\u4e3a\u8fd9\u6837\u53ef\u4ee5\u6700\u5927\u5316\u4ee3\u7801\u5171\u4eab\u5e76\u51cf\u5c11\u7ef4\u62a4\u6210\u672c\u3002Ktor \u867d\u7136\u4e0e Retrofit \u7684\u4f7f\u7528\u65b9\u5f0f\u4e0d\u540c\uff0c\u4f46\u529f\u80fd\u4e0a\u5b8c\u5168\u53ef\u4ee5\u6ee1\u8db3\u9700\u6c42\uff0c\u4e14\u5df2\u7ecf\u76f8\u5f53\u6210\u719f\u548c\u7a33\u5b9a\u3002</p>"},{"location":"041KMP/010Basic/#kmp_8","title":"KMP\u5e38\u7528\u5e93","text":"\u7b54\u6848"},{"location":"041KMP/010Basic/#kmp_9","title":"KMP\u9879\u76ee\u5e38\u7528\u5e93\u53ca\u5176\u4f5c\u7528","text":"<p>\u4ee5\u4e0b\u662fKotlin Multiplatform (KMP)\u9879\u76ee\u4e2d\u7ecf\u5e38\u4f7f\u7528\u7684\u5e93\u53ca\u5176\u4e3b\u8981\u529f\u80fd\uff1a</p>"},{"location":"041KMP/010Basic/#_13","title":"\u7f51\u7edc\u8bf7\u6c42","text":"<ol> <li>Ktor Client</li> <li>\u4f5c\u7528\uff1a\u8de8\u5e73\u53f0HTTP\u5ba2\u6237\u7aef</li> <li>\u7279\u70b9\uff1a\u652f\u6301\u534f\u7a0b\u3001\u7075\u6d3b\u7684\u63d2\u4ef6\u7cfb\u7edf\u3001\u53ef\u914d\u7f6e\u7684\u5e8f\u5217\u5316</li> <li> <p>\u5b98\u65b9\u7ef4\u62a4\uff1a\u7531JetBrains\u5f00\u53d1</p> </li> <li> <p>Kermit</p> </li> <li>\u4f5c\u7528\uff1a\u8de8\u5e73\u53f0\u65e5\u5fd7\u6846\u67b6</li> <li>\u7279\u70b9\uff1a\u652f\u6301\u591a\u5e73\u53f0\u7684\u65e5\u5fd7\u8bb0\u5f55\uff0c\u7075\u6d3b\u7684\u65e5\u5fd7\u8f93\u51fa\u914d\u7f6e</li> </ol>"},{"location":"041KMP/010Basic/#_14","title":"\u6570\u636e\u5b58\u50a8","text":"<ol> <li>SQLDelight</li> <li>\u4f5c\u7528\uff1a\u8de8\u5e73\u53f0SQL\u6570\u636e\u5e93\u8bbf\u95ee</li> <li>\u7279\u70b9\uff1a\u4eceSQL\u8bed\u53e5\u751f\u6210\u7c7b\u578b\u5b89\u5168\u7684Kotlin API</li> <li> <p>\u5e73\u53f0\u5b9e\u73b0\uff1a\u5728Android\u4e0a\u4f7f\u7528SQLite\uff0ciOS\u4e0a\u4f7f\u7528SQLite\u6216Core Data</p> </li> <li> <p>Multiplatform Settings</p> </li> <li>\u4f5c\u7528\uff1a\u8de8\u5e73\u53f0\u952e\u503c\u5bf9\u5b58\u50a8</li> <li>\u7279\u70b9\uff1a\u7b80\u5355\u7684\u504f\u597d\u8bbe\u7f6e\u5b58\u50a8</li> <li> <p>\u5e73\u53f0\u5b9e\u73b0\uff1aAndroid\u4e0a\u4f7f\u7528SharedPreferences\uff0ciOS\u4e0a\u4f7f\u7528NSUserDefaults</p> </li> <li> <p>Realm Kotlin</p> </li> <li>\u4f5c\u7528\uff1a\u8de8\u5e73\u53f0\u79fb\u52a8\u6570\u636e\u5e93</li> <li>\u7279\u70b9\uff1a\u5bf9\u8c61\u6570\u636e\u5e93\uff0c\u5b9e\u65f6\u540c\u6b65\u529f\u80fd</li> </ol>"},{"location":"041KMP/010Basic/#_15","title":"\u5e8f\u5217\u5316","text":"<ol> <li>Kotlinx.Serialization</li> <li>\u4f5c\u7528\uff1a\u8de8\u5e73\u53f0\u6570\u636e\u5e8f\u5217\u5316\u6846\u67b6</li> <li>\u7279\u70b9\uff1a\u7f16\u8bd1\u65f6\u4ee3\u7801\u751f\u6210\uff0c\u4e0d\u4f9d\u8d56\u53cd\u5c04</li> <li>\u5b98\u65b9\u7ef4\u62a4\uff1aKotlin\u5b98\u65b9\u5e93</li> </ol>"},{"location":"041KMP/010Basic/#_16","title":"\u5e76\u53d1\u4e0e\u5f02\u6b65","text":"<ol> <li>Kotlinx.Coroutines</li> <li>\u4f5c\u7528\uff1a\u8de8\u5e73\u53f0\u534f\u7a0b\u652f\u6301</li> <li>\u7279\u70b9\uff1a\u7ed3\u6784\u5316\u5e76\u53d1\uff0cFlow API</li> <li> <p>\u5b98\u65b9\u7ef4\u62a4\uff1aKotlin\u5b98\u65b9\u5e93</p> </li> <li> <p>KotlinX.AtomicFu</p> </li> <li>\u4f5c\u7528\uff1a\u63d0\u4f9b\u65e0\u9501\u7ebf\u7a0b\u5b89\u5168\u64cd\u4f5c</li> <li>\u7279\u70b9\uff1a\u5728Native\u5e73\u53f0\u4e0a\u4e5f\u80fd\u9ad8\u6548\u8fd0\u884c\u7684\u539f\u5b50\u64cd\u4f5c</li> </ol>"},{"location":"041KMP/010Basic/#_17","title":"\u4f9d\u8d56\u6ce8\u5165","text":"<ol> <li>Koin</li> <li>\u4f5c\u7528\uff1a\u8f7b\u91cf\u7ea7\u4f9d\u8d56\u6ce8\u5165\u6846\u67b6</li> <li> <p>\u7279\u70b9\uff1a\u7eafKotlin\u5b9e\u73b0\uff0c\u6613\u4e8e\u4f7f\u7528</p> </li> <li> <p>Kodein</p> <ul> <li>\u4f5c\u7528\uff1a\u53e6\u4e00\u4e2a\u4f9d\u8d56\u6ce8\u5165\u6846\u67b6</li> <li>\u7279\u70b9\uff1a\u4e13\u4e3aKotlin\u8bbe\u8ba1\uff0c\u652f\u6301\u591a\u5e73\u53f0</li> </ul> </li> </ol>"},{"location":"041KMP/010Basic/#_18","title":"\u65e5\u671f/\u65f6\u95f4\u5904\u7406","text":"<ol> <li>KotlinX.DateTime<ul> <li>\u4f5c\u7528\uff1a\u8de8\u5e73\u53f0\u65e5\u671f\u548c\u65f6\u95f4API</li> <li>\u7279\u70b9\uff1a\u4e0d\u53ef\u53d8\u7684\u65e5\u671f\u65f6\u95f4\u7c7b\u578b</li> <li>\u5b98\u65b9\u7ef4\u62a4\uff1aKotlin\u5b98\u65b9\u5e93</li> </ul> </li> </ol>"},{"location":"041KMP/010Basic/#_19","title":"\u56fe\u50cf\u5904\u7406","text":"<ol> <li>Imageio<ul> <li>\u4f5c\u7528\uff1a\u8de8\u5e73\u53f0\u56fe\u50cf\u52a0\u8f7d\u548c\u5904\u7406</li> <li>\u7279\u70b9\uff1a\u652f\u6301\u5e38\u89c1\u56fe\u50cf\u683c\u5f0f\u7684\u8bfb\u5199</li> </ul> </li> </ol>"},{"location":"041KMP/010Basic/#ui","title":"UI\u76f8\u5173\uff08\u5171\u4eab\u89c6\u56fe\u6a21\u578b\uff09","text":"<ol> <li> <p>MVIKotlin</p> <ul> <li>\u4f5c\u7528\uff1a\u5b9e\u73b0MVI\u67b6\u6784\u6a21\u5f0f</li> <li>\u7279\u70b9\uff1a\u54cd\u5e94\u5f0fUI\u72b6\u6001\u7ba1\u7406</li> </ul> </li> <li> <p>Decompose</p> <ul> <li>\u4f5c\u7528\uff1a\u7ec4\u4ef6\u5316UI\u5bfc\u822a\u548c\u72b6\u6001\u4fdd\u5b58</li> <li>\u7279\u70b9\uff1a\u4e0eCompose Multiplatform\u914d\u5408\u4f7f\u7528</li> </ul> </li> </ol>"},{"location":"041KMP/010Basic/#_20","title":"\u6d4b\u8bd5","text":"<ol> <li> <p>KotlinTest</p> <ul> <li>\u4f5c\u7528\uff1a\u8de8\u5e73\u53f0\u5355\u5143\u6d4b\u8bd5\u6846\u67b6</li> <li>\u7279\u70b9\uff1a\u7c7b\u4f3c\u4e8eScalaTest\u7684\u98ce\u683c</li> </ul> </li> <li> <p>MockK</p> <ul> <li>\u4f5c\u7528\uff1aKotlin\u6a21\u62df\u6846\u67b6</li> <li>\u7279\u70b9\uff1a\u652f\u6301\u534f\u7a0b\u548c\u8de8\u5e73\u53f0\u6d4b\u8bd5</li> </ul> </li> </ol>"},{"location":"041KMP/010Basic/#_21","title":"\u5176\u4ed6\u5b9e\u7528\u5de5\u5177","text":"<ol> <li> <p>UUID</p> <ul> <li>\u4f5c\u7528\uff1a\u8de8\u5e73\u53f0UUID\u751f\u6210</li> <li>\u7279\u70b9\uff1a\u7b26\u5408\u6807\u51c6\u7684UUID\u5b9e\u73b0</li> </ul> </li> <li> <p>kotlin-logging</p> <ul> <li>\u4f5c\u7528\uff1a\u8de8\u5e73\u53f0\u7684\u7c7b\u4f3cSLF4J\u7684\u65e5\u5fd7\u62bd\u8c61</li> <li>\u7279\u70b9\uff1a\u7b80\u6d01\u7684\u65e5\u5fd7API</li> </ul> </li> <li> <p>Napier</p> <ul> <li>\u4f5c\u7528\uff1a\u7b80\u5355\u7684\u8de8\u5e73\u53f0\u65e5\u5fd7\u5e93</li> <li>\u7279\u70b9\uff1a\u8f7b\u91cf\u7ea7\uff0c\u6613\u4e8e\u914d\u7f6e</li> </ul> </li> <li> <p>KMP-NativeCoroutines</p> <ul> <li>\u4f5c\u7528\uff1a\u7b80\u5316\u4eceSwift/Objective-C\u8c03\u7528Kotlin\u534f\u7a0b</li> <li>\u7279\u70b9\uff1a\u6539\u5584iOS\u5e73\u53f0\u4e0a\u7684\u534f\u7a0b\u4f7f\u7528\u4f53\u9a8c</li> </ul> </li> </ol> <p>\u8fd9\u4e9b\u5e93\u6784\u6210\u4e86KMP\u5f00\u53d1\u7684\u6838\u5fc3\u5de5\u5177\u94fe\uff0c\u5b83\u4eec\u4e13\u95e8\u4e3a\u8de8\u5e73\u53f0\u5f00\u53d1\u8bbe\u8ba1\uff0c\u80fd\u591f\u5728\u4e0d\u540c\u76ee\u6807\u5e73\u53f0\u4e0a\u63d0\u4f9b\u4e00\u81f4\u7684API\u3002\u9009\u62e9\u5408\u9002\u7684\u5e93\u7ec4\u5408\u53ef\u4ee5\u5927\u5927\u63d0\u9ad8\u8de8\u5e73\u53f0\u9879\u76ee\u7684\u5f00\u53d1\u6548\u7387\u548c\u4ee3\u7801\u8d28\u91cf\u3002</p>"},{"location":"041KMP/010Basic/#kmp_10","title":"KMP \u5e38\u89c4\u9762\u8bd5\u9898","text":"\u7b54\u6848"},{"location":"041KMP/010Basic/#_22","title":"Kotlin Multi Platform","text":"\u7b54\u6848"},{"location":"050SystemDesign/010Basic/","title":"\u7cfb\u7edf\u8bbe\u8ba1","text":""},{"location":"050SystemDesign/010Basic/#appsdk","title":"\u8be6\u7ec6\u8bb2\u4e00\u4e0b\u4f60\u4e0a\u4e00\u4e2a\u9879\u76eeApp/SDK\u7684\u8bbe\u8ba1\u601d\u8def\u3002","text":"\u7b80\u77ed\u7b54\u6848 \u8be6\u7ec6\u7b54\u6848 <p>\u6682\u65e0</p>"},{"location":"050SystemDesign/010Basic/#_2","title":"\u4f7f\u7528\u5230\u7684\u8bbe\u8ba1\u6a21\u5f0f","text":"<p>\u5916\u89c2\u6a21\u5f0f\uff0c\u5355\u4f8b\u6a21\u5f0f\uff0c\u7528\u4e8eSDK\u7684\u521d\u59cb\u5316</p> <p>\u5efa\u9020\u8005\u6a21\u5f0f\uff0c\u547d\u4ee4\u6a21\u5f0f\uff0c\u7528\u4e8eAPI\u7684\u94fe\u5f0f\u8c03\u7528</p> <p>\u4ee3\u7406\u6a21\u5f0f\uff0c\u7528\u4e8e\u5b9e\u73b0\u63a5\u53e3\uff0c\u4ee3\u7406\u4e00\u4e9b\u63a5\u53e3\u7684\u5b9e\u73b0</p> <p>\u6a21\u677f\u65b9\u6cd5\u6a21\u5f0f\uff0c\u7528\u4e8eSDK\u8c03\u7528\u7f51\u7edc\u65f6\u76f8\u540c\u6d41\u7a0b\u7684\u5c01\u88c5</p> <p>\u9002\u914d\u5668\u6a21\u5f0f\uff0c\u7528\u4e8eSDK\u83b7\u53d6\u5230\u7f51\u7edc\u6570\u636e\u540e\uff0c\u8f6c\u6362\u4e3a\u63d0\u4f9b\u7ed9App\u4f7f\u7528\u7684Model</p> <p>\u89c2\u5bdf\u8005\u6a21\u5f0f\uff0c\u7528\u4e8e\u63d0\u4f9b\u7ed9App\u7684\u56de\u8c03\u4f7f\u7528</p>"},{"location":"050SystemDesign/010Basic/#sdk","title":"SDK\u8bbe\u8ba1\u601d\u60f3","text":"<p>\u7a33\u5b9a \u5c11\u4f9d\u8d56 \u5355\u4e00\u51fa\u53e3 \u591a\u6a21\u5757\uff0c\u9002\u914d\u5668 \u9488\u5bf9SDK\u7684\u6570\u636e\u6536\u96c6\uff0c\u6bd4\u5982\u9519\u8bef/crash\uff0c\u6587\u4ef6\u65e5\u5fd7</p>"},{"location":"050SystemDesign/010Basic/#_3","title":"\u6211\u6240\u603b\u7ed3\u7684\u4eae\u70b9","text":"<p>api\u548cintern \u533a\u5206\u6838\u5fc3\u4e1a\u52a1\u548cAPI\u5c42\u9762\uff0c\u53ef\u4ee5\u9488\u5bf9intern\u8fdb\u884c\u6df7\u6dc6\u52a0\u56fa\u7b49\u5904\u7406\u3002</p> <p>\u4eceSDK\u8bbe\u8ba1\uff0c\u5230\u94fe\u5f0f\u8c03\u7528\uff0c\u5230\u5b9e\u73b0\u5177\u4f53\u63a5\u53e3\uff0c\u5230\u7f51\u7edc\u6d41\u7a0b\u7684\u6a21\u677f\uff0c\u5404\u79cd\u8bbe\u8ba1\u6a21\u5f0f</p> <p>\u9519\u8bef\u5904\u7406 Response \u6269\u5c55\uff0c\u662f\u6574\u4e2a\u9519\u8bef\u5904\u7406\u7684\u57fa\u77f3\u3002\u6240\u6709\u7684\u7f51\u7edc\u9519\u8bef\u57fa\u672c\u90fd\u662f\u8fd9\u91cc\u3002\u5305\u62ec\u515c\u5e95\u7684\u9519\u8bef\u5904\u7406\u3002 Call \u6269\u5c55\uff0c\u4ec5\u4ec5\u4f5c\u4e3a\u6267\u884c\u548c\u89e3\u6790\u7684\u9519\u8bef\u629b\u51fa Interceptor\u81ea\u52a8\u66f4\u65b0accessToken</p> <p>\u81ea\u5b9a\u4e49Retrofit Converter.Factory() \u5b9e\u73b0\u5bf9XML\u4ee5\u53caJSON\u7684\u52a8\u6001\u89e3\u6790\uff0c\u4e0d\u9700\u8981\u989d\u5916\u7684\u6210\u672c\u53bb\u5b9e\u73b0\u3002</p> <p>SPIN\u52a0\u5bc6\uff0cRSTO\u52a0\u5bc6\uff1f\u914d\u5408\u540e\u53f0\uff0c\u8f66\u8f86\u7aef\u8fdb\u884c\u7684\u52a0\u5bc6\u901a\u4fe1\u3002\u6d89\u53ca\u5230\u6709\u98ce\u9669\u7684\u64cd\u4f5c\u90fd\u9700\u8981SPIN\u3002</p> <p>\u4f7f\u7528Kotlin\u4ee5\u53ca\u534f\u7a0b\uff0c\u907f\u514dSDK\u5185\u90e8\u51fa\u73b0\u5185\u5b58\u6cc4\u6f0f\u3002 execute\u7684\u65f6\u5019\u53ef\u4ee5\u8ba9\u7528\u6237\u81ea\u5b9a\u4e49\u534f\u7a0bscope\u3002Processor\u91cc\u9762\u505a\u597d\u5224\u65ad\u5c31\u884c\u3002\u5426\u5219\u5c31\u662f\u9ed8\u8ba4GlobalScope\u3002</p> <p>\u672c\u5730\u65e5\u5fd7\u6587\u4ef6\u5904\u7406</p>"},{"location":"050SystemDesign/010Basic/#_4","title":"\u672a\u6765\u4f18\u5316","text":"<p>Android15\u7684\u4ee3\u7801\u548c\u8001\u7248\u672c\u7684\u4ee3\u7801\u5408\u5e76\u5230\u540c\u4e00\u4e2a\u5206\u652f\u3002 \u4f7f\u7528Kotlin Multiplatform\u5bf9\u9879\u76ee\u8fdb\u884c\u91cd\u6784\u3002\u51cf\u5c11\u65b0\u589e\u529f\u80fd\u548c\u7ef4\u62a4\u6210\u672c\u3002\u98ce\u9669\u4e2d\u7b49\uff0c\u65f6\u95f4\u9700\u8981\u8f83\u591a\u3002 UI\u4f7f\u7528Compose\u91cd\u6784\u3002\u53ef\u64cd\u6027\u5927\u3002 \u81ea\u52a8\u5316jenkins\u6253\u5305\u3002\u56f0\u96be\u6765\u81ea\u4e8e\u516c\u53f8\u80fd\u5426\u63d0\u4f9b\u652f\u6301\u3002</p>"},{"location":"050SystemDesign/010Basic/#_5","title":"\u5982\u679c\u8ba9\u4f60\u4f18\u5316\u4e0a\u4e00\u4e2a\u9879\u76ee\uff0c\u4f60\u89c9\u5f97\u8fd8\u6709\u54ea\u4e9b\u65b9\u5411\uff1f","text":"\u7b54\u6848"},{"location":"050SystemDesign/010Basic/#app-sdk","title":"App, SDK\u9879\u76ee\u4e2d\u5e38\u7528\u7684\u8bbe\u8ba1\u6a21\u5f0f","text":"\u7b54\u6848 <p>\u4ee5\u4e0b\u662fAndroid App\u548cSDK\u9879\u76ee\u4e2d\u5e38\u7528\u7684\u8bbe\u8ba1\u6a21\u5f0f\uff1a</p> <ol> <li> <p>\u5355\u4f8b\u6a21\u5f0f\uff08Singleton\uff09- \u786e\u4fdd\u4e00\u4e2a\u7c7b\u53ea\u6709\u4e00\u4e2a\u5b9e\u4f8b\uff0c\u5e38\u7528\u4e8e\u7ba1\u7406\u7cfb\u7edf\u670d\u52a1\u3001\u6570\u636e\u5e93\u8fde\u63a5\u7b49</p> </li> <li> <p>\u89c2\u5bdf\u8005\u6a21\u5f0f\uff08Observer\uff09- \u5b9a\u4e49\u5bf9\u8c61\u95f4\u7684\u4e00\u5bf9\u591a\u4f9d\u8d56\u5173\u7cfb\uff0c\u5f53\u4e00\u4e2a\u5bf9\u8c61\u72b6\u6001\u6539\u53d8\u65f6\uff0c\u6240\u6709\u4f9d\u8d56\u5b83\u7684\u5bf9\u8c61\u90fd\u4f1a\u6536\u5230\u901a\u77e5\uff0c\u5982LiveData\u7ec4\u4ef6</p> </li> <li> <p>\u5de5\u5382\u6a21\u5f0f\uff08Factory Method\uff09- \u5b9a\u4e49\u4e00\u4e2a\u521b\u5efa\u5bf9\u8c61\u7684\u63a5\u53e3\uff0c\u8ba9\u5b50\u7c7b\u51b3\u5b9a\u5b9e\u4f8b\u5316\u54ea\u4e2a\u7c7b\uff0c\u5e38\u7528\u4e8e\u521b\u5efaView\u3001Fragment\u7b49</p> </li> <li> <p>\u5efa\u9020\u8005\u6a21\u5f0f\uff08Builder\uff09- \u7528\u4e8e\u521b\u5efa\u590d\u6742\u5bf9\u8c61\uff0c\u5982AlertDialog.Builder\u3001Retrofit.Builder\u7b49</p> </li> <li> <p>\u9002\u914d\u5668\u6a21\u5f0f\uff08Adapter\uff09- RecyclerView.Adapter\u662f\u6700\u5178\u578b\u7684\u4f8b\u5b50\uff0c\u5c06\u6570\u636e\u96c6\u8f6c\u6362\u4e3aUI\u7ec4\u4ef6</p> </li> <li> <p>\u7b56\u7565\u6a21\u5f0f\uff08Strategy\uff09- \u5b9a\u4e49\u4e00\u7cfb\u5217\u7b97\u6cd5\uff0c\u4f7f\u5b83\u4eec\u53ef\u4ee5\u4e92\u76f8\u66ff\u6362\uff0c\u5982\u4e0d\u540c\u7684\u52a8\u753b\u6548\u679c\u3001\u8ba4\u8bc1\u65b9\u5f0f\u7b49</p> </li> <li> <p>\u547d\u4ee4\u6a21\u5f0f\uff08Command\uff09- \u5c06\u8bf7\u6c42\u5c01\u88c5\u4e3a\u5bf9\u8c61\uff0c\u5982Android\u4e2d\u7684Runnable\u63a5\u53e3</p> </li> <li> <p>\u88c5\u9970\u6a21\u5f0f\uff08Decorator\uff09- ContextWrapper\u3001ContextThemeWrapper\u7b49\u5728Android\u4e2d\u7684\u5e94\u7528</p> </li> <li> <p>MVC/MVP/MVVM\u67b6\u6784\u6a21\u5f0f - \u7528\u4e8e\u5206\u79bb\u5173\u6ce8\u70b9\uff0c\u63d0\u9ad8\u4ee3\u7801\u53ef\u7ef4\u62a4\u6027</p> </li> <li> <p>\u8d23\u4efb\u94fe\u6a21\u5f0f\uff08Chain of Responsibility\uff09- \u5982Android\u4e8b\u4ef6\u5206\u53d1\u673a\u5236</p> </li> <li> <p>\u4ee3\u7406\u6a21\u5f0f\uff08Proxy\uff09- ContentProvider\u4f5c\u4e3a\u6570\u636e\u8bbf\u95ee\u7684\u4ee3\u7406</p> </li> <li> <p>\u7ec4\u5408\u6a21\u5f0f\uff08Composite\uff09- ViewGroup\u548cView\u7684\u5173\u7cfb\u4f53\u73b0\u4e86\u7ec4\u5408\u6a21\u5f0f</p> </li> <li> <p>\u6a21\u677f\u65b9\u6cd5\u6a21\u5f0f\uff08Template Method\uff09- Activity\u751f\u547d\u5468\u671f\u65b9\u6cd5\u5982onCreate()\u3001onResume()\u7b49</p> </li> <li> <p>\u4eab\u5143\u6a21\u5f0f\uff08Flyweight\uff09- \u7cfb\u7edf\u8d44\u6e90\u6c60\u5982\u7ebf\u7a0b\u6c60\u3001\u8fde\u63a5\u6c60\u7b49</p> </li> </ol> <p>\u8fd9\u4e9b\u8bbe\u8ba1\u6a21\u5f0f\u5e2e\u52a9\u5f00\u53d1\u8005\u6784\u5efa\u66f4\u52a0\u6a21\u5757\u5316\u3001\u53ef\u6269\u5c55\u548c\u6613\u4e8e\u7ef4\u62a4\u7684Android\u5e94\u7528\u7a0b\u5e8f\u548cSDK\u3002</p> <p>\u516c\u53f8\u9879\u76eeSDK\u4f7f\u7528\u7684\u662f\u5355\u4f8b\uff0c\u6865\u63a5\u6a21\u5f0fAPI\u5206\u5c42\u8bbe\u8ba1\uff0c\u7b56\u7565\u6a21\u5f0f\u591a\u4e2a\u4e0d\u540c\u7684JV\u767b\u5f55\u65b9\u5f0f\uff0c </p>"},{"location":"050SystemDesign/010Basic/#android","title":"\u8bbe\u8ba1\u4e00\u4e2aAndroid\u5e73\u53f0\u591a\u7ebf\u7a0b\u53ef\u65ad\u70b9\u4e0b\u8f7d\u7684\u7a0b\u5e8f","text":"\u7b54\u6848"},{"location":"050SystemDesign/010Basic/#android_1","title":"Android \u591a\u7ebf\u7a0b\u53ef\u65ad\u70b9\u4e0b\u8f7d\u65b9\u6848","text":""},{"location":"050SystemDesign/010Basic/#_6","title":"\u4e00\u3001\u6574\u4f53\u67b6\u6784\u8bbe\u8ba1","text":""},{"location":"050SystemDesign/010Basic/#1","title":"1. \u4e09\u5c42\u67b6\u6784","text":"<ul> <li>\u8868\u793a\u5c42\uff1aActivity/Fragment \u7528\u4e8e\u5c55\u793a\u4e0b\u8f7d\u8fdb\u5ea6\u548c\u63d0\u4f9b\u7528\u6237\u4ea4\u4e92</li> <li>\u4e1a\u52a1\u5c42\uff1aDownloadManager \u7ba1\u7406\u4e0b\u8f7d\u4efb\u52a1\u548c\u7ebf\u7a0b</li> <li>\u6570\u636e\u5c42\uff1a\u672c\u5730\u6570\u636e\u5e93\u5b58\u50a8\u4e0b\u8f7d\u4fe1\u606f\u548c\u65ad\u70b9\u4fe1\u606f</li> </ul>"},{"location":"050SystemDesign/010Basic/#2","title":"2. \u6838\u5fc3\u7ec4\u4ef6","text":"<ul> <li>DownloadService\uff1a\u524d\u53f0\u670d\u52a1\uff0c\u8d1f\u8d23\u6267\u884c\u4e0b\u8f7d\u4efb\u52a1</li> <li>DownloadTask\uff1a\u4e0b\u8f7d\u4efb\u52a1\u5bf9\u8c61\uff0c\u5305\u542b\u6587\u4ef6\u4fe1\u606f\u548c\u72b6\u6001</li> <li>DownloadThread\uff1a\u4e0b\u8f7d\u7ebf\u7a0b\uff0c\u8d1f\u8d23\u6587\u4ef6\u5206\u5757\u4e0b\u8f7d</li> <li>DownloadDatabase\uff1a\u5b58\u50a8\u4e0b\u8f7d\u5386\u53f2\u548c\u65ad\u70b9\u4fe1\u606f</li> <li>DownloadNotification\uff1a\u524d\u53f0\u901a\u77e5\uff0c\u663e\u793a\u4e0b\u8f7d\u8fdb\u5ea6</li> </ul>"},{"location":"050SystemDesign/010Basic/#_7","title":"\u4e8c\u3001\u6587\u4ef6\u5904\u7406\u8be6\u7ec6\u65b9\u6848","text":""},{"location":"050SystemDesign/010Basic/#1-randomaccessfile","title":"1. RandomAccessFile \u7684\u4f7f\u7528","text":"<pre><code>// \u521d\u59cb\u5316\u6587\u4ef6\nRandomAccessFile raf = new RandomAccessFile(saveFile, \"rw\");\n// \u9884\u5206\u914d\u6587\u4ef6\u5927\u5c0f\nraf.setLength(contentLength);\n// \u5173\u95ed\u8d44\u6e90\nraf.close();\n\n// \u7ebf\u7a0b\u4e2d\u5199\u5165\u6570\u636e\nRandomAccessFile threadRaf = new RandomAccessFile(saveFile, \"rw\");\n// \u5b9a\u4f4d\u5230\u4e0b\u8f7d\u5757\u7684\u8d77\u59cb\u4f4d\u7f6e\nthreadRaf.seek(downloadPart.currentPos);\n// \u5199\u5165\u6570\u636e\nthreadRaf.write(buffer, 0, len);\n// \u5173\u95ed\u65f6\u4e0d\u8981\u7acb\u5373\u5173\u95ed\uff0c\u7b49\u5230\u5757\u4e0b\u8f7d\u5b8c\u6210\u6216\u6682\u505c\u65f6\u5173\u95ed\n</code></pre>"},{"location":"050SystemDesign/010Basic/#2_1","title":"2. \u6587\u4ef6\u9501\u4e0e\u7ebf\u7a0b\u5b89\u5168","text":"<ul> <li>\u4f7f\u7528 <code>FileChannel</code> \u548c <code>FileLock</code> \u786e\u4fdd\u591a\u7ebf\u7a0b\u5199\u5165\u5b89\u5168</li> <li>\u6bcf\u4e2a\u7ebf\u7a0b\u9501\u5b9a\u81ea\u5df1\u7684\u6587\u4ef6\u533a\u57df\u8fdb\u884c\u5199\u5165</li> <li>\u4f7f\u7528 <code>synchronized</code> \u5757\u4fdd\u62a4\u5171\u4eab\u8d44\u6e90\u8bbf\u95ee</li> </ul>"},{"location":"050SystemDesign/010Basic/#3","title":"3. \u6587\u4ef6\u5b58\u50a8\u4f4d\u7f6e\u9009\u62e9","text":"<ul> <li>Android 10+ \u9002\u914d\u5206\u533a\u5b58\u50a8</li> <li>\u5c0f\u6587\u4ef6\u5b58\u50a8\u5728\u5185\u90e8\u5b58\u50a8 <code>context.getFilesDir()</code></li> <li>\u5927\u6587\u4ef6\u548c\u5a92\u4f53\u6587\u4ef6\u5b58\u50a8\u5728\u5916\u90e8\u5b58\u50a8 <code>Environment.getExternalStoragePublicDirectory()</code></li> <li>\u4f7f\u7528 <code>MediaStore</code> API \u5904\u7406\u5206\u533a\u5b58\u50a8\u9650\u5236</li> </ul>"},{"location":"050SystemDesign/010Basic/#_8","title":"\u4e09\u3001\u4e0b\u8f7d\u4efb\u52a1\u6570\u636e\u6a21\u578b","text":""},{"location":"050SystemDesign/010Basic/#1_1","title":"1. \u4e0b\u8f7d\u4efb\u52a1\u6a21\u578b","text":"<pre><code>public class DownloadTask {\n    String url;                // \u4e0b\u8f7d\u5730\u5740\n    String filePath;           // \u4fdd\u5b58\u8def\u5f84\n    String fileName;           // \u6587\u4ef6\u540d\n    long fileSize;             // \u6587\u4ef6\u603b\u5927\u5c0f\n    long downloadedSize;       // \u5df2\u4e0b\u8f7d\u5927\u5c0f\n    int threadCount;           // \u7ebf\u7a0b\u6570\u91cf\n    int status;                // \u4efb\u52a1\u72b6\u6001\n    long lastModified;         // \u6587\u4ef6\u6700\u540e\u4fee\u6539\u65f6\u95f4\n    String etag;               // HTTP ETag\n    List&lt;DownloadPart&gt; parts;  // \u5206\u5757\u4fe1\u606f\n}\n</code></pre>"},{"location":"050SystemDesign/010Basic/#2_2","title":"2. \u4e0b\u8f7d\u5206\u5757\u6a21\u578b","text":"<pre><code>public class DownloadPart {\n    long id;                   // \u5206\u5757ID\n    long taskId;               // \u6240\u5c5e\u4efb\u52a1ID\n    int threadId;              // \u7ebf\u7a0bID\n    long startPos;             // \u8d77\u59cb\u4f4d\u7f6e\n    long endPos;               // \u7ed3\u675f\u4f4d\u7f6e\n    long currentPos;           // \u5f53\u524d\u4f4d\u7f6e\n    int status;                // \u72b6\u6001\n    int retryCount;            // \u91cd\u8bd5\u6b21\u6570\n}\n</code></pre>"},{"location":"050SystemDesign/010Basic/#_9","title":"\u56db\u3001\u591a\u7ebf\u7a0b\u7ba1\u7406\u673a\u5236","text":""},{"location":"050SystemDesign/010Basic/#1_2","title":"1. \u7ebf\u7a0b\u6c60\u914d\u7f6e","text":"<pre><code>private final ExecutorService threadPool = new ThreadPoolExecutor(\n    3,                              // \u6838\u5fc3\u7ebf\u7a0b\u6570\n    5,                              // \u6700\u5927\u7ebf\u7a0b\u6570\n    60L,                            // \u7a7a\u95f2\u7ebf\u7a0b\u5b58\u6d3b\u65f6\u95f4\n    TimeUnit.SECONDS,               // \u65f6\u95f4\u5355\u4f4d\n    new LinkedBlockingQueue&lt;&gt;(),    // \u5de5\u4f5c\u961f\u5217\n    new ThreadPoolExecutor.CallerRunsPolicy()  // \u62d2\u7edd\u7b56\u7565\n);\n</code></pre>"},{"location":"050SystemDesign/010Basic/#2_3","title":"2. \u7ebf\u7a0b\u6570\u91cf\u52a8\u6001\u8c03\u6574","text":"<ul> <li>\u6839\u636e\u7f51\u7edc\u7c7b\u578b\u8c03\u6574\uff08WiFi \u53ef\u7528\u66f4\u591a\u7ebf\u7a0b\uff09</li> <li>\u6839\u636e\u6587\u4ef6\u5927\u5c0f\u8c03\u6574\uff08\u5927\u6587\u4ef6\u5206\u914d\u66f4\u591a\u7ebf\u7a0b\uff09</li> <li>\u6839\u636e\u8bbe\u5907\u6027\u80fd\u8c03\u6574\uff08\u9ad8\u6027\u80fd\u8bbe\u5907\u5206\u914d\u66f4\u591a\u7ebf\u7a0b\uff09</li> </ul>"},{"location":"050SystemDesign/010Basic/#3_1","title":"3. \u7ebf\u7a0b\u72b6\u6001\u76d1\u63a7","text":"<ul> <li>\u7ef4\u62a4\u7ebf\u7a0b\u72b6\u6001\u96c6\u5408</li> <li>\u5b9a\u671f\u68c0\u67e5\u50f5\u6b7b\u7ebf\u7a0b\u5e76\u91cd\u542f</li> <li>\u5b9e\u73b0\u7ebf\u7a0b\u8fdb\u5ea6\u56de\u8c03\u673a\u5236</li> </ul>"},{"location":"050SystemDesign/010Basic/#_10","title":"\u4e94\u3001\u65ad\u70b9\u7eed\u4f20\u8be6\u7ec6\u5b9e\u73b0","text":""},{"location":"050SystemDesign/010Basic/#1-http","title":"1. HTTP \u8bf7\u6c42\u5934\u5904\u7406","text":"<pre><code>// \u6dfb\u52a0 Range \u8bf7\u6c42\u5934\nconnection.setRequestProperty(\"Range\", \"bytes=\" + part.currentPos + \"-\" + part.endPos);\n\n// \u6dfb\u52a0 If-Match \u548c If-Modified-Since \u5934\uff0c\u9632\u6b62\u6587\u4ef6\u53d8\u66f4\nif (task.etag != null) {\n    connection.setRequestProperty(\"If-Match\", task.etag);\n}\nif (task.lastModified &gt; 0) {\n    connection.setRequestProperty(\"If-Modified-Since\", \n        new Date(task.lastModified).toGMTString());\n}\n</code></pre>"},{"location":"050SystemDesign/010Basic/#2_4","title":"2. \u65ad\u70b9\u4fe1\u606f\u6301\u4e45\u5316","text":"<ul> <li>\u4f7f\u7528 Room \u6570\u636e\u5e93\u5b58\u50a8</li> <li>\u521b\u5efa DAO \u63a5\u53e3\u5904\u7406\u6570\u636e\u64cd\u4f5c</li> <li>\u4f7f\u7528\u4e8b\u52a1\u786e\u4fdd\u6570\u636e\u4e00\u81f4\u6027</li> </ul> <pre><code>@Database(entities = {DownloadTask.class, DownloadPart.class}, version = 1)\npublic abstract class DownloadDatabase extends RoomDatabase {\n    public abstract DownloadTaskDao taskDao();\n    public abstract DownloadPartDao partDao();\n}\n</code></pre>"},{"location":"050SystemDesign/010Basic/#3_2","title":"3. \u8fdb\u5ea6\u66f4\u65b0\u7b56\u7565","text":"<ul> <li>\u4f7f\u7528 <code>AtomicLong</code> \u8bb0\u5f55\u5df2\u4e0b\u8f7d\u5927\u5c0f</li> <li>\u6279\u91cf\u66f4\u65b0\u51cf\u5c11\u6570\u636e\u5e93\u64cd\u4f5c</li> <li>\u91c7\u7528\u589e\u91cf\u66f4\u65b0\u800c\u975e\u5168\u91cf\u66f4\u65b0</li> </ul>"},{"location":"050SystemDesign/010Basic/#_11","title":"\u516d\u3001\u7f51\u7edc\u5904\u7406","text":""},{"location":"050SystemDesign/010Basic/#1_3","title":"1. \u7f51\u7edc\u8bf7\u6c42\u5b9e\u73b0","text":"<pre><code>private HttpURLConnection createConnection(String url, DownloadPart part) throws IOException {\n    HttpURLConnection connection = (HttpURLConnection) new URL(url).openConnection();\n    connection.setRequestMethod(\"GET\");\n    connection.setReadTimeout(30000);\n    connection.setConnectTimeout(15000);\n    connection.setRequestProperty(\"Accept-Encoding\", \"identity\");\n    connection.setRequestProperty(\"Range\", \"bytes=\" + part.currentPos + \"-\" + part.endPos);\n    return connection;\n}\n</code></pre>"},{"location":"050SystemDesign/010Basic/#2_5","title":"2. \u7f51\u7edc\u76d1\u542c\u4e0e\u81ea\u52a8\u8c03\u6574","text":"<ul> <li>\u6ce8\u518c <code>ConnectivityManager.NetworkCallback</code> \u76d1\u542c\u7f51\u7edc\u53d8\u5316</li> <li>\u5b9e\u73b0\u7f51\u7edc\u5207\u6362\u65f6\u7684\u81ea\u52a8\u6682\u505c/\u6062\u590d</li> <li>\u6839\u636e\u7f51\u7edc\u7c7b\u578b\u8c03\u6574\u4e0b\u8f7d\u901f\u5ea6\u548c\u7ebf\u7a0b\u6570</li> </ul>"},{"location":"050SystemDesign/010Basic/#3_3","title":"3. \u7f51\u7edc\u5f02\u5e38\u5904\u7406\u7b56\u7565","text":"<ul> <li>HTTP \u72b6\u6001\u7801\u5904\u7406\uff08\u652f\u6301 206 \u72b6\u6001\u7801\uff09</li> <li>\u5b9e\u73b0\u6307\u6570\u9000\u907f\u7b97\u6cd5\u8fdb\u884c\u91cd\u8bd5</li> <li>\u5904\u7406\u7279\u6b8a\u60c5\u51b5\uff08\u670d\u52a1\u5668\u4e0d\u652f\u6301 Range \u8bf7\u6c42\uff09</li> </ul>"},{"location":"050SystemDesign/010Basic/#service","title":"\u4e03\u3001Service \u4e0e\u751f\u547d\u5468\u671f\u7ba1\u7406","text":""},{"location":"050SystemDesign/010Basic/#1_4","title":"1. \u524d\u53f0\u670d\u52a1\u5b9e\u73b0","text":"<pre><code>private void startForeground() {\n    NotificationCompat.Builder builder = new NotificationCompat.Builder(this, CHANNEL_ID)\n        .setSmallIcon(R.drawable.ic_download)\n        .setContentTitle(\"\u4e0b\u8f7d\u7ba1\u7406\u5668\")\n        .setContentText(\"\u6b63\u5728\u4e0b\u8f7d...\")\n        .setPriority(NotificationCompat.PRIORITY_LOW)\n        .setProgress(100, 0, false);\n\n    // \u6dfb\u52a0\u64cd\u4f5c\u6309\u94ae\n    Intent pauseIntent = new Intent(this, DownloadService.class);\n    pauseIntent.setAction(ACTION_PAUSE_ALL);\n    PendingIntent pausePendingIntent = PendingIntent.getService(this, 0, pauseIntent, \n        PendingIntent.FLAG_UPDATE_CURRENT | PendingIntent.FLAG_IMMUTABLE);\n    builder.addAction(R.drawable.ic_pause, \"\u6682\u505c\u5168\u90e8\", pausePendingIntent);\n\n    startForeground(NOTIFICATION_ID, builder.build());\n}\n</code></pre>"},{"location":"050SystemDesign/010Basic/#2_6","title":"2. \u8fdb\u7a0b\u4fdd\u6d3b\u7b56\u7565","text":"<ul> <li>\u4f7f\u7528 <code>START_STICKY</code> \u8fd4\u56de\u503c</li> <li>\u5b9e\u73b0\u4f4e\u5185\u5b58\u91cd\u5efa\u673a\u5236</li> <li>\u4f7f\u7528 <code>WorkManager</code> \u4f5c\u4e3a\u5907\u9009\u91cd\u542f\u673a\u5236</li> </ul>"},{"location":"050SystemDesign/010Basic/#3-android","title":"3. Android \u7248\u672c\u9002\u914d","text":"<ul> <li>Android 8.0+ \u524d\u53f0\u670d\u52a1\u901a\u77e5\u6e20\u9053</li> <li>Android 10+ \u5206\u533a\u5b58\u50a8\u9002\u914d</li> <li>Android 12+ \u7cbe\u786e\u95f9\u949f\u6743\u9650</li> </ul>"},{"location":"050SystemDesign/010Basic/#_12","title":"\u516b\u3001\u7528\u6237\u754c\u9762\u4ea4\u4e92","text":""},{"location":"050SystemDesign/010Basic/#1_5","title":"1. \u8fdb\u5ea6\u56de\u8c03\u63a5\u53e3","text":"<pre><code>public interface DownloadListener {\n    void onProgressUpdate(String url, long downloaded, long total);\n    void onStatusChanged(String url, int status);\n    void onError(String url, int errorCode, String errorMessage);\n    void onComplete(String url, File file);\n}\n</code></pre>"},{"location":"050SystemDesign/010Basic/#2_7","title":"2. \u901a\u77e5\u66f4\u65b0\u673a\u5236","text":"<ul> <li>\u4f7f\u7528\u8282\u6d41\u6280\u672f\u9650\u5236\u901a\u77e5\u66f4\u65b0\u9891\u7387</li> <li>\u652f\u6301\u4e0b\u8f7d\u901f\u5ea6\u663e\u793a</li> <li>\u5b9e\u73b0\u53ef\u6269\u5c55\u901a\u77e5\u663e\u793a\u8be6\u7ec6\u8fdb\u5ea6</li> </ul>"},{"location":"050SystemDesign/010Basic/#3_4","title":"3. \u7528\u6237\u63a7\u5236\u529f\u80fd","text":"<ul> <li>\u6682\u505c/\u7ee7\u7eed\u5355\u4e2a\u4efb\u52a1</li> <li>\u6682\u505c/\u7ee7\u7eed\u5168\u90e8\u4efb\u52a1</li> <li>\u53d6\u6d88\u4efb\u52a1\u5e76\u5220\u9664\u6587\u4ef6</li> <li>\u4ec5\u53d6\u6d88\u4efb\u52a1\u4fdd\u7559\u6587\u4ef6</li> </ul>"},{"location":"050SystemDesign/010Basic/#_13","title":"\u4e5d\u3001\u6027\u80fd\u4f18\u5316","text":""},{"location":"050SystemDesign/010Basic/#1_6","title":"1. \u7f13\u51b2\u533a\u4f18\u5316","text":"<pre><code>// \u4f7f\u7528\u7f13\u51b2\u533a\u51cf\u5c11IO\u6b21\u6570\nbyte[] buffer = new byte[8 * 1024]; // 8KB \u7f13\u51b2\u533a\nint len;\nwhile ((len = is.read(buffer)) != -1) {\n    randomFile.write(buffer, 0, len);\n    downloadedSize.addAndGet(len);\n    part.currentPos += len;\n\n    // \u68c0\u67e5\u6682\u505c/\u53d6\u6d88\u4fe1\u53f7\n    if (shouldStop()) break;\n}\n</code></pre>"},{"location":"050SystemDesign/010Basic/#2_8","title":"2. \u5185\u5b58\u4f7f\u7528\u4f18\u5316","text":"<ul> <li>\u907f\u514d\u5728\u5faa\u73af\u4e2d\u521b\u5efa\u5bf9\u8c61</li> <li>\u4f7f\u7528\u8f6f\u5f15\u7528\u7f13\u5b58\u4e0b\u8f7d\u4fe1\u606f</li> <li>\u53ca\u65f6\u5173\u95ed\u8d44\u6e90\u9632\u6b62\u6cc4\u6f0f</li> </ul>"},{"location":"050SystemDesign/010Basic/#3_5","title":"3. \u7535\u6c60\u4f18\u5316","text":"<ul> <li>\u76d1\u542c\u7535\u6c60\u72b6\u6001\u8c03\u6574\u4e0b\u8f7d\u7b56\u7565</li> <li>\u652f\u6301\u4f4e\u7535\u91cf\u81ea\u52a8\u6682\u505c</li> <li>\u4ec5\u5728\u5145\u7535\u65f6\u4e0b\u8f7d\u5927\u6587\u4ef6</li> </ul>"},{"location":"050SystemDesign/010Basic/#_14","title":"\u5341\u3001\u5f02\u5e38\u5904\u7406\u4e0e\u6062\u590d","text":""},{"location":"050SystemDesign/010Basic/#1_7","title":"1. \u4e0b\u8f7d\u5f02\u5e38\u5206\u7c7b","text":"<ul> <li>\u7f51\u7edc\u5f02\u5e38\uff08\u8fde\u63a5\u8d85\u65f6\u3001\u670d\u52a1\u5668\u9519\u8bef\uff09</li> <li>\u6587\u4ef6\u5f02\u5e38\uff08\u5b58\u50a8\u7a7a\u95f4\u4e0d\u8db3\u3001\u6743\u9650\u95ee\u9898\uff09</li> <li>\u7ebf\u7a0b\u5f02\u5e38\uff08\u4e2d\u65ad\u3001\u6267\u884c\u5f02\u5e38\uff09</li> </ul>"},{"location":"050SystemDesign/010Basic/#2_9","title":"2. \u5f02\u5e38\u6062\u590d\u673a\u5236","text":"<pre><code>private void handleException(DownloadPart part, Exception e) {\n    if (e instanceof SocketTimeoutException) {\n        // \u8d85\u65f6\u91cd\u8bd5\n        if (part.retryCount &lt; MAX_RETRY) {\n            part.retryCount++;\n            part.status = STATUS_WAITING;\n            partDao.update(part);\n            // \u5ef6\u8fdf\u540e\u91cd\u65b0\u52a0\u5165\u961f\u5217\n            scheduleRetry(part, getRetryDelay(part.retryCount));\n        } else {\n            // \u8d85\u8fc7\u6700\u5927\u91cd\u8bd5\u6b21\u6570\n            part.status = STATUS_ERROR;\n            partDao.update(part);\n            notifyError(part.taskId, ERROR_TIMEOUT, \"\u4e0b\u8f7d\u8d85\u65f6\");\n        }\n    } else if (e instanceof IOException) {\n        // \u5904\u7406IO\u5f02\u5e38\n        // ...\n    }\n}\n</code></pre>"},{"location":"050SystemDesign/010Basic/#3_6","title":"3. \u6587\u4ef6\u5b8c\u6574\u6027\u9a8c\u8bc1","text":"<ul> <li>\u4e0b\u8f7d\u5b8c\u6210\u540e\u9a8c\u8bc1\u6587\u4ef6\u5927\u5c0f</li> <li>\u652f\u6301MD5/SHA\u6821\u9a8c\uff08\u5982\u679c\u670d\u52a1\u5668\u63d0\u4f9b\u6821\u9a8c\u548c\uff09</li> <li>\u652f\u6301\u635f\u574f\u6587\u4ef6\u4fee\u590d\uff08\u91cd\u65b0\u4e0b\u8f7d\u635f\u574f\u90e8\u5206\uff09</li> </ul>"},{"location":"050SystemDesign/010Basic/#_15","title":"\u5341\u4e00\u3001\u5b89\u5168\u4e0e\u6743\u9650","text":""},{"location":"050SystemDesign/010Basic/#1-https","title":"1. HTTPS \u652f\u6301","text":"<ul> <li>\u652f\u6301 SSL/TLS \u8fde\u63a5</li> <li>\u5904\u7406\u8bc1\u4e66\u9a8c\u8bc1\u95ee\u9898</li> <li>\u652f\u6301\u81ea\u7b7e\u540d\u8bc1\u4e66\uff08\u53ef\u9009\uff09</li> </ul>"},{"location":"050SystemDesign/010Basic/#2_10","title":"2. \u6743\u9650\u5904\u7406","text":"<ul> <li>\u52a8\u6001\u7533\u8bf7\u5b58\u50a8\u6743\u9650</li> <li>\u5904\u7406\u6743\u9650\u62d2\u7edd\u573a\u666f</li> <li>\u9002\u914d Android 13+ \u7ec6\u5206\u6587\u4ef6\u6743\u9650</li> </ul>"},{"location":"050SystemDesign/010Basic/#3_7","title":"3. \u4e0b\u8f7d\u6587\u4ef6\u626b\u63cf","text":"<ul> <li>\u4e0b\u8f7d\u5b8c\u6210\u540e\u8fdb\u884c\u75c5\u6bd2\u626b\u63cf</li> <li>\u96c6\u6210\u7cfb\u7edf MediaScanner \u66f4\u65b0\u5a92\u4f53\u5e93</li> <li>\u652f\u6301\u6587\u4ef6\u7c7b\u578b\u8bc6\u522b\u548c\u8fc7\u6ee4</li> </ul> <p>\u8fd9\u4efd\u8be6\u7ec6\u65b9\u6848\u6db5\u76d6\u4e86Android\u591a\u7ebf\u7a0b\u65ad\u70b9\u4e0b\u8f7d\u7684\u6240\u6709\u6838\u5fc3\u73af\u8282\u548c\u6280\u672f\u7ec6\u8282\uff0c\u65e2\u8003\u8651\u4e86\u529f\u80fd\u5b8c\u6574\u6027\uff0c\u4e5f\u517c\u987e\u4e86\u6027\u80fd\u4f18\u5316\u548c\u7528\u6237\u4f53\u9a8c\u3002\u65b9\u6848\u4e2d\u7684\u4ee3\u7801\u7247\u6bb5\u53ef\u4ee5\u76f4\u63a5\u4f5c\u4e3a\u5b9e\u73b0\u53c2\u8003\uff0c\u5e2e\u52a9\u5f00\u53d1\u8005\u5feb\u901f\u6784\u5efa\u4e00\u4e2a\u5065\u58ee\u7684\u4e0b\u8f7d\u7cfb\u7edf\u3002</p>"},{"location":"050SystemDesign/010Basic/#androidsdk","title":"\u8bbe\u8ba1\u4e00\u4e2aAndroid\u5e73\u53f0\u4e0a\u4f20\u65e5\u5fd7\u7684SDK","text":"\u7b54\u6848"},{"location":"050SystemDesign/010Basic/#android-sdk","title":"Android \u65e5\u5fd7\u4e0a\u4f20 SDK \u8bbe\u8ba1","text":""},{"location":"050SystemDesign/010Basic/#_16","title":"\u6982\u8ff0","text":"<p>\u8fd9\u4e2a SDK \u5c06\u4f7f Android \u5e94\u7528\u7a0b\u5e8f\u80fd\u591f\u6536\u96c6\u3001\u7f13\u5b58\u548c\u4e0a\u4f20\u65e5\u5fd7\u5230\u8fdc\u7a0b\u670d\u52a1\u5668\u3002\u8bbe\u8ba1\u91cd\u70b9\u5173\u6ce8\u6548\u7387\u3001\u53ef\u9760\u6027\u4ee5\u53ca\u6700\u5c0f\u5316\u7535\u6c60\u548c\u7f51\u7edc\u5f71\u54cd\u3002</p>"},{"location":"050SystemDesign/010Basic/#_17","title":"\u6838\u5fc3\u7ec4\u4ef6","text":""},{"location":"050SystemDesign/010Basic/#1_8","title":"1. \u65e5\u5fd7\u6536\u96c6\u5668","text":"<ul> <li>\u6355\u83b7\u5404\u79cd\u65e5\u5fd7\u7c7b\u578b\uff08\u5e94\u7528\u4e8b\u4ef6\u3001\u5d29\u6e83\u3001\u6027\u80fd\u6307\u6807\u3001\u7528\u6237\u4ea4\u4e92\uff09</li> <li>\u63d0\u4f9b\u4e0d\u540c\u7684\u65e5\u5fd7\u7ea7\u522b\uff08DEBUG\u3001INFO\u3001WARNING\u3001ERROR\u3001FATAL\uff09</li> <li>\u7ef4\u62a4\u4e0a\u4e0b\u6587\u4fe1\u606f\uff08\u8bbe\u5907\u4fe1\u606f\u3001\u5e94\u7528\u7248\u672c\u3001\u7528\u6237\u4f1a\u8bdd\uff09</li> </ul>"},{"location":"050SystemDesign/010Basic/#2_11","title":"2. \u5b58\u50a8\u7ba1\u7406\u5668","text":"<ul> <li>\u5b9e\u73b0\u65e5\u5fd7\u7684\u672c\u5730\u6301\u4e45\u5316\u5b58\u50a8</li> <li>\u5904\u7406\u65e5\u5fd7\u8f6e\u6362\u548c\u5927\u5c0f\u9650\u5236</li> <li>\u52a0\u5bc6\u654f\u611f\u65e5\u5fd7\u6570\u636e</li> <li>\u7ba1\u7406\u5b58\u50a8\u914d\u989d\uff0c\u9632\u6b62\u8fc7\u5ea6\u5360\u7528\u78c1\u76d8\u7a7a\u95f4</li> </ul>"},{"location":"050SystemDesign/010Basic/#3_8","title":"3. \u4e0a\u4f20\u670d\u52a1","text":"<ul> <li>\u6839\u636e\u7f51\u7edc\u72b6\u6001\u548c\u7b56\u7565\u89e6\u53d1\u4e0a\u4f20</li> <li>\u652f\u6301\u6279\u91cf\u4e0a\u4f20\u4ee5\u51cf\u5c11\u7f51\u7edc\u8bf7\u6c42</li> <li>\u5b9e\u73b0\u91cd\u8bd5\u673a\u5236\u548c\u5931\u8d25\u5904\u7406</li> <li>\u63d0\u4f9b\u4e0a\u4f20\u8fdb\u5ea6\u548c\u72b6\u6001\u56de\u8c03</li> </ul>"},{"location":"050SystemDesign/010Basic/#4","title":"4. \u914d\u7f6e\u7ba1\u7406\u5668","text":"<ul> <li>\u5141\u8bb8\u5f00\u53d1\u8005\u81ea\u5b9a\u4e49\u65e5\u5fd7\u884c\u4e3a\uff08\u91c7\u6837\u7387\u3001\u4e0a\u4f20\u9891\u7387\uff09</li> <li>\u652f\u6301\u8fdc\u7a0b\u914d\u7f6e\u66f4\u65b0</li> <li>\u7ba1\u7406\u65e5\u5fd7\u8fc7\u6ee4\u89c4\u5219</li> </ul>"},{"location":"050SystemDesign/010Basic/#5","title":"5. \u7b56\u7565\u5f15\u64ce","text":"<ul> <li>\u57fa\u4e8e\u7535\u6c60\u72b6\u6001\u3001\u7f51\u7edc\u7c7b\u578b\u548c\u7528\u91cf\u51b3\u5b9a\u4e0a\u4f20\u65f6\u673a</li> <li>\u652f\u6301\u667a\u80fd\u6279\u5904\u7406\u548c\u538b\u7f29</li> <li>\u63d0\u4f9b\u4f18\u5148\u7ea7\u673a\u5236\uff08\u5982\u7acb\u5373\u4e0a\u4f20\u5d29\u6e83\u65e5\u5fd7\uff09</li> </ul>"},{"location":"050SystemDesign/010Basic/#_18","title":"\u67b6\u6784\u8bbe\u8ba1","text":""},{"location":"050SystemDesign/010Basic/#api","title":"API \u5c42","text":"<ul> <li>\u7b80\u6d01\u7684\u5f00\u53d1\u8005\u63a5\u53e3</li> <li>\u7075\u6d3b\u7684\u65e5\u5fd7\u5206\u7c7b\u548c\u6807\u8bb0</li> <li>\u652f\u6301\u94fe\u5f0f\u8c03\u7528\u548c\u4e0a\u4e0b\u6587\u6ce8\u5165</li> </ul>"},{"location":"050SystemDesign/010Basic/#_19","title":"\u5904\u7406\u5c42","text":"<ul> <li>\u5f02\u6b65\u5904\u7406\u4ee5\u907f\u514d\u963b\u585e\u4e3b\u7ebf\u7a0b</li> <li>\u7ebf\u7a0b\u6c60\u7ba1\u7406</li> <li>\u4e8b\u4ef6\u9a71\u52a8\u67b6\u6784</li> </ul>"},{"location":"050SystemDesign/010Basic/#_20","title":"\u5b58\u50a8\u5c42","text":"<ul> <li>\u652f\u6301 SQLite \u548c\u6587\u4ef6\u7cfb\u7edf\u5b58\u50a8</li> <li>\u7f13\u5b58\u673a\u5236</li> <li>\u6570\u636e\u538b\u7f29</li> </ul>"},{"location":"050SystemDesign/010Basic/#_21","title":"\u7f51\u7edc\u5c42","text":"<ul> <li>HTTP/HTTPS \u4f20\u8f93</li> <li>\u652f\u6301\u65ad\u70b9\u7eed\u4f20</li> <li>\u9002\u5e94\u6027\u7f51\u7edc\u8bf7\u6c42\uff08\u6839\u636e\u7f51\u7edc\u6761\u4ef6\u8c03\u6574\u8bf7\u6c42\u5927\u5c0f\uff09</li> </ul>"},{"location":"050SystemDesign/010Basic/#_22","title":"\u9690\u79c1\u4e0e\u5b89\u5168\u8003\u8651","text":"<ul> <li>\u7528\u6237\u6570\u636e\u8131\u654f\u5904\u7406</li> <li>\u4f20\u8f93\u548c\u5b58\u50a8\u52a0\u5bc6</li> <li>\u9075\u5faa GDPR \u548c\u5176\u4ed6\u9690\u79c1\u6cd5\u89c4</li> <li>\u63d0\u4f9b\u65e5\u5fd7\u6570\u636e\u7559\u5b58\u7b56\u7565</li> </ul>"},{"location":"050SystemDesign/010Basic/#_23","title":"\u6027\u80fd\u4f18\u5316","text":"<ul> <li>\u6700\u5c0f\u5316\u5185\u5b58\u548c\u7535\u6c60\u5f71\u54cd</li> <li>\u667a\u80fd\u8c03\u5ea6\u4e0a\u4f20\u4efb\u52a1</li> <li>\u81ea\u9002\u5e94\u6279\u5904\u7406\u5927\u5c0f</li> <li>\u538b\u7f29\u7b97\u6cd5\u9009\u62e9</li> </ul>"},{"location":"050SystemDesign/010Basic/#_24","title":"\u96c6\u6210\u6d41\u7a0b","text":"<ol> <li>\u901a\u8fc7 Gradle \u6216 Maven \u6dfb\u52a0\u4f9d\u8d56</li> <li>\u5728\u5e94\u7528\u521d\u59cb\u5316\u65f6\u914d\u7f6e SDK</li> <li>\u5b9a\u4e49\u65e5\u5fd7\u4e0a\u4f20\u7aef\u70b9\u548c\u8ba4\u8bc1\u4fe1\u606f</li> <li>\u5728\u4ee3\u7801\u4e2d\u4f7f\u7528\u65e5\u5fd7 API</li> </ol>"},{"location":"050SystemDesign/010Basic/#_25","title":"\u6269\u5c55\u6027","text":"<ul> <li>\u63d2\u4ef6\u7cfb\u7edf\u652f\u6301\u81ea\u5b9a\u4e49\u65e5\u5fd7\u5904\u7406\u5668</li> <li>\u9002\u914d\u5668\u6a21\u5f0f\u652f\u6301\u4e0d\u540c\u7684\u540e\u7aef\u670d\u52a1</li> <li>\u89c2\u5bdf\u8005\u6a21\u5f0f\u5b9e\u73b0\u4e8b\u4ef6\u54cd\u5e94</li> </ul> <p>\u8fd9\u4e2a\u8bbe\u8ba1\u63d0\u4f9b\u4e86\u4e00\u4e2a\u5168\u9762\u7684\u6846\u67b6\uff0c\u53ef\u4ee5\u6839\u636e\u5177\u4f53\u9700\u6c42\u8fdb\u4e00\u6b65\u7ec6\u5316\u548c\u5b9e\u73b0\u3002</p>"},{"location":"050SystemDesign/010Basic/#sdk_1","title":"SDK\u8fdc\u7a0b\u63a7\u5236\u65e5\u5fd7\u4e0a\u4f20\u673a\u5236\u8bbe\u8ba1","text":""},{"location":"050SystemDesign/010Basic/#_26","title":"\u8fdc\u7a0b\u89e6\u53d1\u65e5\u5fd7\u4e0a\u4f20\u529f\u80fd","text":"<p>\u4e3a\u4e86\u652f\u6301\u540e\u53f0\u63a7\u5236SDK\u4e0a\u4f20\u65e5\u5fd7\u7684\u9700\u6c42\uff0c\u7279\u522b\u662f\u5f53\u7528\u6237\u4e0a\u62a5\u95ee\u9898\u9700\u8981\u670d\u52a1\u5668\u4e3b\u52a8\u83b7\u53d6\u5ba2\u6237\u7aef\u65e5\u5fd7\u65f6\uff0c\u53ef\u4ee5\u8bbe\u8ba1\u4ee5\u4e0b\u673a\u5236\uff1a</p>"},{"location":"050SystemDesign/010Basic/#1_9","title":"1. \u63a8\u9001\u901a\u77e5\u673a\u5236","text":"<ul> <li>\u96c6\u6210\u63a8\u9001\u670d\u52a1\uff08\u5982Firebase Cloud Messaging\u6216\u534e\u4e3a\u63a8\u9001\u670d\u52a1\uff09</li> <li>\u670d\u52a1\u5668\u53ef\u53d1\u9001\u7279\u5b9a\u683c\u5f0f\u7684\u63a8\u9001\u6d88\u606f\uff0c\u89e6\u53d1\u65e5\u5fd7\u4e0a\u4f20</li> <li>SDK\u9700\u5305\u542b\u63a8\u9001\u6d88\u606f\u63a5\u6536\u5668\uff0c\u8bc6\u522b\u5e76\u5904\u7406\u65e5\u5fd7\u4e0a\u4f20\u6307\u4ee4</li> </ul>"},{"location":"050SystemDesign/010Basic/#2_12","title":"2. \u8f6e\u8be2\u673a\u5236","text":"<ul> <li>SDK\u5b9a\u671f\u8bf7\u6c42\u540e\u53f0\u670d\u52a1\u5668\u68c0\u67e5\u662f\u5426\u9700\u8981\u4e0a\u4f20\u65e5\u5fd7</li> <li>\u53ef\u914d\u7f6e\u8f6e\u8be2\u95f4\u9694\u548c\u6761\u4ef6\uff08\u5982\u4ec5\u5728WiFi\u73af\u5883\u4e0b\u8f6e\u8be2\uff09</li> <li>\u670d\u52a1\u5668\u8fd4\u56de\u4e0a\u4f20\u6307\u4ee4\uff0c\u5305\u542b\u9700\u8981\u4e0a\u4f20\u7684\u65e5\u5fd7\u7c7b\u578b\u3001\u65f6\u95f4\u8303\u56f4\u7b49\u53c2\u6570</li> </ul>"},{"location":"050SystemDesign/010Basic/#3-websocket","title":"3. WebSocket\u957f\u8fde\u63a5","text":"<ul> <li>\u7ef4\u62a4\u4e0e\u670d\u52a1\u5668\u7684WebSocket\u8fde\u63a5</li> <li>\u5b9e\u65f6\u63a5\u6536\u670d\u52a1\u5668\u53d1\u9001\u7684\u65e5\u5fd7\u4e0a\u4f20\u6307\u4ee4</li> <li>\u9002\u7528\u4e8e\u9700\u8981\u9891\u7e41\u4e0e\u670d\u52a1\u5668\u901a\u4fe1\u7684\u5e94\u7528\u573a\u666f</li> </ul>"},{"location":"050SystemDesign/010Basic/#4_1","title":"4. \u8fdc\u7a0b\u914d\u7f6e\u4e2d\u5fc3","text":"<ul> <li>\u63a5\u5165\u914d\u7f6e\u4e2d\u5fc3\u670d\u52a1\uff08\u5982Firebase Remote Config\uff09</li> <li>\u901a\u8fc7\u4fee\u6539\u8fdc\u7a0b\u914d\u7f6e\u89e6\u53d1\u7279\u5b9a\u7528\u6237\u6216\u8bbe\u5907\u7684\u65e5\u5fd7\u4e0a\u4f20</li> <li>SDK\u5b9a\u671f\u540c\u6b65\u914d\u7f6e\u5e76\u6267\u884c\u76f8\u5e94\u64cd\u4f5c</li> </ul>"},{"location":"050SystemDesign/010Basic/#_27","title":"\u5b9e\u73b0\u7ec6\u8282","text":""},{"location":"050SystemDesign/010Basic/#_28","title":"\u63a7\u5236\u6307\u4ee4\u683c\u5f0f\u8bbe\u8ba1","text":"<pre><code>{\n\"command\": \"upload_logs\",\n\"requestId\": \"unique-request-id\",\n\"logTypes\": [\"crash\", \"performance\", \"user_action\"],\n\"timeRange\": {\n    \"start\": \"2025-03-20T00:00:00Z\",\n    \"end\": \"2025-03-24T00:00:00Z\"\n},\n\"priority\": \"high\",\n\"uploadEndpoint\": \"https://logs.example.com/special-upload\"\n}\n</code></pre>"},{"location":"050SystemDesign/010Basic/#_29","title":"\u65e5\u5fd7\u7b5b\u9009\u673a\u5236","text":"<ul> <li>\u652f\u6301\u6309\u65f6\u95f4\u8303\u56f4\u7b5b\u9009</li> <li>\u652f\u6301\u6309\u65e5\u5fd7\u7ea7\u522b\u7b5b\u9009</li> <li>\u652f\u6301\u6309\u65e5\u5fd7\u6807\u7b7e\u6216\u6a21\u5757\u7b5b\u9009</li> <li>\u652f\u6301\u6309\u7528\u6237\u4f1a\u8bdd\u7b5b\u9009</li> </ul>"},{"location":"050SystemDesign/010Basic/#_30","title":"\u6743\u9650\u4e0e\u5b89\u5168","text":"<ul> <li>\u8fdc\u7a0b\u89e6\u53d1\u673a\u5236\u9700\u8981\u4e25\u683c\u7684\u8ba4\u8bc1</li> <li>\u5bf9\u63a7\u5236\u6307\u4ee4\u8fdb\u884c\u7b7e\u540d\u9a8c\u8bc1\uff0c\u9632\u6b62\u4f2a\u9020</li> <li>\u9650\u5236\u4e0a\u4f20\u9891\u7387\uff0c\u907f\u514d\u6ee5\u7528</li> <li>\u786e\u4fdd\u7528\u6237\u9690\u79c1\u7b26\u5408\u76f8\u5173\u6cd5\u89c4</li> </ul>"},{"location":"050SystemDesign/010Basic/#_31","title":"\u7528\u6237\u4f53\u9a8c\u8003\u8651","text":"<ul> <li>\u53ef\u9009\u7684\u7528\u6237\u6388\u6743\u673a\u5236\uff08\u5982\u63d0\u793a\u7528\u6237\u786e\u8ba4\u4e0a\u4f20\uff09</li> <li>\u4ec5\u5728\u9002\u5f53\u6761\u4ef6\u4e0b\u6267\u884c\uff08\u5982\u8fde\u63a5WiFi\u3001\u8bbe\u5907\u95f2\u7f6e\u65f6\uff09</li> <li>\u4e0a\u4f20\u8fc7\u7a0b\u4e2d\u663e\u793a\u901a\u77e5\uff0c\u4fdd\u6301\u900f\u660e\u5ea6</li> <li>\u9650\u5236\u4e0a\u4f20\u5927\u5c0f\u548c\u65f6\u957f\uff0c\u907f\u514d\u5f71\u54cd\u7528\u6237\u4f53\u9a8c</li> </ul>"},{"location":"050SystemDesign/010Basic/#_32","title":"\u5b9e\u73b0\u6d41\u7a0b","text":"<ol> <li>\u670d\u52a1\u5668\u8bc6\u522b\u9700\u8981\u83b7\u53d6\u65e5\u5fd7\u7684\u8bbe\u5907</li> <li>\u901a\u8fc7\u63a8\u9001\u6216\u914d\u7f6e\u4e2d\u5fc3\u53d1\u9001\u6307\u4ee4</li> <li>SDK\u63a5\u6536\u5e76\u9a8c\u8bc1\u6307\u4ee4</li> <li>\u6839\u636e\u6307\u4ee4\u53c2\u6570\u7b5b\u9009\u672c\u5730\u65e5\u5fd7</li> <li>\u6267\u884c\u4e0a\u4f20\u5e76\u53d1\u9001\u7ed3\u679c\u62a5\u544a</li> <li>\u670d\u52a1\u5668\u786e\u8ba4\u63a5\u6536\u5b8c\u6210</li> </ol>"},{"location":"050SystemDesign/010Basic/#_33","title":"\u6280\u672f\u6311\u6218\u4e0e\u89e3\u51b3\u65b9\u6848","text":""},{"location":"050SystemDesign/010Basic/#_34","title":"\u79bb\u7ebf\u8bbe\u5907\u5904\u7406","text":"<ul> <li>\u5c06\u4e0a\u4f20\u6307\u4ee4\u6301\u4e45\u5316\u5b58\u50a8</li> <li>\u8bbe\u5907\u4e0a\u7ebf\u540e\u7acb\u5373\u68c0\u67e5\u5e76\u6267\u884c\u5f85\u5904\u7406\u7684\u6307\u4ee4</li> <li>\u8bbe\u7f6e\u6307\u4ee4\u8fc7\u671f\u65f6\u95f4\uff0c\u907f\u514d\u6267\u884c\u8fc7\u65f6\u7684\u4e0a\u4f20\u8bf7\u6c42</li> </ul>"},{"location":"050SystemDesign/010Basic/#_35","title":"\u5927\u91cf\u65e5\u5fd7\u5904\u7406","text":"<ul> <li>\u5206\u6279\u4e0a\u4f20\u673a\u5236</li> <li>\u589e\u91cf\u4e0a\u4f20\u652f\u6301</li> <li>\u5bf9\u5927\u578b\u65e5\u5fd7\u6587\u4ef6\u8fdb\u884c\u538b\u7f29</li> </ul>"},{"location":"050SystemDesign/010Basic/#_36","title":"\u7f51\u7edc\u4e0d\u7a33\u5b9a\u60c5\u51b5","text":"<ul> <li>\u65ad\u70b9\u7eed\u4f20</li> <li>\u81ea\u52a8\u91cd\u8bd5\u673a\u5236</li> <li>\u7f51\u7edc\u5207\u6362\u65f6\u4fdd\u6301\u4e0a\u4f20\u72b6\u6001</li> </ul> <p>\u8fd9\u79cd\u8bbe\u8ba1\u80fd\u591f\u6ee1\u8db3\u5f00\u53d1\u8005\u5728\u7528\u6237\u62a5\u544a\u95ee\u9898\u540e\u4e3b\u52a8\u83b7\u53d6\u5ba2\u6237\u7aef\u65e5\u5fd7\u7684\u9700\u6c42\uff0c\u540c\u65f6\u517c\u987e\u4e86\u7528\u6237\u4f53\u9a8c\u3001\u9690\u79c1\u5b89\u5168\u548c\u7f51\u7edc\u6548\u7387\u3002</p>"},{"location":"050SystemDesign/010Basic/#android-appokhttp-retrofit","title":"Android App\u7684\u7f51\u7edc\u6846\u67b6\u8981\u5982\u4f55\u8bbe\u8ba1\uff0c\u66f4\u65b9\u4fbf\u5f00\u53d1\u4eba\u5458\u8c03\u7528\uff1f\u4f7f\u7528Okhttp Retrofit\u3002","text":"\u7b54\u6848 <p>\u6211\u53ef\u4ee5\u4e3a\u4f60\u63d0\u4f9b\u4e00\u4e2a\u57fa\u4e8eOkHttp\u548cRetrofit\u7684Android\u7f51\u7edc\u6846\u67b6\u8bbe\u8ba1\uff0c\u4f7f\u5176\u66f4\u4fbf\u4e8e\u5f00\u53d1\u4eba\u5458\u8c03\u7528\u3002</p> <pre><code>/**\n* Android\u7f51\u7edc\u6846\u67b6\u8bbe\u8ba1 - \u57fa\u4e8eOkHttp\u548cRetrofit\n* \u76ee\u6807\uff1a\u8bbe\u8ba1\u4e00\u4e2a\u6613\u7528\u3001\u53ef\u6269\u5c55\u7684\u7f51\u7edc\u5c42\n*/\n\n// 1. \u7f51\u7edc\u914d\u7f6e\u7ba1\u7406\u5668 - \u7ba1\u7406OkHttp\u5b9e\u4f8b\u548c\u901a\u7528\u914d\u7f6e\nobject NetworkManager {\n    private const val TIMEOUT_CONNECT = 15L\n    private const val TIMEOUT_READ = 15L\n    private const val TIMEOUT_WRITE = 15L\n\n    // \u57fa\u7840URL\n    private const val BASE_URL = \"https://api.example.com/\"\n\n    // \u521b\u5efaOkHttpClient\n    private val okHttpClient by lazy {\n        OkHttpClient.Builder().apply {\n            // \u8bbe\u7f6e\u8d85\u65f6\u65f6\u95f4\n            connectTimeout(TIMEOUT_CONNECT, TimeUnit.SECONDS)\n            readTimeout(TIMEOUT_READ, TimeUnit.SECONDS)\n            writeTimeout(TIMEOUT_WRITE, TimeUnit.SECONDS)\n\n            // \u6dfb\u52a0\u901a\u7528\u62e6\u622a\u5668\n            addInterceptor(HeaderInterceptor())\n            addInterceptor(LoggingInterceptor())\n\n            // \u9519\u8bef\u5904\u7406\u62e6\u622a\u5668\n            addInterceptor(ErrorInterceptor())\n\n            // \u7f13\u5b58\u7b56\u7565\n            cache(Cache(File(\"\u7f13\u5b58\u76ee\u5f55\u8def\u5f84\"), 10 * 1024 * 1024)) // 10MB\u7f13\u5b58\n\n            // \u91cd\u8bd5\u7b56\u7565\n            retryOnConnectionFailure(true)\n        }.build()\n    }\n\n    // \u521b\u5efaRetrofit\u5b9e\u4f8b\n    val retrofit: Retrofit by lazy {\n        Retrofit.Builder()\n            .baseUrl(BASE_URL)\n            .client(okHttpClient)\n            .addConverterFactory(GsonConverterFactory.create())\n            .addCallAdapterFactory(CoroutineCallAdapterFactory())\n            .build()\n    }\n\n    // \u521b\u5efaAPI\u670d\u52a1\u7684\u7b80\u4fbf\u65b9\u6cd5\n    inline fun &lt;reified T&gt; createApiService(): T = retrofit.create(T::class.java)\n}\n\n// 2. \u62e6\u622a\u5668\n// \u6dfb\u52a0\u901a\u7528\u5934\u90e8\u4fe1\u606f\nclass HeaderInterceptor : Interceptor {\n    override fun intercept(chain: Interceptor.Chain): Response {\n        val request = chain.request().newBuilder()\n            .addHeader(\"Content-Type\", \"application/json\")\n            .addHeader(\"Accept\", \"application/json\")\n            .addHeader(\"Authorization\", TokenManager.getToken())\n            .addHeader(\"User-Agent\", \"Android Client\")\n            .build()\n\n        return chain.proceed(request)\n    }\n}\n\n// \u8bb0\u5f55\u7f51\u7edc\u8bf7\u6c42\u65e5\u5fd7\nclass LoggingInterceptor : Interceptor {\n    override fun intercept(chain: Interceptor.Chain): Response {\n        val request = chain.request()\n        val startTime = System.currentTimeMillis()\n\n        Log.d(\"API\", \"\u53d1\u9001\u8bf7\u6c42: ${request.url}\")\n\n        val response = chain.proceed(request)\n\n        val endTime = System.currentTimeMillis()\n        Log.d(\"API\", \"\u6536\u5230\u54cd\u5e94: ${response.code} (${endTime - startTime}ms)\")\n\n        return response\n    }\n}\n\n// \u9519\u8bef\u5904\u7406\u62e6\u622a\u5668\nclass ErrorInterceptor : Interceptor {\n    override fun intercept(chain: Interceptor.Chain): Response {\n        val request = chain.request()\n        val response = chain.proceed(request)\n\n        when (response.code) {\n            401 -&gt; EventBus.getDefault().post(UnauthorizedEvent())\n            500 -&gt; Log.e(\"API\", \"\u670d\u52a1\u5668\u9519\u8bef: ${response.message}\")\n            // \u5904\u7406\u5176\u4ed6\u72b6\u6001\u7801...\n        }\n\n        return response\n    }\n}\n\n// 3. API\u63a5\u53e3\u5b9a\u4e49\u793a\u4f8b\ninterface ApiService {\n    @GET(\"users\")\n    suspend fun getUsers(): Response&lt;List&lt;User&gt;&gt;\n\n    @GET(\"users/{userId}\")\n    suspend fun getUserById(@Path(\"userId\") userId: String): Response&lt;User&gt;\n\n    @POST(\"users\")\n    suspend fun createUser(@Body user: User): Response&lt;User&gt;\n}\n\n// 4. \u54cd\u5e94\u5305\u88c5\u7c7b\ndata class ApiResponse&lt;T&gt;(\n    val data: T?,\n    val errorCode: Int = 0,\n    val errorMsg: String = \"\",\n    val success: Boolean = true\n)\n\n// 5. \u8d44\u6e90\u5c01\u88c5\u7c7b - \u65b9\u4fbf\u5904\u7406\u4e0d\u540c\u72b6\u6001\nsealed class Resource&lt;T&gt; {\n    class Success&lt;T&gt;(val data: T) : Resource&lt;T&gt;()\n    class Error&lt;T&gt;(val message: String, val data: T? = null) : Resource&lt;T&gt;()\n    class Loading&lt;T&gt; : Resource&lt;T&gt;()\n}\n\n// 6. \u4ed3\u5e93\u5c42 - \u5904\u7406\u6570\u636e\u83b7\u53d6\u903b\u8f91\nclass UserRepository {\n    private val apiService = NetworkManager.createApiService&lt;ApiService&gt;()\n\n    // \u4f7f\u7528\u534f\u7a0b\u83b7\u53d6\u6570\u636e\u5e76\u5904\u7406\u7ed3\u679c\n    suspend fun getUsers(): Resource&lt;List&lt;User&gt;&gt; {\n        return try {\n            val response = apiService.getUsers()\n            if (response.isSuccessful) {\n                Resource.Success(response.body() ?: emptyList())\n            } else {\n                Resource.Error(\"Error ${response.code()}: ${response.message()}\")\n            }\n        } catch (e: Exception) {\n            Resource.Error(\"\u7f51\u7edc\u8bf7\u6c42\u5931\u8d25: ${e.message}\")\n        }\n    }\n\n    // \u5176\u4ed6\u6570\u636e\u64cd\u4f5c\u65b9\u6cd5...\n}\n\n// 7. \u4f7f\u7528\u793a\u4f8b - ViewModel\nclass UserViewModel : ViewModel() {\n    private val repository = UserRepository()\n\n    private val _users = MutableLiveData&lt;Resource&lt;List&lt;User&gt;&gt;&gt;()\n    val users: LiveData&lt;Resource&lt;List&lt;User&gt;&gt;&gt; = _users\n\n    fun loadUsers() {\n        viewModelScope.launch {\n            _users.value = Resource.Loading()\n            _users.value = repository.getUsers()\n        }\n    }\n}\n\n// 8. \u4f7f\u7528\u793a\u4f8b - Activity/Fragment\nclass UserListActivity : AppCompatActivity() {\n    private val viewModel: UserViewModel by viewModels()\n\n    override fun onCreate(savedInstanceState: Bundle?) {\n        super.onCreate(savedInstanceState)\n        setContentView(R.layout.activity_user_list)\n\n        // \u89c2\u5bdf\u6570\u636e\u53d8\u5316\n        viewModel.users.observe(this) { result -&gt;\n            when (result) {\n                is Resource.Loading -&gt; showLoading()\n                is Resource.Success -&gt; showUsers(result.data)\n                is Resource.Error -&gt; showError(result.message)\n            }\n        }\n\n        // \u52a0\u8f7d\u6570\u636e\n        viewModel.loadUsers()\n    }\n}\n</code></pre> <p>\u8fd9\u4e2a\u7f51\u7edc\u6846\u67b6\u8bbe\u8ba1\u57fa\u4e8eOkHttp\u548cRetrofit\uff0c\u5177\u6709\u4ee5\u4e0b\u7279\u70b9\uff0c\u4f7f\u5176\u66f4\u65b9\u4fbf\u5f00\u53d1\u4eba\u5458\u8c03\u7528\uff1a</p>"},{"location":"050SystemDesign/010Basic/#_37","title":"\u4e3b\u8981\u7ec4\u4ef6\u548c\u4f18\u52bf","text":"<ol> <li>NetworkManager\u5355\u4f8b\uff1a</li> <li>\u96c6\u4e2d\u7ba1\u7406OkHttp\u548cRetrofit\u914d\u7f6e</li> <li>\u63d0\u4f9b\u521b\u5efaAPI\u670d\u52a1\u7684\u7b80\u4fbf\u65b9\u6cd5</li> <li> <p>\u7edf\u4e00\u7ba1\u7406\u8d85\u65f6\u3001\u62e6\u622a\u5668\u7b49\u901a\u7528\u914d\u7f6e</p> </li> <li> <p>\u62e6\u622a\u5668\u7cfb\u7edf\uff1a</p> </li> <li>HeaderInterceptor\uff1a\u6dfb\u52a0\u901a\u7528\u5934\u90e8\u4fe1\u606f</li> <li>LoggingInterceptor\uff1a\u81ea\u52a8\u8bb0\u5f55\u8bf7\u6c42\u548c\u54cd\u5e94\u65e5\u5fd7</li> <li> <p>ErrorInterceptor\uff1a\u7edf\u4e00\u5904\u7406\u5e38\u89c1\u9519\u8bef\u7801</p> </li> <li> <p>\u8d44\u6e90\u5c01\u88c5\u7c7bResource\uff1a</p> </li> <li>\u4f7f\u7528\u5bc6\u5c01\u7c7b(sealed class)\u5c01\u88c5\u4e0d\u540c\u72b6\u6001\uff1a\u52a0\u8f7d\u4e2d\u3001\u6210\u529f\u3001\u9519\u8bef</li> <li> <p>\u65b9\u4fbfUI\u5c42\u5224\u65ad\u548c\u663e\u793a\u4e0d\u540c\u72b6\u6001</p> </li> <li> <p>\u4ed3\u5e93\u5c42Repository\uff1a</p> </li> <li>\u62bd\u8c61API\u8c03\u7528\u903b\u8f91</li> <li> <p>\u9519\u8bef\u5904\u7406\u548c\u8f6c\u6362</p> </li> <li> <p>\u534f\u7a0b\u652f\u6301\uff1a</p> </li> <li>\u4f7f\u7528suspend\u51fd\u6570\u5904\u7406\u5f02\u6b65\u8bf7\u6c42</li> <li>\u907f\u514d\u56de\u8c03\u5730\u72f1\uff0c\u4ee3\u7801\u66f4\u7b80\u6d01</li> </ol>"},{"location":"050SystemDesign/010Basic/#_38","title":"\u4f7f\u7528\u65b9\u5f0f","text":"<p>\u5f00\u53d1\u4eba\u5458\u53ea\u9700\u8981\u4e09\u6b65\u5373\u53ef\u5b8c\u6210\u7f51\u7edc\u8bf7\u6c42\uff1a</p> <ol> <li>\u5b9a\u4e49API\u63a5\u53e3</li> <li>\u521b\u5efaRepository\u5904\u7406\u4e1a\u52a1\u903b\u8f91</li> <li>\u5728ViewModel\u4e2d\u901a\u8fc7LiveData\u6216Flow\u89c2\u5bdf\u6570\u636e</li> </ol> <p>\u8fd9\u79cd\u8bbe\u8ba1\u9075\u5faaMVVM\u67b6\u6784\u6a21\u5f0f\uff0c\u6570\u636e\u6d41\u5411\u6e05\u6670\uff0c\u4fbf\u4e8e\u6d4b\u8bd5\uff0c\u5e76\u652f\u6301\u5404\u79cd\u9ad8\u7ea7\u529f\u80fd\u5982\u7f13\u5b58\u3001\u91cd\u8bd5\u548c\u9002\u914d\u5668\u6a21\u5f0f\u3002</p> <p>\u4f60\u8fd8\u6709\u5176\u4ed6\u5173\u4e8e\u7f51\u7edc\u6846\u67b6\u8bbe\u8ba1\u7684\u5177\u4f53\u95ee\u9898\u5417\uff1f</p>"},{"location":"050SystemDesign/010Basic/#androidtokenrefresh-tokentokenokhttp","title":"\u5728Android\u5e73\u53f0\u8bbe\u8ba1\u4e00\u4e2a\u7528\u6237token\u8fc7\u671f\uff0c\u901a\u8fc7Refresh Token\u81ea\u52a8\u5237\u65b0token\u7684\u529f\u80fd\u3002\u7f51\u7edc\u6846\u67b6\u662fOkhttp\u3002","text":"\u7b54\u6848 <p>\u6211\u6765\u5e2e\u4f60\u8bbe\u8ba1\u4e00\u4e2a\u5728Android\u5e73\u53f0\u4e0a\u4f7f\u7528OkHttp\u5b9e\u73b0\u7684Token\u8fc7\u671f\u81ea\u52a8\u5237\u65b0\u529f\u80fd\u3002\u8fd9\u662f\u4e00\u4e2a\u5e38\u89c1\u7684\u9700\u6c42\uff0c\u53ef\u4ee5\u4f7f\u7528OkHttp\u7684Interceptor\u673a\u5236\u6765\u5b9e\u73b0\u3002</p> <pre><code>// \u5b9a\u4e49Token\u7ba1\u7406\u7c7b\nclass TokenManager(private val context: Context) {\n    private val sharedPreferences = context.getSharedPreferences(\"auth_prefs\", Context.MODE_PRIVATE)\n\n    companion object {\n        private const val KEY_ACCESS_TOKEN = \"access_token\"\n        private const val KEY_REFRESH_TOKEN = \"refresh_token\"\n        private const val KEY_TOKEN_EXPIRY = \"token_expiry\"\n\n        @Volatile\n        private var instance: TokenManager? = null\n\n        fun getInstance(context: Context): TokenManager {\n            return instance ?: synchronized(this) {\n                instance ?: TokenManager(context.applicationContext).also { instance = it }\n            }\n        }\n    }\n\n    // \u4fdd\u5b58token\u4fe1\u606f\n    fun saveTokens(accessToken: String, refreshToken: String, expiresIn: Long) {\n        val expiryTime = System.currentTimeMillis() + (expiresIn * 1000)\n        sharedPreferences.edit()\n            .putString(KEY_ACCESS_TOKEN, accessToken)\n            .putString(KEY_REFRESH_TOKEN, refreshToken)\n            .putLong(KEY_TOKEN_EXPIRY, expiryTime)\n            .apply()\n    }\n\n    // \u83b7\u53d6\u8bbf\u95eetoken\n    fun getAccessToken(): String? {\n        return sharedPreferences.getString(KEY_ACCESS_TOKEN, null)\n    }\n\n    // \u83b7\u53d6\u5237\u65b0token\n    fun getRefreshToken(): String? {\n        return sharedPreferences.getString(KEY_REFRESH_TOKEN, null)\n    }\n\n    // \u5224\u65adtoken\u662f\u5426\u8fc7\u671f\n    fun isTokenExpired(): Boolean {\n        val expiryTime = sharedPreferences.getLong(KEY_TOKEN_EXPIRY, 0)\n        return System.currentTimeMillis() &gt; expiryTime\n    }\n\n    // \u6e05\u9664token\n    fun clearTokens() {\n        sharedPreferences.edit()\n            .remove(KEY_ACCESS_TOKEN)\n            .remove(KEY_REFRESH_TOKEN)\n            .remove(KEY_TOKEN_EXPIRY)\n            .apply()\n    }\n}\n\n// API\u670d\u52a1\u63a5\u53e3\ninterface AuthService {\n    @POST(\"refresh\")\n    suspend fun refreshToken(@Body request: RefreshTokenRequest): Response&lt;TokenResponse&gt;\n}\n\n// \u8bf7\u6c42\u548c\u54cd\u5e94\u6570\u636e\u7c7b\ndata class RefreshTokenRequest(val refreshToken: String)\ndata class TokenResponse(val accessToken: String, val refreshToken: String, val expiresIn: Long)\n\n// \u521b\u5efa\u5168\u5c40\u9501\uff0c\u9632\u6b62\u591a\u4e2a\u5e76\u53d1\u8bf7\u6c42\u540c\u65f6\u5237\u65b0Token\nobject TokenRefreshLock {\n    private val lock = Mutex()\n\n    suspend fun &lt;T&gt; withLock(block: suspend () -&gt; T): T {\n        return lock.withLock { block() }\n    }\n}\n\n// Token\u62e6\u622a\u5668\nclass TokenInterceptor(\n    private val context: Context,\n    private val authService: AuthService,\n    private val onTokenRefreshFailed: () -&gt; Unit\n) : Interceptor {\n\n    private val tokenManager by lazy { TokenManager.getInstance(context) }\n\n    @Throws(IOException::class)\n    override fun intercept(chain: Interceptor.Chain): Response {\n        val originalRequest = chain.request()\n\n        // \u5982\u679c\u8bf7\u6c42\u672c\u8eab\u662f\u5237\u65b0token\u7684\u8bf7\u6c42\uff0c\u76f4\u63a5\u653e\u884c\n        if (originalRequest.url.toString().contains(\"refresh\")) {\n            return chain.proceed(originalRequest)\n        }\n\n        // \u6dfb\u52a0\u8bbf\u95eetoken\u5230\u8bf7\u6c42\u5934\n        val requestWithToken = addTokenToRequest(originalRequest)\n        var response = chain.proceed(requestWithToken)\n\n        // \u5904\u7406401\u9519\u8bef\uff08Token\u8fc7\u671f\uff09\n        if (response.code == 401) {\n            response.close()\n\n            // \u5c1d\u8bd5\u5237\u65b0Token\n            val newToken = runBlocking {\n                refreshTokenWhenNeeded()\n            }\n\n            // \u5982\u679c\u5237\u65b0\u6210\u529f\uff0c\u4f7f\u7528\u65b0Token\u91cd\u8bd5\u8bf7\u6c42\n            return if (newToken != null) {\n                val newRequest = addTokenToRequest(originalRequest)\n                chain.proceed(newRequest)\n            } else {\n                // Token\u5237\u65b0\u5931\u8d25\uff0c\u901a\u77e5\u5e94\u7528\u5904\u7406\u767b\u51fa\u903b\u8f91\n                onTokenRefreshFailed()\n                response\n            }\n        }\n\n        return response\n    }\n\n    // \u6dfb\u52a0Token\u5230\u8bf7\u6c42\u5934\n    private fun addTokenToRequest(request: Request): Request {\n        val accessToken = tokenManager.getAccessToken() ?: return request\n        return request.newBuilder()\n            .header(\"Authorization\", \"Bearer $accessToken\")\n            .build()\n    }\n\n    // \u5237\u65b0Token\u903b\u8f91\uff0c\u4f7f\u7528\u4e92\u65a5\u9501\u786e\u4fdd\u5e76\u53d1\u5b89\u5168\n    private suspend fun refreshTokenWhenNeeded(): String? {\n        return TokenRefreshLock.withLock {\n            // \u53cc\u91cd\u68c0\u67e5\uff0c\u907f\u514d\u591a\u6b21\u5237\u65b0\n            if (!tokenManager.isTokenExpired()) {\n                return@withLock tokenManager.getAccessToken()\n            }\n\n            val refreshToken = tokenManager.getRefreshToken() ?: return@withLock null\n            try {\n                val request = RefreshTokenRequest(refreshToken)\n                val response = authService.refreshToken(request)\n\n                if (response.isSuccessful &amp;&amp; response.body() != null) {\n                    val tokenResponse = response.body()!!\n                    tokenManager.saveTokens(\n                        tokenResponse.accessToken,\n                        tokenResponse.refreshToken,\n                        tokenResponse.expiresIn\n                    )\n                    return@withLock tokenResponse.accessToken\n                } else {\n                    // \u5237\u65b0\u5931\u8d25\uff0c\u6e05\u9664token\n                    tokenManager.clearTokens()\n                    return@withLock null\n                }\n            } catch (e: Exception) {\n                // \u5904\u7406\u7f51\u7edc\u9519\u8bef\u7b49\u5f02\u5e38\n                tokenManager.clearTokens()\n                return@withLock null\n            }\n        }\n    }\n}\n\n// \u914d\u7f6eOkHttpClient\nfun createOkHttpClient(context: Context, authService: AuthService): OkHttpClient {\n    return OkHttpClient.Builder()\n        .addInterceptor(TokenInterceptor(context, authService) {\n            // Token\u5237\u65b0\u5931\u8d25\u7684\u56de\u8c03\uff0c\u4f8b\u5982\u8df3\u8f6c\u5230\u767b\u5f55\u9875\u9762\n            // \u8fd9\u91cc\u53ef\u4ee5\u4f7f\u7528EventBus\u6216\u5176\u4ed6\u65b9\u5f0f\u901a\u77e5\u5e94\u7528\n        })\n        .build()\n}\n\n// \u5728\u5e94\u7528\u4e2d\u4f7f\u7528\nclass YourApplication : Application() {\n    lateinit var okHttpClient: OkHttpClient\n\n    override fun onCreate() {\n        super.onCreate()\n\n        // \u521b\u5efaRetrofit\u5b9e\u4f8b\n        val retrofit = Retrofit.Builder()\n            .baseUrl(\"https://your-api-base-url.com/\")\n            .addConverterFactory(GsonConverterFactory.create())\n            .build()\n\n        // \u521b\u5efaAuthService\n        val authService = retrofit.create(AuthService::class.java)\n\n        // \u521b\u5efaOkHttpClient\n        okHttpClient = createOkHttpClient(this, authService)\n\n        // \u4f7f\u7528\u8be5okHttpClient\u521b\u5efa\u5176\u4ed6Retrofit\u5b9e\u4f8b\n        val apiRetrofit = Retrofit.Builder()\n            .baseUrl(\"https://your-api-base-url.com/\")\n            .client(okHttpClient)\n            .addConverterFactory(GsonConverterFactory.create())\n            .build()\n\n        // \u521d\u59cb\u5316\u5176\u4ed6API\u670d\u52a1...\n    }\n}\n</code></pre> <p>\u8fd9\u4e2a\u5b9e\u73b0\u63d0\u4f9b\u4e86\u4e00\u4e2a\u5b8c\u6574\u7684Token\u81ea\u52a8\u5237\u65b0\u89e3\u51b3\u65b9\u6848\uff0c\u4e3b\u8981\u5305\u542b\u4ee5\u4e0b\u51e0\u4e2a\u90e8\u5206\uff1a</p> <ol> <li>TokenManager - \u8d1f\u8d23\u4fdd\u5b58\u548c\u7ba1\u7406Token</li> <li>\u5b58\u50a8access token\u3001refresh token\u548c\u8fc7\u671f\u65f6\u95f4</li> <li>\u63d0\u4f9b\u5224\u65adtoken\u662f\u5426\u8fc7\u671f\u7684\u65b9\u6cd5</li> <li> <p>\u4f7f\u7528\u5355\u4f8b\u6a21\u5f0f\u786e\u4fdd\u5168\u5c40\u552f\u4e00\u5b9e\u4f8b</p> </li> <li> <p>TokenInterceptor - OkHttp\u62e6\u622a\u5668\uff0c\u5b9e\u73b0Token\u81ea\u52a8\u5237\u65b0</p> </li> <li>\u62e6\u622a\u6bcf\u4e2a\u8bf7\u6c42\uff0c\u6dfb\u52a0\u8ba4\u8bc1\u5934</li> <li>\u5904\u7406401\u9519\u8bef\uff0c\u5c1d\u8bd5\u5237\u65b0Token</li> <li> <p>\u4f7f\u7528\u5237\u65b0\u540e\u7684Token\u91cd\u65b0\u53d1\u9001\u539f\u59cb\u8bf7\u6c42</p> </li> <li> <p>TokenRefreshLock - \u4f7f\u7528Kotlin\u534f\u7a0b\u7684Mutex\u5b9e\u73b0\u7684\u5e76\u53d1\u63a7\u5236</p> </li> <li>\u9632\u6b62\u591a\u4e2a\u8bf7\u6c42\u540c\u65f6\u89e6\u53d1Token\u5237\u65b0</li> <li> <p>\u786e\u4fddToken\u5237\u65b0\u8fc7\u7a0b\u7684\u7ebf\u7a0b\u5b89\u5168</p> </li> <li> <p>AuthService - Retrofit\u63a5\u53e3\uff0c\u7528\u4e8e\u8c03\u7528\u5237\u65b0Token\u7684API</p> </li> </ol> <p>\u5b9e\u73b0\u8981\u70b9\uff1a</p> <ul> <li>\u4f7f\u7528\u53cc\u91cd\u68c0\u67e5\u548c\u4e92\u65a5\u9501\uff0c\u907f\u514d\u591a\u4e2a\u5e76\u53d1\u8bf7\u6c42\u540c\u65f6\u5237\u65b0Token</li> <li>\u63d0\u4f9bToken\u5237\u65b0\u5931\u8d25\u7684\u56de\u8c03\u673a\u5236\uff0c\u65b9\u4fbf\u5e94\u7528\u8df3\u8f6c\u5230\u767b\u5f55\u9875\u9762</li> <li>\u4f7f\u7528SharedPreferences\u5b58\u50a8Token\u4fe1\u606f\uff0c\u786e\u4fdd\u6301\u4e45\u5316</li> <li>\u652f\u6301\u5237\u65b0Token\u540e\u66f4\u65b0refresh token\uff08\u67d0\u4e9bAPI\u4f1a\u540c\u65f6\u66f4\u65b0\u4e24\u79cdtoken\uff09</li> </ul> <p>\u8981\u4f7f\u7528\u6b64\u5b9e\u73b0\uff0c\u4f60\u9700\u8981\uff1a</p> <ol> <li>\u5c06\u4ee3\u7801\u96c6\u6210\u5230\u4f60\u7684\u9879\u76ee\u4e2d</li> <li>\u521b\u5efa\u7b26\u5408\u4f60API\u89c4\u8303\u7684AuthService\u63a5\u53e3\u548c\u6570\u636e\u7c7b</li> <li>\u5728Application\u7c7b\u6216\u4f9d\u8d56\u6ce8\u5165\u6846\u67b6\u4e2d\u521d\u59cb\u5316\u5e76\u4f7f\u7528\u8fd9\u4e2aOkHttpClient</li> </ol> <p>\u8fd9\u4e2a\u5b9e\u73b0\u57fa\u4e8eKotlin\u548c\u534f\u7a0b\uff0c\u5982\u679c\u4f60\u7684\u9879\u76ee\u4f7f\u7528Java\uff0c\u53ef\u80fd\u9700\u8981\u505a\u4e00\u4e9b\u8c03\u6574\uff0c\u7279\u522b\u662f\u9501\u673a\u5236\u90e8\u5206\u3002</p>"},{"location":"050SystemDesign/010Basic/#android10m","title":"Android\u4ece\u7f51\u7edc\u52a0\u8f7d\u4e00\u4e2a10M\u7684\u56fe\u7247\uff0c\u8bf4\u4e0b\u6ce8\u610f\u4e8b\u9879","text":"\u7b54\u6848 <p>\u5728Android\u4e2d\u4ece\u7f51\u7edc\u52a0\u8f7d10M\u5927\u5c0f\u7684\u56fe\u7247\u9700\u8981\u8003\u8651\u4ee5\u4e0b\u51e0\u4e2a\u5173\u952e\u6ce8\u610f\u4e8b\u9879:</p> <ol> <li>\u7f51\u7edc\u8bf7\u6c42\u5904\u7406</li> <li>\u4f7f\u7528\u5f02\u6b65\u52a0\u8f7d\u65b9\u5f0f\uff0c\u907f\u514d\u963b\u585e\u4e3b\u7ebf\u7a0b</li> <li>\u5b9e\u73b0\u8d85\u65f6\u673a\u5236\u548c\u9519\u8bef\u91cd\u8bd5</li> <li> <p>\u8003\u8651\u7f51\u7edc\u72b6\u6001\u53d8\u5316\u7684\u5904\u7406</p> </li> <li> <p>\u5185\u5b58\u7ba1\u7406</p> </li> <li>\u4f7f\u7528\u4f4d\u56fe\u52a0\u8f7d\u9009\u9879(BitmapFactory.Options)\u964d\u4f4e\u91c7\u6837\u7387</li> <li>\u6839\u636e\u5b9e\u9645\u663e\u793a\u5c3a\u5bf8\u8c03\u6574\u52a0\u8f7d\u5206\u8fa8\u7387</li> <li>\u4f7f\u7528RGB_565\u7b49\u5185\u5b58\u5360\u7528\u8f83\u5c0f\u7684\u683c\u5f0f\u66ff\u4ee3ARGB_8888</li> <li> <p>\u6ce8\u610f\u5185\u5b58\u6cc4\u6f0f\u95ee\u9898\uff0c\u53ca\u65f6\u56de\u6536\u4e0d\u7528\u7684Bitmap</p> </li> <li> <p>\u78c1\u76d8\u7f13\u5b58</p> </li> <li>\u5b9e\u73b0\u78c1\u76d8\u7f13\u5b58\u673a\u5236\u907f\u514d\u91cd\u590d\u4e0b\u8f7d</li> <li>\u4f7f\u7528LRU\u7b97\u6cd5\u7ba1\u7406\u7f13\u5b58\u5927\u5c0f</li> <li> <p>\u8003\u8651\u7f13\u5b58\u8fc7\u671f\u7b56\u7565</p> </li> <li> <p>UI\u4f53\u9a8c</p> </li> <li>\u6dfb\u52a0\u52a0\u8f7d\u8fdb\u5ea6\u663e\u793a</li> <li>\u5b9e\u73b0\u5360\u4f4d\u56fe\u548c\u9519\u8bef\u56fe</li> <li> <p>\u8003\u8651\u56fe\u7247\u52a0\u8f7d\u52a8\u753b\u6548\u679c</p> </li> <li> <p>\u6743\u9650\u8981\u6c42</p> </li> <li>\u6dfb\u52a0\u7f51\u7edc\u8bbf\u95ee\u6743\u9650(INTERNET)</li> <li> <p>\u82e5\u9700\u5b58\u50a8\uff0c\u6dfb\u52a0\u76f8\u5e94\u5b58\u50a8\u6743\u9650</p> </li> <li> <p>\u56fe\u7247\u5e93\u9009\u62e9</p> </li> <li>\u8003\u8651\u4f7f\u7528\u6210\u719f\u7684\u56fe\u7247\u52a0\u8f7d\u5e93\u5982Glide\u3001Picasso\u6216Coil</li> <li> <p>\u8fd9\u4e9b\u5e93\u5df2\u4f18\u5316\u4e86\u4e0a\u8ff0\u5927\u90e8\u5206\u95ee\u9898</p> </li> <li> <p>\u6027\u80fd\u4f18\u5316</p> </li> <li>\u4f7f\u7528HTTP\u7f13\u5b58\u5934</li> <li>\u8003\u8651\u4f7f\u7528WebP\u7b49\u538b\u7f29\u683c\u5f0f</li> <li>\u5728\u5408\u9002\u573a\u666f\u4f7f\u7528\u56fe\u7247\u538b\u7f29\u6216\u8005\u8fdc\u7a0b\u670d\u52a1\u5668\u56fe\u7247\u538b\u7f29API</li> </ol> <p>\u60a8\u662f\u5728\u5f00\u53d1\u4e00\u4e2a\u7279\u5b9a\u5e94\u7528\u5417\uff1f\u6211\u53ef\u4ee5\u63d0\u4f9b\u66f4\u9488\u5bf9\u6027\u7684\u5efa\u8bae\u3002</p>"},{"location":"050SystemDesign/010Basic/#_39","title":"\u817e\u8baf\u6587\u6863\u662f\u5982\u4f55\u5b9e\u73b0\u591a\u7528\u6237\u540c\u65f6\u8bfb\u5199\u7684\uff1f","text":"\u7b54\u6848 <p>\u5b9e\u73b0\u591a\u7528\u6237\u540c\u65f6\u8bfb\u5199\u6587\u4ef6\uff08\u5982\u817e\u8baf\u6587\u6863\uff09\u901a\u5e38\u6d89\u53ca\u4ee5\u4e0b\u51e0\u4e2a\u5173\u952e\u6280\u672f\u548c\u65b9\u6cd5\uff1a</p>"},{"location":"050SystemDesign/010Basic/#1_10","title":"1. \u5206\u5e03\u5f0f\u7cfb\u7edf","text":"<ul> <li>\u5206\u5e03\u5f0f\u5b58\u50a8\uff1a\u6587\u4ef6\u88ab\u5206\u5272\u5b58\u50a8\u5728\u591a\u4e2a\u670d\u52a1\u5668\u4e0a\uff0c\u786e\u4fdd\u9ad8\u53ef\u7528\u6027\u548c\u8d1f\u8f7d\u5747\u8861\u3002</li> <li>\u5206\u5e03\u5f0f\u9501\uff1a\u4f7f\u7528\u5206\u5e03\u5f0f\u9501\uff08\u5982Zookeeper\u3001Redis\uff09\u6765\u534f\u8c03\u591a\u7528\u6237\u5bf9\u6587\u4ef6\u7684\u5e76\u53d1\u8bbf\u95ee\u3002</li> </ul>"},{"location":"050SystemDesign/010Basic/#2-operational-transformation-ot","title":"2. \u64cd\u4f5c\u8f6c\u6362\uff08Operational Transformation, OT\uff09","text":"<ul> <li>OT\u7b97\u6cd5\uff1a\u7528\u4e8e\u5904\u7406\u5e76\u53d1\u64cd\u4f5c\uff0c\u786e\u4fdd\u6240\u6709\u7528\u6237\u7684\u4fee\u6539\u6700\u7ec8\u4e00\u81f4\u3002Google Docs\u65e9\u671f\u4f7f\u7528\u6b64\u6280\u672f\u3002</li> <li>\u51b2\u7a81\u89e3\u51b3\uff1a\u901a\u8fc7\u7b97\u6cd5\u89e3\u51b3\u4e0d\u540c\u7528\u6237\u540c\u65f6\u7f16\u8f91\u540c\u4e00\u90e8\u5206\u5185\u5bb9\u65f6\u7684\u51b2\u7a81\u3002</li> </ul>"},{"location":"050SystemDesign/010Basic/#3-conflict-free-replicated-data-types-crdts","title":"3. \u51b2\u7a81\u81ea\u7531\u590d\u5236\u6570\u636e\u7c7b\u578b\uff08Conflict-Free Replicated Data Types, CRDTs\uff09","text":"<ul> <li>CRDTs\uff1a\u4e00\u79cd\u6570\u636e\u7ed3\u6784\uff0c\u786e\u4fdd\u5728\u5206\u5e03\u5f0f\u7cfb\u7edf\u4e2d\u6240\u6709\u526f\u672c\u6700\u7ec8\u4e00\u81f4\uff0c\u9002\u5408\u5b9e\u65f6\u534f\u4f5c\u7f16\u8f91\u3002</li> </ul>"},{"location":"050SystemDesign/010Basic/#4_2","title":"4. \u7248\u672c\u63a7\u5236","text":"<ul> <li>\u7248\u672c\u7ba1\u7406\uff1a\u6bcf\u6b21\u4fee\u6539\u751f\u6210\u65b0\u7248\u672c\uff0c\u7cfb\u7edf\u6839\u636e\u7248\u672c\u53f7\u5408\u5e76\u6216\u89e3\u51b3\u51b2\u7a81\u3002</li> <li>\u5386\u53f2\u8bb0\u5f55\uff1a\u4fdd\u7559\u6240\u6709\u4fee\u6539\u5386\u53f2\uff0c\u4fbf\u4e8e\u56de\u6eda\u548c\u67e5\u770b\u66f4\u6539\u3002</li> </ul>"},{"location":"050SystemDesign/010Basic/#5_1","title":"5. \u5b9e\u65f6\u901a\u4fe1","text":"<ul> <li>WebSocket\uff1a\u7528\u4e8e\u5b9e\u65f6\u63a8\u9001\u66f4\u65b0\uff0c\u786e\u4fdd\u7528\u6237\u754c\u9762\u5373\u65f6\u5237\u65b0\u3002</li> <li>\u957f\u8f6e\u8be2\uff1a\u5728WebSocket\u4e0d\u53ef\u7528\u65f6\uff0c\u4f7f\u7528\u957f\u8f6e\u8be2\u6a21\u62df\u5b9e\u65f6\u901a\u4fe1\u3002</li> </ul>"},{"location":"050SystemDesign/010Basic/#6","title":"6. \u524d\u7aef\u4f18\u5316","text":"<ul> <li>\u672c\u5730\u7f13\u5b58\uff1a\u5728\u7528\u6237\u8bbe\u5907\u4e0a\u7f13\u5b58\u6587\u4ef6\u5185\u5bb9\uff0c\u51cf\u5c11\u670d\u52a1\u5668\u8bf7\u6c42\u3002</li> <li>\u5dee\u5f02\u66f4\u65b0\uff1a\u53ea\u4f20\u8f93\u53d8\u5316\u90e8\u5206\uff0c\u51cf\u5c11\u7f51\u7edc\u8d1f\u8f7d\u3002</li> </ul>"},{"location":"050SystemDesign/010Basic/#7","title":"7. \u6743\u9650\u7ba1\u7406","text":"<ul> <li>\u7ec6\u7c92\u5ea6\u6743\u9650\u63a7\u5236\uff1a\u6839\u636e\u7528\u6237\u89d2\u8272\u63a7\u5236\u8bfb\u5199\u6743\u9650\uff0c\u786e\u4fdd\u6570\u636e\u5b89\u5168\u3002</li> </ul>"},{"location":"050SystemDesign/010Basic/#8","title":"8. \u6570\u636e\u4e00\u81f4\u6027","text":"<ul> <li>\u6700\u7ec8\u4e00\u81f4\u6027\uff1a\u5728\u5206\u5e03\u5f0f\u7cfb\u7edf\u4e2d\uff0c\u5141\u8bb8\u77ed\u6682\u4e0d\u4e00\u81f4\uff0c\u4f46\u6700\u7ec8\u8fbe\u5230\u4e00\u81f4\u72b6\u6001\u3002</li> <li>\u5f3a\u4e00\u81f4\u6027\uff1a\u901a\u8fc7\u5206\u5e03\u5f0f\u4e8b\u52a1\u786e\u4fdd\u6bcf\u6b21\u64cd\u4f5c\u540e\u6570\u636e\u4e00\u81f4\u3002</li> </ul>"},{"location":"050SystemDesign/010Basic/#_40","title":"\u5b9e\u73b0\u6b65\u9aa4","text":"<ol> <li>\u7528\u6237A\u7f16\u8f91\u6587\u4ef6\uff1a\u4fee\u6539\u901a\u8fc7WebSocket\u53d1\u9001\u5230\u670d\u52a1\u5668\u3002</li> <li>\u670d\u52a1\u5668\u5904\u7406\uff1a\u670d\u52a1\u5668\u4f7f\u7528OT\u6216CRDT\u5904\u7406\u5e76\u53d1\u4fee\u6539\uff0c\u66f4\u65b0\u6587\u4ef6\u7248\u672c\u3002</li> <li>\u5e7f\u64ad\u66f4\u65b0\uff1a\u670d\u52a1\u5668\u5c06\u66f4\u65b0\u5e7f\u64ad\u7ed9\u6240\u6709\u5728\u7ebf\u7528\u6237\u3002</li> <li>\u7528\u6237B\u63a5\u6536\u66f4\u65b0\uff1a\u7528\u6237B\u7684\u5ba2\u6237\u7aef\u5e94\u7528\u66f4\u65b0\uff0c\u754c\u9762\u5373\u65f6\u5237\u65b0\u3002</li> </ol>"},{"location":"050SystemDesign/010Basic/#_41","title":"\u793a\u4f8b\u4ee3\u7801\uff08\u7b80\u5316\uff09","text":"<pre><code>// WebSocket \u5ba2\u6237\u7aef\nconst socket = new WebSocket('wss://example.com/socket');\n\nsocket.onmessage = function(event) {\n    const update = JSON.parse(event.data);\n    applyUpdateToDocument(update); // \u5e94\u7528\u66f4\u65b0\u5230\u672c\u5730\u6587\u6863\n};\n\nfunction sendUpdate(update) {\n    socket.send(JSON.stringify(update)); // \u53d1\u9001\u672c\u5730\u66f4\u65b0\u5230\u670d\u52a1\u5668\n}\n\n// \u670d\u52a1\u5668\u7aef\uff08\u4f2a\u4ee3\u7801\uff09\nconst clients = new Set();\n\nfunction handleUpdate(update, client) {\n    const transformedUpdate = transformUpdate(update); // \u4f7f\u7528OT\u6216CRDT\u5904\u7406\u66f4\u65b0\n    clients.forEach(c =&gt; {\n        if (c !== client) {\n            c.send(transformedUpdate); // \u5e7f\u64ad\u66f4\u65b0\u7ed9\u5176\u4ed6\u5ba2\u6237\u7aef\n        }\n    });\n}\n</code></pre>"},{"location":"050SystemDesign/010Basic/#_42","title":"\u603b\u7ed3","text":"<p>\u817e\u8baf\u6587\u6863\u7b49\u591a\u7528\u6237\u5b9e\u65f6\u534f\u4f5c\u5de5\u5177\u901a\u8fc7\u5206\u5e03\u5f0f\u7cfb\u7edf\u3001OT/CRDT\u7b97\u6cd5\u3001\u5b9e\u65f6\u901a\u4fe1\u548c\u7248\u672c\u63a7\u5236\u7b49\u6280\u672f\u5b9e\u73b0\u591a\u7528\u6237\u540c\u65f6\u8bfb\u5199\u3002\u8fd9\u4e9b\u6280\u672f\u786e\u4fdd\u6570\u636e\u4e00\u81f4\u6027\u3001\u5b9e\u65f6\u6027\u548c\u9ad8\u53ef\u7528\u6027\u3002</p>"},{"location":"050SystemDesign/010Basic/#android_2","title":"\u8bbe\u8ba1\u4e00\u4e2a\u89c6\u9891\u52a0\u5bc6\u529f\u80fd\uff0c\u6d89\u53ca\u670d\u52a1\u7aef\u548cAndroid\u7aef","text":"\u7b54\u6848 <p>\u6211\u5c06\u4e3a\u60a8\u8bbe\u8ba1\u4e00\u4e2a\u89c6\u9891\u52a0\u5bc6\u529f\u80fd\uff0c\u5305\u62ec\u670d\u52a1\u7aef\u548cAndroid\u7aef\u7684\u5b9e\u73b0\u3002</p> <pre><code>/**\n * \u89c6\u9891\u52a0\u5bc6\u7cfb\u7edf\u8bbe\u8ba1\n * \u5305\u542b\u670d\u52a1\u7aef\u548cAndroid\u5ba2\u6237\u7aef\u5b9e\u73b0\n */\n\n// ================ \u670d\u52a1\u7aef\u5b9e\u73b0 ================\n\n/**\n * \u670d\u52a1\u7aef\u89c6\u9891\u52a0\u5bc6\u670d\u52a1\n */\npublic class VideoEncryptionService {\n\n    private static final String AES_ALGORITHM = \"AES/CBC/PKCS5Padding\";\n    private static final int KEY_SIZE = 256;\n\n    /**\n     * \u751f\u6210\u7528\u6237\u4e13\u5c5e\u52a0\u5bc6\u5bc6\u94a5\n     */\n    public UserEncryptionKey generateUserKey(String userId) {\n        try {\n            KeyGenerator keyGen = KeyGenerator.getInstance(\"AES\");\n            keyGen.init(KEY_SIZE, new SecureRandom());\n            SecretKey secretKey = keyGen.generateKey();\n\n            // \u751f\u6210\u521d\u59cb\u5316\u5411\u91cf\n            byte[] iv = new byte[16];\n            SecureRandom random = new SecureRandom();\n            random.nextBytes(iv);\n\n            // \u4fdd\u5b58\u7528\u6237\u5bc6\u94a5\u548cIV\u5230\u6570\u636e\u5e93\n            String encodedKey = Base64.getEncoder().encodeToString(secretKey.getEncoded());\n            String encodedIV = Base64.getEncoder().encodeToString(iv);\n            saveUserKeyToDatabase(userId, encodedKey, encodedIV);\n\n            return new UserEncryptionKey(encodedKey, encodedIV);\n        } catch (NoSuchAlgorithmException e) {\n            throw new RuntimeException(\"Failed to generate encryption key\", e);\n        }\n    }\n\n    /**\n     * \u52a0\u5bc6\u89c6\u9891\u6587\u4ef6\n     */\n    public String encryptVideo(InputStream videoFile, String userId) {\n        try {\n            // \u83b7\u53d6\u7528\u6237\u5bc6\u94a5\n            UserEncryptionKey userKey = getUserKeyFromDatabase(userId);\n            if (userKey == null) {\n                throw new IllegalStateException(\"No encryption key found for user: \" + userId);\n            }\n\n            // \u89e3\u7801\u5bc6\u94a5\u548cIV\n            byte[] keyBytes = Base64.getDecoder().decode(userKey.getEncodedKey());\n            byte[] ivBytes = Base64.getDecoder().decode(userKey.getEncodedIV());\n\n            // \u521d\u59cb\u5316\u52a0\u5bc6\u5668\n            SecretKey secretKey = new SecretKeySpec(keyBytes, \"AES\");\n            IvParameterSpec iv = new IvParameterSpec(ivBytes);\n            Cipher cipher = Cipher.getInstance(AES_ALGORITHM);\n            cipher.init(Cipher.ENCRYPT_MODE, secretKey, iv);\n\n            // \u751f\u6210\u52a0\u5bc6\u540e\u7684\u6587\u4ef6\u8def\u5f84\n            String encryptedFilePath = generateEncryptedFilePath(userId);\n\n            // \u52a0\u5bc6\u5e76\u5199\u5165\u6587\u4ef6\n            try (InputStream in = videoFile;\n                OutputStream out = new FileOutputStream(encryptedFilePath);\n                CipherOutputStream cipherOut = new CipherOutputStream(out, cipher)) {\n\n                byte[] buffer = new byte[8192];\n                int count;\n                while ((count = in.read(buffer)) &gt; 0) {\n                    cipherOut.write(buffer, 0, count);\n                }\n                cipherOut.flush();\n            }\n\n            // \u8bb0\u5f55\u52a0\u5bc6\u65e5\u5fd7\n            logEncryption(userId, encryptedFilePath);\n\n            return encryptedFilePath;\n        } catch (Exception e) {\n            throw new RuntimeException(\"Failed to encrypt video\", e);\n        }\n    }\n\n    /**\n     * \u4e3a\u7528\u6237\u751f\u6210\u89e3\u5bc6\u4ee4\u724c\n     */\n    public String generateDecryptionToken(String userId, String videoId, long expirationTimeMs) {\n        // \u521b\u5efaJWT\u4ee4\u724c\uff0c\u5305\u542b\u7528\u6237ID\u3001\u89c6\u9891ID\u548c\u8fc7\u671f\u65f6\u95f4\n        String token = createJWT(userId, videoId, expirationTimeMs);\n        return token;\n    }\n\n    // \u5185\u90e8\u8f85\u52a9\u65b9\u6cd5\n    private void saveUserKeyToDatabase(String userId, String encodedKey, String encodedIV) {\n        // \u5b9e\u73b0\u6570\u636e\u5e93\u5b58\u50a8\u903b\u8f91\n    }\n\n    private UserEncryptionKey getUserKeyFromDatabase(String userId) {\n        // \u5b9e\u73b0\u4ece\u6570\u636e\u5e93\u83b7\u53d6\u7528\u6237\u5bc6\u94a5\n        return null; // \u66ff\u6362\u4e3a\u5b9e\u9645\u5b9e\u73b0\n    }\n\n    private String generateEncryptedFilePath(String userId) {\n        // \u4e3a\u52a0\u5bc6\u6587\u4ef6\u751f\u6210\u5b58\u50a8\u8def\u5f84\n        return \"encrypted_videos/\" + userId + \"/\" + UUID.randomUUID().toString() + \".enc\";\n    }\n\n    private void logEncryption(String userId, String filePath) {\n        // \u8bb0\u5f55\u52a0\u5bc6\u64cd\u4f5c\n    }\n\n    private String createJWT(String userId, String videoId, long expirationTimeMs) {\n        // \u5b9e\u73b0JWT\u4ee4\u724c\u751f\u6210\n        return \"jwt_token\"; // \u66ff\u6362\u4e3a\u5b9e\u9645\u5b9e\u73b0\n    }\n}\n\n/**\n * \u7528\u6237\u52a0\u5bc6\u5bc6\u94a5\u6570\u636e\u7c7b\n */\nclass UserEncryptionKey {\n    private final String encodedKey;\n    private final String encodedIV;\n\n    public UserEncryptionKey(String encodedKey, String encodedIV) {\n        this.encodedKey = encodedKey;\n        this.encodedIV = encodedIV;\n    }\n\n    public String getEncodedKey() {\n        return encodedKey;\n    }\n\n    public String getEncodedIV() {\n        return encodedIV;\n    }\n}\n\n// ================ Android\u5ba2\u6237\u7aef\u5b9e\u73b0 ================\n\n/**\n * Android\u89c6\u9891\u52a0\u5bc6\u7ba1\u7406\u5668\n */\npublic class VideoEncryptionManager {\n\n    private static final String AES_ALGORITHM = \"AES/CBC/PKCS5Padding\";\n    private static final String SHARED_PREFS_NAME = \"video_encryption_prefs\";\n    private static final String KEY_USER_KEY = \"user_key\";\n    private static final String KEY_USER_IV = \"user_iv\";\n\n    private final Context context;\n    private final ApiService apiService;\n\n    public VideoEncryptionManager(Context context, ApiService apiService) {\n        this.context = context;\n        this.apiService = apiService;\n    }\n\n    /**\n     * \u521d\u59cb\u5316\u52a0\u5bc6\u5bc6\u94a5\n     */\n    public void initializeEncryption(String userId, EncryptionCallback callback) {\n        // \u68c0\u67e5\u662f\u5426\u5df2\u6709\u5bc6\u94a5\n        if (hasEncryptionKey()) {\n            callback.onSuccess();\n            return;\n        }\n\n        // \u4ece\u670d\u52a1\u5668\u83b7\u53d6\u65b0\u5bc6\u94a5\n        apiService.requestEncryptionKey(userId, new ApiCallback&lt;UserEncryptionKey&gt;() {\n            @Override\n            public void onSuccess(UserEncryptionKey result) {\n                // \u4fdd\u5b58\u5bc6\u94a5\u5230\u5b89\u5168\u5b58\u50a8\n                saveEncryptionKey(result);\n                callback.onSuccess();\n            }\n\n            @Override\n            public void onFailure(Exception e) {\n                callback.onError(e);\n            }\n        });\n    }\n\n    /**\n     * \u64ad\u653e\u52a0\u5bc6\u89c6\u9891\n     */\n    public void playEncryptedVideo(String videoId, String token, SurfaceView surfaceView, PlaybackCallback callback) {\n        try {\n            // \u83b7\u53d6\u5b58\u50a8\u7684\u5bc6\u94a5\n            UserEncryptionKey userKey = getStoredEncryptionKey();\n            if (userKey == null) {\n                throw new IllegalStateException(\"No encryption key available\");\n            }\n\n            // \u4f7f\u7528\u4ee4\u724c\u83b7\u53d6\u52a0\u5bc6\u89c6\u9891\u6d41\n            apiService.getEncryptedVideoStream(videoId, token, new ApiCallback&lt;InputStream&gt;() {\n                @Override\n                public void onSuccess(InputStream encryptedStream) {\n                    try {\n                        // \u89e3\u7801\u5bc6\u94a5\u548cIV\n                        byte[] keyBytes = Base64.decode(userKey.getEncodedKey(), Base64.DEFAULT);\n                        byte[] ivBytes = Base64.decode(userKey.getEncodedIV(), Base64.DEFAULT);\n\n                        // \u521d\u59cb\u5316\u89e3\u5bc6\u5668\n                        SecretKey secretKey = new SecretKeySpec(keyBytes, \"AES\");\n                        IvParameterSpec iv = new IvParameterSpec(ivBytes);\n                        Cipher cipher = Cipher.getInstance(AES_ALGORITHM);\n                        cipher.init(Cipher.DECRYPT_MODE, secretKey, iv);\n\n                        // \u521b\u5efa\u89e3\u5bc6\u6d41\n                        CipherInputStream cipherInputStream = new CipherInputStream(encryptedStream, cipher);\n\n                        // \u8bbe\u7f6e\u5a92\u4f53\u64ad\u653e\u5668\n                        setupMediaPlayer(cipherInputStream, surfaceView, callback);\n                    } catch (Exception e) {\n                        callback.onError(e);\n                    }\n                }\n\n                @Override\n                public void onFailure(Exception e) {\n                    callback.onError(e);\n                }\n            });\n        } catch (Exception e) {\n            callback.onError(e);\n        }\n    }\n\n    /**\n     * \u8bbe\u7f6e\u5a92\u4f53\u64ad\u653e\u5668\u64ad\u653e\u89e3\u5bc6\u5185\u5bb9\n     */\n    private void setupMediaPlayer(InputStream decryptedStream, SurfaceView surfaceView, PlaybackCallback callback) {\n        try {\n            // \u5c06\u89e3\u5bc6\u6d41\u5199\u5165\u4e34\u65f6\u6587\u4ef6\n            File tempFile = createTempFile();\n            try (InputStream in = decryptedStream;\n                FileOutputStream out = new FileOutputStream(tempFile)) {\n                byte[] buffer = new byte[8192];\n                int bytesRead;\n                while ((bytesRead = in.read(buffer)) != -1) {\n                    out.write(buffer, 0, bytesRead);\n                }\n            }\n\n            // \u521b\u5efa\u5a92\u4f53\u64ad\u653e\u5668\n            MediaPlayer mediaPlayer = new MediaPlayer();\n            mediaPlayer.setDataSource(tempFile.getAbsolutePath());\n            mediaPlayer.setSurface(surfaceView.getHolder().getSurface());\n            mediaPlayer.setOnPreparedListener(mp -&gt; {\n                mp.start();\n                callback.onStarted();\n            });\n            mediaPlayer.setOnCompletionListener(mp -&gt; {\n                // \u64ad\u653e\u5b8c\u6210\u540e\u5220\u9664\u4e34\u65f6\u6587\u4ef6\n                tempFile.delete();\n                callback.onCompleted();\n            });\n            mediaPlayer.setOnErrorListener((mp, what, extra) -&gt; {\n                callback.onError(new RuntimeException(\"MediaPlayer error: \" + what));\n                return true;\n            });\n            mediaPlayer.prepareAsync();\n        } catch (Exception e) {\n            callback.onError(e);\n        }\n    }\n\n    /**\n     * \u521b\u5efa\u4e34\u65f6\u6587\u4ef6\n     */\n    private File createTempFile() throws IOException {\n        File cacheDir = context.getCacheDir();\n        return File.createTempFile(\"decrypt_\", \".tmp\", cacheDir);\n    }\n\n    /**\n     * \u68c0\u67e5\u662f\u5426\u5df2\u6709\u52a0\u5bc6\u5bc6\u94a5\n     */\n    private boolean hasEncryptionKey() {\n        SharedPreferences prefs = context.getSharedPreferences(SHARED_PREFS_NAME, Context.MODE_PRIVATE);\n        return prefs.contains(KEY_USER_KEY) &amp;&amp; prefs.contains(KEY_USER_IV);\n    }\n\n    /**\n     * \u4fdd\u5b58\u52a0\u5bc6\u5bc6\u94a5\n     */\n    private void saveEncryptionKey(UserEncryptionKey key) {\n        // \u5728\u5b9e\u9645\u5e94\u7528\u4e2d\uff0c\u5e94\u4f7f\u7528Android Keystore\u6765\u5b89\u5168\u5b58\u50a8\u5bc6\u94a5\n        SharedPreferences prefs = context.getSharedPreferences(SHARED_PREFS_NAME, Context.MODE_PRIVATE);\n        prefs.edit()\n            .putString(KEY_USER_KEY, key.getEncodedKey())\n            .putString(KEY_USER_IV, key.getEncodedIV())\n            .apply();\n    }\n\n    /**\n     * \u83b7\u53d6\u5b58\u50a8\u7684\u52a0\u5bc6\u5bc6\u94a5\n     */\n    private UserEncryptionKey getStoredEncryptionKey() {\n        SharedPreferences prefs = context.getSharedPreferences(SHARED_PREFS_NAME, Context.MODE_PRIVATE);\n        String key = prefs.getString(KEY_USER_KEY, null);\n        String iv = prefs.getString(KEY_USER_IV, null);\n\n        if (key == null || iv == null) {\n            return null;\n        }\n\n        return new UserEncryptionKey(key, iv);\n    }\n\n    // \u56de\u8c03\u63a5\u53e3\n    public interface EncryptionCallback {\n        void onSuccess();\n        void onError(Exception e);\n    }\n\n    public interface PlaybackCallback {\n        void onStarted();\n        void onCompleted();\n        void onError(Exception e);\n    }\n}\n\n/**\n * API\u670d\u52a1\u63a5\u53e3\n */\ninterface ApiService {\n    void requestEncryptionKey(String userId, ApiCallback&lt;UserEncryptionKey&gt; callback);\n    void getEncryptedVideoStream(String videoId, String token, ApiCallback&lt;InputStream&gt; callback);\n}\n\n/**\n * API\u56de\u8c03\u63a5\u53e3\n */\ninterface ApiCallback&lt;T&gt; {\n    void onSuccess(T result);\n    void onFailure(Exception e);\n}\n\n/**\n * \u5b89\u5168\u589e\u5f3a\u7684\u5b9e\u73b0 - \u4f7f\u7528Android Keystore\u4fdd\u62a4\u52a0\u5bc6\u5bc6\u94a5\n */\npublic class SecureKeyManager {\n    private static final String MASTER_KEY_ALIAS = \"video_encryption_master_key\";\n    private static final String ANDROID_KEYSTORE = \"AndroidKeyStore\";\n\n    /**\n     * \u4f7f\u7528Android Keystore\u5b89\u5168\u5b58\u50a8\u52a0\u5bc6\u5bc6\u94a5\n     */\n    public void securelyStoreKey(Context context, UserEncryptionKey userKey) {\n        try {\n            // \u521b\u5efa\u6216\u83b7\u53d6\u4e3b\u5bc6\u94a5\n            KeyStore keyStore = KeyStore.getInstance(ANDROID_KEYSTORE);\n            keyStore.load(null);\n\n            if (!keyStore.containsAlias(MASTER_KEY_ALIAS)) {\n                KeyGenerator keyGenerator = KeyGenerator.getInstance(\n                        KeyProperties.KEY_ALGORITHM_AES,\n                        ANDROID_KEYSTORE);\n\n                keyGenerator.init(new KeyGenParameterSpec.Builder(\n                        MASTER_KEY_ALIAS,\n                        KeyProperties.PURPOSE_ENCRYPT | KeyProperties.PURPOSE_DECRYPT)\n                        .setBlockModes(KeyProperties.BLOCK_MODE_GCM)\n                        .setEncryptionPaddings(KeyProperties.ENCRYPTION_PADDING_NONE)\n                        .setKeySize(256)\n                        .build());\n\n                keyGenerator.generateKey();\n            }\n\n            // \u83b7\u53d6\u4e3b\u5bc6\u94a5\n            SecretKey masterKey = (SecretKey) keyStore.getKey(MASTER_KEY_ALIAS, null);\n\n            // \u52a0\u5bc6\u7528\u6237\u5bc6\u94a5\n            Cipher cipher = Cipher.getInstance(\"AES/GCM/NoPadding\");\n            cipher.init(Cipher.ENCRYPT_MODE, masterKey);\n            byte[] iv = cipher.getIV();\n\n            byte[] keyBytes = Base64.decode(userKey.getEncodedKey(), Base64.DEFAULT);\n            byte[] ivBytes = Base64.decode(userKey.getEncodedIV(), Base64.DEFAULT);\n\n            byte[] encryptedKey = cipher.doFinal(keyBytes);\n\n            // \u91cd\u65b0\u521d\u59cb\u5316\u52a0\u5bc6\u5668\uff0c\u52a0\u5bc6IV\n            cipher.init(Cipher.ENCRYPT_MODE, masterKey);\n            byte[] ivForIV = cipher.getIV();\n            byte[] encryptedIV = cipher.doFinal(ivBytes);\n\n            // \u4fdd\u5b58\u52a0\u5bc6\u540e\u7684\u5bc6\u94a5\u3001IV\u4ee5\u53ca\u52a0\u5bc6\u8fd9\u4e9b\u503c\u6240\u7528\u7684IV\n            SharedPreferences prefs = context.getSharedPreferences(\"secure_video_keys\", Context.MODE_PRIVATE);\n            prefs.edit()\n                .putString(\"encrypted_key\", Base64.encodeToString(encryptedKey, Base64.DEFAULT))\n                .putString(\"encrypted_iv\", Base64.encodeToString(encryptedIV, Base64.DEFAULT))\n                .putString(\"key_iv\", Base64.encodeToString(iv, Base64.DEFAULT))\n                .putString(\"iv_iv\", Base64.encodeToString(ivForIV, Base64.DEFAULT))\n                .apply();\n\n        } catch (Exception e) {\n            throw new RuntimeException(\"Failed to securely store encryption key\", e);\n        }\n    }\n\n    /**\n     * \u5b89\u5168\u83b7\u53d6\u5b58\u50a8\u7684\u52a0\u5bc6\u5bc6\u94a5\n     */\n    public UserEncryptionKey securelyRetrieveKey(Context context) {\n        try {\n            SharedPreferences prefs = context.getSharedPreferences(\"secure_video_keys\", Context.MODE_PRIVATE);\n            String encryptedKeyStr = prefs.getString(\"encrypted_key\", null);\n            String encryptedIVStr = prefs.getString(\"encrypted_iv\", null);\n            String keyIVStr = prefs.getString(\"key_iv\", null);\n            String ivIVStr = prefs.getString(\"iv_iv\", null);\n\n            if (encryptedKeyStr == null || encryptedIVStr == null || keyIVStr == null || ivIVStr == null) {\n                return null;\n            }\n\n            // \u83b7\u53d6\u4e3b\u5bc6\u94a5\n            KeyStore keyStore = KeyStore.getInstance(ANDROID_KEYSTORE);\n            keyStore.load(null);\n            SecretKey masterKey = (SecretKey) keyStore.getKey(MASTER_KEY_ALIAS, null);\n\n            // \u89e3\u5bc6\u5bc6\u94a5\n            byte[] encryptedKey = Base64.decode(encryptedKeyStr, Base64.DEFAULT);\n            byte[] keyIV = Base64.decode(keyIVStr, Base64.DEFAULT);\n\n            Cipher cipher = Cipher.getInstance(\"AES/GCM/NoPadding\");\n            GCMParameterSpec spec = new GCMParameterSpec(128, keyIV);\n            cipher.init(Cipher.DECRYPT_MODE, masterKey, spec);\n            byte[] keyBytes = cipher.doFinal(encryptedKey);\n\n            // \u89e3\u5bc6IV\n            byte[] encryptedIV = Base64.decode(encryptedIVStr, Base64.DEFAULT);\n            byte[] ivIV = Base64.decode(ivIVStr, Base64.DEFAULT);\n\n            spec = new GCMParameterSpec(128, ivIV);\n            cipher.init(Cipher.DECRYPT_MODE, masterKey, spec);\n            byte[] ivBytes = cipher.doFinal(encryptedIV);\n\n            return new UserEncryptionKey(\n                    Base64.encodeToString(keyBytes, Base64.DEFAULT),\n                    Base64.encodeToString(ivBytes, Base64.DEFAULT));\n\n        } catch (Exception e) {\n            throw new RuntimeException(\"Failed to retrieve encryption key\", e);\n        }\n    }\n}\n</code></pre> <p>\u6211\u8bbe\u8ba1\u7684\u89c6\u9891\u52a0\u5bc6\u7cfb\u7edf\u6db5\u76d6\u4e86\u4ee5\u4e0b\u5173\u952e\u7ec4\u4ef6\u548c\u529f\u80fd\uff1a</p>"},{"location":"050SystemDesign/010Basic/#_43","title":"\u670d\u52a1\u7aef\u90e8\u5206","text":"<ol> <li>VideoEncryptionService \u7c7b</li> <li>\u751f\u6210\u7528\u6237\u4e13\u5c5e\u7684AES-256\u52a0\u5bc6\u5bc6\u94a5\u548c\u521d\u59cb\u5316\u5411\u91cf(IV)</li> <li>\u5bf9\u4e0a\u4f20\u7684\u89c6\u9891\u6587\u4ef6\u8fdb\u884c\u52a0\u5bc6\u5904\u7406</li> <li> <p>\u4e3a\u7528\u6237\u751f\u6210\u89e3\u5bc6\u4ee4\u724c(JWT)\uff0c\u7528\u4e8e\u6388\u6743\u8bbf\u95ee\u52a0\u5bc6\u89c6\u9891</p> </li> <li> <p>\u5b89\u5168\u5b58\u50a8</p> </li> <li>\u7528\u6237\u5bc6\u94a5\u548cIV\u5b89\u5168\u5b58\u50a8\u5728\u6570\u636e\u5e93\u4e2d</li> <li>\u52a0\u5bc6\u89c6\u9891\u5b58\u50a8\u5728\u670d\u52a1\u5668\u7684\u5b89\u5168\u76ee\u5f55\u4e2d</li> </ol>"},{"location":"050SystemDesign/010Basic/#android_3","title":"Android\u5ba2\u6237\u7aef\u90e8\u5206","text":"<ol> <li>VideoEncryptionManager \u7c7b</li> <li>\u5904\u7406\u4e0e\u670d\u52a1\u5668\u7684\u5bc6\u94a5\u4ea4\u6362</li> <li>\u7ba1\u7406\u672c\u5730\u5b58\u50a8\u7684\u52a0\u5bc6\u5bc6\u94a5</li> <li> <p>\u63d0\u4f9b\u52a0\u5bc6\u89c6\u9891\u64ad\u653e\u529f\u80fd</p> </li> <li> <p>\u5b89\u5168\u589e\u5f3a\u63aa\u65bd</p> </li> <li>SecureKeyManager \u7c7b\u5229\u7528Android Keystore\u7cfb\u7edf\u5b89\u5168\u5b58\u50a8\u7528\u6237\u5bc6\u94a5</li> <li>\u4f7f\u7528\u4e3b\u5bc6\u94a5\u5bf9\u7528\u6237\u52a0\u5bc6\u5bc6\u94a5\u8fdb\u884c\u4e8c\u6b21\u52a0\u5bc6\u4fdd\u62a4</li> <li> <p>\u4e34\u65f6\u6587\u4ef6\u5904\u7406\u786e\u4fdd\u89e3\u5bc6\u5185\u5bb9\u4e0d\u4f1a\u88ab\u6301\u4e45\u5316\u5b58\u50a8</p> </li> <li> <p>\u64ad\u653e\u673a\u5236</p> </li> <li>\u4f7f\u7528CipherInputStream\u5b9e\u65f6\u89e3\u5bc6\u89c6\u9891\u6d41</li> <li>\u96c6\u6210MediaPlayer\u64ad\u653e\u89e3\u5bc6\u540e\u7684\u89c6\u9891\u5185\u5bb9</li> </ol>"},{"location":"050SystemDesign/010Basic/#_44","title":"\u7cfb\u7edf\u4f18\u52bf","text":"<ol> <li>\u7aef\u5230\u7aef\u52a0\u5bc6\uff1a\u89c6\u9891\u5728\u670d\u52a1\u5668\u7aef\u52a0\u5bc6\uff0c\u4ec5\u5728\u5ba2\u6237\u7aef\u64ad\u653e\u65f6\u89e3\u5bc6</li> <li>\u7528\u6237\u7ed1\u5b9a\uff1a\u52a0\u5bc6\u5bc6\u94a5\u4e0e\u7528\u6237\u8d26\u53f7\u7ed1\u5b9a\uff0c\u786e\u4fdd\u53ea\u6709\u6388\u6743\u7528\u6237\u53ef\u8bbf\u95ee</li> <li>\u65f6\u6548\u6027\u63a7\u5236\uff1a\u901a\u8fc7JWT\u4ee4\u724c\u5b9e\u73b0\u8bbf\u95ee\u65f6\u6548\u63a7\u5236</li> <li>\u5bc6\u94a5\u4fdd\u62a4\uff1a\u5229\u7528Android Keystore\u4fdd\u62a4\u5ba2\u6237\u7aef\u5b58\u50a8\u7684\u5bc6\u94a5</li> </ol> <p>\u8fd9\u4e2a\u8bbe\u8ba1\u53ef\u4ee5\u6839\u636e\u60a8\u7684\u5177\u4f53\u9700\u6c42\u8fdb\u884c\u8c03\u6574\u3002\u60a8\u9700\u8981\u5177\u4f53\u5b9e\u73b0\u4ec0\u4e48\u6837\u7684\u52a0\u5bc6\u7ea7\u522b\u6216\u6709\u5176\u4ed6\u7279\u6b8a\u9700\u6c42\u5417\uff1f</p>"},{"location":"050SystemDesign/010Basic/#mp4alpha","title":"mp4\u64ad\u653ealpha\u89c6\u9891\u5b9e\u73b0\u7684\u539f\u7406","text":"\u7b54\u6848 <p>MP4\u89c6\u9891\u64ad\u653eAlpha\u901a\u9053\uff08\u900f\u660e\u5ea6\uff09\u7684\u5b9e\u73b0\u539f\u7406\u6d89\u53ca\u89c6\u9891\u7f16\u7801\u3001\u89e3\u7801\u548c\u6e32\u67d3\u7684\u591a\u4e2a\u6280\u672f\u65b9\u9762\u3002\u6211\u6765\u89e3\u91ca\u4e00\u4e0b\u8fd9\u4e2a\u8fc7\u7a0b\uff1a</p>"},{"location":"050SystemDesign/010Basic/#alphamp4","title":"Alpha\u901a\u9053\u5728MP4\u4e2d\u7684\u5b9e\u73b0\u539f\u7406","text":"<ol> <li>\u7f16\u7801\u5c42\u9762\uff1a</li> <li>MP4\u5bb9\u5668\u683c\u5f0f\u672c\u8eab\u652f\u6301\u5b58\u50a8\u5e26\u6709Alpha\u901a\u9053\u7684\u89c6\u9891</li> <li> <p>\u5e38\u7528\u7684\u5b9e\u73b0\u65b9\u6cd5\u6709\u4e24\u79cd\uff1a</p> <ul> <li>\u5206\u79bbAlpha\uff1a\u5c06RGB\u548cAlpha\u5206\u5f00\u7f16\u7801\u4e3a\u4e24\u4e2a\u89c6\u9891\u6d41</li> <li>\u96c6\u6210Alpha\uff1a\u5c06Alpha\u901a\u9053\u4f5c\u4e3a\u89c6\u9891\u7684\u7b2c\u56db\u4e2a\u901a\u9053\u4e00\u8d77\u7f16\u7801</li> </ul> </li> <li> <p>\u5e38\u89c1\u7684\u7f16\u7801\u65b9\u6848\uff1a</p> </li> <li>H.264/AVC + Alpha\uff1a\u4f7f\u7528\u6807\u51c6H.264\u7f16\u7801RGB\u90e8\u5206\uff0c\u53e6\u4e00\u4e2aH.264\u6d41\u7f16\u7801Alpha\u901a\u9053</li> <li>HEVC/H.265 + Alpha\uff1a\u8f83\u65b0\u7684\u6807\u51c6\uff0c\u5bf9Alpha\u652f\u6301\u66f4\u597d\uff0c\u538b\u7f29\u6548\u7387\u66f4\u9ad8</li> <li>ProRes 4444\uff1aApple\u7684\u4e13\u4e1a\u7f16\u89e3\u7801\u5668\uff0c\u539f\u751f\u652f\u6301Alpha\u901a\u9053</li> <li> <p>VP8/VP9\uff1aGoogle\u7684\u5f00\u6e90\u7f16\u89e3\u7801\u5668\uff0c\u4e5f\u652f\u6301Alpha\u901a\u9053</p> </li> <li> <p>\u6e32\u67d3\u5b9e\u73b0\uff1a</p> </li> <li>\u89e3\u7801\u540e\u83b7\u53d6RGB\u56fe\u50cf\u6570\u636e\u548cAlpha\u6570\u636e</li> <li>\u5728\u6e32\u67d3\u8fc7\u7a0b\u4e2d\u5e94\u7528Alpha\u6df7\u5408\u7b97\u6cd5\uff1aC = C_fg * Alpha + C_bg * (1-Alpha)</li> <li> <p>\u901a\u8fc7GPU\u52a0\u901f\u5b9e\u73b0\u5b9e\u65f6Alpha\u6df7\u5408</p> </li> <li> <p>\u5e94\u7528\u5c42\u9762\u7684\u5b9e\u73b0\uff1a</p> </li> <li>\u4f4e\u7ea7\u5b9e\u73b0\uff1a\u4f7f\u7528OpenGL/DirectX\u7b49\u56fe\u5f62API\u624b\u52a8\u5b9e\u73b0Alpha\u6df7\u5408</li> <li>\u9ad8\u7ea7\u5b9e\u73b0\uff1a\u4f7f\u7528\u5a92\u4f53\u6846\u67b6\u5982AVFoundation\u3001MediaFoundation\u7b49\u5904\u7406\u5e26Alpha\u7684\u89c6\u9891</li> </ol> <p>\u5728\u5b9e\u9645\u5e94\u7528\u4e2d\uff0c\u6e32\u67d3\u5e26Alpha\u901a\u9053\u7684MP4\u89c6\u9891\u9700\u8981\u7279\u6b8a\u7684\u64ad\u653e\u5668\u6216\u6846\u67b6\u652f\u6301\uff0c\u666e\u901a\u7684\u89c6\u9891\u64ad\u653e\u5668\u53ef\u80fd\u65e0\u6cd5\u6b63\u786e\u663e\u793aAlpha\u901a\u9053\u3002</p>"},{"location":"050SystemDesign/010Basic/#androidalpha","title":"Android\u5e73\u53f0\u4e0a\u64ad\u653eAlpha\u901a\u9053\u89c6\u9891\u7684\u5b9e\u73b0\u65b9\u6cd5","text":"<p>Android\u5e73\u53f0\u4e0a\u64ad\u653e\u5e26Alpha\u901a\u9053(\u900f\u660e\u5ea6)\u7684\u89c6\u9891\u6709\u51e0\u79cd\u5e38\u89c1\u5b9e\u73b0\u65b9\u5f0f\uff0c\u6bcf\u79cd\u65b9\u6cd5\u6709\u5176\u4f18\u7f3a\u70b9\uff1a</p>"},{"location":"050SystemDesign/010Basic/#1-surfaceviewmediacodec","title":"1. \u4f7f\u7528SurfaceView\u548cMediaCodec","text":"<p>\u8fd9\u662f\u4e00\u79cd\u4f4e\u7ea7\u522b\u4f46\u9ad8\u6548\u7684\u5b9e\u73b0\u65b9\u5f0f\uff1a</p> <pre><code>// \u57fa\u672c\u5b9e\u73b0\u6d41\u7a0b\nMediaExtractor extractor = new MediaExtractor();\nextractor.setDataSource(videoPath);\n// \u83b7\u53d6\u89c6\u9891\u8f68\u9053\nint videoTrackIndex = findTrackIndex(extractor);\n\nMediaCodec decoder = MediaCodec.createDecoderByType(mimeType);\n// \u914d\u7f6e\u89e3\u7801\u5668\ndecoder.configure(format, surface, null, 0);\ndecoder.start();\n\n// \u5728\u5faa\u73af\u4e2d\u89e3\u7801\u5e27\u5e76\u4f7f\u7528OpenGL ES\u6e32\u67d3\n// \u4f7f\u7528shader\u5904\u7406Alpha\u6df7\u5408\n</code></pre> <p>\u4f18\u70b9\uff1a\u6027\u80fd\u597d\uff0c\u53ef\u4ee5\u7cbe\u786e\u63a7\u5236\u6e32\u67d3\u8fc7\u7a0b \u7f3a\u70b9\uff1a\u5b9e\u73b0\u590d\u6742\uff0c\u9700\u8981\u624b\u5199OpenGL ES\u4ee3\u7801\u5904\u7406Alpha</p>"},{"location":"050SystemDesign/010Basic/#2-exoplayer","title":"2. \u4f7f\u7528ExoPlayer","text":"<p>ExoPlayer\u662fGoogle\u63d0\u4f9b\u7684\u9ad8\u7ea7\u5a92\u4f53\u64ad\u653e\u5668\u5e93\uff0c\u66f4\u5bb9\u6613\u5b9e\u73b0\uff1a</p> <pre><code>// \u51c6\u5907ExoPlayer\nExoPlayer player = new ExoPlayer.Builder(context).build();\n\n// \u8bbe\u7f6e\u5a92\u4f53\u6e90\nMediaSource mediaSource = new ProgressiveMediaSource.Factory(dataSourceFactory)\n    .createMediaSource(MediaItem.fromUri(videoUri));\n\n// \u914d\u7f6e\u6e32\u67d3\u5668\nplayer.setMediaSource(mediaSource);\n\n// \u8bbe\u7f6e\u81ea\u5b9a\u4e49\u7684Surface\nSurfaceView surfaceView = findViewById(R.id.surface_view);\nplayer.setVideoSurfaceView(surfaceView);\n\n// \u5b9e\u73b0\u4e00\u4e2a\u81ea\u5b9a\u4e49Renderer\u6765\u5904\u7406Alpha\u901a\u9053\n// \u901a\u5e38\u9700\u8981\u81ea\u5b9a\u4e49Shader\n</code></pre> <p>ExoPlayer\u53ef\u4ee5\u901a\u8fc7\u6269\u5c55\u5176\u6e32\u67d3\u5668\u6765\u652f\u6301Alpha\u901a\u9053\u89c6\u9891\u3002</p>"},{"location":"050SystemDesign/010Basic/#3_9","title":"3. \u4f7f\u7528\u4e24\u4e2a\u89c6\u9891\u6d41\u65b9\u6cd5","text":"<pre><code>// \u52a0\u8f7d\u4e24\u4e2a\u89c6\u9891 - \u4e00\u4e2a\u662fRGB\u5185\u5bb9\uff0c\u4e00\u4e2a\u662fAlpha\u63a9\u7801\nVideoView rgbView = findViewById(R.id.rgb_video);\nVideoView alphaView = findViewById(R.id.alpha_video);\n\n// \u8bbe\u7f6eAlpha\u63a9\u7801\u89c6\u9891\u4f5c\u4e3aRGB\u89c6\u9891\u7684Alpha\u901a\u9053\n// \u53ef\u4ee5\u901a\u8fc7\u81ea\u5b9a\u4e49View\u6216\u4f7f\u7528PorterDuff\u6df7\u5408\u6a21\u5f0f\u5b9e\u73b0\n</code></pre> <p>\u4f18\u70b9\uff1a\u5b9e\u73b0\u7b80\u5355\uff0c\u4f7f\u7528\u6807\u51c6\u7ec4\u4ef6 \u7f3a\u70b9\uff1a\u9700\u8981\u51c6\u5907\u4e24\u4e2a\u5355\u72ec\u7684\u89c6\u9891\u6587\u4ef6\uff0c\u540c\u6b65\u53ef\u80fd\u4f1a\u6709\u95ee\u9898</p>"},{"location":"050SystemDesign/010Basic/#4-textureview","title":"4. \u4f7f\u7528TextureView\u548c\u81ea\u5b9a\u4e49\u6df7\u5408","text":"<pre><code>TextureView textureView = findViewById(R.id.texture_view);\ntextureView.setSurfaceTextureListener(new TextureView.SurfaceTextureListener() {\n    @Override\n    public void onSurfaceTextureAvailable(SurfaceTexture surface, int width, int height) {\n        // \u521d\u59cb\u5316MediaPlayer\n        mediaPlayer.setSurface(new Surface(surface));\n\n        // \u8bbe\u7f6e\u81ea\u5b9a\u4e49shader\u4ee5\u5904\u7406Alpha\u901a\u9053\n        // \u901a\u5e38\u901a\u8fc7GLSurfaceView\u6216\u81ea\u5b9a\u4e49\u6e32\u67d3\u5668\u5b9e\u73b0\n    }\n    // \u5176\u4ed6\u56de\u8c03\u65b9\u6cd5...\n});\n</code></pre>"},{"location":"050SystemDesign/010Basic/#_45","title":"\u5b9e\u9645\u5de5\u7a0b\u5b9e\u73b0\u5efa\u8bae","text":"<ol> <li>\u6587\u4ef6\u683c\u5f0f\u9009\u62e9\uff1a</li> <li>\u4f7f\u7528WebM (VP8/VP9) \u683c\u5f0f\uff0cAndroid\u539f\u751f\u652f\u6301\u8f83\u597d</li> <li> <p>\u6216\u4f7f\u7528\u7279\u6b8a\u7f16\u7801\u7684MP4\uff0c\u5982H.264+Alpha</p> </li> <li> <p>\u7f16\u7801\u65b9\u5f0f\uff1a</p> </li> <li>\u9884\u4e58Alpha\u65b9\u5f0f\u7f16\u7801\u89c6\u9891\u6548\u679c\u66f4\u597d</li> <li> <p>\u63a8\u8350\u89c6\u9891\u5c3a\u5bf8\u662f2\u7684\u5e42\u6b21\u65b9\uff0c\u4ee5\u4f18\u5316GPU\u6e32\u67d3</p> </li> <li> <p>\u6e32\u67d3\u4f18\u5316\uff1a</p> </li> <li>\u4f18\u5148\u4f7f\u7528\u786c\u4ef6\u52a0\u901f</li> <li>\u8003\u8651\u4f7f\u7528OpenGL ES\u7740\u8272\u5668\u76f4\u63a5\u5728GPU\u4e2d\u5904\u7406Alpha\u6df7\u5408</li> </ol> <p>\u60a8\u9700\u8981\u5177\u4f53\u9488\u5bf9\u54ea\u79cd\u65b9\u6848\u7684\u66f4\u8be6\u7ec6\u5b9e\u73b0\uff0c\u6216\u8005\u6709\u5176\u4ed6\u7279\u5b9a\u95ee\u9898\u9700\u8981\u89e3\u7b54\u5417\uff1f</p>"},{"location":"060HarmonyOS/010Basic/","title":"HarmonyOS Next","text":""},{"location":"060HarmonyOS/010Basic/#_1","title":"HarmonyOS Next","text":"\u7b54\u6848"},{"location":"070Flutter/010Basic/","title":"010Basic","text":""},{"location":"070Flutter/010Basic/#flutter","title":"Flutter","text":""},{"location":"080Others/010Basic/","title":"others","text":""},{"location":"080Others/010Basic/#google-playapp","title":"Google Play\u591a\u4e2a\u76f8\u540c\u529f\u80fd\u7684App\u4e0a\u67b6\u95ee\u9898","text":"\u7b54\u6848"},{"location":"080Others/010Basic/#google-play-app-ui","title":"\u5728 Google Play \u4e0a\u67b6\u591a\u4e2a\u529f\u80fd\u76f8\u4f3c\u7684 App \u65f6\uff0c\u9664\u4e86\u4fee\u6539\u5305\u540d\u548c UI \u8d44\u6e90\u5916\uff0c\u8fd8\u9700\u8981\u7279\u522b\u6ce8\u610f\u4ee5\u4e0b\u95ee\u9898\uff0c\u4ee5\u907f\u514d\u8fdd\u53cd\u653f\u7b56\u6216\u88ab\u5224\u5b9a\u4e3a\u91cd\u590d\u5e94\u7528\uff1a","text":""},{"location":"080Others/010Basic/#1","title":"1. \u529f\u80fd\u5dee\u5f02\u5316","text":"<ul> <li>\u6838\u5fc3\u529f\u80fd\u8c03\u6574\uff1a\u786e\u4fdd\u6bcf\u4e2a App \u6709\u660e\u786e\u7684\u72ec\u7279\u529f\u80fd\u6216\u76ee\u6807\u7528\u6237\u7fa4\u4f53\uff08\u4f8b\u5982\u9488\u5bf9\u4e0d\u540c\u573a\u666f\u3001\u5730\u533a\u3001\u5782\u76f4\u9700\u6c42\uff09\u3002  </li> <li>\u907f\u514d\u5b8c\u5168\u590d\u5236\uff1aGoogle Play \u7981\u6b62\u201c\u529f\u80fd\u91cd\u590d\u7684\u5e94\u7528\u7a0b\u5e8f\u7fa4\u201d\uff0c\u82e5\u591a\u4e2a App \u4ec5\u5fae\u8c03\u989c\u8272/\u540d\u79f0\uff0c\u53ef\u80fd\u88ab\u4e0b\u67b6\u3002</li> </ul>"},{"location":"080Others/010Basic/#2","title":"2. \u5143\u6570\u636e\u4e0e\u54c1\u724c\u6807\u8bc6","text":"<ul> <li>\u5e94\u7528\u540d\u79f0/\u63cf\u8ff0\uff1a\u6bcf\u4e2a App \u7684\u540d\u79f0\u3001\u526f\u6807\u9898\u3001\u63cf\u8ff0\u9700\u663e\u8457\u4e0d\u540c\uff0c\u907f\u514d\u91cd\u590d\u5173\u952e\u8bcd\u5806\u780c\u3002  </li> <li>\u56fe\u6807/\u622a\u56fe\uff1a\u56fe\u6807\u8bbe\u8ba1\u3001\u5ba3\u4f20\u56fe\u3001\u89c6\u9891\u9700\u6709\u660e\u663e\u533a\u5206\uff0c\u907f\u514d\u6a21\u677f\u5316\u590d\u7528\u3002  </li> <li>\u5f00\u53d1\u8005\u8d26\u53f7\u540d\u79f0\uff1a\u82e5\u8d26\u53f7\u540d\u79f0\u4e0e App \u54c1\u724c\u5173\u8054\u6027\u5f3a\uff0c\u9700\u907f\u514d\u8bef\u5bfc\u7528\u6237\u8ba4\u4e3a\u6240\u6709 App \u662f\u540c\u4e00\u4ea7\u54c1\u3002</li> </ul>"},{"location":"080Others/010Basic/#3","title":"3. \u4ee3\u7801\u4e0e\u540e\u7aef\u670d\u52a1","text":"<ul> <li>\u4ee3\u7801\u7ed3\u6784\uff1a\u5373\u4f7f\u529f\u80fd\u7c7b\u4f3c\uff0c\u5efa\u8bae\u91cd\u6784\u4ee3\u7801\u903b\u8f91\u6216\u6a21\u5757\uff0c\u907f\u514d\u5b8c\u5168\u76f8\u540c\u7684\u4ee3\u7801\u5e93\uff08\u53ef\u901a\u8fc7\u6df7\u6dc6\u6216\u6a21\u5757\u5316\u533a\u5206\uff09\u3002  </li> <li>API/\u670d\u52a1\u5668\uff1a\u82e5\u5171\u7528\u540e\u7aef\uff0c\u786e\u4fdd\u6570\u636e\u9694\u79bb\uff0c\u907f\u514d\u7528\u6237\u6df7\u6dc6\uff08\u5982\u4e0d\u540c App \u7684\u8d26\u53f7\u4f53\u7cfb\u4e0d\u4e92\u901a\uff09\u3002  </li> </ul>"},{"location":"080Others/010Basic/#4","title":"4. \u653f\u7b56\u5408\u89c4\u6027","text":"<ul> <li>\u5783\u573e\u5e94\u7528\u653f\u7b56\uff1aGoogle \u660e\u786e\u7981\u6b62\u201c\u521b\u5efa\u591a\u4e2a\u76f8\u4f3c\u5e94\u7528\u4ee5\u5360\u636e\u641c\u7d22\u7ed3\u679c\u6392\u540d\u201d\u7684\u884c\u4e3a\u3002  </li> <li>\u7528\u6237\u4ef7\u503c\uff1a\u6bcf\u4e2a App \u9700\u63d0\u4f9b\u72ec\u7acb\u4ef7\u503c\uff0c\u5426\u5219\u53ef\u80fd\u88ab\u5224\u5b9a\u4e3a\u201c\u5783\u573e\u5e94\u7528\u201d\u3002  </li> <li>\u5e7f\u544a\u4e0e\u53d8\u73b0\uff1a\u82e5\u4f7f\u7528\u5e7f\u544a\uff0c\u907f\u514d\u540c\u4e00\u5e7f\u544a\u7f51\u7edc\u5728\u591a\u4e2a App \u4e2d\u91cd\u590d\u5c55\u793a\u76f8\u540c\u5e7f\u544a\uff08\u53ef\u80fd\u8fdd\u53cd\u5e7f\u544a\u5e73\u53f0\u653f\u7b56\uff09\u3002</li> </ul>"},{"location":"080Others/010Basic/#5","title":"5. \u7528\u6237\u611f\u77e5\u4e0e\u652f\u6301","text":"<ul> <li>\u9690\u79c1\u653f\u7b56\uff1a\u82e5\u6570\u636e\u6536\u96c6\u65b9\u5f0f\u4e0d\u540c\uff0c\u9700\u5206\u522b\u63d0\u4f9b\u9690\u79c1\u653f\u7b56\u94fe\u63a5\u3002  </li> <li>\u5ba2\u670d\u4fe1\u606f\uff1a\u4e0d\u540c App \u7684\u652f\u6301\u8054\u7cfb\u65b9\u5f0f\u9700\u72ec\u7acb\uff08\u82e5\u5171\u7528\u90ae\u7bb1\uff0c\u9700\u8bf4\u660e\u5173\u8054\u6027\uff09\u3002  </li> </ul>"},{"location":"080Others/010Basic/#6","title":"6. \u957f\u671f\u7ef4\u62a4","text":"<ul> <li>\u66f4\u65b0\u9891\u7387\uff1a\u907f\u514d\u540c\u65f6\u6279\u91cf\u66f4\u65b0\u6240\u6709 App\uff0c\u53ef\u80fd\u89e6\u53d1\u5ba1\u6838\u8b66\u60d5\u3002  </li> <li>\u4e0b\u67b6\u98ce\u9669\uff1a\u82e5\u5176\u4e2d\u4e00\u4e2a App \u8fdd\u89c4\uff0c\u53ef\u80fd\u7275\u8fde\u5176\u4ed6\u76f8\u4f3c App \u88ab\u5ba1\u67e5\u3002</li> </ul>"},{"location":"080Others/010Basic/#_1","title":"\u5efa\u8bae\u7b56\u7565","text":"<ul> <li>\u6d4b\u8bd5\u4e0d\u540c\u5e02\u573a\uff1a\u7528\u4e0d\u540c App \u9488\u5bf9\u4e0d\u540c\u5730\u533a\u6216\u7528\u6237\u5206\u5c42\uff08\u5982\u514d\u8d39\u7248/\u4e13\u4e1a\u7248\uff09\u3002  </li> <li>\u5408\u5e76\u529f\u80fd\uff1a\u4f18\u5148\u8003\u8651\u901a\u8fc7\u5e94\u7528\u5185\u529f\u80fd\u6a21\u5757\uff08\u5982\u8ba2\u9605\u9009\u9879\uff09\u5b9e\u73b0\u9700\u6c42\uff0c\u800c\u975e\u62c6\u5206\u591a\u4e2a App\u3002  </li> </ul> <p>\u5982\u679c\u76ee\u6807\u662f\u77e9\u9635\u5316\u8fd0\u8425\uff0c\u52a1\u5fc5\u786e\u4fdd\u6bcf\u4e2a App \u6709\u6e05\u6670\u5b9a\u4f4d\uff0c\u5e76\u63d0\u524d\u54a8\u8be2 Google Play \u653f\u7b56\u652f\u6301\u4ee5\u907f\u514d\u5c01\u53f7\u98ce\u9669\u3002</p>"}]}