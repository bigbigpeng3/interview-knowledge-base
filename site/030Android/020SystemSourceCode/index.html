
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../010Basic/">
      
      
        <link rel="next" href="../030ThirdSDKSourceCode/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.8">
    
    
      
        <title>Android系统源码解析 - 面试知识库</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.8608ea7d.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#_1" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href="../.." title="面试知识库" class="md-header__button md-logo" aria-label="面试知识库" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            面试知识库
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Android系统源码解析
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="切换到暗色模式"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="切换到暗色模式" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="切换到亮色模式"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="切换到亮色模式" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
        <button type="reset" class="md-search__icon md-icon" title="清空当前内容" aria-label="清空当前内容" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="标签" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../010Java/010Basic/" class="md-tabs__link">
          
  
  Java

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../020Kotlin/010Basic/" class="md-tabs__link">
          
  
  Kotlin

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../010Basic/" class="md-tabs__link">
          
  
  Android

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../040Jetpack/010Basic/" class="md-tabs__link">
          
  
  Jetpack

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../041KMP/010Basic/" class="md-tabs__link">
          
  
  KMP

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../050SystemDesign/010Basic/" class="md-tabs__link">
          
  
  System Design

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="面试知识库" class="md-nav__button md-logo" aria-label="面试知识库" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    面试知识库
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_1" >
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Java
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            Java
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../010Java/010Basic/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Java基础
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../010Java/040MultiThreading/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Java多线程
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../010Java/020DataStructure/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Java数据结构
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../010Java/030Algorithm/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Java算法
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../010Java/050Pattern/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Java设计模式
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Kotlin
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Kotlin
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../020Kotlin/010Basic/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Kotlin基础
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../020Kotlin/020Coroutines/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Kotlin协程
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Android
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Android
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../010Basic/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Android基础
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Android系统源码解析
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Android系统源码解析
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#android-activity" class="md-nav__link">
    <span class="md-ellipsis">
      Android Activity的启动过程
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Android Activity的启动过程">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1" class="md-nav__link">
    <span class="md-ellipsis">
      1. 启动请求
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-instrumentation" class="md-nav__link">
    <span class="md-ellipsis">
      2. Instrumentation处理
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-activitytaskmanagerservice-atms" class="md-nav__link">
    <span class="md-ellipsis">
      3. ActivityTaskManagerService (ATMS) 处理
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-activityrecord" class="md-nav__link">
    <span class="md-ellipsis">
      4. 创建ActivityRecord
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5" class="md-nav__link">
    <span class="md-ellipsis">
      5. 应用进程交互
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6-applicationthread" class="md-nav__link">
    <span class="md-ellipsis">
      6. ApplicationThread处理
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7-activitythread" class="md-nav__link">
    <span class="md-ellipsis">
      7. ActivityThread处理
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#8-activity" class="md-nav__link">
    <span class="md-ellipsis">
      8. 创建和初始化Activity
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#9-activity" class="md-nav__link">
    <span class="md-ellipsis">
      9. Activity生命周期回调
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#10" class="md-nav__link">
    <span class="md-ellipsis">
      10. 界面显示
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      总结
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#android-recyclerview" class="md-nav__link">
    <span class="md-ellipsis">
      Android RecyclerView源码解析
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#android-recyclerviewlistview" class="md-nav__link">
    <span class="md-ellipsis">
      从源码角度分析Android RecyclerView和ListView的区别，以及有哪些特性
    </span>
  </a>
  
    <nav class="md-nav" aria-label="从源码角度分析Android RecyclerView和ListView的区别，以及有哪些特性">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-viewholder" class="md-nav__link">
    <span class="md-ellipsis">
      1. ViewHolder 模式
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2" class="md-nav__link">
    <span class="md-ellipsis">
      2. 布局管理
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-item" class="md-nav__link">
    <span class="md-ellipsis">
      3. Item 动画
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4" class="md-nav__link">
    <span class="md-ellipsis">
      4. 数据更新
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-item" class="md-nav__link">
    <span class="md-ellipsis">
      5. Item 装饰
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6-item" class="md-nav__link">
    <span class="md-ellipsis">
      6. Item 点击事件
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7" class="md-nav__link">
    <span class="md-ellipsis">
      7. 源码结构
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#8" class="md-nav__link">
    <span class="md-ellipsis">
      8. 性能优化
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#9" class="md-nav__link">
    <span class="md-ellipsis">
      9. 嵌套滚动
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#10_1" class="md-nav__link">
    <span class="md-ellipsis">
      10. 扩展性
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      总结
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#android-recyclerview_1" class="md-nav__link">
    <span class="md-ellipsis">
      Android RecyclerView的缓存机制
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Android RecyclerView的缓存机制">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-viewholder_1" class="md-nav__link">
    <span class="md-ellipsis">
      1. ViewHolder 缓存
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-recycler-pool" class="md-nav__link">
    <span class="md-ellipsis">
      2. Recycler Pool
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-prefetch" class="md-nav__link">
    <span class="md-ellipsis">
      3. Prefetch 机制
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-item-animations" class="md-nav__link">
    <span class="md-ellipsis">
      4. Item Animations 缓存
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-layoutmanager" class="md-nav__link">
    <span class="md-ellipsis">
      5. LayoutManager 缓存
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6" class="md-nav__link">
    <span class="md-ellipsis">
      6. 自定义缓存策略
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      总结
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1-viewholder_2" class="md-nav__link">
    <span class="md-ellipsis">
      1. ViewHolder 存储的信息
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1. ViewHolder 存储的信息">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_1" class="md-nav__link">
    <span class="md-ellipsis">
      (1) 视图引用
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_1" class="md-nav__link">
    <span class="md-ellipsis">
      (2) 数据绑定状态
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3" class="md-nav__link">
    <span class="md-ellipsis">
      (3) 位置信息
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4_1" class="md-nav__link">
    <span class="md-ellipsis">
      (4) 其他元数据
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-recyclerview-viewholder" class="md-nav__link">
    <span class="md-ellipsis">
      2. 为什么 RecyclerView 使用 ViewHolder 作为缓存介质？
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. 为什么 RecyclerView 使用 ViewHolder 作为缓存介质？">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-findviewbyid" class="md-nav__link">
    <span class="md-ellipsis">
      (1) 减少 findViewById 的开销
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_2" class="md-nav__link">
    <span class="md-ellipsis">
      (2) 视图复用
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3_1" class="md-nav__link">
    <span class="md-ellipsis">
      (3) 分离视图和数据
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4_2" class="md-nav__link">
    <span class="md-ellipsis">
      (4) 支持多种视图类型
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5_1" class="md-nav__link">
    <span class="md-ellipsis">
      (5) 提升滚动性能
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6_1" class="md-nav__link">
    <span class="md-ellipsis">
      (6) 支持动画和状态保存
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-viewholder" class="md-nav__link">
    <span class="md-ellipsis">
      3. ViewHolder 的工作流程
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      总结
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#android-recyclerviewviewviewgrouptextview" class="md-nav__link">
    <span class="md-ellipsis">
      Android RecyclerView如何刷新某一个单独的View，比如一个ViewGroup里面的textView？
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Android RecyclerView如何刷新某一个单独的View，比如一个ViewGroup里面的textView？">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      实现步骤
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      示例代码
    </span>
  </a>
  
    <nav class="md-nav" aria-label="示例代码">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-adapter" class="md-nav__link">
    <span class="md-ellipsis">
      1. Adapter 实现
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_3" class="md-nav__link">
    <span class="md-ellipsis">
      2. 使用示例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      关键点解析
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#payload" class="md-nav__link">
    <span class="md-ellipsis">
      扩展：支持多个 Payload
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    <span class="md-ellipsis">
      总结
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#diffutilsdiffutilsdiffutilspayload" class="md-nav__link">
    <span class="md-ellipsis">
      请问DiffUtils能起到什么作用？为什么要使用DiffUtils？以及DiffUtils能否和Payload机制配合？
    </span>
  </a>
  
    <nav class="md-nav" aria-label="请问DiffUtils能起到什么作用？为什么要使用DiffUtils？以及DiffUtils能否和Payload机制配合？">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#diffutil" class="md-nav__link">
    <span class="md-ellipsis">
      DiffUtil 的作用
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#diffutil_1" class="md-nav__link">
    <span class="md-ellipsis">
      为什么要使用 DiffUtil？
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#diffutil_2" class="md-nav__link">
    <span class="md-ellipsis">
      DiffUtil 的基本用法
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DiffUtil 的基本用法">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-diffutilcallback" class="md-nav__link">
    <span class="md-ellipsis">
      1. 实现 DiffUtil.Callback
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-diffutil" class="md-nav__link">
    <span class="md-ellipsis">
      2. 使用 DiffUtil 计算差异
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    <span class="md-ellipsis">
      示例代码
    </span>
  </a>
  
    <nav class="md-nav" aria-label="示例代码">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_2" class="md-nav__link">
    <span class="md-ellipsis">
      1. 数据模型
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-diffutilcallback" class="md-nav__link">
    <span class="md-ellipsis">
      2. 实现 DiffUtil.Callback
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-adapter" class="md-nav__link">
    <span class="md-ellipsis">
      3. Adapter 实现
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4_3" class="md-nav__link">
    <span class="md-ellipsis">
      4. 使用示例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#diffutil-payload" class="md-nav__link">
    <span class="md-ellipsis">
      DiffUtil 和 Payload 机制的配合
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    <span class="md-ellipsis">
      总结
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#android-surfaceview" class="md-nav__link">
    <span class="md-ellipsis">
      Android SurfaceView原理解析
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Android SurfaceView原理解析">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-surfaceview" class="md-nav__link">
    <span class="md-ellipsis">
      1. SurfaceView 的特点
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-surfaceview" class="md-nav__link">
    <span class="md-ellipsis">
      2. SurfaceView 的基本结构
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. SurfaceView 的基本结构">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    <span class="md-ellipsis">
      关键类和方法：
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-surfaceview" class="md-nav__link">
    <span class="md-ellipsis">
      3. SurfaceView 的使用步骤
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3. SurfaceView 的使用步骤">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-surfaceview_1" class="md-nav__link">
    <span class="md-ellipsis">
      （1）在布局文件中定义 SurfaceView
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-activity-fragment-surfaceview" class="md-nav__link">
    <span class="md-ellipsis">
      （2）在 Activity 或 Fragment 中初始化 SurfaceView
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-surfaceholdercallback" class="md-nav__link">
    <span class="md-ellipsis">
      （3）实现 SurfaceHolder.Callback 接口
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4_4" class="md-nav__link">
    <span class="md-ellipsis">
      （4）在独立线程中绘制内容
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-surfaceview" class="md-nav__link">
    <span class="md-ellipsis">
      4. SurfaceView 的注意事项
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-surfaceview" class="md-nav__link">
    <span class="md-ellipsis">
      5. SurfaceView 的替代方案
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6-surfaceview" class="md-nav__link">
    <span class="md-ellipsis">
      6. 示例：使用 SurfaceView 实现简单动画
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#android-surfaceviewui" class="md-nav__link">
    <span class="md-ellipsis">
      为什么Android SurfaceView可以在子线程刷新UI？
    </span>
  </a>
  
    <nav class="md-nav" aria-label="为什么Android SurfaceView可以在子线程刷新UI？">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-surface" class="md-nav__link">
    <span class="md-ellipsis">
      1. 独立的 Surface
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_4" class="md-nav__link">
    <span class="md-ellipsis">
      2. 双缓冲机制
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-surfaceholder-canvas" class="md-nav__link">
    <span class="md-ellipsis">
      3. SurfaceHolder 和 Canvas 的控制
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4_5" class="md-nav__link">
    <span class="md-ellipsis">
      4. 硬件加速支持
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-view" class="md-nav__link">
    <span class="md-ellipsis">
      5. 与普通 View 的对比
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6-view-ui" class="md-nav__link">
    <span class="md-ellipsis">
      6. 为什么普通 View 不能在子线程刷新 UI？
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7-surfaceview" class="md-nav__link">
    <span class="md-ellipsis">
      7. SurfaceView 的子线程绘制示例
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    <span class="md-ellipsis">
      总结
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#android-surfaceview-view" class="md-nav__link">
    <span class="md-ellipsis">
      Android 和SurfaceView相关的, 哪个View更适合视频播放？更简单易用。
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Android 和SurfaceView相关的, 哪个View更适合视频播放？更简单易用。">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#surfaceview" class="md-nav__link">
    <span class="md-ellipsis">
      SurfaceView
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#textureview" class="md-nav__link">
    <span class="md-ellipsis">
      TextureView
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    <span class="md-ellipsis">
      更简单易用的选择
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_15" class="md-nav__link">
    <span class="md-ellipsis">
      总结
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#android-remoteviews" class="md-nav__link">
    <span class="md-ellipsis">
      Android RemoteViews实现和使用场景
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Android RemoteViews实现和使用场景">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#android-remoteviews_1" class="md-nav__link">
    <span class="md-ellipsis">
      Android RemoteViews 实现和使用场景
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Android RemoteViews 实现和使用场景">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_3" class="md-nav__link">
    <span class="md-ellipsis">
      1. 概述
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_5" class="md-nav__link">
    <span class="md-ellipsis">
      2. 实现步骤
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. 实现步骤">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21-remoteviews" class="md-nav__link">
    <span class="md-ellipsis">
      2.1 创建 RemoteViews 对象
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22" class="md-nav__link">
    <span class="md-ellipsis">
      2.2 设置视图内容
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23-app-widget" class="md-nav__link">
    <span class="md-ellipsis">
      2.3 应用到通知或 App Widget
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#24" class="md-nav__link">
    <span class="md-ellipsis">
      2.4 处理点击事件
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3_2" class="md-nav__link">
    <span class="md-ellipsis">
      3. 使用场景
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3. 使用场景">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31" class="md-nav__link">
    <span class="md-ellipsis">
      3.1 通知栏定制
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32-app-widgets" class="md-nav__link">
    <span class="md-ellipsis">
      3.2 App Widgets
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#33-ui" class="md-nav__link">
    <span class="md-ellipsis">
      3.3 系统 UI 定制
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4_6" class="md-nav__link">
    <span class="md-ellipsis">
      4. 注意事项
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5_2" class="md-nav__link">
    <span class="md-ellipsis">
      5. 总结
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#android-activitythread" class="md-nav__link">
    <span class="md-ellipsis">
      Android ActivityThread源码解析
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Android ActivityThread源码解析">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-activitythread" class="md-nav__link">
    <span class="md-ellipsis">
      1. ActivityThread 概述
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-activitythread" class="md-nav__link">
    <span class="md-ellipsis">
      2. ActivityThread 的主要职责
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-activitythread" class="md-nav__link">
    <span class="md-ellipsis">
      3. ActivityThread 的核心方法
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3. ActivityThread 的核心方法">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31-mainstring-args" class="md-nav__link">
    <span class="md-ellipsis">
      3.1 main(String[] args)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32-attachboolean-system" class="md-nav__link">
    <span class="md-ellipsis">
      3.2 attach(boolean system)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#33-handlemessagemessage-msg" class="md-nav__link">
    <span class="md-ellipsis">
      3.3 handleMessage(Message msg)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#34-handlelaunchactivityactivityclientrecord-r" class="md-nav__link">
    <span class="md-ellipsis">
      3.4 handleLaunchActivity(ActivityClientRecord r)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-applicationthread" class="md-nav__link">
    <span class="md-ellipsis">
      4. ApplicationThread
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5_3" class="md-nav__link">
    <span class="md-ellipsis">
      5. 总结
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6_2" class="md-nav__link">
    <span class="md-ellipsis">
      6. 关键点
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#android" class="md-nav__link">
    <span class="md-ellipsis">
      Android进程名称是如何被指定的？
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Android进程名称是如何被指定的？">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-activitythread_1" class="md-nav__link">
    <span class="md-ellipsis">
      1. ActivityThread类
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1. ActivityThread类">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#main" class="md-nav__link">
    <span class="md-ellipsis">
      main方法
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-attach" class="md-nav__link">
    <span class="md-ellipsis">
      2. attach方法
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-process" class="md-nav__link">
    <span class="md-ellipsis">
      3. Process类
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3. Process类">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#setargv0" class="md-nav__link">
    <span class="md-ellipsis">
      setArgV0方法
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-activitymanagerservice" class="md-nav__link">
    <span class="md-ellipsis">
      4. ActivityManagerService
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4. ActivityManagerService">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#startprocesslocked" class="md-nav__link">
    <span class="md-ellipsis">
      startProcessLocked方法
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-processstart" class="md-nav__link">
    <span class="md-ellipsis">
      5. Process.start方法
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_16" class="md-nav__link">
    <span class="md-ellipsis">
      总结
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#android-binder" class="md-nav__link">
    <span class="md-ellipsis">
      Android Binder机制
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Android Binder机制">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-binder" class="md-nav__link">
    <span class="md-ellipsis">
      1. Binder机制概述
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-binder" class="md-nav__link">
    <span class="md-ellipsis">
      2. Binder机制的主要组件
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-binder" class="md-nav__link">
    <span class="md-ellipsis">
      3. Binder机制的工作流程
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-binder" class="md-nav__link">
    <span class="md-ellipsis">
      4. Binder机制的特点
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-binder" class="md-nav__link">
    <span class="md-ellipsis">
      5. Binder机制的应用
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6-binder" class="md-nav__link">
    <span class="md-ellipsis">
      6. Binder机制的实现细节
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7-binder" class="md-nav__link">
    <span class="md-ellipsis">
      7. Binder机制的优缺点
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_17" class="md-nav__link">
    <span class="md-ellipsis">
      总结
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#android-ams" class="md-nav__link">
    <span class="md-ellipsis">
      Android AMS机制
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Android AMS机制">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-ams" class="md-nav__link">
    <span class="md-ellipsis">
      1. AMS的主要功能
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-ams" class="md-nav__link">
    <span class="md-ellipsis">
      2. AMS的工作机制
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. AMS的工作机制">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21-activity" class="md-nav__link">
    <span class="md-ellipsis">
      2.1 Activity的启动流程
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22-service" class="md-nav__link">
    <span class="md-ellipsis">
      2.2 Service的启动流程
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23" class="md-nav__link">
    <span class="md-ellipsis">
      2.3 进程管理
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#24_1" class="md-nav__link">
    <span class="md-ellipsis">
      2.4 任务栈管理
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-ams" class="md-nav__link">
    <span class="md-ellipsis">
      3. AMS的启动模式
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-amsbinder" class="md-nav__link">
    <span class="md-ellipsis">
      4. AMS与Binder机制
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-ams" class="md-nav__link">
    <span class="md-ellipsis">
      5. AMS的优化与限制
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6_3" class="md-nav__link">
    <span class="md-ellipsis">
      6. 总结
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#android_1" class="md-nav__link">
    <span class="md-ellipsis">
      你知道哪些Android系统源码的设计模式？
    </span>
  </a>
  
    <nav class="md-nav" aria-label="你知道哪些Android系统源码的设计模式？">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-singleton" class="md-nav__link">
    <span class="md-ellipsis">
      1. 单例模式（Singleton）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-factory" class="md-nav__link">
    <span class="md-ellipsis">
      2. 工厂模式（Factory）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-observer" class="md-nav__link">
    <span class="md-ellipsis">
      3. 观察者模式（Observer）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-adapter" class="md-nav__link">
    <span class="md-ellipsis">
      4. 适配器模式（Adapter）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-decorator" class="md-nav__link">
    <span class="md-ellipsis">
      5. 装饰者模式（Decorator）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6-strategy" class="md-nav__link">
    <span class="md-ellipsis">
      6. 策略模式（Strategy）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7-template-method" class="md-nav__link">
    <span class="md-ellipsis">
      7. 模板方法模式（Template Method）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#8-builder" class="md-nav__link">
    <span class="md-ellipsis">
      8. 建造者模式（Builder）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#9-proxy" class="md-nav__link">
    <span class="md-ellipsis">
      9. 代理模式（Proxy）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#10-composite" class="md-nav__link">
    <span class="md-ellipsis">
      10. 组合模式（Composite）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#11-command" class="md-nav__link">
    <span class="md-ellipsis">
      11. 命令模式（Command）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12-state" class="md-nav__link">
    <span class="md-ellipsis">
      12. 状态模式（State）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#13-memento" class="md-nav__link">
    <span class="md-ellipsis">
      13. 备忘录模式（Memento）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#14-iterator" class="md-nav__link">
    <span class="md-ellipsis">
      14. 迭代器模式（Iterator）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#15-facade" class="md-nav__link">
    <span class="md-ellipsis">
      15. 外观模式（Facade）
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#android-bitmap" class="md-nav__link">
    <span class="md-ellipsis">
      Android bitmap是什么？有什么特点？
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#android_2" class="md-nav__link">
    <span class="md-ellipsis">
      Android如何安全加载大图片？
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Android如何安全加载大图片？">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-bitmapfactoryoptions" class="md-nav__link">
    <span class="md-ellipsis">
      1. 使用 BitmapFactory.Options 进行采样
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-bitmapregiondecoder" class="md-nav__link">
    <span class="md-ellipsis">
      2. 使用 BitmapRegionDecoder 加载部分图像
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3_3" class="md-nav__link">
    <span class="md-ellipsis">
      3. 使用第三方库
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3. 使用第三方库">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#glide" class="md-nav__link">
    <span class="md-ellipsis">
      Glide 示例
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#picasso" class="md-nav__link">
    <span class="md-ellipsis">
      Picasso 示例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-inbitmap" class="md-nav__link">
    <span class="md-ellipsis">
      4. 使用 inBitmap 重用内存
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-bitmapfactoryoptions-inpreferredconfig" class="md-nav__link">
    <span class="md-ellipsis">
      5. 使用 BitmapFactory.Options 的 inPreferredConfig
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6_4" class="md-nav__link">
    <span class="md-ellipsis">
      6. 异步加载
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_18" class="md-nav__link">
    <span class="md-ellipsis">
      总结
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#android_3" class="md-nav__link">
    <span class="md-ellipsis">
      Android中的类加载器
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#andriod" class="md-nav__link">
    <span class="md-ellipsis">
      Andriod 系统启动过程
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#android-surfaceflinger" class="md-nav__link">
    <span class="md-ellipsis">
      Android - SurfaceFlinger 图形系统
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#android-service" class="md-nav__link">
    <span class="md-ellipsis">
      Android - Service 启动过程
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#android-packagemangerservice" class="md-nav__link">
    <span class="md-ellipsis">
      Android - PackageMangerService 分析
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#android-powermanagerservice" class="md-nav__link">
    <span class="md-ellipsis">
      Android - PowerManagerService 启动
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../030ThirdSDKSourceCode/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Android三方源码解析
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Jetpack
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Jetpack
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../040Jetpack/010Basic/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Jetpack
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../040Jetpack/020Compose/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Compose
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    KMP
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            KMP
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../041KMP/010Basic/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Kotlin Multi Platform
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    System Design
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            System Design
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../050SystemDesign/010Basic/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    系统设计
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#android-activity" class="md-nav__link">
    <span class="md-ellipsis">
      Android Activity的启动过程
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Android Activity的启动过程">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1" class="md-nav__link">
    <span class="md-ellipsis">
      1. 启动请求
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-instrumentation" class="md-nav__link">
    <span class="md-ellipsis">
      2. Instrumentation处理
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-activitytaskmanagerservice-atms" class="md-nav__link">
    <span class="md-ellipsis">
      3. ActivityTaskManagerService (ATMS) 处理
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-activityrecord" class="md-nav__link">
    <span class="md-ellipsis">
      4. 创建ActivityRecord
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5" class="md-nav__link">
    <span class="md-ellipsis">
      5. 应用进程交互
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6-applicationthread" class="md-nav__link">
    <span class="md-ellipsis">
      6. ApplicationThread处理
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7-activitythread" class="md-nav__link">
    <span class="md-ellipsis">
      7. ActivityThread处理
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#8-activity" class="md-nav__link">
    <span class="md-ellipsis">
      8. 创建和初始化Activity
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#9-activity" class="md-nav__link">
    <span class="md-ellipsis">
      9. Activity生命周期回调
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#10" class="md-nav__link">
    <span class="md-ellipsis">
      10. 界面显示
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      总结
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#android-recyclerview" class="md-nav__link">
    <span class="md-ellipsis">
      Android RecyclerView源码解析
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#android-recyclerviewlistview" class="md-nav__link">
    <span class="md-ellipsis">
      从源码角度分析Android RecyclerView和ListView的区别，以及有哪些特性
    </span>
  </a>
  
    <nav class="md-nav" aria-label="从源码角度分析Android RecyclerView和ListView的区别，以及有哪些特性">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-viewholder" class="md-nav__link">
    <span class="md-ellipsis">
      1. ViewHolder 模式
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2" class="md-nav__link">
    <span class="md-ellipsis">
      2. 布局管理
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-item" class="md-nav__link">
    <span class="md-ellipsis">
      3. Item 动画
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4" class="md-nav__link">
    <span class="md-ellipsis">
      4. 数据更新
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-item" class="md-nav__link">
    <span class="md-ellipsis">
      5. Item 装饰
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6-item" class="md-nav__link">
    <span class="md-ellipsis">
      6. Item 点击事件
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7" class="md-nav__link">
    <span class="md-ellipsis">
      7. 源码结构
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#8" class="md-nav__link">
    <span class="md-ellipsis">
      8. 性能优化
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#9" class="md-nav__link">
    <span class="md-ellipsis">
      9. 嵌套滚动
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#10_1" class="md-nav__link">
    <span class="md-ellipsis">
      10. 扩展性
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      总结
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#android-recyclerview_1" class="md-nav__link">
    <span class="md-ellipsis">
      Android RecyclerView的缓存机制
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Android RecyclerView的缓存机制">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-viewholder_1" class="md-nav__link">
    <span class="md-ellipsis">
      1. ViewHolder 缓存
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-recycler-pool" class="md-nav__link">
    <span class="md-ellipsis">
      2. Recycler Pool
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-prefetch" class="md-nav__link">
    <span class="md-ellipsis">
      3. Prefetch 机制
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-item-animations" class="md-nav__link">
    <span class="md-ellipsis">
      4. Item Animations 缓存
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-layoutmanager" class="md-nav__link">
    <span class="md-ellipsis">
      5. LayoutManager 缓存
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6" class="md-nav__link">
    <span class="md-ellipsis">
      6. 自定义缓存策略
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      总结
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#1-viewholder_2" class="md-nav__link">
    <span class="md-ellipsis">
      1. ViewHolder 存储的信息
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1. ViewHolder 存储的信息">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_1" class="md-nav__link">
    <span class="md-ellipsis">
      (1) 视图引用
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_1" class="md-nav__link">
    <span class="md-ellipsis">
      (2) 数据绑定状态
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3" class="md-nav__link">
    <span class="md-ellipsis">
      (3) 位置信息
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4_1" class="md-nav__link">
    <span class="md-ellipsis">
      (4) 其他元数据
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-recyclerview-viewholder" class="md-nav__link">
    <span class="md-ellipsis">
      2. 为什么 RecyclerView 使用 ViewHolder 作为缓存介质？
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. 为什么 RecyclerView 使用 ViewHolder 作为缓存介质？">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-findviewbyid" class="md-nav__link">
    <span class="md-ellipsis">
      (1) 减少 findViewById 的开销
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_2" class="md-nav__link">
    <span class="md-ellipsis">
      (2) 视图复用
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3_1" class="md-nav__link">
    <span class="md-ellipsis">
      (3) 分离视图和数据
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4_2" class="md-nav__link">
    <span class="md-ellipsis">
      (4) 支持多种视图类型
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5_1" class="md-nav__link">
    <span class="md-ellipsis">
      (5) 提升滚动性能
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6_1" class="md-nav__link">
    <span class="md-ellipsis">
      (6) 支持动画和状态保存
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-viewholder" class="md-nav__link">
    <span class="md-ellipsis">
      3. ViewHolder 的工作流程
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      总结
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#android-recyclerviewviewviewgrouptextview" class="md-nav__link">
    <span class="md-ellipsis">
      Android RecyclerView如何刷新某一个单独的View，比如一个ViewGroup里面的textView？
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Android RecyclerView如何刷新某一个单独的View，比如一个ViewGroup里面的textView？">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      实现步骤
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      示例代码
    </span>
  </a>
  
    <nav class="md-nav" aria-label="示例代码">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-adapter" class="md-nav__link">
    <span class="md-ellipsis">
      1. Adapter 实现
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_3" class="md-nav__link">
    <span class="md-ellipsis">
      2. 使用示例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      关键点解析
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#payload" class="md-nav__link">
    <span class="md-ellipsis">
      扩展：支持多个 Payload
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    <span class="md-ellipsis">
      总结
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#diffutilsdiffutilsdiffutilspayload" class="md-nav__link">
    <span class="md-ellipsis">
      请问DiffUtils能起到什么作用？为什么要使用DiffUtils？以及DiffUtils能否和Payload机制配合？
    </span>
  </a>
  
    <nav class="md-nav" aria-label="请问DiffUtils能起到什么作用？为什么要使用DiffUtils？以及DiffUtils能否和Payload机制配合？">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#diffutil" class="md-nav__link">
    <span class="md-ellipsis">
      DiffUtil 的作用
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#diffutil_1" class="md-nav__link">
    <span class="md-ellipsis">
      为什么要使用 DiffUtil？
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#diffutil_2" class="md-nav__link">
    <span class="md-ellipsis">
      DiffUtil 的基本用法
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DiffUtil 的基本用法">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-diffutilcallback" class="md-nav__link">
    <span class="md-ellipsis">
      1. 实现 DiffUtil.Callback
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-diffutil" class="md-nav__link">
    <span class="md-ellipsis">
      2. 使用 DiffUtil 计算差异
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    <span class="md-ellipsis">
      示例代码
    </span>
  </a>
  
    <nav class="md-nav" aria-label="示例代码">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_2" class="md-nav__link">
    <span class="md-ellipsis">
      1. 数据模型
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-diffutilcallback" class="md-nav__link">
    <span class="md-ellipsis">
      2. 实现 DiffUtil.Callback
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-adapter" class="md-nav__link">
    <span class="md-ellipsis">
      3. Adapter 实现
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4_3" class="md-nav__link">
    <span class="md-ellipsis">
      4. 使用示例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#diffutil-payload" class="md-nav__link">
    <span class="md-ellipsis">
      DiffUtil 和 Payload 机制的配合
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    <span class="md-ellipsis">
      总结
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#android-surfaceview" class="md-nav__link">
    <span class="md-ellipsis">
      Android SurfaceView原理解析
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Android SurfaceView原理解析">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-surfaceview" class="md-nav__link">
    <span class="md-ellipsis">
      1. SurfaceView 的特点
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-surfaceview" class="md-nav__link">
    <span class="md-ellipsis">
      2. SurfaceView 的基本结构
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. SurfaceView 的基本结构">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    <span class="md-ellipsis">
      关键类和方法：
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-surfaceview" class="md-nav__link">
    <span class="md-ellipsis">
      3. SurfaceView 的使用步骤
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3. SurfaceView 的使用步骤">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-surfaceview_1" class="md-nav__link">
    <span class="md-ellipsis">
      （1）在布局文件中定义 SurfaceView
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-activity-fragment-surfaceview" class="md-nav__link">
    <span class="md-ellipsis">
      （2）在 Activity 或 Fragment 中初始化 SurfaceView
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-surfaceholdercallback" class="md-nav__link">
    <span class="md-ellipsis">
      （3）实现 SurfaceHolder.Callback 接口
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4_4" class="md-nav__link">
    <span class="md-ellipsis">
      （4）在独立线程中绘制内容
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-surfaceview" class="md-nav__link">
    <span class="md-ellipsis">
      4. SurfaceView 的注意事项
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-surfaceview" class="md-nav__link">
    <span class="md-ellipsis">
      5. SurfaceView 的替代方案
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6-surfaceview" class="md-nav__link">
    <span class="md-ellipsis">
      6. 示例：使用 SurfaceView 实现简单动画
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#android-surfaceviewui" class="md-nav__link">
    <span class="md-ellipsis">
      为什么Android SurfaceView可以在子线程刷新UI？
    </span>
  </a>
  
    <nav class="md-nav" aria-label="为什么Android SurfaceView可以在子线程刷新UI？">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-surface" class="md-nav__link">
    <span class="md-ellipsis">
      1. 独立的 Surface
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_4" class="md-nav__link">
    <span class="md-ellipsis">
      2. 双缓冲机制
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-surfaceholder-canvas" class="md-nav__link">
    <span class="md-ellipsis">
      3. SurfaceHolder 和 Canvas 的控制
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4_5" class="md-nav__link">
    <span class="md-ellipsis">
      4. 硬件加速支持
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-view" class="md-nav__link">
    <span class="md-ellipsis">
      5. 与普通 View 的对比
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6-view-ui" class="md-nav__link">
    <span class="md-ellipsis">
      6. 为什么普通 View 不能在子线程刷新 UI？
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7-surfaceview" class="md-nav__link">
    <span class="md-ellipsis">
      7. SurfaceView 的子线程绘制示例
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    <span class="md-ellipsis">
      总结
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#android-surfaceview-view" class="md-nav__link">
    <span class="md-ellipsis">
      Android 和SurfaceView相关的, 哪个View更适合视频播放？更简单易用。
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Android 和SurfaceView相关的, 哪个View更适合视频播放？更简单易用。">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#surfaceview" class="md-nav__link">
    <span class="md-ellipsis">
      SurfaceView
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#textureview" class="md-nav__link">
    <span class="md-ellipsis">
      TextureView
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    <span class="md-ellipsis">
      更简单易用的选择
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_15" class="md-nav__link">
    <span class="md-ellipsis">
      总结
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#android-remoteviews" class="md-nav__link">
    <span class="md-ellipsis">
      Android RemoteViews实现和使用场景
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Android RemoteViews实现和使用场景">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#android-remoteviews_1" class="md-nav__link">
    <span class="md-ellipsis">
      Android RemoteViews 实现和使用场景
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Android RemoteViews 实现和使用场景">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1_3" class="md-nav__link">
    <span class="md-ellipsis">
      1. 概述
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2_5" class="md-nav__link">
    <span class="md-ellipsis">
      2. 实现步骤
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. 实现步骤">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21-remoteviews" class="md-nav__link">
    <span class="md-ellipsis">
      2.1 创建 RemoteViews 对象
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22" class="md-nav__link">
    <span class="md-ellipsis">
      2.2 设置视图内容
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23-app-widget" class="md-nav__link">
    <span class="md-ellipsis">
      2.3 应用到通知或 App Widget
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#24" class="md-nav__link">
    <span class="md-ellipsis">
      2.4 处理点击事件
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3_2" class="md-nav__link">
    <span class="md-ellipsis">
      3. 使用场景
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3. 使用场景">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31" class="md-nav__link">
    <span class="md-ellipsis">
      3.1 通知栏定制
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32-app-widgets" class="md-nav__link">
    <span class="md-ellipsis">
      3.2 App Widgets
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#33-ui" class="md-nav__link">
    <span class="md-ellipsis">
      3.3 系统 UI 定制
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4_6" class="md-nav__link">
    <span class="md-ellipsis">
      4. 注意事项
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5_2" class="md-nav__link">
    <span class="md-ellipsis">
      5. 总结
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#android-activitythread" class="md-nav__link">
    <span class="md-ellipsis">
      Android ActivityThread源码解析
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Android ActivityThread源码解析">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-activitythread" class="md-nav__link">
    <span class="md-ellipsis">
      1. ActivityThread 概述
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-activitythread" class="md-nav__link">
    <span class="md-ellipsis">
      2. ActivityThread 的主要职责
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-activitythread" class="md-nav__link">
    <span class="md-ellipsis">
      3. ActivityThread 的核心方法
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3. ActivityThread 的核心方法">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31-mainstring-args" class="md-nav__link">
    <span class="md-ellipsis">
      3.1 main(String[] args)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32-attachboolean-system" class="md-nav__link">
    <span class="md-ellipsis">
      3.2 attach(boolean system)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#33-handlemessagemessage-msg" class="md-nav__link">
    <span class="md-ellipsis">
      3.3 handleMessage(Message msg)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#34-handlelaunchactivityactivityclientrecord-r" class="md-nav__link">
    <span class="md-ellipsis">
      3.4 handleLaunchActivity(ActivityClientRecord r)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-applicationthread" class="md-nav__link">
    <span class="md-ellipsis">
      4. ApplicationThread
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5_3" class="md-nav__link">
    <span class="md-ellipsis">
      5. 总结
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6_2" class="md-nav__link">
    <span class="md-ellipsis">
      6. 关键点
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#android" class="md-nav__link">
    <span class="md-ellipsis">
      Android进程名称是如何被指定的？
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Android进程名称是如何被指定的？">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-activitythread_1" class="md-nav__link">
    <span class="md-ellipsis">
      1. ActivityThread类
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1. ActivityThread类">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#main" class="md-nav__link">
    <span class="md-ellipsis">
      main方法
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-attach" class="md-nav__link">
    <span class="md-ellipsis">
      2. attach方法
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-process" class="md-nav__link">
    <span class="md-ellipsis">
      3. Process类
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3. Process类">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#setargv0" class="md-nav__link">
    <span class="md-ellipsis">
      setArgV0方法
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-activitymanagerservice" class="md-nav__link">
    <span class="md-ellipsis">
      4. ActivityManagerService
    </span>
  </a>
  
    <nav class="md-nav" aria-label="4. ActivityManagerService">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#startprocesslocked" class="md-nav__link">
    <span class="md-ellipsis">
      startProcessLocked方法
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-processstart" class="md-nav__link">
    <span class="md-ellipsis">
      5. Process.start方法
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_16" class="md-nav__link">
    <span class="md-ellipsis">
      总结
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#android-binder" class="md-nav__link">
    <span class="md-ellipsis">
      Android Binder机制
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Android Binder机制">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-binder" class="md-nav__link">
    <span class="md-ellipsis">
      1. Binder机制概述
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-binder" class="md-nav__link">
    <span class="md-ellipsis">
      2. Binder机制的主要组件
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-binder" class="md-nav__link">
    <span class="md-ellipsis">
      3. Binder机制的工作流程
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-binder" class="md-nav__link">
    <span class="md-ellipsis">
      4. Binder机制的特点
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-binder" class="md-nav__link">
    <span class="md-ellipsis">
      5. Binder机制的应用
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6-binder" class="md-nav__link">
    <span class="md-ellipsis">
      6. Binder机制的实现细节
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7-binder" class="md-nav__link">
    <span class="md-ellipsis">
      7. Binder机制的优缺点
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_17" class="md-nav__link">
    <span class="md-ellipsis">
      总结
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#android-ams" class="md-nav__link">
    <span class="md-ellipsis">
      Android AMS机制
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Android AMS机制">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-ams" class="md-nav__link">
    <span class="md-ellipsis">
      1. AMS的主要功能
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-ams" class="md-nav__link">
    <span class="md-ellipsis">
      2. AMS的工作机制
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. AMS的工作机制">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21-activity" class="md-nav__link">
    <span class="md-ellipsis">
      2.1 Activity的启动流程
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22-service" class="md-nav__link">
    <span class="md-ellipsis">
      2.2 Service的启动流程
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23" class="md-nav__link">
    <span class="md-ellipsis">
      2.3 进程管理
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#24_1" class="md-nav__link">
    <span class="md-ellipsis">
      2.4 任务栈管理
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-ams" class="md-nav__link">
    <span class="md-ellipsis">
      3. AMS的启动模式
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-amsbinder" class="md-nav__link">
    <span class="md-ellipsis">
      4. AMS与Binder机制
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-ams" class="md-nav__link">
    <span class="md-ellipsis">
      5. AMS的优化与限制
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6_3" class="md-nav__link">
    <span class="md-ellipsis">
      6. 总结
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#android_1" class="md-nav__link">
    <span class="md-ellipsis">
      你知道哪些Android系统源码的设计模式？
    </span>
  </a>
  
    <nav class="md-nav" aria-label="你知道哪些Android系统源码的设计模式？">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-singleton" class="md-nav__link">
    <span class="md-ellipsis">
      1. 单例模式（Singleton）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-factory" class="md-nav__link">
    <span class="md-ellipsis">
      2. 工厂模式（Factory）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-observer" class="md-nav__link">
    <span class="md-ellipsis">
      3. 观察者模式（Observer）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-adapter" class="md-nav__link">
    <span class="md-ellipsis">
      4. 适配器模式（Adapter）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-decorator" class="md-nav__link">
    <span class="md-ellipsis">
      5. 装饰者模式（Decorator）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6-strategy" class="md-nav__link">
    <span class="md-ellipsis">
      6. 策略模式（Strategy）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#7-template-method" class="md-nav__link">
    <span class="md-ellipsis">
      7. 模板方法模式（Template Method）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#8-builder" class="md-nav__link">
    <span class="md-ellipsis">
      8. 建造者模式（Builder）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#9-proxy" class="md-nav__link">
    <span class="md-ellipsis">
      9. 代理模式（Proxy）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#10-composite" class="md-nav__link">
    <span class="md-ellipsis">
      10. 组合模式（Composite）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#11-command" class="md-nav__link">
    <span class="md-ellipsis">
      11. 命令模式（Command）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12-state" class="md-nav__link">
    <span class="md-ellipsis">
      12. 状态模式（State）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#13-memento" class="md-nav__link">
    <span class="md-ellipsis">
      13. 备忘录模式（Memento）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#14-iterator" class="md-nav__link">
    <span class="md-ellipsis">
      14. 迭代器模式（Iterator）
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#15-facade" class="md-nav__link">
    <span class="md-ellipsis">
      15. 外观模式（Facade）
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#android-bitmap" class="md-nav__link">
    <span class="md-ellipsis">
      Android bitmap是什么？有什么特点？
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#android_2" class="md-nav__link">
    <span class="md-ellipsis">
      Android如何安全加载大图片？
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Android如何安全加载大图片？">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-bitmapfactoryoptions" class="md-nav__link">
    <span class="md-ellipsis">
      1. 使用 BitmapFactory.Options 进行采样
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-bitmapregiondecoder" class="md-nav__link">
    <span class="md-ellipsis">
      2. 使用 BitmapRegionDecoder 加载部分图像
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3_3" class="md-nav__link">
    <span class="md-ellipsis">
      3. 使用第三方库
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3. 使用第三方库">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#glide" class="md-nav__link">
    <span class="md-ellipsis">
      Glide 示例
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#picasso" class="md-nav__link">
    <span class="md-ellipsis">
      Picasso 示例
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-inbitmap" class="md-nav__link">
    <span class="md-ellipsis">
      4. 使用 inBitmap 重用内存
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#5-bitmapfactoryoptions-inpreferredconfig" class="md-nav__link">
    <span class="md-ellipsis">
      5. 使用 BitmapFactory.Options 的 inPreferredConfig
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#6_4" class="md-nav__link">
    <span class="md-ellipsis">
      6. 异步加载
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_18" class="md-nav__link">
    <span class="md-ellipsis">
      总结
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#android_3" class="md-nav__link">
    <span class="md-ellipsis">
      Android中的类加载器
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#andriod" class="md-nav__link">
    <span class="md-ellipsis">
      Andriod 系统启动过程
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#android-surfaceflinger" class="md-nav__link">
    <span class="md-ellipsis">
      Android - SurfaceFlinger 图形系统
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#android-service" class="md-nav__link">
    <span class="md-ellipsis">
      Android - Service 启动过程
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#android-packagemangerservice" class="md-nav__link">
    <span class="md-ellipsis">
      Android - PackageMangerService 分析
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#android-powermanagerservice" class="md-nav__link">
    <span class="md-ellipsis">
      Android - PowerManagerService 启动
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



  <h1>Android系统源码解析</h1>

<h2 id="_1"><a class="headerlink" href="#_1" title="Permanent link">&para;</a></h2>
<h2 id="android-activity">Android Activity的启动过程<a class="headerlink" href="#android-activity" title="Permanent link">&para;</a></h2>
<details class="answer">
<summary>答案</summary>
<p>一些网络资料
https://github.com/jeanboydev/Android-ReadTheFuckingSourceCode/blob/master/article/android/framework/Android-Activity%E5%90%AF%E5%8A%A8%E8%BF%87%E7%A8%8B.md</p>
<p>这个我强烈建议每个Android开发人员都要清楚的知道，并且跟一下源码，几个核心类的作用。你会对Android有一个更好的认识。</p>
<p>Android Activity的启动过程涉及多个步骤和组件之间的交互，主要包括以下几个阶段：</p>
<h3 id="1">1. <strong>启动请求</strong><a class="headerlink" href="#1" title="Permanent link">&para;</a></h3>
<ul>
<li>通过 <code>startActivity()</code> 或 <code>startActivityForResult()</code> 发起启动请求。</li>
<li>这些方法会调用 <code>Instrumentation</code> 的 <code>execStartActivity()</code>。</li>
</ul>
<h3 id="2-instrumentation">2. <strong>Instrumentation处理</strong><a class="headerlink" href="#2-instrumentation" title="Permanent link">&para;</a></h3>
<ul>
<li><code>Instrumentation</code> 负责监控应用与系统的交互，<code>execStartActivity()</code> 会通过 <code>ActivityTaskManagerService</code> (ATMS) 将请求传递给系统服务。</li>
</ul>
<h3 id="3-activitytaskmanagerservice-atms">3. <strong>ActivityTaskManagerService (ATMS) 处理</strong><a class="headerlink" href="#3-activitytaskmanagerservice-atms" title="Permanent link">&para;</a></h3>
<ul>
<li>ATMS 是系统服务，负责管理 Activity 和任务栈。</li>
<li>ATMS 根据 <code>Intent</code> 和 <code>ActivityInfo</code> 确定目标 Activity，并检查权限和启动模式。</li>
</ul>
<h3 id="4-activityrecord">4. <strong>创建ActivityRecord</strong><a class="headerlink" href="#4-activityrecord" title="Permanent link">&para;</a></h3>
<ul>
<li>ATMS 为即将启动的 Activity 创建 <code>ActivityRecord</code>，记录其状态和信息。</li>
</ul>
<h3 id="5">5. <strong>应用进程交互</strong><a class="headerlink" href="#5" title="Permanent link">&para;</a></h3>
<ul>
<li>如果目标 Activity 所在进程未启动，ATMS 会通过 <code>Zygote</code> 创建新进程。</li>
<li>如果进程已存在，ATMS 直接与 <code>ApplicationThread</code> 通信。</li>
</ul>
<h3 id="6-applicationthread">6. <strong>ApplicationThread处理</strong><a class="headerlink" href="#6-applicationthread" title="Permanent link">&para;</a></h3>
<ul>
<li><code>ApplicationThread</code> 是 <code>ActivityThread</code> 的内部类，负责与 ATMS 通信。</li>
<li>收到启动请求后，<code>ApplicationThread</code> 通过 <code>H</code>（Handler）将消息传递给 <code>ActivityThread</code>。</li>
</ul>
<h3 id="7-activitythread">7. <strong>ActivityThread处理</strong><a class="headerlink" href="#7-activitythread" title="Permanent link">&para;</a></h3>
<ul>
<li><code>ActivityThread</code> 是主线程，负责管理 Activity 生命周期。</li>
<li>调用 <code>handleLaunchActivity()</code>，依次执行 <code>performLaunchActivity()</code> 和 <code>handleResumeActivity()</code>。</li>
</ul>
<h3 id="8-activity">8. <strong>创建和初始化Activity</strong><a class="headerlink" href="#8-activity" title="Permanent link">&para;</a></h3>
<ul>
<li><code>performLaunchActivity()</code> 通过反射创建 Activity 实例，并调用其 <code>attach()</code> 方法绑定上下文。</li>
<li>接着调用 <code>onCreate()</code>，完成布局加载和初始化。</li>
</ul>
<h3 id="9-activity">9. <strong>Activity生命周期回调</strong><a class="headerlink" href="#9-activity" title="Permanent link">&para;</a></h3>
<ul>
<li><code>handleResumeActivity()</code> 调用 <code>onStart()</code> 和 <code>onResume()</code>，使 Activity 进入前台。</li>
</ul>
<h3 id="10">10. <strong>界面显示</strong><a class="headerlink" href="#10" title="Permanent link">&para;</a></h3>
<ul>
<li><code>onResume()</code> 完成后，Activity 的界面显示在屏幕上，用户可与之交互。</li>
</ul>
<h3 id="_2">总结<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h3>
<p>Activity 启动过程涉及多个组件协作，主要包括：
1. <strong>启动请求</strong>：通过 <code>startActivity()</code> 发起。
2. <strong>系统服务处理</strong>：ATMS 管理 Activity 和任务栈。
3. <strong>进程和线程交互</strong>：通过 <code>ApplicationThread</code> 和 <code>ActivityThread</code> 处理。
4. <strong>Activity创建和生命周期</strong>：创建实例并回调生命周期方法。
5. <strong>界面显示</strong>：完成生命周期回调后，界面显示。</p>
<p>整个过程确保了 Activity 的正确启动和显示。</p>
<p>根Activity启动流程整体上学习意义较大，建议从整体流程入手，然后可以对细节推敲，遇到流程不通时也可以debug。 Activity的整体启动流程：</p>
<p>点击图标，Launcher向AMS请求启动该App
AMS反馈收到启动请求,并告知Launcher进入pause状态
Launcher进入Paused状态并告知AMS
AMS检测新的App是否已启动，否则通知Zygote创建新的进程并调用ActivityThread.main方法
应用进程启动ActivityThread
ActivityThread中H类处理需要启动Activity的请求消息</p>
</details>
<h2 id="android-recyclerview">Android RecyclerView源码解析<a class="headerlink" href="#android-recyclerview" title="Permanent link">&para;</a></h2>
<details class="answer">
<summary>答案</summary>
<p>https://www.cnblogs.com/huansky/p/14252980.html 绘制
https://www.cnblogs.com/huansky/p/14288574.html 复用
https://zhuanlan.zhihu.com/p/263841552</p>
</details>
<h2 id="android-recyclerviewlistview">从源码角度分析Android RecyclerView和ListView的区别，以及有哪些特性<a class="headerlink" href="#android-recyclerviewlistview" title="Permanent link">&para;</a></h2>
<details class="answer">
<summary>答案</summary>
<p>从源码角度分析，<code>RecyclerView</code> 和 <code>ListView</code> 在实现机制、扩展性和性能优化等方面有显著差异。以下是它们的核心区别和特性：</p>
<h3 id="1-viewholder">1. <strong>ViewHolder 模式</strong><a class="headerlink" href="#1-viewholder" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>ListView</strong>: <code>ViewHolder</code> 模式并非强制使用，开发者需手动实现以减少 <code>findViewById</code> 的调用。若未正确使用，可能导致性能问题。</li>
<li><strong>RecyclerView</strong>: 强制使用 <code>ViewHolder</code> 模式，通过 <code>RecyclerView.ViewHolder</code> 类管理视图，确保高效复用，减少不必要的视图查找。</li>
</ul>
<h3 id="2">2. <strong>布局管理</strong><a class="headerlink" href="#2" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>ListView</strong>: 布局管理固定为垂直列表，不支持其他布局方式。</li>
<li><strong>RecyclerView</strong>: 通过 <code>RecyclerView.LayoutManager</code> 实现灵活的布局管理，支持线性、网格、瀑布流等多种布局，扩展性强。</li>
</ul>
<h3 id="3-item">3. <strong>Item 动画</strong><a class="headerlink" href="#3-item" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>ListView</strong>: 默认不支持 Item 动画，需手动实现。</li>
<li><strong>RecyclerView</strong>: 内置 <code>RecyclerView.ItemAnimator</code>，支持添加、删除、移动等动画效果，且可自定义动画。</li>
</ul>
<h3 id="4">4. <strong>数据更新</strong><a class="headerlink" href="#4" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>ListView</strong>: 使用 <code>Adapter</code> 的 <code>notifyDataSetChanged()</code> 刷新整个列表，效率较低。</li>
<li><strong>RecyclerView</strong>: 提供 <code>Adapter</code> 的 <code>notifyItemInserted()</code>、<code>notifyItemRemoved()</code> 等方法，支持局部刷新，提升性能。</li>
</ul>
<h3 id="5-item">5. <strong>Item 装饰</strong><a class="headerlink" href="#5-item" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>ListView</strong>: 不支持 Item 装饰。</li>
<li><strong>RecyclerView</strong>: 通过 <code>RecyclerView.ItemDecoration</code> 支持添加分割线、间距等装饰效果，且可自定义。</li>
</ul>
<h3 id="6-item">6. <strong>Item 点击事件</strong><a class="headerlink" href="#6-item" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>ListView</strong>: 内置 <code>OnItemClickListener</code> 和 <code>OnItemLongClickListener</code>，使用方便。</li>
<li><strong>RecyclerView</strong>: 不内置点击事件，需开发者通过 <code>ViewHolder</code> 或 <code>RecyclerView.addOnItemTouchListener()</code> 实现，灵活性更高。</li>
</ul>
<h3 id="7">7. <strong>源码结构</strong><a class="headerlink" href="#7" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>ListView</strong>: 直接继承 <code>AbsListView</code>，布局和逻辑耦合度高，扩展性较差。</li>
<li><strong>RecyclerView</strong>: 继承 <code>ViewGroup</code>，通过 <code>LayoutManager</code>、<code>Adapter</code>、<code>ItemAnimator</code> 等组件解耦，扩展性更强。</li>
</ul>
<h3 id="8">8. <strong>性能优化</strong><a class="headerlink" href="#8" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>ListView</strong>: 复用机制简单，性能优化有限。</li>
<li><strong>RecyclerView</strong>: 通过 <code>Recycler</code> 类实现复杂复用机制，支持多级缓存，性能更优。</li>
</ul>
<h3 id="9">9. <strong>嵌套滚动</strong><a class="headerlink" href="#9" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>ListView</strong>: 不支持嵌套滚动。</li>
<li><strong>RecyclerView</strong>: 支持嵌套滚动，与 <code>NestedScrollingParent</code> 和 <code>NestedScrollingChild</code> 接口兼容，适用于复杂滚动场景。</li>
</ul>
<h3 id="10_1">10. <strong>扩展性</strong><a class="headerlink" href="#10_1" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>ListView</strong>: 扩展性有限，定制复杂布局或行为较困难。</li>
<li><strong>RecyclerView</strong>: 高度模块化，易于扩展和定制，适合复杂需求。</li>
</ul>
<h3 id="_3">总结<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>ListView</strong>: 简单易用，适合基础列表需求，但扩展性和性能优化有限。</li>
<li><strong>RecyclerView</strong>: 功能强大，扩展性高，支持复杂布局和动画，性能更优，适合现代应用开发。</li>
</ul>
<p>在开发中，优先选择 <code>RecyclerView</code>，除非有特殊需求或兼容性考虑。</p>
</details>
<h2 id="android-recyclerview_1">Android RecyclerView的缓存机制<a class="headerlink" href="#android-recyclerview_1" title="Permanent link">&para;</a></h2>
<details class="answer">
<summary>答案</summary>
<p>从缓存的角度分析，Android 的 <code>RecyclerView</code> 通过高效的缓存机制来提升滚动性能和减少资源消耗。以下是 <code>RecyclerView</code> 缓存机制的关键点：</p>
<h3 id="1-viewholder_1">1. <strong>ViewHolder 缓存</strong><a class="headerlink" href="#1-viewholder_1" title="Permanent link">&para;</a></h3>
<p><code>RecyclerView</code> 使用 <code>ViewHolder</code> 模式来缓存视图，避免频繁创建和销毁 <code>View</code> 对象。<code>ViewHolder</code> 缓存分为以下几层：</p>
<ul>
<li><strong>Attached Scrap</strong>: 缓存当前可见的 <code>ViewHolder</code>，用于快速重新绑定数据。</li>
<li><strong>Cached Views</strong>: 缓存刚刚滑出屏幕的 <code>ViewHolder</code>，数量由 <code>RecyclerView</code> 的 <code>mViewCacheMax</code> 决定。</li>
<li><strong>Recycled Pool</strong>: 缓存完全不可见的 <code>ViewHolder</code>，供后续复用。</li>
</ul>
<h3 id="2-recycler-pool">2. <strong>Recycler Pool</strong><a class="headerlink" href="#2-recycler-pool" title="Permanent link">&para;</a></h3>
<p><code>Recycled Pool</code> 是一个全局缓存，存储不同 <code>ViewHolder</code> 类型，供多个 <code>RecyclerView</code> 实例共享，适合多列表场景。</p>
<h3 id="3-prefetch">3. <strong>Prefetch 机制</strong><a class="headerlink" href="#3-prefetch" title="Permanent link">&para;</a></h3>
<p><code>RecyclerView</code> 在 Android 5.0 后引入了预取机制，利用 UI 线程空闲时间提前加载即将显示的 <code>ViewHolder</code>，减少卡顿。</p>
<h3 id="4-item-animations">4. <strong>Item Animations 缓存</strong><a class="headerlink" href="#4-item-animations" title="Permanent link">&para;</a></h3>
<p><code>RecyclerView</code> 缓存动画状态，确保动画平滑执行，避免因频繁创建和销毁动画对象导致的性能问题。</p>
<h3 id="5-layoutmanager">5. <strong>LayoutManager 缓存</strong><a class="headerlink" href="#5-layoutmanager" title="Permanent link">&para;</a></h3>
<p><code>LayoutManager</code> 负责布局管理，通过缓存布局信息减少计算量，提升布局效率。</p>
<h3 id="6">6. <strong>自定义缓存策略</strong><a class="headerlink" href="#6" title="Permanent link">&para;</a></h3>
<p>开发者可以通过 <code>setItemViewCacheSize()</code> 调整缓存大小，或通过 <code>RecyclerView.RecycledViewPool</code> 自定义缓存池，优化性能。</p>
<h3 id="_4">总结<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h3>
<p><code>RecyclerView</code> 通过多层缓存机制（<code>ViewHolder</code> 缓存、<code>Recycler Pool</code>、预取机制等）显著提升了滚动性能，减少了资源消耗。开发者可以根据需求进一步优化缓存策略，提升应用性能。</p>
<p><code>ViewHolder</code> 是 <code>RecyclerView</code> 中用于缓存和管理列表项视图的核心组件。它存储了与列表项视图相关的信息，并通过复用机制提升性能。以下是 <code>ViewHolder</code> 存储的具体信息及其作为缓存介质的原因：</p>
<hr />
<h3 id="1-viewholder_2"><strong>1. ViewHolder 存储的信息</strong><a class="headerlink" href="#1-viewholder_2" title="Permanent link">&para;</a></h3>
<p><code>ViewHolder</code> 主要存储以下信息：</p>
<h4 id="1_1"><strong>(1) 视图引用</strong><a class="headerlink" href="#1_1" title="Permanent link">&para;</a></h4>
<ul>
<li><code>ViewHolder</code> 持有列表项视图（<code>View</code>）的引用，避免每次绑定数据时都调用 <code>findViewById</code>，从而减少性能开销。</li>
<li>例如：
<div class="highlight"><pre><span></span><code><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">MyViewHolder</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">RecyclerView</span><span class="p">.</span><span class="na">ViewHolder</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">TextView</span><span class="w"> </span><span class="n">title</span><span class="p">;</span>
<span class="w">    </span><span class="n">ImageView</span><span class="w"> </span><span class="n">icon</span><span class="p">;</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">MyViewHolder</span><span class="p">(</span><span class="n">View</span><span class="w"> </span><span class="n">itemView</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">super</span><span class="p">(</span><span class="n">itemView</span><span class="p">);</span>
<span class="w">        </span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">itemView</span><span class="p">.</span><span class="na">findViewById</span><span class="p">(</span><span class="n">R</span><span class="p">.</span><span class="na">id</span><span class="p">.</span><span class="na">title</span><span class="p">);</span>
<span class="w">        </span><span class="n">icon</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">itemView</span><span class="p">.</span><span class="na">findViewById</span><span class="p">(</span><span class="n">R</span><span class="p">.</span><span class="na">id</span><span class="p">.</span><span class="na">icon</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></li>
</ul>
<h4 id="2_1"><strong>(2) 数据绑定状态</strong><a class="headerlink" href="#2_1" title="Permanent link">&para;</a></h4>
<ul>
<li><code>ViewHolder</code> 可以存储与当前视图相关的临时状态，例如选中状态、动画状态等。</li>
<li>这些状态在视图复用时可以快速恢复，避免重新计算。</li>
</ul>
<h4 id="3"><strong>(3) 位置信息</strong><a class="headerlink" href="#3" title="Permanent link">&para;</a></h4>
<ul>
<li><code>ViewHolder</code> 会记录当前列表项的位置（<code>position</code>），用于在滚动时快速定位和绑定数据。</li>
</ul>
<h4 id="4_1"><strong>(4) 其他元数据</strong><a class="headerlink" href="#4_1" title="Permanent link">&para;</a></h4>
<ul>
<li><code>ViewHolder</code> 可以存储与列表项相关的其他元数据，例如视图类型（<code>itemType</code>）、绑定时间戳等。</li>
</ul>
<hr />
<h3 id="2-recyclerview-viewholder"><strong>2. 为什么 RecyclerView 使用 ViewHolder 作为缓存介质？</strong><a class="headerlink" href="#2-recyclerview-viewholder" title="Permanent link">&para;</a></h3>
<p><code>RecyclerView</code> 使用 <code>ViewHolder</code> 作为缓存介质的主要原因如下：</p>
<h4 id="1-findviewbyid"><strong>(1) 减少 findViewById 的开销</strong><a class="headerlink" href="#1-findviewbyid" title="Permanent link">&para;</a></h4>
<ul>
<li>在传统的 <code>ListView</code> 或 <code>GridView</code> 中，每次绑定数据时都需要调用 <code>findViewById</code> 来获取子视图的引用，这是一个耗时的操作。</li>
<li><code>ViewHolder</code> 通过缓存视图引用，避免了重复调用 <code>findViewById</code>，从而提升了性能。</li>
</ul>
<h4 id="2_2"><strong>(2) 视图复用</strong><a class="headerlink" href="#2_2" title="Permanent link">&para;</a></h4>
<ul>
<li><code>ViewHolder</code> 是 <code>RecyclerView</code> 视图复用的基本单位。当列表项滑出屏幕时，<code>ViewHolder</code> 会被放入缓存池中，供后续复用。</li>
<li>复用 <code>ViewHolder</code> 可以减少频繁创建和销毁视图的开销，降低内存占用和 GC 压力。</li>
</ul>
<h4 id="3_1"><strong>(3) 分离视图和数据</strong><a class="headerlink" href="#3_1" title="Permanent link">&para;</a></h4>
<ul>
<li><code>ViewHolder</code> 将视图的引用和数据的绑定逻辑分离，使得代码更清晰、更易于维护。</li>
<li>数据绑定通过 <code>onBindViewHolder</code> 方法实现，而视图的初始化和管理则由 <code>ViewHolder</code> 负责。</li>
</ul>
<h4 id="4_2"><strong>(4) 支持多种视图类型</strong><a class="headerlink" href="#4_2" title="Permanent link">&para;</a></h4>
<ul>
<li><code>RecyclerView</code> 支持多种视图类型（例如头部、尾部、普通项等），<code>ViewHolder</code> 可以根据视图类型（<code>itemType</code>）进行分类缓存。</li>
<li>不同类型的 <code>ViewHolder</code> 会被存储在不同的缓存池中，确保复用时类型匹配。</li>
</ul>
<h4 id="5_1"><strong>(5) 提升滚动性能</strong><a class="headerlink" href="#5_1" title="Permanent link">&para;</a></h4>
<ul>
<li>通过 <code>ViewHolder</code> 的缓存机制，<code>RecyclerView</code> 可以在滚动时快速复用视图，减少布局计算和视图创建的时间，从而提升滚动的流畅性。</li>
</ul>
<h4 id="6_1"><strong>(6) 支持动画和状态保存</strong><a class="headerlink" href="#6_1" title="Permanent link">&para;</a></h4>
<ul>
<li><code>ViewHolder</code> 可以保存视图的动画状态和临时状态（例如选中状态、展开状态等），在复用时能够快速恢复这些状态，确保动画和交互的连续性。</li>
</ul>
<hr />
<h3 id="3-viewholder"><strong>3. ViewHolder 的工作流程</strong><a class="headerlink" href="#3-viewholder" title="Permanent link">&para;</a></h3>
<p>以下是 <code>ViewHolder</code> 在 <code>RecyclerView</code> 中的典型工作流程：</p>
<ol>
<li><strong>创建阶段</strong>：</li>
<li>当 <code>RecyclerView</code> 需要显示新的列表项时，会调用 <code>onCreateViewHolder</code> 创建一个新的 <code>ViewHolder</code>。</li>
<li>
<p><code>ViewHolder</code> 会初始化视图并缓存视图引用。</p>
</li>
<li>
<p><strong>绑定阶段</strong>：</p>
</li>
<li>
<p>当 <code>RecyclerView</code> 需要显示数据时，会调用 <code>onBindViewHolder</code>，将数据绑定到 <code>ViewHolder</code> 中的视图上。</p>
</li>
<li>
<p><strong>复用阶段</strong>：</p>
</li>
<li>当列表项滑出屏幕时，<code>ViewHolder</code> 会被放入缓存池中。</li>
<li>
<p>当新的列表项需要显示时，<code>RecyclerView</code> 会从缓存池中获取 <code>ViewHolder</code> 并复用。</p>
</li>
<li>
<p><strong>回收阶段</strong>：</p>
</li>
<li>如果 <code>ViewHolder</code> 长时间未被复用，可能会被回收以释放内存。</li>
</ol>
<hr />
<h3 id="_5"><strong>总结</strong><a class="headerlink" href="#_5" title="Permanent link">&para;</a></h3>
<p><code>ViewHolder</code> 是 <code>RecyclerView</code> 性能优化的核心设计，它通过缓存视图引用、支持视图复用、分离视图和数据逻辑等方式，显著提升了列表的性能和流畅性。使用 <code>ViewHolder</code> 作为缓存介质，不仅减少了资源开销，还使得代码结构更清晰、更易于维护。</p>
<p>https://juejin.cn/post/6844904104637022221
https://www.cnblogs.com/huansky/p/14252980.html 绘制流程
https://www.cnblogs.com/huansky/p/14288574.html 缓存流程</p>
<p>总结一下上述流程：通过 mAttachedScrap、mCachedViews 及 mViewCacheExtension 获取的 ViewHolder 不需要重新创建布局及绑定数据；通过缓存池 mRecyclerPool 获取的 ViewHolder不需要重新创建布局，但是需要重新绑定数据；如果上述缓存中都没有获取到目标 ViewHolder，那么就会回调 Adapter#onCreateViewHolder 创建布局，以及回调 Adapter#onBindViewHolder来绑定数据。</p>
<p>ViewCacheExtension
我们已经知道 ViewCacheExtension 属于第三级缓存，需要开发者自行实现，那么 ViewCacheExtension 在什么场景下使用？又是如何实现的呢？</p>
<p>首先我们要明确一点，那就是 Recycler 本身已经设置了好几级缓存了，为什么还要留个接口让开发者去自行实现缓存呢？</p>
<p>关于这一点，来看看 Recycler 中的其他缓存：</p>
<p>mAttachedScrap 用来处理可见屏幕的缓存；</p>
<p>mCachedViews 里存储的数据虽然是根据 position 来缓存，但是里面的数据随时可能会被替换的；</p>
<p>mRecyclerPool 里按 viewType 去存储 ArrayList&lt; ViewHolder&gt;，所以 mRecyclerPool 并不能按 position 去存储 ViewHolder，而且从 mRecyclerPool 取出的 View 每次都要去走 Adapter#onBindViewHolder 去重新绑定数据。</p>
<p>假如我现在需要在一个特定的位置(比如 position=0 位置)一直展示某个 View，且里面的内容是不变的，那么最好的情况就是在特定位置时，既不需要每次重新创建 View，也不需要每次都去重新绑定数据，上面的几种缓存显然都是不适用的，这种情况该怎么办呢？可以通过自定义缓存 ViewCacheExtension 实现上述需求。 </p>
</details>
<h2 id="android-recyclerviewviewviewgrouptextview">Android RecyclerView如何刷新某一个单独的View，比如一个ViewGroup里面的textView？<a class="headerlink" href="#android-recyclerviewviewviewgrouptextview" title="Permanent link">&para;</a></h2>
<details class="answer">
<summary>答案</summary>
<p>是的，<code>RecyclerView</code> 的 <strong>Payload 机制</strong> 是一种高效的局部刷新方式。它允许你在调用 <code>notifyItemChanged(int position, Object payload)</code> 时传递一个自定义的 <code>payload</code> 对象，然后在 <code>onBindViewHolder</code> 中根据 <code>payload</code> 来更新特定的视图，而不需要重新绑定整个 <code>Item</code>。</p>
<p>这种方式非常适合局部刷新，比如只更新 <code>TextView</code> 的文本或 <code>ImageView</code> 的图片，而不影响其他视图。</p>
<hr />
<h3 id="_6">实现步骤<a class="headerlink" href="#_6" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p><strong>调用 <code>notifyItemChanged</code> 并传递 Payload</strong>：
在需要刷新某个 <code>Item</code> 时，调用 <code>notifyItemChanged(int position, Object payload)</code>，并传递一个自定义的 <code>payload</code> 对象（可以是 <code>String</code>、<code>Bundle</code> 或自定义对象）。</p>
</li>
<li>
<p><strong>在 <code>onBindViewHolder</code> 中处理 Payload</strong>：
重写 <code>onBindViewHolder</code> 方法，检查 <code>payload</code> 参数，根据 <code>payload</code> 的内容更新特定的视图。</p>
</li>
</ol>
<hr />
<h3 id="_7">示例代码<a class="headerlink" href="#_7" title="Permanent link">&para;</a></h3>
<p>以下是一个完整的示例，展示如何使用 Payload 机制实现局部刷新。</p>
<h4 id="1-adapter">1. Adapter 实现<a class="headerlink" href="#1-adapter" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">MyAdapter</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">RecyclerView</span><span class="p">.</span><span class="na">Adapter</span><span class="o">&lt;</span><span class="n">MyAdapter</span><span class="p">.</span><span class="na">MyViewHolder</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">mData</span><span class="p">;</span>

<span class="w">    </span><span class="c1">// 定义 Payload 常量</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">PAYLOAD_UPDATE_TEXT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;update_text&quot;</span><span class="p">;</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">class</span> <span class="nc">MyViewHolder</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">RecyclerView</span><span class="p">.</span><span class="na">ViewHolder</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">public</span><span class="w"> </span><span class="n">TextView</span><span class="w"> </span><span class="n">mTextView</span><span class="p">;</span>
<span class="w">        </span><span class="kd">public</span><span class="w"> </span><span class="n">ImageView</span><span class="w"> </span><span class="n">mImageView</span><span class="p">;</span>

<span class="w">        </span><span class="kd">public</span><span class="w"> </span><span class="nf">MyViewHolder</span><span class="p">(</span><span class="n">View</span><span class="w"> </span><span class="n">itemView</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">super</span><span class="p">(</span><span class="n">itemView</span><span class="p">);</span>
<span class="w">            </span><span class="n">mTextView</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">itemView</span><span class="p">.</span><span class="na">findViewById</span><span class="p">(</span><span class="n">R</span><span class="p">.</span><span class="na">id</span><span class="p">.</span><span class="na">textView</span><span class="p">);</span>
<span class="w">            </span><span class="n">mImageView</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">itemView</span><span class="p">.</span><span class="na">findViewById</span><span class="p">(</span><span class="n">R</span><span class="p">.</span><span class="na">id</span><span class="p">.</span><span class="na">imageView</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">MyAdapter</span><span class="p">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="w"> </span><span class="n">data</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">mData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">MyViewHolder</span><span class="w"> </span><span class="nf">onCreateViewHolder</span><span class="p">(</span><span class="n">ViewGroup</span><span class="w"> </span><span class="n">parent</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">viewType</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">View</span><span class="w"> </span><span class="n">view</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LayoutInflater</span><span class="p">.</span><span class="na">from</span><span class="p">(</span><span class="n">parent</span><span class="p">.</span><span class="na">getContext</span><span class="p">())</span>
<span class="w">                </span><span class="p">.</span><span class="na">inflate</span><span class="p">(</span><span class="n">R</span><span class="p">.</span><span class="na">layout</span><span class="p">.</span><span class="na">item_layout</span><span class="p">,</span><span class="w"> </span><span class="n">parent</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">MyViewHolder</span><span class="p">(</span><span class="n">view</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">onBindViewHolder</span><span class="p">(</span><span class="n">MyViewHolder</span><span class="w"> </span><span class="n">holder</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">position</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// 绑定数据</span>
<span class="w">        </span><span class="n">holder</span><span class="p">.</span><span class="na">mTextView</span><span class="p">.</span><span class="na">setText</span><span class="p">(</span><span class="n">mData</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">position</span><span class="p">));</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// 重写 onBindViewHolder 以支持 Payload</span>
<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">onBindViewHolder</span><span class="p">(</span><span class="n">MyViewHolder</span><span class="w"> </span><span class="n">holder</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">position</span><span class="p">,</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="n">payloads</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">payloads</span><span class="p">.</span><span class="na">isEmpty</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// 如果没有 Payload，调用默认的 onBindViewHolder</span>
<span class="w">            </span><span class="kd">super</span><span class="p">.</span><span class="na">onBindViewHolder</span><span class="p">(</span><span class="n">holder</span><span class="p">,</span><span class="w"> </span><span class="n">position</span><span class="p">,</span><span class="w"> </span><span class="n">payloads</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// 处理 Payload</span>
<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">Object</span><span class="w"> </span><span class="n">payload</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">payloads</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">payload</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="n">PAYLOAD_UPDATE_TEXT</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="c1">// 更新 TextView</span>
<span class="w">                    </span><span class="n">holder</span><span class="p">.</span><span class="na">mTextView</span><span class="p">.</span><span class="na">setText</span><span class="p">(</span><span class="n">mData</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">position</span><span class="p">));</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">getItemCount</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">mData</span><span class="p">.</span><span class="na">size</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// 更新特定位置的 TextView</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">updateTextView</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">position</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">newText</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">mData</span><span class="p">.</span><span class="na">set</span><span class="p">(</span><span class="n">position</span><span class="p">,</span><span class="w"> </span><span class="n">newText</span><span class="p">);</span>
<span class="w">        </span><span class="c1">// 使用 Payload 通知 Adapter</span>
<span class="w">        </span><span class="n">notifyItemChanged</span><span class="p">(</span><span class="n">position</span><span class="p">,</span><span class="w"> </span><span class="n">PAYLOAD_UPDATE_TEXT</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="2_3">2. 使用示例<a class="headerlink" href="#2_3" title="Permanent link">&para;</a></h4>
<p>在 <code>Activity</code> 或 <code>Fragment</code> 中，你可以这样更新某个位置的 <code>TextView</code>：</p>
<div class="highlight"><pre><span></span><code><span class="n">MyAdapter</span><span class="w"> </span><span class="n">adapter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">MyAdapter</span><span class="p">(</span><span class="n">data</span><span class="p">);</span>
<span class="n">recyclerView</span><span class="p">.</span><span class="na">setAdapter</span><span class="p">(</span><span class="n">adapter</span><span class="p">);</span>

<span class="c1">// 更新第 2 个位置的 TextView</span>
<span class="n">adapter</span><span class="p">.</span><span class="na">updateTextView</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;New Text&quot;</span><span class="p">);</span>
</code></pre></div>
<hr />
<h3 id="_8">关键点解析<a class="headerlink" href="#_8" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>Payload 的作用</strong>：</li>
<li><code>Payload</code> 是一个自定义对象，用于传递需要更新的信息。</li>
<li>
<p>在 <code>onBindViewHolder</code> 中，通过检查 <code>payloads</code> 参数，可以决定如何更新视图。</p>
</li>
<li>
<p><strong><code>onBindViewHolder</code> 的重载</strong>：</p>
</li>
<li><code>onBindViewHolder(MyViewHolder holder, int position, List&lt;Object&gt; payloads)</code> 是支持 Payload 的关键方法。</li>
<li>如果 <code>payloads</code> 为空，调用默认的 <code>onBindViewHolder</code>。</li>
<li>
<p>如果 <code>payloads</code> 不为空，根据 <code>payload</code> 的内容更新特定的视图。</p>
</li>
<li>
<p><strong>局部刷新的优势</strong>：</p>
</li>
<li>只更新需要变化的视图，不会触发整个 <code>Item</code> 的重新绑定。</li>
<li>性能更高，尤其是在复杂的 <code>Item</code> 布局中。</li>
</ol>
<hr />
<h3 id="payload">扩展：支持多个 Payload<a class="headerlink" href="#payload" title="Permanent link">&para;</a></h3>
<p>如果你需要支持多种局部刷新（比如更新 <code>TextView</code> 和 <code>ImageView</code>），可以定义多个 <code>Payload</code> 常量，并在 <code>onBindViewHolder</code> 中分别处理。</p>
<div class="highlight"><pre><span></span><code><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">PAYLOAD_UPDATE_TEXT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;update_text&quot;</span><span class="p">;</span>
<span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">PAYLOAD_UPDATE_IMAGE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;update_image&quot;</span><span class="p">;</span>

<span class="nd">@Override</span>
<span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">onBindViewHolder</span><span class="p">(</span><span class="n">MyViewHolder</span><span class="w"> </span><span class="n">holder</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">position</span><span class="p">,</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="n">payloads</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">payloads</span><span class="p">.</span><span class="na">isEmpty</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">super</span><span class="p">.</span><span class="na">onBindViewHolder</span><span class="p">(</span><span class="n">holder</span><span class="p">,</span><span class="w"> </span><span class="n">position</span><span class="p">,</span><span class="w"> </span><span class="n">payloads</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">Object</span><span class="w"> </span><span class="n">payload</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">payloads</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">payload</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="n">PAYLOAD_UPDATE_TEXT</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">holder</span><span class="p">.</span><span class="na">mTextView</span><span class="p">.</span><span class="na">setText</span><span class="p">(</span><span class="n">mData</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">position</span><span class="p">));</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">payload</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="n">PAYLOAD_UPDATE_IMAGE</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">holder</span><span class="p">.</span><span class="na">mImageView</span><span class="p">.</span><span class="na">setImageResource</span><span class="p">(</span><span class="n">R</span><span class="p">.</span><span class="na">drawable</span><span class="p">.</span><span class="na">new_image</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<hr />
<h3 id="_9">总结<a class="headerlink" href="#_9" title="Permanent link">&para;</a></h3>
<p>通过 <code>RecyclerView</code> 的 Payload 机制，你可以实现高效的局部刷新，避免不必要的视图更新。这种方式非常适合需要频繁更新部分视图的场景，比如聊天应用中的消息状态更新、列表中的点赞数更新等。</p>
<p>https://juejin.cn/post/7024414595678912520</p>
</details>
<h2 id="diffutilsdiffutilsdiffutilspayload">请问DiffUtils能起到什么作用？为什么要使用DiffUtils？以及DiffUtils能否和Payload机制配合？<a class="headerlink" href="#diffutilsdiffutilsdiffutilspayload" title="Permanent link">&para;</a></h2>
<details class="answer">
<summary>答案</summary>
<p><code>DiffUtil</code> 是 Android 提供的一个用于计算两个数据集差异的工具类，专门为 <code>RecyclerView</code> 设计。它的主要作用是高效地计算新旧数据集的差异，并生成更新操作（如添加、删除、移动、更新），从而优化 <code>RecyclerView</code> 的刷新性能。</p>
<hr />
<h3 id="diffutil"><strong>DiffUtil 的作用</strong><a class="headerlink" href="#diffutil" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>计算数据集差异</strong>：</li>
<li><code>DiffUtil</code> 可以比较两个数据集（通常是 <code>List</code>），并计算出它们之间的差异。</li>
<li>
<p>它会返回一个 <code>DiffUtil.DiffResult</code> 对象，包含添加、删除、移动和更新的操作。</p>
</li>
<li>
<p><strong>优化 RecyclerView 刷新</strong>：</p>
</li>
<li>通过 <code>DiffUtil</code>，<code>RecyclerView</code> 可以只更新发生变化的部分，而不是刷新整个列表。</li>
<li>
<p>这减少了不必要的 <code>onBindViewHolder</code> 调用，提升了性能。</p>
</li>
<li>
<p><strong>支持动画</strong>：</p>
</li>
<li><code>DiffUtil</code> 可以生成移动、添加和删除的操作，这些操作可以触发 <code>RecyclerView</code> 的默认动画效果。</li>
</ol>
<hr />
<h3 id="diffutil_1"><strong>为什么要使用 DiffUtil？</strong><a class="headerlink" href="#diffutil_1" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>性能优势</strong>：</li>
<li>如果直接调用 <code>notifyDataSetChanged()</code>，<code>RecyclerView</code> 会重新绑定所有可见的 <code>ViewHolder</code>，即使数据没有变化。</li>
<li>
<p>使用 <code>DiffUtil</code> 可以避免不必要的刷新，只更新实际发生变化的部分。</p>
</li>
<li>
<p><strong>更好的用户体验</strong>：</p>
</li>
<li>
<p><code>DiffUtil</code> 支持动画效果（如添加、删除、移动），使列表更新更加平滑和自然。</p>
</li>
<li>
<p><strong>简化数据更新逻辑</strong>：</p>
</li>
<li>手动管理数据集的添加、删除和移动操作可能非常复杂，而 <code>DiffUtil</code> 可以自动完成这些操作。</li>
</ol>
<hr />
<h3 id="diffutil_2"><strong>DiffUtil 的基本用法</strong><a class="headerlink" href="#diffutil_2" title="Permanent link">&para;</a></h3>
<h4 id="1-diffutilcallback">1. 实现 <code>DiffUtil.Callback</code><a class="headerlink" href="#1-diffutilcallback" title="Permanent link">&para;</a></h4>
<p><code>DiffUtil.Callback</code> 是一个抽象类，需要实现以下方法：</p>
<ul>
<li><code>getOldListSize()</code>：返回旧数据集的长度。</li>
<li><code>getNewListSize()</code>：返回新数据集的长度。</li>
<li><code>areItemsTheSame(int oldItemPosition, int newItemPosition)</code>：判断两个位置的项是否是同一个对象（通常通过唯一标识符比较）。</li>
<li><code>areContentsTheSame(int oldItemPosition, int newItemPosition)</code>：判断两个位置的项内容是否相同。</li>
<li><code>getChangePayload(int oldItemPosition, int newItemPosition)</code>（可选）：返回一个 <code>Object</code>，用于局部刷新（与 Payload 机制配合）。</li>
</ul>
<h4 id="2-diffutil">2. 使用 <code>DiffUtil</code> 计算差异<a class="headerlink" href="#2-diffutil" title="Permanent link">&para;</a></h4>
<p>调用 <code>DiffUtil.calculateDiff()</code> 方法计算差异，并通过 <code>DiffUtil.DiffResult</code> 更新 <code>RecyclerView</code>。</p>
<hr />
<h3 id="_10"><strong>示例代码</strong><a class="headerlink" href="#_10" title="Permanent link">&para;</a></h3>
<p>以下是一个完整的示例，展示如何使用 <code>DiffUtil</code> 和 Payload 机制。</p>
<h4 id="1_2">1. 数据模型<a class="headerlink" href="#1_2" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Item</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">id</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">text</span><span class="p">;</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">Item</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">text</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">id</span><span class="p">;</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">text</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">getId</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">id</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="nf">getText</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">text</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setText</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">text</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">text</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="2-diffutilcallback">2. 实现 <code>DiffUtil.Callback</code><a class="headerlink" href="#2-diffutilcallback" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">ItemDiffCallback</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">DiffUtil</span><span class="p">.</span><span class="na">Callback</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Item</span><span class="o">&gt;</span><span class="w"> </span><span class="n">oldList</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Item</span><span class="o">&gt;</span><span class="w"> </span><span class="n">newList</span><span class="p">;</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">ItemDiffCallback</span><span class="p">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Item</span><span class="o">&gt;</span><span class="w"> </span><span class="n">oldList</span><span class="p">,</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Item</span><span class="o">&gt;</span><span class="w"> </span><span class="n">newList</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">oldList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">oldList</span><span class="p">;</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">newList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">newList</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">getOldListSize</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">oldList</span><span class="p">.</span><span class="na">size</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">getNewListSize</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">newList</span><span class="p">.</span><span class="na">size</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">areItemsTheSame</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">oldItemPosition</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">newItemPosition</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// 通过唯一标识符（id）判断是否是同一个项</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">oldList</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">oldItemPosition</span><span class="p">).</span><span class="na">getId</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">newList</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">newItemPosition</span><span class="p">).</span><span class="na">getId</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="nf">areContentsTheSame</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">oldItemPosition</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">newItemPosition</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// 判断内容是否相同</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">oldList</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">oldItemPosition</span><span class="p">).</span><span class="na">getText</span><span class="p">().</span><span class="na">equals</span><span class="p">(</span><span class="n">newList</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">newItemPosition</span><span class="p">).</span><span class="na">getText</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">Object</span><span class="w"> </span><span class="nf">getChangePayload</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">oldItemPosition</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">newItemPosition</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// 返回一个 Payload 对象，用于局部刷新</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;update_text&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="3-adapter">3. Adapter 实现<a class="headerlink" href="#3-adapter" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">MyAdapter</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">RecyclerView</span><span class="p">.</span><span class="na">Adapter</span><span class="o">&lt;</span><span class="n">MyAdapter</span><span class="p">.</span><span class="na">MyViewHolder</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Item</span><span class="o">&gt;</span><span class="w"> </span><span class="n">mData</span><span class="p">;</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">class</span> <span class="nc">MyViewHolder</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">RecyclerView</span><span class="p">.</span><span class="na">ViewHolder</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">public</span><span class="w"> </span><span class="n">TextView</span><span class="w"> </span><span class="n">mTextView</span><span class="p">;</span>

<span class="w">        </span><span class="kd">public</span><span class="w"> </span><span class="nf">MyViewHolder</span><span class="p">(</span><span class="n">View</span><span class="w"> </span><span class="n">itemView</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">super</span><span class="p">(</span><span class="n">itemView</span><span class="p">);</span>
<span class="w">            </span><span class="n">mTextView</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">itemView</span><span class="p">.</span><span class="na">findViewById</span><span class="p">(</span><span class="n">R</span><span class="p">.</span><span class="na">id</span><span class="p">.</span><span class="na">textView</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">MyAdapter</span><span class="p">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Item</span><span class="o">&gt;</span><span class="w"> </span><span class="n">data</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">mData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">MyViewHolder</span><span class="w"> </span><span class="nf">onCreateViewHolder</span><span class="p">(</span><span class="n">ViewGroup</span><span class="w"> </span><span class="n">parent</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">viewType</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">View</span><span class="w"> </span><span class="n">view</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LayoutInflater</span><span class="p">.</span><span class="na">from</span><span class="p">(</span><span class="n">parent</span><span class="p">.</span><span class="na">getContext</span><span class="p">())</span>
<span class="w">                </span><span class="p">.</span><span class="na">inflate</span><span class="p">(</span><span class="n">R</span><span class="p">.</span><span class="na">layout</span><span class="p">.</span><span class="na">item_layout</span><span class="p">,</span><span class="w"> </span><span class="n">parent</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">MyViewHolder</span><span class="p">(</span><span class="n">view</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">onBindViewHolder</span><span class="p">(</span><span class="n">MyViewHolder</span><span class="w"> </span><span class="n">holder</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">position</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">holder</span><span class="p">.</span><span class="na">mTextView</span><span class="p">.</span><span class="na">setText</span><span class="p">(</span><span class="n">mData</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">position</span><span class="p">).</span><span class="na">getText</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">onBindViewHolder</span><span class="p">(</span><span class="n">MyViewHolder</span><span class="w"> </span><span class="n">holder</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">position</span><span class="p">,</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="n">payloads</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">payloads</span><span class="p">.</span><span class="na">isEmpty</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">super</span><span class="p">.</span><span class="na">onBindViewHolder</span><span class="p">(</span><span class="n">holder</span><span class="p">,</span><span class="w"> </span><span class="n">position</span><span class="p">,</span><span class="w"> </span><span class="n">payloads</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// 处理 Payload</span>
<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">Object</span><span class="w"> </span><span class="n">payload</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">payloads</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">payload</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="s">&quot;update_text&quot;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">holder</span><span class="p">.</span><span class="na">mTextView</span><span class="p">.</span><span class="na">setText</span><span class="p">(</span><span class="n">mData</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">position</span><span class="p">).</span><span class="na">getText</span><span class="p">());</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">getItemCount</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">mData</span><span class="p">.</span><span class="na">size</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// 更新数据</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">updateData</span><span class="p">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Item</span><span class="o">&gt;</span><span class="w"> </span><span class="n">newData</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">ItemDiffCallback</span><span class="w"> </span><span class="n">callback</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ItemDiffCallback</span><span class="p">(</span><span class="n">mData</span><span class="p">,</span><span class="w"> </span><span class="n">newData</span><span class="p">);</span>
<span class="w">        </span><span class="n">DiffUtil</span><span class="p">.</span><span class="na">DiffResult</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DiffUtil</span><span class="p">.</span><span class="na">calculateDiff</span><span class="p">(</span><span class="n">callback</span><span class="p">);</span>
<span class="w">        </span><span class="n">mData</span><span class="p">.</span><span class="na">clear</span><span class="p">();</span>
<span class="w">        </span><span class="n">mData</span><span class="p">.</span><span class="na">addAll</span><span class="p">(</span><span class="n">newData</span><span class="p">);</span>
<span class="w">        </span><span class="n">result</span><span class="p">.</span><span class="na">dispatchUpdatesTo</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h4 id="4_3">4. 使用示例<a class="headerlink" href="#4_3" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="n">List</span><span class="o">&lt;</span><span class="n">Item</span><span class="o">&gt;</span><span class="w"> </span><span class="n">oldData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">...;</span><span class="w"> </span><span class="c1">// 旧数据</span>
<span class="n">List</span><span class="o">&lt;</span><span class="n">Item</span><span class="o">&gt;</span><span class="w"> </span><span class="n">newData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">...;</span><span class="w"> </span><span class="c1">// 新数据</span>

<span class="n">MyAdapter</span><span class="w"> </span><span class="n">adapter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">MyAdapter</span><span class="p">(</span><span class="n">oldData</span><span class="p">);</span>
<span class="n">recyclerView</span><span class="p">.</span><span class="na">setAdapter</span><span class="p">(</span><span class="n">adapter</span><span class="p">);</span>

<span class="c1">// 更新数据</span>
<span class="n">adapter</span><span class="p">.</span><span class="na">updateData</span><span class="p">(</span><span class="n">newData</span><span class="p">);</span>
</code></pre></div>
<hr />
<h3 id="diffutil-payload"><strong>DiffUtil 和 Payload 机制的配合</strong><a class="headerlink" href="#diffutil-payload" title="Permanent link">&para;</a></h3>
<ol>
<li><strong><code>getChangePayload</code> 方法</strong>：</li>
<li>在 <code>DiffUtil.Callback</code> 中实现 <code>getChangePayload</code> 方法，返回一个 <code>Object</code>（如 <code>String</code> 或自定义对象）。</li>
<li>
<p>这个 <code>Object</code> 会作为 <code>payload</code> 传递给 <code>onBindViewHolder</code> 方法。</p>
</li>
<li>
<p><strong>局部刷新</strong>：</p>
</li>
<li>
<p>在 <code>onBindViewHolder</code> 中，根据 <code>payload</code> 的内容，只更新特定的视图，而不重新绑定整个 <code>Item</code>。</p>
</li>
<li>
<p><strong>性能优化</strong>：</p>
</li>
<li>通过 Payload 机制，<code>RecyclerView</code> 可以只更新发生变化的部分，进一步提升性能。</li>
</ol>
<hr />
<h3 id="_11"><strong>总结</strong><a class="headerlink" href="#_11" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>DiffUtil</strong> 用于高效计算数据集的差异，并生成更新操作，避免不必要的刷新。</li>
<li><strong>Payload 机制</strong> 用于局部刷新，只更新特定的视图。</li>
<li><strong>DiffUtil 和 Payload 机制可以完美配合</strong>，在计算差异的同时，支持局部刷新，进一步提升性能。</li>
</ul>
<p>如果你的列表数据频繁变化，且需要高性能的刷新机制，强烈推荐使用 <code>DiffUtil</code> 和 Payload 机制！</p>
</details>
<h2 id="android-surfaceview">Android SurfaceView原理解析<a class="headerlink" href="#android-surfaceview" title="Permanent link">&para;</a></h2>
<details class="answer">
<summary>答案</summary>
<p><code>SurfaceView</code> 是 Android 中用于处理复杂图形绘制和高效渲染的重要组件，尤其适用于需要频繁更新 UI 或高性能图形处理的场景（如游戏、视频播放、相机预览等）。与普通的 <code>View</code> 不同，<code>SurfaceView</code> 在独立的线程中绘制内容，并且可以直接操作硬件加速的 Surface，从而避免阻塞主线程。</p>
<p>以下是 <code>SurfaceView</code> 的核心特性和使用方法解析：</p>
<hr />
<h3 id="1-surfaceview">1. <strong>SurfaceView 的特点</strong><a class="headerlink" href="#1-surfaceview" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>独立的绘制线程</strong>：<code>SurfaceView</code> 拥有一个独立的 Surface，可以在非 UI 线程中进行绘制，避免阻塞主线程。</li>
<li><strong>双缓冲机制</strong>：<code>SurfaceView</code> 使用双缓冲技术，绘制效率更高，减少画面闪烁。</li>
<li><strong>直接操作 Surface</strong>：通过 <code>SurfaceHolder</code> 可以直接操作底层的 Surface，支持硬件加速。</li>
<li><strong>适合高频更新</strong>：适用于需要频繁更新 UI 的场景（如游戏、视频播放）。</li>
<li><strong>透明区域支持</strong>：<code>SurfaceView</code> 的内容可以覆盖在其他视图之上，支持透明区域。</li>
</ul>
<hr />
<h3 id="2-surfaceview">2. <strong>SurfaceView 的基本结构</strong><a class="headerlink" href="#2-surfaceview" title="Permanent link">&para;</a></h3>
<p><code>SurfaceView</code> 的核心是通过 <code>SurfaceHolder</code> 来管理 Surface 的生命周期和绘制操作。<code>SurfaceHolder</code> 提供了对 Surface 的控制接口。</p>
<h4 id="_12">关键类和方法：<a class="headerlink" href="#_12" title="Permanent link">&para;</a></h4>
<ul>
<li><strong><code>SurfaceView</code></strong>：用于显示内容的视图。</li>
<li><strong><code>SurfaceHolder</code></strong>：管理 Surface 的生命周期和绘制操作。</li>
<li><code>addCallback(SurfaceHolder.Callback)</code>：监听 Surface 的生命周期事件。</li>
<li><code>lockCanvas()</code>：获取一个 Canvas 对象用于绘制。</li>
<li><code>unlockCanvasAndPost(Canvas)</code>：提交绘制内容并释放 Canvas。</li>
<li><strong><code>SurfaceHolder.Callback</code></strong>：监听 Surface 的创建、改变和销毁事件。</li>
</ul>
<hr />
<h3 id="3-surfaceview">3. <strong>SurfaceView 的使用步骤</strong><a class="headerlink" href="#3-surfaceview" title="Permanent link">&para;</a></h3>
<h4 id="1-surfaceview_1">（1）在布局文件中定义 <code>SurfaceView</code><a class="headerlink" href="#1-surfaceview_1" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="nt">&lt;SurfaceView</span>
<span class="w">    </span><span class="na">android:id=</span><span class="s">&quot;@+id/surfaceView&quot;</span>
<span class="w">    </span><span class="na">android:layout_width=</span><span class="s">&quot;match_parent&quot;</span>
<span class="w">    </span><span class="na">android:layout_height=</span><span class="s">&quot;match_parent&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
</code></pre></div>
<h4 id="2-activity-fragment-surfaceview">（2）在 Activity 或 Fragment 中初始化 <code>SurfaceView</code><a class="headerlink" href="#2-activity-fragment-surfaceview" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="n">SurfaceView</span><span class="w"> </span><span class="n">surfaceView</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">findViewById</span><span class="p">(</span><span class="n">R</span><span class="p">.</span><span class="na">id</span><span class="p">.</span><span class="na">surfaceView</span><span class="p">);</span>
<span class="n">SurfaceHolder</span><span class="w"> </span><span class="n">surfaceHolder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">surfaceView</span><span class="p">.</span><span class="na">getHolder</span><span class="p">();</span>
</code></pre></div>
<h4 id="3-surfaceholdercallback">（3）实现 <code>SurfaceHolder.Callback</code> 接口<a class="headerlink" href="#3-surfaceholdercallback" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="n">surfaceHolder</span><span class="p">.</span><span class="na">addCallback</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">SurfaceHolder</span><span class="p">.</span><span class="na">Callback</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">surfaceCreated</span><span class="p">(</span><span class="n">SurfaceHolder</span><span class="w"> </span><span class="n">holder</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Surface 创建时调用，可以开始绘制</span>
<span class="w">        </span><span class="k">new</span><span class="w"> </span><span class="n">Thread</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">DrawingThread</span><span class="p">(</span><span class="n">holder</span><span class="p">)).</span><span class="na">start</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">surfaceChanged</span><span class="p">(</span><span class="n">SurfaceHolder</span><span class="w"> </span><span class="n">holder</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">format</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">width</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">height</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Surface 尺寸或格式改变时调用</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">surfaceDestroyed</span><span class="p">(</span><span class="n">SurfaceHolder</span><span class="w"> </span><span class="n">holder</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Surface 销毁时调用，停止绘制</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">});</span>
</code></pre></div>
<h4 id="4_4">（4）在独立线程中绘制内容<a class="headerlink" href="#4_4" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="kd">class</span> <span class="nc">DrawingThread</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">Runnable</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">SurfaceHolder</span><span class="w"> </span><span class="n">surfaceHolder</span><span class="p">;</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">DrawingThread</span><span class="p">(</span><span class="n">SurfaceHolder</span><span class="w"> </span><span class="n">surfaceHolder</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">surfaceHolder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">surfaceHolder</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">run</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">Canvas</span><span class="w"> </span><span class="n">canvas</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">canvas</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">surfaceHolder</span><span class="p">.</span><span class="na">lockCanvas</span><span class="p">();</span><span class="w"> </span><span class="c1">// 获取 Canvas</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">canvas</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="c1">// 在 Canvas 上绘制内容</span>
<span class="w">                </span><span class="n">canvas</span><span class="p">.</span><span class="na">drawColor</span><span class="p">(</span><span class="n">Color</span><span class="p">.</span><span class="na">WHITE</span><span class="p">);</span>
<span class="w">                </span><span class="n">Paint</span><span class="w"> </span><span class="n">paint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Paint</span><span class="p">();</span>
<span class="w">                </span><span class="n">paint</span><span class="p">.</span><span class="na">setColor</span><span class="p">(</span><span class="n">Color</span><span class="p">.</span><span class="na">RED</span><span class="p">);</span>
<span class="w">                </span><span class="n">canvas</span><span class="p">.</span><span class="na">drawCircle</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w"> </span><span class="mi">50</span><span class="p">,</span><span class="w"> </span><span class="n">paint</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">finally</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">canvas</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">surfaceHolder</span><span class="p">.</span><span class="na">unlockCanvasAndPost</span><span class="p">(</span><span class="n">canvas</span><span class="p">);</span><span class="w"> </span><span class="c1">// 提交绘制内容</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<hr />
<h3 id="4-surfaceview">4. <strong>SurfaceView 的注意事项</strong><a class="headerlink" href="#4-surfaceview" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>线程安全</strong>：<code>SurfaceView</code> 的绘制操作通常需要在独立线程中进行，避免阻塞主线程。</li>
<li><strong>生命周期管理</strong>：需要正确处理 Surface 的生命周期（如 <code>surfaceCreated</code> 和 <code>surfaceDestroyed</code>），避免资源泄漏。</li>
<li><strong>性能优化</strong>：尽量减少 <code>lockCanvas()</code> 和 <code>unlockCanvasAndPost()</code> 的调用频率，避免频繁锁定和解锁 Surface。</li>
<li><strong>与 View 的区别</strong>：<code>SurfaceView</code> 的内容是独立于视图层级的，因此可以覆盖在其他视图之上，但也可能导致布局问题。</li>
</ul>
<hr />
<h3 id="5-surfaceview">5. <strong>SurfaceView 的替代方案</strong><a class="headerlink" href="#5-surfaceview" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>TextureView</strong>：适用于需要动态更新内容的场景，支持动画和变形，但性能略低于 <code>SurfaceView</code>。</li>
<li><strong>GLSurfaceView</strong>：基于 OpenGL ES 的 <code>SurfaceView</code>，适用于 3D 图形渲染。</li>
</ul>
<hr />
<h3 id="6-surfaceview">6. <strong>示例：使用 SurfaceView 实现简单动画</strong><a class="headerlink" href="#6-surfaceview" title="Permanent link">&para;</a></h3>
<p>以下是一个简单的示例，展示如何在 <code>SurfaceView</code> 中实现一个移动的圆形动画。</p>
<div class="highlight"><pre><span></span><code><span class="kd">class</span> <span class="nc">DrawingThread</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">Runnable</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">SurfaceHolder</span><span class="w"> </span><span class="n">surfaceHolder</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="n">isRunning</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">DrawingThread</span><span class="p">(</span><span class="n">SurfaceHolder</span><span class="w"> </span><span class="n">surfaceHolder</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">surfaceHolder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">surfaceHolder</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">run</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">isRunning</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">Canvas</span><span class="w"> </span><span class="n">canvas</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">            </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">canvas</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">surfaceHolder</span><span class="p">.</span><span class="na">lockCanvas</span><span class="p">();</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">canvas</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="c1">// 清空画布</span>
<span class="w">                    </span><span class="n">canvas</span><span class="p">.</span><span class="na">drawColor</span><span class="p">(</span><span class="n">Color</span><span class="p">.</span><span class="na">WHITE</span><span class="p">);</span>
<span class="w">                    </span><span class="c1">// 绘制圆形</span>
<span class="w">                    </span><span class="n">Paint</span><span class="w"> </span><span class="n">paint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Paint</span><span class="p">();</span>
<span class="w">                    </span><span class="n">paint</span><span class="p">.</span><span class="na">setColor</span><span class="p">(</span><span class="n">Color</span><span class="p">.</span><span class="na">RED</span><span class="p">);</span>
<span class="w">                    </span><span class="n">canvas</span><span class="p">.</span><span class="na">drawCircle</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w"> </span><span class="mi">50</span><span class="p">,</span><span class="w"> </span><span class="n">paint</span><span class="p">);</span>
<span class="w">                    </span><span class="c1">// 更新圆形位置</span>
<span class="w">                    </span><span class="n">x</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span>
<span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">canvas</span><span class="p">.</span><span class="na">getWidth</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">                        </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">                    </span><span class="p">}</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">finally</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">canvas</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">surfaceHolder</span><span class="p">.</span><span class="na">unlockCanvasAndPost</span><span class="p">(</span><span class="n">canvas</span><span class="p">);</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="c1">// 控制帧率</span>
<span class="w">            </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">Thread</span><span class="p">.</span><span class="na">sleep</span><span class="p">(</span><span class="mi">16</span><span class="p">);</span><span class="w"> </span><span class="c1">// 约 60 FPS</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">InterruptedException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">e</span><span class="p">.</span><span class="na">printStackTrace</span><span class="p">();</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">stop</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">isRunning</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>在 <code>surfaceCreated</code> 中启动线程，在 <code>surfaceDestroyed</code> 中停止线程：
<div class="highlight"><pre><span></span><code><span class="n">surfaceHolder</span><span class="p">.</span><span class="na">addCallback</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">SurfaceHolder</span><span class="p">.</span><span class="na">Callback</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">DrawingThread</span><span class="w"> </span><span class="n">drawingThread</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">surfaceCreated</span><span class="p">(</span><span class="n">SurfaceHolder</span><span class="w"> </span><span class="n">holder</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">drawingThread</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">DrawingThread</span><span class="p">(</span><span class="n">holder</span><span class="p">);</span>
<span class="w">        </span><span class="k">new</span><span class="w"> </span><span class="n">Thread</span><span class="p">(</span><span class="n">drawingThread</span><span class="p">).</span><span class="na">start</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">surfaceChanged</span><span class="p">(</span><span class="n">SurfaceHolder</span><span class="w"> </span><span class="n">holder</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">format</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">width</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">height</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">surfaceDestroyed</span><span class="p">(</span><span class="n">SurfaceHolder</span><span class="w"> </span><span class="n">holder</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">drawingThread</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">drawingThread</span><span class="p">.</span><span class="na">stop</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">});</span>
</code></pre></div></p>
<hr />
<p>通过以上内容，你可以掌握 <code>SurfaceView</code> 的基本使用方法和核心特性。如果需要更复杂的图形处理，可以结合 OpenGL ES 或自定义绘制逻辑来实现。</p>
</details>
<h2 id="android-surfaceviewui">为什么Android SurfaceView可以在子线程刷新UI？<a class="headerlink" href="#android-surfaceviewui" title="Permanent link">&para;</a></h2>
<details class="answer">
<summary>答案</summary>
<p><code>SurfaceView</code> 之所以能够在子线程中刷新 UI，是因为它的设计机制与普通的 <code>View</code> 不同。普通 <code>View</code> 的绘制必须在主线程（UI 线程）中进行，而 <code>SurfaceView</code> 通过独立的 <code>Surface</code> 和双缓冲机制，实现了在子线程中绘制内容的能力。以下是具体原因和机制：</p>
<hr />
<h3 id="1-surface">1. <strong>独立的 Surface</strong><a class="headerlink" href="#1-surface" title="Permanent link">&para;</a></h3>
<p><code>SurfaceView</code> 拥有一个独立的 <code>Surface</code>，这是一个由系统管理的绘图表面。与普通 <code>View</code> 共享的 UI 线程绘制机制不同，<code>Surface</code> 可以在独立的线程中进行绘制操作。</p>
<ul>
<li><strong>普通 <code>View</code></strong>：所有 <code>View</code> 的绘制都通过 <code>ViewRootImpl</code> 在主线程中统一处理，调用 <code>onDraw()</code> 方法。</li>
<li><strong><code>SurfaceView</code></strong>：<code>SurfaceView</code> 的绘制不依赖于 <code>ViewRootImpl</code>，而是直接操作底层的 <code>Surface</code>，因此可以在子线程中进行。</li>
</ul>
<hr />
<h3 id="2_4">2. <strong>双缓冲机制</strong><a class="headerlink" href="#2_4" title="Permanent link">&para;</a></h3>
<p><code>SurfaceView</code> 使用双缓冲技术，这意味着它有两个缓冲区：
- <strong>前端缓冲区</strong>：用于显示当前内容。
- <strong>后端缓冲区</strong>：用于绘制下一帧内容。</p>
<p>绘制操作在后端缓冲区中进行，完成后通过 <code>unlockCanvasAndPost()</code> 将后端缓冲区的内容交换到前端缓冲区显示。这种机制避免了直接操作显示缓冲区导致的画面闪烁问题，同时也提高了绘制效率。</p>
<hr />
<h3 id="3-surfaceholder-canvas">3. <strong>SurfaceHolder 和 Canvas 的控制</strong><a class="headerlink" href="#3-surfaceholder-canvas" title="Permanent link">&para;</a></h3>
<p><code>SurfaceView</code> 通过 <code>SurfaceHolder</code> 管理 <code>Surface</code> 的生命周期和绘制操作。<code>SurfaceHolder</code> 提供了以下关键方法：
- <strong><code>lockCanvas()</code></strong>：获取一个 <code>Canvas</code> 对象，用于在后端缓冲区中绘制内容。
- <strong><code>unlockCanvasAndPost()</code></strong>：将绘制完成的内容提交到前端缓冲区显示。</p>
<p>这些方法可以在子线程中调用，因此 <code>SurfaceView</code> 的绘制操作可以完全脱离主线程。</p>
<hr />
<h3 id="4_5">4. <strong>硬件加速支持</strong><a class="headerlink" href="#4_5" title="Permanent link">&para;</a></h3>
<p><code>SurfaceView</code> 的 <code>Surface</code> 直接由硬件合成器（Hardware Composer）管理，支持硬件加速。这意味着绘制操作可以通过 GPU 高效执行，而不需要依赖主线程的软件渲染。</p>
<hr />
<h3 id="5-view">5. <strong>与普通 View 的对比</strong><a class="headerlink" href="#5-view" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>普通 <code>View</code></strong>：</li>
<li>绘制操作必须在主线程中通过 <code>onDraw()</code> 方法完成。</li>
<li>所有 <code>View</code> 的绘制共享同一个 UI 线程，频繁绘制可能导致主线程卡顿。</li>
<li>
<p>适合静态或低频更新的 UI。</p>
</li>
<li>
<p><strong><code>SurfaceView</code></strong>：</p>
</li>
<li>绘制操作可以在子线程中完成，通过独立的 <code>Surface</code> 和双缓冲机制实现高效绘制。</li>
<li>适合高频更新的场景（如游戏、视频播放、相机预览）。</li>
<li>绘制内容直接显示在屏幕上，不依赖于 <code>View</code> 的层级结构。</li>
</ul>
<hr />
<h3 id="6-view-ui">6. <strong>为什么普通 View 不能在子线程刷新 UI？</strong><a class="headerlink" href="#6-view-ui" title="Permanent link">&para;</a></h3>
<p>普通 <code>View</code> 的绘制依赖于 <code>ViewRootImpl</code> 和 <code>Choreographer</code>，它们会在主线程中调度 <code>onDraw()</code> 方法。Android 的 UI 框架设计为单线程模型，所有 UI 操作（包括测量、布局、绘制）都必须在主线程中执行，以确保线程安全。</p>
<p>如果尝试在子线程中直接操作普通 <code>View</code>，会抛出 <code>CalledFromWrongThreadException</code> 异常，提示“Only the original thread that created a view hierarchy can touch its views”。</p>
<hr />
<h3 id="7-surfaceview">7. <strong>SurfaceView 的子线程绘制示例</strong><a class="headerlink" href="#7-surfaceview" title="Permanent link">&para;</a></h3>
<p>以下是一个简单的示例，展示如何在子线程中刷新 <code>SurfaceView</code> 的 UI：</p>
<div class="highlight"><pre><span></span><code><span class="kd">class</span> <span class="nc">DrawingThread</span><span class="w"> </span><span class="kd">implements</span><span class="w"> </span><span class="n">Runnable</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">SurfaceHolder</span><span class="w"> </span><span class="n">surfaceHolder</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="n">isRunning</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="nf">DrawingThread</span><span class="p">(</span><span class="n">SurfaceHolder</span><span class="w"> </span><span class="n">surfaceHolder</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">surfaceHolder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">surfaceHolder</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">run</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">isRunning</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">Canvas</span><span class="w"> </span><span class="n">canvas</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
<span class="w">            </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">canvas</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">surfaceHolder</span><span class="p">.</span><span class="na">lockCanvas</span><span class="p">();</span><span class="w"> </span><span class="c1">// 获取 Canvas</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">canvas</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="c1">// 在 Canvas 上绘制内容</span>
<span class="w">                    </span><span class="n">canvas</span><span class="p">.</span><span class="na">drawColor</span><span class="p">(</span><span class="n">Color</span><span class="p">.</span><span class="na">WHITE</span><span class="p">);</span>
<span class="w">                    </span><span class="n">Paint</span><span class="w"> </span><span class="n">paint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Paint</span><span class="p">();</span>
<span class="w">                    </span><span class="n">paint</span><span class="p">.</span><span class="na">setColor</span><span class="p">(</span><span class="n">Color</span><span class="p">.</span><span class="na">RED</span><span class="p">);</span>
<span class="w">                    </span><span class="n">canvas</span><span class="p">.</span><span class="na">drawCircle</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="w"> </span><span class="mi">50</span><span class="p">,</span><span class="w"> </span><span class="n">paint</span><span class="p">);</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">finally</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">canvas</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">surfaceHolder</span><span class="p">.</span><span class="na">unlockCanvasAndPost</span><span class="p">(</span><span class="n">canvas</span><span class="p">);</span><span class="w"> </span><span class="c1">// 提交绘制内容</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">stop</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">isRunning</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>在 <code>SurfaceHolder.Callback</code> 中启动子线程：
<div class="highlight"><pre><span></span><code><span class="n">surfaceHolder</span><span class="p">.</span><span class="na">addCallback</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">SurfaceHolder</span><span class="p">.</span><span class="na">Callback</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">DrawingThread</span><span class="w"> </span><span class="n">drawingThread</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">surfaceCreated</span><span class="p">(</span><span class="n">SurfaceHolder</span><span class="w"> </span><span class="n">holder</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">drawingThread</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">DrawingThread</span><span class="p">(</span><span class="n">holder</span><span class="p">);</span>
<span class="w">        </span><span class="k">new</span><span class="w"> </span><span class="n">Thread</span><span class="p">(</span><span class="n">drawingThread</span><span class="p">).</span><span class="na">start</span><span class="p">();</span><span class="w"> </span><span class="c1">// 启动子线程</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">surfaceChanged</span><span class="p">(</span><span class="n">SurfaceHolder</span><span class="w"> </span><span class="n">holder</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">format</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">width</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">height</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">surfaceDestroyed</span><span class="p">(</span><span class="n">SurfaceHolder</span><span class="w"> </span><span class="n">holder</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">drawingThread</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">drawingThread</span><span class="p">.</span><span class="na">stop</span><span class="p">();</span><span class="w"> </span><span class="c1">// 停止子线程</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">});</span>
</code></pre></div></p>
<hr />
<h3 id="_13">总结<a class="headerlink" href="#_13" title="Permanent link">&para;</a></h3>
<p><code>SurfaceView</code> 之所以能够在子线程中刷新 UI，是因为它使用了独立的 <code>Surface</code> 和双缓冲机制，绕过了普通 <code>View</code> 的单线程绘制模型。这种设计使得 <code>SurfaceView</code> 非常适合需要高性能和高频更新的场景（如游戏、视频播放等）。然而，普通 <code>View</code> 仍然适用于大多数静态或低频更新的 UI 场景。</p>
</details>
<h2 id="android-surfaceview-view">Android 和SurfaceView相关的, 哪个View更适合视频播放？更简单易用。<a class="headerlink" href="#android-surfaceview-view" title="Permanent link">&para;</a></h2>
<details class="answer">
<summary>答案</summary>
<p>在 Android 开发中，<code>SurfaceView</code> 和 <code>TextureView</code> 都适合视频播放，但各有优缺点，选择取决于具体需求。</p>
<h3 id="surfaceview">SurfaceView<a class="headerlink" href="#surfaceview" title="Permanent link">&para;</a></h3>
<p><strong>优点：</strong>
1. <strong>性能高</strong>：<code>SurfaceView</code> 在独立窗口中绘制，不占用主线程资源，适合高性能需求。
2. <strong>硬件加速</strong>：支持硬件加速，适合视频播放等图形密集型任务。</p>
<p><strong>缺点：</strong>
1. <strong>布局限制</strong>：由于在独立窗口中绘制，某些布局操作（如平移、缩放）可能受限。
2. <strong>透明度问题</strong>：不支持透明度，无法实现透明或半透明效果。</p>
<h3 id="textureview">TextureView<a class="headerlink" href="#textureview" title="Permanent link">&para;</a></h3>
<p><strong>优点：</strong>
1. <strong>布局灵活</strong>：<code>TextureView</code> 是普通视图，支持所有布局操作，如平移、缩放、旋转等。
2. <strong>透明度支持</strong>：支持透明度，适合需要透明或半透明效果的场景。</p>
<p><strong>缺点：</strong>
1. <strong>性能稍低</strong>：由于在主线程中绘制，性能略低于 <code>SurfaceView</code>。
2. <strong>内存占用</strong>：相比 <code>SurfaceView</code>，内存占用稍高。</p>
<h3 id="_14">更简单易用的选择<a class="headerlink" href="#_14" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>简单易用</strong>：<code>TextureView</code> 更易用，支持常规布局操作，适合大多数视频播放需求。</li>
<li><strong>高性能需求</strong>：若对性能要求极高，<code>SurfaceView</code> 是更好的选择。</li>
</ul>
<h3 id="_15">总结<a class="headerlink" href="#_15" title="Permanent link">&para;</a></h3>
<ul>
<li><strong><code>TextureView</code></strong>：适合大多数视频播放场景，布局灵活，支持透明度。</li>
<li><strong><code>SurfaceView</code></strong>：适合高性能需求，但不支持透明度，布局操作受限。</li>
</ul>
<p>根据具体需求选择合适的视图。
IJKPlayer默认使用SurfaceView，但是也提供了TextureView可以选择。</p>
</details>
<h2 id="android-remoteviews">Android RemoteViews实现和使用场景<a class="headerlink" href="#android-remoteviews" title="Permanent link">&para;</a></h2>
<details class="answer">
<summary>答案</summary>
<h3 id="android-remoteviews_1">Android RemoteViews 实现和使用场景<a class="headerlink" href="#android-remoteviews_1" title="Permanent link">&para;</a></h3>
<h4 id="1_3">1. 概述<a class="headerlink" href="#1_3" title="Permanent link">&para;</a></h4>
<p><code>RemoteViews</code> 是 Android 中用于描述跨进程显示的视图层次结构的类，常用于通知栏、App Widgets 和系统 UI 的定制。它允许你在一个进程中创建视图，并在另一个进程中显示。</p>
<h4 id="2_5">2. 实现步骤<a class="headerlink" href="#2_5" title="Permanent link">&para;</a></h4>
<h5 id="21-remoteviews">2.1 创建 RemoteViews 对象<a class="headerlink" href="#21-remoteviews" title="Permanent link">&para;</a></h5>
<p>首先，创建一个 <code>RemoteViews</code> 对象，指定布局文件和包名。</p>
<div class="highlight"><pre><span></span><code><span class="n">RemoteViews</span><span class="w"> </span><span class="n">remoteViews</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">RemoteViews</span><span class="p">(</span><span class="n">context</span><span class="p">.</span><span class="na">getPackageName</span><span class="p">(),</span><span class="w"> </span><span class="n">R</span><span class="p">.</span><span class="na">layout</span><span class="p">.</span><span class="na">notification_layout</span><span class="p">);</span>
</code></pre></div>
<h5 id="22">2.2 设置视图内容<a class="headerlink" href="#22" title="Permanent link">&para;</a></h5>
<p>使用 <code>RemoteViews</code> 的方法设置视图内容，如文本、图片等。</p>
<div class="highlight"><pre><span></span><code><span class="n">remoteViews</span><span class="p">.</span><span class="na">setTextViewText</span><span class="p">(</span><span class="n">R</span><span class="p">.</span><span class="na">id</span><span class="p">.</span><span class="na">text_view</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Hello, World!&quot;</span><span class="p">);</span>
<span class="n">remoteViews</span><span class="p">.</span><span class="na">setImageViewResource</span><span class="p">(</span><span class="n">R</span><span class="p">.</span><span class="na">id</span><span class="p">.</span><span class="na">image_view</span><span class="p">,</span><span class="w"> </span><span class="n">R</span><span class="p">.</span><span class="na">drawable</span><span class="p">.</span><span class="na">icon</span><span class="p">);</span>
</code></pre></div>
<h5 id="23-app-widget">2.3 应用到通知或 App Widget<a class="headerlink" href="#23-app-widget" title="Permanent link">&para;</a></h5>
<p>将 <code>RemoteViews</code> 应用到通知或 App Widget。</p>
<p><strong>通知栏示例：</strong></p>
<div class="highlight"><pre><span></span><code><span class="n">NotificationCompat</span><span class="p">.</span><span class="na">Builder</span><span class="w"> </span><span class="n">builder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">NotificationCompat</span><span class="p">.</span><span class="na">Builder</span><span class="p">(</span><span class="n">context</span><span class="p">,</span><span class="w"> </span><span class="n">CHANNEL_ID</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">setSmallIcon</span><span class="p">(</span><span class="n">R</span><span class="p">.</span><span class="na">drawable</span><span class="p">.</span><span class="na">icon</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="na">setContent</span><span class="p">(</span><span class="n">remoteViews</span><span class="p">);</span>

<span class="n">NotificationManager</span><span class="w"> </span><span class="n">notificationManager</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">NotificationManager</span><span class="p">)</span><span class="w"> </span><span class="n">context</span><span class="p">.</span><span class="na">getSystemService</span><span class="p">(</span><span class="n">Context</span><span class="p">.</span><span class="na">NOTIFICATION_SERVICE</span><span class="p">);</span>
<span class="n">notificationManager</span><span class="p">.</span><span class="na">notify</span><span class="p">(</span><span class="n">notificationId</span><span class="p">,</span><span class="w"> </span><span class="n">builder</span><span class="p">.</span><span class="na">build</span><span class="p">());</span>
</code></pre></div>
<p><strong>App Widget 示例：</strong></p>
<div class="highlight"><pre><span></span><code><span class="n">AppWidgetManager</span><span class="w"> </span><span class="n">appWidgetManager</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">AppWidgetManager</span><span class="p">.</span><span class="na">getInstance</span><span class="p">(</span><span class="n">context</span><span class="p">);</span>
<span class="n">appWidgetManager</span><span class="p">.</span><span class="na">updateAppWidget</span><span class="p">(</span><span class="n">appWidgetId</span><span class="p">,</span><span class="w"> </span><span class="n">remoteViews</span><span class="p">);</span>
</code></pre></div>
<h5 id="24">2.4 处理点击事件<a class="headerlink" href="#24" title="Permanent link">&para;</a></h5>
<p>通过 <code>PendingIntent</code> 处理视图的点击事件。</p>
<div class="highlight"><pre><span></span><code><span class="n">Intent</span><span class="w"> </span><span class="n">intent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Intent</span><span class="p">(</span><span class="n">context</span><span class="p">,</span><span class="w"> </span><span class="n">MainActivity</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<span class="n">PendingIntent</span><span class="w"> </span><span class="n">pendingIntent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PendingIntent</span><span class="p">.</span><span class="na">getActivity</span><span class="p">(</span><span class="n">context</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">intent</span><span class="p">,</span><span class="w"> </span><span class="n">PendingIntent</span><span class="p">.</span><span class="na">FLAG_UPDATE_CURRENT</span><span class="p">);</span>
<span class="n">remoteViews</span><span class="p">.</span><span class="na">setOnClickPendingIntent</span><span class="p">(</span><span class="n">R</span><span class="p">.</span><span class="na">id</span><span class="p">.</span><span class="na">button</span><span class="p">,</span><span class="w"> </span><span class="n">pendingIntent</span><span class="p">);</span>
</code></pre></div>
<h4 id="3_2">3. 使用场景<a class="headerlink" href="#3_2" title="Permanent link">&para;</a></h4>
<h5 id="31">3.1 通知栏定制<a class="headerlink" href="#31" title="Permanent link">&para;</a></h5>
<p><code>RemoteViews</code> 常用于定制通知栏的布局，提供更丰富的交互体验。</p>
<h5 id="32-app-widgets">3.2 App Widgets<a class="headerlink" href="#32-app-widgets" title="Permanent link">&para;</a></h5>
<p>在 App Widgets 中使用 <code>RemoteViews</code> 创建主屏幕上的小部件，展示实时信息或提供快捷操作。</p>
<h5 id="33-ui">3.3 系统 UI 定制<a class="headerlink" href="#33-ui" title="Permanent link">&para;</a></h5>
<p>某些系统 UI 元素（如锁屏界面）也可以通过 <code>RemoteViews</code> 进行定制。</p>
<h4 id="4_6">4. 注意事项<a class="headerlink" href="#4_6" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>跨进程限制</strong>：<code>RemoteViews</code> 仅支持部分视图和操作，复杂布局或自定义视图可能无法使用。</li>
<li><strong>性能考虑</strong>：频繁更新 <code>RemoteViews</code> 可能影响性能，需优化更新频率。</li>
<li><strong>兼容性</strong>：不同 Android 版本对 <code>RemoteViews</code> 的支持可能不同，需进行兼容性测试。</li>
</ul>
<h4 id="5_2">5. 总结<a class="headerlink" href="#5_2" title="Permanent link">&para;</a></h4>
<p><code>RemoteViews</code> 是 Android 开发中用于跨进程显示视图的重要工具，适用于通知栏、App Widgets 和系统 UI 的定制。掌握其使用方法能显著提升应用的用户体验。</p>
</details>
<h2 id="android-activitythread">Android ActivityThread源码解析<a class="headerlink" href="#android-activitythread" title="Permanent link">&para;</a></h2>
<details class="answer">
<summary>答案</summary>
<p><code>ActivityThread</code> 是 Android 应用程序的核心类之一，负责管理应用程序的主线程和主线程的消息循环。它是应用程序与系统之间的桥梁，负责处理应用程序的生命周期、UI 更新、事件分发等关键任务。以下是对 <code>ActivityThread</code> 的源码解析，帮助你更好地理解其工作原理。</p>
<h3 id="1-activitythread">1. <strong>ActivityThread 概述</strong><a class="headerlink" href="#1-activitythread" title="Permanent link">&para;</a></h3>
<p><code>ActivityThread</code> 是 Android 应用程序的主线程类，每个应用程序都有一个 <code>ActivityThread</code> 实例。它负责管理应用程序的 <code>Activity</code>、<code>Service</code>、<code>BroadcastReceiver</code> 等组件的生命周期，并与系统服务（如 <code>ActivityManagerService</code>）进行交互。</p>
<h3 id="2-activitythread">2. <strong>ActivityThread 的主要职责</strong><a class="headerlink" href="#2-activitythread" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>管理应用程序的主线程</strong>：<code>ActivityThread</code> 是应用程序的主线程，负责处理 UI 更新和事件分发。</li>
<li><strong>处理应用程序的生命周期</strong>：<code>ActivityThread</code> 负责启动、暂停、恢复、停止和销毁 <code>Activity</code> 和 <code>Service</code>。</li>
<li><strong>与系统服务交互</strong>：<code>ActivityThread</code> 通过 <code>Binder</code> 与 <code>ActivityManagerService</code> 等系统服务通信，执行系统级别的操作。</li>
<li><strong>管理应用程序的 <code>Context</code></strong>：<code>ActivityThread</code> 负责创建和管理应用程序的 <code>Context</code> 对象，如 <code>Application</code>、<code>Activity</code> 等。</li>
</ul>
<h3 id="3-activitythread">3. <strong>ActivityThread 的核心方法</strong><a class="headerlink" href="#3-activitythread" title="Permanent link">&para;</a></h3>
<h4 id="31-mainstring-args">3.1 <code>main(String[] args)</code><a class="headerlink" href="#31-mainstring-args" title="Permanent link">&para;</a></h4>
<p><code>main</code> 方法是 <code>ActivityThread</code> 的入口点，应用程序启动时会调用此方法。它初始化主线程的消息循环（<code>Looper</code>），并创建 <code>ActivityThread</code> 实例。</p>
<div class="highlight"><pre><span></span><code><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// 初始化主线程的 Looper</span>
<span class="w">    </span><span class="n">Looper</span><span class="p">.</span><span class="na">prepareMainLooper</span><span class="p">();</span>

<span class="w">    </span><span class="c1">// 创建 ActivityThread 实例</span>
<span class="w">    </span><span class="n">ActivityThread</span><span class="w"> </span><span class="n">thread</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ActivityThread</span><span class="p">();</span>
<span class="w">    </span><span class="n">thread</span><span class="p">.</span><span class="na">attach</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// 启动主线程的消息循环</span>
<span class="w">    </span><span class="n">Looper</span><span class="p">.</span><span class="na">loop</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>
<ul>
<li><code>Looper.prepareMainLooper()</code>：初始化主线程的 <code>Looper</code>，确保主线程可以处理消息。</li>
<li><code>thread.attach(false)</code>：将 <code>ActivityThread</code> 实例与系统服务（如 <code>ActivityManagerService</code>）进行绑定。</li>
<li><code>Looper.loop()</code>：启动主线程的消息循环，处理消息队列中的消息。</li>
</ul>
<h4 id="32-attachboolean-system">3.2 <code>attach(boolean system)</code><a class="headerlink" href="#32-attachboolean-system" title="Permanent link">&para;</a></h4>
<p><code>attach</code> 方法用于将 <code>ActivityThread</code> 实例与系统服务进行绑定。它会通过 <code>Binder</code> 与 <code>ActivityManagerService</code> 通信，注册应用程序进程。</p>
<div class="highlight"><pre><span></span><code><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">attach</span><span class="p">(</span><span class="kt">boolean</span><span class="w"> </span><span class="n">system</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// 获取 ActivityManagerService 的 Binder 代理</span>
<span class="w">    </span><span class="kd">final</span><span class="w"> </span><span class="n">IActivityManager</span><span class="w"> </span><span class="n">mgr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ActivityManager</span><span class="p">.</span><span class="na">getService</span><span class="p">();</span>
<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// 将 ApplicationThread 注册到 ActivityManagerService</span>
<span class="w">        </span><span class="n">mgr</span><span class="p">.</span><span class="na">attachApplication</span><span class="p">(</span><span class="n">mAppThread</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">RemoteException</span><span class="w"> </span><span class="n">ex</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="n">ex</span><span class="p">.</span><span class="na">rethrowFromSystemServer</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<ul>
<li><code>mAppThread</code> 是 <code>ApplicationThread</code> 的实例，它是 <code>ActivityThread</code> 的内部类，负责与 <code>ActivityManagerService</code> 通信。</li>
<li><code>attachApplication</code> 方法将 <code>ApplicationThread</code> 注册到 <code>ActivityManagerService</code>，系统服务可以通过 <code>ApplicationThread</code> 控制应用程序的生命周期。</li>
</ul>
<h4 id="33-handlemessagemessage-msg">3.3 <code>handleMessage(Message msg)</code><a class="headerlink" href="#33-handlemessagemessage-msg" title="Permanent link">&para;</a></h4>
<p><code>handleMessage</code> 方法是 <code>ActivityThread</code> 处理消息的核心方法。它根据消息的类型执行相应的操作，如启动 <code>Activity</code>、处理 <code>Service</code> 的生命周期等。</p>
<div class="highlight"><pre><span></span><code><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">handleMessage</span><span class="p">(</span><span class="n">Message</span><span class="w"> </span><span class="n">msg</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="na">what</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="n">LAUNCH_ACTIVITY</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// 处理启动 Activity 的消息</span>
<span class="w">            </span><span class="n">handleLaunchActivity</span><span class="p">((</span><span class="n">ActivityClientRecord</span><span class="p">)</span><span class="w"> </span><span class="n">msg</span><span class="p">.</span><span class="na">obj</span><span class="p">);</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="n">PAUSE_ACTIVITY</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// 处理暂停 Activity 的消息</span>
<span class="w">            </span><span class="n">handlePauseActivity</span><span class="p">((</span><span class="n">ActivityClientRecord</span><span class="p">)</span><span class="w"> </span><span class="n">msg</span><span class="p">.</span><span class="na">obj</span><span class="p">);</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="n">STOP_ACTIVITY</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// 处理停止 Activity 的消息</span>
<span class="w">            </span><span class="n">handleStopActivity</span><span class="p">((</span><span class="n">ActivityClientRecord</span><span class="p">)</span><span class="w"> </span><span class="n">msg</span><span class="p">.</span><span class="na">obj</span><span class="p">);</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="c1">// 其他消息处理...</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<ul>
<li><code>LAUNCH_ACTIVITY</code>：处理启动 <code>Activity</code> 的消息，调用 <code>handleLaunchActivity</code> 方法。</li>
<li><code>PAUSE_ACTIVITY</code>：处理暂停 <code>Activity</code> 的消息，调用 <code>handlePauseActivity</code> 方法。</li>
<li><code>STOP_ACTIVITY</code>：处理停止 <code>Activity</code> 的消息，调用 <code>handleStopActivity</code> 方法。</li>
</ul>
<h4 id="34-handlelaunchactivityactivityclientrecord-r">3.4 <code>handleLaunchActivity(ActivityClientRecord r)</code><a class="headerlink" href="#34-handlelaunchactivityactivityclientrecord-r" title="Permanent link">&para;</a></h4>
<p><code>handleLaunchActivity</code> 方法负责启动 <code>Activity</code>。它会创建 <code>Activity</code> 实例，调用 <code>onCreate</code> 方法，并将 <code>Activity</code> 的视图添加到窗口管理器中。</p>
<div class="highlight"><pre><span></span><code><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">handleLaunchActivity</span><span class="p">(</span><span class="n">ActivityClientRecord</span><span class="w"> </span><span class="n">r</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// 创建 Activity 实例</span>
<span class="w">    </span><span class="n">Activity</span><span class="w"> </span><span class="n">activity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">performLaunchActivity</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">);</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">activity</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// 调用 Activity 的 onStart 和 onResume 方法</span>
<span class="w">        </span><span class="n">handleResumeActivity</span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="na">token</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<ul>
<li><code>performLaunchActivity</code>：创建 <code>Activity</code> 实例，并调用 <code>onCreate</code> 方法。</li>
<li><code>handleResumeActivity</code>：调用 <code>Activity</code> 的 <code>onStart</code> 和 <code>onResume</code> 方法，并将 <code>Activity</code> 的视图添加到窗口管理器中。</li>
</ul>
<h3 id="4-applicationthread">4. <strong>ApplicationThread</strong><a class="headerlink" href="#4-applicationthread" title="Permanent link">&para;</a></h3>
<p><code>ApplicationThread</code> 是 <code>ActivityThread</code> 的内部类，负责与 <code>ActivityManagerService</code> 通信。它是 <code>ActivityThread</code> 的 Binder 接口实现类，系统服务通过 <code>ApplicationThread</code> 控制应用程序的生命周期。</p>
<div class="highlight"><pre><span></span><code><span class="kd">private</span><span class="w"> </span><span class="kd">class</span> <span class="nc">ApplicationThread</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">IApplicationThread</span><span class="p">.</span><span class="na">Stub</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">scheduleLaunchActivity</span><span class="p">(</span><span class="n">Intent</span><span class="w"> </span><span class="n">intent</span><span class="p">,</span><span class="w"> </span><span class="n">IBinder</span><span class="w"> </span><span class="n">token</span><span class="p">,</span><span class="w"> </span><span class="p">...)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// 发送 LAUNCH_ACTIVITY 消息到主线程</span>
<span class="w">        </span><span class="n">sendMessage</span><span class="p">(</span><span class="n">H</span><span class="p">.</span><span class="na">LAUNCH_ACTIVITY</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">schedulePauseActivity</span><span class="p">(</span><span class="n">IBinder</span><span class="w"> </span><span class="n">token</span><span class="p">,</span><span class="w"> </span><span class="p">...)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// 发送 PAUSE_ACTIVITY 消息到主线程</span>
<span class="w">        </span><span class="n">sendMessage</span><span class="p">(</span><span class="n">H</span><span class="p">.</span><span class="na">PAUSE_ACTIVITY</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<ul>
<li><code>scheduleLaunchActivity</code>：当系统服务需要启动 <code>Activity</code> 时，会调用此方法，发送 <code>LAUNCH_ACTIVITY</code> 消息到主线程。</li>
<li><code>schedulePauseActivity</code>：当系统服务需要暂停 <code>Activity</code> 时，会调用此方法，发送 <code>PAUSE_ACTIVITY</code> 消息到主线程。</li>
</ul>
<h3 id="5_3">5. <strong>总结</strong><a class="headerlink" href="#5_3" title="Permanent link">&para;</a></h3>
<p><code>ActivityThread</code> 是 Android 应用程序的核心类，负责管理应用程序的主线程和组件的生命周期。它通过 <code>ApplicationThread</code> 与系统服务通信，处理系统级别的操作。理解 <code>ActivityThread</code> 的工作原理，有助于深入理解 Android 应用程序的运行机制。</p>
<h3 id="6_2">6. <strong>关键点</strong><a class="headerlink" href="#6_2" title="Permanent link">&para;</a></h3>
<ul>
<li><code>ActivityThread</code> 是应用程序的主线程，负责处理 UI 更新和事件分发。</li>
<li><code>ApplicationThread</code> 是 <code>ActivityThread</code> 的内部类，负责与 <code>ActivityManagerService</code> 通信。</li>
<li><code>ActivityThread</code> 通过 <code>handleMessage</code> 方法处理系统服务发送的消息，执行相应的生命周期操作。</li>
</ul>
<p>通过对 <code>ActivityThread</code> 源码的解析，你可以更好地理解 Android 应用程序的启动过程、生命周期管理和消息处理机制。</p>
</details>
<h2 id="android">Android进程名称是如何被指定的？<a class="headerlink" href="#android" title="Permanent link">&para;</a></h2>
<details class="answer">
<summary>答案</summary>
<p>在Android系统中，进程名称的指定主要与<code>ActivityThread</code>类和<code>Process</code>类相关。以下是源码角度的分析：</p>
<h3 id="1-activitythread_1">1. <code>ActivityThread</code>类<a class="headerlink" href="#1-activitythread_1" title="Permanent link">&para;</a></h3>
<p><code>ActivityThread</code>是Android应用的主线程，负责管理应用的主循环和组件生命周期。进程名称的初始化在<code>ActivityThread</code>的<code>main</code>方法中完成。</p>
<h4 id="main"><code>main</code>方法<a class="headerlink" href="#main" title="Permanent link">&para;</a></h4>
<p><div class="highlight"><pre><span></span><code><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="p">...</span>
<span class="w">    </span><span class="n">Process</span><span class="p">.</span><span class="na">setArgV0</span><span class="p">(</span><span class="s">&quot;&lt;pre-initialized&gt;&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="n">Looper</span><span class="p">.</span><span class="na">prepareMainLooper</span><span class="p">();</span>
<span class="w">    </span><span class="n">ActivityThread</span><span class="w"> </span><span class="n">thread</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">ActivityThread</span><span class="p">();</span>
<span class="w">    </span><span class="n">thread</span><span class="p">.</span><span class="na">attach</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
<span class="w">    </span><span class="p">...</span>
<span class="w">    </span><span class="n">Looper</span><span class="p">.</span><span class="na">loop</span><span class="p">();</span>
<span class="w">    </span><span class="p">...</span>
<span class="p">}</span>
</code></pre></div>
在<code>main</code>方法中，<code>Process.setArgV0</code>用于设置进程名称的初始值。</p>
<h3 id="2-attach">2. <code>attach</code>方法<a class="headerlink" href="#2-attach" title="Permanent link">&para;</a></h3>
<p><code>attach</code>方法进一步设置进程名称，特别是当应用启动时。</p>
<p><div class="highlight"><pre><span></span><code><span class="kd">private</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">attach</span><span class="p">(</span><span class="kt">boolean</span><span class="w"> </span><span class="n">system</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="p">...</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">system</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">processName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ActivityThread</span><span class="p">.</span><span class="na">currentProcessName</span><span class="p">();</span>
<span class="w">        </span><span class="n">android</span><span class="p">.</span><span class="na">ddm</span><span class="p">.</span><span class="na">DdmHandleAppName</span><span class="p">.</span><span class="na">setAppName</span><span class="p">(</span><span class="n">processName</span><span class="p">,</span><span class="w"> </span><span class="n">UserHandle</span><span class="p">.</span><span class="na">myUserId</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="p">...</span>
<span class="p">}</span>
</code></pre></div>
<code>ActivityThread.currentProcessName()</code>获取当前进程名称，并通过<code>DdmHandleAppName.setAppName</code>设置DDMS中的应用名称。</p>
<h3 id="3-process">3. <code>Process</code>类<a class="headerlink" href="#3-process" title="Permanent link">&para;</a></h3>
<p><code>Process</code>类提供了与进程相关的操作，包括设置进程名称。</p>
<h4 id="setargv0"><code>setArgV0</code>方法<a class="headerlink" href="#setargv0" title="Permanent link">&para;</a></h4>
<p><div class="highlight"><pre><span></span><code><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setArgV0</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">name</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">NullPointerException</span><span class="p">(</span><span class="s">&quot;name == null&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">Libcore</span><span class="p">.</span><span class="na">os</span><span class="p">.</span><span class="na">prctl</span><span class="p">(</span><span class="n">PR_SET_NAME</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">ErrnoException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">RuntimeException</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<code>setArgV0</code>通过<code>prctl</code>系统调用设置进程名称。</p>
<h3 id="4-activitymanagerservice">4. <code>ActivityManagerService</code><a class="headerlink" href="#4-activitymanagerservice" title="Permanent link">&para;</a></h3>
<p><code>ActivityManagerService</code>负责管理进程的启动和名称设置。</p>
<h4 id="startprocesslocked"><code>startProcessLocked</code>方法<a class="headerlink" href="#startprocesslocked" title="Permanent link">&para;</a></h4>
<p><div class="highlight"><pre><span></span><code><span class="kd">final</span><span class="w"> </span><span class="n">ProcessRecord</span><span class="w"> </span><span class="nf">startProcessLocked</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">processName</span><span class="p">,</span><span class="w"> </span><span class="n">ApplicationInfo</span><span class="w"> </span><span class="n">info</span><span class="p">,</span><span class="w"> </span><span class="p">...)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="p">...</span>
<span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">hostingType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;activity&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="n">String</span><span class="w"> </span><span class="n">hostingNameStr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;activity&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="p">...</span>
<span class="w">    </span><span class="n">Process</span><span class="p">.</span><span class="na">ProcessStartResult</span><span class="w"> </span><span class="n">startResult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Process</span><span class="p">.</span><span class="na">start</span><span class="p">(</span><span class="n">entryPoint</span><span class="p">,</span><span class="w"> </span><span class="p">...);</span>
<span class="w">    </span><span class="p">...</span>
<span class="p">}</span>
</code></pre></div>
<code>startProcessLocked</code>启动新进程时，会根据<code>processName</code>和<code>ApplicationInfo</code>设置进程名称。</p>
<h3 id="5-processstart">5. <code>Process.start</code>方法<a class="headerlink" href="#5-processstart" title="Permanent link">&para;</a></h3>
<p><code>Process.start</code>是启动新进程的关键方法。</p>
<p><div class="highlight"><pre><span></span><code><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">ProcessStartResult</span><span class="w"> </span><span class="nf">start</span><span class="p">(</span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">processClass</span><span class="p">,</span><span class="w"> </span><span class="p">...)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="p">...</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">zygoteProcess</span><span class="p">.</span><span class="na">start</span><span class="p">(</span><span class="n">processClass</span><span class="p">,</span><span class="w"> </span><span class="p">...);</span>
<span class="p">}</span>
</code></pre></div>
<code>zygoteProcess.start</code>通过Zygote进程启动新进程，并设置进程名称。</p>
<h3 id="_16">总结<a class="headerlink" href="#_16" title="Permanent link">&para;</a></h3>
<p>Android进程名称的指定涉及多个步骤：
1. <strong>初始化</strong>：<code>ActivityThread.main</code>通过<code>Process.setArgV0</code>设置初始名称。
2. <strong>设置</strong>：<code>ActivityThread.attach</code>通过<code>DdmHandleAppName.setAppName</code>设置DDMS中的应用名称。
3. <strong>启动新进程</strong>：<code>ActivityManagerService</code>和<code>Process</code>类在启动新进程时设置进程名称。</p>
<p>这些步骤共同确保每个Android进程拥有正确的名称。</p>
</details>
<h2 id="android-binder">Android Binder机制<a class="headerlink" href="#android-binder" title="Permanent link">&para;</a></h2>
<details class="answer">
<summary>答案</summary>
<p>https://gityuan.com/2015/10/31/binder-prepare/</p>
<p>Android Binder机制是Android系统中用于进程间通信（IPC）的核心机制。它允许不同进程之间进行高效、安全的通信，是Android框架的重要组成部分。以下是对Binder机制的详细解析：</p>
<h3 id="1-binder">1. <strong>Binder机制概述</strong><a class="headerlink" href="#1-binder" title="Permanent link">&para;</a></h3>
<p>Binder机制基于客户端-服务器模型，客户端进程通过Binder向服务器进程发送请求，服务器进程处理请求并返回结果。Binder机制的核心是Binder驱动，它运行在内核空间，负责管理进程间的通信。</p>
<h3 id="2-binder">2. <strong>Binder机制的主要组件</strong><a class="headerlink" href="#2-binder" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Binder驱动</strong>：位于内核空间，负责进程间通信的实际数据传输和管理。</li>
<li><strong>ServiceManager</strong>：一个特殊的系统服务，负责管理所有注册的Binder服务。客户端通过ServiceManager查找所需的Binder服务。</li>
<li><strong>Binder Proxy</strong>：客户端使用的代理对象，用于向服务器发送请求。</li>
<li><strong>Binder Stub</strong>：服务器端的实现对象，负责处理客户端的请求并返回结果。</li>
</ul>
<h3 id="3-binder">3. <strong>Binder机制的工作流程</strong><a class="headerlink" href="#3-binder" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>服务注册</strong>：服务器进程将服务注册到ServiceManager中，ServiceManager会为该服务分配一个唯一的标识符（Binder引用）。</li>
<li><strong>服务查找</strong>：客户端进程通过ServiceManager查找所需的服务，获取服务的Binder引用。</li>
<li><strong>请求发送</strong>：客户端通过Binder Proxy向服务器发送请求，请求数据通过Binder驱动传递到服务器进程。</li>
<li><strong>请求处理</strong>：服务器进程的Binder Stub接收到请求后，调用相应的服务方法进行处理。</li>
<li><strong>结果返回</strong>：服务器将处理结果通过Binder驱动返回给客户端。</li>
</ol>
<h3 id="4-binder">4. <strong>Binder机制的特点</strong><a class="headerlink" href="#4-binder" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>高效</strong>：Binder机制使用内存映射（mmap）技术，减少了数据拷贝的次数，提高了通信效率。</li>
<li><strong>安全</strong>：Binder机制基于Linux的UID/GID机制，可以控制进程间的访问权限，确保通信的安全性。</li>
<li><strong>跨进程调用透明</strong>：Binder机制通过代理对象和存根对象，使得跨进程调用对开发者透明，开发者可以像调用本地方法一样调用远程方法。</li>
</ul>
<h3 id="5-binder">5. <strong>Binder机制的应用</strong><a class="headerlink" href="#5-binder" title="Permanent link">&para;</a></h3>
<p>Binder机制广泛应用于Android系统的各个组件中，例如：
- <strong>ActivityManagerService</strong>：管理Activity的生命周期和任务栈。
- <strong>WindowManagerService</strong>：管理窗口的显示和布局。
- <strong>PackageManagerService</strong>：管理应用程序的安装和卸载。</p>
<h3 id="6-binder">6. <strong>Binder机制的实现细节</strong><a class="headerlink" href="#6-binder" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Binder驱动</strong>：Binder驱动是Binder机制的核心，它负责管理Binder对象的生命周期、数据传输和线程调度。</li>
<li><strong>Binder协议</strong>：Binder协议定义了客户端和服务器之间的通信格式，包括命令、数据和状态信息。</li>
<li><strong>Binder线程池</strong>：Binder机制使用线程池来处理客户端的请求，确保服务器能够并发处理多个请求。</li>
</ul>
<h3 id="7-binder">7. <strong>Binder机制的优缺点</strong><a class="headerlink" href="#7-binder" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>优点</strong>：</li>
<li>高效：减少了数据拷贝，提高了通信效率。</li>
<li>安全：基于Linux的UID/GID机制，确保通信的安全性。</li>
<li>透明：跨进程调用对开发者透明，简化了开发难度。</li>
<li><strong>缺点</strong>：</li>
<li>复杂性：Binder机制的实现较为复杂，理解和调试难度较大。</li>
<li>性能瓶颈：在高并发场景下，Binder驱动可能成为性能瓶颈。</li>
</ul>
<h3 id="_17">总结<a class="headerlink" href="#_17" title="Permanent link">&para;</a></h3>
<p>Android Binder机制是Android系统中用于进程间通信的核心机制，它基于客户端-服务器模型，通过Binder驱动实现高效、安全的通信。Binder机制广泛应用于Android系统的各个组件中，是Android框架的重要组成部分。理解Binder机制的工作原理和实现细节，对于深入理解Android系统和开发高性能的Android应用具有重要意义。</p>
</details>
<h2 id="android-ams">Android AMS机制<a class="headerlink" href="#android-ams" title="Permanent link">&para;</a></h2>
<details class="answer">
<summary>答案</summary>
<p>Android AMS（Activity Manager Service）是Android系统中负责管理Activity、Service、Application等组件生命周期的核心服务。AMS机制是Android框架的重要组成部分，负责应用程序的启动、切换、销毁等操作。</p>
<h3 id="1-ams">1. AMS的主要功能<a class="headerlink" href="#1-ams" title="Permanent link">&para;</a></h3>
<p>AMS的主要功能包括：
- <strong>Activity管理</strong>：负责Activity的启动、切换、销毁等操作。
- <strong>Service管理</strong>：负责Service的启动、绑定、销毁等操作。
- <strong>Application管理</strong>：负责应用程序的启动、退出等操作。
- <strong>进程管理</strong>：负责进程的创建、销毁、优先级调整等操作。
- <strong>任务栈管理</strong>：负责管理Activity的任务栈（Task Stack），确保Activity按照正确的顺序显示。</p>
<h3 id="2-ams">2. AMS的工作机制<a class="headerlink" href="#2-ams" title="Permanent link">&para;</a></h3>
<p>AMS的工作机制主要涉及以下几个方面：</p>
<h4 id="21-activity">2.1 Activity的启动流程<a class="headerlink" href="#21-activity" title="Permanent link">&para;</a></h4>
<p>当用户点击一个应用图标或通过Intent启动一个Activity时，AMS会负责处理这个请求。具体流程如下：
1. <strong>Launcher发起请求</strong>：Launcher（桌面应用）通过<code>startActivity</code>方法发起启动Activity的请求。
2. <strong>AMS处理请求</strong>：AMS接收到请求后，会检查目标Activity的权限、启动模式等信息。
3. <strong>创建进程（如果需要）</strong>：如果目标Activity所在的应用程序进程尚未启动，AMS会通过Zygote进程创建一个新的应用进程。
4. <strong>启动Activity</strong>：AMS通过Binder机制与目标应用程序进程通信，通知其启动目标Activity。
5. <strong>Activity生命周期回调</strong>：目标Activity的<code>onCreate</code>、<code>onStart</code>、<code>onResume</code>等方法会被依次调用，完成Activity的启动。</p>
<h4 id="22-service">2.2 Service的启动流程<a class="headerlink" href="#22-service" title="Permanent link">&para;</a></h4>
<p>Service的启动流程与Activity类似，AMS负责处理Service的启动、绑定等操作。具体流程如下：
1. <strong>发起请求</strong>：通过<code>startService</code>或<code>bindService</code>方法发起启动或绑定Service的请求。
2. <strong>AMS处理请求</strong>：AMS接收到请求后，会检查目标Service的权限等信息。
3. <strong>创建进程（如果需要）</strong>：如果目标Service所在的应用程序进程尚未启动，AMS会通过Zygote进程创建一个新的应用进程。
4. <strong>启动Service</strong>：AMS通过Binder机制与目标应用程序进程通信，通知其启动目标Service。
5. <strong>Service生命周期回调</strong>：目标Service的<code>onCreate</code>、<code>onStartCommand</code>等方法会被依次调用，完成Service的启动。</p>
<h4 id="23">2.3 进程管理<a class="headerlink" href="#23" title="Permanent link">&para;</a></h4>
<p>AMS负责管理应用程序进程的生命周期，包括进程的创建、销毁、优先级调整等。AMS会根据应用程序的状态（如前台、后台）动态调整进程的优先级，以确保系统资源的合理分配。</p>
<h4 id="24_1">2.4 任务栈管理<a class="headerlink" href="#24_1" title="Permanent link">&para;</a></h4>
<p>AMS通过任务栈（Task Stack）来管理Activity的显示顺序。每个任务栈包含一组相关的Activity，用户可以通过返回键依次回退到之前的Activity。AMS会根据Activity的启动模式（如<code>standard</code>、<code>singleTop</code>、<code>singleTask</code>、<code>singleInstance</code>）来决定如何管理任务栈。</p>
<h3 id="3-ams">3. AMS的启动模式<a class="headerlink" href="#3-ams" title="Permanent link">&para;</a></h3>
<p>AMS支持多种Activity启动模式，主要包括：
- <strong>standard</strong>：默认模式，每次启动都会创建一个新的Activity实例。
- <strong>singleTop</strong>：如果目标Activity已经位于任务栈的顶部，则不会创建新的实例，而是复用现有的实例。
- <strong>singleTask</strong>：如果目标Activity已经存在于任务栈中，则不会创建新的实例，而是将任务栈中该Activity之上的所有Activity销毁，使其成为栈顶。
- <strong>singleInstance</strong>：目标Activity会单独存在于一个任务栈中，且该任务栈中只能有一个Activity。</p>
<h3 id="4-amsbinder">4. AMS与Binder机制<a class="headerlink" href="#4-amsbinder" title="Permanent link">&para;</a></h3>
<p>AMS通过Binder机制与应用程序进程进行通信。Binder是Android中的一种跨进程通信（IPC）机制，AMS作为系统服务运行在系统进程中，而应用程序运行在独立的进程中。AMS通过Binder与应用程序进程通信，发送启动、销毁等指令。</p>
<h3 id="5-ams">5. AMS的优化与限制<a class="headerlink" href="#5-ams" title="Permanent link">&para;</a></h3>
<p>AMS在Android系统中扮演着重要角色，但也存在一些性能瓶颈和限制。例如，AMS需要处理大量的跨进程通信，这可能会导致系统性能下降。为了优化AMS的性能，Android系统引入了以下机制：
- <strong>进程优先级管理</strong>：AMS会根据应用程序的状态动态调整进程的优先级，确保前台应用的响应速度。
- <strong>任务栈优化</strong>：AMS会对任务栈进行优化，减少不必要的Activity实例，降低内存占用。</p>
<h3 id="6_3">6. 总结<a class="headerlink" href="#6_3" title="Permanent link">&para;</a></h3>
<p>AMS是Android系统中负责管理Activity、Service、Application等组件生命周期的核心服务。它通过Binder机制与应用程序进程通信，处理组件的启动、切换、销毁等操作。AMS还负责进程管理、任务栈管理等功能，确保系统资源的合理分配和应用程序的正常运行。理解AMS的机制对于开发高性能、稳定的Android应用至关重要。</p>
</details>
<h2 id="android_1">你知道哪些Android系统源码的设计模式？<a class="headerlink" href="#android_1" title="Permanent link">&para;</a></h2>
<details class="answer">
<summary>答案</summary>
<p>在Android系统源码中，设计模式被广泛用于解决常见问题并提升代码的可维护性和扩展性。以下是一些常用的设计模式及其应用场景：</p>
<h3 id="1-singleton">1. <strong>单例模式（Singleton）</strong><a class="headerlink" href="#1-singleton" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>应用场景</strong>：确保一个类只有一个实例，并提供全局访问点。</li>
<li><strong>示例</strong>：<code>LayoutInflater</code>、<code>InputMethodManager</code>等系统服务通常通过单例模式提供。</li>
</ul>
<h3 id="2-factory">2. <strong>工厂模式（Factory）</strong><a class="headerlink" href="#2-factory" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>应用场景</strong>：创建对象时隐藏具体实现，提供统一的接口。</li>
<li><strong>示例</strong>：<code>BitmapFactory</code>用于创建<code>Bitmap</code>对象。</li>
</ul>
<h3 id="3-observer">3. <strong>观察者模式（Observer）</strong><a class="headerlink" href="#3-observer" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>应用场景</strong>：定义对象间的一对多依赖关系，当一个对象状态改变时，所有依赖对象都会收到通知。</li>
<li><strong>示例</strong>：<code>LiveData</code>、<code>View</code>与<code>ViewTreeObserver</code>的交互。</li>
</ul>
<h3 id="4-adapter">4. <strong>适配器模式（Adapter）</strong><a class="headerlink" href="#4-adapter" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>应用场景</strong>：将一个类的接口转换成客户端期望的另一个接口。</li>
<li><strong>示例</strong>：<code>RecyclerView.Adapter</code>用于将数据适配到<code>RecyclerView</code>中。</li>
</ul>
<h3 id="5-decorator">5. <strong>装饰者模式（Decorator）</strong><a class="headerlink" href="#5-decorator" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>应用场景</strong>：动态地为对象添加功能，避免通过子类扩展。</li>
<li><strong>示例</strong>：<code>ContextWrapper</code>是对<code>Context</code>的装饰，允许在不修改原始类的情况下扩展功能。</li>
</ul>
<h3 id="6-strategy">6. <strong>策略模式（Strategy）</strong><a class="headerlink" href="#6-strategy" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>应用场景</strong>：定义一系列算法，封装每个算法，并使它们可以互换。</li>
<li><strong>示例</strong>：<code>Animation</code>中的插值器（Interpolator）允许动态改变动画的行为。</li>
</ul>
<h3 id="7-template-method">7. <strong>模板方法模式（Template Method）</strong><a class="headerlink" href="#7-template-method" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>应用场景</strong>：定义一个算法的框架，允许子类在不改变结构的情况下重写某些步骤。</li>
<li><strong>示例</strong>：<code>AsyncTask</code>中的<code>doInBackground</code>、<code>onPostExecute</code>等方法。</li>
</ul>
<h3 id="8-builder">8. <strong>建造者模式（Builder）</strong><a class="headerlink" href="#8-builder" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>应用场景</strong>：将一个复杂对象的构建与其表示分离，使得同样的构建过程可以创建不同的表示。</li>
<li><strong>示例</strong>：<code>AlertDialog.Builder</code>用于构建<code>AlertDialog</code>。</li>
</ul>
<h3 id="9-proxy">9. <strong>代理模式（Proxy）</strong><a class="headerlink" href="#9-proxy" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>应用场景</strong>：为其他对象提供一种代理以控制对这个对象的访问。</li>
<li><strong>示例</strong>：<code>Binder</code>机制中的代理对象用于跨进程通信。</li>
</ul>
<h3 id="10-composite">10. <strong>组合模式（Composite）</strong><a class="headerlink" href="#10-composite" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>应用场景</strong>：将对象组合成树形结构以表示“部分-整体”的层次结构。</li>
<li><strong>示例</strong>：<code>View</code>和<code>ViewGroup</code>的层次结构。</li>
</ul>
<h3 id="11-command">11. <strong>命令模式（Command）</strong><a class="headerlink" href="#11-command" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>应用场景</strong>：将请求封装为对象，使得可以用不同的请求对客户进行参数化。</li>
<li><strong>示例</strong>：<code>Runnable</code>和<code>Handler</code>用于封装和执行任务。</li>
</ul>
<h3 id="12-state">12. <strong>状态模式（State）</strong><a class="headerlink" href="#12-state" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>应用场景</strong>：允许对象在其内部状态改变时改变其行为。</li>
<li><strong>示例</strong>：<code>View</code>的状态管理（如<code>View.Visibility</code>）。</li>
</ul>
<h3 id="13-memento">13. <strong>备忘录模式（Memento）</strong><a class="headerlink" href="#13-memento" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>应用场景</strong>：在不破坏封装性的前提下，捕获并外部化一个对象的内部状态。</li>
<li><strong>示例</strong>：<code>Activity</code>的状态保存与恢复（<code>onSaveInstanceState</code>和<code>onRestoreInstanceState</code>）。</li>
</ul>
<h3 id="14-iterator">14. <strong>迭代器模式（Iterator）</strong><a class="headerlink" href="#14-iterator" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>应用场景</strong>：提供一种方法顺序访问一个聚合对象中的各个元素，而又不暴露其内部表示。</li>
<li><strong>示例</strong>：<code>Cursor</code>用于遍历数据库查询结果。</li>
</ul>
<h3 id="15-facade">15. <strong>外观模式（Facade）</strong><a class="headerlink" href="#15-facade" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>应用场景</strong>：为子系统中的一组接口提供一个统一的接口。</li>
<li><strong>示例</strong>：<code>Context</code>封装了访问系统资源的接口。</li>
</ul>
<p>这些设计模式在Android源码中广泛应用，帮助开发者构建灵活、可维护的系统架构。</p>
</details>
<h2 id="android-bitmap">Android bitmap是什么？有什么特点？<a class="headerlink" href="#android-bitmap" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code>??? answer &quot;答案&quot;
在Android开发中，`Bitmap` 是一个用于表示图像数据的类，通常用于处理和显示图像。以下是它的主要特点：

### 1. **图像表示**
- `Bitmap` 用于存储和操作像素数据，支持多种格式如PNG、JPEG等。

### 2. **内存占用**
- `Bitmap` 直接存储像素数据，内存消耗较大，尤其是高分辨率图像，容易导致内存溢出（OOM）。

### 3. **可变性**
- 可以是可变的（`mutable`）或不可变的（`immutable`）。可变 `Bitmap` 允许修改像素数据，而不可变 `Bitmap` 则不能。

### 4. **图像处理**
- 支持缩放、裁剪、旋转等操作，适合在UI中显示和处理图像。

### 5. **硬件加速**
- 部分操作可利用硬件加速提升性能，但并非所有操作都支持。

### 6. **回收机制**
- 使用 `recycle()` 方法可手动释放内存，避免内存泄漏。

### 7. **缓存**
- 常用 `Bitmap` 可通过 `LruCache` 或 `DiskLruCache` 进行缓存，提升加载效率。

### 8. **配置选项**
- 通过 `BitmapFactory.Options` 可控制图像解码方式，如采样率、颜色模式等。

### 9. **线程安全**
- `Bitmap` 本身非线程安全，多线程操作时需自行同步。

### 10. **API支持**
- 提供丰富的API，如 `createBitmap()`、`copy()` 等，便于图像操作。

### 示例代码
```java
// 从资源加载Bitmap
Bitmap bitmap = BitmapFactory.decodeResource(getResources(), R.drawable.image);

// 缩放Bitmap
Bitmap scaledBitmap = Bitmap.createScaledBitmap(bitmap, newWidth, newHeight, true);

// 回收Bitmap
bitmap.recycle();
```

### 总结
`Bitmap` 是Android中处理图像的核心类，功能强大但需注意内存管理，避免OOM问题。
</code></pre></div>
<h2 id="android_2">Android如何安全加载大图片？<a class="headerlink" href="#android_2" title="Permanent link">&para;</a></h2>
<details class="answer">
<summary>答案</summary>
<p>在Android中加载大图片时，直接加载可能导致内存溢出（OOM）。以下是安全加载大图片的几种方法：</p>
<h3 id="1-bitmapfactoryoptions">1. <strong>使用 <code>BitmapFactory.Options</code> 进行采样</strong><a class="headerlink" href="#1-bitmapfactoryoptions" title="Permanent link">&para;</a></h3>
<p>通过设置 <code>inSampleSize</code> 来降低图像分辨率，减少内存占用。</p>
<div class="highlight"><pre><span></span><code><span class="kd">public</span><span class="w"> </span><span class="n">Bitmap</span><span class="w"> </span><span class="nf">decodeSampledBitmapFromResource</span><span class="p">(</span><span class="n">Resources</span><span class="w"> </span><span class="n">res</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">resId</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">reqWidth</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">reqHeight</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// 第一次解码，获取图像尺寸</span>
<span class="w">    </span><span class="kd">final</span><span class="w"> </span><span class="n">BitmapFactory</span><span class="p">.</span><span class="na">Options</span><span class="w"> </span><span class="n">options</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">BitmapFactory</span><span class="p">.</span><span class="na">Options</span><span class="p">();</span>
<span class="w">    </span><span class="n">options</span><span class="p">.</span><span class="na">inJustDecodeBounds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">    </span><span class="n">BitmapFactory</span><span class="p">.</span><span class="na">decodeResource</span><span class="p">(</span><span class="n">res</span><span class="p">,</span><span class="w"> </span><span class="n">resId</span><span class="p">,</span><span class="w"> </span><span class="n">options</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// 计算 inSampleSize</span>
<span class="w">    </span><span class="n">options</span><span class="p">.</span><span class="na">inSampleSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">calculateInSampleSize</span><span class="p">(</span><span class="n">options</span><span class="p">,</span><span class="w"> </span><span class="n">reqWidth</span><span class="p">,</span><span class="w"> </span><span class="n">reqHeight</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// 第二次解码，加载缩小后的图像</span>
<span class="w">    </span><span class="n">options</span><span class="p">.</span><span class="na">inJustDecodeBounds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">BitmapFactory</span><span class="p">.</span><span class="na">decodeResource</span><span class="p">(</span><span class="n">res</span><span class="p">,</span><span class="w"> </span><span class="n">resId</span><span class="p">,</span><span class="w"> </span><span class="n">options</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">calculateInSampleSize</span><span class="p">(</span><span class="n">BitmapFactory</span><span class="p">.</span><span class="na">Options</span><span class="w"> </span><span class="n">options</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">reqWidth</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">reqHeight</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">final</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">options</span><span class="p">.</span><span class="na">outHeight</span><span class="p">;</span>
<span class="w">    </span><span class="kd">final</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">options</span><span class="p">.</span><span class="na">outWidth</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">inSampleSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">height</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">reqHeight</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">width</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">reqWidth</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">halfHeight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">height</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="w">        </span><span class="kd">final</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">halfWidth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">width</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>

<span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="p">((</span><span class="n">halfHeight</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">inSampleSize</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">reqHeight</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="n">halfWidth</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">inSampleSize</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">reqWidth</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">inSampleSize</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">inSampleSize</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="2-bitmapregiondecoder">2. <strong>使用 <code>BitmapRegionDecoder</code> 加载部分图像</strong><a class="headerlink" href="#2-bitmapregiondecoder" title="Permanent link">&para;</a></h3>
<p>对于超大图像，可以只加载显示区域的部分图像。</p>
<div class="highlight"><pre><span></span><code><span class="kd">public</span><span class="w"> </span><span class="n">Bitmap</span><span class="w"> </span><span class="nf">decodeRegionFromResource</span><span class="p">(</span><span class="n">Resources</span><span class="w"> </span><span class="n">res</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">resId</span><span class="p">,</span><span class="w"> </span><span class="n">Rect</span><span class="w"> </span><span class="n">rect</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">reqWidth</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">reqHeight</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">InputStream</span><span class="w"> </span><span class="n">is</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">res</span><span class="p">.</span><span class="na">openRawResource</span><span class="p">(</span><span class="n">resId</span><span class="p">);</span>
<span class="w">    </span><span class="n">BitmapRegionDecoder</span><span class="w"> </span><span class="n">decoder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BitmapRegionDecoder</span><span class="p">.</span><span class="na">newInstance</span><span class="p">(</span><span class="n">is</span><span class="p">,</span><span class="w"> </span><span class="kc">false</span><span class="p">);</span>
<span class="w">    </span><span class="n">BitmapFactory</span><span class="p">.</span><span class="na">Options</span><span class="w"> </span><span class="n">options</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">BitmapFactory</span><span class="p">.</span><span class="na">Options</span><span class="p">();</span>
<span class="w">    </span><span class="n">options</span><span class="p">.</span><span class="na">inSampleSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">calculateInSampleSize</span><span class="p">(</span><span class="n">decoder</span><span class="p">.</span><span class="na">getWidth</span><span class="p">(),</span><span class="w"> </span><span class="n">decoder</span><span class="p">.</span><span class="na">getHeight</span><span class="p">(),</span><span class="w"> </span><span class="n">reqWidth</span><span class="p">,</span><span class="w"> </span><span class="n">reqHeight</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">decoder</span><span class="p">.</span><span class="na">decodeRegion</span><span class="p">(</span><span class="n">rect</span><span class="p">,</span><span class="w"> </span><span class="n">options</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="3_3">3. <strong>使用第三方库</strong><a class="headerlink" href="#3_3" title="Permanent link">&para;</a></h3>
<p>使用如Glide、Picasso等第三方库，它们已优化了大图片的加载。</p>
<h4 id="glide">Glide 示例<a class="headerlink" href="#glide" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="n">Glide</span><span class="p">.</span><span class="na">with</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="na">load</span><span class="p">(</span><span class="n">imageUrl</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="na">override</span><span class="p">(</span><span class="n">reqWidth</span><span class="p">,</span><span class="w"> </span><span class="n">reqHeight</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="na">into</span><span class="p">(</span><span class="n">imageView</span><span class="p">);</span>
</code></pre></div>
<h4 id="picasso">Picasso 示例<a class="headerlink" href="#picasso" title="Permanent link">&para;</a></h4>
<div class="highlight"><pre><span></span><code><span class="n">Picasso</span><span class="p">.</span><span class="na">get</span><span class="p">()</span>
<span class="w">    </span><span class="p">.</span><span class="na">load</span><span class="p">(</span><span class="n">imageUrl</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="na">resize</span><span class="p">(</span><span class="n">reqWidth</span><span class="p">,</span><span class="w"> </span><span class="n">reqHeight</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="na">into</span><span class="p">(</span><span class="n">imageView</span><span class="p">);</span>
</code></pre></div>
<h3 id="4-inbitmap">4. <strong>使用 <code>inBitmap</code> 重用内存</strong><a class="headerlink" href="#4-inbitmap" title="Permanent link">&para;</a></h3>
<p>通过 <code>inBitmap</code> 重用已存在的 <code>Bitmap</code> 内存，减少内存分配。</p>
<div class="highlight"><pre><span></span><code><span class="n">BitmapFactory</span><span class="p">.</span><span class="na">Options</span><span class="w"> </span><span class="n">options</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">BitmapFactory</span><span class="p">.</span><span class="na">Options</span><span class="p">();</span>
<span class="n">options</span><span class="p">.</span><span class="na">inMutable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="n">options</span><span class="p">.</span><span class="na">inBitmap</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">reusableBitmap</span><span class="p">;</span>
<span class="n">Bitmap</span><span class="w"> </span><span class="n">bitmap</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BitmapFactory</span><span class="p">.</span><span class="na">decodeResource</span><span class="p">(</span><span class="n">res</span><span class="p">,</span><span class="w"> </span><span class="n">resId</span><span class="p">,</span><span class="w"> </span><span class="n">options</span><span class="p">);</span>
</code></pre></div>
<h3 id="5-bitmapfactoryoptions-inpreferredconfig">5. <strong>使用 <code>BitmapFactory.Options</code> 的 <code>inPreferredConfig</code></strong><a class="headerlink" href="#5-bitmapfactoryoptions-inpreferredconfig" title="Permanent link">&para;</a></h3>
<p>通过设置 <code>inPreferredConfig</code> 为 <code>Bitmap.Config.RGB_565</code>，减少每个像素的内存占用。</p>
<div class="highlight"><pre><span></span><code><span class="n">BitmapFactory</span><span class="p">.</span><span class="na">Options</span><span class="w"> </span><span class="n">options</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">BitmapFactory</span><span class="p">.</span><span class="na">Options</span><span class="p">();</span>
<span class="n">options</span><span class="p">.</span><span class="na">inPreferredConfig</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Bitmap</span><span class="p">.</span><span class="na">Config</span><span class="p">.</span><span class="na">RGB_565</span><span class="p">;</span>
<span class="n">Bitmap</span><span class="w"> </span><span class="n">bitmap</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BitmapFactory</span><span class="p">.</span><span class="na">decodeResource</span><span class="p">(</span><span class="n">res</span><span class="p">,</span><span class="w"> </span><span class="n">resId</span><span class="p">,</span><span class="w"> </span><span class="n">options</span><span class="p">);</span>
</code></pre></div>
<h3 id="6_4">6. <strong>异步加载</strong><a class="headerlink" href="#6_4" title="Permanent link">&para;</a></h3>
<p>在后台线程加载图片，避免阻塞主线程。</p>
<div class="highlight"><pre><span></span><code><span class="k">new</span><span class="w"> </span><span class="n">AsyncTask</span><span class="o">&lt;</span><span class="n">Void</span><span class="p">,</span><span class="w"> </span><span class="n">Void</span><span class="p">,</span><span class="w"> </span><span class="n">Bitmap</span><span class="o">&gt;</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">protected</span><span class="w"> </span><span class="n">Bitmap</span><span class="w"> </span><span class="nf">doInBackground</span><span class="p">(</span><span class="n">Void</span><span class="p">...</span><span class="w"> </span><span class="n">voids</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">decodeSampledBitmapFromResource</span><span class="p">(</span><span class="n">res</span><span class="p">,</span><span class="w"> </span><span class="n">resId</span><span class="p">,</span><span class="w"> </span><span class="n">reqWidth</span><span class="p">,</span><span class="w"> </span><span class="n">reqHeight</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">protected</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">onPostExecute</span><span class="p">(</span><span class="n">Bitmap</span><span class="w"> </span><span class="n">bitmap</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">imageView</span><span class="p">.</span><span class="na">setImageBitmap</span><span class="p">(</span><span class="n">bitmap</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}.</span><span class="na">execute</span><span class="p">();</span>
</code></pre></div>
<h3 id="_18">总结<a class="headerlink" href="#_18" title="Permanent link">&para;</a></h3>
<p>安全加载大图片的关键是减少内存占用，可通过采样、加载部分图像、使用第三方库、重用内存、异步加载等方法实现。</p>
</details>
<h2 id="android_3">Android中的类加载器<a class="headerlink" href="#android_3" title="Permanent link">&para;</a></h2>
<details class="answer">
<summary>答案</summary>
<p>PathClassLoader，只能加载系统中已经安装过的 apk
DexClassLoader，可以加载 jar/apk/dex，可以从 SD卡中加载未安装的 apk</p>
</details>
<h2 id="andriod">Andriod 系统启动过程<a class="headerlink" href="#andriod" title="Permanent link">&para;</a></h2>
<details class="answer">
<summary>答案</summary>
<p>https://github.com/jeanboydev/Android-ReadTheFuckingSourceCode/blob/master/article/android/framework/Android-%E7%B3%BB%E7%BB%9F%E5%90%AF%E5%8A%A8%E8%BF%87%E7%A8%8B.md</p>
</details>
<h2 id="android-surfaceflinger">Android - SurfaceFlinger 图形系统<a class="headerlink" href="#android-surfaceflinger" title="Permanent link">&para;</a></h2>
<details class="answer">
<summary>答案</summary>
<p>https://github.com/jeanboydev/Android-ReadTheFuckingSourceCode/blob/master/article/android/framework/Android-SurfaceFlinger%E5%9B%BE%E5%BD%A2%E7%B3%BB%E7%BB%9F.md</p>
</details>
<h2 id="android-service">Android - Service 启动过程<a class="headerlink" href="#android-service" title="Permanent link">&para;</a></h2>
<details class="answer">
<summary>答案</summary>
<p>https://github.com/jeanboydev/Android-ReadTheFuckingSourceCode/blob/master/article/android/framework/Android-Service%E5%90%AF%E5%8A%A8%E8%BF%87%E7%A8%8B.md</p>
</details>
<h2 id="android-packagemangerservice">Android - PackageMangerService 分析<a class="headerlink" href="#android-packagemangerservice" title="Permanent link">&para;</a></h2>
<details class="answer">
<summary>答案</summary>
<p>https://github.com/jeanboydev/Android-ReadTheFuckingSourceCode/blob/master/article/android/framework/Android-PackageManagerService%E5%88%86%E6%9E%90.md</p>
</details>
<h2 id="android-powermanagerservice">Android - PowerManagerService 启动<a class="headerlink" href="#android-powermanagerservice" title="Permanent link">&para;</a></h2>
<details class="answer">
<summary>答案</summary>
<p>https://github.com/jeanboydev/Android-ReadTheFuckingSourceCode/blob/master/article/android/framework/Android-PowerManagerService-%E5%90%AF%E5%8A%A8.md</p>
</details>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "navigation.sections", "navigation.expand", "search.highlight", "content.code.copy", "content.tabs.link"], "search": "../../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.c8b220af.min.js"></script>
      
        <script src="../../js/custom.js"></script>
      
    
  </body>
</html>